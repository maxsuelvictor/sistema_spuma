unit enSM;

interface

uses System.SysUtils, System.Classes,
  // Datasnap.DSServer, Datasnap.DSAuth,
  Data.DB, Data.DBXCommon,Datasnap.Provider,Vcl.Forms,Vcl.Imaging.pngimage,Winapi.Windows,Vcl.Graphics,
  DBClient, IdHashMessageDigest, Data.FMTBcd, Data.SqlExpr,dxBar,System.IniFiles,
  DbxDevartPostgreSQL,DataSnap.DSSession, System.TypInfo, Math, System.Generics.Collections,
  DataSnap.DSProviderDataModuleAdapter,DateUtils,Jpeg;



type
  TAllApplyUpdatesError = class(Exception);

type
  TSM = class(TDSServerModule)
    CAD_DP_C_CNE: TDataSetProvider;
    CAD_DP_C_CID: TDataSetProvider;
    CAD_DP_C_RAM: TDataSetProvider;
    CAD_DP_C_CIN: TDataSetProvider;
    CAD_DP_C_PEC: TDataSetProvider;
    CAD_DP_C_PCT: TDataSetProvider;
    CAD_DP_C_CCU: TDataSetProvider;
    CAD_DP_C_CTC: TDataSetProvider;
    CAD_DP_C_LTO: TDataSetProvider;
    CAD_DP_C_TIF: TDataSetProvider;
    CAD_DP_C_TME: TDataSetProvider;
    CAD_DP_C_FPG: TDataSetProvider;
    CAD_DP_C_CPG: TDataSetProvider;
    CAD_DP_C_UND: TDataSetProvider;
    CAD_DP_C_NCM: TDataSetProvider;
    CAD_DP_C_INF: TDataSetProvider;
    CAD_DP_C_NAT: TDataSetProvider;
    CAD_DP_C_CFO: TDataSetProvider;
    CAD_DP_C_GRU: TDataSetProvider;
    CAD_DP_C_TRI: TDataSetProvider;
    CAD_DP_C_ECF: TDataSetProvider;
    CAD_DP_C_FOR: TDataSetProvider;
    CAD_DP_C_FUN: TDataSetProvider;
    CAD_DP_C_CLI: TDataSetProvider;
    CAD_DP_C_ITE: TDataSetProvider;
    CMP_DS_M_SOL: TDataSource;
    CMP_DP_M_SOL: TDataSetProvider;
    CAD_DS_C_FOR: TDataSource;
    CAD_DS_C_CLI: TDataSource;
    CAD_DS_C_ITE: TDataSource;
    CAD_DS_C_PAR: TDataSource;
    CAD_DS_C_TRI: TDataSource;
    CAD_DS_C_PES: TDataSource;
    CAD_DP_C_PES: TDataSetProvider;
    PCP_DS_C_LME: TDataSource;
    PCP_DP_C_LME: TDataSetProvider;
    PCP_DP_C_ESP: TDataSetProvider;
    PCP_DP_C_DIS: TDataSetProvider;
    PCP_DP_C_CRG: TDataSetProvider;
    PCP_DP_C_CNF: TDataSetProvider;
    PCP_DP_C_CDR: TDataSetProvider;
    CAD_DP_C_ALM: TDataSetProvider;
    PCP_DP_C_MTA: TDataSetProvider;
    PCP_DP_C_REG: TDataSetProvider;
    PCP_DP_C_ROT: TDataSetProvider;
    PCP_DP_C_TLM: TDataSetProvider;
    PCP_DS_C_LME_DOC: TDataSource;
    EST_DP_M_FEA: TDataSetProvider;
    EST_DP_M_FES: TDataSetProvider;
    CMP_DS_M_PED: TDataSource;
    CMP_DP_M_PED: TDataSetProvider;
    CMP_DS_M_COT: TDataSource;
    CMP_DS_M_COT_FOR: TDataSource;
    CMP_DP_M_COT: TDataSetProvider;
    FAT_DS_M_PED: TDataSource;
    FAT_DP_M_PED: TDataSetProvider;
    FAT_DS_M_NFE: TDataSource;
    FAT_DP_M_NFE: TDataSetProvider;
    FAT_DS_M_POS: TDataSource;
    FAT_DP_M_POS: TDataSetProvider;
    CAD_DP_C_PAR: TDataSetProvider;
    CAD_DP_C_COR: TDataSetProvider;
    BUS_DP_C_PAR_SER: TDataSetProvider;
    BUS_DP_M_NFE_NFF: TDataSetProvider;
    BUS_DP_C_TRI_REG: TDataSetProvider;
    BUS_DP_M_NFE: TDataSetProvider;
    PCP_DP_M_ACR: TDataSetProvider;
    PCP_DS_M_ACR: TDataSource;
    PCP_DS_M_ACR_ITE: TDataSource;
    CAD_DP_C_SET: TDataSetProvider;
    BUS_DP_M_POS: TDataSetProvider;
    FAT_DS_M_ORC: TDataSource;
    FAT_DP_M_ORC: TDataSetProvider;
    PCP_DS_C_PRQ: TDataSource;
    PCP_DS_C_TPP: TDataSource;
    PCP_DP_C_PRQ: TDataSetProvider;
    PCP_DP_C_CDP: TDataSetProvider;
    PCP_DP_C_MDE: TDataSetProvider;
    PCP_DP_C_MEQ: TDataSetProvider;
    PCP_DP_C_PRP: TDataSetProvider;
    PCP_DP_C_RPT: TDataSetProvider;
    PCP_DP_C_TPP: TDataSetProvider;
    CAD_DS_C_SET: TDataSource;
    CAD_DP_C_MVE: TDataSetProvider;
    CAD_DP_C_TDF: TDataSetProvider;
    CAD_DP_C_VEI: TDataSetProvider;
    PCP_DS_C_CIN: TDataSource;
    PCP_DP_C_CIN: TDataSetProvider;
    PCP_DS_M_OPR: TDataSource;
    PCP_DP_M_OPR: TDataSetProvider;
    PCP_DS_M_OPB: TDataSource;
    PCP_DS_M_OPB_OPE: TDataSource;
    PCP_DP_M_OPB: TDataSetProvider;
    PCP_DS_M_CRP: TDataSource;
    PCP_DS_M_CRP_ITE: TDataSource;
    PCP_DP_M_CRP: TDataSetProvider;
    PCP_DS_M_LBE: TDataSource;
    PCP_DP_M_LBE: TDataSetProvider;
    PCP_DS_M_OPR_OPS: TDataSource;
    PCP_DP_C_INS: TDataSetProvider;
    PCP_DP_C_TIN: TDataSetProvider;
    PCP_DS_M_NCF: TDataSource;
    PCP_DP_M_NCF: TDataSetProvider;
    PCP_DS_M_CAC: TDataSource;
    PCP_DP_M_CAC: TDataSetProvider;
    PCP_DS_M_CME: TDataSource;
    PCP_DP_M_CME: TDataSetProvider;
    PCP_DS_M_CRQ: TDataSource;
    PCP_DP_M_CRQ: TDataSetProvider;
    PCP_DP_M_LPR: TDataSetProvider;
    PCP_DS_M_LPR: TDataSource;
    PCP_DS_M_MCP: TDataSource;
    PCP_DP_M_MCP: TDataSetProvider;
    PCP_DP_M_RVC: TDataSetProvider;
    PCP_DS_M_RVC: TDataSource;
    PCP_DS_M_RVC_ITE: TDataSource;
    PCP_DS_M_RVC_ITE_SET: TDataSource;
    BUS_DP_C_ITE_PRE: TDataSetProvider;
    FIN_DP_M_COB: TDataSetProvider;
    FIN_DS_M_COB: TDataSource;
    FIN_DP_M_PAG: TDataSetProvider;
    FIN_DP_M_REC: TDataSetProvider;
    FIN_DP_M_RCR: TDataSetProvider;
    FIN_DP_M_RBX: TDataSetProvider;
    FIN_DS_M_RBX: TDataSource;
    PCP_DP_M_VVE: TDataSetProvider;
    FIN_DP_M_CXA: TDataSetProvider;
    FIN_DP_M_CTA: TDataSetProvider;
    CAD_SQ_C_CNE: TSQLDataSet;
    CAD_SQ_C_CID: TSQLDataSet;
    CAD_SQ_C_RAM: TSQLDataSet;
    CAD_SQ_C_CIN: TSQLDataSet;
    CAD_SQ_C_PEC: TSQLDataSet;
    CAD_SQ_C_PCT: TSQLDataSet;
    CAD_SQ_C_CCU: TSQLDataSet;
    CAD_SQ_C_CTC: TSQLDataSet;
    CAD_SQ_C_LTO: TSQLDataSet;
    CAD_SQ_C_TIF: TSQLDataSet;
    CAD_SQ_C_TME: TSQLDataSet;
    CAD_SQ_C_FPG: TSQLDataSet;
    CAD_SQ_C_CPG: TSQLDataSet;
    CAD_SQ_C_UND: TSQLDataSet;
    CAD_SQ_C_NCM: TSQLDataSet;
    CAD_SQ_C_INF: TSQLDataSet;
    CAD_SQ_C_NAT: TSQLDataSet;
    CAD_SQ_C_CFO: TSQLDataSet;
    CAD_SQ_C_GRU: TSQLDataSet;
    CAD_SQ_C_TRI: TSQLDataSet;
    CAD_SQ_C_TRI_REG: TSQLDataSet;
    CAD_SQ_C_ECF: TSQLDataSet;
    CAD_SQ_C_PES: TSQLDataSet;
    CAD_SQ_C_PES_MOD: TSQLDataSet;
    CAD_SQ_C_COR: TSQLDataSet;
    CAD_SQ_C_SET: TSQLDataSet;
    CAD_SQ_C_SET_TDS: TSQLDataSet;
    CAD_SQ_C_MVE: TSQLDataSet;
    CAD_SQ_C_TDF: TSQLDataSet;
    CAD_SQ_C_VEI: TSQLDataSet;
    CAD_SQ_C_FOR: TSQLDataSet;
    CAD_SQ_C_FOR_REP: TSQLDataSet;
    CAD_SQ_C_FUN: TSQLDataSet;
    CAD_SQ_C_CLI: TSQLDataSet;
    CAD_SQ_C_CLI_CTO: TSQLDataSet;
    CAD_SQ_C_CLI_INF: TSQLDataSet;
    CAD_SQ_C_CLI_REC: TSQLDataSet;
    CAD_SQ_C_ITE: TSQLDataSet;
    CAD_SQ_C_ITE_COM: TSQLDataSet;
    CAD_SQ_C_ITE_ESP: TSQLDataSet;
    EST_SQ_M_LOT: TSQLDataSet;
    CAD_SQ_C_PAR: TSQLDataSet;
    CAD_SQ_C_PAR_CTR: TSQLDataSet;
    CAD_SQ_C_PAR_MOD: TSQLDataSet;
    CAD_SQ_C_PAR_SER: TSQLDataSet;
    CMP_SQ_M_SOL: TSQLDataSet;
    CMP_SQ_M_SOL_ITE: TSQLDataSet;
    CMP_SQ_M_COT: TSQLDataSet;
    CMP_SQ_M_COT_ITE: TSQLDataSet;
    CMP_SQ_M_COT_FOR: TSQLDataSet;
    CMP_SQ_M_COT_FIT: TSQLDataSet;
    CMP_SQ_M_PED: TSQLDataSet;
    CMP_SQ_M_PED_ITE: TSQLDataSet;
    FAT_SQ_M_PED: TSQLDataSet;
    FAT_SQ_M_PED_ITE: TSQLDataSet;
    FAT_SQ_M_PED_TIT: TSQLDataSet;
    FAT_SQ_M_NFE: TSQLDataSet;
    FAT_SQ_M_NFE_ITE: TSQLDataSet;
    FAT_SQ_M_NFE_TIT: TSQLDataSet;
    FAT_SQ_M_IQM_ITE_ANA: TSQLDataSet;
    FAT_SQ_M_NFE_DEV: TSQLDataSet;
    FAT_SQ_M_NFE_DEV_ITE: TSQLDataSet;
    FAT_SQ_M_POS: TSQLDataSet;
    FAT_SQ_M_POS_ITE: TSQLDataSet;
    FAT_SQ_M_ORC: TSQLDataSet;
    FAT_SQ_M_ORC_ITE: TSQLDataSet;
    FIN_SQ_M_COB: TSQLDataSet;
    FIN_SQ_M_COB_TIT: TSQLDataSet;
    FIN_SQ_M_PAG: TSQLDataSet;
    FIN_SQ_M_REC: TSQLDataSet;
    FIN_SQ_M_RCR: TSQLDataSet;
    FIN_SQ_M_RBX: TSQLDataSet;
    FIN_SQ_M_RBX_TIT: TSQLDataSet;
    FIN_SQ_M_RBX_GER: TSQLDataSet;
    FIN_SQ_M_CXA: TSQLDataSet;
    FIN_SQ_M_CTA: TSQLDataSet;
    PCP_SQ_C_CDR: TSQLDataSet;
    PCP_SQ_C_CNF: TSQLDataSet;
    PCP_SQ_C_CRG: TSQLDataSet;
    PCP_SQ_C_DIS: TSQLDataSet;
    PCP_SQ_C_ESP: TSQLDataSet;
    PCP_SQ_C_LME: TSQLDataSet;
    PCP_SQ_C_LME_DOC: TSQLDataSet;
    PCP_SQ_C_LME_DPG: TSQLDataSet;
    PCP_SQ_C_LME_DRP: TSQLDataSet;
    PCP_SQ_C_LME_DRV: TSQLDataSet;
    PCP_SQ_C_MTA: TSQLDataSet;
    PCP_SQ_C_REG: TSQLDataSet;
    PCP_SQ_C_ROT: TSQLDataSet;
    PCP_SQ_C_TLM: TSQLDataSet;
    PCP_SQ_C_PRQ: TSQLDataSet;
    PCP_SQ_C_PRQ_ESP: TSQLDataSet;
    PCP_SQ_C_CDP: TSQLDataSet;
    PCP_SQ_C_MDE: TSQLDataSet;
    PCP_SQ_C_MEQ: TSQLDataSet;
    PCP_SQ_C_PRP: TSQLDataSet;
    PCP_SQ_C_RPT: TSQLDataSet;
    PCP_SQ_C_TPP: TSQLDataSet;
    PCP_SQ_C_TPP_SET: TSQLDataSet;
    PCP_SQ_C_TIN: TSQLDataSet;
    PCP_SQ_C_INS: TSQLDataSet;
    PCP_SQ_C_CIN: TSQLDataSet;
    PCP_SQ_C_CIN_LNS: TSQLDataSet;
    PCP_SQ_M_VVE: TSQLDataSet;
    CAD_SQ_C_ALM: TSQLDataSet;
    EST_SQ_M_FEA: TSQLDataSet;
    EST_SQ_M_FES: TSQLDataSet;
    PCP_SQ_M_ACR: TSQLDataSet;
    PCP_SQ_M_ACR_ITE: TSQLDataSet;
    PCP_SQ_M_ACR_ITE_PCN: TSQLDataSet;
    PCP_SQ_M_ACR_ITE_PDT: TSQLDataSet;
    PCP_SQ_M_ACR_ITE_PCR: TSQLDataSet;
    PCP_SQ_M_OPR: TSQLDataSet;
    PCP_SQ_M_OPR_OPP: TSQLDataSet;
    PCP_SQ_M_OPR_IPA: TSQLDataSet;
    PCP_SQ_M_OPR_PED: TSQLDataSet;
    PCP_SQ_M_OPR_OPS: TSQLDataSet;
    PCP_SQ_M_OPR_OPS_IPS: TSQLDataSet;
    PCP_SQ_M_OPB: TSQLDataSet;
    PCP_SQ_M_OPB_OPE: TSQLDataSet;
    PCP_SQ_M_OPB_OPE_IBE: TSQLDataSet;
    PCP_SQ_M_CRP: TSQLDataSet;
    PCP_SQ_M_CRP_ITE: TSQLDataSet;
    PCP_SQ_M_CRP_ITE_BXI: TSQLDataSet;
    PCP_SQ_M_LBE: TSQLDataSet;
    PCP_SQ_M_LBE_BLO: TSQLDataSet;
    PCP_SQ_M_NCF: TSQLDataSet;
    PCP_SQ_M_NCF_DIS: TSQLDataSet;
    PCP_SQ_M_CAC: TSQLDataSet;
    PCP_SQ_M_CAC_ANA: TSQLDataSet;
    PCP_SQ_M_CAC_PLA: TSQLDataSet;
    PCP_SQ_M_CME: TSQLDataSet;
    PCP_SQ_M_CME_MEQ: TSQLDataSet;
    PCP_SQ_M_CRQ: TSQLDataSet;
    PCP_SQ_M_CRQ_REG: TSQLDataSet;
    PCP_SQ_M_LPR: TSQLDataSet;
    PCP_SQ_M_LPR_FUN: TSQLDataSet;
    PCP_SQ_M_MCP: TSQLDataSet;
    PCP_SQ_M_MCP_SER: TSQLDataSet;
    PCP_SQ_M_MCP_IVE: TSQLDataSet;
    PCP_SQ_M_RVC: TSQLDataSet;
    PCP_SQ_M_RVC_ITE: TSQLDataSet;
    PCP_SQ_M_RVC_ITE_SET: TSQLDataSet;
    PCP_SQ_M_RVC_ITE_SET_DEF: TSQLDataSet;
    PCP_SQ_M_ACR_ITE_PRC: TSQLDataSet;
    BUS_SQ_C_PAR_SER: TSQLDataSet;
    BUS_SQ_M_NFE_NFF: TSQLDataSet;
    BUS_SQ_C_TRI_REG: TSQLDataSet;
    BUS_SQ_M_NFE: TSQLDataSet;
    BUS_SQ_C_ITE_PRE: TSQLDataSet;
    BUS_SQ_M_POS: TSQLDataSet;
    qryBusca: TSQLQuery;
    EST_SQ_M_FES_ALM: TSQLDataSet;
    EST_DP_M_FES_ALM: TDataSetProvider;
    CAD_SQ_C_TAM: TSQLDataSet;
    CAD_DP_C_TAM: TDataSetProvider;
    FAT_SQ_M_PED_TITid_pedido: TIntegerField;
    FAT_SQ_M_PED_TITid_titulo: TIntegerField;
    FAT_SQ_M_PED_TITdias: TIntegerField;
    FAT_SQ_M_PED_TITdta_vencimento: TDateField;
    FAT_SQ_M_PED_TITvlr_titulo: TFMTBCDField;
    FAT_SQ_M_PED_TITche_banco: TWideStringField;
    FAT_SQ_M_PED_TITche_agencia: TWideStringField;
    FAT_SQ_M_PED_TITche_conta: TIntegerField;
    FAT_SQ_M_PED_TITche_numero: TIntegerField;
    FAT_SQ_M_PED_TITche_emitente: TWideStringField;
    FAT_SQ_M_PED_TITid_forma_pag: TIntegerField;
    FAT_SQ_M_PED_TITbol_nosso_numero: TIntegerField;
    FAT_SQ_M_NFEid_fiscal: TIntegerField;
    FAT_SQ_M_NFEid_almoxarifado: TIntegerField;
    FAT_SQ_M_NFEid_pedido_compra: TIntegerField;
    FAT_SQ_M_NFEid_condicao_pag: TIntegerField;
    FAT_SQ_M_NFEid_empresa: TIntegerField;
    FAT_SQ_M_NFEid_emitente: TIntegerField;
    FAT_SQ_M_NFEid_cfo: TWideStringField;
    FAT_SQ_M_NFEid_transportadora: TIntegerField;
    FAT_SQ_M_NFEid_tipo_mov_estoque: TIntegerField;
    FAT_SQ_M_NFEuf_emitente: TWideStringField;
    FAT_SQ_M_NFEuf_empresa: TWideStringField;
    FAT_SQ_M_NFEdta_emissao: TDateField;
    FAT_SQ_M_NFEdta_documento: TDateField;
    FAT_SQ_M_NFEcpf_cnpj: TWideStringField;
    FAT_SQ_M_NFEnumero: TIntegerField;
    FAT_SQ_M_NFEserie: TWideStringField;
    FAT_SQ_M_NFEsub_serie: TWideStringField;
    FAT_SQ_M_NFEmodelo: TWideStringField;
    FAT_SQ_M_NFEstatus: TIntegerField;
    FAT_SQ_M_NFEnfe_ecf: TIntegerField;
    FAT_SQ_M_NFEecf_prevenda: TIntegerField;
    FAT_SQ_M_NFEid_fiscal_referenciado: TIntegerField;
    FAT_SQ_M_NFEcanc_motivo: TWideStringField;
    FAT_SQ_M_NFEcanc_data: TDateField;
    FAT_SQ_M_NFEpeso_liquido: TFloatField;
    FAT_SQ_M_NFEpeso_bruto: TFloatField;
    FAT_SQ_M_NFEnfe_chave: TWideStringField;
    FAT_SQ_M_NFEnfe_obs: TWideStringField;
    FAT_SQ_M_NFEnfe_protocolo: TWideStringField;
    FAT_SQ_M_NFEnfe_recibo: TWideStringField;
    FAT_SQ_M_NFEnfe_canc_protocolo: TWideStringField;
    FAT_SQ_M_NFEnfe_canc_status: TWideStringField;
    FAT_SQ_M_NFEnfe_tipo_emissao: TWideStringField;
    FAT_SQ_M_NFEnfe_tipo_ambiente: TWideStringField;
    FAT_SQ_M_NFEnfe_cod_sit: TWideStringField;
    FAT_SQ_M_NFEind_operacao: TIntegerField;
    FAT_SQ_M_NFEind_emitente: TIntegerField;
    FAT_SQ_M_NFEind_frete: TIntegerField;
    FAT_SQ_M_NFEvlr_mercadoria: TFMTBCDField;
    FAT_SQ_M_NFEvlr_desconto: TFMTBCDField;
    FAT_SQ_M_NFEvlr_acrescimo: TFMTBCDField;
    FAT_SQ_M_NFEvlr_liquido: TFMTBCDField;
    FAT_SQ_M_NFEicm_n_valor: TFMTBCDField;
    FAT_SQ_M_NFEicm_n_base: TFMTBCDField;
    FAT_SQ_M_NFEicm_s_valor: TFMTBCDField;
    FAT_SQ_M_NFEicm_s_base: TFMTBCDField;
    FAT_SQ_M_NFEipi_base: TFMTBCDField;
    FAT_SQ_M_NFEipi_valor: TFMTBCDField;
    FAT_SQ_M_NFEiss_base: TFMTBCDField;
    FAT_SQ_M_NFEiss_valor: TFMTBCDField;
    FAT_SQ_M_NFEfre_base: TFMTBCDField;
    FAT_SQ_M_NFEfre_valor: TFMTBCDField;
    FAT_SQ_M_NFEpis_valor: TFMTBCDField;
    FAT_SQ_M_NFEpis_valor_st: TFMTBCDField;
    FAT_SQ_M_NFEcof_valor: TFMTBCDField;
    FAT_SQ_M_NFEcof_valor_st: TFMTBCDField;
    FAT_SQ_M_NFEvlr_isenta: TFMTBCDField;
    FAT_SQ_M_NFEvlr_outras: TFMTBCDField;
    FAT_SQ_M_NFEvlr_seguro: TFMTBCDField;
    FAT_SQ_M_NFEtipo_nf: TWideStringField;
    FAT_SQ_M_NFEecf_serial_impressora: TWideStringField;
    FAT_SQ_M_NFEecf_marca_impressora: TWideStringField;
    FAT_SQ_M_NFEecf_modelo_impressora: TWideStringField;
    FAT_SQ_M_NFEecf_caixa: TWideStringField;
    FAT_SQ_M_NFEdta_movimento: TDateField;
    FAT_SQ_M_NFEorigem_nf: TWideStringField;
    FAT_SQ_M_NFEfaturada: TBooleanField;
    FAT_SQ_M_NFEsituacao_inspecao: TIntegerField;
    FAT_SQ_M_NFEid_fiscal_frete: TIntegerField;
    FAT_SQ_M_NFEid_pedido_venda: TIntegerField;
    FAT_SQ_M_NFEvlr_outras_desp: TFMTBCDField;
    FAT_SQ_M_NFEfre_custo: TFMTBCDField;
    FAT_SQ_M_NFEvlr_icm_ser_nao_incide: TFMTBCDField;
    FAT_SQ_M_NFEcof_base: TFMTBCDField;
    FAT_SQ_M_NFEpis_base: TFMTBCDField;
    FAT_SQ_M_NFEposvenda: TBooleanField;
    FAT_SQ_M_NFEid_responsavel: TIntegerField;
    FAT_SQ_M_NFEint_id_perfil_cli: TIntegerField;
    FAT_SQ_M_NFE_ITEid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_NFE_ITEid_item: TIntegerField;
    FAT_SQ_M_NFE_ITEid_inf_fisco: TIntegerField;
    FAT_SQ_M_NFE_ITEid_cfo: TWideStringField;
    FAT_SQ_M_NFE_ITEid_st_icm: TWideStringField;
    FAT_SQ_M_NFE_ITEqtde: TFloatField;
    FAT_SQ_M_NFE_ITEqtde_devolvida: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_mercadoria: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_desconto: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_desconto: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_custo: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_liquido: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_outras: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_isenta: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_seguro: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_n_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEicm_per_reducao: TFloatField;
    FAT_SQ_M_NFE_ITEicm_n_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_n_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_s_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_s_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEipi_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEipi_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEipi_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEiss_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEiss_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEiss_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfre_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfre_percentual: TFloatField;
    FAT_SQ_M_NFE_ITEfre_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEpis_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEpis_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEpis_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEcof_base: TFMTBCDField;
    FAT_SQ_M_NFE_ITEcof_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEcof_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEpeso_liquido: TFloatField;
    FAT_SQ_M_NFE_ITEpeso_bruto: TFloatField;
    FAT_SQ_M_NFE_ITEnro_pedido: TIntegerField;
    FAT_SQ_M_NFE_ITEcof_valor_st: TFMTBCDField;
    FAT_SQ_M_NFE_ITEimp_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_icm_ser_nao_incide: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_outras_desp: TFMTBCDField;
    FAT_SQ_M_NFE_ITEpis_valor_st: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_n_dif_aliq: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_n_vlr_dif_aliq: TFMTBCDField;
    FAT_SQ_M_NFE_ITEpara_analise_raa: TIntegerField;
    FAT_SQ_M_NFE_ITEfre_dif_aliq_icm: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfre_vlr_dif_icm: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfre_custo: TFMTBCDField;
    FAT_SQ_M_NFE_ITEorigem_mercadoria: TWideStringField;
    FAT_SQ_M_NFE_ITEid_cor: TIntegerField;
    FAT_SQ_M_NFE_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_NFE_ITEint_desc_item: TWideStringField;
    FAT_SQ_M_NFE_ITEint_und_venda: TWideStringField;
    FAT_SQ_M_NFE_TITid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_TITid_nfe_tit: TIntegerField;
    FAT_SQ_M_NFE_TITid_forma_pag: TIntegerField;
    FAT_SQ_M_NFE_TITnum_parcela: TWideStringField;
    FAT_SQ_M_NFE_TITdias: TIntegerField;
    FAT_SQ_M_NFE_TITdta_vencimento: TDateField;
    FAT_SQ_M_NFE_TITvlr_titulo: TFMTBCDField;
    FAT_SQ_M_NFE_TITid_plano: TWideStringField;
    FAT_SQ_M_NFE_TITid_ccusto: TIntegerField;
    FAT_SQ_M_NFE_TITche_banco: TWideStringField;
    FAT_SQ_M_NFE_TITche_agencia: TWideStringField;
    FAT_SQ_M_NFE_TITche_conta: TIntegerField;
    FAT_SQ_M_NFE_TITche_numero: TIntegerField;
    FAT_SQ_M_NFE_TITche_emitente: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAid_sequencia: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAnum_plano_acao: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAdta_emissao: TDateField;
    FAT_SQ_M_IQM_ITE_ANAid_item: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAespecificado: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAencontrado: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAobservacao: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAqtde_nc: TFloatField;
    FAT_SQ_M_IQM_ITE_ANAqtde_total: TFloatField;
    FAT_SQ_M_IQM_ITE_ANAperc_nc: TFloatField;
    FAT_SQ_M_IQM_ITE_ANAqtde_devolvida: TFloatField;
    FAT_SQ_M_IQM_ITE_ANAid_responsavel: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAid_setor: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAcausa_do_problema_forn: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAresolucao_problema_forn: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAresponsavel_forn: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAcargo_resp_forn: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAdata_inf_forn: TDateField;
    FAT_SQ_M_IQM_ITE_ANAacao_tomada_analise: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAnao_conform_analise: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANArequer_nova_acao_analise: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAcomentarios_analise: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAid_resp_analise: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAdata_analise: TDateField;
    EST_SQ_M_FESid_item: TIntegerField;
    EST_SQ_M_FESid_empresa: TIntegerField;
    EST_SQ_M_FESdata_ult_movimento: TDateField;
    EST_SQ_M_FESdata_ult_inventario: TDateField;
    EST_SQ_M_FESqtde_entrada: TFloatField;
    EST_SQ_M_FESqtde_saida: TFloatField;
    EST_SQ_M_FESsaldo_fisico: TFloatField;
    EST_SQ_M_FESqtde_ped_compra: TFloatField;
    EST_SQ_M_FESqtde_ped_venda: TFloatField;
    EST_SQ_M_FESvlr_custo_medio: TFMTBCDField;
    EST_SQ_M_FESvlr_custo_ult_compra: TFMTBCDField;
    EST_SQ_M_FESid_cor: TIntegerField;
    EST_SQ_M_FESid_tamanho: TIntegerField;
    EST_SQ_M_FEAid_fea: TIntegerField;
    EST_SQ_M_FEAid_item: TIntegerField;
    EST_SQ_M_FEAid_empresa: TIntegerField;
    EST_SQ_M_FEAdata: TDateField;
    EST_SQ_M_FEAdocumento: TIntegerField;
    EST_SQ_M_FEAid_tipo_mov_estoque: TIntegerField;
    EST_SQ_M_FEAid_fiscal: TIntegerField;
    EST_SQ_M_FEAorigem: TIntegerField;
    EST_SQ_M_FEAid_almoxarifado: TIntegerField;
    EST_SQ_M_FEAid_mal: TIntegerField;
    EST_SQ_M_FEAqtde: TFloatField;
    EST_SQ_M_FEAper_desconto: TFloatField;
    EST_SQ_M_FEAper_frete: TFloatField;
    EST_SQ_M_FEAvlr_desconto: TFMTBCDField;
    EST_SQ_M_FEAvlr_frete: TFMTBCDField;
    EST_SQ_M_FEAvlr_custo: TFMTBCDField;
    EST_SQ_M_FEAvlr_bruto: TFMTBCDField;
    EST_SQ_M_FEAvlr_movimento: TFMTBCDField;
    EST_SQ_M_FEAid_cor: TIntegerField;
    EST_SQ_M_FEAid_tamanho: TIntegerField;
    EST_SQ_M_FEAid_seq_item: TIntegerField;
    EST_SQ_M_FEAid_pedido: TIntegerField;
    CAD_SQ_C_PARid_empresa: TIntegerField;
    CAD_SQ_C_PARemp_cnpj: TWideStringField;
    CAD_SQ_C_PARid_ramo: TIntegerField;
    CAD_SQ_C_PARemp_razao: TWideStringField;
    CAD_SQ_C_PARemp_endereco: TWideStringField;
    CAD_SQ_C_PARemp_numero: TWideStringField;
    CAD_SQ_C_PARemp_complemento: TWideStringField;
    CAD_SQ_C_PARemp_bairro: TWideStringField;
    CAD_SQ_C_PARid_cidade: TWideStringField;
    CAD_SQ_C_PARemp_cep: TWideStringField;
    CAD_SQ_C_PARemp_telefone: TWideStringField;
    CAD_SQ_C_PARemp_fax: TWideStringField;
    CAD_SQ_C_PARemp_email: TWideStringField;
    CAD_SQ_C_PARemp_site: TWideStringField;
    CAD_SQ_C_PARemp_fantasia: TWideStringField;
    CAD_SQ_C_PARemp_im: TWideStringField;
    CAD_SQ_C_PARemp_ie: TWideStringField;
    CAD_SQ_C_PARemp_suframa: TWideStringField;
    CAD_SQ_C_PARemp_numero_junta: TWideStringField;
    CAD_SQ_C_PARres_nome: TWideStringField;
    CAD_SQ_C_PARres_qualificacao: TWideStringField;
    CAD_SQ_C_PARres_cpf: TWideStringField;
    CAD_SQ_C_PARres_cep: TWideStringField;
    CAD_SQ_C_PARres_endereco: TWideStringField;
    CAD_SQ_C_PARres_numero: TWideStringField;
    CAD_SQ_C_PARres_complemento: TWideStringField;
    CAD_SQ_C_PARres_bairro: TWideStringField;
    CAD_SQ_C_PARres_cp: TWideStringField;
    CAD_SQ_C_PARres_telefone: TWideStringField;
    CAD_SQ_C_PARres_fax: TWideStringField;
    CAD_SQ_C_PARres_email: TWideStringField;
    CAD_SQ_C_PARcnt_nome: TWideStringField;
    CAD_SQ_C_PARcnt_cpf: TWideStringField;
    CAD_SQ_C_PARcnt_crc: TWideStringField;
    CAD_SQ_C_PARcnt_cnpj: TWideStringField;
    CAD_SQ_C_PARcnt_cep: TWideStringField;
    CAD_SQ_C_PARcnt_endereco: TWideStringField;
    CAD_SQ_C_PARcnt_numero: TWideStringField;
    CAD_SQ_C_PARcnt_complemento: TWideStringField;
    CAD_SQ_C_PARcnt_bairro: TWideStringField;
    CAD_SQ_C_PARcnt_telefone: TWideStringField;
    CAD_SQ_C_PARcnt_fax: TWideStringField;
    CAD_SQ_C_PARcnt_email: TWideStringField;
    CAD_SQ_C_PARcnt_id_cidade: TWideStringField;
    CAD_SQ_C_PARcnt_qualificacao: TWideStringField;
    CAD_SQ_C_PARcnt_cp: TWideStringField;
    CAD_SQ_C_PARint_uf: TWideStringField;
    CAD_SQ_C_PARint_reg_tributario: TIntegerField;
    CAD_SQ_C_PAR_SERid_empresa: TIntegerField;
    CAD_SQ_C_PAR_SERnfe_serie: TWideStringField;
    CAD_SQ_C_PAR_SERnfe_numero: TIntegerField;
    FAT_SQ_M_ORCid_orcamento: TIntegerField;
    FAT_SQ_M_ORCid_empresa: TIntegerField;
    FAT_SQ_M_ORCid_cliente: TIntegerField;
    FAT_SQ_M_ORCdta_orcamento: TDateField;
    FAT_SQ_M_ORCid_funcionario: TIntegerField;
    FAT_SQ_M_ORCdta_entrega: TDateField;
    FAT_SQ_M_ORCdta_validade: TDateField;
    FAT_SQ_M_ORCid_forma_pag: TIntegerField;
    FAT_SQ_M_ORCid_condicao_pag: TIntegerField;
    FAT_SQ_M_ORCobs: TWideStringField;
    FAT_SQ_M_ORCstatus: TIntegerField;
    FAT_SQ_M_ORCid_pedido: TIntegerField;
    FAT_SQ_M_ORCvlr_servicos_bru: TFMTBCDField;
    FAT_SQ_M_ORCvlr_produtos_bru: TFMTBCDField;
    FAT_SQ_M_ORCvlr_desconto_pro: TFMTBCDField;
    FAT_SQ_M_ORCvlr_desconto_ser: TFMTBCDField;
    FAT_SQ_M_ORCvlr_servicos_liq: TFMTBCDField;
    FAT_SQ_M_ORCvlr_produtos_liq: TFMTBCDField;
    FAT_SQ_M_ORCvlr_total: TFMTBCDField;
    FAT_SQ_M_ORCint_nomecli: TWideStringField;
    FAT_SQ_M_ORCint_nomefun: TWideStringField;
    FAT_SQ_M_ORCint_nomecpg: TWideStringField;
    FAT_SQ_M_ORCint_nomefpg: TWideStringField;
    FAT_SQ_M_ORCint_id_perfil: TIntegerField;
    FAT_SQ_M_ORC_ITEid_orcamento: TIntegerField;
    FAT_SQ_M_ORC_ITEid_item: TIntegerField;
    FAT_SQ_M_ORC_ITEqtde: TFloatField;
    FAT_SQ_M_ORC_ITEvlr_unitario: TFMTBCDField;
    FAT_SQ_M_ORC_ITEvlr_bruto: TFMTBCDField;
    FAT_SQ_M_ORC_ITEvlr_desconto: TFMTBCDField;
    FAT_SQ_M_ORC_ITEper_desconto: TFMTBCDField;
    FAT_SQ_M_ORC_ITEvlr_liquido: TFMTBCDField;
    FAT_SQ_M_ORC_ITEid_seq_item: TIntegerField;
    FAT_SQ_M_ORC_ITEid_busca_item: TWideStringField;
    FAT_SQ_M_ORC_ITEid_cor: TIntegerField;
    FAT_SQ_M_ORC_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_ORC_ITEint_descitem: TWideStringField;
    FAT_SQ_M_ORC_ITEint_unidade: TWideStringField;
    CAD_SQ_C_CNEid_cnae: TWideStringField;
    CAD_SQ_C_CNEdescricao: TWideStringField;
    CAD_SQ_C_CIDid_cidade: TWideStringField;
    CAD_SQ_C_CIDnome: TWideStringField;
    CAD_SQ_C_CIDuf: TWideStringField;
    CAD_SQ_C_CIDcep: TWideStringField;
    CAD_SQ_C_RAMid_ramo: TIntegerField;
    CAD_SQ_C_RAMid_cnae: TWideStringField;
    CAD_SQ_C_RAMdescricao: TWideStringField;
    CAD_SQ_C_RAMregime_tributario: TIntegerField;
    CAD_SQ_C_CINid_cli_informa: TIntegerField;
    CAD_SQ_C_CINdescricao: TWideStringField;
    PCP_SQ_C_PRQid_grupo: TWideStringField;
    PCP_SQ_C_PRQid_item: TIntegerField;
    PCP_SQ_C_PRQid_responsavel: TIntegerField;
    PCP_SQ_C_PRQdta_cadastro: TDateField;
    CAD_SQ_C_SETid_setor: TIntegerField;
    CAD_SQ_C_SETdescricao: TWideStringField;
    CAD_SQ_C_SETlote_controla: TBooleanField;
    CAD_SQ_C_SETtipo: TIntegerField;
    CAD_SQ_C_SET_TDSid_setor: TIntegerField;
    CAD_SQ_C_SET_TDSid_tdf: TIntegerField;
    PCP_SQ_C_CDPid_item: TIntegerField;
    PCP_SQ_C_CDPdta_lancamento: TDateField;
    PCP_SQ_C_CDPmed_comp_01: TFloatField;
    PCP_SQ_C_CDPmed_comp_02: TFloatField;
    PCP_SQ_C_CDPmed_comp_03: TFloatField;
    PCP_SQ_C_CDPmed_comp_media: TFloatField;
    PCP_SQ_C_CDPmed_largura_01: TFloatField;
    PCP_SQ_C_CDPmed_largura_02: TFloatField;
    PCP_SQ_C_CDPmed_largura_03: TFloatField;
    PCP_SQ_C_CDPmed_largura_media: TFloatField;
    PCP_SQ_C_CDPmed_altura_01: TFloatField;
    PCP_SQ_C_CDPmed_altura_02: TFloatField;
    PCP_SQ_C_CDPmed_altura_03: TFloatField;
    PCP_SQ_C_CDPmed_altura_media: TFloatField;
    PCP_SQ_C_CDPsituacao: TBooleanField;
    PCP_SQ_C_CDPint_nomeite: TWideStringField;
    PCP_SQ_C_CDRid_cdr: TIntegerField;
    PCP_SQ_C_CDRid_grupo: TWideStringField;
    PCP_SQ_C_CDRid_cor_grupo: TIntegerField;
    PCP_SQ_C_CDRtipo_cadarco: TIntegerField;
    PCP_SQ_C_CDRid_cor_cadarco: TIntegerField;
    PCP_SQ_C_CDRint_nomegru: TWideStringField;
    PCP_SQ_C_CDRint_nomecoc: TWideStringField;
    PCP_SQ_C_CDRint_nomecog: TWideStringField;
    PCP_SQ_C_CRGid_cargo: TIntegerField;
    PCP_SQ_C_CRGid_setor: TIntegerField;
    PCP_SQ_C_CRGdescricao: TWideStringField;
    PCP_SQ_C_CRGobjetivo_cargo: TWideStringField;
    PCP_SQ_C_CRGatribuicoes: TWideStringField;
    PCP_SQ_C_CRGrequisitos: TWideStringField;
    PCP_SQ_C_CRGdata_aprovacao: TDateField;
    PCP_SQ_C_CRGint_nomeset: TWideStringField;
    PCP_SQ_M_CRQid_crq: TIntegerField;
    PCP_SQ_M_CRQid_empresa: TIntegerField;
    PCP_SQ_M_CRQid_responsavel: TIntegerField;
    PCP_SQ_M_CRQdta_criacao: TDateField;
    PCP_SQ_M_CRQdta_atualizacao: TDateField;
    PCP_SQ_M_CRQobservacao: TWideStringField;
    PCP_SQ_M_CRQint_nomeres: TWideStringField;
    PCP_SQ_M_CRQ_REGid_crq: TIntegerField;
    PCP_SQ_M_CRQ_REGid_lme_d: TIntegerField;
    PCP_SQ_M_CRQ_REGid_setor: TIntegerField;
    PCP_SQ_M_CRQ_REGforma: TIntegerField;
    PCP_SQ_M_CRQ_REGindexacao: TIntegerField;
    PCP_SQ_M_CRQ_REGmetodo_recuperacao: TIntegerField;
    PCP_SQ_M_CRQ_REGtempo_retencao: TIntegerField;
    PCP_SQ_M_CRQ_REGdisposicao_tempo: TIntegerField;
    PCP_SQ_M_CRQ_REGdta_cadastro: TDateField;
    PCP_SQ_M_CRQ_REGint_nomeset: TWideStringField;
    CAD_SQ_C_RAMint_nomecne: TWideStringField;
    PCP_SQ_M_CRQ_REGint_nomelme: TWideStringField;
    CAD_SQ_C_GRUid_grupo: TWideStringField;
    CAD_SQ_C_GRUdescricao: TWideStringField;
    CAD_SQ_C_GRUorigem_mercadoria: TWideStringField;
    CAD_SQ_C_GRUtipo: TIntegerField;
    CAD_SQ_C_GRUnivel: TIntegerField;
    CAD_SQ_C_GRUtipo_item: TWideStringField;
    CAD_SQ_C_GRUid_tributo: TIntegerField;
    CAD_SQ_C_GRUpromo_ativa: TBooleanField;
    CAD_SQ_C_GRUpromo_perc: TFloatField;
    CAD_SQ_C_GRUali_interna_icms: TFloatField;
    CAD_SQ_C_GRUdesc_ativa: TBooleanField;
    CAD_SQ_C_GRUdesc_perc: TFloatField;
    CAD_SQ_C_GRUint_nometri: TWideStringField;
    CAD_SQ_C_CFOid_cfo: TWideStringField;
    CAD_SQ_C_CFOid_classe: TWideStringField;
    CAD_SQ_C_CFOint_nomenat: TWideStringField;
    CAD_SQ_C_GRUper_ipi: TFloatField;
    EST_SQ_M_CTE: TSQLDataSet;
    EST_SQ_M_CTE_ITE: TSQLDataSet;
    EST_DP_M_CTE: TDataSetProvider;
    EST_DS_M_CTE: TDataSource;
    EST_SQ_M_CTEid_controle: TIntegerField;
    EST_SQ_M_CTEdta_contagem: TDateField;
    EST_SQ_M_CTEid_empresa: TIntegerField;
    EST_SQ_M_CTEobs: TWideStringField;
    EST_SQ_M_CTEcte_tipo: TIntegerField;
    EST_SQ_M_CTElocalizacao: TWideStringField;
    EST_SQ_M_CTEdta_movimento: TDateField;
    EST_SQ_M_CTE_ITEid_controle: TIntegerField;
    EST_SQ_M_CTE_ITEid_item: TIntegerField;
    EST_SQ_M_CTE_ITEid_cor: TIntegerField;
    EST_SQ_M_CTE_ITEid_tamanho: TIntegerField;
    EST_SQ_M_CTE_ITEnum_lote: TWideStringField;
    EST_SQ_M_CTE_ITEint_nomeite: TWideStringField;
    EST_SQ_M_CTE_ITEint_nomecor: TWideStringField;
    EST_SQ_M_CTE_ITEint_nometam: TWideStringField;
    EST_SQ_M_CTE_ITEint_nomeund: TWideStringField;
    FAT_SQ_M_PED_TITint_nomefpg: TWideStringField;
    CAD_SQ_C_TRIid_tributo: TIntegerField;
    CAD_SQ_C_TRIdescricao: TWideStringField;
    PCP_SQ_C_REGid_regiao: TIntegerField;
    PCP_SQ_C_REGdescricao: TWideStringField;
    PCP_SQ_C_REGid_rota: TIntegerField;
    PCP_SQ_C_REGint_nomerot: TWideStringField;
    PCP_SQ_C_PRPid_grupo: TWideStringField;
    PCP_SQ_C_PRPid_item: TIntegerField;
    PCP_SQ_C_PRPcaract_inspecionada: TWideStringField;
    PCP_SQ_C_PRPcriterio_aceitacao: TWideStringField;
    PCP_SQ_C_PRPmetodo_verificacao: TWideStringField;
    PCP_SQ_C_PRPamostragem: TWideStringField;
    PCP_SQ_C_PRPmanuseio_transporte: TWideStringField;
    PCP_SQ_C_PRParmazenamento: TWideStringField;
    PCP_SQ_C_PRPpreservacao: TWideStringField;
    PCP_SQ_C_PRPint_nomeite: TWideStringField;
    PCP_SQ_C_PRPint_nomegru: TWideStringField;
    CAD_SQ_C_ITEid_item: TIntegerField;
    CAD_SQ_C_ITEativo: TBooleanField;
    CAD_SQ_C_ITEcardapio: TBooleanField;
    CAD_SQ_C_ITEdescricao: TWideStringField;
    CAD_SQ_C_ITEreferencia: TWideStringField;
    CAD_SQ_C_ITEaplicacao: TWideStringField;
    CAD_SQ_C_ITEid_fornecedor: TIntegerField;
    CAD_SQ_C_ITEid_grupo: TWideStringField;
    CAD_SQ_C_ITEid_und_compra: TWideStringField;
    CAD_SQ_C_ITEid_und_venda: TWideStringField;
    CAD_SQ_C_ITEemb_compra: TFloatField;
    CAD_SQ_C_ITEemb_venda: TFloatField;
    CAD_SQ_C_ITEcod_barra: TWideStringField;
    CAD_SQ_C_ITEcod_fabrica: TWideStringField;
    CAD_SQ_C_ITEpes_liquido: TFloatField;
    CAD_SQ_C_ITEpes_bruto: TFloatField;
    CAD_SQ_C_ITEest_minimo: TFloatField;
    CAD_SQ_C_ITEtam_largura: TFloatField;
    CAD_SQ_C_ITEtam_comprimento: TFloatField;
    CAD_SQ_C_ITEtam_espessura: TFloatField;
    CAD_SQ_C_ITEdensidade: TIntegerField;
    CAD_SQ_C_ITEdensidade_2: TIntegerField;
    CAD_SQ_C_ITEdensidade_3: TIntegerField;
    CAD_SQ_C_ITEtipo: TIntegerField;
    CAD_SQ_C_ITEgeracao_lote_interno: TIntegerField;
    CAD_SQ_C_ITEdestino_reclamado: TIntegerField;
    CAD_SQ_C_ITEetiq_classificacao_pro: TIntegerField;
    CAD_SQ_C_ITEetiq_medidas: TWideStringField;
    CAD_SQ_C_ITEetiq_recomendacoes_1: TWideStringField;
    CAD_SQ_C_ITEetiq_recomendacoes_2: TWideStringField;
    CAD_SQ_C_ITElote_fabric_obrigatorio: TIntegerField;
    CAD_SQ_C_ITEid_ncm: TWideStringField;
    CAD_SQ_C_ITEPRECO_AVISTA: TFMTBCDField;
    CAD_SQ_C_ITEPRECO_APRAZO: TFMTBCDField;
    CAD_SQ_C_ITEint_nomencm: TWideStringField;
    CAD_SQ_C_ITEint_desc_grupo: TWideStringField;
    CAD_SQ_C_ITEint_tipo_item: TWideStringField;
    CAD_SQ_C_ITEint_origem: TWideStringField;
    CAD_SQ_C_ITEint_tributo: TIntegerField;
    CAD_SQ_C_ITEint_nomefor: TWideStringField;
    CAD_SQ_C_ITE_COMid_item: TIntegerField;
    CAD_SQ_C_ITE_COMid_materia_prima: TIntegerField;
    CAD_SQ_C_ITE_COMqtde: TFloatField;
    CAD_SQ_C_ITE_COMint_nomeite: TWideStringField;
    CAD_SQ_C_ITE_ESPid_item: TIntegerField;
    CAD_SQ_C_ITE_ESPid_especificacao: TIntegerField;
    CAD_SQ_C_ITE_ESPint_nomeesp: TWideStringField;
    EST_SQ_M_CTE_ITEid_busca_item: TWideStringField;
    EST_SQ_M_CTEid_almoxarifado: TIntegerField;
    EST_SQ_M_CTEint_nomealm: TWideStringField;
    EST_SQ_M_CTE_ITEcontagem: TFloatField;
    EST_SQ_M_CTE_ITEid_seq_item: TIntegerField;
    BUS_SQ_C_ITE_LOC: TSQLDataSet;
    BUS_DP_C_ITE_LOC: TDataSetProvider;
    EST_SQ_M_CTEper_inicial: TDateField;
    EST_SQ_M_CTEper_final: TDateField;
    PCP_SQ_C_PRQint_nomeite: TWideStringField;
    PCP_SQ_C_PRQint_nomegru: TWideStringField;
    PCP_SQ_C_PRQint_nomefun: TWideStringField;
    PCP_SQ_C_TPP_SETid_tpp: TIntegerField;
    PCP_SQ_C_TPP_SETid_setor: TIntegerField;
    PCP_SQ_C_TPP_SETgera_estoque: TBooleanField;
    PCP_SQ_C_TPP_SETgrava_nro_lote: TBooleanField;
    PCP_SQ_C_TPP_SETgera_nro_lote: TBooleanField;
    PCP_SQ_C_TPP_SETexecuta_servico: TBooleanField;
    PCP_SQ_C_TPP_SETint_nomeset: TWideStringField;
    PCP_SQ_C_TPPid_tpp: TIntegerField;
    PCP_SQ_C_TPPdescricao: TWideStringField;
    EST_DP_M_LOT: TDataSetProvider;
    EST_SQ_M_LOTid_item: TIntegerField;
    EST_SQ_M_LOTnum_lote: TWideStringField;
    EST_SQ_M_LOTid_empresa: TIntegerField;
    EST_SQ_M_LOTid_almoxarifado: TIntegerField;
    EST_SQ_M_LOTqtde_entrada: TFloatField;
    EST_SQ_M_LOTqtde_saida: TFloatField;
    EST_SQ_M_LOTqtde_atual: TFloatField;
    EST_SQ_M_LOTid_fiscal: TIntegerField;
    EST_SQ_M_LOTid_controle: TIntegerField;
    EST_SQ_M_LOTid_cor: TIntegerField;
    EST_SQ_M_LOTid_tamanho: TIntegerField;
    EST_SQ_M_LOTint_nomealm: TWideStringField;
    PCP_SQ_C_INSid_ins: TIntegerField;
    PCP_SQ_C_INSsigla: TWideStringField;
    PCP_SQ_C_INSid_mde: TIntegerField;
    PCP_SQ_C_INSid_fabricante: TIntegerField;
    PCP_SQ_C_INSnro_serie: TWideStringField;
    PCP_SQ_C_INSdta_cadastro: TDateField;
    PCP_SQ_C_INSresolucao_menor_divisao: TWideStringField;
    PCP_SQ_C_INSid_tin: TIntegerField;
    PCP_SQ_C_INSscala: TWideStringField;
    PCP_SQ_C_INSgarantia: TBooleanField;
    PCP_SQ_C_INSint_nomefab: TWideStringField;
    PCP_SQ_C_INSint_nomemde: TWideStringField;
    PCP_SQ_C_INSint_nometin: TWideStringField;
    PCP_SQ_M_RAA: TSQLDataSet;
    PCP_SQ_M_RAA_ITE: TSQLDataSet;
    PCP_DS_M_RAA: TDataSource;
    PCP_DP_M_RAA: TDataSetProvider;
    PCP_SQ_M_RAA_ITEid_raa: TIntegerField;
    PCP_SQ_M_RAA_ITEid_raa_ite: TIntegerField;
    PCP_SQ_M_RAA_ITEacao_necessaria: TWideStringField;
    PCP_SQ_M_RAA_ITEid_responsavel: TIntegerField;
    PCP_SQ_M_RAA_ITEdta_prazo: TDateField;
    PCP_SQ_M_RAA_ITEdta_executado: TDateField;
    PCP_SQ_M_RAA_ITEobservacao: TWideStringField;
    PCP_SQ_M_RAA_ITEint_nomeres: TWideStringField;
    PCP_DP_M_PSC: TDataSetProvider;
    PCP_SQ_M_PSC: TSQLDataSet;
    PCP_SQ_C_CIN_LNSid_cin: TIntegerField;
    PCP_SQ_C_CIN_LNSid_cin_lns: TIntegerField;
    PCP_SQ_C_CIN_LNSdta_cadastro: TDateField;
    PCP_SQ_C_CIN_LNSid_setor: TIntegerField;
    PCP_SQ_C_CIN_LNStolerancia_processo: TWideStringField;
    PCP_SQ_C_CIN_LNSfrequencia: TWideStringField;
    PCP_SQ_C_CIN_LNSid_responsavel: TIntegerField;
    PCP_SQ_C_CINid_cin: TIntegerField;
    PCP_SQ_C_CINid_ins: TIntegerField;
    PCP_SQ_C_CINrequer_calibracao: TIntegerField;
    PCP_SQ_C_CINsituacao_instrumento: TIntegerField;
    PCP_SQ_C_CINcert_erro_admissivel: TWideStringField;
    PCP_SQ_C_CINcert_num: TWideStringField;
    PCP_SQ_C_CINcert_id_fornecedor: TIntegerField;
    PCP_SQ_C_CINcert_id_resp_inspecao: TIntegerField;
    PCP_SQ_C_CINcert_dta_verificacao: TDateField;
    PCP_SQ_C_CINnum_seq: TIntegerField;
    PCP_SQ_C_CINtr_sit_encosto: TIntegerField;
    PCP_SQ_C_CINtr_sit_funcionamento: TIntegerField;
    PCP_SQ_C_CINtr_sit_escala: TIntegerField;
    PCP_SQ_C_CINtr_sit_aspecto_geral: TIntegerField;
    PCP_SQ_C_CINtr_sit_escala_padrao: TIntegerField;
    PCP_SQ_C_CINtr_resultado: TIntegerField;
    PCP_SQ_C_CINtr_sit_inspecao: TIntegerField;
    PCP_SQ_C_CINtr_id_resp_inspecao: TIntegerField;
    PCP_SQ_C_CINtr_dta_verificacao: TDateField;
    PCP_SQ_C_CINtr_reg_acao_tomada: TWideStringField;
    PCP_SQ_C_CINcal_efet_frequencia: TWideStringField;
    PCP_SQ_C_CINnumero_nfe: TIntegerField;
    PCP_SQ_C_CINhistorico_instrumento: TWideStringField;
    PCP_SQ_C_CINint_marca: TWideStringField;
    PCP_SQ_C_CINint_serie: TWideStringField;
    PCP_SQ_C_CINint_resolucao: TWideStringField;
    PCP_SQ_C_CINint_scala: TWideStringField;
    PCP_SQ_C_CINint_denominacao: TWideStringField;
    PCP_SQ_C_CINint_sigla: TWideStringField;
    PCP_SQ_C_CINint_modelo: TWideStringField;
    PCP_SQ_C_CIN_LNSint_nomeset: TWideStringField;
    PCP_SQ_C_CIN_LNSint_nomeres: TWideStringField;
    PCP_SQ_C_TINid_tin: TIntegerField;
    PCP_SQ_C_TINdescricao: TWideStringField;
    EST_SQ_M_CTE_ITEdiferenca: TFloatField;
    EST_SQ_M_CTE_ITEtipo_diferenca: TIntegerField;
    EST_SQ_M_CTE_ITEint_tipo_item: TIntegerField;
    EST_SQ_M_FEAid_controle: TIntegerField;
    EST_SQ_M_CTE_ITEvlr_custo: TFMTBCDField;
    EST_SQ_M_MAL: TSQLDataSet;
    EST_SQ_M_MAL_ITE: TSQLDataSet;
    EST_DS_M_MAL: TDataSource;
    EST_DP_M_MAL: TDataSetProvider;
    FAT_SQ_M_NFEint_nfeecf: TWideMemoField;
    FAT_SQ_M_NFEint_nometme: TWideStringField;
    FAT_SQ_M_NFEint_nomeope: TWideMemoField;
    FAT_SQ_M_NFEint_nomecpg: TWideStringField;
    FAT_SQ_M_NFEint_nomevnd: TWideStringField;
    FAT_SQ_M_NFEint_nomeres: TWideStringField;
    EST_SQ_M_CTEstatus: TIntegerField;
    FIN_SQ_M_COBid_controle: TIntegerField;
    FIN_SQ_M_COBdta_cobranca: TDateField;
    FIN_SQ_M_COBtipo_contato: TIntegerField;
    FIN_SQ_M_COBobservacao: TWideStringField;
    FIN_SQ_M_COBhor_cobranca: TSQLTimeStampField;
    FIN_SQ_M_COBacordo: TBooleanField;
    FIN_SQ_M_COBid_funcionario: TIntegerField;
    FIN_SQ_M_COBper_juros_negociado: TFMTBCDField;
    FIN_SQ_M_COBint_nomefun: TWideStringField;
    FIN_SQ_M_COBint_nomecli: TWideStringField;
    FIN_SQ_M_COBint_telfix: TWideStringField;
    FIN_SQ_M_COBint_telmov: TWideStringField;
    FIN_SQ_M_COBint_email: TWideStringField;
    FIN_SQ_M_COBid_cliente: TIntegerField;
    FIN_SQ_M_COBdta_acordo: TDateField;
    FIN_SQ_M_COBvlr_negociado: TFMTBCDField;
    BUS_SQ_M_NFE_ITE: TSQLDataSet;
    BUS_DP_M_NFE_ITE: TDataSetProvider;
    FIN_SQ_M_RECid_titulo: TIntegerField;
    FIN_SQ_M_RECid_empresa: TIntegerField;
    FIN_SQ_M_RECid_cliente: TIntegerField;
    FIN_SQ_M_RECnum_parcela: TWideStringField;
    FIN_SQ_M_RECdta_emissao: TDateField;
    FIN_SQ_M_REChistorico: TWideStringField;
    FIN_SQ_M_RECvlr_parcela: TFMTBCDField;
    FIN_SQ_M_RECvlr_original: TFMTBCDField;
    FIN_SQ_M_RECdta_vencimento: TDateField;
    FIN_SQ_M_RECdta_original: TDateField;
    FIN_SQ_M_RECvlr_saldo: TFMTBCDField;
    FIN_SQ_M_RECid_fiscal: TIntegerField;
    FIN_SQ_M_RECorigem: TIntegerField;
    FIN_SQ_M_RECid_forma_pag: TIntegerField;
    FIN_SQ_M_RECche_conta: TIntegerField;
    FIN_SQ_M_RECche_cheque: TIntegerField;
    FIN_SQ_M_RECche_banco: TWideStringField;
    FIN_SQ_M_RECche_emitente: TWideStringField;
    FIN_SQ_M_RECche_agencia: TWideStringField;
    FIN_SQ_M_RECtipo_lancamento: TIntegerField;
    FIN_SQ_M_RECid_local_titulo: TIntegerField;
    FIN_SQ_M_RECid_plano: TWideStringField;
    FIN_SQ_M_RECint_nomecli: TWideStringField;
    FIN_SQ_M_RECint_nomefpg: TWideStringField;
    FIN_SQ_M_RECint_nomelto: TWideStringField;
    FIN_SQ_M_RECint_nomepct: TWideStringField;
    FIN_SQ_M_RCRid_credito: TIntegerField;
    FIN_SQ_M_RCRid_empresa: TIntegerField;
    FIN_SQ_M_RCRorigem: TIntegerField;
    FIN_SQ_M_RCRnum_documento: TWideStringField;
    FIN_SQ_M_RCRvlr_credito: TFMTBCDField;
    FIN_SQ_M_RCRvlr_saldo: TFMTBCDField;
    FIN_SQ_M_RCRdta_credito: TDateField;
    FIN_SQ_M_RCRdeb_cre: TIntegerField;
    FIN_SQ_M_RCRid_cliente: TIntegerField;
    FIN_SQ_M_RCRhistorico: TWideStringField;
    FIN_SQ_M_RCRid_forma_pag: TIntegerField;
    FIN_SQ_M_RCRpre_conta: TIntegerField;
    FIN_SQ_M_RCRpre_cheque: TIntegerField;
    FIN_SQ_M_RCRpre_banco: TWideStringField;
    FIN_SQ_M_RCRpre_emitente: TWideStringField;
    FIN_SQ_M_RCRpre_agencia: TWideStringField;
    FIN_SQ_M_RCRid_conta: TIntegerField;
    FIN_SQ_M_RCRint_nomecli: TWideStringField;
    FIN_SQ_M_RCRint_nomefpg: TWideStringField;
    FIN_SQ_M_RCRint_nomectc: TWideStringField;
    FIN_SQ_M_COBstatus: TIntegerField;
    FIN_SQ_M_RCRcar_parcelas: TIntegerField;
    FIN_SQ_M_CTAid_controle: TIntegerField;
    FIN_SQ_M_CTAid_abertura: TIntegerField;
    FIN_SQ_M_CTAid_empresa: TIntegerField;
    FIN_SQ_M_CTAtipo_lancamento: TIntegerField;
    FIN_SQ_M_CTAdta_lancamento: TDateField;
    FIN_SQ_M_CTAnum_doc: TIntegerField;
    FIN_SQ_M_CTAid_plano: TWideStringField;
    FIN_SQ_M_CTAdeb_cre: TIntegerField;
    FIN_SQ_M_CTAhistorico: TWideStringField;
    FIN_SQ_M_CTAvlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CTAorigem: TIntegerField;
    FIN_SQ_M_CTAid_conta: TIntegerField;
    FIN_SQ_M_CTAid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTAconc_numero: TIntegerField;
    FIN_SQ_M_CTAconc_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTAconc_id_plano: TWideStringField;
    FIN_SQ_M_CTAconc_vlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CTAexp_id_controle: TIntegerField;
    FIN_SQ_M_CTAexp_id_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTAexp_id_plano: TWideStringField;
    FIN_SQ_M_CTAexp_id_conta: TIntegerField;
    FIN_SQ_M_CTAint_nomepct: TWideStringField;
    FIN_SQ_M_CTAint_nometif: TWideStringField;
    FIN_SQ_M_CTAint_nomectc: TWideStringField;
    PCP_SQ_C_CINcal_efet_proxima: TDateField;
    FIN_SQ_M_PAGid_titulo: TIntegerField;
    FIN_SQ_M_PAGid_empresa: TIntegerField;
    FIN_SQ_M_PAGid_fornecedor: TIntegerField;
    FIN_SQ_M_PAGnum_parcela: TWideStringField;
    FIN_SQ_M_PAGdta_emissao: TDateField;
    FIN_SQ_M_PAGhistorico: TWideStringField;
    FIN_SQ_M_PAGvlr_parcela: TFMTBCDField;
    FIN_SQ_M_PAGvlr_original: TFMTBCDField;
    FIN_SQ_M_PAGdta_vencimento: TDateField;
    FIN_SQ_M_PAGdta_original: TDateField;
    FIN_SQ_M_PAGvlr_saldo: TFMTBCDField;
    FIN_SQ_M_PAGid_fiscal: TIntegerField;
    FIN_SQ_M_PAGorigem: TIntegerField;
    FIN_SQ_M_PAGid_forma_pag: TIntegerField;
    FIN_SQ_M_PAGpre_conta: TIntegerField;
    FIN_SQ_M_PAGpre_cheque: TIntegerField;
    FIN_SQ_M_PAGpre_banco: TWideStringField;
    FIN_SQ_M_PAGpre_emitente: TWideStringField;
    FIN_SQ_M_PAGpre_agencia: TWideStringField;
    FIN_SQ_M_PAGtipo_lancamento: TIntegerField;
    FIN_SQ_M_PAGid_local_titulo: TIntegerField;
    FIN_SQ_M_PAGid_plano: TWideStringField;
    FIN_SQ_M_PAGint_nomefor: TWideStringField;
    FIN_SQ_M_PAGint_nomefpg: TWideStringField;
    FIN_SQ_M_PAGint_nomelto: TWideStringField;
    FIN_SQ_M_PAGint_nomepct: TWideStringField;
    FIN_SQ_M_RBXid_baixa: TIntegerField;
    FIN_SQ_M_RBXid_empresa: TIntegerField;
    FIN_SQ_M_RBXdta_baixa: TDateField;
    FIN_SQ_M_RBXvlr_baixa: TFMTBCDField;
    FIN_SQ_M_RBXobservacao: TWideStringField;
    FIN_SQ_M_RBXvlr_cred_utilizado: TFMTBCDField;
    FIN_SQ_M_RBXid_forma_pag: TIntegerField;
    FIN_SQ_M_RBXid_abertura: TIntegerField;
    FIN_SQ_M_RBXid_cliente: TIntegerField;
    FIN_SQ_M_RBXint_nomecli: TWideStringField;
    FIN_SQ_M_RBXint_nomefpg: TWideStringField;
    FIN_SQ_M_PBX: TSQLDataSet;
    FIN_SQ_M_PBX_TIT: TSQLDataSet;
    FIN_DP_M_PBX: TDataSetProvider;
    FIN_DS_M_PBX: TDataSource;
    FIN_SQ_M_PBXid_baixa: TIntegerField;
    FIN_SQ_M_PBXid_empresa: TIntegerField;
    FIN_SQ_M_PBXdta_baixa: TDateField;
    FIN_SQ_M_PBXvlr_baixa: TFMTBCDField;
    FIN_SQ_M_PBXobservacao: TWideStringField;
    FIN_SQ_M_PBXid_forma_pag: TIntegerField;
    FIN_SQ_M_PBXid_abertura: TIntegerField;
    FIN_SQ_M_PBXvlr_credito_utilizado: TFMTBCDField;
    FIN_SQ_M_PBXid_fornecedor: TIntegerField;
    FIN_SQ_M_PBXint_nomefor: TWideStringField;
    FIN_SQ_M_PBXint_nomefpg: TWideStringField;
    FAT_SQ_M_NFE_ITEid_busca_item: TWideStringField;
    FAT_SQ_M_NFE_TITint_nomefpg: TWideStringField;
    FAT_SQ_M_NFE_TITint_nomepct: TWideStringField;
    FAT_SQ_M_NFE_TITint_nomeccu: TWideStringField;
    FIN_SQ_M_PAGid_ccusto: TIntegerField;
    CAD_SQ_C_FPGid_forma_pag: TIntegerField;
    CAD_SQ_C_FPGdescricao: TWideStringField;
    CAD_SQ_C_FPGdoc_impresso: TIntegerField;
    CAD_SQ_C_FPGcar_deb_cre: TIntegerField;
    CAD_SQ_C_FPGcar_taxa: TFloatField;
    CAD_SQ_C_FPGcar_dia_pag: TIntegerField;
    CAD_SQ_C_FPGcar_conta: TIntegerField;
    CAD_SQ_C_FPGcar_telefone: TWideStringField;
    CAD_SQ_C_FPGcri_debi_cliente: TBooleanField;
    CAD_SQ_C_FPGven_id_plano: TWideStringField;
    CAD_SQ_C_FPGcom_id_plano: TWideStringField;
    CAD_SQ_C_FPGpag_id_plano_juros: TWideStringField;
    CAD_SQ_C_FPGpag_id_plano_desconto: TWideStringField;
    CAD_SQ_C_FPGrec_id_plano_juros: TWideStringField;
    CAD_SQ_C_FPGrec_id_plano_desconto: TWideStringField;
    CAD_SQ_C_FPGid_ccusto: TIntegerField;
    CAD_SQ_C_FPGid_tipo_financeiro: TIntegerField;
    CAD_SQ_C_FPGgera_caixa_banco: TBooleanField;
    CAD_SQ_C_FPGtipo_pagamento: TIntegerField;
    CAD_SQ_C_FPGid_local_titulo: TIntegerField;
    FAT_SQ_M_NFE_ITEid_tributo: TIntegerField;
    FAT_SQ_M_NFE_ITEnum_lote: TWideStringField;
    FAT_SQ_M_NFEid_vendedor: TIntegerField;
    PCP_SQ_M_PSCid_psc: TIntegerField;
    PCP_SQ_M_PSCid_empresa: TIntegerField;
    PCP_SQ_M_PSCnome_cliente: TWideStringField;
    PCP_SQ_M_PSCdata: TDateField;
    PCP_SQ_M_PSCcidade: TWideStringField;
    PCP_SQ_M_PSCestado: TWideStringField;
    PCP_SQ_M_PSCtelefone: TWideStringField;
    PCP_SQ_M_PSCcelular: TWideStringField;
    PCP_SQ_M_PSCobservacao: TWideStringField;
    PCP_SQ_M_PSCpergunta_1: TIntegerField;
    PCP_SQ_M_PSCpergunta_2: TIntegerField;
    PCP_SQ_M_PSCpergunta_3: TIntegerField;
    PCP_SQ_M_PSCpergunta_4: TIntegerField;
    PCP_SQ_M_PSCpergunta_1_resposta: TWideStringField;
    PCP_SQ_M_PSCpergunta_5: TIntegerField;
    PCP_SQ_M_PSCpergunta_2_resposta: TWideStringField;
    PCP_SQ_M_PSCid_responsavel: TIntegerField;
    PCP_SQ_M_PSCemail: TWideStringField;
    PCP_SQ_M_PSCint_nomeres: TWideStringField;
    FAT_SQ_M_PED_ITEid_pedido: TIntegerField;
    FAT_SQ_M_PED_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_PED_ITEid_item: TIntegerField;
    FAT_SQ_M_PED_ITEqtde: TFloatField;
    FAT_SQ_M_PED_ITEvlr_unitario: TFMTBCDField;
    FAT_SQ_M_PED_ITEvlr_bruto: TFMTBCDField;
    FAT_SQ_M_PED_ITEper_desconto: TFloatField;
    FAT_SQ_M_PED_ITEvlr_desconto: TFMTBCDField;
    FAT_SQ_M_PED_ITEvlr_liquido: TFMTBCDField;
    FAT_SQ_M_PED_ITEid_cor: TIntegerField;
    FAT_SQ_M_PED_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_PED_ITEid_busca_item: TWideStringField;
    FAT_SQ_M_PED_ITEint_nomeite: TWideStringField;
    FAT_SQ_M_PED_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_PED_ITEint_id_und_venda: TWideStringField;
    CMP_SQ_M_PED_NFE: TSQLDataSet;
    CMP_SQ_M_PED_NFE_ITE: TSQLDataSet;
    CMP_DS_M_PED_NFE: TDataSource;
    FAT_DS_M_NFE_ITE: TDataSource;
    FAT_SQ_M_IQM_ITE: TSQLDataSet;
    FAT_DS_M_IQM: TDataSource;
    CMP_SQ_M_PED_NFE_ITEid_pedido: TIntegerField;
    CMP_SQ_M_PED_NFE_ITEid_fiscal: TIntegerField;
    CMP_SQ_M_PED_NFE_ITEid_item: TIntegerField;
    CMP_SQ_M_PED_NFE_ITEqtde: TFloatField;
    CMP_SQ_M_PED_NFE_ITEid_cor: TIntegerField;
    CMP_SQ_M_PED_NFE_ITEid_tamanho: TIntegerField;
    CMP_SQ_M_PED_NFEid_pedido: TIntegerField;
    CMP_SQ_M_PED_NFEid_fiscal: TIntegerField;
    CMP_SQ_M_PED_NFE_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_NFE_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_NFE_ITEint_nometam: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAsituacao_analise: TIntegerField;
    PCP_SQ_C_CRGaprovador: TWideStringField;
    CAD_SQ_C_PECid_perfil_cli: TIntegerField;
    CAD_SQ_C_PECdescricao: TWideStringField;
    CAD_SQ_C_PECper_correcao: TFloatField;
    CAD_SQ_C_PECoperacao: TIntegerField;
    BUS_SQ_M_RAA: TSQLDataSet;
    BUS_DP_M_RAA: TDataSetProvider;
    BUS_SQ_M_NFI_RAA: TSQLDataSet;
    BUS_DP_M_NFI_RAA: TDataSetProvider;
    PCP_SQ_M_RAAid_raa: TIntegerField;
    PCP_SQ_M_RAAid_empresa: TIntegerField;
    PCP_SQ_M_RAAdta_emissao: TDateField;
    PCP_SQ_M_RAAcod_lme: TWideStringField;
    PCP_SQ_M_RAArev_lme: TWideStringField;
    PCP_SQ_M_RAAnro_raa: TWideStringField;
    PCP_SQ_M_RAAid_item: TIntegerField;
    PCP_SQ_M_RAAdta_recebimento_item: TDateField;
    PCP_SQ_M_RAAcodigo_fabrica: TWideStringField;
    PCP_SQ_M_RAAid_fornecedor: TIntegerField;
    PCP_SQ_M_RAAid_fabricante: TIntegerField;
    PCP_SQ_M_RAAqtde_amostra: TFloatField;
    PCP_SQ_M_RAAid_setor: TIntegerField;
    PCP_SQ_M_RAApergunta_1: TIntegerField;
    PCP_SQ_M_RAApergunta_2: TIntegerField;
    PCP_SQ_M_RAApergunta_3: TIntegerField;
    PCP_SQ_M_RAApergunta_4: TIntegerField;
    PCP_SQ_M_RAApergunta_5: TIntegerField;
    PCP_SQ_M_RAApergunta_6: TIntegerField;
    PCP_SQ_M_RAApergunta_7: TIntegerField;
    PCP_SQ_M_RAApergunta_8: TIntegerField;
    PCP_SQ_M_RAAresultado: TIntegerField;
    PCP_SQ_M_RAAincorpora_item: TIntegerField;
    PCP_SQ_M_RAAid_analista: TIntegerField;
    PCP_SQ_M_RAAdta_analise: TDateField;
    PCP_SQ_M_RAAobservacao: TWideStringField;
    PCP_SQ_M_RAAid_cor: TIntegerField;
    PCP_SQ_M_RAAid_tamanho: TIntegerField;
    PCP_SQ_M_RAAint_nomeana: TWideStringField;
    PCP_SQ_M_RAAint_nomefab: TWideStringField;
    PCP_SQ_M_RAAint_nomefor: TWideStringField;
    PCP_SQ_M_RAAint_nomeite: TWideStringField;
    PCP_SQ_M_RAAint_nomeset: TWideStringField;
    PCP_SQ_M_RAAint_nomecor: TWideStringField;
    PCP_SQ_M_RAAint_nometam: TWideStringField;
    PCP_SQ_M_RAAint_nomegru: TWideStringField;
    PCP_SQ_C_ORI: TSQLDataSet;
    PCP_DP_C_ORI: TDataSetProvider;
    PCP_SQ_M_RAAint_codigru: TWideStringField;
    CSU_SQ_M_PSC: TSQLDataSet;
    CSU_DP_M_PSC: TDataSetProvider;
    EST_SQ_M_MAL_ITEid_mal: TIntegerField;
    EST_SQ_M_MAL_ITEid_sequencia: TIntegerField;
    EST_SQ_M_MAL_ITEid_item: TIntegerField;
    EST_SQ_M_MAL_ITEqtde: TFloatField;
    EST_SQ_M_MAL_ITEnum_lote: TWideStringField;
    EST_SQ_M_MAL_ITEobservacao: TWideStringField;
    EST_SQ_M_MAL_ITEid_cor: TIntegerField;
    EST_SQ_M_MAL_ITEid_tamanho: TIntegerField;
    EST_SQ_M_MAL_ITEid_busca_item: TWideStringField;
    EST_SQ_M_MAL_ITEint_nomeite: TWideStringField;
    EST_SQ_M_MAL_ITEint_nomeund: TWideStringField;
    EST_SQ_M_MAL_ITEint_nomecor: TWideStringField;
    EST_SQ_M_MAL_ITEint_nometam: TWideStringField;
    BUS_SQ_M_PAG: TSQLDataSet;
    BUS_DP_M_PAG: TDataSetProvider;
    FIN_SQ_M_PBX_TITid_baixa: TIntegerField;
    FIN_SQ_M_PBX_TITid_titulo: TIntegerField;
    FIN_SQ_M_PBX_TITvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_PBX_TITvlr_juros: TFMTBCDField;
    FIN_SQ_M_PBX_TITvlr_desconto: TFMTBCDField;
    FIN_SQ_M_PBX_TITvlr_credito_utilizado: TFMTBCDField;
    FIN_SQ_M_PBX_TITper_desconto: TFloatField;
    FIN_SQ_M_PBX_TITvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_PBX_TITvlr_restante: TFMTBCDField;
    CAD_SQ_C_TMEid_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_TMEdescricao: TWideStringField;
    CAD_SQ_C_TMEtipo_movimento: TIntegerField;
    CAD_SQ_C_TMEativo: TBooleanField;
    CAD_SQ_C_TMEesto_critica: TBooleanField;
    CAD_SQ_C_TMEesto_movimenta: TBooleanField;
    CAD_SQ_C_TMEcfo_interno_pf: TWideStringField;
    CAD_SQ_C_TMEcfo_interno_pj: TWideStringField;
    CAD_SQ_C_TMEcfo_externo_pf: TWideStringField;
    CAD_SQ_C_TMEcfo_externo_pj: TWideStringField;
    CAD_SQ_C_TMEindicador: TIntegerField;
    CAD_SQ_C_TMEint_nomeipf: TWideStringField;
    CAD_SQ_C_TMEint_nomeipj: TWideStringField;
    CAD_SQ_C_TMEint_nomeepf: TWideStringField;
    CAD_SQ_C_TMEint_nomeepj: TWideStringField;
    PCP_SQ_C_FTE: TSQLDataSet;
    PCP_SQ_C_FTE_ETQ: TSQLDataSet;
    PCP_DS_C_FTE: TDataSource;
    PCP_DP_C_FTE: TDataSetProvider;
    PCP_SQ_C_FTEid_fte: TIntegerField;
    PCP_SQ_C_FTEcod_lme: TWideStringField;
    PCP_SQ_C_FTErev_lme: TWideStringField;
    PCP_SQ_C_FTErequisitos: TWideStringField;
    PCP_SQ_C_FTEinf_contato: TWideStringField;
    PCP_SQ_C_FTEinf_remocao: TWideStringField;
    PCP_SQ_C_FTE_ETQid_fte: TIntegerField;
    PCP_SQ_C_FTE_ETQid_fte_etq: TIntegerField;
    PCP_SQ_C_FTE_ETQcod_int_etq: TWideStringField;
    PCP_SQ_C_FTE_ETQcod_int_etq_rev: TWideStringField;
    PCP_SQ_C_FTE_ETQdescricao: TWideStringField;
    PCP_SQ_C_FTE_ETQespecificacoes: TWideStringField;
    PCP_SQ_C_FTE_ETQimg_modelo: TBlobField;
    PCP_SQ_C_FTE_ETQtexto_livre1: TWideStringField;
    PCP_SQ_C_FTE_ETQtexto_livre2: TWideStringField;
    PCP_SQ_M_ORS: TSQLDataSet;
    PCP_SQ_M_ORS_ITE: TSQLDataSet;
    PCP_SQ_M_ORS_TIT: TSQLDataSet;
    PCP_SQ_M_ORSid_ors: TIntegerField;
    PCP_SQ_M_ORSid_empresa: TIntegerField;
    PCP_SQ_M_ORSdta_emissao: TDateField;
    PCP_SQ_M_ORSid_responsavel: TIntegerField;
    PCP_SQ_M_ORSobservacao: TWideStringField;
    PCP_SQ_M_ORSid_pedido: TIntegerField;
    PCP_SQ_M_ORSint_nomeres: TWideStringField;
    PCP_DS_M_ORS: TDataSource;
    PCP_DP_M_ORS: TDataSetProvider;
    PCP_SQ_M_ORS_ITEid_ors: TIntegerField;
    PCP_SQ_M_ORS_ITEid_item: TIntegerField;
    PCP_SQ_M_ORS_ITEid_cor: TIntegerField;
    PCP_SQ_M_ORS_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_ORS_ITEqtde: TFloatField;
    PCP_SQ_M_ORS_ITEvlr_unitario: TFMTBCDField;
    PCP_SQ_M_ORS_ITEint_nomeite: TWideStringField;
    PCP_SQ_M_ORS_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_ORS_ITEint_nometam: TWideStringField;
    PCP_SQ_M_ROM: TSQLDataSet;
    PCP_SQ_M_ROM_LOT: TSQLDataSet;
    PCP_SQ_M_ROM_PED: TSQLDataSet;
    PCP_SQ_M_ROM_PED_ITE: TSQLDataSet;
    PCP_DP_M_ROM: TDataSetProvider;
    PCP_DS_M_ROM: TDataSource;
    PCP_DS_M_ROM_PED: TDataSource;
    PCP_SQ_M_ROMid_rom: TIntegerField;
    PCP_SQ_M_ROMid_empresa: TIntegerField;
    PCP_SQ_M_ROMdta_emissao: TDateField;
    PCP_SQ_M_ROMid_responsavel: TIntegerField;
    PCP_SQ_M_ROMid_motorista: TIntegerField;
    PCP_SQ_M_ROMobservacao: TWideStringField;
    PCP_SQ_M_ROMint_nomemta: TWideStringField;
    PCP_SQ_M_ROMint_nomeres: TWideStringField;
    PCP_SQ_M_ROM_LOTid_rom: TIntegerField;
    PCP_SQ_M_ROM_LOTnro_lote_caminhao: TIntegerField;
    PCP_SQ_M_ROM_LOTqtde: TFloatField;
    PCP_SQ_M_ROM_LOTobservacao: TWideStringField;
    PCP_SQ_C_FTEinf_sac: TWideStringField;
    BUS_SQ_M_FTE_ETQ: TSQLDataSet;
    BUS_DP_M_FTE_ETQ: TDataSetProvider;
    CMP_SQ_M_COTid_cotacao: TIntegerField;
    CMP_SQ_M_COTid_empresa: TIntegerField;
    CMP_SQ_M_COTdta_cotacao: TDateField;
    CMP_SQ_M_COTobs: TWideStringField;
    CMP_SQ_M_COTip_lancador: TWideStringField;
    CMP_SQ_M_COTid_funcionario: TIntegerField;
    CMP_SQ_M_COTint_nomeres: TWideStringField;
    CMP_SQ_M_COT_ITEid_cotacao: TIntegerField;
    CMP_SQ_M_COT_ITEid_item: TIntegerField;
    CMP_SQ_M_COT_ITEqtde: TFloatField;
    CMP_SQ_M_COT_ITEid_cor: TIntegerField;
    CMP_SQ_M_COT_ITEid_tamanho: TIntegerField;
    CMP_SQ_M_COT_ITEint_nomeite: TWideStringField;
    CMP_SQ_M_COT_ITEint_nomecor: TWideStringField;
    CMP_SQ_M_COT_ITEint_nometam: TWideStringField;
    CMP_SQ_M_COT_FORid_cotacao: TIntegerField;
    CMP_SQ_M_COT_FORid_fornecedor: TIntegerField;
    CMP_SQ_M_COT_FORdta_lancamento: TDateField;
    CMP_SQ_M_COT_FORvlr_total: TFMTBCDField;
    CMP_SQ_M_COT_FORstatus: TIntegerField;
    CMP_SQ_M_COT_FORint_nomefor: TWideStringField;
    CMP_SQ_M_COT_FITid_cotacao: TIntegerField;
    CMP_SQ_M_COT_FITid_fornecedor: TIntegerField;
    CMP_SQ_M_COT_FITid_item: TIntegerField;
    CMP_SQ_M_COT_FITqtde: TFloatField;
    CMP_SQ_M_COT_FITvlr_unitario: TFMTBCDField;
    CMP_SQ_M_COT_FITper_desconto: TFloatField;
    CMP_SQ_M_COT_FITvlr_desconto: TFMTBCDField;
    CMP_SQ_M_COT_FITvlr_total: TFMTBCDField;
    CMP_SQ_M_COT_FITfrete: TIntegerField;
    CMP_SQ_M_COT_FITprazo: TIntegerField;
    CMP_SQ_M_COT_FITdisponibilidade: TBooleanField;
    CMP_SQ_M_COT_FITaprovado: TBooleanField;
    CMP_SQ_M_COT_FITid_cor: TIntegerField;
    CMP_SQ_M_COT_FITid_tamanho: TIntegerField;
    CMP_SQ_M_COT_FITint_nomeite: TWideStringField;
    CMP_SQ_M_COT_FITint_nomecor: TWideStringField;
    CMP_SQ_M_COT_FITint_nometam: TWideStringField;
    CAD_SQ_C_PESid_perfil_seg: TIntegerField;
    CAD_SQ_C_PESdescricao: TWideStringField;
    CAD_SQ_C_PES_MODid_perfil_seg: TIntegerField;
    CAD_SQ_C_PARint_nomecid: TWideStringField;
    EST_SQ_M_FESint_nomeemp: TWideStringField;
    EST_SQ_M_FESint_nomecor: TWideStringField;
    EST_SQ_M_FESint_nometam: TWideStringField;
    CAD_SQ_C_ITEdta_cadastro: TDateField;
    CAD_SQ_C_ITEetiq_modelo: TWideStringField;
    CAD_SQ_C_CTCid_conta: TIntegerField;
    CAD_SQ_C_CTCbanco: TIntegerField;
    CAD_SQ_C_CTCagencia: TWideStringField;
    CAD_SQ_C_CTCcedente_cod: TWideStringField;
    CAD_SQ_C_CTCcedente_nom: TWideStringField;
    CAD_SQ_C_CTCcedente_mail: TWideStringField;
    CAD_SQ_C_CTCdescricao: TWideStringField;
    CAD_SQ_C_CTCconta_corrente: TWideStringField;
    FIN_SQ_R_PAG_ABE: TSQLDataSet;
    FIN_DP_R_PAG_ABE: TDataSetProvider;
    FIN_SQ_M_PBXid_conta: TIntegerField;
    FIN_SQ_M_PBXid_responsavel: TIntegerField;
    FIN_SQ_M_PBXid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_PBXdta_lancamento: TDateField;
    FIN_SQ_M_PBX_TITdta_vencimento: TDateField;
    FIN_SQ_M_PBX_TITvlr_titulo: TFMTBCDField;
    FIN_SQ_M_PBX_TITnum_parcela: TWideStringField;
    FIN_SQ_M_PBXid_plano: TWideStringField;
    FIN_SQ_M_PBXid_ccusto: TIntegerField;
    FIN_SQ_M_PBX_TITvlr_multa: TFMTBCDField;
    FIN_SQ_M_PCR: TSQLDataSet;
    FIN_DP_M_PCR: TDataSetProvider;
    FIN_SQ_M_PBXvlr_saldo_credito: TFMTBCDField;
    BUS_SQ_C_REP: TSQLDataSet;
    BUS_DP_C_REP: TDataSetProvider;
    FIN_SQ_M_PAG_PAG: TSQLDataSet;
    FIN_DP_M_PAG_PAG: TDataSetProvider;
    CAD_SQ_C_PAR_NFE: TSQLDataSet;
    CAD_SQ_C_PARres_cidade: TWideStringField;
    CAD_SQ_C_PAR_NFEid_empresa: TIntegerField;
    CAD_SQ_C_PAR_NFEcert_serie: TWideStringField;
    CAD_SQ_C_PAR_NFEdanf_tipo_impressao: TIntegerField;
    CAD_SQ_C_PAR_NFEdanf_tipo_emissao: TIntegerField;
    CAD_SQ_C_PAR_NFEws_estado: TWideStringField;
    CAD_SQ_C_PAR_NFEws_visualiza_msg: TWideStringField;
    CAD_SQ_C_PAR_NFEsituacao_emissor: TIntegerField;
    CAD_SQ_C_PAR_NFEproxy_host: TWideStringField;
    CAD_SQ_C_PAR_NFEproxy_porta: TIntegerField;
    CAD_SQ_C_PAR_NFEproxy_usuario: TWideStringField;
    CAD_SQ_C_PAR_NFEproxy_senha: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_smtp: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_smtp_porta: TIntegerField;
    CAD_SQ_C_PAR_NFEemail_smtp_seguro: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_usuario: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_senha: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_assunto: TWideStringField;
    CAD_SQ_C_PAR_NFEemail_msg: TWideStringField;
    CAD_SQ_C_PAR_NFEcontigencia_just: TWideStringField;
    CAD_SQ_C_PAR_NFEcontigencia_data: TDateField;
    CAD_SQ_C_PAR_NFEpath_xml: TWideStringField;
    CAD_SQ_C_PAR_NFEpath_logo: TWideStringField;
    CAD_SQ_C_CLI_CTOid_cliente: TIntegerField;
    CAD_SQ_C_CLI_CTOid_contato: TIntegerField;
    CAD_SQ_C_CLI_CTOnome: TWideStringField;
    CAD_SQ_C_CLI_CTOtelefone: TWideStringField;
    CAD_SQ_C_CLI_CTOemail: TWideStringField;
    CAD_SQ_C_CLI_CTOdta_nascimento: TDateField;
    CAD_SQ_C_CLI_INFid_cliente: TIntegerField;
    CAD_SQ_C_CLI_INFid_cli_informa: TIntegerField;
    CAD_SQ_C_CLI_INFdta_informacao: TDateField;
    CAD_SQ_C_CLI_INFdta_maior_compra: TDateField;
    CAD_SQ_C_CLI_INFvlr_maior_compra: TFMTBCDField;
    CAD_SQ_C_CLI_INFvlr_lim_liberado: TFMTBCDField;
    CAD_SQ_C_CLI_INFatrasa: TBooleanField;
    CAD_SQ_C_CLI_INFinformante: TWideStringField;
    CAD_SQ_C_CLI_INFobs: TWideStringField;
    CAD_SQ_C_CLI_RECid_cliente: TIntegerField;
    CAD_SQ_C_CLI_RECid_reclamacao: TIntegerField;
    CAD_SQ_C_CLI_RECdta_registro: TDateField;
    CAD_SQ_C_CLI_RECobs: TWideStringField;
    CAD_SQ_C_GRUid_st_pis_entrada: TWideStringField;
    CAD_SQ_C_GRUid_st_cof_entrada: TWideStringField;
    CAD_SQ_C_GRUid_st_ipi_entrada: TWideStringField;
    CAD_SQ_C_GRUid_st_pis_saida: TWideStringField;
    CAD_SQ_C_GRUid_st_cof_saida: TWideStringField;
    CAD_SQ_C_GRUid_st_ipi_saida: TWideStringField;
    FAT_SQ_M_NFE_ITEid_st_pis: TWideStringField;
    FAT_SQ_M_NFE_ITEid_st_cof: TWideStringField;
    FAT_SQ_M_NFE_ITEid_st_ipi: TWideStringField;
    FIN_SQ_M_PAG_PAGid_titulo: TIntegerField;
    FIN_SQ_M_PAG_PAGid_baixa: TIntegerField;
    FIN_SQ_M_PAG_PAGdta_pagamento: TDateField;
    FIN_SQ_M_PAG_PAGvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_PAG_PAGper_juros: TFMTBCDField;
    FIN_SQ_M_PAG_PAGvlr_juros: TFMTBCDField;
    FIN_SQ_M_PAG_PAGvlr_desconto: TFMTBCDField;
    FIN_SQ_M_PAG_PAGhistorico: TWideStringField;
    FIN_SQ_M_PAG_PAGid_forma_pag: TIntegerField;
    FIN_SQ_M_PAG_PAGid_plano: TWideStringField;
    FIN_SQ_M_PAG_PAGid_plano_juros: TWideStringField;
    FIN_SQ_M_PAG_PAGchp_vlr_anterior: TFMTBCDField;
    FIN_SQ_M_PAG_PAGid_responsavel: TIntegerField;
    FIN_SQ_M_PAG_PAGid_ccusto: TIntegerField;
    FIN_SQ_M_PAG_PAGid_plano_desconto: TWideStringField;
    FIN_SQ_M_PBXvlr_credito_disponivel: TFMTBCDField;
    CAD_SQ_C_CLIid_cliente: TIntegerField;
    CAD_SQ_C_CLIpessoa: TIntegerField;
    CAD_SQ_C_CLInome: TWideStringField;
    CAD_SQ_C_CLIendereco: TWideStringField;
    CAD_SQ_C_CLIend_complemento: TWideStringField;
    CAD_SQ_C_CLIcep: TWideStringField;
    CAD_SQ_C_CLInumero: TWideStringField;
    CAD_SQ_C_CLItel_fixo: TWideStringField;
    CAD_SQ_C_CLItel_movel: TWideStringField;
    CAD_SQ_C_CLIfax: TWideStringField;
    CAD_SQ_C_CLIdoc_cnpj_cpf: TWideStringField;
    CAD_SQ_C_CLIdoc_ie_identidade: TWideStringField;
    CAD_SQ_C_CLIdoc_ip: TWideStringField;
    CAD_SQ_C_CLIdoc_im: TWideStringField;
    CAD_SQ_C_CLIbairro: TWideStringField;
    CAD_SQ_C_CLIid_cidade: TWideStringField;
    CAD_SQ_C_CLIativo: TBooleanField;
    CAD_SQ_C_CLIemail: TWideStringField;
    CAD_SQ_C_CLIlim_valor: TFMTBCDField;
    CAD_SQ_C_CLIlim_saldo: TFMTBCDField;
    CAD_SQ_C_CLIlim_validade: TDateField;
    CAD_SQ_C_CLIsexo: TIntegerField;
    CAD_SQ_C_CLIsituacao: TIntegerField;
    CAD_SQ_C_CLIdta_nascimento: TDateField;
    CAD_SQ_C_CLIdta_cadastro: TDateField;
    CAD_SQ_C_CLItipo_cliente: TIntegerField;
    CAD_SQ_C_CLIcob_endereco: TWideStringField;
    CAD_SQ_C_CLIcob_bairro: TWideStringField;
    CAD_SQ_C_CLIcob_cidade: TWideStringField;
    CAD_SQ_C_CLIcob_estado: TWideStringField;
    CAD_SQ_C_CLIdta_ult_compra: TDateField;
    CAD_SQ_C_CLIdta_pri_compra: TDateField;
    CAD_SQ_C_CLIcod_sufrana: TWideStringField;
    CAD_SQ_C_CLIcod_pais: TWideStringField;
    CAD_SQ_C_CLIid_perfil_cli: TIntegerField;
    CAD_SQ_C_CLIid_rota: TIntegerField;
    CAD_SQ_C_CLIdoc_rg_orgao: TWideStringField;
    CAD_SQ_C_CLIapelido: TWideStringField;
    CAD_SQ_C_CLIint_uf: TWideStringField;
    CAD_SQ_C_CLIint_nomecid: TWideStringField;
    CAD_SQ_C_CLI_CTOtipo_contato: TIntegerField;
    FAT_SQ_R_IQM_ITE: TSQLDataSet;
    PCP_SQ_R_PSC: TSQLDataSet;
    PCP_SQ_R_RAA: TSQLDataSet;
    FAT_DP_R_IQM_ITE: TDataSetProvider;
    PCP_DP_R_PSC: TDataSetProvider;
    PCP_DP_R_RAA: TDataSetProvider;
    CAD_SQ_C_PAR_CTRid_empresa: TIntegerField;
    CAD_SQ_C_PAR_CTRativa_producao: TBooleanField;
    CAD_SQ_C_PAR_CTRped_ativa_titulos: TBooleanField;
    CAD_SQ_C_PAR_CTRped_aceita_est_negativo: TBooleanField;
    CAD_SQ_C_PAR_CTRutiliza_almoxarifado: TBooleanField;
    CAD_SQ_C_PAR_CTRutiliza_lote_na_entrada: TBooleanField;
    CAD_SQ_C_PAR_CTRativa_cor: TBooleanField;
    CAD_SQ_C_PAR_CTRativa_tamanho: TBooleanField;
    CAD_SQ_C_PAR_CTRrcr_inf_pag_credito: TBooleanField;
    CAD_SQ_C_PAR_CTRnfe_separa_prod_serv: TBooleanField;
    CAD_SQ_C_PAR_CTRped_ver_limite: TBooleanField;
    CAD_SQ_C_PAR_CTRfaz_corr_preco_perfil: TBooleanField;
    CAD_SQ_C_PAR_CTRtax_juros_mensal: TFloatField;
    CAD_SQ_C_PAR_CTRper_margem_lucro: TFloatField;
    CAD_SQ_C_PAR_CTRper_desp_fixa: TFloatField;
    CAD_SQ_C_PAR_CTRdia_protesto: TIntegerField;
    CAD_SQ_C_PAR_CTRper_ir: TFloatField;
    CAD_SQ_C_PAR_CTRper_cssl: TFloatField;
    CAD_SQ_C_PAR_CTRper_desconto: TFloatField;
    CAD_SQ_C_PAR_CTRvlr_lim_maximo: TFMTBCDField;
    CAD_SQ_C_PAR_CTRper_iss: TFloatField;
    CAD_SQ_C_PAR_CTRped_cliente_consumidor: TIntegerField;
    CAD_SQ_C_PAR_CTRpde_id_forma_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRpde_id_ccusto: TIntegerField;
    CAD_SQ_C_PAR_CTRpde_id_local_titulo: TIntegerField;
    CAD_SQ_C_PAR_CTRpde_id_tipo_financeiro: TIntegerField;
    CAD_SQ_C_PAR_CTReff_finalidade: TWideStringField;
    CAD_SQ_C_PAR_CTReff_perfil: TWideStringField;
    CAD_SQ_C_PAR_CTReff_atividade: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_layout: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_tipo_escrituracao: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_ind_reg_cum: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_situa_especial: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_ind_nat_pj: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_ind_ativ: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_ind_apro_cred: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_cod_tipo_cont: TWideStringField;
    CAD_SQ_C_PAR_CTRefc_cod_inc_trib: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_layout: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_cod_fin: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_cod_ctd: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_ed: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_arq: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_iss: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_icms: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_ridf: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_rudf: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_lmc: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_rv: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_prf_ri: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_ec: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_iss: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_rt: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_icms: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_st: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_at: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_ipi: TWideStringField;
    CAD_SQ_C_PAR_CTRsef_ind_ri: TWideStringField;
    CAD_SQ_C_PAR_CTRaliq_interna_icms: TIntegerField;
    CAD_SQ_C_PAR_CTRdta_saldo_inicial: TDateField;
    CAD_SQ_C_PAR_CTRano_corrente: TIntegerField;
    CAD_SQ_C_PAR_CTRmes_corrente: TIntegerField;
    CAD_SQ_C_PAR_CTRid_lme: TIntegerField;
    CAD_SQ_C_PAR_CTRtipo_desconto_cmp_ped: TIntegerField;
    CAD_SQ_C_PAR_CTRid_alm_padrao: TIntegerField;
    CAD_SQ_C_PAR_CTRdoc_layout: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_cod_fin: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_cod_ctd: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_ed: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_arq: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_iss: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_icms: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_ridf: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_rudf: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_lmc: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_rv: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_prf_ri: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_ec: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_iss: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_rt: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_icms: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_st: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_at: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_ipi: TWideStringField;
    CAD_SQ_C_PAR_CTRdoc_ind_ri: TWideStringField;
    CAD_SQ_C_PAR_CTRper_corr_preco_prazo: TFloatField;
    CAD_SQ_C_PAR_CTRcte_tipo_estoque_ent: TIntegerField;
    CAD_SQ_C_PAR_CTRcte_tipo_estoque_sai: TIntegerField;
    CAD_SQ_C_PAR_CTRdec_forma_pag_credito: TIntegerField;
    CAD_SQ_C_PAR_CTRpcp_id_item_sob_medida: TIntegerField;
    CAD_SQ_C_PAR_CTRpcp_cod_int_fte_etq: TWideStringField;
    CAD_SQ_C_PAR_CTRped_cliente: TIntegerField;
    CAD_SQ_C_PAR_CTRped_altera_preco: TBooleanField;
    CAD_SQ_C_FORid_fornecedor: TIntegerField;
    CAD_SQ_C_FORdescricao: TWideStringField;
    CAD_SQ_C_FORfantasia: TWideStringField;
    CAD_SQ_C_FORendereco: TWideStringField;
    CAD_SQ_C_FORend_complemento: TWideStringField;
    CAD_SQ_C_FORcep: TWideStringField;
    CAD_SQ_C_FORnumero: TWideStringField;
    CAD_SQ_C_FORcp: TWideStringField;
    CAD_SQ_C_FORtel_fixo: TWideStringField;
    CAD_SQ_C_FORtel_movel: TWideStringField;
    CAD_SQ_C_FORfax: TWideStringField;
    CAD_SQ_C_FORdoc_cnpj: TWideStringField;
    CAD_SQ_C_FORdoc_cpf: TWideStringField;
    CAD_SQ_C_FORdoc_ie: TWideStringField;
    CAD_SQ_C_FORdoc_im: TWideStringField;
    CAD_SQ_C_FORbairro: TWideStringField;
    CAD_SQ_C_FORid_cidade: TWideStringField;
    CAD_SQ_C_FORativo: TBooleanField;
    CAD_SQ_C_FORemail: TWideStringField;
    CAD_SQ_C_FORlim_valor: TFMTBCDField;
    CAD_SQ_C_FORdta_fundacao: TDateField;
    CAD_SQ_C_FORdta_cadastro: TDateField;
    CAD_SQ_C_FORsenha_cotacao: TWideStringField;
    CAD_SQ_C_FORfin_conta: TIntegerField;
    CAD_SQ_C_FORfin_agencia: TWideStringField;
    CAD_SQ_C_FORfin_banco: TIntegerField;
    CAD_SQ_C_FORfin_favor: TWideStringField;
    CAD_SQ_C_FORmetodo1_norma_aplicavel: TWideStringField;
    CAD_SQ_C_FORmetodo1_data_validade: TDateField;
    CAD_SQ_C_FORmetodo2_data_recebimento: TDateField;
    CAD_SQ_C_FORmetodo2_situacao: TIntegerField;
    CAD_SQ_C_FORmetodo2_proc_qualificacao: TWideStringField;
    CAD_SQ_C_FORmetodo3_metodo: TIntegerField;
    CAD_SQ_C_FORmetodo3_data: TDateField;
    CAD_SQ_C_FORmetodo3_numero_nf: TWideStringField;
    CAD_SQ_C_FORtransportadora: TBooleanField;
    CAD_SQ_C_FORint_uf: TWideStringField;
    CAD_SQ_C_FOR_REPid_fornecedor: TIntegerField;
    CAD_SQ_C_FOR_REPid_for_rp: TIntegerField;
    CAD_SQ_C_FOR_REPnome: TWideStringField;
    CAD_SQ_C_FOR_REPdoc_cpf: TWideStringField;
    CAD_SQ_C_FOR_REPcep: TWideStringField;
    CAD_SQ_C_FOR_REPendereco: TWideStringField;
    CAD_SQ_C_FOR_REPnumero: TWideStringField;
    CAD_SQ_C_FOR_REPid_cidade: TWideStringField;
    CAD_SQ_C_FOR_REPtel_1: TWideStringField;
    CAD_SQ_C_FOR_REPtel_2: TWideStringField;
    CAD_SQ_C_FOR_REPtel_celular: TWideStringField;
    CAD_SQ_C_FOR_REPemail: TWideStringField;
    CAD_SQ_C_FOR_REPobs: TWideStringField;
    CAD_SQ_C_FOR_REPint_nomecid: TWideStringField;
    CAD_SQ_C_FUNid_funcionario: TIntegerField;
    CAD_SQ_C_FUNativo: TBooleanField;
    CAD_SQ_C_FUNnome: TWideStringField;
    CAD_SQ_C_FUNendereco: TWideStringField;
    CAD_SQ_C_FUNcep: TWideStringField;
    CAD_SQ_C_FUNnumero: TWideStringField;
    CAD_SQ_C_FUNtel_fixo: TWideStringField;
    CAD_SQ_C_FUNtel_movel: TWideStringField;
    CAD_SQ_C_FUNdoc_cpf: TWideStringField;
    CAD_SQ_C_FUNdoc_identidade: TWideStringField;
    CAD_SQ_C_FUNbairro: TWideStringField;
    CAD_SQ_C_FUNid_cidade: TWideStringField;
    CAD_SQ_C_FUNestado: TWideStringField;
    CAD_SQ_C_FUNemail: TWideStringField;
    CAD_SQ_C_FUNsexo: TIntegerField;
    CAD_SQ_C_FUNdta_nascimento: TDateField;
    CAD_SQ_C_FUNdta_cadastro: TDateField;
    CAD_SQ_C_FUNlogin: TWideStringField;
    CAD_SQ_C_FUNsenha: TWideStringField;
    CAD_SQ_C_FUNdta_senha_expira: TDateField;
    CAD_SQ_C_FUNid_perfil_seg: TIntegerField;
    CAD_SQ_C_FUNseg_alt_lim_cli: TBooleanField;
    CAD_SQ_C_FUNseg_alt_sit_cli: TBooleanField;
    CAD_SQ_C_FUNseg_alt_pre_pro: TBooleanField;
    CAD_SQ_C_FUNseg_hab_bot_exc: TBooleanField;
    CAD_SQ_C_FUNint_nomecid: TWideStringField;
    FIN_SQ_M_CTAid_baixa_pbx: TIntegerField;
    FIN_SQ_M_CTAid_baixa_rbx: TIntegerField;
    FIN_SQ_M_CXAid_abertura: TIntegerField;
    FIN_SQ_M_CXAdta_abertura: TDateField;
    FIN_SQ_M_CXAid_conta: TIntegerField;
    FIN_SQ_M_CXAid_empresa: TIntegerField;
    FIN_SQ_M_CXAecf_serial_impressora: TWideStringField;
    FIN_SQ_M_CXAid_funcionario: TIntegerField;
    FIN_SQ_M_CXAstatus: TIntegerField;
    FIN_SQ_M_CXAdta_fechamento: TDateField;
    FIN_SQ_M_CXAvlr_suprimento: TFMTBCDField;
    FIN_SQ_M_CXAint_nomefun: TWideStringField;
    FIN_SQ_M_CXAint_banco: TIntegerField;
    FIN_SQ_M_CXAint_nomectc: TWideStringField;
    CAD_SQ_C_CTCnnu_proximo: TWideStringField;
    CAD_SQ_R_ITE: TSQLDataSet;
    CAD_DP_R_ITE: TDataSetProvider;
    PCP_SQ_C_CRGtipo: TIntegerField;
    CAD_SQ_C_PES_MODformulario: TWideStringField;
    CAD_SQ_C_PES_MODativo: TBooleanField;
    CAD_SQ_C_PES_MODchave: TWideStringField;
    CAD_SQ_C_PES_MODdescricao: TWideStringField;
    CAD_SQ_C_PES_MODmenu: TWideStringField;
    CAD_SQ_C_PES_MODmodulo: TWideStringField;
    CAD_SQ_C_PES_MODmodulo_desc: TWideStringField;
    CAD_SQ_C_PAR_MODid_empresa: TIntegerField;
    CAD_SQ_C_PAR_MODcad: TBooleanField;
    CAD_SQ_C_PAR_MODtab: TBooleanField;
    CAD_SQ_C_PAR_MODcsu: TBooleanField;
    CAD_SQ_C_PAR_MODcmp: TBooleanField;
    CAD_SQ_C_PAR_MODest: TBooleanField;
    CAD_SQ_C_PAR_MODfat: TBooleanField;
    CAD_SQ_C_PAR_MODome: TBooleanField;
    CAD_SQ_C_PAR_MODota: TBooleanField;
    CAD_SQ_C_PAR_MODseg: TBooleanField;
    CAD_SQ_C_PAR_MODchave: TWideStringField;
    ctc_sq_m_fac: TSQLDataSet;
    ctc_sq_m_avf: TSQLDataSet;
    ctc_dp_m_avf: TDataSetProvider;
    ctc_dp_m_fac: TDataSetProvider;
    ctc_sq_m_avfid_avf: TIntegerField;
    ctc_sq_m_avfdta_avf: TDateField;
    ctc_sq_m_avfid_responsavel: TIntegerField;
    ctc_sq_m_avfid_fornecedor: TIntegerField;
    ctc_sq_m_avfnom_fornecedor: TWideStringField;
    ctc_sq_m_avfdoc_cnpj: TWideStringField;
    ctc_sq_m_avfperg_01: TBooleanField;
    ctc_sq_m_avfperg_02: TBooleanField;
    ctc_sq_m_avfperg_03: TBooleanField;
    ctc_sq_m_avfperg_04: TBooleanField;
    ctc_sq_m_avfcriterio_01: TFloatField;
    ctc_sq_m_avfcriterio_02: TFloatField;
    ctc_sq_m_avfcriterio_03: TFloatField;
    ctc_sq_m_avfcriterio_04: TFloatField;
    ctc_sq_m_avfcriterio_05: TFloatField;
    ctc_sq_m_avfcriterio_06: TFloatField;
    ctc_sq_m_avfcriterio_07: TFloatField;
    ctc_sq_m_avfpeso_01: TFloatField;
    ctc_sq_m_avfpeso_02: TFloatField;
    ctc_sq_m_avfpeso_03: TFloatField;
    ctc_sq_m_avfpeso_04: TFloatField;
    ctc_sq_m_avfpeso_05: TFloatField;
    ctc_sq_m_avfpeso_06: TFloatField;
    ctc_sq_m_avfpeso_07: TFloatField;
    ctc_sq_m_avfobs: TWideStringField;
    ctc_sq_m_avfmedia: TFloatField;
    ctc_sq_m_avffor_aprovado: TBooleanField;
    ctc_sq_m_facid_fac: TIntegerField;
    ctc_sq_m_facdta_abertura: TDateField;
    ctc_sq_m_facpro_acao: TIntegerField;
    ctc_sq_m_facpro_origem: TIntegerField;
    ctc_sq_m_facpro_id_responsavel: TIntegerField;
    ctc_sq_m_facpro_descricao: TWideStringField;
    ctc_sq_m_facpro_data: TDateField;
    ctc_sq_m_facaci_descricao: TWideStringField;
    ctc_sq_m_facaci_id_responsavel: TIntegerField;
    ctc_sq_m_facaci_data: TDateField;
    ctc_sq_m_facava_id_responsavel: TIntegerField;
    ctc_sq_m_facava_data: TDateField;
    ctc_sq_m_faccap_descricao: TWideStringField;
    ctc_sq_m_faccap_id_responsavel: TIntegerField;
    ctc_sq_m_faccap_data: TDateField;
    ctc_sq_m_facacp_descricao_01: TWideStringField;
    ctc_sq_m_facacp_descricao_02: TWideStringField;
    ctc_sq_m_facacp_descricao_03: TWideStringField;
    ctc_sq_m_facacp_descricao_04: TWideStringField;
    ctc_sq_m_facacp_id_resp_01: TIntegerField;
    ctc_sq_m_facacp_id_resp_02: TIntegerField;
    ctc_sq_m_facacp_id_resp_03: TIntegerField;
    ctc_sq_m_facacp_id_resp_04: TIntegerField;
    ctc_sq_m_facacp_data_01: TDateField;
    ctc_sq_m_facacp_data_02: TDateField;
    ctc_sq_m_facacp_data_03: TDateField;
    ctc_sq_m_facacp_data_04: TDateField;
    ctc_sq_m_facmae_descricao: TWideStringField;
    ctc_sq_m_facaco_perg_01: TBooleanField;
    ctc_sq_m_facaco_perg_02: TBooleanField;
    ctc_sq_m_facaco_perg_03: TBooleanField;
    ctc_sq_m_facaco_perg_04: TBooleanField;
    ctc_sq_m_facaco_perg_01_prazo: TIntegerField;
    ctc_sq_m_facaco_perg_02_prazo: TIntegerField;
    ctc_sq_m_facaco_perg_03_fac: TIntegerField;
    ctc_sq_m_facaco_perg_04_fac: TIntegerField;
    ctc_sq_m_facaca_descricao: TWideStringField;
    CAD_SQ_C_CFOdescricao: TWideStringField;
    ctc_sq_m_facava_avaliacao: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAint_nomeset: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAint_nomeres: TWideStringField;
    FIN_SQ_M_PBX_TIT_INT: TSQLDataSet;
    FIN_DP_M_PBX_TIT_INT: TDataSetProvider;
    BUS_SQ_C_LME_DOC: TSQLDataSet;
    BUS_DP_C_LME_DOC: TDataSetProvider;
    CAD_SQ_C_ITEfantasia: TWideStringField;
    CAD_SQ_C_CNEcod_lme: TWideStringField;
    CAD_SQ_C_CNErev_lme: TWideStringField;
    CAD_SQ_C_CIDcod_lme: TWideStringField;
    CAD_SQ_C_CIDrev_lme: TWideStringField;
    CAD_SQ_C_RAMcod_lme: TWideStringField;
    CAD_SQ_C_RAMrev_lme: TWideStringField;
    CAD_SQ_C_CINcod_lme: TWideStringField;
    CAD_SQ_C_CINrev_lme: TWideStringField;
    CAD_SQ_C_PECcod_lme: TWideStringField;
    CAD_SQ_C_PECrev_lme: TWideStringField;
    CAD_SQ_C_PCTid_plano: TWideStringField;
    CAD_SQ_C_PCTdescricao: TWideStringField;
    CAD_SQ_C_PCTtipo: TIntegerField;
    CAD_SQ_C_PCTtipo_mov: TIntegerField;
    CAD_SQ_C_PCTtipo_desp: TIntegerField;
    CAD_SQ_C_PCTcod_lme: TWideStringField;
    CAD_SQ_C_PCTrev_lme: TWideStringField;
    CAD_SQ_C_CCUid_ccusto: TIntegerField;
    CAD_SQ_C_CCUdescricao: TWideStringField;
    CAD_SQ_C_CCUcod_lme: TWideStringField;
    CAD_SQ_C_CCUrev_lme: TWideStringField;
    CAD_SQ_C_CTCcod_lme: TWideStringField;
    CAD_SQ_C_CTCrev_lme: TWideStringField;
    CAD_SQ_C_LTOid_local_titulo: TIntegerField;
    CAD_SQ_C_LTOdescricao: TWideStringField;
    CAD_SQ_C_LTOcod_lme: TWideStringField;
    CAD_SQ_C_LTOrev_lme: TWideStringField;
    CAD_SQ_C_TIFid_tipo_financeiro: TIntegerField;
    CAD_SQ_C_TIFdescricao: TWideStringField;
    CAD_SQ_C_TIFnatureza: TIntegerField;
    CAD_SQ_C_TIFsigla: TWideStringField;
    CAD_SQ_C_TIFcod_lme: TWideStringField;
    CAD_SQ_C_TIFrev_lme: TWideStringField;
    CAD_SQ_C_TMEcod_lme: TWideStringField;
    CAD_SQ_C_TMErev_lme: TWideStringField;
    CAD_SQ_C_FPGcod_lme: TWideStringField;
    CAD_SQ_C_FPGrev_lme: TWideStringField;
    CAD_SQ_C_CPGid_condicao_pag: TIntegerField;
    CAD_SQ_C_CPGativo: TBooleanField;
    CAD_SQ_C_CPGdescricao: TWideStringField;
    CAD_SQ_C_CPGtipo_pagamento: TIntegerField;
    CAD_SQ_C_CPGnum_parcelas: TIntegerField;
    CAD_SQ_C_CPGcod_lme: TWideStringField;
    CAD_SQ_C_CPGrev_lme: TWideStringField;
    CAD_SQ_C_UNDid_unidade: TWideStringField;
    CAD_SQ_C_UNDdescricao: TWideStringField;
    CAD_SQ_C_UNDnum_decimais: TIntegerField;
    CAD_SQ_C_UNDcod_lme: TWideStringField;
    CAD_SQ_C_UNDrev_lme: TWideStringField;
    CAD_SQ_C_NCMid_ncm: TWideStringField;
    CAD_SQ_C_NCMdescricao: TWideStringField;
    CAD_SQ_C_NCMcod_lme: TWideStringField;
    CAD_SQ_C_NCMrev_lme: TWideStringField;
    CAD_SQ_C_INFid_inf: TIntegerField;
    CAD_SQ_C_INFdescricao: TWideStringField;
    CAD_SQ_C_INFcod_lme: TWideStringField;
    CAD_SQ_C_INFrev_lme: TWideStringField;
    CAD_SQ_C_NATid_classe: TWideStringField;
    CAD_SQ_C_NATdescricao: TWideStringField;
    CAD_SQ_C_NATcod_lme: TWideStringField;
    CAD_SQ_C_NATrev_lme: TWideStringField;
    CAD_SQ_C_CFOcod_lme: TWideStringField;
    CAD_SQ_C_CFOrev_lme: TWideStringField;
    CAD_SQ_C_GRUcod_lme: TWideStringField;
    CAD_SQ_C_GRUrev_lme: TWideStringField;
    CAD_SQ_C_TRIcod_lme: TWideStringField;
    CAD_SQ_C_TRIrev_lme: TWideStringField;
    CAD_SQ_C_PEScod_lme: TWideStringField;
    CAD_SQ_C_PESrev_lme: TWideStringField;
    CAD_SQ_C_CORid_cor: TIntegerField;
    CAD_SQ_C_CORdescricao: TWideStringField;
    CAD_SQ_C_CORcod_lme: TWideStringField;
    CAD_SQ_C_CORrev_lme: TWideStringField;
    CAD_SQ_C_SETcod_lme: TWideStringField;
    CAD_SQ_C_SETrev_lme: TWideStringField;
    CAD_SQ_C_MVEid_mve: TIntegerField;
    CAD_SQ_C_MVEdescricao: TWideStringField;
    CAD_SQ_C_MVEcod_lme: TWideStringField;
    CAD_SQ_C_MVErev_lme: TWideStringField;
    CAD_SQ_C_TDFid_tdf: TIntegerField;
    CAD_SQ_C_TDFdescricao: TWideStringField;
    CAD_SQ_C_TDFcod_lme: TWideStringField;
    CAD_SQ_C_TDFrev_lme: TWideStringField;
    CAD_SQ_C_VEIid_veiculo: TIntegerField;
    CAD_SQ_C_VEIid_placa: TWideStringField;
    CAD_SQ_C_VEIdescricao: TWideStringField;
    CAD_SQ_C_VEIid_mve: TIntegerField;
    CAD_SQ_C_VEIkm_aquisicao: TFloatField;
    CAD_SQ_C_VEIdta_aquisicao: TDateField;
    CAD_SQ_C_VEIkm_atual: TFloatField;
    CAD_SQ_C_VEIchassi: TWideStringField;
    CAD_SQ_C_VEIano_modelo: TWideStringField;
    CAD_SQ_C_VEIano_fabricacao: TWideStringField;
    CAD_SQ_C_VEIrenavam: TWideStringField;
    CAD_SQ_C_VEIalimentacao: TIntegerField;
    CAD_SQ_C_VEIcombustivel: TIntegerField;
    CAD_SQ_C_VEIserie: TWideStringField;
    CAD_SQ_C_VEImotor: TWideStringField;
    CAD_SQ_C_VEImotor_num: TWideStringField;
    CAD_SQ_C_VEIrastreado: TBooleanField;
    CAD_SQ_C_VEItipo: TIntegerField;
    CAD_SQ_C_VEIstatus: TIntegerField;
    CAD_SQ_C_VEIcod_lme: TWideStringField;
    CAD_SQ_C_VEIrev_lme: TWideStringField;
    CAD_SQ_C_FORcod_lme: TWideStringField;
    CAD_SQ_C_FORrev_lme: TWideStringField;
    CAD_SQ_C_FUNcod_lme: TWideStringField;
    CAD_SQ_C_FUNrev_lme: TWideStringField;
    CAD_SQ_C_CLIcod_lme: TWideStringField;
    CAD_SQ_C_CLIrev_lme: TWideStringField;
    CAD_SQ_C_ITEcod_lme: TWideStringField;
    CAD_SQ_C_ITErev_lme: TWideStringField;
    CAD_SQ_C_PARcod_lme: TWideStringField;
    CAD_SQ_C_PARrev_lme: TWideStringField;
    CAD_SQ_C_TAMid_tamanho: TIntegerField;
    CAD_SQ_C_TAMdescricao: TWideStringField;
    CAD_SQ_C_TAMcod_lme: TWideStringField;
    CAD_SQ_C_TAMrev_lme: TWideStringField;
    CAD_SQ_C_ALMid_almoxarifado: TIntegerField;
    CAD_SQ_C_ALMdescricao: TWideStringField;
    CAD_SQ_C_ALMcod_lme: TWideStringField;
    CAD_SQ_C_ALMrev_lme: TWideStringField;
    CMP_SQ_M_COTcod_lme: TWideStringField;
    CMP_SQ_M_COTrev_lme: TWideStringField;
    FAT_SQ_M_NFEcod_lme: TWideStringField;
    FAT_SQ_M_NFErev_lme: TWideStringField;
    FAT_SQ_M_POSid_posvenda: TIntegerField;
    FAT_SQ_M_POSid_empresa: TIntegerField;
    FAT_SQ_M_POSdta_posvenda: TDateField;
    FAT_SQ_M_POSid_cliente: TIntegerField;
    FAT_SQ_M_POScod_lme: TWideStringField;
    FAT_SQ_M_POSrev_lme: TWideStringField;
    FAT_SQ_M_ORCcod_lme: TWideStringField;
    FAT_SQ_M_ORCrev_lme: TWideStringField;
    FIN_SQ_M_COBcod_lme: TWideStringField;
    FIN_SQ_M_COBrev_lme: TWideStringField;
    FIN_SQ_M_PAGcod_lme: TWideStringField;
    FIN_SQ_M_PAGrev_lme: TWideStringField;
    FIN_SQ_M_RECcod_lme: TWideStringField;
    FIN_SQ_M_RECrev_lme: TWideStringField;
    FIN_SQ_M_RCRcod_lme: TWideStringField;
    FIN_SQ_M_RCRrev_lme: TWideStringField;
    FIN_SQ_M_RBXcod_lme: TWideStringField;
    FIN_SQ_M_RBXrev_lme: TWideStringField;
    FIN_SQ_M_CXAcod_lme: TWideStringField;
    FIN_SQ_M_CXArev_lme: TWideStringField;
    FIN_SQ_M_CTAcod_lme: TWideStringField;
    FIN_SQ_M_CTArev_lme: TWideStringField;
    EST_SQ_M_FEAcod_lme: TWideStringField;
    EST_SQ_M_FEArev_lme: TWideStringField;
    EST_SQ_M_FEScod_lme: TWideStringField;
    EST_SQ_M_FESrev_lme: TWideStringField;
    EST_SQ_M_LOTcod_lme: TWideStringField;
    EST_SQ_M_LOTrev_lme: TWideStringField;
    EST_SQ_M_CTEcod_lme: TWideStringField;
    EST_SQ_M_CTErev_lme: TWideStringField;
    FIN_SQ_M_PBXcod_lme: TWideStringField;
    FIN_SQ_M_PBXrev_lme: TWideStringField;
    PCP_SQ_C_CDRcod_lme: TWideStringField;
    PCP_SQ_C_CDRrev_lme: TWideStringField;
    PCP_SQ_C_CNFid_conformidade: TIntegerField;
    PCP_SQ_C_CNFdescricao: TWideStringField;
    PCP_SQ_C_CNFcod_lme: TWideStringField;
    PCP_SQ_C_CNFrev_lme: TWideStringField;
    PCP_SQ_C_CRGcod_lme: TWideStringField;
    PCP_SQ_C_CRGrev_lme: TWideStringField;
    PCP_SQ_C_DISid_dis: TIntegerField;
    PCP_SQ_C_DISdescricao: TWideStringField;
    PCP_SQ_C_DIScod_lme: TWideStringField;
    PCP_SQ_C_DISrev_lme: TWideStringField;
    PCP_SQ_C_ESPid_especificacao: TIntegerField;
    PCP_SQ_C_ESPdescricao: TWideStringField;
    PCP_SQ_C_ESPcod_lme: TWideStringField;
    PCP_SQ_C_ESPrev_lme: TWideStringField;
    PCP_SQ_C_LMEid_lme: TIntegerField;
    PCP_SQ_C_LMEdata: TDateField;
    PCP_SQ_C_LMEid_responsavel: TIntegerField;
    PCP_SQ_C_LMEobservacao: TWideStringField;
    PCP_SQ_C_LMEcod_lme: TWideStringField;
    PCP_SQ_C_LMErev_lme: TWideStringField;
    PCP_SQ_C_MTAid_motorista: TIntegerField;
    PCP_SQ_C_MTAnome: TWideStringField;
    PCP_SQ_C_MTAplaca: TWideStringField;
    PCP_SQ_C_MTAend_endereco: TWideStringField;
    PCP_SQ_C_MTAend_numero: TWideStringField;
    PCP_SQ_C_MTAend_cidade: TWideStringField;
    PCP_SQ_C_MTAend_bairro: TWideStringField;
    PCP_SQ_C_MTAend_cep: TWideStringField;
    PCP_SQ_C_MTAend_estado: TWideStringField;
    PCP_SQ_C_MTAfone: TWideStringField;
    PCP_SQ_C_MTAcelular: TWideStringField;
    PCP_SQ_C_MTAemail: TWideStringField;
    PCP_SQ_C_MTAobservacao: TWideStringField;
    PCP_SQ_C_MTAcod_lme: TWideStringField;
    PCP_SQ_C_MTArev_lme: TWideStringField;
    PCP_SQ_C_REGcod_lme: TWideStringField;
    PCP_SQ_C_REGrev_lme: TWideStringField;
    PCP_SQ_C_ROTid_rota: TIntegerField;
    PCP_SQ_C_ROTdescricao: TWideStringField;
    PCP_SQ_C_ROTdis_inicial: TFloatField;
    PCP_SQ_C_ROTdis_final: TFloatField;
    PCP_SQ_C_ROTcod_lme: TWideStringField;
    PCP_SQ_C_ROTrev_lme: TWideStringField;
    PCP_SQ_C_TLMid_tlm: TIntegerField;
    PCP_SQ_C_TLMdescricao: TWideStringField;
    PCP_SQ_C_TLMcod_lme: TWideStringField;
    PCP_SQ_C_TLMrev_lme: TWideStringField;
    PCP_SQ_C_PRQcod_lme: TWideStringField;
    PCP_SQ_C_PRQrev_lme: TWideStringField;
    PCP_SQ_C_CDPcod_lme: TWideStringField;
    PCP_SQ_C_CDPrev_lme: TWideStringField;
    PCP_SQ_C_MDEid_mde: TIntegerField;
    PCP_SQ_C_MDEdescricao: TWideStringField;
    PCP_SQ_C_MDEcod_lme: TWideStringField;
    PCP_SQ_C_MDErev_lme: TWideStringField;
    PCP_SQ_C_MEQid_meq: TIntegerField;
    PCP_SQ_C_MEQid_empresa: TIntegerField;
    PCP_SQ_C_MEQcod_equipamento: TWideStringField;
    PCP_SQ_C_MEQdescricao: TWideStringField;
    PCP_SQ_C_MEQid_mde: TIntegerField;
    PCP_SQ_C_MEQid_fabricante: TIntegerField;
    PCP_SQ_C_MEQnro_serie: TWideStringField;
    PCP_SQ_C_MEQdta_cadastro: TDateField;
    PCP_SQ_C_MEQdta_compra: TDateField;
    PCP_SQ_C_MEQnumero_nf: TIntegerField;
    PCP_SQ_C_MEQgara_validade: TDateField;
    PCP_SQ_C_MEQgara_existe: TBooleanField;
    PCP_SQ_C_MEQid_resp_lancto: TIntegerField;
    PCP_SQ_C_MEQtipo_mei: TIntegerField;
    PCP_SQ_C_MEQcod_lme: TWideStringField;
    PCP_SQ_C_MEQrev_lme: TWideStringField;
    PCP_SQ_C_PRPcod_lme: TWideStringField;
    PCP_SQ_C_PRPrev_lme: TWideStringField;
    PCP_SQ_C_RPTid_rpt: TIntegerField;
    PCP_SQ_C_RPTdescricao: TWideStringField;
    PCP_SQ_C_RPTcod_lme: TWideStringField;
    PCP_SQ_C_RPTrev_lme: TWideStringField;
    PCP_SQ_C_TPPcod_lme: TWideStringField;
    PCP_SQ_C_TPPrev_lme: TWideStringField;
    PCP_SQ_C_TINcod_lme: TWideStringField;
    PCP_SQ_C_TINrev_lme: TWideStringField;
    PCP_SQ_C_INScod_lme: TWideStringField;
    PCP_SQ_C_INSrev_lme: TWideStringField;
    PCP_SQ_C_CINcod_lme: TWideStringField;
    PCP_SQ_C_CINrev_lme: TWideStringField;
    PCP_SQ_M_VVEid_vve: TIntegerField;
    PCP_SQ_M_VVEid_veiculo: TIntegerField;
    PCP_SQ_M_VVEdta_cadastro: TDateField;
    PCP_SQ_M_VVEsituacao_limpeza: TBooleanField;
    PCP_SQ_M_VVEsituacao_revestimento: TBooleanField;
    PCP_SQ_M_VVEsituacao_madeiramento: TBooleanField;
    PCP_SQ_M_VVEsituacao_bau: TBooleanField;
    PCP_SQ_M_VVEid_responsavel: TIntegerField;
    PCP_SQ_M_VVEtexto_nao_conformidade: TWideStringField;
    PCP_SQ_M_VVEcod_lme: TWideStringField;
    PCP_SQ_M_VVErev_lme: TWideStringField;
    PCP_SQ_M_VVEint_nomevei: TWideStringField;
    PCP_SQ_M_VVEint_nomefun: TWideStringField;
    PCP_SQ_C_ORIid_ori: TIntegerField;
    PCP_SQ_C_ORIdescricao: TWideStringField;
    PCP_SQ_C_ORIcod_lme: TWideStringField;
    PCP_SQ_C_ORIrev_lme: TWideStringField;
    PCP_SQ_M_CRPid_crp: TIntegerField;
    PCP_SQ_M_CRPid_empresa: TIntegerField;
    PCP_SQ_M_CRPdta_emissao: TDateField;
    PCP_SQ_M_CRPnum_lote_crp: TWideStringField;
    PCP_SQ_M_CRPid_rpt: TIntegerField;
    PCP_SQ_M_CRPid_responsavel: TIntegerField;
    PCP_SQ_M_CRPid_almoxarifado: TIntegerField;
    PCP_SQ_M_CRPcod_lme: TWideStringField;
    PCP_SQ_M_CRPrev_lme: TWideStringField;
    PCP_SQ_M_LBEid_lbe: TIntegerField;
    PCP_SQ_M_LBEid_empresa: TIntegerField;
    PCP_SQ_M_LBEtipo: TWideStringField;
    PCP_SQ_M_LBEdta_laminacao: TDateField;
    PCP_SQ_M_LBEqtde: TFloatField;
    PCP_SQ_M_LBEid_setor: TIntegerField;
    PCP_SQ_M_LBEid_item_acabado: TIntegerField;
    PCP_SQ_M_LBEid_item_lamina: TIntegerField;
    PCP_SQ_M_LBEcod_lme: TWideStringField;
    PCP_SQ_M_LBErev_lme: TWideStringField;
    PCP_SQ_M_NCFid_ncf: TIntegerField;
    PCP_SQ_M_NCFid_setor_origem: TIntegerField;
    PCP_SQ_M_NCFid_empresa: TIntegerField;
    PCP_SQ_M_NCFtexto_nao_conformidade: TWideStringField;
    PCP_SQ_M_NCFid_item_motivo: TIntegerField;
    PCP_SQ_M_NCFid_cor: TIntegerField;
    PCP_SQ_M_NCFid_tamanho: TIntegerField;
    PCP_SQ_M_NCFmotivo: TWideStringField;
    PCP_SQ_M_NCFqtde_total_lote: TFloatField;
    PCP_SQ_M_NCFqtde_nao_conforme: TFloatField;
    PCP_SQ_M_NCFperc_nao_conforme: TFloatField;
    PCP_SQ_M_NCFqtde_troca_dev: TFloatField;
    PCP_SQ_M_NCFid_responsavel: TIntegerField;
    PCP_SQ_M_NCFdta_emissao: TDateField;
    PCP_SQ_M_NCFre_satisfatoria: TBooleanField;
    PCP_SQ_M_NCFre_especificacao: TWideStringField;
    PCP_SQ_M_NCFre_id_responsavel: TIntegerField;
    PCP_SQ_M_NCFana_prazo_eficaz: TIntegerField;
    PCP_SQ_M_NCFana_disp_eficaz: TIntegerField;
    PCP_SQ_M_NCFana_racp: TIntegerField;
    PCP_SQ_M_NCFana_func_informados: TIntegerField;
    PCP_SQ_M_NCFana_func_treinamento: TIntegerField;
    PCP_SQ_M_NCFana_comentarios: TWideStringField;
    PCP_SQ_M_NCFana_id_responsavel: TIntegerField;
    PCP_SQ_M_NCFana_id_resp_diretoria: TIntegerField;
    PCP_SQ_M_NCFcod_lme: TWideStringField;
    PCP_SQ_M_NCFrev_lme: TWideStringField;
    PCP_SQ_M_CACid_cac: TIntegerField;
    PCP_SQ_M_CACid_empresa: TIntegerField;
    PCP_SQ_M_CACdta_entrada: TDateField;
    PCP_SQ_M_CACid_setor_origem: TIntegerField;
    PCP_SQ_M_CACid_ori: TIntegerField;
    PCP_SQ_M_CACid_responsavel: TIntegerField;
    PCP_SQ_M_CACtexto_nao_conformidade: TWideStringField;
    PCP_SQ_M_CACfec_dta_eficacia_apos: TDateField;
    PCP_SQ_M_CACfec_dta_verificado: TDateField;
    PCP_SQ_M_CACfec_situacao_n_conf: TIntegerField;
    PCP_SQ_M_CACfec_func_informados: TBooleanField;
    PCP_SQ_M_CACfec_func_treinamento: TBooleanField;
    PCP_SQ_M_CACfec_comentarios: TWideStringField;
    PCP_SQ_M_CACfec_id_responsavel: TIntegerField;
    PCP_SQ_M_CACfec_id_resp_diretoria: TIntegerField;
    PCP_SQ_M_CACcod_lme: TWideStringField;
    PCP_SQ_M_CACrev_lme: TWideStringField;
    PCP_SQ_M_NCF_DISid_ncf: TIntegerField;
    PCP_SQ_M_NCF_DISid_ncf_dis: TIntegerField;
    PCP_SQ_M_NCF_DISid_dis: TIntegerField;
    PCP_SQ_M_NCF_DISid_responsavel: TIntegerField;
    PCP_SQ_M_NCF_DISprazo: TIntegerField;
    PCP_SQ_M_NCF_DISefetivo: TIntegerField;
    PCP_SQ_M_CAC_ANAid_cac: TIntegerField;
    PCP_SQ_M_CAC_ANAid_cac_ana: TIntegerField;
    PCP_SQ_M_CAC_ANAtipo_causa: TIntegerField;
    PCP_SQ_M_CAC_ANAsubcausa: TWideStringField;
    PCP_SQ_M_CAC_ANAmotivo: TWideStringField;
    PCP_SQ_M_CAC_ANAcausa_raiz: TWideStringField;
    PCP_SQ_M_CAC_ANAid_responsavel: TIntegerField;
    PCP_SQ_M_CAC_PLAid_cac: TIntegerField;
    PCP_SQ_M_CAC_PLAid_cac_pla: TIntegerField;
    PCP_SQ_M_CAC_PLAacao: TWideStringField;
    PCP_SQ_M_CAC_PLAid_responsavel: TIntegerField;
    PCP_SQ_M_CAC_PLAdta_prazo: TDateField;
    PCP_SQ_M_CAC_PLAdta_efetivo: TDateField;
    PCP_SQ_M_CRQcod_lme: TWideStringField;
    PCP_SQ_M_CRQrev_lme: TWideStringField;
    PCP_SQ_M_LPRid_lpr: TIntegerField;
    PCP_SQ_M_LPRdta_presenca: TDateField;
    PCP_SQ_M_LPRid_responsavel: TIntegerField;
    PCP_SQ_M_LPRid_resp_reuniao: TIntegerField;
    PCP_SQ_M_LPRmotivo_reuniao: TWideStringField;
    PCP_SQ_M_LPRconteudo_reuniao: TWideStringField;
    PCP_SQ_M_LPRobservacao: TWideStringField;
    PCP_SQ_M_LPRid_empresa: TIntegerField;
    PCP_SQ_M_LPRcod_lme: TWideStringField;
    PCP_SQ_M_LPRrev_lme: TWideStringField;
    PCP_SQ_M_LPR_FUNid_lpr: TIntegerField;
    PCP_SQ_M_LPR_FUNid_funcionario: TIntegerField;
    PCP_SQ_M_MCP_SERid_mcp: TIntegerField;
    PCP_SQ_M_MCP_SERid_mcp_ser: TIntegerField;
    PCP_SQ_M_MCP_SERid_item: TIntegerField;
    PCP_SQ_M_MCP_IVEid_mcp: TIntegerField;
    PCP_SQ_M_MCP_IVEid_mcp_ive: TIntegerField;
    PCP_SQ_M_MCP_IVEtexto_verificado: TWideStringField;
    PCP_SQ_M_MCP_IVEverificado: TBooleanField;
    PCP_SQ_M_MCP_IVEsubstituido: TBooleanField;
    PCP_SQ_M_MCP_IVElubrificado: TBooleanField;
    PCP_SQ_M_MCP_IVEajustado: TBooleanField;
    PCP_SQ_M_MCP_IVEcompletado: TBooleanField;
    PCP_SQ_M_MCP_IVEtrocado: TBooleanField;
    PCP_SQ_M_MCP_IVElimpado: TBooleanField;
    PCP_SQ_M_MCP_IVEreparado: TBooleanField;
    PCP_SQ_M_MCP_IVEoutros: TBooleanField;
    PCP_SQ_M_MCP_IVEtexto_outros: TWideStringField;
    PCP_SQ_M_MCP_IVEobservacao: TWideStringField;
    PCP_SQ_M_RVCid_rvc: TIntegerField;
    PCP_SQ_M_RVCdta_revisao: TDateField;
    PCP_SQ_M_RVCid_empresa: TIntegerField;
    PCP_SQ_M_RVCcol_tot_ite_rev: TIntegerField;
    PCP_SQ_M_RVCcol_tot_def_ide: TIntegerField;
    PCP_SQ_M_RVCcol_tot_col: TIntegerField;
    PCP_SQ_M_RVCcol_num_maior_def: TIntegerField;
    PCP_SQ_M_RVCdef_maior_nro_ocor: TIntegerField;
    PCP_SQ_M_RVCindice_defeitos: TFloatField;
    PCP_SQ_M_RVCcod_lme: TWideStringField;
    PCP_SQ_M_RVCrev_lme: TWideStringField;
    PCP_SQ_M_RVC_ITEid_rvc: TIntegerField;
    PCP_SQ_M_RVC_ITEid_rvc_ite: TIntegerField;
    PCP_SQ_M_RVC_ITEid_item: TIntegerField;
    PCP_SQ_M_RVC_ITEid_cor: TIntegerField;
    PCP_SQ_M_RVC_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_RVC_ITEid_responsavel: TIntegerField;
    PCP_SQ_M_RVC_ITEobservacao: TWideStringField;
    PCP_SQ_M_RVC_ITE_SETid_rvc: TIntegerField;
    PCP_SQ_M_RVC_ITE_SETid_rvc_ite: TIntegerField;
    PCP_SQ_M_RVC_ITE_SETid_setor: TIntegerField;
    PCP_SQ_M_RVC_ITE_SET_DEFid_rvc: TIntegerField;
    PCP_SQ_M_RVC_ITE_SET_DEFid_rvc_ite: TIntegerField;
    PCP_SQ_M_RVC_ITE_SET_DEFid_setor: TIntegerField;
    PCP_SQ_M_RVC_ITE_SET_DEFid_tdf: TIntegerField;
    PCP_SQ_M_PSCcod_lme: TWideStringField;
    PCP_SQ_M_PSCrev_lme: TWideStringField;
    PCP_SQ_M_ORScod_lme: TWideStringField;
    PCP_SQ_M_ORSrev_lme: TWideStringField;
    PCP_SQ_M_ROMcod_lme: TWideStringField;
    PCP_SQ_M_ROMrev_lme: TWideStringField;
    ctc_sq_m_faccod_lme: TWideStringField;
    ctc_sq_m_facrev_lme: TWideStringField;
    ctc_sq_m_avfcod_lme: TWideStringField;
    ctc_sq_m_avfrev_lme: TWideStringField;
    FAT_SQ_M_NFEint_nometra: TWideStringField;
    FAT_SQ_M_NFEint_endtra: TWideStringField;
    FAT_SQ_M_NFEint_cidtra: TWideStringField;
    FAT_SQ_M_NFEint_esttra: TWideStringField;
    FAT_SQ_M_NFEint_cnptra: TWideStringField;
    FAT_SQ_M_NFEint_instra: TWideStringField;
    CAD_SQ_C_CLI_BCO: TSQLDataSet;
    FAT_SQ_M_NFE_NFF: TSQLDataSet;
    FAT_SQ_M_NFEtipo_cte: TIntegerField;
    CAD_SQ_C_FORtipo_fornecedor: TIntegerField;
    FIN_SQ_M_CON: TSQLDataSet;
    FIN_SQ_M_CON_CXB_DET: TSQLDataSet;
    FIN_DP_M_CON: TDataSetProvider;
    FIN_DS_M_CON: TDataSource;
    FIN_SQ_M_CONid_conciliacao: TIntegerField;
    FIN_SQ_M_CONdta_conciliacao: TDateField;
    FIN_SQ_M_CONid_conta: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_conciliacao: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_controle: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_plano: TWideStringField;
    FIN_SQ_M_CON_CXB_DETid_conta: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CON_CXB_DETvlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CON_CXB_DETid_titulo: TIntegerField;
    FIN_SQ_M_CON_CXB_DEThistorico: TWideStringField;
    CAD_SQ_C_FORint_nomecid: TWideStringField;
    CAD_SQ_C_TIFgera_pag: TBooleanField;
    CMP_SQ_M_SOL_ITEid_solicitacao: TIntegerField;
    CMP_SQ_M_SOL_ITEid_item: TIntegerField;
    CMP_SQ_M_SOL_ITEqtde: TFloatField;
    CMP_SQ_M_SOL_ITEobs: TWideStringField;
    CMP_SQ_M_SOL_ITEid_cor: TIntegerField;
    CMP_SQ_M_SOL_ITEid_tamanho: TIntegerField;
    CMP_SQ_M_SOL_ITEid_busca_item: TWideStringField;
    CMP_SQ_M_SOL_ITEint_nomeite: TWideStringField;
    CMP_SQ_M_SOL_ITEint_nomecor: TWideStringField;
    CMP_SQ_M_SOL_ITEint_nometam: TWideStringField;
    CMP_SQ_M_SOL_ITEint_undcom: TWideStringField;
    CMP_SQ_M_COT_FIT_APR: TSQLDataSet;
    CMP_DS_M_COT_FIT: TDataSource;
    OFI_SQ_M_AGE: TSQLDataSet;
    OFI_SQ_M_OCV: TSQLDataSet;
    OFI_SQ_M_OCV_ITE: TSQLDataSet;
    OFI_SQ_M_ORV: TSQLDataSet;
    OFI_SQ_M_ORV_DES: TSQLDataSet;
    OFI_SQ_M_ORV_ITE: TSQLDataSet;
    OFI_SQ_M_ORV_TIT: TSQLDataSet;
    OFI_DP_M_ORV: TDataSetProvider;
    OFI_DP_M_OCV: TDataSetProvider;
    OFI_DP_M_AGE: TDataSetProvider;
    OFI_DS_M_OCV: TDataSource;
    OFI_DS_M_ORV: TDataSource;
    OFI_SQ_M_OCVid_orcamento: TIntegerField;
    OFI_SQ_M_OCVid_empresa: TIntegerField;
    OFI_SQ_M_OCVplaca: TWideStringField;
    OFI_SQ_M_OCVkm_atual: TIntegerField;
    OFI_SQ_M_OCVdta_orcamento: TDateField;
    OFI_SQ_M_OCVdta_validade: TDateField;
    OFI_SQ_M_OCVid_cliente: TIntegerField;
    OFI_SQ_M_OCVnome_cliente: TWideStringField;
    OFI_SQ_M_OCVid_funcionario: TIntegerField;
    OFI_SQ_M_OCVid_analista: TIntegerField;
    OFI_SQ_M_OCVid_condicao_pag: TIntegerField;
    OFI_SQ_M_OCVvlr_servicos: TFMTBCDField;
    OFI_SQ_M_OCVvlr_produtos: TFMTBCDField;
    OFI_SQ_M_OCVvlr_terceiro: TFMTBCDField;
    OFI_SQ_M_OCVdes_servicos: TFMTBCDField;
    OFI_SQ_M_OCVdes_produtos: TFMTBCDField;
    OFI_SQ_M_OCVvlr_total: TFMTBCDField;
    OFI_SQ_M_OCVstatus: TIntegerField;
    OFI_SQ_M_OCVint_nomefuc: TWideStringField;
    OFI_SQ_M_OCVint_nomeana: TWideStringField;
    OFI_SQ_M_OCVint_nomecpg: TWideStringField;
    OFI_SQ_M_OCV_ITEid_orcamento: TIntegerField;
    OFI_SQ_M_OCV_ITEid_sequencia: TIntegerField;
    OFI_SQ_M_OCV_ITEid_item: TIntegerField;
    OFI_SQ_M_OCV_ITEid_busca_item: TWideStringField;
    OFI_SQ_M_OCV_ITEqtde: TFloatField;
    OFI_SQ_M_OCV_ITEvlr_unitario: TFMTBCDField;
    OFI_SQ_M_OCV_ITEvlr_bruto: TFMTBCDField;
    OFI_SQ_M_OCV_ITEper_desconto: TFloatField;
    OFI_SQ_M_OCV_ITEvlr_desconto: TFMTBCDField;
    OFI_SQ_M_OCV_ITEvlr_liquido: TFMTBCDField;
    OFI_SQ_M_OCV_ITEid_terceiro: TIntegerField;
    OFI_SQ_M_OCV_ITEint_nomeite: TWideStringField;
    OFI_SQ_M_OCV_ITEint_nomeund: TWideStringField;
    OFI_SQ_M_OCV_ITEint_nomeapl: TWideStringField;
    OFI_SQ_M_OCV_ITEint_nomeref: TWideStringField;
    OFI_SQ_M_OCV_ITEint_nometer: TWideStringField;
    OFI_SQ_M_ORVid_ordem: TIntegerField;
    OFI_SQ_M_ORVid_empresa: TIntegerField;
    OFI_SQ_M_ORVdta_emissao: TDateField;
    OFI_SQ_M_ORVdta_entrega: TDateField;
    OFI_SQ_M_ORVid_cliente: TIntegerField;
    OFI_SQ_M_ORVid_veiculo: TIntegerField;
    OFI_SQ_M_ORVkm_atual: TIntegerField;
    OFI_SQ_M_ORVtanque_combus: TIntegerField;
    OFI_SQ_M_ORVid_forma_pag: TIntegerField;
    OFI_SQ_M_ORVid_condicao_pag: TIntegerField;
    OFI_SQ_M_ORVid_analista: TIntegerField;
    OFI_SQ_M_ORVid_orcamento: TIntegerField;
    OFI_SQ_M_ORVobs_reclamacao: TWideStringField;
    OFI_SQ_M_ORVobs_problema: TWideStringField;
    OFI_SQ_M_ORVstatus: TIntegerField;
    OFI_SQ_M_ORVint_nomecli: TWideStringField;
    OFI_SQ_M_ORVint_telfix: TWideStringField;
    OFI_SQ_M_ORVint_telmov: TWideStringField;
    OFI_SQ_M_ORVint_nomecom: TWideMemoField;
    OFI_SQ_M_ORV_DESid_ordem: TIntegerField;
    OFI_SQ_M_ORV_DESid_sequencia: TIntegerField;
    OFI_SQ_M_ORV_DESdta_despesa: TDateField;
    OFI_SQ_M_ORV_DESlocal: TWideStringField;
    OFI_SQ_M_ORV_DEStipo: TIntegerField;
    OFI_SQ_M_ORV_DESvlr_despesa: TFMTBCDField;
    OFI_SQ_M_ORV_TITid_ordem: TIntegerField;
    OFI_SQ_M_ORV_TITid_titulo: TIntegerField;
    OFI_SQ_M_ORV_TITdias: TIntegerField;
    OFI_SQ_M_ORV_TITdta_vencimento: TDateField;
    OFI_SQ_M_ORV_TITvlr_titulo: TFMTBCDField;
    OFI_SQ_M_ORV_TITche_banco: TWideStringField;
    OFI_SQ_M_ORV_TITche_agencia: TWideStringField;
    OFI_SQ_M_ORV_TITche_conta: TIntegerField;
    OFI_SQ_M_ORV_TITche_numero: TIntegerField;
    OFI_SQ_M_ORV_TITche_emitente: TWideStringField;
    OFI_SQ_M_ORV_TITid_forma_pag: TIntegerField;
    OFI_SQ_M_ORV_TITint_nomefpg: TWideStringField;
    CMP_SQ_M_COT_ITEid_busca_item: TWideStringField;
    CMP_SQ_M_COT_ITEint_undcom: TWideStringField;
    CMP_SQ_M_COT_FITint_undcom: TWideStringField;
    CMP_SQ_M_COT_FITint_nomefor: TWideStringField;
    CMP_SQ_M_COTsituacao: TIntegerField;
    PCP_SQ_R_RAAid_raa: TIntegerField;
    PCP_SQ_R_RAAid_empresa: TIntegerField;
    PCP_SQ_R_RAAdta_emissao: TDateField;
    PCP_SQ_R_RAAcod_lme: TWideStringField;
    PCP_SQ_R_RAArev_lme: TWideStringField;
    PCP_SQ_R_RAAnro_raa: TWideStringField;
    PCP_SQ_R_RAAid_item: TIntegerField;
    PCP_SQ_R_RAAdta_recebimento_item: TDateField;
    PCP_SQ_R_RAAcodigo_fabrica: TWideStringField;
    PCP_SQ_R_RAAid_fornecedor: TIntegerField;
    PCP_SQ_R_RAAid_fabricante: TIntegerField;
    PCP_SQ_R_RAAqtde_amostra: TFloatField;
    PCP_SQ_R_RAAid_setor: TIntegerField;
    PCP_SQ_R_RAApergunta_1: TIntegerField;
    PCP_SQ_R_RAApergunta_2: TIntegerField;
    PCP_SQ_R_RAApergunta_3: TIntegerField;
    PCP_SQ_R_RAApergunta_4: TIntegerField;
    PCP_SQ_R_RAApergunta_5: TIntegerField;
    PCP_SQ_R_RAApergunta_6: TIntegerField;
    PCP_SQ_R_RAApergunta_7: TIntegerField;
    PCP_SQ_R_RAApergunta_8: TIntegerField;
    PCP_SQ_R_RAAresultado: TIntegerField;
    PCP_SQ_R_RAAincorpora_item: TIntegerField;
    PCP_SQ_R_RAAid_analista: TIntegerField;
    PCP_SQ_R_RAAdta_analise: TDateField;
    PCP_SQ_R_RAAobservacao: TWideStringField;
    PCP_SQ_R_RAAid_cor: TIntegerField;
    PCP_SQ_R_RAAid_tamanho: TIntegerField;
    PCP_SQ_R_RAAemp_fantasia: TWideStringField;
    PCP_SQ_R_RAAemp_endereco: TWideStringField;
    PCP_SQ_R_RAAemp_numero: TWideStringField;
    PCP_SQ_R_RAAemp_bairro: TWideStringField;
    PCP_SQ_R_RAAid_cidade: TWideStringField;
    PCP_SQ_R_RAAint_uf: TWideStringField;
    PCP_SQ_R_RAAemp_cep: TWideStringField;
    PCP_SQ_R_RAAemp_telefone: TWideStringField;
    PCP_SQ_R_RAAfornecedor: TWideStringField;
    PCP_SQ_R_RAAsetor: TWideStringField;
    PCP_SQ_R_RAAfabricante: TWideStringField;
    PCP_SQ_R_RAAanalista: TWideStringField;
    PCP_SQ_R_RAAdesc_item: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_1: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_2: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_3: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_4: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_5: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_6: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_7: TWideMemoField;
    PCP_SQ_R_RAAdesc_pergunta_8: TWideMemoField;
    PCP_SQ_R_RAAdesc_resultado: TWideMemoField;
    PCP_SQ_R_RAAdesc_incorpora_item: TWideMemoField;
    FIN_SQ_M_CXAint_nomepar: TWideStringField;
    FIN_SQ_R_PAG_ABE_PPG: TSQLDataSet;
    FIN_SQ_R_PAG_ABE_PRR: TSQLDataSet;
    FIN_DP_R_PAG_ABE_PPG: TDataSetProvider;
    FIN_DP_R_PAG_ABE_PRR: TDataSetProvider;
    CMP_SQ_M_SOL_ITEid_sequencia: TIntegerField;
    CMP_SQ_M_COT_ITEid_sequencia: TIntegerField;
    PCP_SQ_R_RAA_ITE: TSQLDataSet;
    PCP_DS_R_RAA: TDataSource;
    PCP_SQ_R_RAA_ITEid_raa: TIntegerField;
    PCP_SQ_R_RAA_ITEid_raa_ite: TIntegerField;
    PCP_SQ_R_RAA_ITEacao_necessaria: TWideStringField;
    PCP_SQ_R_RAA_ITEid_responsavel: TIntegerField;
    PCP_SQ_R_RAA_ITEdta_prazo: TDateField;
    PCP_SQ_R_RAA_ITEdta_executado: TDateField;
    PCP_SQ_R_RAA_ITEobservacao: TWideStringField;
    PCP_SQ_R_RAA_ITEint_nomeres: TWideStringField;
    FIN_SQ_M_CTAdta_movimento: TDateField;
    FIN_SQ_M_CTAconciliado: TBooleanField;
    CMP_SQ_M_COT_FITdta_aprovacao: TDateField;
    FIN_SQ_M_PBX_TITatraso: TIntegerField;
    FIN_SQ_M_PAGper_juros: TFloatField;
    FIN_SQ_M_PAGper_multa: TFloatField;
    CMP_SQ_M_COT_FITipi: TBooleanField;
    CMP_SQ_M_COT_FIT_APRid_cotacao: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_fornecedor: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_item: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_pedido: TIntegerField;
    CMP_SQ_M_COT_FIT_APRint_aprovado: TBooleanField;
    CMP_SQ_M_COT_FIT_APRint_disponibilidade: TBooleanField;
    CMP_SQ_M_COT_FIT_APRint_dta_aprovado: TDateField;
    CMP_SQ_M_COT_FIT_APRint_frete: TIntegerField;
    CMP_SQ_M_COT_FIT_APRint_ipi: TBooleanField;
    CMP_SQ_M_COT_FIT_APRint_per_desconto: TFloatField;
    CMP_SQ_M_COT_FIT_APRint_prazo: TIntegerField;
    CMP_SQ_M_COT_FIT_APRint_qtde: TFloatField;
    CMP_SQ_M_COT_FIT_APRint_vlr_desconto: TFMTBCDField;
    CMP_SQ_M_COT_FIT_APRint_vlr_total: TFMTBCDField;
    CMP_SQ_M_COT_FIT_APRint_vlr_unitario: TFMTBCDField;
    BUS_SQ_C_CTC: TSQLDataSet;
    BUS_DP_C_CTC: TDataSetProvider;
    CMP_SQ_M_COT_FIT_APRdta_aprovacao: TDateField;
    CMP_SQ_M_COT_FIT_APRid_responsavel: TIntegerField;
    CAD_SQ_C_CTCtipo: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_cor: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_tamanho: TIntegerField;
    CMP_SQ_M_COT_FIT_APRint_nomeres: TWideStringField;
    CMP_SQ_M_COT_FIT_APRint_nomefor: TWideStringField;
    CMP_SQ_M_COT_FIT_APRint_nomeite: TWideStringField;
    CMP_SQ_M_COT_FIT_APRint_nomeund: TWideStringField;
    CMP_SQ_M_COT_FIT_APRint_nometam: TWideStringField;
    CMP_SQ_M_COT_FIT_APRint_nomecor: TWideStringField;
    CMP_SQ_M_COT_FITid_sequencia: TIntegerField;
    CMP_SQ_M_COT_FIT_APRid_sequencia: TIntegerField;
    CAD_SQ_C_TRI_REGid_tributo: TIntegerField;
    CAD_SQ_C_TRI_REGid_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_TRI_REGuf: TWideStringField;
    CAD_SQ_C_TRI_REGcnt_id_st_icm: TWideStringField;
    CAD_SQ_C_TRI_REGcnt_reducao: TFloatField;
    CAD_SQ_C_TRI_REGcnt_aliquota: TFloatField;
    CAD_SQ_C_TRI_REGnct_id_st_icm: TWideStringField;
    CAD_SQ_C_TRI_REGnct_reducao: TFloatField;
    CAD_SQ_C_TRI_REGnct_aliquota: TFloatField;
    CAD_SQ_C_TRI_REGid_inf: TIntegerField;
    CAD_SQ_C_TRI_REGid_empresa: TIntegerField;
    CAD_SQ_C_TRI_REGint_nometme: TWideStringField;
    CAD_SQ_C_SET_TDSint_nometds: TWideStringField;
    CAD_SQ_C_PAR_NFEcert_senha: TWideStringField;
    CAD_SQ_C_FUN_CRG: TSQLDataSet;
    CAD_DS_C_FUN: TDataSource;
    PCP_SQ_M_NCFint_nomeite: TWideStringField;
    PCP_SQ_M_NCFint_nomeres: TWideStringField;
    PCP_SQ_M_NCFint_nomeset: TWideStringField;
    PCP_SQ_M_NCFint_nomecor: TWideStringField;
    PCP_SQ_M_NCFint_nometam: TWideStringField;
    PCP_SQ_M_NCF_DISint_nomedis: TWideStringField;
    CAD_SQ_C_TRI_REGint_nomeemp: TWideStringField;
    CAD_SQ_C_TRI_REGint_nomeinf: TWideStringField;
    CAD_SQ_C_VEIint_nomemve: TWideStringField;
    CAD_SQ_C_VEIint_nomecor: TWideStringField;
    CAD_SQ_C_FUN_CRGid_funcionario: TIntegerField;
    CAD_SQ_C_FUN_CRGid_cargo: TIntegerField;
    CAD_SQ_C_FUN_CRGint_nomecrg: TWideStringField;
    PCP_SQ_M_RVC_ITEint_nomeite: TWideStringField;
    PCP_SQ_M_RVC_ITEint_nomefuc: TWideStringField;
    PCP_SQ_M_RVC_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_RVC_ITEint_nometam: TWideStringField;
    PCP_SQ_M_RVC_ITE_SETint_nomeset: TWideStringField;
    PCP_SQ_M_NCFre_dta_resp: TDateField;
    PCP_SQ_M_NCFana_dta_resp: TDateField;
    PCP_SQ_M_NCFana_dta_diretoria: TDateField;
    FIN_SQ_M_CONint_nomectc: TWideStringField;
    PCP_SQ_M_MCPid_mcp: TIntegerField;
    PCP_SQ_M_MCPid_empresa: TIntegerField;
    PCP_SQ_M_MCPproblema: TWideStringField;
    PCP_SQ_M_MCPid_setor: TIntegerField;
    PCP_SQ_M_MCPid_meq: TIntegerField;
    PCP_SQ_M_MCPtotal_pecas: TFMTBCDField;
    PCP_SQ_M_MCPtotal_mobra: TFMTBCDField;
    PCP_SQ_M_MCPtotal_pecas_garantia: TFMTBCDField;
    PCP_SQ_M_MCPtotal_servicos_garantia: TFMTBCDField;
    PCP_SQ_M_MCPtotal_garantia: TFMTBCDField;
    PCP_SQ_M_MCPtotal_pecas_mobra: TFMTBCDField;
    PCP_SQ_M_MCPid_responsavel: TIntegerField;
    PCP_SQ_M_MCPid_resp_autorizou: TIntegerField;
    PCP_SQ_M_MCPdta_autorizacao: TDateField;
    PCP_SQ_M_MCPdta_inicio_atend: TDateField;
    PCP_SQ_M_MCPhora_inicio_atend: TSQLTimeStampField;
    PCP_SQ_M_MCPdta_termino_atend: TDateField;
    PCP_SQ_M_MCPhora_termino_atend: TSQLTimeStampField;
    PCP_SQ_M_MCPtipo_acao: TIntegerField;
    PCP_SQ_M_MCPtipo_manutencao: TIntegerField;
    PCP_SQ_M_MCPcod_lme: TWideStringField;
    PCP_SQ_M_MCPrev_lme: TWideStringField;
    EST_SQ_M_FES_ALMid_item: TIntegerField;
    EST_SQ_M_FES_ALMid_empresa: TIntegerField;
    EST_SQ_M_FES_ALMid_cor: TIntegerField;
    EST_SQ_M_FES_ALMid_tamanho: TIntegerField;
    EST_SQ_M_FES_ALMid_almoxarifado: TIntegerField;
    EST_SQ_M_FES_ALMdata_ult_movimento: TDateField;
    EST_SQ_M_FES_ALMdata_ult_inventario: TDateField;
    EST_SQ_M_FES_ALMqtde_entrada: TFloatField;
    EST_SQ_M_FES_ALMqtde_saida: TFloatField;
    EST_SQ_M_FES_ALMsaldo_fisico: TFloatField;
    EST_SQ_M_FES_ALMint_nomealm: TWideStringField;
    EST_SQ_M_FES_ALMint_nomeemp: TWideStringField;
    EST_SQ_M_FES_ALMint_nomecor: TWideStringField;
    EST_SQ_M_FES_ALMint_nometam: TWideStringField;
    PCP_SQ_C_PRPid_prp: TIntegerField;
    PCP_SQ_C_PRQid_prq: TIntegerField;
    CAD_SQ_C_VEIid_cor: TIntegerField;
    FAT_SQ_M_NFEnfe_finalidade: TIntegerField;
    CMP_SQ_M_PEDid_pedido: TIntegerField;
    CMP_SQ_M_PEDid_empresa: TIntegerField;
    CMP_SQ_M_PEDid_fornecedor: TIntegerField;
    CMP_SQ_M_PEDcod_lme: TWideStringField;
    CMP_SQ_M_PEDrev_lme: TWideStringField;
    CMP_SQ_M_PEDdta_pedido: TDateField;
    CMP_SQ_M_PEDdta_entrega: TDateField;
    CMP_SQ_M_PEDid_responsavel: TIntegerField;
    CMP_SQ_M_PEDobservacao: TWideStringField;
    CMP_SQ_M_PEDstatus: TIntegerField;
    CMP_SQ_M_PEDvlr_ipi: TFMTBCDField;
    CMP_SQ_M_PEDvlr_bruto: TFMTBCDField;
    CMP_SQ_M_PEDvlr_desconto: TFMTBCDField;
    CMP_SQ_M_PEDvlr_liquido: TFMTBCDField;
    CMP_SQ_M_PEDcondicoes_pagamento: TWideStringField;
    CMP_SQ_M_PEDvlr_frete: TFMTBCDField;
    CMP_SQ_M_PEDint_nomefor: TWideStringField;
    CMP_SQ_M_PEDint_nomefun: TWideStringField;
    CMP_SQ_M_PED_ITEid_pedido: TIntegerField;
    CMP_SQ_M_PED_ITEid_sequencia: TIntegerField;
    CMP_SQ_M_PED_ITEid_item: TIntegerField;
    CMP_SQ_M_PED_ITEqtde: TFloatField;
    CMP_SQ_M_PED_ITEvlr_unitario: TFMTBCDField;
    CMP_SQ_M_PED_ITEper_desconto: TFloatField;
    CMP_SQ_M_PED_ITEvlr_desconto: TFMTBCDField;
    CMP_SQ_M_PED_ITEper_ipi: TFloatField;
    CMP_SQ_M_PED_ITEvlr_ipi: TFMTBCDField;
    CMP_SQ_M_PED_ITEvlr_bruto: TFMTBCDField;
    CMP_SQ_M_PED_ITEvlr_liquido: TFMTBCDField;
    CMP_SQ_M_PED_ITEqtde_baixada: TFloatField;
    CMP_SQ_M_PED_ITEentre_prazo: TIntegerField;
    CMP_SQ_M_PED_ITEper_frete: TFloatField;
    CMP_SQ_M_PED_ITEvlr_frete: TFMTBCDField;
    CMP_SQ_M_PED_ITEid_tamanho: TIntegerField;
    CMP_SQ_M_PED_ITEid_cor: TIntegerField;
    CMP_SQ_M_PED_ITEid_busca_item: TWideStringField;
    CMP_SQ_M_PED_ITEint_nomeite: TWideStringField;
    CMP_SQ_M_PED_ITEint_nomecor: TWideStringField;
    CMP_SQ_M_PED_ITEint_nometam: TWideStringField;
    CMP_SQ_M_PED_ITEint_nomeund: TWideStringField;
    CMP_SQ_M_SOLid_solicitacao: TIntegerField;
    CMP_SQ_M_SOLid_empresa: TIntegerField;
    CMP_SQ_M_SOLid_funcionario: TIntegerField;
    CMP_SQ_M_SOLid_setor: TIntegerField;
    CMP_SQ_M_SOLdta_solicitacao: TDateField;
    CMP_SQ_M_SOLstatus: TIntegerField;
    CMP_SQ_M_SOLobs: TWideStringField;
    CMP_SQ_M_SOLmotivo: TWideStringField;
    CMP_SQ_M_SOLid_op: TIntegerField;
    CMP_SQ_M_SOLid_cotacao_imp: TIntegerField;
    CMP_SQ_M_SOLid_pedido_imp: TIntegerField;
    CMP_SQ_M_SOLselecao: TBooleanField;
    CMP_SQ_M_SOLint_nomeset: TWideStringField;
    CMP_SQ_M_SOLint_nomefun: TWideStringField;
    FAT_SQ_M_IQM_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_IQM_ITEid_item: TIntegerField;
    FAT_SQ_M_IQM_ITEnro_lote_fabric_produto: TWideStringField;
    FAT_SQ_M_IQM_ITEcert_data: TDateField;
    FAT_SQ_M_IQM_ITEcert_numero: TWideStringField;
    FAT_SQ_M_IQM_ITEid_responsavel: TIntegerField;
    FAT_SQ_M_IQM_ITEcnd_comercial: TIntegerField;
    FAT_SQ_M_IQM_ITEqtd_pc_nf: TIntegerField;
    FAT_SQ_M_IQM_ITEpres_produto: TIntegerField;
    FAT_SQ_M_IQM_ITEcert_qualidade: TIntegerField;
    FAT_SQ_M_IQM_ITEresultado: TIntegerField;
    FAT_SQ_M_IQM_ITEdemerito: TIntegerField;
    FAT_SQ_M_IQM_ITEorigem: TWideStringField;
    FAT_SQ_M_IQM_ITEqtd_nc: TFloatField;
    FAT_SQ_M_IQM_ITEper_lot_rec: TFloatField;
    FAT_SQ_M_IQM_ITEsituacao: TWideStringField;
    FAT_SQ_M_IQM_ITEdisposicao: TIntegerField;
    FAT_SQ_M_IQM_ITEapro_gerente: TIntegerField;
    FAT_SQ_M_IQM_ITEapro_data: TDateField;
    FAT_SQ_M_IQM_ITEexec_por: TIntegerField;
    FAT_SQ_M_IQM_ITEdta_finalisado: TDateField;
    FAT_SQ_M_IQM_ITEplano_acao_forn: TBooleanField;
    FAT_SQ_M_IQM_ITEcomentarios: TWideStringField;
    FAT_SQ_M_IQM_ITEqualidade: TIntegerField;
    FAT_SQ_M_IQM_ITEdta_inspecao: TDateField;
    FAT_SQ_M_IQM_ITEespecificado: TWideStringField;
    FAT_SQ_M_IQM_ITEencontrado: TWideStringField;
    FAT_SQ_M_IQM_ITEnumero_laudo: TWideStringField;
    FAT_SQ_M_IQM_ITEdata_certif_qualidade: TDateField;
    FAT_SQ_M_IQM_ITEid_cor: TIntegerField;
    FAT_SQ_M_IQM_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_IQM_ITEcod_lme: TWideStringField;
    FAT_SQ_M_IQM_ITErev_lme: TWideStringField;
    CMP_SQ_M_PED_ITEqtde_a_baixar: TFloatField;
    CMP_SQ_M_PEDid_cotacao: TIntegerField;
    CMP_SQ_M_PEDid_solicitacao: TIntegerField;
    CMP_SQ_M_SOLcod_lme: TWideStringField;
    CMP_SQ_M_SOLrev_lme: TWideStringField;
    PCP_SQ_M_MCPint_nomemeq: TWideStringField;
    PCP_SQ_M_MCPint_nomerau: TWideStringField;
    PCP_SQ_M_MCPint_nomeset: TWideStringField;
    PCP_SQ_M_CMEid_meq: TIntegerField;
    PCP_SQ_M_CMEid_responsavel: TIntegerField;
    PCP_SQ_M_CMEdta_lancto: TDateField;
    PCP_SQ_M_CME_MEQid_meq: TIntegerField;
    PCP_SQ_M_CME_MEQid_setor: TIntegerField;
    PCP_SQ_M_CME_MEQnro_semana: TIntegerField;
    PCP_SQ_M_CME_MEQmes: TIntegerField;
    PCP_SQ_M_CME_MEQano: TIntegerField;
    PCP_SQ_M_CME_MEQtipo_controle: TIntegerField;
    PCP_SQ_M_CME_MEQtipo_manutencao: TIntegerField;
    PCP_SQ_M_CME_MEQfrequencia: TIntegerField;
    PCP_SQ_M_CME_MEQrealizado: TBooleanField;
    PCP_SQ_M_CMEcod_lme: TWideStringField;
    PCP_SQ_M_CMErev_lme: TWideStringField;
    BUS_SQ_M_CME_MEQ: TSQLDataSet;
    BUS_DP_M_CME_MEQ: TDataSetProvider;
    PCP_SQ_M_CME_MEQid_cme_meq: TIntegerField;
    PCP_SQ_M_CMEint_nomefres: TWideStringField;
    PCP_SQ_M_MCPid_cme_meq: TIntegerField;
    CMP_SQ_M_COTaprovada: TBooleanField;
    EST_SQ_M_MALid_mal: TIntegerField;
    EST_SQ_M_MALid_empresa: TIntegerField;
    EST_SQ_M_MALdata: TDateField;
    EST_SQ_M_MALid_almoxarifado: TIntegerField;
    EST_SQ_M_MALid_tipo_mov_estoque: TIntegerField;
    EST_SQ_M_MALid_setor: TIntegerField;
    EST_SQ_M_MALid_responsavel: TIntegerField;
    EST_SQ_M_MALobservacao: TWideStringField;
    EST_SQ_M_MALtipo: TIntegerField;
    EST_SQ_M_MALcod_lme: TWideStringField;
    EST_SQ_M_MALrev_lme: TWideStringField;
    EST_SQ_M_MALint_nomealm: TWideStringField;
    EST_SQ_M_MALint_nometme: TWideStringField;
    EST_SQ_M_MALint_nomeset: TWideStringField;
    EST_SQ_M_MALint_nomeres: TWideStringField;
    PCP_SQ_M_CMEint_nomemeq: TWideStringField;
    PCP_SQ_M_CME_MEQint_nomeset: TWideStringField;
    PCP_SQ_M_CME_MEQint_tipocon: TWideMemoField;
    PCP_SQ_M_CME_MEQint_tipoman: TWideMemoField;
    PCP_SQ_M_CME_MEQint_frequen: TWideMemoField;
    PCP_SQ_M_CME_MEQint_numesem: TWideMemoField;
    PCP_SQ_M_CME_MEQint_nomemes: TWideMemoField;
    FAT_SQ_M_NFE_NFFid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_NFFid_fornecedor: TIntegerField;
    FAT_SQ_M_NFE_NFFnota_frete: TIntegerField;
    FAT_SQ_M_NFE_NFFvlr_nota: TFMTBCDField;
    FAT_SQ_M_NFE_NFFvlr_frete: TFMTBCDField;
    FAT_SQ_M_NFE_NFFint_nomefor: TWideStringField;
    CAD_SQ_C_PAR_NFEpath_status: TWideStringField;
    CAD_SQ_C_PAR_NFEpath_carta: TWideStringField;
    CAD_SQ_C_PAR_NFEpath_pdf: TWideStringField;
    FAT_SQ_M_NFEpath_xml: TWideStringField;
    FAT_SQ_M_NFEnfref_chave: TWideStringField;
    PCP_SQ_M_MCP_SERint_nomeite: TWideStringField;
    PCP_SQ_M_MCP_SERint_nomeund: TWideStringField;
    PCP_SQ_M_MCPint_nomeres: TWideStringField;
    PCP_SQ_M_RVC_ITE_SET_DEFint_nometdf: TWideStringField;
    PCP_SQ_M_LPRint_nomeres: TWideStringField;
    PCP_SQ_M_CACint_nomeres: TWideStringField;
    PCP_SQ_M_CAC_PLAint_nomeres: TWideStringField;
    PCP_SQ_M_CAC_ANAint_nomeres: TWideStringField;
    FAT_SQ_M_NFEint_cnpjcpf: TWideMemoField;
    FAT_SQ_M_NFEint_pessoa: TIntegerField;
    FAT_SQ_M_NFEint_telefone: TWideMemoField;
    FAT_SQ_M_NFEint_doc_ie: TWideMemoField;
    FAT_SQ_M_NFEint_email: TWideMemoField;
    FAT_SQ_M_NFEint_cep: TWideMemoField;
    FAT_SQ_M_NFEint_endereco: TWideMemoField;
    FAT_SQ_M_NFEint_estado: TWideMemoField;
    FAT_SQ_M_NFEint_bairro: TWideMemoField;
    FAT_SQ_M_NFEint_numero: TWideMemoField;
    FAT_SQ_M_NFEint_complemento: TWideMemoField;
    FAT_SQ_M_NFEint_cod_cidade: TWideMemoField;
    FAT_SQ_M_NFEint_nom_cidade: TWideMemoField;
    FAT_SQ_M_NFE_ITEint_id_ncm: TWideStringField;
    PCP_SQ_M_CACtipo_acao: TIntegerField;
    FAT_SQ_M_PED_ITEint_nometam: TWideStringField;
    CAD_SQ_C_NCMper_imposto: TFloatField;
    FAT_SQ_M_NFEimp_valor: TFMTBCDField;
    FAT_SQ_M_NFEtri_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEtri_valor: TFMTBCDField;
    FAT_SQ_M_NFE_ITEtri_indice: TFloatField;
    CAD_SQ_C_PARint_id_cnae: TWideStringField;
    PCP_SQ_M_LPR_FUNint_nomeres: TWideStringField;
    FAT_SQ_M_NFEtra_placa: TWideStringField;
    FAT_SQ_M_NFEtra_uf: TWideStringField;
    FAT_SQ_M_NFEtra_rntc: TWideStringField;
    FAT_SQ_M_NFEtra_qtde_vol: TFloatField;
    FAT_SQ_M_NFEtra_especie: TWideStringField;
    FAT_SQ_M_NFEtra_marca: TWideStringField;
    FAT_SQ_M_NFEtra_num_vol: TWideStringField;
    PCP_SQ_M_LPRhora_ini: TSQLTimeStampField;
    PCP_SQ_M_LPRhora_fin: TSQLTimeStampField;
    PCP_SQ_M_LPRint_cargahora: TTimeField;
    FAT_SQ_M_NFEint_indpag: TIntegerField;
    CAD_SQ_C_FORcod_pais: TWideStringField;
    FAT_SQ_M_NFEint_cod_pais: TWideMemoField;
    FAT_SQ_M_NFEint_nom_pais: TWideMemoField;
    PCP_SQ_M_CRP_ITEid_crp: TIntegerField;
    PCP_SQ_M_CRP_ITEid_item: TIntegerField;
    PCP_SQ_M_CRP_ITEid_cor: TIntegerField;
    PCP_SQ_M_CRP_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_CRP_ITEnum_lote: TWideStringField;
    PCP_SQ_M_CRP_ITEqtde: TFloatField;
    PCP_SQ_M_CRP_ITEqtde_baixada: TFloatField;
    PCP_SQ_M_CRP_ITEint_nomeite: TWideStringField;
    PCP_SQ_M_CRP_ITEint_nomeund: TWideStringField;
    PCP_SQ_M_CRP_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_CRP_ITEint_nometam: TWideStringField;
    PCP_SQ_M_CRPint_nomeres: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIid_crp: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_item: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_cor: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_tamanho: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_crp_bxi: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXInum_lote: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIqtde: TFloatField;
    PCP_SQ_M_CRP_ITE_BXIid_opb: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_opb_ope: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIid_opb_ibe: TIntegerField;
    PCP_SQ_M_CRP_ITE_BXIint_nomeite: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIint_nomeund: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIint_nomecor: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIint_nometam: TWideStringField;
    PCP_SQ_M_LBEint_nometip: TWideMemoField;
    PCP_SQ_M_LBEint_nomeset: TWideStringField;
    PCP_SQ_M_LBEint_nomeaca: TWideStringField;
    PCP_SQ_M_LBEint_nomelam: TWideStringField;
    PCP_SQ_M_LBE_BLOid_lbe: TIntegerField;
    PCP_SQ_M_LBE_BLOid_lbe_blo: TIntegerField;
    PCP_SQ_M_LBE_BLOnum_lote: TWideStringField;
    PCP_SQ_M_LBE_BLOqtde: TFloatField;
    PCP_SQ_M_LBE_BLOid_opb: TIntegerField;
    PCP_SQ_M_LBE_BLOid_opb_ope: TIntegerField;
    PCP_SQ_M_OPBid_opb: TIntegerField;
    PCP_SQ_M_OPBid_responsavel: TIntegerField;
    PCP_SQ_M_OPBid_empresa: TIntegerField;
    PCP_SQ_M_OPBdta_emissao: TDateField;
    PCP_SQ_M_OPBobs_administrativa: TWideStringField;
    PCP_SQ_M_OPBobs_producao: TWideStringField;
    PCP_SQ_M_OPBcod_lme: TWideStringField;
    PCP_SQ_M_OPBrev_lme: TWideStringField;
    PCP_SQ_M_OPBint_nomeres: TWideStringField;
    PCP_SQ_M_NCFana_dta_racp: TDateField;
    FIN_SQ_M_COB_TITid_controle: TIntegerField;
    FIN_SQ_M_COB_TITid_titulo: TIntegerField;
    FIN_SQ_M_COB_TITselecao: TBooleanField;
    PCP_SQ_M_ORS_TITid_ors: TIntegerField;
    PCP_SQ_M_ORS_TITid_ors_tit: TIntegerField;
    PCP_SQ_M_ORS_TITid_forma_pag: TIntegerField;
    PCP_SQ_M_ORS_TITnum_parcela: TWideStringField;
    PCP_SQ_M_ORS_TITdias: TIntegerField;
    PCP_SQ_M_ORS_TITdta_vencimento: TDateField;
    PCP_SQ_M_ORS_TITche_banco: TWideStringField;
    PCP_SQ_M_ORS_TITche_agencia: TWideStringField;
    PCP_SQ_M_ORS_TITche_conta: TIntegerField;
    PCP_SQ_M_ORS_TITche_numero: TIntegerField;
    PCP_SQ_M_ORS_TITche_emitente: TWideStringField;
    PCP_SQ_M_ORS_TITvlr_titulo: TFMTBCDField;
    PCP_SQ_M_ORS_TITint_nomefpg: TWideStringField;
    PCP_SQ_M_ACRid_acr: TIntegerField;
    PCP_SQ_M_ACRid_empresa: TIntegerField;
    PCP_SQ_M_ACRdata_atendimento: TDateField;
    PCP_SQ_M_ACRcod_lme: TWideStringField;
    PCP_SQ_M_ACRrev_lme: TWideStringField;
    PCP_SQ_M_ACRnro_protocolo: TWideStringField;
    PCP_SQ_M_ACRtipo_cliente: TIntegerField;
    PCP_SQ_M_ACRpessoa: TIntegerField;
    PCP_SQ_M_ACRid_cliente: TIntegerField;
    PCP_SQ_M_ACRid_representante: TIntegerField;
    PCP_SQ_M_ACRnome_consumidor: TWideStringField;
    PCP_SQ_M_ACRcnpj_cpf_consumidor: TWideStringField;
    PCP_SQ_M_ACRbairro_consumidor: TWideStringField;
    PCP_SQ_M_ACRendereco_consumidor: TWideStringField;
    PCP_SQ_M_ACRcep_consumidor: TWideStringField;
    PCP_SQ_M_ACRfone_consumidor: TWideStringField;
    PCP_SQ_M_ACRid_cidade: TWideStringField;
    PCP_SQ_M_ACRid_atendente: TIntegerField;
    PCP_SQ_M_ACRnumero_nf: TIntegerField;
    PCP_SQ_M_ACRobservacao: TWideStringField;
    PCP_SQ_M_ACRnro_end_consumidor: TWideStringField;
    PCP_SQ_M_ACRdta_nf: TDateField;
    PCP_SQ_M_ACRint_nomecli: TWideStringField;
    PCP_SQ_C_LME_DOCid_lme: TIntegerField;
    PCP_SQ_C_LME_DOCid_lme_d: TIntegerField;
    PCP_SQ_C_LME_DOCid_tlm: TIntegerField;
    PCP_SQ_C_LME_DOCorigem: TIntegerField;
    PCP_SQ_C_LME_DOCdescricao: TWideStringField;
    PCP_SQ_C_LME_DOCcodigo: TWideStringField;
    PCP_SQ_C_LME_DOCrevisao: TWideStringField;
    PCP_SQ_C_LME_DOCdata_aprovacao: TDateField;
    PCP_SQ_C_LME_DOCid_setor: TIntegerField;
    PCP_SQ_C_LME_DOCdistribuicao_tipo: TIntegerField;
    PCP_SQ_C_LME_DOCobservacao: TWideStringField;
    OFI_SQ_M_AGEid_agenda: TIntegerField;
    OFI_SQ_M_AGEid_empresa: TIntegerField;
    OFI_SQ_M_AGEnome_cliente: TWideStringField;
    OFI_SQ_M_AGEdta_agenda: TDateField;
    OFI_SQ_M_AGEhora: TSQLTimeStampField;
    OFI_SQ_M_AGEobservacao: TWideStringField;
    OFI_SQ_M_AGEplaca: TWideStringField;
    PCP_SQ_C_PRQ_ESPid_prq: TIntegerField;
    PCP_SQ_C_PRQ_ESPid_prq_esp: TIntegerField;
    PCP_SQ_C_PRQ_ESPverif_texto: TWideStringField;
    PCP_SQ_C_PRQ_ESPverif_minimo: TWideStringField;
    PCP_SQ_C_PRQ_ESPvefif_maximo: TWideStringField;
    PCP_SQ_C_PRQ_ESPverif_metodo: TWideStringField;
    PCP_SQ_C_PRQ_ESPamostragem: TWideStringField;
    PCP_SQ_C_PRQ_ESPmanuseio_transp: TWideStringField;
    PCP_SQ_C_PRQ_ESParmazenamento: TWideStringField;
    PCP_SQ_C_PRQ_ESPpreservacao: TWideStringField;
    PCP_SQ_C_PRQ_ESPid_especificacao: TIntegerField;
    PCP_SQ_C_PRQ_ESPint_nomeesp: TWideStringField;
    CAD_SQ_C_TRI_REGcnt_csosn: TWideStringField;
    CAD_SQ_C_TRI_REGnct_csosn: TWideStringField;
    CAD_SQ_C_FORregime: TIntegerField;
    CAD_SQ_C_GRUmva: TFloatField;
    CAD_SQ_C_GRUid_cla: TIntegerField;
    FAT_SQ_M_NFE_ITEicm_s_vlr_mva: TFMTBCDField;
    FAT_SQ_M_NFE_ITEicm_s_per_mva: TFloatField;
    CAD_SQ_C_ITEint_mva: TFloatField;
    OFI_SQ_M_OCVint_nomevei: TWideStringField;
    FAT_SQ_M_NFE_ITEid_sequencia_ite_cmp_ped: TIntegerField;
    FAT_SQ_M_NFE_ITEimp_base_calculo: TFMTBCDField;
    FAT_SQ_M_NFE_ITEimp_desp_aduana: TFMTBCDField;
    FAT_SQ_M_NFE_ITEimp_iof: TFMTBCDField;
    FAT_SQ_M_NFE_ITEdi_numero: TIntegerField;
    FAT_SQ_M_NFE_ITEdi_data: TDateField;
    FAT_SQ_M_NFE_ITEdi_local_desemb: TWideStringField;
    FAT_SQ_M_NFE_ITEdi_uf_desemb: TWideStringField;
    FAT_SQ_M_NFE_ITEdi_data_desemb: TDateField;
    FAT_SQ_M_NFE_ITEdi_exportador: TWideStringField;
    FAT_SQ_M_NFE_ITEdi_numero_adicao: TIntegerField;
    FAT_SQ_M_NFE_ITEdi_seq_adicao: TIntegerField;
    FAT_SQ_M_NFE_ITEdi_fabricante: TWideStringField;
    FAT_SQ_M_NFE_ITEdi_vlr_desconto: TFMTBCDField;
    FAT_SQ_M_NFE_ITEdi_fci: TWideStringField;
    PCP_SQ_C_LMEint_nomeres: TWideStringField;
    OFI_SQ_M_ORVid_tipo_os: TIntegerField;
    OFI_SQ_M_ORVint_placa: TWideStringField;
    OFI_DP_C_TIO: TDataSetProvider;
    OFI_SQ_C_TIO: TSQLDataSet;
    OFI_SQ_C_TIOid_tipo_os: TIntegerField;
    OFI_SQ_C_TIOdescricao: TWideStringField;
    CAD_SQ_C_VEIint_nomecom: TWideMemoField;
    CAD_SQ_C_PRG: TSQLDataSet;
    CAD_DP_C_PRG: TDataSetProvider;
    CAD_SQ_C_PRGid_prg: TIntegerField;
    CAD_SQ_C_PRGdescricao: TWideStringField;
    CAD_SQ_C_PRGtipo: TIntegerField;
    CAD_SQ_C_PRGmenu_ordem: TIntegerField;
    CAD_SQ_C_PRGmodulo: TIntegerField;
    CAD_SQ_C_PRGmenu_path: TWideStringField;
    CAD_SQ_C_PRGint_modulo: TWideMemoField;
    OFI_SQ_M_ORVint_nomevei: TWideStringField;
    OFI_SQ_M_ORVint_nometio: TWideStringField;
    OFI_SQ_M_ORV_ITEid_ordem: TIntegerField;
    OFI_SQ_M_ORV_ITEid_sequencia: TIntegerField;
    OFI_SQ_M_ORV_ITEid_item: TIntegerField;
    OFI_SQ_M_ORV_ITEid_busca_item: TWideStringField;
    OFI_SQ_M_ORV_ITEqtde: TFloatField;
    OFI_SQ_M_ORV_ITEvlr_unitario: TFMTBCDField;
    OFI_SQ_M_ORV_ITEvlr_bruto: TFMTBCDField;
    OFI_SQ_M_ORV_ITEper_desconto: TFloatField;
    OFI_SQ_M_ORV_ITEvlr_desconto: TFMTBCDField;
    OFI_SQ_M_ORV_ITEvlr_liquido: TFMTBCDField;
    OFI_SQ_M_ORV_ITEid_mecanico: TIntegerField;
    OFI_SQ_M_ORV_ITEid_terceiro: TIntegerField;
    OFI_SQ_M_ORV_ITEint_nomeite: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nomeund: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nomeapl: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nomeref: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nomemec: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nometer: TWideStringField;
    CAD_SQ_C_GRUid_fte_etq: TIntegerField;
    PCP_SQ_C_FTE_ETQmodelo_etq: TIntegerField;
    CAD_SQ_C_ITEint_fteetq: TIntegerField;
    BUS_DP_C_LME_DOC_DPG: TDataSetProvider;
    BUS_SQ_C_LME_DOC_DPG: TSQLDataSet;
    CAD_SQ_C_GRUint_nomeetq: TWideStringField;
    PCP_SQ_C_FTE_ETQetq_tecnica: TBooleanField;
    CAD_DP_R_PCT: TDataSetProvider;
    CAD_SQ_R_PCT: TSQLDataSet;
    PCP_SQ_M_IQF: TSQLDataSet;
    PCP_DP_M_IQF: TDataSetProvider;
    PCP_SQ_M_IQFid_fornecedor: TIntegerField;
    PCP_SQ_M_IQFano_iqf: TIntegerField;
    PCP_SQ_M_IQFid_empresa: TIntegerField;
    PCP_SQ_M_IQFid_responsavel: TIntegerField;
    PCP_SQ_M_IQFdta_semestre1: TDateField;
    PCP_SQ_M_IQFqtde_nf_semestre1: TIntegerField;
    PCP_SQ_M_IQFqtde_demeritos_semestre1: TIntegerField;
    PCP_SQ_M_IQFqtde_plano_acao_semestre1: TIntegerField;
    PCP_SQ_M_IQFiqf_semestre1: TFloatField;
    PCP_SQ_M_IQFstatus_semestre1: TIntegerField;
    PCP_SQ_M_IQFdta_semestre2: TDateField;
    PCP_SQ_M_IQFqtde_nf_semestre2: TIntegerField;
    PCP_SQ_M_IQFqtde_demeritos_semestre2: TIntegerField;
    PCP_SQ_M_IQFqtde_plano_acao_semestre2: TIntegerField;
    PCP_SQ_M_IQFiqf_semestre2: TFloatField;
    PCP_SQ_M_IQFstatus_semestre2: TIntegerField;
    PCP_SQ_M_IQFra_dta_prevista: TDateField;
    PCP_SQ_M_IQFra_dta_realizada: TDateField;
    PCP_SQ_M_IQFra_metodo1_media_anual: TFloatField;
    PCP_SQ_M_IQFra_metodo1_status: TWideStringField;
    PCP_SQ_M_IQFra_metodo2_especifico: TWideStringField;
    PCP_SQ_M_IQFra_metodo2_status: TWideStringField;
    PCP_SQ_M_IQFra_observacao: TWideStringField;
    PCP_SQ_M_IQFobservacao_geral: TWideStringField;
    PCP_SQ_M_IQFcod_lme: TWideStringField;
    PCP_SQ_M_IQFrev_lme: TWideStringField;
    PCP_SQ_M_IQFint_nomeres: TWideStringField;
    PCP_SQ_M_IQFint_nomefor: TWideStringField;
    CAD_DP_R_GRU: TDataSetProvider;
    CAD_SQ_R_GRU: TSQLDataSet;
    PCP_SQ_R_PRQ: TSQLDataSet;
    PCP_DP_R_PRQ: TDataSetProvider;
    CAD_DP_R_FOR: TDataSetProvider;
    CAD_SQ_R_FOR: TSQLDataSet;
    PCP_SQ_R_PRP: TSQLDataSet;
    PCP_DP_R_PRP: TDataSetProvider;
    PCP_DP_R_LME: TDataSetProvider;
    PCP_SQ_R_LME: TSQLDataSet;
    PCP_SQ_R_LME_DOC: TSQLDataSet;
    PCP_DS_R_LME: TDataSource;
    PCP_SQ_R_LME_DPG: TSQLDataSet;
    PCP_SQ_R_LME_DRP: TSQLDataSet;
    PCP_SQ_R_LME_DRV: TSQLDataSet;
    PCP_DS_R_LME_DOC: TDataSource;
    CAD_SQ_R_FPG: TSQLDataSet;
    CAD_DP_R_FPG: TDataSetProvider;
    BUS_DP_M_FAT_NFE_CUS: TDataSetProvider;
    BUS_SQ_M_FAT_NFE_CUS: TSQLDataSet;
    CAD_SQ_R_COR: TSQLDataSet;
    CAD_SQ_R_TAM: TSQLDataSet;
    CAD_DP_R_COR: TDataSetProvider;
    CAD_DP_R_TAM: TDataSetProvider;
    CAD_SQ_R_PRG: TSQLDataSet;
    CAD_DP_R_PRG: TDataSetProvider;
    EST_SQ_R_CTE: TSQLDataSet;
    EST_DP_R_CTE: TDataSetProvider;
    PCP_SQ_R_ACR: TSQLDataSet;
    PCP_SQ_R_ACR_ITE: TSQLDataSet;
    PCP_SQ_R_ACR_ITE_PCN: TSQLDataSet;
    PCP_SQ_R_ACR_ITE_PRC: TSQLDataSet;
    PCP_SQ_R_ACR_ITE_PCR: TSQLDataSet;
    PCP_SQ_R_ACR_ITE_PDT: TSQLDataSet;
    PCP_DP_R_ACR: TDataSetProvider;
    PCP_DS_R_ACR: TDataSource;
    PCP_DS_R_ACR_ITE: TDataSource;
    PCP_SQ_R_ACR_ITEid_acr: TIntegerField;
    PCP_SQ_R_ACR_ITEid_acr_p: TIntegerField;
    PCP_SQ_R_ACR_ITEid_item: TIntegerField;
    PCP_SQ_R_ACR_ITEgarantia: TBooleanField;
    PCP_SQ_R_ACR_ITEdata_validade: TDateField;
    PCP_SQ_R_ACR_ITEdata_fabricacao: TDateField;
    PCP_SQ_R_ACR_ITEdata_venda: TDateField;
    PCP_SQ_R_ACR_ITEid_dis: TIntegerField;
    PCP_SQ_R_ACR_ITEdefeito_procede: TBooleanField;
    PCP_SQ_R_ACR_ITEdefeito_constatado: TWideStringField;
    PCP_SQ_R_ACR_ITEmotivo_nao_procede: TWideStringField;
    PCP_SQ_R_ACR_ITEdata_monitor_abert: TDateField;
    PCP_SQ_R_ACR_ITEdata_monitor_encer: TDateField;
    PCP_SQ_R_ACR_ITEid_resp_monitor: TIntegerField;
    PCP_SQ_R_ACR_ITEint_desc_pro: TWideStringField;
    PCP_SQ_R_ACR_ITEint_id_und_venda: TWideStringField;
    PCP_SQ_R_ACR_ITEint_desc_und: TWideStringField;
    PCP_SQ_M_ACRid_busca_clirep: TIntegerField;
    PCP_SQ_M_ACRint_tipocli: TWideMemoField;
    PCP_SQ_M_ACRint_nomerep: TWideStringField;
    PCP_SQ_M_ACRint_nomecid: TWideStringField;
    PCP_SQ_M_ACRint_uf: TWideStringField;
    PCP_SQ_M_ACRint_pessoa: TWideMemoField;
    CAD_SQ_C_PRGnome_programa: TWideStringField;
    CAD_SQ_C_PRGint_tipo: TWideMemoField;
    PCP_SQ_C_LME_DPGid_lme: TIntegerField;
    PCP_SQ_C_LME_DPGid_lme_d: TIntegerField;
    PCP_SQ_C_LME_DPGid_lme_dp: TIntegerField;
    PCP_SQ_C_LME_DPGdata_cadastro: TDateField;
    PCP_SQ_C_LME_DPGnome_formulario: TWideStringField;
    PCP_SQ_C_LME_DPGint_nomeprg: TWideStringField;
    CAD_SQ_C_PAR_CTRint_nomeitesobmed: TWideStringField;
    CAD_SQ_R_CNE: TSQLDataSet;
    CAD_DP_R_CNE: TDataSetProvider;
    PCP_SQ_R_ACR_ITEid_resp_ana: TIntegerField;
    PCP_SQ_R_ACR_ITEdata_entrada_ana: TDateField;
    PCP_SQ_R_ACR_ITEdata_saida_ana: TDateField;
    PCP_SQ_R_ACR_ITEint_descdis: TWideStringField;
    PCP_SQ_M_ACR_ITE_PCNid_acr: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCNid_acr_p: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCNid_acr_pn: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCNid_item: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCNint_desc_pro: TWideStringField;
    PCP_SQ_M_ACR_ITE_PCNint_destino_reclama: TIntegerField;
    PCP_SQ_M_ACR_ITE_PDTid_acr: TIntegerField;
    PCP_SQ_M_ACR_ITE_PDTid_acr_p: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCRid_acr: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCRid_acr_p: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCRid_acr_ph: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCRid_item: TIntegerField;
    PCP_SQ_M_ACR_ITE_PCRint_desc_pro: TWideStringField;
    PCP_SQ_M_ACR_ITE_PRCid_acr: TIntegerField;
    PCP_SQ_M_ACR_ITE_PRCid_acr_p: TIntegerField;
    PCP_SQ_M_ACR_ITE_PRCid_acr_pr: TIntegerField;
    PCP_SQ_M_ACR_ITE_PRCid_resp_reg_acao: TIntegerField;
    PCP_SQ_M_ACR_ITE_PRCsituacao: TIntegerField;
    PCP_SQ_M_ACR_ITE_PRCdata_reg_acao: TDateField;
    PCP_SQ_M_ACR_ITE_PRCint_nome_fun: TWideStringField;
    PCP_SQ_M_ACR_ITE_PRCint_desc_sit: TWideMemoField;
    PCP_SQ_R_ACR_ITE_PCRid_acr: TIntegerField;
    PCP_SQ_R_ACR_ITE_PCRid_acr_p: TIntegerField;
    PCP_SQ_R_ACR_ITE_PCRid_acr_ph: TIntegerField;
    PCP_SQ_R_ACR_ITE_PCRid_item: TIntegerField;
    PCP_SQ_R_ACR_ITE_PCRint_desc_pro: TWideStringField;
    PCP_SQ_R_ACR_ITE_PDTid_acr: TIntegerField;
    PCP_SQ_R_ACR_ITE_PDTid_acr_p: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCid_acr: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCid_acr_p: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCid_acr_pr: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCevento_ocorrido_reg_acao: TWideStringField;
    PCP_SQ_R_ACR_ITE_PRCid_resp_reg_acao: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCsituacao: TIntegerField;
    PCP_SQ_R_ACR_ITE_PRCdata_reg_acao: TDateField;
    PCP_SQ_R_ACR_ITE_PRCint_nome_fun: TWideStringField;
    PCP_SQ_R_ACR_ITE_PRCint_desc_sit: TWideMemoField;
    PCP_SQ_R_ACR_ITEint_nomeres: TWideStringField;
    PCP_SQ_M_ACRint_nomeate: TWideStringField;
    PCP_SQ_M_ACRhora_atendimento: TSQLTimeStampField;
    PCP_SQ_R_ACR_ITEhora_monitor_abert: TSQLTimeStampField;
    PCP_SQ_R_ACR_ITEhora_monitor_encer: TSQLTimeStampField;
    CAD_SQ_R_CFO: TSQLDataSet;
    CAD_DP_R_CFO: TDataSetProvider;
    FAT_SQ_M_IQM: TSQLDataSet;
    FAT_DP_M_IQM: TDataSetProvider;
    FAT_DS_M_IQM_ITE: TDataSource;
    FAT_SQ_M_IQMid_iqm: TIntegerField;
    FAT_SQ_M_IQMid_empresa: TIntegerField;
    FAT_SQ_M_IQMid_emitente: TIntegerField;
    FAT_SQ_M_IQMdta_recebimento: TDateField;
    FAT_SQ_M_IQMdta_emissao_nf: TDateField;
    FAT_SQ_M_IQMnumero_nf: TIntegerField;
    FAT_SQ_M_IQMserie: TWideStringField;
    FAT_SQ_M_IQMsub_serie: TWideStringField;
    FAT_SQ_M_IQMid_pedido_compra: TIntegerField;
    FAT_SQ_M_IQMint_nomefor: TWideStringField;
    FAT_SQ_M_IQM_ITEnum_lote: TWideStringField;
    FAT_SQ_M_IQM_ITEid_iqm: TIntegerField;
    FAT_SQ_M_IQM_ITEqtde: TFloatField;
    FAT_SQ_M_IQM_ITEint_nomeite: TWideStringField;
    FAT_SQ_M_IQM_ITEint_undcom: TWideStringField;
    FAT_SQ_M_IQM_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_IQM_ITEint_nometam: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAid_iqm: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAcod_lme: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANArev_lme: TWideStringField;
    BUS_SQ_M_IQF_FOR: TSQLDataSet;
    BUS_DP_M_IQF_FOR: TDataSetProvider;
    CAD_DP_R_TRI_REG: TDataSetProvider;
    CAD_SQ_R_TRI_REG: TSQLDataSet;
    BUS_DP_M_IQF_NFE: TDataSetProvider;
    BUS_SQ_M_IQF_NFE: TSQLDataSet;
    CAD_DP_R_FUN: TDataSetProvider;
    CAD_SQ_R_FUN: TSQLDataSet;
    CAD_SQ_R_FUN_CRG: TSQLDataSet;
    CAD_DS_R_FUN: TDataSource;
    FAT_SQ_M_IQM_ITEint_nomeres: TWideStringField;
    CAD_SQ_R_FUNid_funcionario: TIntegerField;
    CAD_SQ_R_FUNativo: TBooleanField;
    CAD_SQ_R_FUNnome: TWideStringField;
    CAD_SQ_R_FUNendereco: TWideStringField;
    CAD_SQ_R_FUNcep: TWideStringField;
    CAD_SQ_R_FUNnumero: TWideStringField;
    CAD_SQ_R_FUNtel_fixo: TWideStringField;
    CAD_SQ_R_FUNtel_movel: TWideStringField;
    CAD_SQ_R_FUNdoc_cpf: TWideStringField;
    CAD_SQ_R_FUNdoc_identidade: TWideStringField;
    CAD_SQ_R_FUNbairro: TWideStringField;
    CAD_SQ_R_FUNid_cidade: TWideStringField;
    CAD_SQ_R_FUNestado: TWideStringField;
    CAD_SQ_R_FUNemail: TWideStringField;
    CAD_SQ_R_FUNsexo: TIntegerField;
    CAD_SQ_R_FUNdta_nascimento: TDateField;
    CAD_SQ_R_FUNdta_cadastro: TDateField;
    CAD_SQ_R_FUNlogin: TWideStringField;
    CAD_SQ_R_FUNsenha: TWideStringField;
    CAD_SQ_R_FUNdta_senha_expira: TDateField;
    CAD_SQ_R_FUNid_perfil_seg: TIntegerField;
    CAD_SQ_R_FUNseg_alt_lim_cli: TBooleanField;
    CAD_SQ_R_FUNseg_alt_sit_cli: TBooleanField;
    CAD_SQ_R_FUNseg_alt_pre_pro: TBooleanField;
    CAD_SQ_R_FUNseg_hab_bot_exc: TBooleanField;
    CAD_SQ_R_FUNcod_lme: TWideStringField;
    CAD_SQ_R_FUNrev_lme: TWideStringField;
    CAD_SQ_R_FUNint_nomecid: TWideStringField;
    CAD_SQ_R_FUN_CRGid_funcionario: TIntegerField;
    CAD_SQ_R_FUN_CRGid_cargo: TIntegerField;
    CAD_SQ_R_FUN_CRGint_nomecrg: TWideStringField;
    CAD_SQ_R_FUN_CRGint_tipocrg: TWideMemoField;
    PCP_SQ_R_IQF: TSQLDataSet;
    IntegerField1: TIntegerField;
    IntegerField2: TIntegerField;
    IntegerField3: TIntegerField;
    IntegerField4: TIntegerField;
    DateField1: TDateField;
    IntegerField5: TIntegerField;
    IntegerField6: TIntegerField;
    IntegerField7: TIntegerField;
    FloatField1: TFloatField;
    IntegerField8: TIntegerField;
    DateField2: TDateField;
    IntegerField9: TIntegerField;
    IntegerField10: TIntegerField;
    IntegerField11: TIntegerField;
    FloatField2: TFloatField;
    IntegerField12: TIntegerField;
    DateField3: TDateField;
    DateField4: TDateField;
    FloatField3: TFloatField;
    WideStringField1: TWideStringField;
    WideStringField2: TWideStringField;
    WideStringField3: TWideStringField;
    WideStringField4: TWideStringField;
    WideStringField5: TWideStringField;
    WideStringField6: TWideStringField;
    WideStringField7: TWideStringField;
    WideStringField8: TWideStringField;
    WideStringField9: TWideStringField;
    PCP_DP_R_IQF: TDataSetProvider;
    PCP_SQ_R_IQFint_status_semestre1: TWideMemoField;
    PCP_SQ_R_IQFint_status_semestre2: TWideMemoField;
    PCP_SQ_R_IQFint_ra_metodo1status: TWideMemoField;
    PCP_SQ_R_ACR_ITE_PDTid_tdf: TIntegerField;
    PCP_SQ_R_ACR_ITE_PDTint_desctdf: TWideStringField;
    PCP_SQ_M_ACR_ITE_PDTid_tdf: TIntegerField;
    PCP_SQ_M_ACR_ITE_PDTint_desctdf: TWideStringField;
    PCP_SQ_R_ACR_ITEid_busca_item: TWideStringField;
    PCP_SQ_R_ACR_ITEid_cor: TIntegerField;
    PCP_SQ_R_ACR_ITEid_tamanho: TIntegerField;
    PCP_SQ_R_ACR_ITEint_nometam: TWideStringField;
    PCP_SQ_R_ACR_ITEint_nomecor: TWideStringField;
    EST_SQ_R_MOV: TSQLDataSet;
    EST_DP_R_MOV: TDataSetProvider;
    EST_SQ_R_FIC: TSQLDataSet;
    EST_DP_R_FIC: TDataSetProvider;
    PCP_SQ_R_IQFint_cnpjcpf: TWideMemoField;
    PCP_SQ_R_CDP: TSQLDataSet;
    PCP_DP_R_CDP: TDataSetProvider;
    PCP_DP_R_CDR: TDataSetProvider;
    PCP_SQ_R_CDR: TSQLDataSet;
    PCP_SQ_C_MEQid_setor: TIntegerField;
    PCP_SQ_C_MEQint_nomemde: TWideStringField;
    PCP_SQ_C_MEQint_nomefab: TWideStringField;
    PCP_SQ_C_MEQint_nomefuc: TWideStringField;
    PCP_SQ_C_MEQint_nomeset: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAid_for_rp: TIntegerField;
    FAT_SQ_M_IQM_ITE_ANAint_nomerep: TWideStringField;
    PCP_SQ_R_MEQ: TSQLDataSet;
    PCP_DP_R_MEQ: TDataSetProvider;
    PCP_SQ_R_CRG: TSQLDataSet;
    PCP_DP_R_CRG: TDataSetProvider;
    CMP_SQ_M_PED_IQM: TSQLDataSet;
    CMP_SQ_M_PED_IQM_ITE: TSQLDataSet;
    CMP_DS_M_PED_IQM: TDataSource;
    CMP_SQ_M_PED_IQMid_pedido: TIntegerField;
    CMP_SQ_M_PED_IQMid_iqm: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEid_pedido: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEid_iqm: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEid_sequencia: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEid_item: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEqtde: TFloatField;
    CMP_SQ_M_PED_IQM_ITEid_cor: TIntegerField;
    CMP_SQ_M_PED_IQM_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_IQM_ITEid_sequencia_ite_cmp_ped: TIntegerField;
    FAT_SQ_M_IQM_ITEid_busca_item: TWideStringField;
    FAT_SQ_M_IQM_ITE_ANAint_nomeite: TWideStringField;
    BUS_DP_M_EST_SLD_ANT: TDataSetProvider;
    BUS_SQ_M_EST_SLD_ANT: TSQLDataSet;
    FAT_SQ_M_IQMsituacao: TIntegerField;
    FAT_SQ_M_IQM_ITE_INT: TSQLDataSet;
    FAT_DP_M_IQM_ITE_INT: TDataSetProvider;
    FAT_SQ_M_IQM_ITE_ANAint_nomeresanal: TWideStringField;
    BUS_SQ_C_FUN_CRG: TSQLDataSet;
    BUS_DP_C_FUN_CRG: TDataSetProvider;
    FAT_SQ_M_NFE_ITEid_sequencia_ite_iqm: TIntegerField;
    FAT_SQ_M_NFEid_iqm: TIntegerField;
    PCP_SQ_R_RAAint_nomegru: TWideStringField;
    ctc_sq_c_obr: TSQLDataSet;
    ctc_sq_c_obrid_obra: TIntegerField;
    ctc_sq_c_obrid_cliente: TIntegerField;
    ctc_sq_c_obrdescricao: TWideStringField;
    ctc_sq_c_obrativo: TBooleanField;
    ctc_sq_c_obrendereco: TWideStringField;
    ctc_sq_c_obrid_cidade: TWideStringField;
    ctc_sq_c_obrcep: TWideStringField;
    ctc_sq_c_obrtel_fixo: TWideStringField;
    ctc_sq_c_obrfax: TWideStringField;
    ctc_sq_c_obrobs: TWideStringField;
    ctc_sq_c_obrdta_entrega: TDateField;
    ctc_sq_c_obrcod_lme: TWideStringField;
    ctc_sq_c_obrrev_lme: TWideStringField;
    ctc_sq_c_obrint_nomecli: TWideStringField;
    ctc_sq_c_obrint_nomecid: TWideStringField;
    ctc_dp_c_obr: TDataSetProvider;
    ctc_sq_c_tpr: TSQLDataSet;
    ctc_dp_c_tpr: TDataSetProvider;
    ctc_sq_c_obrid_tpr: TIntegerField;
    ctc_sq_m_orc: TSQLDataSet;
    ctc_sq_m_orc_ite: TSQLDataSet;
    ctc_dp_m_orc: TDataSetProvider;
    ctc_ds_m_orc: TDataSource;
    ctc_sq_m_orcid_orc: TIntegerField;
    ctc_sq_m_orcdta_orc: TDateField;
    ctc_sq_m_orcid_obra: TIntegerField;
    ctc_sq_m_orcint_nomeobr: TWideStringField;
    ctc_sq_m_orcobs: TWideStringField;
    ctc_sq_m_orcvlr_total: TFMTBCDField;
    CAD_SQ_C_ITE_TPR: TSQLDataSet;
    CAD_SQ_C_ITE_TPRid_item: TIntegerField;
    CAD_SQ_C_ITE_TPRid_tpr: TIntegerField;
    CAD_SQ_C_ITE_TPRpreco: TFMTBCDField;
    CAD_SQ_C_ITE_TPRint_nometpr: TWideStringField;
    FIN_SQ_M_RECcar_taxa: TFloatField;
    FIN_SQ_M_RECcar_motivo_can: TWideStringField;
    FIN_SQ_M_RECcar_dta_can: TDateField;
    FIN_SQ_M_RECbol_nosso_numero: TWideStringField;
    PCP_SQ_M_RAAqtde_nf: TFloatField;
    CAD_SQ_C_FAM: TSQLDataSet;
    CAD_DP_C_FAM: TDataSetProvider;
    CAD_SQ_C_ITEid_familia: TIntegerField;
    CAD_SQ_C_ITEdes_completa: TWideStringField;
    CAD_SQ_C_ITE_TPRcod_fabrica: TWideStringField;
    ctc_sq_m_facint_nomeres: TWideStringField;
    ctc_sq_m_avfint_nomeres: TWideStringField;
    PCP_SQ_R_ACR_ITEint_procede: TWideMemoField;
    FIN_SQ_M_COB_TITdias_atraso: TIntegerField;
    FIN_SQ_M_COB_TITint_num_parcela: TWideStringField;
    FIN_SQ_M_COB_TITint_dta_emissao: TDateField;
    FIN_SQ_M_COB_TITint_dta_vencimento: TDateField;
    FIN_SQ_M_COB_TITint_dta_original: TDateField;
    FIN_SQ_M_COB_TITint_id_forma_pag: TIntegerField;
    FIN_SQ_M_COB_TITint_vlr_parcela: TFMTBCDField;
    FIN_SQ_M_COB_TITint_vlr_saldo: TFMTBCDField;
    FIN_SQ_M_COB_TITint_nomefpg: TWideStringField;
    FIN_SQ_M_COBcontato: TBooleanField;
    ctc_sq_c_epi: TSQLDataSet;
    ctc_sq_m_cep: TSQLDataSet;
    ctc_sq_m_cep_epi: TSQLDataSet;
    ctc_sq_m_cfe: TSQLDataSet;
    ctc_sq_m_cfe_fer: TSQLDataSet;
    ctc_sq_m_loc: TSQLDataSet;
    ctc_sq_m_loc_meq: TSQLDataSet;
    ctc_sq_m_ofi: TSQLDataSet;
    ctc_sq_m_ofi_ite: TSQLDataSet;
    ctc_dp_c_epi: TDataSetProvider;
    ctc_sq_c_epiid_epi: TIntegerField;
    ctc_sq_c_epidescricao: TWideStringField;
    ctc_sq_c_epiid_unidade: TWideStringField;
    ctc_sq_c_epiint_nomeund: TWideStringField;
    ctc_dp_m_cep: TDataSetProvider;
    ctc_ds_m_cep: TDataSource;
    ctc_dp_m_cfe: TDataSetProvider;
    ctc_ds_m_cfe: TDataSource;
    ctc_dp_m_loc: TDataSetProvider;
    ctc_ds_m_loc: TDataSource;
    ctc_dp_m_ofi: TDataSetProvider;
    ctc_ds_m_ofi: TDataSource;
    ctc_sq_m_cepid_cep: TIntegerField;
    ctc_sq_m_cepdata: TDateField;
    ctc_sq_m_cepid_responsavel: TIntegerField;
    ctc_sq_m_cepresp_tecnico: TWideStringField;
    ctc_sq_m_cepstatus: TIntegerField;
    ctc_sq_m_cepint_nomeres: TWideStringField;
    ctc_sq_m_cep_epiid_cep: TIntegerField;
    ctc_sq_m_cep_episequencia: TIntegerField;
    ctc_sq_m_cep_epiid_epi: TIntegerField;
    ctc_sq_m_cep_epimarca: TWideStringField;
    ctc_sq_m_cep_epimodelo: TWideStringField;
    ctc_sq_m_cep_epica: TWideStringField;
    ctc_sq_m_cep_epidta_devolucao: TDateField;
    ctc_sq_m_cfeid_cfe: TIntegerField;
    ctc_sq_m_cfedata: TDateField;
    ctc_sq_m_cfeid_funcionario: TIntegerField;
    ctc_sq_m_cfevlr_total: TFMTBCDField;
    ctc_sq_m_cfestatus: TIntegerField;
    ctc_sq_m_cfeint_nomeres: TWideStringField;
    ctc_sq_m_cfe_ferid_cfe: TIntegerField;
    ctc_sq_m_cfe_ferid_meq: TIntegerField;
    ctc_sq_m_cfe_ferqtde: TFloatField;
    ctc_sq_m_cfe_fervlr_unitario: TFMTBCDField;
    ctc_sq_m_cfe_fervlr_total: TFMTBCDField;
    ctc_sq_m_cfe_ferdta_devolucao: TDateField;
    ctc_sq_m_cfe_ferint_nomemeq: TWideStringField;
    ctc_sq_m_locid_loc: TIntegerField;
    ctc_sq_m_locdta_locacao: TDateField;
    ctc_sq_m_locid_obra: TIntegerField;
    ctc_sq_m_locnum_contrato: TIntegerField;
    ctc_sq_m_locnum_documento: TIntegerField;
    ctc_sq_m_locstatus: TIntegerField;
    ctc_sq_m_locvlr_frete: TFMTBCDField;
    ctc_sq_m_locvlr_desconto: TFMTBCDField;
    ctc_sq_m_locvlr_total: TFMTBCDField;
    ctc_sq_m_locint_nomeobr: TWideStringField;
    ctc_sq_m_loc_meqid_loc: TIntegerField;
    ctc_sq_m_loc_meqvlr_unitario: TFMTBCDField;
    ctc_sq_m_loc_meqqtde: TFloatField;
    ctc_sq_m_loc_meqtotal: TFMTBCDField;
    ctc_sq_m_loc_meqdta_inicial: TDateField;
    ctc_sq_m_loc_meqdta_final: TDateField;
    ctc_sq_m_loc_meqentrega: TDateField;
    ctc_sq_m_loc_meqdevolucao: TDateField;
    ctc_sq_m_ofiid_ofi: TIntegerField;
    ctc_sq_m_ofidata: TDateField;
    ctc_sq_m_ofiid_veiculo: TIntegerField;
    ctc_sq_m_ofiid_fornecedor: TIntegerField;
    ctc_sq_m_ofiproblema: TWideStringField;
    ctc_sq_m_ofiobservacao: TWideStringField;
    ctc_sq_m_ofiid_solicitante: TIntegerField;
    ctc_sq_m_ofikm_veiculo: TIntegerField;
    ctc_sq_m_ofistatus: TIntegerField;
    ctc_sq_m_ofivlr_total: TFMTBCDField;
    ctc_sq_m_ofiint_nomefor: TWideStringField;
    ctc_sq_m_ofiint_nomesol: TWideStringField;
    ctc_sq_m_ofi_iteid_ofi: TIntegerField;
    ctc_sq_m_ofi_itesequencia: TIntegerField;
    ctc_sq_m_ofi_itedescricao: TWideStringField;
    ctc_sq_m_ofi_iteqtde: TFloatField;
    ctc_sq_m_ofi_itevlr_unitario: TFMTBCDField;
    ctc_sq_m_ofi_itevlr_total: TFMTBCDField;
    ctc_sq_m_ofiint_nomevei: TWideStringField;
    ctc_sq_m_locid_fornecedor: TIntegerField;
    ctc_sq_m_locint_nomefor: TWideStringField;
    ctc_sq_m_locint_nomefan: TWideStringField;
    ctc_sq_m_locint_numtel: TWideStringField;
    FIN_SQ_R_PAG_BXA: TSQLDataSet;
    FIN_DP_R_PAG_BXA: TDataSetProvider;
    FIN_SQ_M_COB_TITint_id_fiscal: TIntegerField;
    ctc_sq_m_loc_meqid_veiculo: TIntegerField;
    ctc_sq_m_loc_meqint_nomevei: TWideStringField;
    CAD_SQ_C_ITE_APL: TSQLDataSet;
    CAD_SQ_C_ITE_APLid_item: TIntegerField;
    CAD_SQ_C_ITE_APLid_veiculo: TIntegerField;
    CAD_SQ_C_ITE_APLint_nomevei: TWideStringField;
    ctc_sq_m_cfeint_doccpf: TWideStringField;
    ctc_sq_m_bde: TSQLDataSet;
    ctc_dp_m_bde: TDataSetProvider;
    ctc_sq_m_bdeid_bde: TIntegerField;
    ctc_sq_m_bdeid_cliente: TIntegerField;
    ctc_sq_m_bdeid_obra: TIntegerField;
    ctc_sq_m_bdeid_meq: TIntegerField;
    ctc_sq_m_bdedta_bde: TDateField;
    ctc_sq_m_bdeid_operador: TIntegerField;
    ctc_sq_m_bdevlr_desconto: TFMTBCDField;
    ctc_sq_m_bdevlr_acrescimo: TFMTBCDField;
    ctc_sq_m_bdevlr_servicos: TFMTBCDField;
    ctc_sq_m_bdevlr_comissao: TFMTBCDField;
    ctc_sq_m_bdehori_inicial: TFloatField;
    ctc_sq_m_bdehori_final: TFloatField;
    ctc_sq_m_bdeint_nomecli: TWideStringField;
    ctc_sq_m_bdeint_nomemeq: TWideStringField;
    ctc_sq_m_bdeint_nomeobr: TWideStringField;
    ctc_sq_m_bdeint_nomeope: TWideStringField;
    ctc_sq_r_bde: TSQLDataSet;
    ctc_dp_r_bde: TDataSetProvider;
    FIN_SQ_M_PBX_TITid_conta: TIntegerField;
    CAD_SQ_C_ITE_COMint_nomeund: TWideStringField;
    FIN_SQ_M_PAG_PAGvlr_multa: TFMTBCDField;
    FIN_SQ_M_CTAint_origem: TWideMemoField;
    FIN_SQ_M_CON_CXB_DETnum_doc: TIntegerField;
    FIN_SQ_M_CON_CXB_DETint_natureza: TWideMemoField;
    FIN_SQ_M_CON_CXB_DETint_dtaconc: TDateField;
    FIN_SQ_M_CONcod_lme: TWideStringField;
    FIN_SQ_M_CONrev_lme: TWideStringField;
    FAT_SQ_R_DEV_FOR: TSQLDataSet;
    FAT_DP_R_DEV_FOR: TDataSetProvider;
    FIN_SQ_R_PAG_ABE_PPGprazo: TWideMemoField;
    FIN_SQ_R_PAG_ABE_PPGid_forma_pag: TIntegerField;
    FIN_SQ_R_PAG_ABE_PPGnum_parcela: TWideStringField;
    FIN_SQ_R_PAG_ABE_PPGdta_emissao: TDateField;
    FIN_SQ_R_PAG_ABE_PPGdta_vencimento: TDateField;
    FIN_SQ_R_PAG_ABE_PPGid_fornecedor: TIntegerField;
    FIN_SQ_R_PAG_ABE_PPGint_nomefor: TWideStringField;
    FIN_SQ_R_PAG_ABE_PPGint_atraso: TIntegerField;
    FIN_SQ_R_PAG_ABE_PPGint_nomefpg: TWideStringField;
    FIN_SQ_R_PAG_ABE_PPGvlr_saldo: TFMTBCDField;
    FIN_SQ_R_PAG_ABE_PPGvlr_parcela: TFMTBCDField;
    FIN_SQ_M_CTAint_debcre: TWideMemoField;
    CAD_SQ_C_PAR_CTRper_desp_var: TFloatField;
    CAD_SQ_C_TIFcri_exporta: TBooleanField;
    FIN_SQ_M_RBX_TITid_baixa: TIntegerField;
    FIN_SQ_M_RBX_TITid_titulo: TIntegerField;
    FIN_SQ_M_RBX_TITvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_RBX_TITvlr_juros: TFMTBCDField;
    FIN_SQ_M_RBX_TITvlr_desconto: TFMTBCDField;
    FIN_SQ_M_RBX_TITvlr_cred_utilizado: TFMTBCDField;
    FIN_SQ_M_RBX_TITvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_RBX_TITvlr_titulo: TFMTBCDField;
    FIN_SQ_M_RBX_TITatraso: TIntegerField;
    FIN_SQ_M_RBX_TITid_conta: TIntegerField;
    FIN_SQ_M_RBX_TITvlr_restante: TFMTBCDField;
    FIN_SQ_M_RBX_TITdta_vencimento: TDateField;
    FIN_SQ_M_RBXid_conta: TIntegerField;
    FIN_SQ_M_RBXid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_RBXid_plano: TWideStringField;
    FIN_SQ_M_RBX_TITper_desconto: TFloatField;
    FIN_SQ_M_RBX_TITnum_parcela: TWideStringField;
    BUS_SQ_M_PAG_PAG: TSQLDataSet;
    BUS_DS_M_PAG: TDataSource;
    BUS_SQ_M_PAGid_titulo: TIntegerField;
    BUS_SQ_M_PAGid_empresa: TIntegerField;
    BUS_SQ_M_PAGid_fornecedor: TIntegerField;
    BUS_SQ_M_PAGnum_parcela: TWideStringField;
    BUS_SQ_M_PAGdta_emissao: TDateField;
    BUS_SQ_M_PAGhistorico: TWideStringField;
    BUS_SQ_M_PAGvlr_parcela: TFMTBCDField;
    BUS_SQ_M_PAGvlr_original: TFMTBCDField;
    BUS_SQ_M_PAGdta_vencimento: TDateField;
    BUS_SQ_M_PAGdta_original: TDateField;
    BUS_SQ_M_PAGvlr_saldo: TFMTBCDField;
    BUS_SQ_M_PAGid_fiscal: TIntegerField;
    BUS_SQ_M_PAGorigem: TIntegerField;
    BUS_SQ_M_PAGid_forma_pag: TIntegerField;
    BUS_SQ_M_PAGpre_conta: TIntegerField;
    BUS_SQ_M_PAGpre_cheque: TIntegerField;
    BUS_SQ_M_PAGpre_banco: TWideStringField;
    BUS_SQ_M_PAGpre_emitente: TWideStringField;
    BUS_SQ_M_PAGpre_agencia: TWideStringField;
    BUS_SQ_M_PAGtipo_lancamento: TIntegerField;
    BUS_SQ_M_PAGid_local_titulo: TIntegerField;
    BUS_SQ_M_PAGid_plano: TWideStringField;
    BUS_SQ_M_PAGid_ccusto: TIntegerField;
    BUS_SQ_M_PAGper_juros: TFloatField;
    BUS_SQ_M_PAGper_multa: TFloatField;
    BUS_SQ_M_PAGcod_lme: TWideStringField;
    BUS_SQ_M_PAGrev_lme: TWideStringField;
    BUS_SQ_M_PAGint_nomefor: TWideStringField;
    BUS_SQ_M_PAGint_nomefpg: TWideStringField;
    BUS_SQ_M_PAGint_nomelto: TWideStringField;
    BUS_SQ_M_PAGint_nomepct: TWideStringField;
    BUS_SQ_M_PAG_PAGid_titulo: TIntegerField;
    BUS_SQ_M_PAG_PAGid_baixa: TIntegerField;
    BUS_SQ_M_PAG_PAGdta_pagamento: TDateField;
    BUS_SQ_M_PAG_PAGvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_PAG_PAGper_juros: TFMTBCDField;
    BUS_SQ_M_PAG_PAGvlr_juros: TFMTBCDField;
    BUS_SQ_M_PAG_PAGvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PAG_PAGhistorico: TWideStringField;
    BUS_SQ_M_PAG_PAGid_forma_pag: TIntegerField;
    BUS_SQ_M_PAG_PAGid_plano: TWideStringField;
    BUS_SQ_M_PAG_PAGid_plano_juros: TWideStringField;
    BUS_SQ_M_PAG_PAGchp_vlr_anterior: TFMTBCDField;
    BUS_SQ_M_PAG_PAGid_responsavel: TIntegerField;
    BUS_SQ_M_PAG_PAGid_ccusto: TIntegerField;
    BUS_SQ_M_PAG_PAGid_plano_desconto: TWideStringField;
    BUS_SQ_M_PAG_PAGvlr_multa: TFMTBCDField;
    FIN_SQ_M_RBXid_ccusto: TIntegerField;
    FIN_SQ_M_RBXvlr_saldo_credito: TFMTBCDField;
    FIN_SQ_M_RBXvlr_credito_disponivel: TFMTBCDField;
    FIN_SQ_M_RBXid_responsavel: TIntegerField;
    FIN_SQ_M_RBXdta_lancamento: TDateField;
    FIN_SQ_M_RBXint_nomeres: TWideStringField;
    FIN_SQ_M_RBXint_nomeccu: TWideStringField;
    FAT_SQ_M_NFEint_nomeemp: TWideStringField;
    EST_SQ_M_FEAnum_lote: TWideStringField;
    FIN_SQ_M_RECint_cnpjcpf: TWideStringField;
    FIN_SQ_M_RECint_bairrocob: TWideStringField;
    FIN_SQ_M_RECint_endcob: TWideStringField;
    FIN_SQ_M_RECint_estadocob: TWideStringField;
    FIN_SQ_M_RECint_cepcob: TWideStringField;
    FIN_SQ_M_RECint_cidcob: TWideStringField;
    FIN_SQ_M_RECint_emailcli: TWideStringField;
    FIN_SQ_M_REC_PAG: TSQLDataSet;
    FIN_DP_M_REC_PAG: TDataSetProvider;
    FIN_SQ_M_REC_PAGid_titulo: TIntegerField;
    FIN_SQ_M_REC_PAGid_baixa: TIntegerField;
    FIN_SQ_M_REC_PAGdta_pagamento: TDateField;
    FIN_SQ_M_REC_PAGvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_REC_PAGper_juros: TFMTBCDField;
    FIN_SQ_M_REC_PAGvlr_juros: TFMTBCDField;
    FIN_SQ_M_REC_PAGvlr_desconto: TFMTBCDField;
    FIN_SQ_M_REC_PAGhistorico: TWideStringField;
    FIN_SQ_M_REC_PAGid_forma_pag: TIntegerField;
    FIN_SQ_M_REC_PAGid_plano: TWideStringField;
    FIN_SQ_M_REC_PAGid_plano_juros: TWideStringField;
    FIN_SQ_M_REC_PAGchp_id_situacao_chq: TIntegerField;
    FIN_SQ_M_REC_PAGchp_vlr_anterior: TFMTBCDField;
    FIN_SQ_M_REC_PAGid_alinea: TWideStringField;
    FIN_SQ_M_REC_PAGchp_tipo_ocorrencia: TWideStringField;
    FIN_SQ_M_REC_PAGid_responsavel: TIntegerField;
    FIN_SQ_M_REC_PAGcom_substituicao: TBooleanField;
    FIN_SQ_M_REC_PAGid_ccusto: TIntegerField;
    FIN_SQ_M_REC_PAGid_plano_desconto: TWideStringField;
    FIN_SQ_R_REC_ABE: TSQLDataSet;
    FIN_DP_R_REC_ABE: TDataSetProvider;
    FIN_SQ_R_REC_ABE_PPG: TSQLDataSet;
    FIN_DP_R_REC_ABE_PPG: TDataSetProvider;
    FIN_SQ_R_REC_ABE_PPGprazo: TWideMemoField;
    FIN_SQ_R_REC_ABE_PPGid_forma_pag: TIntegerField;
    FIN_SQ_R_REC_ABE_PPGnum_parcela: TWideStringField;
    FIN_SQ_R_REC_ABE_PPGdta_emissao: TDateField;
    FIN_SQ_R_REC_ABE_PPGdta_vencimento: TDateField;
    FIN_SQ_R_REC_ABE_PPGid_cliente: TIntegerField;
    FIN_SQ_R_REC_ABE_PPGint_nomecli: TWideStringField;
    FIN_SQ_R_REC_ABE_PPGint_atraso: TIntegerField;
    FIN_SQ_R_REC_ABE_PPGint_nomefpg: TWideStringField;
    FIN_SQ_R_REC_ABE_PPGvlr_saldo: TFMTBCDField;
    FIN_SQ_R_REC_ABE_PPGvlr_parcela: TFMTBCDField;
    FIN_SQ_R_REC_BXA: TSQLDataSet;
    FIN_DP_R_REC_BXA: TDataSetProvider;
    FAT_SQ_M_NFE_DEVid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_DEVid_fiscal_dev: TIntegerField;
    FAT_DS_M_NFE_DEV: TDataSource;
    FIN_SQ_M_RBX_TIT_INT: TSQLDataSet;
    FIN_DP_M_RBX_TIT_INT: TDataSetProvider;
    FAT_SQ_M_NFE_ITEint_sldqtde: TFloatField;
    FIN_SQ_R_REC_ABE_PRR: TSQLDataSet;
    FIN_DP_R_REC_ABE_PRR: TDataSetProvider;
    FIN_SQ_M_MCH: TSQLDataSet;
    FIN_DP_M_MCH: TDataSetProvider;
    FIN_DS_M_MCH: TDataSource;
    FIN_SQ_M_MCH_CHE: TSQLDataSet;
    FIN_SQ_M_MCHid_controle: TIntegerField;
    FIN_SQ_M_MCHdta_movimento: TDateField;
    FIN_SQ_M_MCHid_conta: TIntegerField;
    FIN_SQ_M_MCHobservacoes: TWideStringField;
    FIN_SQ_M_MCHvlr_movimento: TFMTBCDField;
    FIN_SQ_M_MCH_CHEid_controle: TIntegerField;
    FIN_SQ_M_MCH_CHEid_titulo: TIntegerField;
    FIN_SQ_M_MCH_CHEint_banco: TWideStringField;
    FIN_SQ_M_MCH_CHEint_agencia: TWideStringField;
    FIN_SQ_M_MCH_CHEint_conta: TIntegerField;
    FIN_SQ_M_MCH_CHEint_cheque: TIntegerField;
    FIN_SQ_M_MCH_CHEint_vencimento: TDateField;
    FIN_SQ_M_MCH_CHEint_emitente: TWideStringField;
    FIN_SQ_M_MCH_CHEint_vlr_cheque: TFMTBCDField;
    FIN_SQ_M_MCH_CHEint_vlr_saldo: TFMTBCDField;
    FIN_SQ_M_MCHid_empresa: TIntegerField;
    CMP_SQ_M_SOL_ITEint_estminimo: TFloatField;
    PCP_SQ_M_OPR_IPAid_opr: TIntegerField;
    PCP_SQ_M_OPR_IPAid_opr_opp: TIntegerField;
    PCP_SQ_M_OPR_IPAid_opr_ipa: TIntegerField;
    PCP_SQ_M_OPR_IPAid_item: TIntegerField;
    PCP_SQ_M_OPR_IPAid_cor: TIntegerField;
    PCP_SQ_M_OPR_IPAid_tamanho: TIntegerField;
    PCP_SQ_M_OPR_IPAqtde: TFloatField;
    PCP_SQ_M_OPR_PEDid_opr: TIntegerField;
    PCP_SQ_M_OPR_PEDid_pedido: TIntegerField;
    PCP_SQ_M_OPR_PEDremanejado: TBooleanField;
    PCP_SQ_M_OPR_PEDid_opr_ori: TIntegerField;
    PCP_SQ_M_OPR_PEDid_opr_dest: TIntegerField;
    PCP_SQ_M_OPR_OPSid_opr: TIntegerField;
    PCP_SQ_M_OPR_OPSid_opr_ops: TIntegerField;
    PCP_SQ_M_OPR_OPSid_setor: TIntegerField;
    PCP_SQ_M_OPR_OPSid_item: TIntegerField;
    PCP_SQ_M_OPR_OPSid_cor: TIntegerField;
    PCP_SQ_M_OPR_OPSid_tamanho: TIntegerField;
    PCP_SQ_M_OPR_OPSqtde: TFloatField;
    PCP_SQ_M_OPR_OPStamanho: TWideStringField;
    PCP_SQ_M_OPR_OPSreferencias: TWideStringField;
    PCP_SQ_M_OPR_OPSnum_lote: TWideStringField;
    PCP_SQ_M_OPR_OPSid_item_acabado: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_opr: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_opr_ops: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_opr_ops_ips: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_item: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_cor: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSid_tamanho: TIntegerField;
    PCP_SQ_M_OPR_OPS_IPSqtde: TFloatField;
    PCP_SQ_M_OPR_OPS_IPSnum_lote: TWideStringField;
    PCP_SQ_M_OPR_OPS_LOT: TSQLDataSet;
    PCP_SQ_M_OPR_OPS_LOTid_opr: TIntegerField;
    PCP_SQ_M_OPR_OPS_LOTid_opr_ops: TIntegerField;
    PCP_SQ_M_OPR_OPS_LOTid_opr_lot: TIntegerField;
    PCP_SQ_M_OPR_OPS_LOTqtde: TFloatField;
    PCP_SQ_M_OPR_OPS_LOTnum_lote: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITE: TSQLDataSet;
    BUS_DP_M_ULT_NFE_ITE: TDataSetProvider;
    BUS_SQ_M_ULT_NFE_ITEnumero: TIntegerField;
    BUS_SQ_M_ULT_NFE_ITEserie: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEsub_serie: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEmodelo: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEdta_emissao: TDateField;
    BUS_SQ_M_ULT_NFE_ITEdta_documento: TDateField;
    BUS_SQ_M_ULT_NFE_ITEid_emitente: TIntegerField;
    BUS_SQ_M_ULT_NFE_ITEfantasia: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEqtde: TFloatField;
    BUS_SQ_M_ULT_NFE_ITEvlr_unitario: TFMTBCDField;
    BUS_SQ_M_ULT_NFE_ITEvlr_desconto: TFMTBCDField;
    BUS_SQ_M_ULT_NFE_ITEvlr_liquido: TFMTBCDField;
    BUS_SQ_M_ULT_NFE_ITEipi_valor: TFMTBCDField;
    BUS_SQ_M_ULT_NFE_ITEid_fiscal: TIntegerField;
    PCP_SQ_M_OPR_OPSid_cor_acabado: TIntegerField;
    PCP_SQ_M_OPR_OPSid_tamanho_acabado: TIntegerField;
    PCP_SQ_M_OPR_OPSint_cor: TWideStringField;
    PCP_SQ_M_OPR_OPSint_tamanho: TWideStringField;
    PCP_SQ_M_OPR_OPSint_undcompra: TWideStringField;
    PCP_SQ_M_OPR_OPSint_coracab: TWideStringField;
    PCP_SQ_M_OPR_OPSint_tamacab: TWideStringField;
    PCP_SQ_M_OPR_OPSint_undvendaacab: TWideStringField;
    PCP_SQ_M_OPR_OPS_IPSint_cor: TWideStringField;
    PCP_SQ_M_OPR_OPS_IPSint_tamanho: TWideStringField;
    CAD_SQ_C_FUNseg_vis_ult_cmp_ite: TBooleanField;
    PCP_SQ_M_OPR_OPS_IPSint_nomeite: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEint_nomecor: TWideStringField;
    BUS_SQ_M_ULT_NFE_ITEint_nometam: TWideStringField;
    CMP_SQ_M_PED_NFEint_numero: TIntegerField;
    CMP_SQ_M_PED_NFEint_emissaonfe: TDateField;
    CMP_SQ_M_PED_NFEint_documentonfe: TDateField;
    BUS_DP_CSU_ITE: TDataSetProvider;
    BUS_SQ_CSU_ITE: TSQLDataSet;
    IntegerField13: TIntegerField;
    BooleanField1: TBooleanField;
    BooleanField2: TBooleanField;
    WideStringField10: TWideStringField;
    WideStringField11: TWideStringField;
    WideStringField12: TWideStringField;
    IntegerField14: TIntegerField;
    WideStringField13: TWideStringField;
    WideStringField14: TWideStringField;
    WideStringField15: TWideStringField;
    FloatField4: TFloatField;
    FloatField5: TFloatField;
    WideStringField16: TWideStringField;
    WideStringField17: TWideStringField;
    FloatField6: TFloatField;
    FloatField7: TFloatField;
    FloatField8: TFloatField;
    WideStringField18: TWideStringField;
    WideStringField19: TWideStringField;
    WideStringField20: TWideStringField;
    FMTBCDField1: TFMTBCDField;
    FloatField9: TFloatField;
    FloatField10: TFloatField;
    FloatField11: TFloatField;
    IntegerField15: TIntegerField;
    IntegerField16: TIntegerField;
    IntegerField17: TIntegerField;
    IntegerField18: TIntegerField;
    IntegerField19: TIntegerField;
    IntegerField20: TIntegerField;
    IntegerField21: TIntegerField;
    WideStringField21: TWideStringField;
    WideStringField22: TWideStringField;
    WideStringField23: TWideStringField;
    WideStringField24: TWideStringField;
    WideStringField25: TWideStringField;
    WideStringField26: TWideStringField;
    WideStringField27: TWideStringField;
    WideStringField28: TWideStringField;
    WideStringField29: TWideStringField;
    WideStringField30: TWideStringField;
    IntegerField22: TIntegerField;
    WideStringField31: TWideStringField;
    FMTBCDField2: TFMTBCDField;
    FMTBCDField3: TFMTBCDField;
    WideStringField32: TWideStringField;
    WideStringField33: TWideStringField;
    WideStringField34: TWideStringField;
    WideStringField35: TWideStringField;
    IntegerField23: TIntegerField;
    WideStringField36: TWideStringField;
    DateField5: TDateField;
    WideStringField37: TWideStringField;
    WideStringField38: TWideStringField;
    WideStringField39: TWideStringField;
    WideStringField40: TWideStringField;
    FloatField12: TFloatField;
    IntegerField24: TIntegerField;
    IntegerField25: TIntegerField;
    WideStringField41: TWideStringField;
    CAD_SQ_C_CFOid_cfo_xml: TWideStringField;
    CAD_SQ_C_ITE_XML: TSQLDataSet;
    CAD_SQ_C_ITE_XMLid_item: TIntegerField;
    CAD_SQ_C_ITE_XMLid_emitente: TIntegerField;
    CAD_SQ_C_ITE_XMLid_fabrica: TWideStringField;
    BUS_SQ_C_ITE_XML: TSQLDataSet;
    BUS_DP_C_ITE_XML: TDataSetProvider;
    FAT_SQ_M_NFE_ITEid_sequencia_ite_xml: TIntegerField;
    CAD_SQ_C_PAR_CPG: TSQLDataSet;
    CAD_SQ_C_PAR_CPGid_empresa: TIntegerField;
    CAD_SQ_C_PAR_CPGid_condicao_pag: TIntegerField;
    CAD_SQ_C_PAR_CPGper_reajuste: TFloatField;
    CAD_SQ_C_PAR_CPGsequencia: TIntegerField;
    CAD_SQ_C_PAR_CPGint_nomecpg: TWideStringField;
    BUS_SQ_C_PAR_CPG: TSQLDataSet;
    BUS_DP_C_PAR_CPG: TDataSetProvider;
    FAT_SQ_M_PED_ITEvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_CSU_NFE_ITE: TSQLDataSet;
    BUS_DP_M_CSU_NFE_ITE: TDataSetProvider;
    BUS_SQ_M_FEA_ITE: TSQLDataSet;
    BUS_DP_M_FEA_ITE: TDataSetProvider;
    BUS_SQ_M_FOR_SLD_TIT: TSQLDataSet;
    BUS_DP_M_FOR_SLD_TIT: TDataSetProvider;
    BUS_SQ_M_PAG_PAGint_nomectc: TWideStringField;
    BUS_SQ_M_PAG_PAGint_nomefin: TWideStringField;
    BUS_SQ_M_PAG_PAGint_nomefpg: TWideStringField;
    BUS_SQ_M_PAG_DIA: TSQLDataSet;
    BUS_DP_M_PAG_DIA: TDataSetProvider;
    BUS_DP_M_REC_DIA: TDataSetProvider;
    BUS_SQ_M_REC_DIA: TSQLDataSet;
    BUS_SQ_M_PAG_DIAid_baixa: TIntegerField;
    BUS_SQ_M_PAG_DIAdta_pagamento: TDateField;
    BUS_SQ_M_PAG_DIAid_forma_pag: TIntegerField;
    BUS_SQ_M_PAG_DIAint_nomefpg: TWideStringField;
    BUS_SQ_M_PAG_DIAid_fornecedor: TIntegerField;
    BUS_SQ_M_PAG_DIAint_nomefor: TWideStringField;
    BUS_SQ_M_PAG_DIAvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PAG_DIAvlr_juros: TFMTBCDField;
    BUS_SQ_M_PAG_DIAvlr_multa: TFMTBCDField;
    BUS_SQ_M_PAG_DIAvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_PAG_DIAvlr_saldo: TFMTBCDField;
    BUS_SQ_M_REC_DIAid_baixa: TIntegerField;
    BUS_SQ_M_REC_DIAdta_pagamento: TDateField;
    BUS_SQ_M_REC_DIAid_forma_pag: TIntegerField;
    BUS_SQ_M_REC_DIAint_nomefpg: TWideStringField;
    BUS_SQ_M_REC_DIAid_cliente: TIntegerField;
    BUS_SQ_M_REC_DIAint_nomecli: TWideStringField;
    BUS_SQ_M_REC_DIAvlr_desconto: TFMTBCDField;
    BUS_SQ_M_REC_DIAvlr_juros: TFMTBCDField;
    BUS_SQ_M_REC_DIAvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_REC_DIAvlr_saldo: TFMTBCDField;
    CAD_SQ_C_GRUser_terceiro: TBooleanField;
    CAD_SQ_C_GRUnome_selo_etq: TWideStringField;
    FIN_SQ_M_ORC: TSQLDataSet;
    FIN_SQ_M_ORC_PLC: TSQLDataSet;
    FIN_DP_M_ORC: TDataSetProvider;
    FIN_DS_M_ORC: TDataSource;
    FIN_SQ_M_ORCid_orc: TIntegerField;
    FIN_SQ_M_ORCano: TIntegerField;
    FIN_SQ_M_ORC_PLCid_orc: TIntegerField;
    FIN_SQ_M_ORC_PLCid_plc: TWideStringField;
    FIN_SQ_M_ORC_PLCprev_jan: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_fev: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_mar: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_abr: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_mai: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_jun: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_jul: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_ago: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_set: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_out: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_nov: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_dez: TFMTBCDField;
    FIN_SQ_M_ORC_PLCprev_total: TFMTBCDField;
    FIN_SQ_M_ORC_PLCint_nomepct: TWideStringField;
    FIN_SQ_M_ORCvlr_orcamento: TFMTBCDField;
    BUS_SQ_M_PAGint_numeronf: TIntegerField;
    FAT_SQ_M_NFE_TIThistorico_pag: TWideStringField;
    FAT_SQ_M_NFEid_abertura: TIntegerField;
    FAT_SQ_M_NFElegenda: TWideStringField;
    FAT_SQ_R_PVE_01: TSQLDataSet;
    FAT_DP_R_PVE_01: TDataSetProvider;
    FAT_SQ_M_NFE_TITint_tipopgto: TIntegerField;
    FAT_SQ_M_NFEint_classe: TWideStringField;
    FAT_SQ_R_ICM_CST: TSQLDataSet;
    FAT_SQ_R_PIS_ITE: TSQLDataSet;
    FAT_DP_R_ICM_CST: TDataSetProvider;
    FAT_DP_R_PIS_ITE: TDataSetProvider;
    BUS_SQ_C_PAR_CTR: TSQLDataSet;
    BUS_DP_C_PAR_CTR: TDataSetProvider;
    CAD_SQ_C_PAR_CTRorv_id_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_PAR_CTRserie_nf: TWideStringField;
    CAD_SQ_C_PAR_NFEnfe_seq_devolucao: TBooleanField;
    BUS_SQ_C_PAR_NFE: TSQLDataSet;
    BUS_DP_C_PAR_NFE: TDataSetProvider;
    FAT_SQ_R_PVE_02: TSQLDataSet;
    FAT_DP_R_PVE_02: TDataSetProvider;
    FAT_SQ_R_PVE_03: TSQLDataSet;
    FAT_DP_R_PVE_03: TDataSetProvider;
    FAT_SQ_R_PVE_04: TSQLDataSet;
    FAT_DP_R_PVE_04: TDataSetProvider;
    FAT_SQ_R_PVE_05: TSQLDataSet;
    FAT_DP_R_PVE_05: TDataSetProvider;
    FAT_SQ_R_ICM_CFO: TSQLDataSet;
    FAT_DP_R_ICM_CFO: TDataSetProvider;
    FAT_SQ_R_ICM_ITE: TSQLDataSet;
    FAT_DP_R_ICM_ITE: TDataSetProvider;
    FAT_SQ_R_PIS_CIP: TSQLDataSet;
    FAT_DP_R_PIS_CIP: TDataSetProvider;
    FAT_SQ_R_RET_CLI: TSQLDataSet;
    FAT_DP_R_RET_CLI: TDataSetProvider;
    FAT_SQ_R_RET_ITE: TSQLDataSet;
    FAT_DP_R_RET_ITE: TDataSetProvider;
    FAT_SQ_R_RET_FOR: TSQLDataSet;
    FAT_DP_R_RET_FOR: TDataSetProvider;
    FAT_SQ_R_RET_GRU: TSQLDataSet;
    FAT_DP_R_RET_GRU: TDataSetProvider;
    FAT_SQ_R_RET_VND: TSQLDataSet;
    FAT_DP_R_RET_VND: TDataSetProvider;
    FAT_SQ_M_NFEprevenda: TBooleanField;
    CAD_SQ_C_ECF_FPG: TSQLDataSet;
    CAD_DS_C_ECF: TDataSource;
    CAD_SQ_C_ECFecf_serial_impressora: TWideStringField;
    CAD_SQ_C_ECFecf_marca_impressora: TWideStringField;
    CAD_SQ_C_ECFecf_modelo_impressora: TWideStringField;
    CAD_SQ_C_ECFecf_caixa: TWideStringField;
    CAD_SQ_C_ECFserie: TWideStringField;
    CAD_SQ_C_ECFcod_lme: TWideStringField;
    CAD_SQ_C_ECFrev_lme: TWideStringField;
    CAD_SQ_C_ECF_FPGecf_serial_impressora: TWideStringField;
    CAD_SQ_C_ECF_FPGid_forma_pag: TIntegerField;
    CAD_SQ_C_ECF_FPGid_forma_pag_ecf: TIntegerField;
    BUS_SQ_C_ECF_FPG: TSQLDataSet;
    BUS_DP_C_ECF_FPG: TDataSetProvider;
    CAD_SQ_C_ECFpaf_serial_pv: TWideStringField;
    SQ_BR_PREVENDA: TSQLDataSet;
    DP_BR_PREVENDA: TDataSetProvider;
    SQ_BR_SEQ_ID: TSQLDataSet;
    DP_BR_SEQ_ID: TDataSetProvider;
    SQ_BR_PREVENDA_DETALHE: TSQLDataSet;
    DS_BR_PREVENDA: TDataSource;
    FAT_SQ_M_POSid_responsavel: TIntegerField;
    FAT_SQ_M_POS_ITEid_posvenda: TIntegerField;
    FAT_SQ_M_POS_ITEid_fiscal: TIntegerField;
    FAT_SQ_M_POS_ITEreclamacao: TWideStringField;
    FAT_SQ_M_POS_ITEsolucao: TWideStringField;
    FAT_SQ_M_POS_ITEavaliacao: TIntegerField;
    BUS_SQ_M_POS_ITE: TSQLDataSet;
    BUS_DP_M_POS_ITE: TDataSetProvider;
    BUS_SQ_M_POS_ITEid_posvenda: TIntegerField;
    BUS_SQ_M_POS_ITEid_fiscal: TIntegerField;
    BUS_SQ_M_POS_ITEreclamacao: TWideStringField;
    BUS_SQ_M_POS_ITEsolucao: TWideStringField;
    BUS_SQ_M_POS_ITEavaliacao: TIntegerField;
    BUS_SQ_M_POS_ITEdta_posvenda: TDateField;
    CAD_SQ_C_GRUimprime_selo_etq: TBooleanField;
    CAD_SQ_C_ITEint_impselo: TBooleanField;
    BUS_SQ_M_MAL_ITE_INT: TSQLDataSet;
    BUS_DP_M_MAL_ITE_INT: TDataSetProvider;
    BUS_SQ_M_NFE_ITE_INT: TSQLDataSet;
    BUS_DP_M_NFE_ITE_INT: TDataSetProvider;
    BUS_SQ_M_PED_ITE_INT: TSQLDataSet;
    BUS_DP_M_PED_ITE_INT: TDataSetProvider;
    FIN_DP_R_CXA_DIA: TDataSetProvider;
    FIN_SQ_R_CXA_DIA: TSQLDataSet;
    FIN_DP_R_CXA_DIA_SLA: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_SLA: TSQLDataSet;
    FIN_DP_R_CXA_DIA_VND: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_VND: TSQLDataSet;
    FIN_DP_R_CXA_DIA_PAG: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_PAG: TSQLDataSet;
    FIN_DP_R_CXA_DIA_REC: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_REC: TSQLDataSet;
    FIN_DP_R_CXA_DIA_MOP: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_MOP: TSQLDataSet;
    FIN_DP_R_CXA_DIA_MPL: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_MPL: TSQLDataSet;
    FAT_SQ_M_NFEid_ordem: TIntegerField;
    BUS_SQ_BR_PREVENDA: TSQLDataSet;
    BUS_DP_BR_PREVENDA: TDataSetProvider;
    BUS_SQ_M_NFE_TIT_GRP: TSQLDataSet;
    BUS_DP_M_NFE_TIT_GRP: TDataSetProvider;
    CAD_SQ_R_ECF_FPG: TSQLDataSet;
    CAD_DP_R_ECF_FPG: TDataSetProvider;
    FAT_SQ_M_NFEvenctos_origem: TWideStringField;
    BUS_SQ_M_NFE_TIT_INT: TSQLDataSet;
    BUS_DP_M_NFE_TIT_INT: TDataSetProvider;
    FAT_SQ_M_ORC_ITEvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_PED_TIT_INT: TSQLDataSet;
    BUS_DP_M_PED_TIT_INT: TDataSetProvider;
    FAT_SQ_M_ORC_ITEint_tipo_item: TWideStringField;
    FAT_SQ_M_PED_ITEint_tipo_item: TWideStringField;
    FAT_SQ_M_NFE_ITEint_tipo_item: TWideStringField;
    FAT_SQ_M_NFEcanc_usuario: TIntegerField;
    PCP_SQ_M_CRP_ITEid_sequencia: TIntegerField;
    PCP_SQ_M_CRP_ITEid_busca_item: TWideStringField;
    PCP_SQ_M_CRP_ITE_BXIid_sequencia: TIntegerField;
    PCP_SQ_R_CRP_ITE: TSQLDataSet;
    PCP_DP_R_CRP_ITE: TDataSetProvider;
    PCP_SQ_R_CRP_ITE_BXI: TSQLDataSet;
    PCP_DP_R_CRP_ITE_BXI: TDataSetProvider;
    EST_SQ_R_INV: TSQLDataSet;
    EST_DP_R_INV: TDataSetProvider;
    FIN_SQ_M_CXAint_tipoctc: TIntegerField;
    CAD_SQ_C_FPGint_naturezatif: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_tif_deb: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_tif_cre: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_plano_sef: TWideStringField;
    FAT_SQ_R_ABC_CLI: TSQLDataSet;
    FAT_DP_R_ABC_CLI: TDataSetProvider;
    FAT_SQ_R_ABC_FOR: TSQLDataSet;
    FAT_DP_R_ABC_FOR: TDataSetProvider;
    FAT_SQ_R_ABC_GRU: TSQLDataSet;
    FAT_DP_R_ABC_GRU: TDataSetProvider;
    FIN_DP_R_COB_COB: TDataSetProvider;
    FIN_SQ_R_COB_COB: TSQLDataSet;
    FIN_DP_R_COB_ACO: TDataSetProvider;
    FIN_SQ_R_COB_ACO: TSQLDataSet;
    PCP_SQ_M_CRPid_grupo: TWideStringField;
    FIN_SQ_M_COBid_empresa: TIntegerField;
    BUS_SQ_M_CTE_ITE_INT: TSQLDataSet;
    BUS_DP_M_CTE_ITE_INT: TDataSetProvider;
    FIN_DP_R_EXT_CLI_ABE: TDataSetProvider;
    FIN_SQ_R_EXT_CLI_ABE: TSQLDataSet;
    FIN_DP_R_EXT_CLI_PAG: TDataSetProvider;
    FIN_SQ_R_EXT_CLI_PAG: TSQLDataSet;
    FIN_DP_R_EXT_FOR_ABE: TDataSetProvider;
    FIN_SQ_R_EXT_FOR_ABE: TSQLDataSet;
    FIN_DP_R_EXT_FOR_PAG: TDataSetProvider;
    FIN_SQ_R_EXT_FOR_PAG: TSQLDataSet;
    CAD_SQ_C_PAR_MODsgq: TBooleanField;
    CAD_SQ_C_PAR_MODctc: TBooleanField;
    CAD_SQ_C_PAR_MODfin: TBooleanField;
    CAD_SQ_C_ITErt_pricipio_ativo: TWideStringField;
    CAD_SQ_C_ITErt_composicao: TWideStringField;
    CAD_SQ_C_ITEcod_onu: TWideStringField;
    CAD_SQ_C_ITEret_emb_nao_lavavel: TIntegerField;
    CAD_SQ_C_ITEret_emb_lavaveis: TIntegerField;
    FIN_SQ_M_REC_PAGid_fiscal: TIntegerField;
    FIN_SQ_M_REC_PAGorigem: TIntegerField;
    CAD_SQ_C_PAR_CTRcxa_id_plano_suprim: TWideStringField;
    CAD_SQ_C_PAR_CTRcxa_id_tif_suprim: TIntegerField;
    FIN_SQ_M_CTAid_fiscal: TIntegerField;
    FIN_SQ_M_CTAid_titulo_rec: TIntegerField;
    FIN_SQ_M_CTAid_credito: TIntegerField;
    FIN_SQ_M_CXAhor_fechamento: TTimeField;
    CAD_SQ_C_PAR_CTRcxa_id_plano_sangria: TWideStringField;
    CAD_SQ_C_PAR_CTRcxa_id_tif_sangria: TIntegerField;
    CAD_SQ_C_PAR_CTRcxa_exp_id_tif_sangria: TIntegerField;
    CAD_SQ_C_PAR_CTRcxa_exp_id_plano_sangria: TWideStringField;
    FAT_SQ_M_NFE_ITEvlr_acrescimo: TFMTBCDField;
    BUS_SQ_M_PAGid_abertura: TIntegerField;
    FIN_SQ_M_PAGid_abertura: TIntegerField;
    FIN_SQ_M_PAG_PAGid_abertura: TIntegerField;
    FIN_SQ_M_REC_PAGid_abertura: TIntegerField;
    BUS_SQ_M_NFE_DEV_ITE_INT: TSQLDataSet;
    BUS_DP_M_NFE_DEV_ITE_INT: TDataSetProvider;
    BUS_SQ_M_NFE_DEV_INT: TSQLDataSet;
    BUS_DP_M_NFE_DEV_INT: TDataSetProvider;
    CAD_SQ_C_PAR_CTRrcr_id_condicao_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_forma_pag: TIntegerField;
    BUS_SQ_C_PAR_MOD: TSQLDataSet;
    BUS_DS_C_PAR_CTR: TDataSource;
    BUS_SQ_C_PAR_CTRid_empresa: TIntegerField;
    BUS_SQ_C_PAR_CTRativa_producao: TBooleanField;
    BUS_SQ_C_PAR_CTRped_ativa_titulos: TBooleanField;
    BUS_SQ_C_PAR_CTRped_aceita_est_negativo: TBooleanField;
    BUS_SQ_C_PAR_CTRutiliza_almoxarifado: TBooleanField;
    BUS_SQ_C_PAR_CTRutiliza_lote_na_entrada: TBooleanField;
    BUS_SQ_C_PAR_CTRativa_cor: TBooleanField;
    BUS_SQ_C_PAR_CTRativa_tamanho: TBooleanField;
    BUS_SQ_C_PAR_CTRrcr_inf_pag_credito: TBooleanField;
    BUS_SQ_C_PAR_CTRnfe_separa_prod_serv: TBooleanField;
    BUS_SQ_C_PAR_CTRped_ver_limite: TBooleanField;
    BUS_SQ_C_PAR_CTRfaz_corr_preco_perfil: TBooleanField;
    BUS_SQ_C_PAR_CTRtax_juros_mensal: TFloatField;
    BUS_SQ_C_PAR_CTRper_margem_lucro: TFloatField;
    BUS_SQ_C_PAR_CTRper_desp_fixa: TFloatField;
    BUS_SQ_C_PAR_CTRdia_protesto: TIntegerField;
    BUS_SQ_C_PAR_CTRper_ir: TFloatField;
    BUS_SQ_C_PAR_CTRper_cssl: TFloatField;
    BUS_SQ_C_PAR_CTRper_desconto: TFloatField;
    BUS_SQ_C_PAR_CTRvlr_lim_maximo: TFMTBCDField;
    BUS_SQ_C_PAR_CTRper_iss: TFloatField;
    BUS_SQ_C_PAR_CTRped_altera_preco: TBooleanField;
    BUS_SQ_C_PAR_CTRped_cliente_consumidor: TIntegerField;
    BUS_SQ_C_PAR_CTRpde_id_forma_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRpde_id_ccusto: TIntegerField;
    BUS_SQ_C_PAR_CTRpde_id_local_titulo: TIntegerField;
    BUS_SQ_C_PAR_CTRpde_id_tipo_financeiro: TIntegerField;
    BUS_SQ_C_PAR_CTReff_finalidade: TWideStringField;
    BUS_SQ_C_PAR_CTReff_perfil: TWideStringField;
    BUS_SQ_C_PAR_CTReff_atividade: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_layout: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_tipo_escrituracao: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_ind_reg_cum: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_situa_especial: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_ind_nat_pj: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_ind_ativ: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_ind_apro_cred: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_cod_tipo_cont: TWideStringField;
    BUS_SQ_C_PAR_CTRefc_cod_inc_trib: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_layout: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_cod_fin: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_cod_ctd: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_ed: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_arq: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_iss: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_icms: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_ridf: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_rudf: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_lmc: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_rv: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_prf_ri: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_ec: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_iss: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_rt: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_icms: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_st: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_at: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_ipi: TWideStringField;
    BUS_SQ_C_PAR_CTRsef_ind_ri: TWideStringField;
    BUS_SQ_C_PAR_CTRaliq_interna_icms: TIntegerField;
    BUS_SQ_C_PAR_CTRdta_saldo_inicial: TDateField;
    BUS_SQ_C_PAR_CTRano_corrente: TIntegerField;
    BUS_SQ_C_PAR_CTRmes_corrente: TIntegerField;
    BUS_SQ_C_PAR_CTRid_lme: TIntegerField;
    BUS_SQ_C_PAR_CTRtipo_desconto_cmp_ped: TIntegerField;
    BUS_SQ_C_PAR_CTRid_alm_padrao: TIntegerField;
    BUS_SQ_C_PAR_CTRdoc_layout: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_cod_fin: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_cod_ctd: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_ed: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_arq: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_iss: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_icms: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_ridf: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_rudf: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_lmc: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_rv: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_prf_ri: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_ec: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_iss: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_rt: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_icms: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_st: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_at: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_ipi: TWideStringField;
    BUS_SQ_C_PAR_CTRdoc_ind_ri: TWideStringField;
    BUS_SQ_C_PAR_CTRper_corr_preco_prazo: TFloatField;
    BUS_SQ_C_PAR_CTRcte_tipo_estoque_ent: TIntegerField;
    BUS_SQ_C_PAR_CTRcte_tipo_estoque_sai: TIntegerField;
    BUS_SQ_C_PAR_CTRdec_forma_pag_credito: TIntegerField;
    BUS_SQ_C_PAR_CTRpcp_id_item_sob_medida: TIntegerField;
    BUS_SQ_C_PAR_CTRpcp_cod_int_fte_etq: TWideStringField;
    BUS_SQ_C_PAR_CTRped_cliente: TIntegerField;
    BUS_SQ_C_PAR_CTRper_desp_var: TFloatField;
    BUS_SQ_C_PAR_CTRorv_id_tipo_mov_estoque: TIntegerField;
    BUS_SQ_C_PAR_CTRserie_nf: TWideStringField;
    BUS_SQ_C_PAR_CTRrcr_id_tif_deb: TIntegerField;
    BUS_SQ_C_PAR_CTRrcr_id_tif_cre: TIntegerField;
    BUS_SQ_C_PAR_CTRrcr_id_plano_sef: TWideStringField;
    BUS_SQ_C_PAR_CTRcxa_id_plano_suprim: TWideStringField;
    BUS_SQ_C_PAR_CTRcxa_id_tif_suprim: TIntegerField;
    BUS_SQ_C_PAR_CTRcxa_id_plano_sangria: TWideStringField;
    BUS_SQ_C_PAR_CTRcxa_id_tif_sangria: TIntegerField;
    BUS_SQ_C_PAR_CTRcxa_exp_id_tif_sangria: TIntegerField;
    BUS_SQ_C_PAR_CTRcxa_exp_id_plano_sangria: TWideStringField;
    BUS_SQ_C_PAR_CTRrcr_id_condicao_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRrcr_id_forma_pag: TIntegerField;
    BUS_SQ_C_PAR_MODid_empresa: TIntegerField;
    BUS_SQ_C_PAR_MODcad: TBooleanField;
    BUS_SQ_C_PAR_MODtab: TBooleanField;
    BUS_SQ_C_PAR_MODcsu: TBooleanField;
    BUS_SQ_C_PAR_MODcmp: TBooleanField;
    BUS_SQ_C_PAR_MODest: TBooleanField;
    BUS_SQ_C_PAR_MODfat: TBooleanField;
    BUS_SQ_C_PAR_MODome: TBooleanField;
    BUS_SQ_C_PAR_MODota: TBooleanField;
    BUS_SQ_C_PAR_MODsgq: TBooleanField;
    BUS_SQ_C_PAR_MODseg: TBooleanField;
    BUS_SQ_C_PAR_MODchave: TWideStringField;
    BUS_SQ_C_PAR_MODctc: TBooleanField;
    BUS_SQ_C_PAR_MODfin: TBooleanField;
    CAD_SQ_C_PAR_CTRpde_id_fornecedor: TIntegerField;
    CAD_SQ_C_PAR_CTRint_pdefornecedor: TWideStringField;
    BUS_SQ_C_PAR_CTRpde_id_fornecedor: TIntegerField;
    FIN_SQ_M_RCRid_baixa: TIntegerField;
    FIN_SQ_M_RCRid_titulo: TIntegerField;
    FIN_SQ_M_RCRid_fiscal: TIntegerField;
    CAD_SQ_C_FORaval_ctc_perg_01: TIntegerField;
    CAD_SQ_C_FORaval_ctc_perg_02: TIntegerField;
    CAD_SQ_C_FORaval_ctc_perg_03: TIntegerField;
    CAD_SQ_C_FORaval_ctc_perg_04: TIntegerField;
    CAD_SQ_C_PAR_CTRdev_for_id_condicao_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRcxa_critica_chq: TBooleanField;
    FAT_SQ_M_POSint_nomecli: TWideStringField;
    BUS_SQ_M_POS_ITEint_avaliacao: TWideStringField;
    BUS_SQ_C_PAR_CTRdev_for_id_condicao_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRcxa_critica_chq: TBooleanField;
    FAT_SQ_M_NFEint_baitra: TWideStringField;
    CMP_SQ_M_PEDaprovado: TBooleanField;
    CMP_SQ_M_PEDid_resp_aprov: TIntegerField;
    CMP_SQ_M_PEDdta_aprov: TDateField;
    CMP_SQ_M_PEDhor_aprov: TTimeField;
    BUS_SQ_M_NFE_TIT_INTid_fiscal: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTid_nfe_tit: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTid_forma_pag: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTnum_parcela: TWideStringField;
    BUS_SQ_M_NFE_TIT_INTdias: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTdta_vencimento: TDateField;
    BUS_SQ_M_NFE_TIT_INTvlr_titulo: TFMTBCDField;
    BUS_SQ_M_NFE_TIT_INTid_plano: TWideStringField;
    BUS_SQ_M_NFE_TIT_INTid_ccusto: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTche_banco: TWideStringField;
    BUS_SQ_M_NFE_TIT_INTche_agencia: TWideStringField;
    BUS_SQ_M_NFE_TIT_INTche_conta: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTche_numero: TIntegerField;
    BUS_SQ_M_NFE_TIT_INTche_emitente: TWideStringField;
    BUS_SQ_M_NFE_TIT_INThistorico_pag: TWideStringField;
    BUS_SQ_M_NFE_TIT_INTint_nomefpg: TWideStringField;
    CAD_SQ_C_ECF_FPGint_nomefpg: TWideStringField;
    CAD_SQ_C_FUNseg_vis_msg_sol_cmp: TBooleanField;
    FIN_SQ_M_RECseq_nosso_numero: TIntegerField;
    FIN_SQ_M_RECbol_chave: TIntegerField;
    FIN_SQ_M_RECint_numeronf: TIntegerField;
    CAD_SQ_C_CTCmensagem_1: TWideStringField;
    CAD_SQ_C_CTCmensagem_2: TWideStringField;
    CAD_SQ_C_CTCcedente_ident: TWideStringField;
    CAD_SQ_C_PAR_CTRnfe_ecf_id_condicao_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRnfe_ecf_tipo_estoque: TIntegerField;
    BUS_SQ_M_NFE_INT: TSQLDataSet;
    BUS_DP_M_NFE_INT: TDataSetProvider;
    BUS_SQ_M_NFE_INTid_fiscal: TIntegerField;
    BUS_SQ_M_NFE_INTid_almoxarifado: TIntegerField;
    BUS_SQ_M_NFE_INTid_pedido_compra: TIntegerField;
    BUS_SQ_M_NFE_INTid_condicao_pag: TIntegerField;
    BUS_SQ_M_NFE_INTid_empresa: TIntegerField;
    BUS_SQ_M_NFE_INTid_emitente: TIntegerField;
    BUS_SQ_M_NFE_INTid_cfo: TWideStringField;
    BUS_SQ_M_NFE_INTid_transportadora: TIntegerField;
    BUS_SQ_M_NFE_INTid_vendedor: TIntegerField;
    BUS_SQ_M_NFE_INTid_tipo_mov_estoque: TIntegerField;
    BUS_SQ_M_NFE_INTuf_emitente: TWideStringField;
    BUS_SQ_M_NFE_INTuf_empresa: TWideStringField;
    BUS_SQ_M_NFE_INTdta_emissao: TDateField;
    BUS_SQ_M_NFE_INTdta_documento: TDateField;
    BUS_SQ_M_NFE_INTcpf_cnpj: TWideStringField;
    BUS_SQ_M_NFE_INTnumero: TIntegerField;
    BUS_SQ_M_NFE_INTserie: TWideStringField;
    BUS_SQ_M_NFE_INTsub_serie: TWideStringField;
    BUS_SQ_M_NFE_INTmodelo: TWideStringField;
    BUS_SQ_M_NFE_INTstatus: TIntegerField;
    BUS_SQ_M_NFE_INTnfe_ecf: TIntegerField;
    BUS_SQ_M_NFE_INTecf_prevenda: TIntegerField;
    BUS_SQ_M_NFE_INTid_fiscal_referenciado: TIntegerField;
    BUS_SQ_M_NFE_INTcanc_motivo: TWideStringField;
    BUS_SQ_M_NFE_INTcanc_data: TDateField;
    BUS_SQ_M_NFE_INTpeso_liquido: TFloatField;
    BUS_SQ_M_NFE_INTpeso_bruto: TFloatField;
    BUS_SQ_M_NFE_INTnfe_chave: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_obs: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_protocolo: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_recibo: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_canc_protocolo: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_canc_status: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_tipo_emissao: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_tipo_ambiente: TWideStringField;
    BUS_SQ_M_NFE_INTnfe_finalidade: TIntegerField;
    BUS_SQ_M_NFE_INTnfe_cod_sit: TWideStringField;
    BUS_SQ_M_NFE_INTind_operacao: TIntegerField;
    BUS_SQ_M_NFE_INTind_emitente: TIntegerField;
    BUS_SQ_M_NFE_INTind_frete: TIntegerField;
    BUS_SQ_M_NFE_INTvlr_mercadoria: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_desconto: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_acrescimo: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_liquido: TFMTBCDField;
    BUS_SQ_M_NFE_INTicm_n_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTicm_n_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTicm_s_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTicm_s_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTipi_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTipi_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTiss_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTiss_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTfre_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTfre_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTpis_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTpis_valor_st: TFMTBCDField;
    BUS_SQ_M_NFE_INTcof_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTcof_valor_st: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_isenta: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_outras: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_seguro: TFMTBCDField;
    BUS_SQ_M_NFE_INTtipo_nf: TWideStringField;
    BUS_SQ_M_NFE_INTecf_serial_impressora: TWideStringField;
    BUS_SQ_M_NFE_INTecf_marca_impressora: TWideStringField;
    BUS_SQ_M_NFE_INTecf_modelo_impressora: TWideStringField;
    BUS_SQ_M_NFE_INTecf_caixa: TWideStringField;
    BUS_SQ_M_NFE_INTdta_movimento: TDateField;
    BUS_SQ_M_NFE_INTorigem_nf: TWideStringField;
    BUS_SQ_M_NFE_INTfaturada: TBooleanField;
    BUS_SQ_M_NFE_INTsituacao_inspecao: TIntegerField;
    BUS_SQ_M_NFE_INTid_fiscal_frete: TIntegerField;
    BUS_SQ_M_NFE_INTid_pedido_venda: TIntegerField;
    BUS_SQ_M_NFE_INTvlr_outras_desp: TFMTBCDField;
    BUS_SQ_M_NFE_INTfre_custo: TFMTBCDField;
    BUS_SQ_M_NFE_INTvlr_icm_ser_nao_incide: TFMTBCDField;
    BUS_SQ_M_NFE_INTcof_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTpis_base: TFMTBCDField;
    BUS_SQ_M_NFE_INTposvenda: TBooleanField;
    BUS_SQ_M_NFE_INTid_responsavel: TIntegerField;
    BUS_SQ_M_NFE_INTtipo_cte: TIntegerField;
    BUS_SQ_M_NFE_INTcod_lme: TWideStringField;
    BUS_SQ_M_NFE_INTrev_lme: TWideStringField;
    BUS_SQ_M_NFE_INTpath_xml: TWideStringField;
    BUS_SQ_M_NFE_INTnfref_chave: TWideStringField;
    BUS_SQ_M_NFE_INTimp_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTtri_valor: TFMTBCDField;
    BUS_SQ_M_NFE_INTtra_placa: TWideStringField;
    BUS_SQ_M_NFE_INTtra_uf: TWideStringField;
    BUS_SQ_M_NFE_INTtra_rntc: TWideStringField;
    BUS_SQ_M_NFE_INTtra_qtde_vol: TFloatField;
    BUS_SQ_M_NFE_INTtra_especie: TWideStringField;
    BUS_SQ_M_NFE_INTtra_marca: TWideStringField;
    BUS_SQ_M_NFE_INTtra_num_vol: TWideStringField;
    BUS_SQ_M_NFE_INTid_iqm: TIntegerField;
    BUS_SQ_M_NFE_INTid_abertura: TIntegerField;
    BUS_SQ_M_NFE_INTlegenda: TWideStringField;
    BUS_SQ_M_NFE_INTprevenda: TBooleanField;
    BUS_SQ_M_NFE_INTid_ordem: TIntegerField;
    BUS_SQ_M_NFE_INTvenctos_origem: TWideStringField;
    BUS_SQ_M_NFE_INTcanc_usuario: TIntegerField;
    BUS_SQ_C_PAR_CTRnfe_ecf_id_condicao_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRnfe_ecf_tipo_estoque: TIntegerField;
    CAD_SQ_C_FORmetodo2_sit_justificativa: TWideStringField;
    CAD_SQ_C_FORmetodo3_observacoes: TWideStringField;
    CAD_SQ_C_ITEtam_observacoes: TWideStringField;
    CAD_SQ_C_PAR_MODrev: TBooleanField;
    FAT_SQ_M_POS_ITEint_avaliacao: TWideStringField;
    FAT_SQ_M_NFEint_descnat: TWideStringField;
    FAT_SQ_M_NFE_ITEint_ncmperimposto: TFloatField;
    CAD_SQ_C_ITEint_perimpostoncm: TFloatField;
    FAT_SQ_M_NFEint_nomeemi: TWideStringField;
    CAD_SQ_C_CLIint_situacao: TWideStringField;
    CAD_SQ_C_CLIint_sexo: TWideStringField;
    BUS_SQ_M_EXT_ITE: TSQLDataSet;
    BUS_DP_M_EXT_ITE: TDataSetProvider;
    CAD_SQ_C_PAR_CTRcxa_imprime_etq: TBooleanField;
    CAD_SQ_C_PAR_CTRcxa_f11_pedido: TBooleanField;
    FAT_SQ_M_NFEint_descnfecodsit: TWideStringField;
    FAT_SQ_M_NFE_DEVint_numero: TIntegerField;
    FAT_SQ_M_NFE_DEVint_serie: TWideStringField;
    FAT_SQ_M_NFE_DEVint_subserie: TWideStringField;
    FAT_SQ_M_NFE_DEV_ITEid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEid_item: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEqtde: TFloatField;
    FAT_SQ_M_NFE_DEV_ITEid_cor: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEid_fiscal_dev: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_NFE_DEV_ITEqtde_sld_orig: TFloatField;
    CAD_SQ_C_FUNseg_apr_rep_cmp_ped: TBooleanField;
    FAT_SQ_M_NFE_DEV_ITEint_nomeite: TWideStringField;
    FAT_SQ_M_NFE_DEV_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_NFE_DEV_ITEint_nometam: TWideStringField;
    BUS_SQ_M_TER_NFE: TSQLDataSet;
    BUS_DP_M_TER_NFE: TDataSetProvider;
    FIN_SQ_M_REC_PAGvlr_cred_utilizado: TFMTBCDField;
    FAT_SQ_M_NFEnro_termo: TIntegerField;
    FAT_DS_R_NFE: TDataSource;
    FAT_DP_R_NFE: TDataSetProvider;
    FAT_SQ_R_NFE: TSQLDataSet;
    IntegerField26: TIntegerField;
    IntegerField27: TIntegerField;
    IntegerField28: TIntegerField;
    IntegerField29: TIntegerField;
    IntegerField30: TIntegerField;
    IntegerField31: TIntegerField;
    WideStringField42: TWideStringField;
    IntegerField32: TIntegerField;
    IntegerField33: TIntegerField;
    WideStringField43: TWideStringField;
    WideStringField44: TWideStringField;
    DateField6: TDateField;
    DateField7: TDateField;
    WideStringField45: TWideStringField;
    IntegerField34: TIntegerField;
    WideStringField46: TWideStringField;
    WideStringField47: TWideStringField;
    WideStringField48: TWideStringField;
    IntegerField35: TIntegerField;
    IntegerField36: TIntegerField;
    IntegerField37: TIntegerField;
    IntegerField38: TIntegerField;
    WideStringField49: TWideStringField;
    DateField8: TDateField;
    IntegerField39: TIntegerField;
    FloatField13: TFloatField;
    FloatField14: TFloatField;
    WideStringField50: TWideStringField;
    WideStringField51: TWideStringField;
    WideStringField52: TWideStringField;
    WideStringField53: TWideStringField;
    WideStringField54: TWideStringField;
    WideStringField55: TWideStringField;
    WideStringField56: TWideStringField;
    WideStringField57: TWideStringField;
    WideStringField58: TWideStringField;
    IntegerField40: TIntegerField;
    IntegerField41: TIntegerField;
    IntegerField42: TIntegerField;
    FMTBCDField4: TFMTBCDField;
    FMTBCDField5: TFMTBCDField;
    FMTBCDField6: TFMTBCDField;
    FMTBCDField7: TFMTBCDField;
    FMTBCDField8: TFMTBCDField;
    FMTBCDField9: TFMTBCDField;
    FMTBCDField10: TFMTBCDField;
    FMTBCDField11: TFMTBCDField;
    FMTBCDField12: TFMTBCDField;
    FMTBCDField13: TFMTBCDField;
    FMTBCDField14: TFMTBCDField;
    FMTBCDField15: TFMTBCDField;
    FMTBCDField16: TFMTBCDField;
    FMTBCDField17: TFMTBCDField;
    FMTBCDField18: TFMTBCDField;
    FMTBCDField19: TFMTBCDField;
    FMTBCDField20: TFMTBCDField;
    FMTBCDField21: TFMTBCDField;
    FMTBCDField22: TFMTBCDField;
    FMTBCDField23: TFMTBCDField;
    FMTBCDField24: TFMTBCDField;
    WideStringField59: TWideStringField;
    WideStringField60: TWideStringField;
    WideStringField61: TWideStringField;
    WideStringField62: TWideStringField;
    WideStringField63: TWideStringField;
    DateField9: TDateField;
    WideStringField64: TWideStringField;
    BooleanField3: TBooleanField;
    IntegerField43: TIntegerField;
    IntegerField44: TIntegerField;
    IntegerField45: TIntegerField;
    FMTBCDField25: TFMTBCDField;
    FMTBCDField26: TFMTBCDField;
    FMTBCDField27: TFMTBCDField;
    FMTBCDField28: TFMTBCDField;
    FMTBCDField29: TFMTBCDField;
    BooleanField4: TBooleanField;
    IntegerField46: TIntegerField;
    IntegerField47: TIntegerField;
    WideMemoField1: TWideMemoField;
    WideStringField65: TWideStringField;
    WideMemoField2: TWideMemoField;
    WideStringField66: TWideStringField;
    WideStringField67: TWideStringField;
    WideStringField68: TWideStringField;
    IntegerField48: TIntegerField;
    WideStringField69: TWideStringField;
    WideStringField70: TWideStringField;
    WideStringField71: TWideStringField;
    WideStringField72: TWideStringField;
    WideStringField73: TWideStringField;
    WideStringField74: TWideStringField;
    WideStringField75: TWideStringField;
    WideStringField76: TWideStringField;
    IntegerField49: TIntegerField;
    IntegerField50: TIntegerField;
    WideStringField77: TWideStringField;
    WideStringField78: TWideStringField;
    WideMemoField3: TWideMemoField;
    IntegerField51: TIntegerField;
    WideMemoField4: TWideMemoField;
    WideMemoField5: TWideMemoField;
    WideMemoField6: TWideMemoField;
    WideMemoField7: TWideMemoField;
    WideMemoField8: TWideMemoField;
    WideMemoField9: TWideMemoField;
    WideMemoField10: TWideMemoField;
    WideMemoField11: TWideMemoField;
    WideMemoField12: TWideMemoField;
    WideMemoField13: TWideMemoField;
    WideMemoField14: TWideMemoField;
    FMTBCDField30: TFMTBCDField;
    FMTBCDField31: TFMTBCDField;
    WideStringField79: TWideStringField;
    WideStringField80: TWideStringField;
    WideStringField81: TWideStringField;
    FloatField15: TFloatField;
    WideStringField82: TWideStringField;
    WideStringField83: TWideStringField;
    WideStringField84: TWideStringField;
    IntegerField52: TIntegerField;
    WideMemoField15: TWideMemoField;
    WideMemoField16: TWideMemoField;
    IntegerField53: TIntegerField;
    WideStringField85: TWideStringField;
    IntegerField54: TIntegerField;
    WideStringField86: TWideStringField;
    WideStringField87: TWideStringField;
    BooleanField5: TBooleanField;
    IntegerField55: TIntegerField;
    WideStringField88: TWideStringField;
    WideStringField89: TWideStringField;
    WideStringField90: TWideStringField;
    WideStringField91: TWideStringField;
    WideStringField92: TWideStringField;
    IntegerField56: TIntegerField;
    FAT_SQ_R_NFE_ITE: TSQLDataSet;
    IntegerField57: TIntegerField;
    IntegerField58: TIntegerField;
    IntegerField59: TIntegerField;
    IntegerField60: TIntegerField;
    WideStringField93: TWideStringField;
    WideStringField94: TWideStringField;
    FloatField16: TFloatField;
    FloatField17: TFloatField;
    FMTBCDField32: TFMTBCDField;
    FMTBCDField33: TFMTBCDField;
    FloatField18: TFloatField;
    FMTBCDField34: TFMTBCDField;
    FMTBCDField35: TFMTBCDField;
    FMTBCDField36: TFMTBCDField;
    FMTBCDField37: TFMTBCDField;
    FMTBCDField38: TFMTBCDField;
    FMTBCDField39: TFMTBCDField;
    FloatField19: TFloatField;
    FloatField20: TFloatField;
    FMTBCDField40: TFMTBCDField;
    FMTBCDField41: TFMTBCDField;
    FMTBCDField42: TFMTBCDField;
    FMTBCDField43: TFMTBCDField;
    FMTBCDField44: TFMTBCDField;
    FloatField21: TFloatField;
    FMTBCDField45: TFMTBCDField;
    FMTBCDField46: TFMTBCDField;
    FloatField22: TFloatField;
    FMTBCDField47: TFMTBCDField;
    FMTBCDField48: TFMTBCDField;
    FloatField23: TFloatField;
    FMTBCDField49: TFMTBCDField;
    FMTBCDField50: TFMTBCDField;
    FloatField24: TFloatField;
    FMTBCDField51: TFMTBCDField;
    FMTBCDField52: TFMTBCDField;
    FloatField25: TFloatField;
    FMTBCDField53: TFMTBCDField;
    FloatField26: TFloatField;
    FloatField27: TFloatField;
    IntegerField61: TIntegerField;
    FMTBCDField54: TFMTBCDField;
    FMTBCDField55: TFMTBCDField;
    FMTBCDField56: TFMTBCDField;
    FMTBCDField57: TFMTBCDField;
    FMTBCDField58: TFMTBCDField;
    FMTBCDField59: TFMTBCDField;
    FMTBCDField60: TFMTBCDField;
    IntegerField62: TIntegerField;
    FMTBCDField61: TFMTBCDField;
    FMTBCDField62: TFMTBCDField;
    FMTBCDField63: TFMTBCDField;
    WideStringField95: TWideStringField;
    IntegerField63: TIntegerField;
    IntegerField64: TIntegerField;
    WideStringField96: TWideStringField;
    WideStringField97: TWideStringField;
    WideStringField98: TWideStringField;
    IntegerField65: TIntegerField;
    WideStringField99: TWideStringField;
    WideStringField100: TWideStringField;
    WideStringField101: TWideStringField;
    WideStringField102: TWideStringField;
    WideStringField103: TWideStringField;
    WideStringField104: TWideStringField;
    WideStringField105: TWideStringField;
    FMTBCDField64: TFMTBCDField;
    FloatField28: TFloatField;
    FMTBCDField65: TFMTBCDField;
    FloatField29: TFloatField;
    IntegerField66: TIntegerField;
    FMTBCDField66: TFMTBCDField;
    FMTBCDField67: TFMTBCDField;
    FMTBCDField68: TFMTBCDField;
    IntegerField67: TIntegerField;
    DateField10: TDateField;
    WideStringField106: TWideStringField;
    WideStringField107: TWideStringField;
    DateField11: TDateField;
    WideStringField108: TWideStringField;
    IntegerField68: TIntegerField;
    IntegerField69: TIntegerField;
    WideStringField109: TWideStringField;
    FMTBCDField69: TFMTBCDField;
    WideStringField110: TWideStringField;
    IntegerField70: TIntegerField;
    FloatField30: TFloatField;
    IntegerField71: TIntegerField;
    WideStringField111: TWideStringField;
    FMTBCDField70: TFMTBCDField;
    FloatField31: TFloatField;
    FAT_SQ_R_NFE_TIT: TSQLDataSet;
    IntegerField72: TIntegerField;
    IntegerField73: TIntegerField;
    IntegerField74: TIntegerField;
    WideStringField112: TWideStringField;
    IntegerField75: TIntegerField;
    DateField12: TDateField;
    FMTBCDField71: TFMTBCDField;
    WideStringField113: TWideStringField;
    IntegerField76: TIntegerField;
    WideStringField114: TWideStringField;
    WideStringField115: TWideStringField;
    IntegerField77: TIntegerField;
    IntegerField78: TIntegerField;
    WideStringField116: TWideStringField;
    WideStringField117: TWideStringField;
    WideStringField118: TWideStringField;
    WideStringField119: TWideStringField;
    WideStringField120: TWideStringField;
    IntegerField79: TIntegerField;
    FAT_SQ_R_NFE_FRE: TSQLDataSet;
    FAT_SQ_R_NFE_FREnumero: TIntegerField;
    FAT_SQ_R_NFE_FREserie: TWideStringField;
    FAT_SQ_R_NFE_FREsub_serie: TWideStringField;
    FAT_SQ_R_NFE_FREmodelo: TWideStringField;
    FAT_SQ_R_NFE_FREid_cfo: TWideStringField;
    FAT_SQ_R_NFE_FREicm_n_valor: TFMTBCDField;
    FAT_SQ_R_NFE_FREint_nomefor: TWideStringField;
    CAD_SQ_C_ITEret_emb_capacidade: TWideStringField;
    FAT_SQ_R_NFE_TME: TSQLDataSet;
    FAT_DP_R_NFE_TME: TDataSetProvider;
    FAT_SQ_R_NFE_CFO: TSQLDataSet;
    FAT_DP_R_NFE_CFO: TDataSetProvider;
    FAT_SQ_R_NFE_TMEint_nometme: TWideStringField;
    FAT_SQ_R_NFE_TMEvlr_liquido: TFMTBCDField;
    FAT_SQ_R_NFE_FREint_indfrete: TWideMemoField;
    FAT_SQ_R_NFE_FREvlr_total_frete: TFMTBCDField;
    FAT_SQ_R_NFE_FREvlr_frete_rat: TFMTBCDField;
    FAT_SQ_R_NFE_FREdta_emissao: TDateField;
    Conexao: TSQLConnection;
    FAT_SQ_R_NFEint_nomecfo: TWideStringField;
    CAD_SQ_C_PAR_CTRper_cofins_l_real: TFloatField;
    CAD_SQ_C_PAR_CTRper_pis_l_real: TFloatField;
    CAD_SQ_C_PAR_CTRfat_seq_termo: TIntegerField;
    CAD_SQ_C_PAR_CTRper_cofins_l_presumido: TFloatField;
    CAD_SQ_C_PAR_CTRper_pis_l_presumido: TFloatField;
    BUS_SQ_C_PAR_CTRper_cofins_l_real: TFloatField;
    BUS_SQ_C_PAR_CTRper_pis_l_real: TFloatField;
    BUS_SQ_C_PAR_CTRcxa_imprime_etq: TBooleanField;
    BUS_SQ_C_PAR_CTRcxa_f11_pedido: TBooleanField;
    BUS_SQ_C_PAR_CTRfat_seq_termo: TIntegerField;
    BUS_SQ_C_PAR_CTRper_cofins_l_presumido: TFloatField;
    BUS_SQ_C_PAR_CTRper_pis_l_presumido: TFloatField;
    CAD_SQ_C_ITEint_pis_entrada: TWideStringField;
    CAD_SQ_C_ITEint_pis_saida: TWideStringField;
    CAD_SQ_C_ITEint_cof_entrada: TWideStringField;
    CAD_SQ_C_ITEint_cof_saida: TWideStringField;
    FAT_SQ_M_ORC_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_ORC_ITEint_nometam: TWideStringField;
    CAD_SQ_C_ITEsgq_critica_laudo_fab: TBooleanField;
    FAT_SQ_M_IQM_ITEobservacao: TWideStringField;
    FAT_SQ_R_GAM_150: TSQLDataSet;
    FAT_DP_R_GAM_150: TDataSetProvider;
    FAT_SQ_R_GAM_E20: TSQLDataSet;
    FAT_DP_R_GAM_E20: TDataSetProvider;
    FAT_SQ_R_GAM_E25: TSQLDataSet;
    FAT_DP_R_GAM_E25: TDataSetProvider;
    FAT_SQ_R_GAM_100: TSQLDataSet;
    FAT_DP_R_GAM_100: TDataSetProvider;
    FAT_SQ_R_GAM_105: TSQLDataSet;
    FAT_DP_R_GAM_105: TDataSetProvider;
    BUS_SQ_M_PED_NIP: TSQLDataSet;
    BUS_DP_M_PED_NIP: TDataSetProvider;
    FAT_SQ_R_GAM_120: TSQLDataSet;
    FAT_DP_R_GAM_120: TDataSetProvider;
    CAD_DP_R_CLI: TDataSetProvider;
    CAD_SQ_R_CLI: TSQLDataSet;
    FAT_SQ_R_GAM_H30: TSQLDataSet;
    FAT_DP_R_GAM_H30: TDataSetProvider;
    FAT_SQ_R_GAM_H20: TSQLDataSet;
    FAT_DP_R_GAM_H20: TDataSetProvider;
    FAT_SQ_R_GAM_H50: TSQLDataSet;
    FAT_DP_R_GAM_H50: TDataSetProvider;
    FAT_SQ_R_GAM_H60: TSQLDataSet;
    FAT_DP_R_GAM_H60: TDataSetProvider;
    CAD_SQ_C_FPG_TAP: TSQLDataSet;
    CAD_DS_C_FPG: TDataSource;
    CAD_SQ_C_FPGtaxa_antecipacao: TFloatField;
    FIN_SQ_M_RECbol_id_conta: TIntegerField;
    FIN_SQ_M_RECcar_taxa_ope: TFloatField;
    FIN_SQ_M_RECcar_n_lote_id_resp: TIntegerField;
    FIN_SQ_M_RECcar_n_lote_id_conta: TIntegerField;
    FIN_SQ_M_RECid_baixa: TIntegerField;
    BUS_SQ_M_CXA_RES_CAR: TSQLDataSet;
    BUS_DP_M_CXA_RES_CAR: TDataSetProvider;
    BUS_SQ_M_CXA_DET_CNF: TSQLDataSet;
    BUS_DP_M_CXA_DET_CNF: TDataSetProvider;
    BUS_SQ_M_CXA_DET_CRB: TSQLDataSet;
    BUS_DP_M_CXA_DET_CRB: TDataSetProvider;
    BUS_SQ_M_CXA_CAR: TSQLDataSet;
    BUS_DP_M_CXA_CAR: TDataSetProvider;
    CAD_SQ_C_PAR_CTRcxa_inf_lote_car_fech: TBooleanField;
    CAD_SQ_C_PAR_CTRconc_alt_txa_fixa_car: TBooleanField;
    CAD_DP_R_PES: TDataSetProvider;
    CAD_SQ_R_PES: TSQLDataSet;
    CAD_DS_R_PES: TDataSource;
    CAD_SQ_R_PES_MOD: TSQLDataSet;
    CAD_SQ_R_PESid_perfil_seg: TIntegerField;
    CAD_SQ_R_PESdescricao: TWideStringField;
    CAD_SQ_R_PEScod_lme: TWideStringField;
    CAD_SQ_R_PESrev_lme: TWideStringField;
    CAD_SQ_R_PES_MODid_perfil_seg: TIntegerField;
    CAD_SQ_R_PES_MODformulario: TWideStringField;
    CAD_SQ_R_PES_MODativo: TBooleanField;
    CAD_SQ_R_PES_MODchave: TWideStringField;
    CAD_SQ_R_PES_MODdescricao: TWideStringField;
    CAD_SQ_R_PES_MODmenu: TWideStringField;
    CAD_SQ_R_PES_MODmodulo: TWideStringField;
    CAD_SQ_R_PES_MODmodulo_desc: TWideStringField;
    BUS_SQ_M_CXA_RES_CARid_forma_pag: TIntegerField;
    BUS_SQ_M_CXA_RES_CARdescricao: TWideStringField;
    BUS_SQ_M_CXA_RES_CARvlr_total: TFMTBCDField;
    BUS_SQ_M_CXA_DET_CNFid_fiscal: TIntegerField;
    BUS_SQ_M_CXA_DET_CNFnumero: TIntegerField;
    BUS_SQ_M_CXA_DET_CNFid_forma_pag: TIntegerField;
    BUS_SQ_M_CXA_DET_CNFdescricao: TWideStringField;
    BUS_SQ_M_CXA_DET_CNFvlr_total: TFMTBCDField;
    BUS_SQ_M_CXA_DET_CNFtot_parcelas: TFMTBCDField;
    BUS_SQ_M_CXA_DET_CNFtaxa: TFloatField;
    BUS_SQ_M_CXA_DET_CNFdias_acres_vencto: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBid_baixa: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBid_forma_pag: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBdescricao: TWideStringField;
    BUS_SQ_M_CXA_DET_CRBvlr_total: TFMTBCDField;
    BUS_SQ_M_CXA_DET_CRBtot_parcelas: TFMTBCDField;
    BUS_SQ_M_CXA_DET_CRBtaxa: TFloatField;
    BUS_SQ_M_CXA_DET_CRBdias_acres_vencto: TIntegerField;
    BUS_SQ_M_CXA_CARid_titulo: TIntegerField;
    BUS_SQ_M_CXA_CARid_empresa: TIntegerField;
    BUS_SQ_M_CXA_CARid_cliente: TIntegerField;
    BUS_SQ_M_CXA_CARnum_parcela: TWideStringField;
    BUS_SQ_M_CXA_CARdta_emissao: TDateField;
    BUS_SQ_M_CXA_CARhistorico: TWideStringField;
    BUS_SQ_M_CXA_CARvlr_parcela: TFMTBCDField;
    BUS_SQ_M_CXA_CARvlr_original: TFMTBCDField;
    BUS_SQ_M_CXA_CARdta_vencimento: TDateField;
    BUS_SQ_M_CXA_CARdta_original: TDateField;
    BUS_SQ_M_CXA_CARvlr_saldo: TFMTBCDField;
    BUS_SQ_M_CXA_CARid_fiscal: TIntegerField;
    BUS_SQ_M_CXA_CARorigem: TIntegerField;
    BUS_SQ_M_CXA_CARid_forma_pag: TIntegerField;
    BUS_SQ_M_CXA_CARche_conta: TIntegerField;
    BUS_SQ_M_CXA_CARche_cheque: TIntegerField;
    BUS_SQ_M_CXA_CARche_banco: TWideStringField;
    BUS_SQ_M_CXA_CARche_emitente: TWideStringField;
    BUS_SQ_M_CXA_CARche_agencia: TWideStringField;
    BUS_SQ_M_CXA_CARtipo_lancamento: TIntegerField;
    BUS_SQ_M_CXA_CARid_local_titulo: TIntegerField;
    BUS_SQ_M_CXA_CARid_plano: TWideStringField;
    BUS_SQ_M_CXA_CARbol_nosso_numero: TWideStringField;
    BUS_SQ_M_CXA_CARcar_taxa: TFloatField;
    BUS_SQ_M_CXA_CARcar_motivo_can: TWideStringField;
    BUS_SQ_M_CXA_CARcar_dta_can: TDateField;
    BUS_SQ_M_CXA_CARcod_lme: TWideStringField;
    BUS_SQ_M_CXA_CARrev_lme: TWideStringField;
    BUS_SQ_M_CXA_CARseq_nosso_numero: TIntegerField;
    BUS_SQ_M_CXA_CARbol_chave: TIntegerField;
    BUS_SQ_M_CXA_CARbol_id_conta: TIntegerField;
    BUS_SQ_M_CXA_CARcar_taxa_ope: TFloatField;
    BUS_SQ_M_CXA_CARcar_n_lote_id_resp: TIntegerField;
    BUS_SQ_M_CXA_CARcar_n_lote_id_conta: TIntegerField;
    BUS_SQ_M_CXA_CARid_baixa: TIntegerField;
    BUS_SQ_M_CXA_CARint_formapag: TWideStringField;
    BUS_SQ_M_CXA_CARnumero: TIntegerField;
    BUS_SQ_M_CXA_CARtipo: TWideStringField;
    CAD_DP_R_TME: TDataSetProvider;
    CAD_SQ_R_TME: TSQLDataSet;
    BUS_SQ_M_CXA_RES_CARnum_lote: TWideStringField;
    BUS_SQ_M_CXA_DET_CNFfaixa: TWideStringField;
    BUS_SQ_M_CXA_DET_CRBfaixa: TWideStringField;
    FIN_SQ_M_RECcar_n_lote: TWideStringField;
    BUS_SQ_M_CXA_CARcar_n_lote: TWideStringField;
    FIN_SQ_M_MCHinformativo: TWideStringField;
    FIN_SQ_M_MCHoperacao: TIntegerField;
    FIN_SQ_M_MCHid_responsavel: TIntegerField;
    FIN_SQ_M_MCHint_nomeresp: TWideStringField;
    FIN_SQ_M_MCH_CHEvlr_pago: TFMTBCDField;
    FIN_SQ_M_MCH_CHEid_alinea: TWideStringField;
    FIN_SQ_M_MCH_TIT: TSQLDataSet;
    FIN_SQ_M_MCH_TITid_controle: TIntegerField;
    FIN_SQ_M_MCH_TITid_titulo: TIntegerField;
    FIN_SQ_M_MCH_TITid_forma_pag: TIntegerField;
    FIN_SQ_M_MCH_TITdias: TIntegerField;
    FIN_SQ_M_MCH_TITnum_parcela: TWideStringField;
    FIN_SQ_M_MCH_TITvlr_juros: TFMTBCDField;
    FIN_SQ_M_MCH_TITvlr_total: TFMTBCDField;
    FIN_SQ_M_MCH_TITche_conta: TIntegerField;
    FIN_SQ_M_MCH_TITche_banco: TWideStringField;
    FIN_SQ_M_MCH_TITche_emitente: TWideStringField;
    FIN_SQ_M_MCH_TITche_agencia: TWideStringField;
    FIN_SQ_M_MCH_TITint_nomefpg: TWideStringField;
    FIN_SQ_M_MCHint_operacao: TWideStringField;
    FIN_SQ_R_MCH: TSQLDataSet;
    FIN_DP_R_MCH: TDataSetProvider;
    FAT_SQ_R_GAM_C20: TSQLDataSet;
    FAT_DP_R_GAM_C20: TDataSetProvider;
    FAT_SQ_R_GAM_300: TSQLDataSet;
    FAT_DP_R_GAM_300: TDataSetProvider;
    FAT_SQ_R_GAM_600: TSQLDataSet;
    FAT_DP_R_GAM_600: TDataSetProvider;
    FAT_SQ_R_GAM_610: TSQLDataSet;
    FAT_DP_R_GAM_610: TDataSetProvider;
    FAT_SQ_R_GAM_200: TSQLDataSet;
    FAT_DP_R_GAM_200: TDataSetProvider;
    FIN_SQ_M_MCH_TITvlr_titulo: TFMTBCDField;
    FIN_SQ_M_MCHvlr_tot_juros: TFMTBCDField;
    FIN_SQ_M_MCHvlr_tot_movimento: TFMTBCDField;
    FIN_SQ_M_MCHid_condicao_pag: TIntegerField;
    FIN_SQ_M_RECsituacao_chq: TIntegerField;
    FIN_SQ_M_MCH_TITdta_vencimento: TDateField;
    FIN_SQ_M_MCH_TITche_numero: TIntegerField;
    FIN_SQ_M_CON_CXB: TSQLDataSet;
    FIN_SQ_M_CON_CXBid_conciliacao: TIntegerField;
    FIN_SQ_M_CON_CXBid_cxb: TIntegerField;
    FIN_SQ_M_CON_CXBdebcre: TIntegerField;
    FIN_SQ_M_CON_CXBhistorico: TWideStringField;
    FIN_SQ_M_CON_CXBtipo: TWideStringField;
    FIN_SQ_M_CON_CXBdocumento: TWideStringField;
    FIN_SQ_M_CON_CXBvlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CON_CXB_DETid_cxb: TIntegerField;
    FIN_SQ_M_CON_CXB_DETint_selecao: TBooleanField;
    FIN_SQ_M_REC_HCH: TSQLDataSet;
    FIN_DS_M_REC: TDataSource;
    FIN_SQ_M_REC_HCHid_titulo: TIntegerField;
    FIN_SQ_M_REC_HCHdta_movimento: TDateField;
    FIN_SQ_M_REC_HCHsituacao_chq: TIntegerField;
    FIN_SQ_M_REC_HCHoperacao: TIntegerField;
    FIN_SQ_M_REC_HCHid_responsavel: TIntegerField;
    CAD_SQ_C_PAR_CTRmch_id_tif_dep: TIntegerField;
    CAD_SQ_C_PAR_CTRmch_id_tif_dev: TIntegerField;
    CAD_SQ_C_PAR_CTRmch_id_plano_dep: TWideStringField;
    CAD_SQ_C_PAR_CTRmch_id_plano_dev: TWideStringField;
    CAD_SQ_C_PAR_CTRmch_id_plano_ppr: TWideStringField;
    CAD_SQ_C_PAR_CTRmch_id_tif_ppr: TIntegerField;
    FIN_SQ_M_CON_CXBint_debcre: TWideMemoField;
    FIN_SQ_M_CTAint_selecao: TBooleanField;
    FAT_SQ_M_ROM: TSQLDataSet;
    FAT_SQ_M_ROM_NFE: TSQLDataSet;
    FAT_SQ_M_ROM_NFE_ITE: TSQLDataSet;
    FAT_DS_M_ROM: TDataSource;
    FAT_DS_M_ROM_NFE: TDataSource;
    FAT_DP_M_ROM: TDataSetProvider;
    FAT_SQ_M_ROMid_romaneio: TIntegerField;
    FAT_SQ_M_ROMid_empresa: TIntegerField;
    FAT_SQ_M_ROMdta_emissao: TDateField;
    FAT_SQ_M_ROMid_responsavel: TIntegerField;
    FAT_SQ_M_ROMid_motorista: TIntegerField;
    FAT_SQ_M_ROMobs_1: TWideStringField;
    FAT_SQ_M_ROMobs_2: TWideStringField;
    FAT_SQ_M_ROMcod_lme: TWideStringField;
    FAT_SQ_M_ROMrev_lme: TWideStringField;
    FAT_SQ_M_ROMint_nomemta: TWideStringField;
    FAT_SQ_M_ROM_NFEid_romaneio: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEid_romaneio: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEid_item: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEqtde: TFloatField;
    FAT_SQ_M_ROM_NFE_ITEid_cor: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEint_nomeite: TWideStringField;
    FAT_SQ_M_ROM_NFE_ITEint_nomeund: TWideStringField;
    FAT_SQ_M_ROM_NFE_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_ROM_NFE_ITEint_nometam: TWideStringField;
    FAT_SQ_M_ROMint_nomeres: TWideStringField;
    FIN_SQ_M_CTAid_mch: TIntegerField;
    FIN_SQ_M_RECid_mch: TIntegerField;
    FIN_SQ_M_REC_PAGid_mch: TIntegerField;
    FIN_SQ_M_MCHid_cliente: TIntegerField;
    FIN_SQ_M_MCHint_nomecli: TWideStringField;
    BUS_SQ_M_MCH_CHE_INT: TSQLDataSet;
    BUS_DP_M_MCH_CHE_INT: TDataSetProvider;
    CAD_SQ_C_PAR_CTRmch_id_forma_pag: TIntegerField;
    BUS_SQ_M_REC_HCH_INT: TSQLDataSet;
    BUS_DP_M_REC_HCH_INT: TDataSetProvider;
    BUS_SQ_C_PAR_CTRcxa_inf_lote_car_fech: TBooleanField;
    BUS_SQ_C_PAR_CTRconc_alt_txa_fixa_car: TBooleanField;
    BUS_SQ_C_PAR_CTRmch_id_tif_dep: TIntegerField;
    BUS_SQ_C_PAR_CTRmch_id_tif_dev: TIntegerField;
    BUS_SQ_C_PAR_CTRmch_id_tif_ppr: TIntegerField;
    BUS_SQ_C_PAR_CTRmch_id_plano_dep: TWideStringField;
    BUS_SQ_C_PAR_CTRmch_id_plano_dev: TWideStringField;
    BUS_SQ_C_PAR_CTRmch_id_plano_ppr: TWideStringField;
    BUS_SQ_C_PAR_CTRmch_id_forma_pag: TIntegerField;
    FAT_SQ_M_ROM_NFEid_fiscal: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEid_fiscal: TIntegerField;
    FAT_SQ_M_ROM_NFE_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_ROMveiculo: TWideStringField;
    FAT_SQ_M_ROMid_placa: TWideStringField;
    FAT_SQ_M_ROM_NFEint_vlrliquido: TFMTBCDField;
    FAT_SQ_M_ROM_NFEint_numeronf: TIntegerField;
    FIN_SQ_M_REC_HCHid_mch: TIntegerField;
    FIN_SQ_M_REC_HCHsituacao_chq_ant: TIntegerField;
    FIN_SQ_M_REC_HCHint_nomeresp: TWideStringField;
    FAT_SQ_M_ROM_NFE_ITEpeso_liquido: TFloatField;
    FIN_SQ_M_MCH_CHEint_vlr_parcela: TFMTBCDField;
    FIN_SQ_M_MCHid_abertura: TIntegerField;
    FIN_SQ_M_REC_HCHhor_movimento: TTimeField;
    FIN_SQ_M_MCHhor_movimento: TTimeField;
    FIN_SQ_M_CTAid_conciliacao: TIntegerField;
    PCP_SQ_M_ORS_ITEid_sequencia: TIntegerField;
    PCP_SQ_M_ORS_ITEid_sequencia_ped: TIntegerField;
    BUS_DP_M_CON_CTA_INT: TDataSetProvider;
    BUS_SQ_M_CON_CTA_INT: TSQLDataSet;
    BUS_DP_M_CON_GER_INT: TDataSetProvider;
    BUS_SQ_M_CON_GER_INT: TSQLDataSet;
    FIN_SQ_M_CONid_responsavel: TIntegerField;
    FIN_SQ_M_CONid_empresa: TIntegerField;
    FIN_SQ_M_CTAdta_conciliacao: TDateField;
    OFI_SQ_M_OCV_ITEvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_M_ORV_ITEid_responsavel: TIntegerField;
    OFI_SQ_M_ORV_ITEcancelada: TBooleanField;
    OFI_SQ_M_ORV_ITEvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_M_OCVobs: TWideStringField;
    FIN_SQ_M_CON_CXB_DETdta_mov_cxb: TDateField;
    BUS_SQ_R_OCV: TSQLDataSet;
    IntegerField80: TIntegerField;
    IntegerField81: TIntegerField;
    WideStringField121: TWideStringField;
    IntegerField82: TIntegerField;
    DateField13: TDateField;
    DateField14: TDateField;
    IntegerField83: TIntegerField;
    WideStringField122: TWideStringField;
    IntegerField84: TIntegerField;
    IntegerField85: TIntegerField;
    IntegerField86: TIntegerField;
    FMTBCDField72: TFMTBCDField;
    FMTBCDField73: TFMTBCDField;
    FMTBCDField74: TFMTBCDField;
    FMTBCDField75: TFMTBCDField;
    FMTBCDField76: TFMTBCDField;
    FMTBCDField77: TFMTBCDField;
    IntegerField87: TIntegerField;
    WideStringField123: TWideStringField;
    WideStringField124: TWideStringField;
    WideStringField125: TWideStringField;
    WideStringField126: TWideStringField;
    WideStringField127: TWideStringField;
    BUS_SQ_R_OCV_PRO: TSQLDataSet;
    IntegerField88: TIntegerField;
    IntegerField89: TIntegerField;
    IntegerField90: TIntegerField;
    WideStringField128: TWideStringField;
    FloatField32: TFloatField;
    FMTBCDField78: TFMTBCDField;
    FMTBCDField79: TFMTBCDField;
    FloatField33: TFloatField;
    FMTBCDField80: TFMTBCDField;
    FMTBCDField81: TFMTBCDField;
    IntegerField91: TIntegerField;
    WideStringField129: TWideStringField;
    WideStringField130: TWideStringField;
    WideStringField131: TWideStringField;
    WideStringField132: TWideStringField;
    WideStringField133: TWideStringField;
    IntegerField92: TIntegerField;
    FMTBCDField82: TFMTBCDField;
    BUS_DP_R_OCV: TDataSetProvider;
    BUS_CD_R_OCV: TDataSource;
    BUS_SQ_R_OCV_SER: TSQLDataSet;
    IntegerField93: TIntegerField;
    IntegerField94: TIntegerField;
    IntegerField95: TIntegerField;
    WideStringField134: TWideStringField;
    FloatField34: TFloatField;
    FMTBCDField83: TFMTBCDField;
    FMTBCDField84: TFMTBCDField;
    FloatField35: TFloatField;
    FMTBCDField85: TFMTBCDField;
    FMTBCDField86: TFMTBCDField;
    IntegerField96: TIntegerField;
    WideStringField135: TWideStringField;
    WideStringField136: TWideStringField;
    WideStringField137: TWideStringField;
    WideStringField138: TWideStringField;
    WideStringField139: TWideStringField;
    IntegerField97: TIntegerField;
    FMTBCDField87: TFMTBCDField;
    PCP_SQ_M_ORSid_motorista: TIntegerField;
    PCP_SQ_M_ORSint_nomemta: TWideStringField;
    PCP_SQ_M_ORSint_nomecli: TWideStringField;
    PCP_SQ_M_ORSint_telfixo: TWideStringField;
    CAD_SQ_C_ITEint_ipi_entrada: TWideStringField;
    CAD_SQ_C_ITEint_ipi_saida: TWideStringField;
    OFI_SQ_M_ORVvlr_produtos: TFMTBCDField;
    OFI_SQ_M_ORVvlr_desc_produtos: TFMTBCDField;
    OFI_SQ_M_ORVper_desc_produtos: TFloatField;
    OFI_SQ_M_ORVvlr_prod_liquido: TFMTBCDField;
    OFI_SQ_M_ORVvlr_serv_bruto: TFMTBCDField;
    OFI_SQ_M_ORVvlr_desc_servicos: TFMTBCDField;
    OFI_SQ_M_ORVper_desc_servicos: TFloatField;
    OFI_SQ_M_ORVvlr_ser_liquido: TFMTBCDField;
    OFI_SQ_M_ORVvlr_terceiro: TFMTBCDField;
    OFI_SQ_M_ORVvlr_desc_terceiro: TFMTBCDField;
    OFI_SQ_M_ORVper_desc_terceiro: TFloatField;
    OFI_SQ_M_ORVvlr_terc_liquido: TFMTBCDField;
    OFI_SQ_M_ORVvlr_despesas: TFMTBCDField;
    OFI_SQ_M_ORVvlr_credito: TFMTBCDField;
    OFI_SQ_M_ORVvlr_total: TFMTBCDField;
    OFI_SQ_M_ORVid_responsavel: TIntegerField;
    OFI_SQ_M_OCVdoc_cnpj_cpf: TWideStringField;
    BUS_DP_M_OCV: TDataSetProvider;
    BUS_SQ_M_OCV: TSQLDataSet;
    BUS_DS_M_OCV_ITE: TDataSource;
    BUS_SQ_M_OCV_ITE: TSQLDataSet;
    CAD_SQ_C_PAR_CTRorv_id_cargo_mec: TIntegerField;
    CAD_SQ_C_PAR_CTRorv_critica_ite_aber: TBooleanField;
    CAD_SQ_C_PAR_CTRorv_critica_ocv_aber: TBooleanField;
    BUS_SQ_M_OCVid_orcamento: TIntegerField;
    BUS_SQ_M_OCVid_empresa: TIntegerField;
    BUS_SQ_M_OCVplaca: TWideStringField;
    BUS_SQ_M_OCVkm_atual: TIntegerField;
    BUS_SQ_M_OCVdta_orcamento: TDateField;
    BUS_SQ_M_OCVdta_validade: TDateField;
    BUS_SQ_M_OCVid_cliente: TIntegerField;
    BUS_SQ_M_OCVnome_cliente: TWideStringField;
    BUS_SQ_M_OCVid_funcionario: TIntegerField;
    BUS_SQ_M_OCVid_analista: TIntegerField;
    BUS_SQ_M_OCVid_condicao_pag: TIntegerField;
    BUS_SQ_M_OCVvlr_servicos: TFMTBCDField;
    BUS_SQ_M_OCVvlr_produtos: TFMTBCDField;
    BUS_SQ_M_OCVvlr_terceiro: TFMTBCDField;
    BUS_SQ_M_OCVdes_servicos: TFMTBCDField;
    BUS_SQ_M_OCVdes_produtos: TFMTBCDField;
    BUS_SQ_M_OCVvlr_total: TFMTBCDField;
    BUS_SQ_M_OCVstatus: TIntegerField;
    BUS_SQ_M_OCVobs: TWideStringField;
    BUS_SQ_M_OCVdoc_cnpj_cpf: TWideStringField;
    BUS_SQ_M_OCVint_nomecli: TWideStringField;
    BUS_SQ_M_OCV_ITEid_orcamento: TIntegerField;
    BUS_SQ_M_OCV_ITEid_sequencia: TIntegerField;
    BUS_SQ_M_OCV_ITEid_item: TIntegerField;
    BUS_SQ_M_OCV_ITEid_busca_item: TWideStringField;
    BUS_SQ_M_OCV_ITEqtde: TFloatField;
    BUS_SQ_M_OCV_ITEvlr_unitario: TFMTBCDField;
    BUS_SQ_M_OCV_ITEvlr_bruto: TFMTBCDField;
    BUS_SQ_M_OCV_ITEper_desconto: TFloatField;
    BUS_SQ_M_OCV_ITEvlr_desconto: TFMTBCDField;
    BUS_SQ_M_OCV_ITEvlr_liquido: TFMTBCDField;
    BUS_SQ_M_OCV_ITEid_terceiro: TIntegerField;
    BUS_SQ_M_OCV_ITEvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_OCV_ITEint_nomeite: TWideStringField;
    BUS_SQ_M_OCV_ITEint_nomeund: TWideStringField;
    BUS_SQ_M_OCV_ITEint_nomeapl: TWideStringField;
    BUS_SQ_M_OCV_ITEint_nomeref: TWideStringField;
    BUS_SQ_M_OCV_ITEint_nometer: TWideStringField;
    BUS_SQ_M_CTA: TSQLDataSet;
    BUS_DP_M_CTA: TDataSetProvider;
    BUS_SQ_M_CTAint_selecao: TBooleanField;
    BUS_SQ_M_CTAid_controle: TIntegerField;
    BUS_SQ_M_CTAid_empresa: TIntegerField;
    BUS_SQ_M_CTAtipo_lancamento: TIntegerField;
    BUS_SQ_M_CTAdta_lancamento: TDateField;
    BUS_SQ_M_CTAnum_doc: TIntegerField;
    BUS_SQ_M_CTAid_plano: TWideStringField;
    BUS_SQ_M_CTAdeb_cre: TIntegerField;
    BUS_SQ_M_CTAhistorico: TWideStringField;
    BUS_SQ_M_CTAvlr_lancamento: TFMTBCDField;
    BUS_SQ_M_CTAorigem: TIntegerField;
    BUS_SQ_M_CTAid_conta: TIntegerField;
    BUS_SQ_M_CTAid_tipo_financeiro: TIntegerField;
    BUS_SQ_M_CTAconc_numero: TIntegerField;
    BUS_SQ_M_CTAconc_tipo_financeiro: TIntegerField;
    BUS_SQ_M_CTAconc_id_plano: TWideStringField;
    BUS_SQ_M_CTAconc_vlr_lancamento: TFMTBCDField;
    BUS_SQ_M_CTAexp_id_controle: TIntegerField;
    BUS_SQ_M_CTAexp_id_tipo_financeiro: TIntegerField;
    BUS_SQ_M_CTAexp_id_plano: TWideStringField;
    BUS_SQ_M_CTAexp_id_conta: TIntegerField;
    BUS_SQ_M_CTAid_baixa_pbx: TIntegerField;
    BUS_SQ_M_CTAid_baixa_rbx: TIntegerField;
    BUS_SQ_M_CTAdta_movimento: TDateField;
    BUS_SQ_M_CTAconciliado: TBooleanField;
    BUS_SQ_M_CTAcod_lme: TWideStringField;
    BUS_SQ_M_CTArev_lme: TWideStringField;
    BUS_SQ_M_CTAid_abertura: TIntegerField;
    BUS_SQ_M_CTAid_fiscal: TIntegerField;
    BUS_SQ_M_CTAid_titulo_rec: TIntegerField;
    BUS_SQ_M_CTAid_credito: TIntegerField;
    BUS_SQ_M_CTAid_mch: TIntegerField;
    BUS_SQ_M_CTAid_conciliacao: TIntegerField;
    BUS_SQ_M_CTAdta_conciliacao: TDateField;
    BUS_SQ_M_CTAint_origem: TWideMemoField;
    BUS_SQ_M_CTAint_debcre: TWideMemoField;
    BUS_SQ_M_CTAint_nomepct: TWideStringField;
    BUS_SQ_M_CTAint_nometif: TWideStringField;
    BUS_SQ_M_CTAint_nomectc: TWideStringField;
    OFI_SQ_M_ORV_ITEid_sequencia_ite_ocv: TIntegerField;
    CAD_SQ_C_FUNseg_per_canc_orv: TBooleanField;
    OFI_SQ_M_ORVcan_usuario: TIntegerField;
    OFI_SQ_M_ORVcan_data: TDateField;
    OFI_SQ_M_ORVcan_motivo: TWideStringField;
    OFI_SQ_M_ORVcan_hora: TTimeField;
    BUS_SQ_R_ORV: TSQLDataSet;
    IntegerField98: TIntegerField;
    IntegerField99: TIntegerField;
    DateField15: TDateField;
    DateField16: TDateField;
    IntegerField100: TIntegerField;
    IntegerField101: TIntegerField;
    IntegerField102: TIntegerField;
    IntegerField103: TIntegerField;
    IntegerField104: TIntegerField;
    IntegerField105: TIntegerField;
    IntegerField106: TIntegerField;
    IntegerField107: TIntegerField;
    WideStringField140: TWideStringField;
    WideStringField141: TWideStringField;
    IntegerField108: TIntegerField;
    WideStringField142: TWideStringField;
    WideStringField143: TWideStringField;
    WideStringField144: TWideStringField;
    WideMemoField17: TWideMemoField;
    IntegerField109: TIntegerField;
    WideStringField145: TWideStringField;
    WideStringField146: TWideStringField;
    WideStringField147: TWideStringField;
    FMTBCDField88: TFMTBCDField;
    FMTBCDField89: TFMTBCDField;
    FloatField36: TFloatField;
    FMTBCDField90: TFMTBCDField;
    FMTBCDField91: TFMTBCDField;
    FMTBCDField92: TFMTBCDField;
    FloatField37: TFloatField;
    FMTBCDField93: TFMTBCDField;
    FMTBCDField94: TFMTBCDField;
    FMTBCDField95: TFMTBCDField;
    FloatField38: TFloatField;
    FMTBCDField96: TFMTBCDField;
    FMTBCDField97: TFMTBCDField;
    FMTBCDField98: TFMTBCDField;
    FMTBCDField99: TFMTBCDField;
    IntegerField110: TIntegerField;
    IntegerField111: TIntegerField;
    DateField17: TDateField;
    WideStringField148: TWideStringField;
    TimeField1: TTimeField;
    BUS_SQ_R_ORV_DES: TSQLDataSet;
    IntegerField112: TIntegerField;
    IntegerField113: TIntegerField;
    DateField18: TDateField;
    WideStringField149: TWideStringField;
    IntegerField114: TIntegerField;
    FMTBCDField100: TFMTBCDField;
    BUS_SQ_R_ORV_PRO: TSQLDataSet;
    BUS_SQ_R_ORV_TIT: TSQLDataSet;
    IntegerField122: TIntegerField;
    IntegerField123: TIntegerField;
    IntegerField124: TIntegerField;
    DateField19: TDateField;
    FMTBCDField106: TFMTBCDField;
    WideStringField158: TWideStringField;
    WideStringField159: TWideStringField;
    IntegerField125: TIntegerField;
    IntegerField126: TIntegerField;
    WideStringField160: TWideStringField;
    IntegerField127: TIntegerField;
    WideStringField161: TWideStringField;
    BUS_DP_R_ORV: TDataSetProvider;
    BUS_DS_R_ORV: TDataSource;
    BUS_SQ_R_ORV_SER: TSQLDataSet;
    BUS_SQ_R_ORVint_cnpjcpfcli: TWideStringField;
    BUS_SQ_R_ORVint_enderecocli: TWideStringField;
    BUS_SQ_R_ORVint_bairrocli: TWideStringField;
    BUS_SQ_R_ORVint_cepcli: TWideStringField;
    BUS_SQ_R_ORVint_nomecid: TWideStringField;
    BUS_SQ_R_ORVint_ufcid: TWideStringField;
    BUS_SQ_R_ORVint_modelomve: TWideStringField;
    OFI_SQ_M_ORVrea_usuario: TIntegerField;
    OFI_SQ_M_ORVrea_data: TDateField;
    OFI_SQ_M_ORVrea_hora: TTimeField;
    OFI_SQ_M_ORVrea_motivo: TWideStringField;
    BUS_SQ_R_ORVrea_usuario: TIntegerField;
    BUS_SQ_R_ORVrea_data: TDateField;
    BUS_SQ_R_ORVrea_hora: TTimeField;
    BUS_SQ_R_ORVrea_motivo: TWideStringField;
    BUS_SQ_R_ORVint_chassivei: TWideStringField;
    BUS_SQ_R_ORVint_anomodelo: TWideStringField;
    BUS_SQ_R_ORVint_anofabric: TWideStringField;
    BUS_SQ_R_ORVint_motorvei: TWideStringField;
    BUS_SQ_R_ORVint_nomecor: TWideStringField;
    OFI_SQ_M_ORV_ITEid_requisicao: TIntegerField;
    OFI_SQ_M_ORV_ITEcan_usuario: TIntegerField;
    OFI_SQ_M_ORV_ITEcan_data: TDateField;
    OFI_SQ_M_ORV_ITEcan_hora: TTimeField;
    OFI_SQ_M_ORV_ITEcan_motivo: TWideStringField;
    BUS_SQ_M_ROM_REG: TSQLDataSet;
    BUS_SQ_M_ROM_PED: TSQLDataSet;
    BUS_DP_M_ROM_REG: TDataSetProvider;
    BUS_DP_M_ROM_PED: TDataSetProvider;
    PCP_SQ_M_ROMplaca: TWideStringField;
    PCP_SQ_M_ROMint_fonemta: TWideStringField;
    PCP_SQ_M_ROMint_celuar: TWideStringField;
    PCP_SQ_M_ROMint_email: TWideStringField;
    CAD_SQ_C_CLIid_regiao: TIntegerField;
    CAD_SQ_C_CLIint_nomereg: TWideStringField;
    BUS_SQ_R_RQV: TSQLDataSet;
    BUS_DP_R_RQV: TDataSetProvider;
    BUS_SQ_R_RQV_ITE: TSQLDataSet;
    BUS_DS_R_RQV: TDataSource;
    OFI_SQ_M_ORV_ITEdta_requisicao: TDateField;
    BUS_SQ_R_RQVint_selecao: TBooleanField;
    BUS_SQ_R_RQVid_ordem: TIntegerField;
    BUS_SQ_R_RQVid_requisicao: TIntegerField;
    BUS_SQ_R_RQVdta_requisicao: TDateField;
    BUS_SQ_R_RQVint_nomevei: TWideStringField;
    BUS_SQ_R_RQVint_placavei: TWideStringField;
    BUS_SQ_R_RQVint_chassi: TWideStringField;
    BUS_SQ_R_RQVint_fabricadovei: TWideStringField;
    BUS_SQ_R_RQVint_modelomve: TWideStringField;
    BUS_SQ_R_RQVint_nomecor: TWideStringField;
    BUS_DP_C_FUN_MEC: TDataSetProvider;
    BUS_SQ_C_FUN_MEC: TSQLDataSet;
    BUS_SQ_R_RQVint_nomecli: TWideStringField;
    OFI_SQ_M_ORVdta_fechamento: TDateField;
    BUS_SQ_R_ORVdta_fechamento: TDateField;
    BUS_SQ_R_ORVint_nomecpg: TWideStringField;
    PCP_SQ_M_ROM_PEDint_nomecli: TWideStringField;
    PCP_SQ_M_ROM_PEDint_dtapedido: TDateField;
    PCP_SQ_M_ROM_PEDint_codigoregcli: TIntegerField;
    PCP_SQ_M_ROM_PEDint_nomereg: TWideStringField;
    PCP_SQ_M_ROM_PEDid_rom: TIntegerField;
    PCP_SQ_M_ROM_PEDint_cubagemped: TFloatField;
    PCP_SQ_M_ROM_PED_ITEid_rom: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEid_pedido: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEid_ped_ite: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEid_item: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEid_cor: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEqtde: TFloatField;
    PCP_SQ_M_ROM_PED_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_ROM_PED_ITEint_nometam: TWideStringField;
    PCP_SQ_M_ROM_PEDid_pedido: TIntegerField;
    FAT_SQ_R_GAM_190: TSQLDataSet;
    FAT_DP_R_GAM_190: TDataSetProvider;
    FAT_SQ_R_GAM_405: TSQLDataSet;
    FAT_DP_R_GAM_405: TDataSetProvider;
    CAD_SQ_C_PARres_id_cidade: TWideStringField;
    FAT_SQ_R_GAM_500: TSQLDataSet;
    FAT_DP_R_GAM_500: TDataSetProvider;
    FAT_SQ_R_GAM_510: TSQLDataSet;
    FAT_DP_R_GAM_510: TDataSetProvider;
    FAT_SQ_R_GAM_590: TSQLDataSet;
    FAT_DP_R_GAM_590: TDataSetProvider;
    FAT_SQ_R_GAM_D_100: TSQLDataSet;
    FAT_DP_R_GAM_D_100: TDataSetProvider;
    FAT_SQ_R_GAM_D_500: TSQLDataSet;
    FAT_DP_R_GAM_D_500: TDataSetProvider;
    FAT_SQ_R_GAM_D_510: TSQLDataSet;
    FAT_DP_R_GAM_D_510: TDataSetProvider;
    FAT_SQ_R_GAM_D_590: TSQLDataSet;
    FAT_DP_R_GAM_D_590: TDataSetProvider;
    FIN_SQ_M_RECid_vendedor: TIntegerField;
    FAT_SQ_M_NFEind_nf: TIntegerField;
    FAT_SQ_R_GAM_A_100: TSQLDataSet;
    FAT_DP_R_GAM_A_100: TDataSetProvider;
    FAT_SQ_R_GAM_A_170: TSQLDataSet;
    FAT_DP_R_GAM_A_170: TDataSetProvider;
    FAT_SQ_R_GAM_481: TSQLDataSet;
    FAT_DP_R_GAM_481: TDataSetProvider;
    FAT_SQ_R_GAM_485: TSQLDataSet;
    FAT_DP_R_GAM_485: TDataSetProvider;
    BUS_SQ_M_ORV_PRO_INT: TSQLDataSet;
    BUS_DP_M_ORV_PRO_INT: TDataSetProvider;
    BUS_SQ_M_ORV_PRO_INTid_ordem: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_sequencia: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_item: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_busca_item: TWideStringField;
    BUS_SQ_M_ORV_PRO_INTqtde: TFloatField;
    BUS_SQ_M_ORV_PRO_INTvlr_unitario: TFMTBCDField;
    BUS_SQ_M_ORV_PRO_INTvlr_bruto: TFMTBCDField;
    BUS_SQ_M_ORV_PRO_INTper_desconto: TFloatField;
    BUS_SQ_M_ORV_PRO_INTvlr_desconto: TFMTBCDField;
    BUS_SQ_M_ORV_PRO_INTvlr_liquido: TFMTBCDField;
    BUS_SQ_M_ORV_PRO_INTid_mecanico: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_terceiro: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_responsavel: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTcancelada: TBooleanField;
    BUS_SQ_M_ORV_PRO_INTvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_ORV_PRO_INTid_sequencia_ite_ocv: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_requisicao: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTcan_usuario: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTcan_data: TDateField;
    BUS_SQ_M_ORV_PRO_INTcan_hora: TTimeField;
    BUS_SQ_M_ORV_PRO_INTcan_motivo: TWideStringField;
    BUS_SQ_M_ORV_PRO_INTdta_requisicao: TDateField;
    BUS_SQ_M_ORV_PRO_INTint_nomeite: TWideStringField;
    EST_SQ_M_FEAid_ordem: TIntegerField;
    OFI_SQ_M_ORVid_almoxarifado: TIntegerField;
    OFI_SQ_M_ORV_ITEid_cor: TIntegerField;
    OFI_SQ_M_ORV_ITEid_tamanho: TIntegerField;
    OFI_SQ_M_ORV_ITEint_nomecor: TWideStringField;
    OFI_SQ_M_ORV_ITEint_nometam: TWideStringField;
    OFI_SQ_M_ORV_ITEint_tipo_item: TWideStringField;
    FAT_SQ_R_GAM_420: TSQLDataSet;
    FAT_DP_R_GAM_420: TDataSetProvider;
    CAD_SQ_C_CLI_INFid_sequencia: TIntegerField;
    FAT_SQ_R_GAM_425: TSQLDataSet;
    FAT_DP_R_GAM_425: TDataSetProvider;
    FAT_SQ_R_GAM_490: TSQLDataSet;
    FAT_DP_R_GAM_490: TDataSetProvider;
    CAD_SQ_C_VEImedia_consumo: TFloatField;
    CAD_SQ_C_VEIeqp_terceiro: TBooleanField;
    CAD_SQ_C_VEItipo_rodado: TSmallintField;
    CAD_SQ_C_VEItipo_carroceria: TSmallintField;
    CAD_SQ_C_VEIcap_veiculo: TFloatField;
    FAT_SQ_M_ROMrntrc: TWideStringField;
    FAT_SQ_M_ROMchave_mdf: TWideStringField;
    FAT_SQ_M_ROMund_transporte: TSmallintField;
    FAT_SQ_M_ROMvol_carga: TFloatField;
    FAT_SQ_M_ROMqtde_carga: TFloatField;
    FAT_SQ_M_ROM_LAC: TSQLDataSet;
    FAT_SQ_R_GAM_501: TSQLDataSet;
    FAT_DP_R_GAM_501: TDataSetProvider;
    FAT_SQ_R_GAM_505: TSQLDataSet;
    FAT_DP_R_GAM_505: TDataSetProvider;
    BUS_SQ_M_ORV_PRO_INTid_cor: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTid_tamanho: TIntegerField;
    BUS_SQ_M_ORV_PRO_INTint_nomecor: TWideStringField;
    BUS_SQ_M_ORV_PRO_INTint_nometam: TWideStringField;
    BUS_SQ_M_ORV_PRO_INTint_tipo_item: TWideStringField;
    OFI_SQ_M_OCV_ITEint_tipo_item: TWideStringField;
    BUS_SQ_M_OCV_ITEint_tipo_item: TWideStringField;
    OFI_SQ_M_ORVint_cpfcnpj: TWideStringField;
    CAD_SQ_C_PAR_CTReff_motivo_inv: TWideStringField;
    OFI_SQ_M_ORVint_pessoacli: TIntegerField;
    OFI_SQ_M_ORVint_ufcli: TWideStringField;
    OFI_SQ_M_ORV_TIT_SER: TSQLDataSet;
    IntegerField135: TIntegerField;
    IntegerField136: TIntegerField;
    IntegerField137: TIntegerField;
    DateField20: TDateField;
    FMTBCDField112: TFMTBCDField;
    WideStringField170: TWideStringField;
    WideStringField171: TWideStringField;
    IntegerField138: TIntegerField;
    IntegerField139: TIntegerField;
    WideStringField172: TWideStringField;
    IntegerField140: TIntegerField;
    WideStringField173: TWideStringField;
    BUS_SQ_M_ORV_TIT_INT: TSQLDataSet;
    IntegerField152: TIntegerField;
    IntegerField153: TIntegerField;
    IntegerField154: TIntegerField;
    DateField23: TDateField;
    FMTBCDField118: TFMTBCDField;
    WideStringField185: TWideStringField;
    WideStringField186: TWideStringField;
    IntegerField155: TIntegerField;
    IntegerField156: TIntegerField;
    WideStringField187: TWideStringField;
    IntegerField157: TIntegerField;
    WideStringField188: TWideStringField;
    BUS_SQ_M_ORV_ITE_INT: TSQLDataSet;
    IntegerField141: TIntegerField;
    IntegerField142: TIntegerField;
    IntegerField143: TIntegerField;
    WideStringField174: TWideStringField;
    FloatField43: TFloatField;
    FMTBCDField113: TFMTBCDField;
    FMTBCDField114: TFMTBCDField;
    FloatField44: TFloatField;
    FMTBCDField115: TFMTBCDField;
    FMTBCDField116: TFMTBCDField;
    IntegerField144: TIntegerField;
    IntegerField145: TIntegerField;
    IntegerField146: TIntegerField;
    BooleanField8: TBooleanField;
    FMTBCDField117: TFMTBCDField;
    IntegerField147: TIntegerField;
    IntegerField148: TIntegerField;
    IntegerField149: TIntegerField;
    DateField21: TDateField;
    TimeField2: TTimeField;
    WideStringField175: TWideStringField;
    DateField22: TDateField;
    WideStringField176: TWideStringField;
    IntegerField150: TIntegerField;
    IntegerField151: TIntegerField;
    WideStringField177: TWideStringField;
    WideStringField178: TWideStringField;
    WideStringField179: TWideStringField;
    BUS_DP_M_ORV_ITE_INT: TDataSetProvider;
    BUS_DP_M_ORV_TIT_INT: TDataSetProvider;
    CAD_SQ_C_ITEint_serterceiro: TBooleanField;
    OFI_SQ_M_OCV_ITEint_serterceiro: TBooleanField;
    OFI_SQ_M_ORV_ITEint_serterceiro: TBooleanField;
    BUS_SQ_M_NFE_ITE_INTid_fiscal: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_sequencia: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_item: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_inf_fisco: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_cfo: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_st_pis: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_st_cof: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_st_ipi: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_st_icm: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTqtde: TFloatField;
    BUS_SQ_M_NFE_ITE_INTqtde_devolvida: TFloatField;
    BUS_SQ_M_NFE_ITE_INTvlr_unitario: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_mercadoria: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTper_desconto: TFloatField;
    BUS_SQ_M_NFE_ITE_INTvlr_desconto: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_custo: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_liquido: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_outras: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_isenta: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_seguro: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_n_aliquota: TFloatField;
    BUS_SQ_M_NFE_ITE_INTicm_per_reducao: TFloatField;
    BUS_SQ_M_NFE_ITE_INTicm_n_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_n_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_s_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_s_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTipi_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTipi_aliquota: TFloatField;
    BUS_SQ_M_NFE_ITE_INTipi_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTiss_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTiss_aliquota: TFloatField;
    BUS_SQ_M_NFE_ITE_INTiss_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfre_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfre_percentual: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfre_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTpis_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTpis_aliquota: TFloatField;
    BUS_SQ_M_NFE_ITE_INTpis_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTcof_base: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTcof_aliquota: TFloatField;
    BUS_SQ_M_NFE_ITE_INTcof_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTpeso_liquido: TFloatField;
    BUS_SQ_M_NFE_ITE_INTpeso_bruto: TFloatField;
    BUS_SQ_M_NFE_ITE_INTnro_pedido: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTcof_valor_st: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTimp_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_icm_ser_nao_incide: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_outras_desp: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTnum_lote: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTpis_valor_st: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_n_dif_aliq: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTicm_n_vlr_dif_aliq: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTpara_analise_raa: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTfre_dif_aliq_icm: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfre_vlr_dif_icm: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfre_custo: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTorigem_mercadoria: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTicm_s_per_mva: TFloatField;
    BUS_SQ_M_NFE_ITE_INTid_cor: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_tamanho: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_busca_item: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_tributo: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTtri_valor: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTtri_indice: TFloatField;
    BUS_SQ_M_NFE_ITE_INTicm_s_vlr_mva: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTid_sequencia_ite_cmp_ped: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTimp_base_calculo: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTimp_desp_aduana: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTimp_iof: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTdi_numero: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTdi_data: TDateField;
    BUS_SQ_M_NFE_ITE_INTdi_local_desemb: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdi_uf_desemb: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdi_data_desemb: TDateField;
    BUS_SQ_M_NFE_ITE_INTdi_exportador: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdi_numero_adicao: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTdi_seq_adicao: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTdi_fabricante: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdi_vlr_desconto: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTdi_fci: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTid_sequencia_ite_iqm: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTid_sequencia_ite_xml: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTvlr_acrescimo: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTint_tipo_item: TWideStringField;
    FAT_SQ_R_GAM_460: TSQLDataSet;
    FAT_DP_R_GAM_460: TDataSetProvider;
    FAT_SQ_R_GAM_470: TSQLDataSet;
    FAT_DP_R_GAM_470: TDataSetProvider;
    OFI_SQ_M_ORVvlr_cred_produtos: TFMTBCDField;
    OFI_SQ_M_ORVvlr_cred_servicos: TFMTBCDField;
    CAD_SQ_C_FPG_TAPid_forma_pag: TIntegerField;
    CAD_SQ_C_FPG_TAPqtde_parc_tot: TIntegerField;
    CAD_SQ_C_FPG_TAPqtde_parc_ini: TIntegerField;
    CAD_SQ_C_FPG_TAPqtde_parc_fin: TIntegerField;
    CAD_SQ_C_FPG_TAPtaxa: TFloatField;
    CAD_SQ_C_FPG_TAPdias_acres_vencto: TIntegerField;
    CAD_SQ_C_FPG_TAPid_empresa: TIntegerField;
    CAD_SQ_C_FPG_TAPid_maquineta: TIntegerField;
    CAD_SQ_C_MCT: TSQLDataSet;
    CAD_DP_C_MCT: TDataSetProvider;
    BUS_SQ_M_OCV_ITEint_serterceiro: TBooleanField;
    CAD_SQ_C_PAR_CTRfin_id_maquineta_pad: TIntegerField;
    FIN_SQ_M_RBXid_maquineta: TIntegerField;
    FIN_SQ_M_RECcar_id_maquineta: TIntegerField;
    FAT_SQ_M_NFE_TITid_maquineta: TIntegerField;
    OFI_SQ_M_ORV_DESint_desctipo: TWideStringField;
    CAD_SQ_C_PAR_CTRorv_id_forma_pag_rcr: TIntegerField;
    CAD_SQ_C_PAR_CTRfin_perm_n_maquinetas: TBooleanField;
    CAD_SQ_C_MCTid_maquineta: TIntegerField;
    CAD_SQ_C_MCTdescricao: TWideStringField;
    CAD_SQ_C_MCTcod_lme: TWideStringField;
    CAD_SQ_C_MCTrev_lme: TWideStringField;
    FIN_SQ_M_RCRid_maquineta: TIntegerField;
    EST_SQ_M_FESint_nomefan: TWideStringField;
    EST_SQ_M_FES_ALMint_nomefan: TWideStringField;
    CAD_SQ_C_TMEcfo_servico_dentro: TWideStringField;
    CAD_SQ_C_TMEcfo_servico_fora: TWideStringField;
    CAD_SQ_C_TMEcfo_interno_icm_s_pf: TWideStringField;
    CAD_SQ_C_TMEcfo_interno_icm_s_pj: TWideStringField;
    CAD_SQ_C_TMEcfo_externo_icm_s_pf: TWideStringField;
    CAD_SQ_C_TMEcfo_externo_icm_s_pj: TWideStringField;
    BUS_SQ_M_ORV_TIT_SER_INT: TSQLDataSet;
    IntegerField158: TIntegerField;
    IntegerField159: TIntegerField;
    IntegerField160: TIntegerField;
    DateField24: TDateField;
    FMTBCDField119: TFMTBCDField;
    WideStringField180: TWideStringField;
    WideStringField181: TWideStringField;
    IntegerField161: TIntegerField;
    IntegerField162: TIntegerField;
    WideStringField182: TWideStringField;
    IntegerField163: TIntegerField;
    WideStringField183: TWideStringField;
    BUS_DP_M_ORV_TIT_SER_INT: TDataSetProvider;
    BUS_SQ_M_NFE_TIT_INTid_maquineta: TIntegerField;
    BUS_SQ_M_CXA_RES_CARid_empresa: TIntegerField;
    BUS_SQ_M_CXA_RES_CARid_maquineta: TIntegerField;
    BUS_SQ_M_CXA_RES_CARint_nomemaq: TWideStringField;
    BUS_SQ_M_CXA_DET_CNFid_empresa: TIntegerField;
    BUS_SQ_M_CXA_DET_CNFid_maquineta: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBid_empresa: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBid_maquineta: TIntegerField;
    BUS_SQ_M_CXA_DET_CRBint_nomemaq: TWideStringField;
    BUS_SQ_M_CXA_DET_CNFint_nomemaq: TWideStringField;
    BUS_DP_M_CXA_DET_CRC: TDataSetProvider;
    BUS_SQ_M_CXA_DET_CRC: TSQLDataSet;
    BUS_SQ_M_CXA_CARsituacao_chq: TIntegerField;
    BUS_SQ_M_CXA_CARid_mch: TIntegerField;
    BUS_SQ_M_CXA_CARid_vendedor: TIntegerField;
    BUS_SQ_M_CXA_CARcar_id_maquineta: TIntegerField;
    BUS_SQ_M_CXA_CARid_credito: TIntegerField;
    BUS_SQ_M_CXA_CARint_nomemaq: TWideStringField;
    FAT_SQ_M_ROMid_veiculo: TIntegerField;
    CAD_SQ_C_PAR_NFEmdfe_tipo_emissao: TIntegerField;
    CAD_SQ_C_PAR_NFEmdfe_tipo_emitente: TIntegerField;
    CAD_SQ_C_VEItara: TFloatField;
    PCP_SQ_C_MTAdoc_cpf: TWideStringField;
    FAT_SQ_M_ROM_NFEint_nfe_chave: TWideStringField;
    FIN_DP_R_CXA_DIA_RVE: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_RVE: TSQLDataSet;
    FAT_SQ_M_ROMmdf_recibo: TWideStringField;
    FAT_SQ_M_ROMmdf_protocolo: TWideStringField;
    BUS_DP_M_CSU_OPR_PED: TDataSetProvider;
    BUS_SQ_M_CSU_OPR_PED: TSQLDataSet;
    BUS_DS_M_CSU_OPR_PED: TDataSource;
    BUS_SQ_M_CSU_OPR_PED_ITE: TSQLDataSet;
    IntegerField164: TIntegerField;
    IntegerField165: TIntegerField;
    IntegerField166: TIntegerField;
    FloatField45: TFloatField;
    FMTBCDField120: TFMTBCDField;
    FMTBCDField121: TFMTBCDField;
    FloatField46: TFloatField;
    FMTBCDField122: TFMTBCDField;
    FMTBCDField123: TFMTBCDField;
    IntegerField167: TIntegerField;
    IntegerField168: TIntegerField;
    WideStringField184: TWideStringField;
    WideStringField189: TWideStringField;
    WideStringField190: TWideStringField;
    WideStringField191: TWideStringField;
    WideStringField192: TWideStringField;
    FMTBCDField124: TFMTBCDField;
    WideStringField193: TWideStringField;
    BUS_SQ_M_CSU_OPR_PED_TIT: TSQLDataSet;
    IntegerField169: TIntegerField;
    IntegerField170: TIntegerField;
    IntegerField171: TIntegerField;
    DateField25: TDateField;
    FMTBCDField125: TFMTBCDField;
    WideStringField194: TWideStringField;
    WideStringField195: TWideStringField;
    IntegerField172: TIntegerField;
    IntegerField173: TIntegerField;
    WideStringField196: TWideStringField;
    IntegerField174: TIntegerField;
    IntegerField175: TIntegerField;
    WideStringField197: TWideStringField;
    OFI_DP_M_POS: TDataSetProvider;
    OFI_SQ_M_POS: TSQLDataSet;
    OFI_SQ_M_POSid_posvenda: TIntegerField;
    OFI_SQ_M_POSid_empresa: TIntegerField;
    OFI_SQ_M_POSdta_posvenda: TDateField;
    OFI_SQ_M_POSsituacao: TIntegerField;
    OFI_SQ_M_POSobservao: TWideStringField;
    OFI_SQ_M_POSsolucao: TWideStringField;
    OFI_SQ_M_POSid_responsavel: TIntegerField;
    OFI_SQ_M_POShor_posvenda: TTimeField;
    OFI_SQ_M_POSid_ordem: TIntegerField;
    OFI_SQ_M_POSint_situacaopos: TWideStringField;
    OFI_SQ_M_POSint_empfantasia: TWideStringField;
    OFI_SQ_M_POSint_nomecli: TWideStringField;
    OFI_SQ_R_POS: TSQLDataSet;
    OFI_DP_R_POS: TDataSetProvider;
    CAD_SQ_C_CLI_BCOid_cliente: TIntegerField;
    CAD_SQ_C_CLI_BCOid_banco_info: TIntegerField;
    CAD_SQ_C_CLI_BCOdta_informacao: TDateField;
    CAD_SQ_C_CLI_BCOobs: TWideStringField;
    CAD_SQ_C_CLIcob_cep: TWideStringField;
    CAD_SQ_C_CLIfiliacao: TWideStringField;
    OFI_SQ_R_OFV_FIV: TSQLDataSet;
    OFI_DP_R_OFV_FIV: TDataSetProvider;
    OFI_SQ_R_OFV_FIV_SER: TSQLDataSet;
    OFI_DS_R_OFV_FIV: TDataSource;
    OFI_SQ_R_OFV_POS_001: TSQLDataSet;
    OFI_DP_R_OFV_POS_001: TDataSetProvider;
    OFI_SQ_R_OFV_POS_001_PRO: TSQLDataSet;
    OFI_DS_R_OFV_POS_001: TDataSource;
    OFI_SQ_R_OFV_POS_001_SER: TSQLDataSet;
    OFI_SQ_R_OFV_POS_001id_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_empresa: TIntegerField;
    OFI_SQ_R_OFV_POS_001dta_emissao: TDateField;
    OFI_SQ_R_OFV_POS_001dta_entrega: TDateField;
    OFI_SQ_R_OFV_POS_001id_cliente: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_veiculo: TIntegerField;
    OFI_SQ_R_OFV_POS_001km_atual: TIntegerField;
    OFI_SQ_R_OFV_POS_001tanque_combus: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_forma_pag: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_condicao_pag: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_analista: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POS_001obs_reclamacao: TWideStringField;
    OFI_SQ_R_OFV_POS_001obs_problema: TWideStringField;
    OFI_SQ_R_OFV_POS_001status: TIntegerField;
    OFI_SQ_R_OFV_POS_001vlr_produtos: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_desc_produtos: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001per_desc_produtos: TFloatField;
    OFI_SQ_R_OFV_POS_001vlr_prod_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_serv_bruto: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_desc_servicos: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001per_desc_servicos: TFloatField;
    OFI_SQ_R_OFV_POS_001vlr_ser_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_terceiro: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_desc_terceiro: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001per_desc_terceiro: TFloatField;
    OFI_SQ_R_OFV_POS_001vlr_terc_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_despesas: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_credito: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_total: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001id_tipo_os: TIntegerField;
    OFI_SQ_R_OFV_POS_001id_responsavel: TIntegerField;
    OFI_SQ_R_OFV_POS_001can_usuario: TIntegerField;
    OFI_SQ_R_OFV_POS_001can_data: TDateField;
    OFI_SQ_R_OFV_POS_001can_motivo: TWideStringField;
    OFI_SQ_R_OFV_POS_001can_hora: TTimeField;
    OFI_SQ_R_OFV_POS_001rea_usuario: TIntegerField;
    OFI_SQ_R_OFV_POS_001rea_data: TDateField;
    OFI_SQ_R_OFV_POS_001rea_hora: TTimeField;
    OFI_SQ_R_OFV_POS_001rea_motivo: TWideStringField;
    OFI_SQ_R_OFV_POS_001dta_fechamento: TDateField;
    OFI_SQ_R_OFV_POS_001id_almoxarifado: TIntegerField;
    OFI_SQ_R_OFV_POS_001vlr_cred_produtos: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001vlr_cred_servicos: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001int_cpfcnpj: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_pessoacli: TIntegerField;
    OFI_SQ_R_OFV_POS_001int_nomecli: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_telfix: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_telmov: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_nomecom: TWideMemoField;
    OFI_SQ_R_OFV_POS_001int_placa: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_nomevei: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_nometio: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_ufcli: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROid_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_sequencia: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_item: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_busca_item: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROqtde: TFloatField;
    OFI_SQ_R_OFV_POS_001_PROvlr_unitario: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_PROvlr_bruto: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_PROper_desconto: TFloatField;
    OFI_SQ_R_OFV_POS_001_PROvlr_desconto: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_PROvlr_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_PROid_mecanico: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_terceiro: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_responsavel: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROcancelada: TBooleanField;
    OFI_SQ_R_OFV_POS_001_PROvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_PROid_sequencia_ite_ocv: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_requisicao: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROcan_usuario: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROcan_data: TDateField;
    OFI_SQ_R_OFV_POS_001_PROcan_hora: TTimeField;
    OFI_SQ_R_OFV_POS_001_PROcan_motivo: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROdta_requisicao: TDateField;
    OFI_SQ_R_OFV_POS_001_PROid_cor: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROid_tamanho: TIntegerField;
    OFI_SQ_R_OFV_POS_001_PROint_nomeite: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_nomeund: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_nomeapl: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_nomeref: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_nomemec: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_nometer: TWideStringField;
    OFI_SQ_R_OFV_POS_001_PROint_tipoitem: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERid_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_sequencia: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_item: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_busca_item: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERqtde: TFloatField;
    OFI_SQ_R_OFV_POS_001_SERvlr_unitario: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_SERvlr_bruto: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_SERper_desconto: TFloatField;
    OFI_SQ_R_OFV_POS_001_SERvlr_desconto: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_SERvlr_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_SERid_mecanico: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_terceiro: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_responsavel: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERcancelada: TBooleanField;
    OFI_SQ_R_OFV_POS_001_SERvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_R_OFV_POS_001_SERid_sequencia_ite_ocv: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_requisicao: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERcan_usuario: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERcan_data: TDateField;
    OFI_SQ_R_OFV_POS_001_SERcan_hora: TTimeField;
    OFI_SQ_R_OFV_POS_001_SERcan_motivo: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERdta_requisicao: TDateField;
    OFI_SQ_R_OFV_POS_001_SERid_cor: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERid_tamanho: TIntegerField;
    OFI_SQ_R_OFV_POS_001_SERint_nomeite: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_nomeund: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_nomeapl: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_nomeref: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_nomemec: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_nometer: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_tipoitem: TWideStringField;
    OFI_SQ_R_OFV_POS_001_SERint_serterceiro: TBooleanField;
    OFI_SQ_R_OFV_COM_001: TSQLDataSet;
    OFI_DP_R_OFV_COM_001: TDataSetProvider;
    OFI_SQ_R_OFV_COM_002: TSQLDataSet;
    OFI_DP_R_OFV_COM_002: TDataSetProvider;
    OFI_SQ_R_OFV_ABC_001: TSQLDataSet;
    OFI_DP_R_OFV_ABC_001: TDataSetProvider;
    OFI_SQ_R_OFV_ABC_002: TSQLDataSet;
    OFI_DP_R_OFV_ABC_002: TDataSetProvider;
    OFI_SQ_R_OFV_POS_001int_orvsituacao: TWideMemoField;
    OFI_SQ_R_OFV_POS_001int_nomeana: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_nomecpg: TWideStringField;
    OFI_SQ_M_ORVobservacoes: TWideStringField;
    OFI_SQ_M_ORVint_nomemve: TWideStringField;
    BUS_SQ_R_ORV_PROid_ordem: TIntegerField;
    BUS_SQ_R_ORV_PROid_cor: TIntegerField;
    BUS_SQ_R_ORV_PROid_tamanho: TIntegerField;
    BUS_SQ_R_ORV_PROid_item: TIntegerField;
    BUS_SQ_R_ORV_PROint_nomeite: TWideStringField;
    BUS_SQ_R_ORV_PROint_nomeund: TWideStringField;
    BUS_SQ_R_ORV_PROint_nomeapl: TWideStringField;
    BUS_SQ_R_ORV_PROint_nomeref: TWideStringField;
    BUS_SQ_R_ORV_PROint_tipoitem: TWideStringField;
    BUS_SQ_R_ORV_PROvlr_unitario: TFMTBCDField;
    BUS_SQ_R_ORV_PROqtde: TFloatField;
    BUS_SQ_R_ORV_PROvlr_bruto: TFloatField;
    BUS_SQ_R_ORV_PROvlr_desconto: TFMTBCDField;
    BUS_SQ_R_ORV_PROvlr_liquido: TFloatField;
    BUS_SQ_R_ORV_SERid_ordem: TIntegerField;
    BUS_SQ_R_ORV_SERid_cor: TIntegerField;
    BUS_SQ_R_ORV_SERid_tamanho: TIntegerField;
    BUS_SQ_R_ORV_SERid_item: TIntegerField;
    BUS_SQ_R_ORV_SERint_nomeite: TWideStringField;
    BUS_SQ_R_ORV_SERint_nomeund: TWideStringField;
    BUS_SQ_R_ORV_SERint_nomeapl: TWideStringField;
    BUS_SQ_R_ORV_SERint_nomeref: TWideStringField;
    BUS_SQ_R_ORV_SERint_tipoitem: TWideStringField;
    BUS_SQ_R_ORV_SERvlr_unitario: TFMTBCDField;
    BUS_SQ_R_ORV_SERqtde: TFloatField;
    BUS_SQ_R_ORV_SERvlr_bruto: TFloatField;
    BUS_SQ_R_ORV_SERvlr_desconto: TFMTBCDField;
    BUS_SQ_R_ORV_SERvlr_liquido: TFloatField;
    BUS_SQ_R_ORVid_almoxarifado: TIntegerField;
    BUS_SQ_R_ORVvlr_cred_produtos: TFMTBCDField;
    BUS_SQ_R_ORVvlr_cred_servicos: TFMTBCDField;
    BUS_SQ_R_ORVobservacoes: TWideStringField;
    BUS_SQ_R_ORVint_numerocli: TWideStringField;
    BUS_SQ_R_ORVint_nomeana: TWideStringField;
    BUS_SQ_R_RQV_ITEid_ordem: TIntegerField;
    BUS_SQ_R_RQV_ITEid_cor: TIntegerField;
    BUS_SQ_R_RQV_ITEid_tamanho: TIntegerField;
    BUS_SQ_R_RQV_ITEid_item: TIntegerField;
    BUS_SQ_R_RQV_ITEint_nomeite: TWideStringField;
    BUS_SQ_R_RQV_ITEint_nomeund: TWideStringField;
    BUS_SQ_R_RQV_ITEint_nomeapl: TWideStringField;
    BUS_SQ_R_RQV_ITEint_nomeref: TWideStringField;
    BUS_SQ_R_RQV_ITEint_tipoitem: TWideStringField;
    BUS_SQ_R_RQV_ITEvlr_unitario: TFMTBCDField;
    BUS_SQ_R_RQV_ITEqtde: TFloatField;
    BUS_SQ_R_RQV_ITEvlr_bruto: TFloatField;
    BUS_SQ_R_RQV_ITEvlr_desconto: TFMTBCDField;
    BUS_SQ_R_RQV_ITEvlr_liquido: TFloatField;
    FIN_SQ_M_RECid_credito: TIntegerField;
    FIN_SQ_M_RECint_docimpresso: TIntegerField;
    CAD_SQ_C_FUNseg_habilitar_seg: TBooleanField;
    CAD_SQ_C_FUNseg_redef_senha: TBooleanField;
    CAD_SQ_C_GRUctc_epi: TBooleanField;
    OFI_SQ_M_POSint_nomevei: TWideStringField;
    OFI_SQ_M_POSint_telfixo: TWideStringField;
    OFI_SQ_M_POSint_telmovel: TWideStringField;
    OFI_SQ_M_POSint_dtaemissaoorv: TDateField;
    OFI_SQ_M_POSint_kmatualorv: TIntegerField;
    OFI_SQ_M_POSint_obsrecorv: TWideStringField;
    OFI_SQ_M_POSint_obspro: TWideStringField;
    OFI_SQ_M_POSint_codcliente: TIntegerField;
    FIN_SQ_M_CON_CXB_DETmov_gerado: TBooleanField;
    ctc_ds_c_tpr: TDataSource;
    ctc_sq_c_tprid_tpr: TIntegerField;
    ctc_sq_c_tprdescricao: TWideStringField;
    ctc_sq_c_tpr_ite: TSQLDataSet;
    ctc_sq_c_tpr_iteid_tpr: TIntegerField;
    ctc_sq_c_tpr_iteid_item: TWideStringField;
    ctc_sq_c_tpr_itedescricao: TWideStringField;
    ctc_sq_c_tpr_iteclasse: TIntegerField;
    ctc_sq_c_tpr_iteunidade: TWideStringField;
    ctc_sq_c_tpr_itepreco_unitario: TFMTBCDField;
    ctc_sq_c_tpr_itedata_base: TDateField;
    ctc_sq_c_tpr_iteid_item_interno: TIntegerField;
    ctc_sq_m_orc_ite_med: TSQLDataSet;
    ctc_ds_m_orc_ite: TDataSource;
    BUS_SQ_M_POS_STA: TSQLDataSet;
    BUS_DP_M_POS_STA: TDataSetProvider;
    FIN_DS_M_CON_CXB: TDataSource;
    ctc_sq_m_orc_ite_com: TSQLDataSet;
    bus_sq_m_ctc_tpr: TSQLDataSet;
    bus_dp_m_ctc_tpr: TDataSetProvider;
    OFI_DP_R_POS_OSP: TDataSetProvider;
    OFI_SQ_R_POS_OSP: TSQLDataSet;
    OFI_SQ_M_ORVstatus_painel: TIntegerField;
    OFI_SQ_M_ORVint_statuspainel: TWideStringField;
    BUS_SQ_M_PNO: TSQLDataSet;
    BUS_DP_M_PNO: TDataSetProvider;
    BUS_SQ_M_PNM: TSQLDataSet;
    BUS_DP_M_PNM: TDataSetProvider;
    ctc_sq_m_orc_iteid_orc: TIntegerField;
    ctc_sq_m_orc_itegrupo: TWideStringField;
    ctc_sq_m_orc_itedescricao: TWideStringField;
    ctc_sq_m_orc_iteund: TWideStringField;
    ctc_sq_m_orc_iteclasse: TWideStringField;
    ctc_sq_m_orc_itecod_prpoprio: TWideStringField;
    ctc_sq_m_orc_iteqtde: TFloatField;
    ctc_sq_m_orc_itevlr_unitario: TFMTBCDField;
    ctc_sq_m_orc_itevlr_total: TFMTBCDField;
    ctc_sq_m_orc_iteqtde_saldo_medicao: TFloatField;
    ctc_sq_m_orc_itevlr_mo: TFMTBCDField;
    ctc_sq_m_orc_itevlr_mat: TFMTBCDField;
    ctc_sq_m_orc_iteper_ls: TFloatField;
    ctc_sq_m_orc_itevlr_ls: TFMTBCDField;
    ctc_sq_m_orc_iteper_bdi: TFloatField;
    ctc_sq_m_orc_itevlr_bdi: TFMTBCDField;
    ctc_sq_m_orc_iteper_adm: TFloatField;
    ctc_sq_m_orc_itevlr_adm: TFMTBCDField;
    ctc_sq_m_orc_itetotal_taxa: TFMTBCDField;
    ctc_sq_m_orc_ite_medid_orc: TIntegerField;
    ctc_sq_m_orc_ite_medgrupo: TWideStringField;
    ctc_sq_m_orc_ite_medid_med: TIntegerField;
    ctc_sq_m_orc_ite_medid_item: TWideStringField;
    ctc_sq_m_orc_ite_medqtde: TFloatField;
    ctc_sq_m_orc_ite_meddta_medicao: TDateField;
    ctc_sq_m_orc_ite_medid_responsavel: TIntegerField;
    ctc_sq_m_orcid_estrutura: TIntegerField;
    ctc_sq_c_eoc: TSQLDataSet;
    ctc_dp_c_eoc: TDataSetProvider;
    ctc_ds_c_eoc: TDataSource;
    ctc_sq_c_eoc_gru: TSQLDataSet;
    ctc_sq_c_eocid_estrutura: TIntegerField;
    ctc_sq_c_eocdescricao: TWideStringField;
    ctc_sq_c_eoc_gruid_estrutura: TIntegerField;
    ctc_sq_c_eoc_grugrupo: TWideStringField;
    ctc_sq_c_eoc_grudescricao: TWideStringField;
    ctc_sq_c_eoc_gruund: TWideStringField;
    ctc_sq_c_eoc_gruclasse: TWideStringField;
    ctc_sq_c_eoc_grucod_prpoprio: TWideStringField;
    PCP_SQ_C_MEQvlr_aquisicao: TFMTBCDField;
    PCP_SQ_C_MEQnome_fabricante: TWideStringField;
    FIN_SQ_M_CON_CXB_AUX: TSQLDataSet;
    IntegerField115: TIntegerField;
    IntegerField116: TIntegerField;
    WideStringField150: TWideStringField;
    IntegerField117: TIntegerField;
    IntegerField118: TIntegerField;
    FMTBCDField101: TFMTBCDField;
    IntegerField119: TIntegerField;
    WideStringField151: TWideStringField;
    IntegerField120: TIntegerField;
    WideMemoField18: TWideMemoField;
    DateField26: TDateField;
    IntegerField121: TIntegerField;
    BooleanField6: TBooleanField;
    FIN_SQ_M_CON_CXB_AUXtipo: TIntegerField;
    FIN_SQ_M_CON_CXB_AUXdta_movimento: TDateField;
    FIN_SQ_M_CON_CXBstatus: TWideStringField;
    BUS_SQ_C_PAR_CPG_INF: TSQLDataSet;
    BUS_DP_C_PAR_CPG_INF: TDataSetProvider;
    EST_SQ_R_ABC_VLR: TSQLDataSet;
    EST_DP_R_ABC_VLR: TDataSetProvider;
    EST_SQ_R_ABC_QTD: TSQLDataSet;
    EST_DP_R_ABC_QTD: TDataSetProvider;
    FIN_SQ_M_CON_CXBint_selecao: TBooleanField;
    FIN_SQ_M_CON_CXBselecao: TIntegerField;
    ctc_sq_m_orc_ite_comid_orc: TIntegerField;
    ctc_sq_m_orc_ite_comgrupo: TWideStringField;
    ctc_sq_m_orc_ite_comid_com: TIntegerField;
    ctc_sq_m_orc_ite_comid_item: TWideStringField;
    ctc_sq_m_orc_ite_comcoeficiente: TFloatField;
    ctc_sq_m_orc_ite_comvlr_unitario: TFMTBCDField;
    ctc_sq_m_orc_ite_comvlr_total: TFMTBCDField;
    ctc_sq_m_orc_ite_comint_nomeitetpr: TWideStringField;
    ctc_sq_m_orc_ite_comint_classeitetpr: TIntegerField;
    FIN_SQ_M_CON_CXB_DETtipo_reg: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_tipo_financeiro_transf: TIntegerField;
    FIN_SQ_M_CON_CXB_AUXid_tipo_financeiro_transf: TIntegerField;
    FIN_SQ_M_RBX_TITint_numeronf: TIntegerField;
    FAT_SQ_M_NFE_ITEvlr_unitario_orig: TFMTBCDField;
    CTC_SQ_R_ORC: TSQLDataSet;
    CTC_DP_R_ORC: TDataSetProvider;
    CTC_SQ_R_COM: TSQLDataSet;
    CTC_DP_R_COM: TDataSetProvider;
    CTC_DS_R_COM: TDataSource;
    CTC_SQ_R_COM_ITE: TSQLDataSet;
    EST_SQ_R_GIR: TSQLDataSet;
    EST_DP_R_GIR: TDataSetProvider;
    FAT_SQ_M_IQM_ITEint_selecao: TBooleanField;
    FAT_SQ_M_IQM_ITEint_qtdeimprimir: TIntegerField;
    PCP_DP_C_CUE: TDataSetProvider;
    PCP_SQ_C_CUE: TSQLDataSet;
    PCP_DP_C_CLE: TDataSetProvider;
    PCP_SQ_C_CLE: TSQLDataSet;
    CAD_SQ_C_ITEetiq_id_cue: TIntegerField;
    CAD_SQ_C_GRUimprime_msq_etq: TBooleanField;
    EST_DP_R_MLT: TDataSetProvider;
    EST_SQ_R_MLT: TSQLDataSet;
    BUS_SQ_R_ORC_ITE_MED: TSQLDataSet;
    BUS_DP_R_ORC_ITE_MED: TDataSetProvider;
    FAT_SQ_M_ROM_NFEid_busca_nfe: TWideStringField;
    CAD_SQ_C_GRUmsg_etq1: TWideStringField;
    CAD_SQ_C_GRUmsg_etq2: TWideStringField;
    CAD_SQ_C_GRUmsg_etq3: TWideStringField;
    CAD_SQ_C_GRUmsg_etq4: TWideStringField;
    CAD_SQ_C_GRUmsg_etq5: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq1: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq2: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq3: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq4: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq5: TWideStringField;
    CAD_SQ_C_ITEint_impmsgetq: TBooleanField;
    BUS_DP_R_CTE_ITE: TDataSetProvider;
    BUS_SQ_R_CTE_ITE: TSQLDataSet;
    CAD_SQ_C_PAR_CTRped_envia_carga: TBooleanField;
    CAD_SQ_C_GRUmsg_etq6: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq6: TWideStringField;
    FIN_SQ_M_ORCid_empresa: TIntegerField;
    CAD_SQ_C_GRUmsg_etq7: TWideStringField;
    CAD_SQ_C_ITEint_msg_etq7: TWideStringField;
    BUS_DP_R_CHQ: TDataSetProvider;
    BUS_SQ_R_CHQ: TSQLDataSet;
    BUS_DS_R_CHQ: TDataSource;
    BUS_SQ_R_CHQ_MCH: TSQLDataSet;
    PCP_SQ_M_ACR_ITEid_acr: TIntegerField;
    PCP_SQ_M_ACR_ITEid_acr_p: TIntegerField;
    PCP_SQ_M_ACR_ITEid_item: TIntegerField;
    PCP_SQ_M_ACR_ITEdefeito_produto: TWideStringField;
    PCP_SQ_M_ACR_ITEgarantia: TBooleanField;
    PCP_SQ_M_ACR_ITEdata_validade: TDateField;
    PCP_SQ_M_ACR_ITEdata_fabricacao: TDateField;
    PCP_SQ_M_ACR_ITEdata_venda: TDateField;
    PCP_SQ_M_ACR_ITEid_dis: TIntegerField;
    PCP_SQ_M_ACR_ITEdefeito_procede: TBooleanField;
    PCP_SQ_M_ACR_ITEdefeito_constatado: TWideStringField;
    PCP_SQ_M_ACR_ITEmotivo_nao_procede: TWideStringField;
    PCP_SQ_M_ACR_ITEcomentarios: TWideStringField;
    PCP_SQ_M_ACR_ITEdata_monitor_abert: TDateField;
    PCP_SQ_M_ACR_ITEhora_monitor_abert: TSQLTimeStampField;
    PCP_SQ_M_ACR_ITEdata_monitor_encer: TDateField;
    PCP_SQ_M_ACR_ITEhora_monitor_encer: TSQLTimeStampField;
    PCP_SQ_M_ACR_ITEid_resp_monitor: TIntegerField;
    PCP_SQ_M_ACR_ITEid_resp_ana: TIntegerField;
    PCP_SQ_M_ACR_ITEdata_entrada_ana: TDateField;
    PCP_SQ_M_ACR_ITEdata_saida_ana: TDateField;
    PCP_SQ_M_ACR_ITEid_busca_item: TWideStringField;
    PCP_SQ_M_ACR_ITEid_cor: TIntegerField;
    PCP_SQ_M_ACR_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_ACR_ITEint_desc_pro: TWideStringField;
    PCP_SQ_M_ACR_ITEint_id_und_venda: TWideStringField;
    PCP_SQ_M_ACR_ITEint_desc_und: TWideStringField;
    PCP_SQ_M_ACR_ITEint_descdis: TWideStringField;
    PCP_SQ_M_ACR_ITEint_nomeres: TWideStringField;
    PCP_SQ_M_ACR_ITEint_nometam: TWideStringField;
    PCP_SQ_M_ACR_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_ACR_ITEint_nomeresana: TWideStringField;
    BUS_SQ_R_CHQid_titulo: TIntegerField;
    BUS_SQ_R_CHQid_empresa: TIntegerField;
    BUS_SQ_R_CHQid_cliente: TIntegerField;
    BUS_SQ_R_CHQnum_parcela: TWideStringField;
    BUS_SQ_R_CHQdta_emissao: TDateField;
    BUS_SQ_R_CHQhistorico: TWideStringField;
    BUS_SQ_R_CHQvlr_parcela: TFMTBCDField;
    BUS_SQ_R_CHQvlr_original: TFMTBCDField;
    BUS_SQ_R_CHQdta_vencimento: TDateField;
    BUS_SQ_R_CHQdta_original: TDateField;
    BUS_SQ_R_CHQvlr_saldo: TFMTBCDField;
    BUS_SQ_R_CHQid_fiscal: TIntegerField;
    BUS_SQ_R_CHQorigem: TIntegerField;
    BUS_SQ_R_CHQid_forma_pag: TIntegerField;
    BUS_SQ_R_CHQche_conta: TIntegerField;
    BUS_SQ_R_CHQche_cheque: TIntegerField;
    BUS_SQ_R_CHQche_banco: TWideStringField;
    BUS_SQ_R_CHQche_emitente: TWideStringField;
    BUS_SQ_R_CHQche_agencia: TWideStringField;
    BUS_SQ_R_CHQtipo_lancamento: TIntegerField;
    BUS_SQ_R_CHQid_local_titulo: TIntegerField;
    BUS_SQ_R_CHQid_plano: TWideStringField;
    BUS_SQ_R_CHQbol_nosso_numero: TWideStringField;
    BUS_SQ_R_CHQcar_taxa: TFloatField;
    BUS_SQ_R_CHQcar_motivo_can: TWideStringField;
    BUS_SQ_R_CHQcar_dta_can: TDateField;
    BUS_SQ_R_CHQcod_lme: TWideStringField;
    BUS_SQ_R_CHQrev_lme: TWideStringField;
    BUS_SQ_R_CHQseq_nosso_numero: TIntegerField;
    BUS_SQ_R_CHQbol_chave: TIntegerField;
    BUS_SQ_R_CHQbol_id_conta: TIntegerField;
    BUS_SQ_R_CHQcar_taxa_ope: TFloatField;
    BUS_SQ_R_CHQcar_n_lote: TWideStringField;
    BUS_SQ_R_CHQcar_n_lote_id_resp: TIntegerField;
    BUS_SQ_R_CHQcar_n_lote_id_conta: TIntegerField;
    BUS_SQ_R_CHQid_baixa: TIntegerField;
    BUS_SQ_R_CHQsituacao_chq: TIntegerField;
    BUS_SQ_R_CHQid_mch: TIntegerField;
    BUS_SQ_R_CHQid_vendedor: TIntegerField;
    BUS_SQ_R_CHQcar_id_maquineta: TIntegerField;
    BUS_SQ_R_CHQid_credito: TIntegerField;
    BUS_SQ_R_CHQ_MCHvlr_pago: TFMTBCDField;
    BUS_SQ_R_CHQ_MCHid_alinea: TWideStringField;
    BUS_SQ_R_CHQ_MCHid_controle: TIntegerField;
    BUS_SQ_R_CHQ_MCHdta_movimento: TDateField;
    PCP_SQ_R_ACR_ITEcomentarios: TWideStringField;
    PCP_SQ_R_ACR_ITEdefeito_produto: TWideStringField;
    BUS_SQ_R_CHQint_nomeemp: TWideStringField;
    BUS_SQ_R_CHQint_nomecli: TWideStringField;
    BUS_SQ_R_CHQint_descsit: TWideMemoField;
    BUS_SQ_R_CHQint_nomevend: TWideStringField;
    BUS_SQ_R_CHQ_MCHid_titulo: TIntegerField;
    BUS_SQ_R_CHQ_MCHint_descoperacao: TWideMemoField;
    CAD_SQ_C_FPGcar_bandeira: TWideStringField;
    CAD_SQ_C_CCR: TSQLDataSet;
    CAD_DP_C_CCR: TDataSetProvider;
    CAD_SQ_C_CCRid_ccr: TIntegerField;
    CAD_SQ_C_CCRdescricao: TWideStringField;
    CAD_SQ_C_CCRcnpj: TWideStringField;
    CAD_SQ_C_CCRfone: TWideStringField;
    CAD_SQ_C_FPGid_ccr: TIntegerField;
    FAT_SQ_M_NFE_TITint_carbandeira: TWideStringField;
    FAT_SQ_M_NFE_TITint_docimpresso: TIntegerField;
    FAT_SQ_M_NFE_TITint_cnpj_ccr: TWideStringField;
    FAT_SQ_M_NFE_TITint_nomemaq: TWideStringField;
    FAT_SQ_M_NFE_TITint_cardebcre: TIntegerField;
    CAD_SQ_C_PAR_NFEnfc_csc: TWideStringField;
    CAD_SQ_C_PAR_NFEnfc_id_token: TWideStringField;
    CAD_SQ_C_PECper_correcao_aprazo: TFloatField;
    BUS_SQ_M_NFE_TIT_MAQ: TSQLDataSet;
    BUS_DP_M_NFE_TIT_MAQ: TDataSetProvider;
    CAD_SQ_C_CTClayout_remessa: TWideStringField;
    FIN_DP_R_IND: TDataSetProvider;
    BUS_SQ_R_IND: TSQLDataSet;
    EST_SQ_M_LOTint_nomecor: TWideStringField;
    EST_SQ_M_LOTint_nometam: TWideStringField;
    CAD_SQ_C_CTCtipo_cobranca: TIntegerField;
    CAD_SQ_C_CTCcaract_titulo: TIntegerField;
    CAD_SQ_C_CTCtipo_carteira: TIntegerField;
    CAD_SQ_C_CTCresp_emissao: TIntegerField;
    CAD_SQ_C_CTCagencia_dig: TIntegerField;
    CAD_SQ_C_CTCconta_corrente_dig: TIntegerField;
    CAD_SQ_C_CTCconvenio: TIntegerField;
    CAD_SQ_C_CTCcarteira: TWideStringField;
    EST_SQ_R_MOV_SPR: TSQLDataSet;
    EST_DP_R_MOV_SPR: TDataSetProvider;
    CAD_SQ_C_PAR_CTRnfe_per_partilha_dest: TFloatField;
    CAD_SQ_C_CTCmsg_local_pagto: TWideStringField;
    CAD_SQ_C_CTCcarteira_variacao: TWideStringField;
    FAT_SQ_M_NFEint_tipofinal: TIntegerField;
    CAD_SQ_C_FORcontribuinte: TIntegerField;
    FAT_SQ_M_NFEint_contribuinte: TIntegerField;
    CAD_SQ_C_CLIcontribuinte: TIntegerField;
    CAD_SQ_C_PAR_CTRnfe_per_partilha_orig: TFloatField;
    CAD_SQ_C_PAR_CTRnfe_per_icms_saida: TFloatField;
    CAD_SQ_C_PAR_CTRsgq_ped_gera_nfs: TBooleanField;
    FAT_DP_R_GAM_0190: TDataSetProvider;
    FAT_SQ_R_GAM_0190: TSQLDataSet;
    FAT_DP_R_GAM_0400: TDataSetProvider;
    FAT_SQ_R_GAM_0400: TSQLDataSet;
    FAT_SQ_M_NFE_ITEint_cod_onu: TWideStringField;
    FAT_DP_R_GAM_0405: TDataSetProvider;
    FAT_SQ_R_GAM_0405: TSQLDataSet;
    BUS_SQ_C_PAR_CTRorv_id_cargo_mec: TIntegerField;
    BUS_SQ_C_PAR_CTRorv_critica_ite_aber: TBooleanField;
    BUS_SQ_C_PAR_CTRorv_critica_ocv_aber: TBooleanField;
    BUS_SQ_C_PAR_CTReff_motivo_inv: TWideStringField;
    BUS_SQ_C_PAR_CTRfin_id_maquineta_pad: TIntegerField;
    BUS_SQ_C_PAR_CTRorv_id_forma_pag_rcr: TIntegerField;
    BUS_SQ_C_PAR_CTRfin_perm_n_maquinetas: TBooleanField;
    BUS_SQ_C_PAR_CTRped_envia_carga: TBooleanField;
    BUS_SQ_C_PAR_CTRnfe_per_partilha_dest: TFloatField;
    BUS_SQ_C_PAR_CTRnfe_per_partilha_orig: TFloatField;
    BUS_SQ_C_PAR_CTRnfe_per_icms_saida: TFloatField;
    BUS_SQ_C_PAR_CTRsgq_ped_gera_nfs: TBooleanField;
    CAD_SQ_C_PAR_CTRcbx_id_plano_desc_ope: TWideStringField;
    CAD_SQ_C_PAR_CTRcbx_id_plano_desc_antec: TWideStringField;
    CAD_SQ_C_PAR_CTRcbx_id_tipo_financeiro: TIntegerField;
    CAD_SQ_C_PAR_CTRcbx_id_tipo_financeiro_desc: TIntegerField;
    CAD_SQ_C_PAR_CTRrbx_ret_id_plano: TWideStringField;
    CAD_SQ_C_PAR_CTRrbx_ret_id_tipo_financeiro: TIntegerField;
    CAD_SQ_C_PAR_CTRrbx_ret_id_ccu: TIntegerField;
    CAD_SQ_C_PAR_CTRrbx_ret_id_forma_pag: TIntegerField;
    FIN_SQ_M_REC_PAGid_cbx: TIntegerField;
    FIN_DP_M_CBX: TDataSetProvider;
    FIN_SQ_M_CBX: TSQLDataSet;
    FIN_DS_M_CBX: TDataSource;
    FIN_SQ_M_CBX_TIT: TSQLDataSet;
    FIN_SQ_M_CBXid_cbx: TIntegerField;
    FIN_SQ_M_CBXdta_baixa: TDateField;
    FIN_SQ_M_CBXvlr_bruto: TFMTBCDField;
    FIN_SQ_M_CBXvlr_desconto_ope: TFMTBCDField;
    FIN_SQ_M_CBXvlr_desconto_antec: TFMTBCDField;
    FIN_SQ_M_CBXvlr_liquido: TFMTBCDField;
    FIN_SQ_M_CBXobservacao: TWideStringField;
    FIN_SQ_M_CBXid_responsavel: TIntegerField;
    FIN_SQ_M_CBXid_forma_pag: TIntegerField;
    FIN_SQ_M_CBXcom_bxa_antecipacao: TBooleanField;
    FIN_SQ_M_CBXid_conta: TIntegerField;
    FIN_SQ_M_CBXid_empresa: TIntegerField;
    FIN_SQ_M_CBX_TITid_cbx: TIntegerField;
    FIN_SQ_M_CBX_TITid_titulo: TIntegerField;
    FIN_SQ_M_CBX_TITvlr_desconto_ope: TFMTBCDField;
    FIN_SQ_M_CBX_TITvlr_desconto_antec: TFMTBCDField;
    FIN_SQ_M_CBX_TITvlr_bruto: TFMTBCDField;
    FIN_SQ_M_CBX_TITvlr_liquido: TFMTBCDField;
    FIN_SQ_M_CBX_TITint_selecao: TBooleanField;
    FIN_SQ_M_CBXint_nomefpg: TWideStringField;
    CAD_SQ_C_CTCcnpj_titular: TWideStringField;
    BUS_SQ_C_PAR_CTRcbx_id_plano: TWideStringField;
    BUS_SQ_C_PAR_CTRcbx_id_plano_desc_ope: TWideStringField;
    BUS_SQ_C_PAR_CTRcbx_id_plano_desc_antec: TWideStringField;
    BUS_SQ_C_PAR_CTRcbx_id_tipo_financeiro: TIntegerField;
    BUS_SQ_C_PAR_CTRcbx_id_tipo_financeiro_desc: TIntegerField;
    BUS_SQ_C_PAR_CTRrbx_ret_id_plano: TWideStringField;
    BUS_SQ_C_PAR_CTRrbx_ret_id_tipo_financeiro: TIntegerField;
    BUS_SQ_C_PAR_CTRrbx_ret_id_ccu: TIntegerField;
    BUS_SQ_C_PAR_CTRrbx_ret_id_forma_pag: TIntegerField;
    FIN_SQ_M_CTAid_cbx: TIntegerField;
    FIN_SQ_M_CBX_TITint_codfpg: TIntegerField;
    FIN_SQ_M_CBX_TITint_nomefpg: TWideStringField;
    BUS_DP_M_CBX_TIT: TDataSetProvider;
    BUS_SQ_M_CBX_TIT: TSQLDataSet;
    FIN_DP_R_BCO_EXB: TDataSetProvider;
    FIN_SQ_R_BCO_EXB: TSQLDataSet;
    FIN_DP_R_BCO_CCB: TDataSetProvider;
    FIN_SQ_R_BCO_CCB: TSQLDataSet;
    FIN_DP_R_BCO_SBC: TDataSetProvider;
    FIN_SQ_R_BCO_SBC: TSQLDataSet;
    CAD_SQ_C_PAR_CTRcbx_id_plano: TWideStringField;
    BUS_SQ_M_CTE_RES_ITE_INT: TSQLDataSet;
    BUS_DP_M_CTE_RES_ITE_INT: TDataSetProvider;
    FAT_DP_R_PIS_NFL: TDataSetProvider;
    FAT_SQ_R_PIS_NFL: TSQLDataSet;
    PCP_SQ_M_ACR_ITE_PRCevento_ocorrido_reg_acao: TWideStringField;
    FIN_SQ_M_COBnome_contato: TWideStringField;
    FAT_SQ_M_PEDid_pedido: TIntegerField;
    FAT_SQ_M_PEDid_empresa: TIntegerField;
    FAT_SQ_M_PEDdta_pedido: TDateField;
    FAT_SQ_M_PEDid_tipo_mov_estoque: TIntegerField;
    FAT_SQ_M_PEDid_vendedor: TIntegerField;
    FAT_SQ_M_PEDvlr_bruto: TFMTBCDField;
    FAT_SQ_M_PEDvlr_desconto: TFMTBCDField;
    FAT_SQ_M_PEDper_desconto: TFloatField;
    FAT_SQ_M_PEDvlr_liquido: TFMTBCDField;
    FAT_SQ_M_PEDhor_pedido: TSQLTimeStampField;
    FAT_SQ_M_PEDid_condicao_pag: TIntegerField;
    FAT_SQ_M_PEDpcp_id_opr: TIntegerField;
    FAT_SQ_M_PEDsituacao: TIntegerField;
    FAT_SQ_M_PEDsituacao_aprovacao: TIntegerField;
    FAT_SQ_M_PEDid_atendente: TIntegerField;
    FAT_SQ_M_PEDid_responsavel: TIntegerField;
    FAT_SQ_M_PEDid_cliente: TIntegerField;
    FAT_SQ_M_PEDtipo_restricao: TWideStringField;
    FAT_SQ_M_PEDid_almoxarifado: TIntegerField;
    FAT_SQ_M_PEDjustificativa: TWideStringField;
    FAT_SQ_M_PEDid_usuario_lib: TIntegerField;
    FAT_SQ_M_PEDcod_lme: TWideStringField;
    FAT_SQ_M_PEDrev_lme: TWideStringField;
    FAT_SQ_M_PEDorigem: TIntegerField;
    FAT_SQ_M_PEDdispositivo: TWideStringField;
    FAT_SQ_M_PEDgps_latitude: TFloatField;
    FAT_SQ_M_PEDgps_longitude: TFloatField;
    FAT_SQ_M_PEDcubagem: TFloatField;
    FAT_SQ_M_PEDid_orcamento: TIntegerField;
    FAT_SQ_M_PEDenvia_carga: TBooleanField;
    FAT_SQ_M_PEDdta_prev_entrega: TDateField;
    FAT_SQ_M_PEDint_nomecli: TWideStringField;
    FAT_SQ_M_PEDint_nometme: TWideStringField;
    FAT_SQ_M_PEDint_nomefun: TWideStringField;
    FAT_SQ_M_PEDint_nomecpg: TWideStringField;
    FAT_SQ_M_PEDint_nomeate: TWideStringField;
    FAT_SQ_M_PEDint_nomeres: TWideStringField;
    FAT_SQ_M_PEDint_nomecid: TWideStringField;
    FAT_SQ_M_PEDint_nomeest: TWideStringField;
    FAT_SQ_M_PEDint_cpfcnpj: TWideStringField;
    FAT_SQ_M_PEDint_pessoacli: TIntegerField;
    FAT_SQ_M_PEDint_id_perfil: TIntegerField;
    FAT_SQ_M_PEDid_ors: TIntegerField;
    FAT_SQ_M_PEDint_sitaprov: TWideStringField;
    FAT_SQ_M_PEDint_sitped: TWideStringField;
    CAD_SQ_C_FUNseg_hab_bot_alt_fun: TBooleanField;
    CAD_SQ_C_PAR_CTRsgq_dias_prev_cid_dentro: TIntegerField;
    CAD_SQ_C_PAR_CTRsgq_dias_prev_cid_fora: TIntegerField;
    PCP_SQ_M_ROMlot_qtde_total: TFloatField;
    PCP_SQ_M_ROMhor_emissao: TTimeField;
    PCP_SQ_M_ROMhor_alt: TTimeField;
    PCP_SQ_M_ROMid_resp_alt: TIntegerField;
    PCP_SQ_M_ROMdta_alt: TDateField;
    PCP_SQ_M_ROMhor_fin: TTimeField;
    PCP_SQ_M_ROMdta_fin: TDateField;
    PCP_SQ_M_ROMid_resp_fin: TIntegerField;
    PCP_SQ_M_ROMint_nomeres_alt: TWideStringField;
    PCP_SQ_M_ROMint_nomeres_fin: TWideStringField;
    FAT_DP_R_GAM_G_600: TDataSetProvider;
    FAT_SQ_R_GAM_G_600: TSQLDataSet;
    FAT_DP_R_GAM_G_605: TDataSetProvider;
    FAT_SQ_R_GAM_G_605: TSQLDataSet;
    FAT_DP_R_GAM_G_610: TDataSetProvider;
    FAT_SQ_R_GAM_G_610: TSQLDataSet;
    FAT_DP_R_GAM_G_615: TDataSetProvider;
    FAT_SQ_R_GAM_G_615: TSQLDataSet;
    FAT_DP_R_GAM_G_620: TDataSetProvider;
    FAT_SQ_R_GAM_G_620: TSQLDataSet;
    FAT_DP_R_GAM_G_625: TDataSetProvider;
    FAT_SQ_R_GAM_G_625: TSQLDataSet;
    CAD_SQ_C_PAR_CTRdes_ind_ed: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_cod_fin: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_arq: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_iss: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_ec: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_rt: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_icms: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_st: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_at: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_ipi: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_pi: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_ind_gef: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_icms: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_iss: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_ridf: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_rudf: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_lcm: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_rv: TIntegerField;
    CAD_SQ_C_PAR_CTRdes_prf_ri: TIntegerField;
    PCP_SQ_M_ROMped_ite_qtde_total: TIntegerField;
    FIN_SQ_M_PBX_GER: TSQLDataSet;
    FIN_SQ_M_PBX_GERid_baixa: TIntegerField;
    FIN_SQ_M_PBX_GERid_controle: TIntegerField;
    FIN_SQ_M_PBX_GERvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_PBX_GERdta_vencimento: TDateField;
    PCP_SQ_M_ORSid_rom: TIntegerField;
    PCP_SQ_M_ORSint_nomeresp_rom: TWideStringField;
    PCP_SQ_M_ORSint_dta_rom: TDateField;
    FIN_SQ_M_PAG_PAGcom_substituicao: TBooleanField;
    FIN_SQ_M_PAGid_baixa: TIntegerField;
    FIN_SQ_M_COB_TIT_FAT: TSQLDataSet;
    FIN_DS_M_COB_TIT: TDataSource;
    FIN_SQ_M_COB_TIT_FATid_fiscal: TIntegerField;
    FIN_SQ_M_COB_TIT_FATid_item: TIntegerField;
    FIN_SQ_M_COB_TIT_FATqtde: TFloatField;
    FIN_SQ_M_COB_TIT_FATvlr_unitario: TFMTBCDField;
    FIN_SQ_M_COB_TIT_FATvlr_desconto: TFMTBCDField;
    FIN_SQ_M_COB_TIT_FATvlr_liquido: TFMTBCDField;
    FIN_SQ_M_COB_TIT_FATint_desc_item: TWideStringField;
    FIN_SQ_M_COB_TIT_FATint_und_venda: TWideStringField;
    FIN_SQ_M_COB_TIT_FATint_tipo_item: TIntegerField;
    FIN_SQ_M_COB_TIT_FATint_nomecor: TWideStringField;
    FIN_SQ_M_COB_TIT_FATint_nometam: TWideStringField;
    FIN_SQ_M_COB_TIT_FATint_id_ncm: TWideStringField;
    FIN_SQ_M_COB_TIT_FATdta_emissao: TDateField;
    FIN_SQ_M_COB_TIT_FATnumero: TIntegerField;
    DP_BR_CUPOM_MESTRE: TDataSetProvider;
    SQ_BR_CUPOM_MESTRE: TSQLDataSet;
    SQ_BR_CUPOM_DETALHE: TSQLDataSet;
    SQ_BR_CUPOM_PAGAMENTO: TSQLDataSet;
    SQ_DS_CUPOM_MESTRE: TDataSource;
    SQ_BR_CUPOM_MESTREn_cupom: TIntegerField;
    SQ_BR_CUPOM_MESTREcpf_cnpj: TWideStringField;
    SQ_BR_CUPOM_MESTREdescontos: TFMTBCDField;
    SQ_BR_CUPOM_MESTREacrescimos: TFMTBCDField;
    SQ_BR_CUPOM_MESTREcancelado: TWideStringField;
    SQ_BR_CUPOM_MESTREtotal_bruto: TFMTBCDField;
    SQ_BR_CUPOM_MESTREtotal_liquido: TFMTBCDField;
    SQ_BR_CUPOM_MESTREserial_impressora: TWideStringField;
    SQ_BR_CUPOM_MESTREcnpj_empresa: TWideStringField;
    SQ_BR_CUPOM_MESTREie: TWideStringField;
    SQ_BR_CUPOM_MESTREim: TWideStringField;
    SQ_BR_CUPOM_MESTREtipo_ecf: TWideStringField;
    SQ_BR_CUPOM_MESTREmarca: TWideStringField;
    SQ_BR_CUPOM_MESTREmodelo: TWideStringField;
    SQ_BR_CUPOM_MESTREdata_movimento: TDateField;
    SQ_BR_CUPOM_MESTREversao_sb: TWideStringField;
    SQ_BR_CUPOM_MESTREdata_sb: TDateField;
    SQ_BR_CUPOM_MESTREhora_sb: TDateField;
    SQ_BR_CUPOM_MESTREdthora_inclusao: TDateField;
    SQ_BR_CUPOM_MESTREnaofiscal: TWideStringField;
    SQ_BR_CUPOM_MESTREccf: TIntegerField;
    SQ_BR_CUPOM_MESTREindicadordesconto: TWideStringField;
    SQ_BR_CUPOM_MESTREflag_descontoacrescimo: TWideStringField;
    SQ_BR_CUPOM_MESTREnome_cliente: TWideStringField;
    SQ_BR_CUPOM_MESTREn_caixa: TWideStringField;
    SQ_BR_CUPOM_MESTREnumloja: TWideStringField;
    SQ_BR_CUPOM_MESTREflag_aceito: TWideStringField;
    SQ_BR_CUPOM_MESTREflag_sis: TWideStringField;
    SQ_BR_CUPOM_MESTREplaca: TWideStringField;
    SQ_BR_CUPOM_MESTREhodometro: TIntegerField;
    SQ_BR_CUPOM_MESTREmotivo_afericao: TWideStringField;
    SQ_BR_CUPOM_MESTREmotorista: TWideStringField;
    SQ_BR_CUPOM_MESTREtransportadora: TWideStringField;
    SQ_BR_CUPOM_MESTREcpf_cnpj_transp: TWideStringField;
    SQ_BR_CUPOM_MESTREautorizacao: TWideStringField;
    SQ_BR_CUPOM_MESTREccusto: TWideStringField;
    SQ_BR_CUPOM_MESTREcliccodigo: TWideStringField;
    SQ_BR_CUPOM_MESTREdata_homologacao: TDateField;
    SQ_BR_CUPOM_MESTREdthora_fechamento: TDateField;
    SQ_BR_CUPOM_MESTREcod_pais: TIntegerField;
    SQ_BR_CUPOM_MESTREcod_municipio: TIntegerField;
    SQ_BR_CUPOM_MESTREsuframa: TWideStringField;
    SQ_BR_CUPOM_MESTREendereco: TWideStringField;
    SQ_BR_CUPOM_MESTREnumero: TWideStringField;
    SQ_BR_CUPOM_MESTREcomplemento: TWideStringField;
    SQ_BR_CUPOM_MESTREbairro: TWideStringField;
    SQ_BR_CUPOM_MESTREie_cliente: TWideStringField;
    SQ_BR_CUPOM_MESTREuf: TWideStringField;
    SQ_BR_CUPOM_MESTREcidade: TWideStringField;
    SQ_BR_CUPOM_MESTREnotafiscal: TWideStringField;
    SQ_BR_CUPOM_DETALHEn_cupom: TIntegerField;
    SQ_BR_CUPOM_DETALHEcod_produto: TWideStringField;
    SQ_BR_CUPOM_DETALHEn_item: TIntegerField;
    SQ_BR_CUPOM_DETALHEqtde: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEvalor_unitario: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEvalor_total: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEdesconto: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEacrecimo: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEcancelado: TWideStringField;
    SQ_BR_CUPOM_DETALHEserial_impressora: TWideStringField;
    SQ_BR_CUPOM_DETALHEn_caixa: TWideStringField;
    SQ_BR_CUPOM_DETALHEaliquota: TWideStringField;
    SQ_BR_CUPOM_DETALHEunidade: TWideStringField;
    SQ_BR_CUPOM_DETALHEnumloja: TWideStringField;
    SQ_BR_CUPOM_DETALHEflag_aceito: TWideStringField;
    SQ_BR_CUPOM_DETALHEflag_sis: TWideStringField;
    SQ_BR_CUPOM_DETALHEtanque: TWideStringField;
    SQ_BR_CUPOM_DETALHEbomba: TWideStringField;
    SQ_BR_CUPOM_DETALHEbico: TWideStringField;
    SQ_BR_CUPOM_DETALHEei: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEef: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEcod_grade: TWideStringField;
    SQ_BR_CUPOM_DETALHEcartao_cliente: TWideStringField;
    SQ_BR_CUPOM_DETALHEcartao_autorizador: TWideStringField;
    SQ_BR_CUPOM_DETALHEdesc_produto: TWideStringField;
    SQ_BR_CUPOM_DETALHEnumcaixa: TWideStringField;
    SQ_BR_CUPOM_DETALHEnumterminal: TWideStringField;
    SQ_BR_CUPOM_DETALHEbico_posto: TWideStringField;
    SQ_BR_CUPOM_DETALHEdata_ab: TDateField;
    SQ_BR_CUPOM_DETALHEhora_ab: TDateField;
    SQ_BR_CUPOM_DETALHEposicao_ab: TWideStringField;
    SQ_BR_CUPOM_DETALHEserial: TWideStringField;
    SQ_BR_CUPOM_DETALHEtabela: TWideStringField;
    SQ_BR_CUPOM_DETALHEcod_kit: TWideStringField;
    SQ_BR_CUPOM_DETALHEcod_vendedor: TWideStringField;
    SQ_BR_CUPOM_DETALHEcod_operador: TWideStringField;
    SQ_BR_CUPOM_DETALHEpdeccodigo: TWideStringField;
    SQ_BR_CUPOM_DETALHEprdcoutroscodigo: TWideStringField;
    SQ_BR_CUPOM_DETALHEprvndescontopenota: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEprvnacrescimopenota: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEflag_servico: TWideStringField;
    SQ_BR_CUPOM_DETALHEccusto: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEncm: TWideStringField;
    SQ_BR_CUPOM_DETALHEex_ipi: TWideStringField;
    SQ_BR_CUPOM_DETALHEgenero: TWideStringField;
    SQ_BR_CUPOM_DETALHEcst_icms: TWideStringField;
    SQ_BR_CUPOM_DETALHEorigem_icms: TWideStringField;
    SQ_BR_CUPOM_DETALHEaliquota_ipi: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEaliquota_pis: TFMTBCDField;
    SQ_BR_CUPOM_DETALHEtipo_item: TWideStringField;
    SQ_BR_CUPOM_DETALHEcfop: TIntegerField;
    SQ_BR_CUPOM_DETALHEdesc_unidade: TWideStringField;
    SQ_BR_CUPOM_DETALHEstb: TWideStringField;
    SQ_BR_CUPOM_DETALHEcomplemento_item: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOn_cupom: TIntegerField;
    SQ_BR_CUPOM_PAGAMENTOcod_forma_pag: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOvalor: TFMTBCDField;
    SQ_BR_CUPOM_PAGAMENTOserial_impressora: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOdescricao: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOvinculado: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcancelado: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOflag_aceito: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOflag_sis: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcod_forma_troco1: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOforma_troco1: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcod_forma_troco2: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOforma_troco2: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcod_forma_troco3: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOforma_troco3: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOn_doc: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTObanco: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOagencia: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOconta: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOvencimento: TDateField;
    SQ_BR_CUPOM_PAGAMENTOqtd_parcela: TIntegerField;
    SQ_BR_CUPOM_PAGAMENTOvalor_troco1: TFMTBCDField;
    SQ_BR_CUPOM_PAGAMENTOvalor_troco2: TFMTBCDField;
    SQ_BR_CUPOM_PAGAMENTOvalor_troco3: TFMTBCDField;
    SQ_BR_CUPOM_PAGAMENTOid_cliente: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOnome_cheque: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcpf_cheque: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOfone_cheque: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcod_retaguarda: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOitem: TIntegerField;
    SQ_BR_CUPOM_PAGAMENTOstrtipotransacaotef: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOcod_bandeira: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOparstrnomeredetef: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOparstrnumidtranstef: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOparstrnsutranstefhost: TWideStringField;
    SQ_BR_CUPOM_PAGAMENTOdthoratransacao: TDateField;
    SQ_BR_CUPOM_PAGAMENTOtroco: TWideStringField;
    FIN_SQ_M_CXAint_marcaecf: TWideStringField;
    FIN_SQ_M_CXAint_modeloecf: TWideStringField;
    FIN_SQ_M_CXAint_caixaecf: TWideStringField;
    FIN_SQ_M_PAG_PAGvlr_cred_utilizado: TFMTBCDField;
    CAD_SQ_C_TRI_REGnct_aliquota_ecf: TWideStringField;
    CAD_SQ_C_PAR_CTRecf_id_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_PAR_CTRecf_id_condicao_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRsgq_dias_prev_cid_dentro: TIntegerField;
    BUS_SQ_C_PAR_CTRsgq_dias_prev_cid_fora: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_ed: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_cod_fin: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_arq: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_iss: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_ec: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_rt: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_icms: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_st: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_at: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_ipi: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_pi: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_ind_gef: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_icms: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_iss: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_ridf: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_rudf: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_lcm: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_rv: TIntegerField;
    BUS_SQ_C_PAR_CTRdes_prf_ri: TIntegerField;
    BUS_SQ_C_PAR_CTRecf_id_tipo_mov_estoque: TIntegerField;
    BUS_SQ_C_PAR_CTRecf_id_condicao_pag: TIntegerField;
    BUS_SQ_M_PAG_PAGid_abertura: TIntegerField;
    BUS_SQ_M_PAG_PAGcom_substituicao: TBooleanField;
    BUS_SQ_M_PAG_PAGvlr_cred_utilizado: TFMTBCDField;
    BUS_DP_M_COB: TDataSetProvider;
    BUS_SQ_M_COB: TSQLDataSet;
    BUS_SQ_M_COB_TIT: TSQLDataSet;
    BUS_SQ_M_COB_TIT_FAT: TSQLDataSet;
    BUS_DS_M_COB: TDataSource;
    BUS_DS_M_COB_TIT: TDataSource;
    BUS_SQ_M_COBid_controle: TIntegerField;
    BUS_SQ_M_COBdta_cobranca: TDateField;
    BUS_SQ_M_COBtipo_contato: TIntegerField;
    BUS_SQ_M_COBobservacao: TWideStringField;
    BUS_SQ_M_COBhor_cobranca: TSQLTimeStampField;
    BUS_SQ_M_COBacordo: TBooleanField;
    BUS_SQ_M_COBid_funcionario: TIntegerField;
    BUS_SQ_M_COBper_juros_negociado: TFMTBCDField;
    BUS_SQ_M_COBid_cliente: TIntegerField;
    BUS_SQ_M_COBdta_acordo: TDateField;
    BUS_SQ_M_COBvlr_negociado: TFMTBCDField;
    BUS_SQ_M_COBstatus: TIntegerField;
    BUS_SQ_M_COBcod_lme: TWideStringField;
    BUS_SQ_M_COBrev_lme: TWideStringField;
    BUS_SQ_M_COBcontato: TBooleanField;
    BUS_SQ_M_COBid_empresa: TIntegerField;
    BUS_SQ_M_COBnome_contato: TWideStringField;
    BUS_SQ_M_COBint_nomefun: TWideStringField;
    BUS_SQ_M_COBint_nomecli: TWideStringField;
    BUS_SQ_M_COBint_telfix: TWideStringField;
    BUS_SQ_M_COBint_telmov: TWideStringField;
    BUS_SQ_M_COBint_email: TWideStringField;
    BUS_SQ_M_COB_TITid_controle: TIntegerField;
    BUS_SQ_M_COB_TITid_titulo: TIntegerField;
    BUS_SQ_M_COB_TITselecao: TBooleanField;
    BUS_SQ_M_COB_TITdias_atraso: TIntegerField;
    BUS_SQ_M_COB_TITint_num_parcela: TWideStringField;
    BUS_SQ_M_COB_TITint_dta_emissao: TDateField;
    BUS_SQ_M_COB_TITint_dta_vencimento: TDateField;
    BUS_SQ_M_COB_TITint_dta_original: TDateField;
    BUS_SQ_M_COB_TITint_id_forma_pag: TIntegerField;
    BUS_SQ_M_COB_TITint_vlr_parcela: TFMTBCDField;
    BUS_SQ_M_COB_TITint_vlr_saldo: TFMTBCDField;
    BUS_SQ_M_COB_TITint_id_fiscal: TIntegerField;
    BUS_SQ_M_COB_TITint_nomefpg: TWideStringField;
    BUS_SQ_M_COB_TIT_FATid_fiscal: TIntegerField;
    BUS_SQ_M_COB_TIT_FATid_item: TIntegerField;
    BUS_SQ_M_COB_TIT_FATqtde: TFloatField;
    BUS_SQ_M_COB_TIT_FATvlr_unitario: TFMTBCDField;
    BUS_SQ_M_COB_TIT_FATvlr_desconto: TFMTBCDField;
    BUS_SQ_M_COB_TIT_FATvlr_liquido: TFMTBCDField;
    BUS_SQ_M_COB_TIT_FATint_desc_item: TWideStringField;
    BUS_SQ_M_COB_TIT_FATint_und_venda: TWideStringField;
    BUS_SQ_M_COB_TIT_FATint_tipo_item: TIntegerField;
    BUS_SQ_M_COB_TIT_FATint_nomecor: TWideStringField;
    BUS_SQ_M_COB_TIT_FATint_nometam: TWideStringField;
    BUS_SQ_M_COB_TIT_FATint_id_ncm: TWideStringField;
    BUS_SQ_M_COB_TIT_FATdta_emissao: TDateField;
    BUS_SQ_M_COB_TIT_FATnumero: TIntegerField;
    CAD_SQ_C_ITEcubagem: TFMTBCDField;
    CAD_SQ_C_TIFint_natureza: TWideStringField;
    PCP_SQ_M_ACRatendimento_concluido: TIntegerField;
    BUS_DP_M_COB_TIT_TIT: TDataSetProvider;
    BUS_SQ_M_COB_TIT_TIT: TSQLDataSet;
    BUS_SQ_M_COB_TIT_TITid_controle: TIntegerField;
    BUS_SQ_M_COB_TIT_TITdta_cobranca: TDateField;
    BUS_SQ_M_COB_TIT_TITtipo_contato: TIntegerField;
    BUS_SQ_M_COB_TIT_TITobservacao: TWideStringField;
    BUS_SQ_M_COB_TIT_TIThor_cobranca: TSQLTimeStampField;
    BUS_SQ_M_COB_TIT_TITacordo: TBooleanField;
    BUS_SQ_M_COB_TIT_TITid_funcionario: TIntegerField;
    BUS_SQ_M_COB_TIT_TITper_juros_negociado: TFMTBCDField;
    BUS_SQ_M_COB_TIT_TITid_cliente: TIntegerField;
    BUS_SQ_M_COB_TIT_TITdta_acordo: TDateField;
    BUS_SQ_M_COB_TIT_TITvlr_negociado: TFMTBCDField;
    BUS_SQ_M_COB_TIT_TITstatus: TIntegerField;
    BUS_SQ_M_COB_TIT_TITcod_lme: TWideStringField;
    BUS_SQ_M_COB_TIT_TITrev_lme: TWideStringField;
    BUS_SQ_M_COB_TIT_TITcontato: TBooleanField;
    BUS_SQ_M_COB_TIT_TITid_empresa: TIntegerField;
    BUS_SQ_M_COB_TIT_TITnome_contato: TWideStringField;
    BUS_SQ_M_COB_TIT_TITid_titulo: TIntegerField;
    BUS_SQ_M_COB_TIT_TITdias_atraso: TIntegerField;
    BUS_SQ_M_COB_TIT_TITint_nomecli: TWideStringField;
    BUS_SQ_M_COB_TIT_TITint_telfixo: TWideStringField;
    BUS_SQ_M_COB_TIT_TITint_telmovel: TWideStringField;
    BUS_SQ_M_COB_TIT_TITint_nomefun: TWideStringField;
    BUS_SQ_M_COB_TIT_TITint_tipocontato: TWideStringField;
    FIN_DP_M_CTA_INT: TDataSetProvider;
    FIN_SQ_M_CTA_INT: TSQLDataSet;
    FIN_SQ_M_CTA_INTint_selecao: TBooleanField;
    FIN_SQ_M_CTA_INTid_controle: TIntegerField;
    FIN_SQ_M_CTA_INTid_empresa: TIntegerField;
    FIN_SQ_M_CTA_INTtipo_lancamento: TIntegerField;
    FIN_SQ_M_CTA_INTdta_lancamento: TDateField;
    FIN_SQ_M_CTA_INTnum_doc: TIntegerField;
    FIN_SQ_M_CTA_INTid_plano: TWideStringField;
    FIN_SQ_M_CTA_INTdeb_cre: TIntegerField;
    FIN_SQ_M_CTA_INThistorico: TWideStringField;
    FIN_SQ_M_CTA_INTvlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CTA_INTorigem: TIntegerField;
    FIN_SQ_M_CTA_INTid_conta: TIntegerField;
    FIN_SQ_M_CTA_INTid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTA_INTconc_numero: TIntegerField;
    FIN_SQ_M_CTA_INTconc_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTA_INTconc_id_plano: TWideStringField;
    FIN_SQ_M_CTA_INTconc_vlr_lancamento: TFMTBCDField;
    FIN_SQ_M_CTA_INTexp_id_controle: TIntegerField;
    FIN_SQ_M_CTA_INTexp_id_tipo_financeiro: TIntegerField;
    FIN_SQ_M_CTA_INTexp_id_plano: TWideStringField;
    FIN_SQ_M_CTA_INTexp_id_conta: TIntegerField;
    FIN_SQ_M_CTA_INTid_baixa_pbx: TIntegerField;
    FIN_SQ_M_CTA_INTid_baixa_rbx: TIntegerField;
    FIN_SQ_M_CTA_INTdta_movimento: TDateField;
    FIN_SQ_M_CTA_INTconciliado: TBooleanField;
    FIN_SQ_M_CTA_INTcod_lme: TWideStringField;
    FIN_SQ_M_CTA_INTrev_lme: TWideStringField;
    FIN_SQ_M_CTA_INTid_abertura: TIntegerField;
    FIN_SQ_M_CTA_INTid_fiscal: TIntegerField;
    FIN_SQ_M_CTA_INTid_titulo_rec: TIntegerField;
    FIN_SQ_M_CTA_INTid_credito: TIntegerField;
    FIN_SQ_M_CTA_INTid_mch: TIntegerField;
    FIN_SQ_M_CTA_INTid_conciliacao: TIntegerField;
    FIN_SQ_M_CTA_INTdta_conciliacao: TDateField;
    FIN_SQ_M_CTA_INTid_cbx: TIntegerField;
    FIN_SQ_M_CTA_INTint_origem: TWideMemoField;
    FIN_SQ_M_CTA_INTint_debcre: TWideMemoField;
    FIN_SQ_M_CTA_INTint_nomepct: TWideStringField;
    FIN_SQ_M_CTA_INTint_nometif: TWideStringField;
    FIN_SQ_M_CTA_INTint_nomectc: TWideStringField;
    FIN_SQ_M_PAGid_cta: TIntegerField;
    CAD_SQ_C_PAR_CTRmvb_id_fornecedor: TIntegerField;
    BUS_SQ_C_PAR_CTRmvb_id_fornecedor: TIntegerField;
    FAT_SQ_M_PED_ITEint_seqitem: TIntegerField;
    FAT_SQ_M_PEDid_abertura: TIntegerField;
    FAT_SQ_M_PED_TITid_maquineta: TIntegerField;
    CAD_SQ_C_PAR_CTRped_cupom_imp: TIntegerField;
    CAD_SQ_C_FPGrbx_id_tipo_financeiro: TIntegerField;
    CAD_SQ_C_FPGrbx_id_ccusto: TIntegerField;
    CAD_SQ_C_FPGrbx_id_plano: TWideStringField;
    FIN_SQ_M_CBX_TITint_dtavencto: TDateField;
    FIN_SQ_M_CBX_TITint_cartaxaope: TFloatField;
    FIN_SQ_M_CBX_TITint_nroparcela: TWideStringField;
    FIN_SQ_M_COB_TITint_codemp: TIntegerField;
    FAT_SQ_M_ROM_LACid_romaneio: TIntegerField;
    FAT_SQ_M_ROM_LAClacre: TWideStringField;
    CAD_SQ_C_PCTint_tipo: TWideStringField;
    CAD_SQ_C_PCTint_tipo_desp: TWideStringField;
    EST_DP_M_MET: TDataSetProvider;
    EST_SQ_M_MET: TSQLDataSet;
    EST_DS_M_MET: TDataSource;
    EST_SQ_M_MET_ITE: TSQLDataSet;
    EST_SQ_M_METid_met: TIntegerField;
    EST_SQ_M_METid_empresa: TIntegerField;
    EST_SQ_M_METdata: TDateField;
    EST_SQ_M_METid_tipo_mov_estoque: TIntegerField;
    EST_SQ_M_METid_responsavel: TIntegerField;
    EST_SQ_M_METobservacao: TWideStringField;
    EST_SQ_M_METcod_lme: TWideStringField;
    EST_SQ_M_METrev_lme: TWideStringField;
    EST_SQ_M_METint_nometme: TWideStringField;
    EST_SQ_M_METint_nomeres: TWideStringField;
    EST_SQ_M_MET_ITEid_met: TIntegerField;
    EST_SQ_M_MET_ITEid_sequencia: TIntegerField;
    EST_SQ_M_MET_ITEid_item: TIntegerField;
    EST_SQ_M_MET_ITEqtde: TFloatField;
    EST_SQ_M_MET_ITEobservacao: TWideStringField;
    EST_SQ_M_MET_ITEid_cor: TIntegerField;
    EST_SQ_M_MET_ITEid_tamanho: TIntegerField;
    EST_SQ_M_MET_ITEid_busca_item: TIntegerField;
    EST_SQ_M_MET_ITEint_nomeite: TWideStringField;
    EST_SQ_M_MET_ITEint_nomeund: TWideStringField;
    EST_SQ_M_MET_ITEint_nomecor: TWideStringField;
    EST_SQ_M_MET_ITEint_nometam: TWideStringField;
    EST_SQ_M_MET_ITEint_tipo_item: TIntegerField;
    PCP_SQ_M_ORSint_id_opr: TIntegerField;
    FAT_SQ_M_PEDint_ie_rg_cli: TWideStringField;
    BUS_DP_C_PCT: TDataSetProvider;
    BUS_SQ_C_PCT: TSQLDataSet;
    BUS_DP_M_MET_ITE_INT: TDataSetProvider;
    BUS_SQ_M_MET_ITE_INT: TSQLDataSet;
    FAT_SQ_M_NFEvlr_part_dest: TFMTBCDField;
    FAT_SQ_M_NFEvlr_part_orig: TFMTBCDField;
    FAT_SQ_M_NFEvlr_icm_desc: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_part_dest: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_part_orig: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_icm_desc: TFMTBCDField;
    EST_SQ_M_FEAid_met: TIntegerField;
    FAT_DP_R_PIS_RPC: TDataSetProvider;
    FAT_SQ_R_PIS_RPC: TSQLDataSet;
    CAD_SQ_C_NCMcest: TWideStringField;
    FIN_SQ_M_RCRid_abertura: TIntegerField;
    FIN_SQ_M_RCRdta_vencimento: TDateField;
    FIN_SQ_M_RCRint_docimpresso: TIntegerField;
    FAT_SQ_M_NFEid_ors: TIntegerField;
    PCP_SQ_M_ORSint_nomeven: TWideStringField;
    PCP_SQ_M_ORS_ITEint_tipo_item: TWideStringField;
    PCP_SQ_M_ORSid_tipo_mov_estoque: TIntegerField;
    PCP_SQ_M_ORSid_almoxarifado: TIntegerField;
    PCP_SQ_M_ORSvlr_bruto: TFMTBCDField;
    PCP_SQ_M_ORSvlr_desconto: TFMTBCDField;
    PCP_SQ_M_ORSper_desconto: TFloatField;
    PCP_SQ_M_ORSvlr_liquido: TFMTBCDField;
    PCP_SQ_M_ORShor_emissao: TTimeField;
    PCP_SQ_M_ORSid_abertura: TIntegerField;
    PCP_SQ_M_ORS_ITEvlr_liquido: TFMTBCDField;
    PCP_SQ_M_ORS_ITEvlr_desconto: TFMTBCDField;
    PCP_SQ_M_ORS_ITEper_desconto: TFloatField;
    PCP_SQ_M_ORS_ITEvlr_bruto: TFMTBCDField;
    BUS_SQ_M_ORS_ITE_INT: TSQLDataSet;
    BUS_DP_M_ORS_ITE_INT: TDataSetProvider;
    EST_SQ_M_FEAid_ors: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_tipo_financeiro: TIntegerField;
    CAD_SQ_C_PAR_CTRrcr_id_plano: TWideStringField;
    BUS_SQ_C_PAR_CTRped_cupom_imp: TIntegerField;
    BUS_SQ_C_PAR_CTRrcr_id_tipo_financeiro: TIntegerField;
    BUS_SQ_C_PAR_CTRrcr_id_plano: TWideStringField;
    BUS_SQ_M_ORS_TIT_INT: TSQLDataSet;
    BUS_DP_M_ORS_TIT_INT: TDataSetProvider;
    FAT_SQ_M_NFE_ITEint_cest_ncm: TWideStringField;
    FIN_SQ_M_MCH_CHEint_numeronf: TIntegerField;
    FIN_SQ_M_RBXid_recibo: TIntegerField;
    FIN_SQ_M_PBXid_recibo: TIntegerField;
    FIN_SQ_M_MCHid_recibo: TIntegerField;
    CAD_SQ_C_PCTestr_dre: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEint_undvenda: TWideStringField;
    PCP_DP_R_ORS: TDataSetProvider;
    PCP_SQ_R_ORS: TSQLDataSet;
    PCP_SQ_R_ORS_ITE: TSQLDataSet;
    PCP_SQ_R_ORS_TIT: TSQLDataSet;
    PCP_DS_R_ORS: TDataSource;
    CAD_SQ_C_GRUaliquota_ecf: TWideStringField;
    CAD_SQ_C_GRUpart_perc_fcp: TFloatField;
    CAD_SQ_C_TRI_REGpart_per_aliq_dest: TFloatField;
    FAT_SQ_M_NFE_ITEpart_per_aliq_dest: TFloatField;
    FAT_SQ_M_NFE_ITEpart_per_part_orig: TFloatField;
    FAT_SQ_M_NFE_ITEpart_per_part_dest: TFloatField;
    FAT_DP_M_PCA: TDataSetProvider;
    FAT_SQ_M_PCA: TSQLDataSet;
    FAT_SQ_M_PCA_PED: TSQLDataSet;
    FAT_DS_M_PCA: TDataSource;
    FAT_SQ_M_PCAid_carregamento: TIntegerField;
    FAT_SQ_M_PCAid_responsavel: TIntegerField;
    FAT_SQ_M_PCAdta_carregamento: TDateField;
    FAT_SQ_M_PCAint_nomeres: TWideStringField;
    FAT_SQ_M_PCA_PEDid_carregamento: TIntegerField;
    FAT_SQ_M_PCA_PEDid_pedido: TIntegerField;
    FAT_SQ_M_PCA_PEDint_sitaprov: TIntegerField;
    PCP_SQ_R_ORSid_ors: TIntegerField;
    PCP_SQ_R_ORSid_empresa: TIntegerField;
    PCP_SQ_R_ORSdta_emissao: TDateField;
    PCP_SQ_R_ORSid_responsavel: TIntegerField;
    PCP_SQ_R_ORSobservacao: TWideStringField;
    PCP_SQ_R_ORSid_pedido: TIntegerField;
    PCP_SQ_R_ORScod_lme: TWideStringField;
    PCP_SQ_R_ORSrev_lme: TWideStringField;
    PCP_SQ_R_ORSid_motorista: TIntegerField;
    PCP_SQ_R_ORSid_rom: TIntegerField;
    PCP_SQ_R_ORSid_tipo_mov_estoque: TIntegerField;
    PCP_SQ_R_ORSid_almoxarifado: TIntegerField;
    PCP_SQ_R_ORSvlr_bruto: TFMTBCDField;
    PCP_SQ_R_ORSvlr_desconto: TFMTBCDField;
    PCP_SQ_R_ORSper_desconto: TFloatField;
    PCP_SQ_R_ORSvlr_liquido: TFMTBCDField;
    PCP_SQ_R_ORShor_emissao: TTimeField;
    PCP_SQ_R_ORSid_abertura: TIntegerField;
    PCP_SQ_R_ORSint_nomeres: TWideStringField;
    PCP_SQ_R_ORSint_nomemta: TWideStringField;
    PCP_SQ_R_ORSint_nomecli: TWideStringField;
    PCP_SQ_R_ORSint_telfixo: TWideStringField;
    PCP_SQ_R_ORSint_dta_rom: TDateField;
    PCP_SQ_R_ORSint_nomeresp_rom: TWideStringField;
    PCP_SQ_R_ORSint_nomeven: TWideStringField;
    PCP_SQ_R_ORSint_id_opr: TIntegerField;
    PCP_SQ_R_ORS_ITEid_ors: TIntegerField;
    PCP_SQ_R_ORS_ITEid_sequencia: TIntegerField;
    PCP_SQ_R_ORS_ITEid_item: TIntegerField;
    PCP_SQ_R_ORS_ITEid_cor: TIntegerField;
    PCP_SQ_R_ORS_ITEid_tamanho: TIntegerField;
    PCP_SQ_R_ORS_ITEqtde: TFloatField;
    PCP_SQ_R_ORS_ITEvlr_unitario: TFMTBCDField;
    PCP_SQ_R_ORS_ITEvlr_bruto: TFMTBCDField;
    PCP_SQ_R_ORS_ITEid_sequencia_ped: TIntegerField;
    PCP_SQ_R_ORS_ITEvlr_liquido: TFMTBCDField;
    PCP_SQ_R_ORS_ITEvlr_desconto: TFMTBCDField;
    PCP_SQ_R_ORS_ITEper_desconto: TFloatField;
    PCP_SQ_R_ORS_ITEint_nomeite: TWideStringField;
    PCP_SQ_R_ORS_ITEint_undvenda: TWideStringField;
    PCP_SQ_R_ORS_ITEint_nomecor: TWideStringField;
    PCP_SQ_R_ORS_ITEint_nometam: TWideStringField;
    PCP_SQ_R_ORS_ITEint_tipo_item: TWideStringField;
    PCP_SQ_R_ORS_TITid_ors: TIntegerField;
    PCP_SQ_R_ORS_TITid_ors_tit: TIntegerField;
    PCP_SQ_R_ORS_TITid_forma_pag: TIntegerField;
    PCP_SQ_R_ORS_TITnum_parcela: TWideStringField;
    PCP_SQ_R_ORS_TITdias: TIntegerField;
    PCP_SQ_R_ORS_TITdta_vencimento: TDateField;
    PCP_SQ_R_ORS_TITche_banco: TWideStringField;
    PCP_SQ_R_ORS_TITche_agencia: TWideStringField;
    PCP_SQ_R_ORS_TITche_conta: TIntegerField;
    PCP_SQ_R_ORS_TITche_numero: TIntegerField;
    PCP_SQ_R_ORS_TITche_emitente: TWideStringField;
    PCP_SQ_R_ORS_TITvlr_titulo: TFMTBCDField;
    PCP_SQ_R_ORS_TITint_nomefpg: TWideStringField;
    FAT_SQ_M_PCA_PEDint_nomecli: TWideStringField;
    FAT_SQ_M_PCA_PEDint_telfixo: TWideStringField;
    FAT_SQ_M_PCA_PEDint_nomecid: TWideStringField;
    FAT_SQ_M_NFE_ITEvlr_fcp: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_fcp: TFloatField;
    FAT_SQ_M_NFEvlr_fcp: TFMTBCDField;
    FAT_SQ_M_NFE_ITEint_id_grupo: TWideStringField;
    FAT_SQ_M_NFE_ITEint_part_perc_fcp: TFloatField;
    CAD_SQ_C_PAR_BXP: TSQLDataSet;
    CAD_SQ_C_PAR_BXPid_empresa: TIntegerField;
    CAD_SQ_C_PAR_BXPid_empresa_bxp: TIntegerField;
    CAD_SQ_C_PAR_BXPpermite_baixar: TBooleanField;
    CAD_SQ_C_PAR_BXPint_fantasia: TWideStringField;
    CAD_SQ_C_PAR_CTRperm_bxa_pag_n_emp: TBooleanField;
    CAD_SQ_C_TRI_REGpart_per_ope_int_isen: TBooleanField;
    CAD_SQ_C_TRI_REGpart_per_ope_ext_isen: TBooleanField;
    BUS_SQ_M_PAGid_baixa: TIntegerField;
    BUS_SQ_M_PAGid_cta: TIntegerField;
    BUS_SQ_M_PAGint_fantasia: TWideStringField;
    FAT_SQ_M_ROMid_pca: TIntegerField;
    BUS_DP_M_PCA: TDataSetProvider;
    BUS_SQ_M_PCA: TSQLDataSet;
    BUS_DS_M_PCA: TDataSource;
    BUS_SQ_M_PCA_PED: TSQLDataSet;
    BUS_SQ_M_PCAid_carregamento: TIntegerField;
    BUS_SQ_M_PCAid_responsavel: TIntegerField;
    BUS_SQ_M_PCAdta_carregamento: TDateField;
    BUS_SQ_M_PCAint_nomeres: TWideStringField;
    BUS_SQ_M_PCA_PEDid_carregamento: TIntegerField;
    BUS_SQ_M_PCA_PEDid_pedido: TIntegerField;
    BUS_SQ_M_PCA_PEDint_sitaprov: TIntegerField;
    BUS_SQ_M_PCA_PEDint_nomecli: TWideStringField;
    BUS_SQ_M_PCA_PEDint_telfixo: TWideStringField;
    BUS_SQ_M_PCA_PEDint_nomecid: TWideStringField;
    FIN_SQ_M_PAG_PAGid_empresa_bxa: TIntegerField;
    PCP_SQ_M_ORS_ITEint_und_venda: TWideStringField;
    BUS_SQ_M_PAG_PAGid_empresa_bxa: TIntegerField;
    BUS_SQ_M_PAG_PAGint_emp_fantasia: TWideStringField;
    FAT_DP_R_GAM_E60: TDataSetProvider;
    FAT_SQ_R_GAM_E60: TSQLDataSet;
    FAT_DP_R_GAM_E65: TDataSetProvider;
    FAT_SQ_R_GAM_E65: TSQLDataSet;
    FAT_DP_R_GAM_E80: TDataSetProvider;
    FAT_SQ_R_GAM_E80: TSQLDataSet;
    FAT_DP_R_GAM_E85: TDataSetProvider;
    FAT_SQ_R_GAM_E85: TSQLDataSet;
    FAT_DP_M_XML: TDataSetProvider;
    FAT_SQ_M_XML: TSQLDataSet;
    FAT_DS_M_XML: TDataSource;
    FAT_SQ_M_XML_ITE: TSQLDataSet;
    FAT_SQ_M_XML_TIT: TSQLDataSet;
    FAT_SQ_M_XMLnota_fiscal: TIntegerField;
    FAT_SQ_M_XMLdta_emissao: TDateField;
    FAT_SQ_M_XMLserie: TWideStringField;
    FAT_SQ_M_XMLcfop: TWideStringField;
    FAT_SQ_M_XMLid_condicao_pag: TIntegerField;
    FAT_SQ_M_XMLchave: TWideStringField;
    FAT_SQ_M_XMLvlr_bruto: TFMTBCDField;
    FAT_SQ_M_XMLvlr_liquido: TFMTBCDField;
    FAT_SQ_M_XMLcnpj_emitente: TWideStringField;
    FAT_SQ_M_XMLnome_emitente: TWideStringField;
    FAT_SQ_M_XMLid_almoxarifado: TIntegerField;
    FAT_SQ_M_XMLvlr_icm_desc: TFMTBCDField;
    FAT_SQ_M_XMLid_controle: TIntegerField;
    FAT_SQ_M_XML_ITEseq: TIntegerField;
    FAT_SQ_M_XML_ITEcod_fabrica: TWideStringField;
    FAT_SQ_M_XML_ITEid_item: TIntegerField;
    FAT_SQ_M_XML_ITEid_cst_icms: TWideStringField;
    FAT_SQ_M_XML_ITEid_cfop: TWideStringField;
    FAT_SQ_M_XML_ITEvlr_bruto: TFMTBCDField;
    FAT_SQ_M_XML_ITEvlr_liquido: TFMTBCDField;
    FAT_SQ_M_XML_ITEdesc_item: TWideStringField;
    FAT_SQ_M_XML_ITEund: TWideStringField;
    FAT_SQ_M_XML_ITEqtde: TFloatField;
    FAT_SQ_M_XML_ITEvlr_unitario: TFMTBCDField;
    FAT_SQ_M_XML_ITEvlr_desconto: TFMTBCDField;
    FAT_SQ_M_XML_ITEid_cor: TIntegerField;
    FAT_SQ_M_XML_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_XML_ITEnum_lote: TWideStringField;
    FAT_SQ_M_XML_ITEid_controle: TIntegerField;
    FAT_SQ_M_XML_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_XML_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_XML_ITEint_nometam: TWideStringField;
    FAT_SQ_M_XML_TITid_controle: TIntegerField;
    FAT_SQ_M_XML_TITid_forma_pag: TIntegerField;
    FAT_SQ_M_XML_TITid_titulo: TIntegerField;
    FAT_SQ_M_XML_TITnum_titulo: TWideStringField;
    FAT_SQ_M_XML_TITvlr_titulo: TFMTBCDField;
    FAT_SQ_M_XML_TITdta_vencimento: TDateField;
    FAT_SQ_M_XML_TITid_plano: TWideStringField;
    FAT_SQ_M_XML_TITint_nomefpg: TWideStringField;
    FAT_SQ_M_XMLid_empresa: TIntegerField;
    FAT_SQ_M_XMLid_iqm: TIntegerField;
    FAT_SQ_M_XMLid_fiscal: TIntegerField;
    FAT_SQ_M_XML_ITEid_sequencia_ite_iqm: TIntegerField;
    FAT_SQ_M_XML_ITEid_busca_item: TWideStringField;
    FAT_SQ_M_XMLid_tipo_estoque: TIntegerField;
    FAT_SQ_M_XML_ITEicm_n_aliquota: TFMTBCDField;
    FAT_SQ_M_XML_ITEicm_per_reducao: TFMTBCDField;
    FAT_SQ_M_XML_ITEicm_n_base: TFMTBCDField;
    FAT_SQ_M_XML_ITEicm_n_valor: TFMTBCDField;
    FAT_SQ_M_XML_ITEicm_s_base: TFMTBCDField;
    FAT_SQ_M_XML_ITEicm_s_valor: TFMTBCDField;
    FAT_SQ_M_XML_ITEvlr_outras_desp: TFMTBCDField;
    FAT_SQ_M_XML_ITEipi_base: TFMTBCDField;
    FAT_SQ_M_XML_ITEipi_aliquota: TFMTBCDField;
    FAT_SQ_M_XML_ITEipi_valor: TFMTBCDField;
    FAT_SQ_M_XML_ITEpis_base: TFMTBCDField;
    FAT_SQ_M_XML_ITEpis_aliquota: TFMTBCDField;
    FAT_SQ_M_XML_ITEpis_valor: TFMTBCDField;
    FAT_SQ_M_XML_ITEfre_valor: TFMTBCDField;
    FAT_SQ_M_XML_ITEcof_base: TFMTBCDField;
    FAT_SQ_M_XML_ITEcof_aliquota: TFMTBCDField;
    FAT_SQ_M_XML_ITEcof_valor: TFMTBCDField;
    CAD_SQ_C_FUNseq_vis_msg_ped_exp_fat: TBooleanField;
    CAD_SQ_C_PAR_CTRrcr_cri_forma_pag: TBooleanField;
    FIN_SQ_M_RCRint_doccnpjcpf: TWideStringField;
    BUS_SQ_C_PAR_CTRperm_bxa_pag_n_emp: TBooleanField;
    BUS_SQ_C_PAR_CTRrcr_cri_forma_pag: TBooleanField;
    PCP_SQ_M_ORSfin_gerado: TBooleanField;
    FAT_SQ_M_ROMmdf_numero: TIntegerField;
    FAT_SQ_M_ROMciot: TFMTBCDField;
    FAT_SQ_M_ROMint_doc_cpf: TWideStringField;
    FAT_SQ_M_ROMint_id_veiculo: TIntegerField;
    FAT_SQ_M_ROMint_tara: TFloatField;
    FAT_SQ_M_ROMint_cap_veiculo: TFloatField;
    FAT_SQ_M_ROMint_tipo_rodado: TSmallintField;
    FAT_SQ_M_ROMint_tipo_carroceria: TSmallintField;
    FAT_SQ_M_ROMint_uf_licenciado: TWideStringField;
    FAT_SQ_M_ROMint_renavam: TWideStringField;
    CAD_SQ_C_ITEpreco_avista_ant_reajuste: TFMTBCDField;
    CAD_SQ_C_ITEpreco_aprazo_ant_reajuste: TFMTBCDField;
    CAD_SQ_C_ITEdta_ult_reajuste: TDateField;
    FAT_DP_R_PED: TDataSetProvider;
    FAT_SQ_R_PED: TSQLDataSet;
    FAT_DS_R_PED: TDataSource;
    FAT_SQ_R_PED_ITE: TSQLDataSet;
    FAT_SQ_R_PED_TIT: TSQLDataSet;
    CMP_SQ_M_PEDind_frete: TIntegerField;
    FAT_SQ_M_PCAstatus: TIntegerField;
    BUS_DP_M_FAT_PCA_PED: TDataSetProvider;
    BUS_SQ_M_FAT_PCA_PED: TSQLDataSet;
    BUS_SQ_M_PCAstatus: TIntegerField;
    FAT_SQ_M_NFE_ITEpart_per_red_int_dest: TFloatField;
    FAT_SQ_M_PCA_PEDint_desc_sitaprov: TWideStringField;
    FAT_SQ_M_PCA_PEDint_codcliente: TIntegerField;
    FAT_SQ_M_XMLint_desctme: TWideStringField;
    FAT_SQ_M_XMLint_desccpg: TWideStringField;
    CAD_SQ_C_PAR_CTRfp_per_cust_ven_mens: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_icms_ven: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_simples: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_comissao: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_frete_ven: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_cust_fin_ven: TFloatField;
    FAT_SQ_M_NFE_ITEfp_vlr_tot_custo_fix_mens: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfp_vlr_ven_med_mens: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfp_per_cust_ven_mens: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_icms_ven: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_simples: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_comissao: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_frete_ven: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_cust_fin_ven: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_lucro_ven: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_total_incid: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_markup_div: TFloatField;
    FAT_SQ_M_NFE_ITEfp_per_markup_mult: TFloatField;
    FAT_SQ_M_NFE_ITEfp_vlr_prc_ven_calc: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfp_vlr_prc_ven_prat: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfp_calculado: TBooleanField;
    CAD_SQ_C_PAR_MODsnf: TBooleanField;
    FIN_SQ_M_RECbol_banco: TIntegerField;
    CAD_SQ_C_GRUfp_per_lucro_ven: TFloatField;
    FIN_SQ_M_PCRid_credito: TIntegerField;
    FIN_SQ_M_PCRid_empresa: TIntegerField;
    FIN_SQ_M_PCRorigem: TIntegerField;
    FIN_SQ_M_PCRnum_documento: TWideStringField;
    FIN_SQ_M_PCRvlr_credito: TFMTBCDField;
    FIN_SQ_M_PCRvlr_saldo: TFMTBCDField;
    FIN_SQ_M_PCRdta_credito: TDateField;
    FIN_SQ_M_PCRdeb_cre: TIntegerField;
    FIN_SQ_M_PCRid_fornecedor: TIntegerField;
    FIN_SQ_M_PCRhistorico: TWideStringField;
    FIN_SQ_M_PCRcod_lme: TWideStringField;
    FIN_SQ_M_PCRrev_lme: TWideStringField;
    FIN_SQ_M_PCRid_baixa: TIntegerField;
    FIN_SQ_M_PCRint_nomefor: TWideStringField;
    FIN_SQ_M_PCRid_titulo: TIntegerField;
    CAD_SQ_C_TRI_REGpart_per_red_dest: TFloatField;
    FAT_SQ_M_NFE_ITEfp_vlr_prc_prz_ven_prat: TFMTBCDField;
    FAT_SQ_M_NFE_ITEfp_per_prc_prz_ven_prat: TFloatField;
    CAD_SQ_C_PAR_CTRfp_per_prc_prz_ven_prat: TFloatField;
    BUS_SQ_M_NFE_ITE_INTvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_part_dest: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_part_orig: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_icm_desc: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTpart_per_aliq_dest: TFloatField;
    BUS_SQ_M_NFE_ITE_INTpart_per_part_orig: TFloatField;
    BUS_SQ_M_NFE_ITE_INTpart_per_part_dest: TFloatField;
    BUS_SQ_M_NFE_ITE_INTvlr_fcp: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTper_fcp: TFloatField;
    BUS_SQ_M_NFE_ITE_INTpart_per_red_int_dest: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_vlr_tot_custo_fix_mens: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfp_vlr_ven_med_mens: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfp_per_cust_ven_mens: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_icms_ven: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_simples: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_comissao: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_frete_ven: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_cust_fin_ven: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_lucro_ven: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_total_incid: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_markup_div: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_per_markup_mult: TFloatField;
    BUS_SQ_M_NFE_ITE_INTfp_vlr_prc_ven_calc: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfp_vlr_prc_ven_prat: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfp_calculado: TBooleanField;
    BUS_SQ_M_NFE_ITE_INTfp_vlr_prc_prz_ven_prat: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTfp_per_prc_prz_ven_prat: TFloatField;
    PCP_SQ_M_ORSint_id_condicao_pag: TIntegerField;
    PCP_SQ_M_ORSint_desc_cpg: TWideStringField;
    FAT_SQ_M_NFEint_selecao: TBooleanField;
    FAT_SQ_M_PEDint_selecao: TBooleanField;
    CAD_SQ_C_PAR_NFEemail_smtp_ssl: TBooleanField;
    CAD_SQ_C_PAR_NFEemail_smtp_tls: TBooleanField;
    FAT_SQ_M_NFE_DEV_ITEid_st_icm: TWideStringField;
    FAT_SQ_M_NFE_DEV_ITEorigem_mercadoria: TWideStringField;
    FAT_SQ_M_XML_ITEorigem_mercadoria: TWideStringField;
    BUS_DP_M_FES_INT: TDataSetProvider;
    BUS_SQ_M_FES_INT: TSQLDataSet;
    BUS_SQ_M_FES_INTid_item: TIntegerField;
    BUS_SQ_M_FES_INTid_empresa: TIntegerField;
    BUS_SQ_M_FES_INTid_cor: TIntegerField;
    BUS_SQ_M_FES_INTid_tamanho: TIntegerField;
    BUS_SQ_M_FES_INTdata_ult_movimento: TDateField;
    BUS_SQ_M_FES_INTdata_ult_inventario: TDateField;
    BUS_SQ_M_FES_INTqtde_entrada: TFloatField;
    BUS_SQ_M_FES_INTqtde_saida: TFloatField;
    BUS_SQ_M_FES_INTsaldo_fisico: TFloatField;
    BUS_SQ_M_FES_INTqtde_ped_compra: TFloatField;
    BUS_SQ_M_FES_INTqtde_ped_venda: TFloatField;
    BUS_SQ_M_FES_INTvlr_custo_medio: TFMTBCDField;
    BUS_SQ_M_FES_INTvlr_custo_ult_compra: TFMTBCDField;
    BUS_SQ_M_FES_INTcod_lme: TWideStringField;
    BUS_SQ_M_FES_INTrev_lme: TWideStringField;
    BUS_SQ_M_FES_INTint_nomeemp: TWideStringField;
    BUS_SQ_M_FES_INTint_nomefan: TWideStringField;
    BUS_SQ_M_FES_INTint_nomecor: TWideStringField;
    BUS_SQ_M_FES_INTint_nometam: TWideStringField;
    BUS_DP_M_ORC_PLC: TDataSetProvider;
    BUS_SQ_M_ORC_PLC: TSQLDataSet;
    BUS_SQ_M_ORC_PLCid_empresa: TIntegerField;
    BUS_SQ_M_ORC_PLCano: TIntegerField;
    BUS_SQ_M_ORC_PLCid_orc: TIntegerField;
    BUS_SQ_M_ORC_PLCid_plc: TWideStringField;
    BUS_SQ_M_ORC_PLCprev_jan: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_fev: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_mar: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_abr: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_mai: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_jun: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_jul: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_ago: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_set: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_out: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_nov: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_dez: TFMTBCDField;
    BUS_SQ_M_ORC_PLCprev_total: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_jan: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_jan: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_fev: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_fev: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_mar: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_mar: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_abr: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_abr: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_mai: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_mai: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_jun: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_jun: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_jul: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_jul: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_ago: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_ago: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_set: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_set: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_out: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_out: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_nov: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_nov: TFMTBCDField;
    BUS_SQ_M_ORC_PLCreal_dez: TFMTBCDField;
    BUS_SQ_M_ORC_PLCper_dez: TFMTBCDField;
    BUS_SQ_M_ORC_PLCint_empfantasia: TWideStringField;
    BUS_SQ_M_ORC_PLCint_descpct: TWideStringField;
    CAD_SQ_C_VEIuf_licenciado: TWideStringField;
    FAT_SQ_M_ROMstatus: TIntegerField;
    FAT_SQ_M_ROMcanc_motivo: TWideStringField;
    FAT_SQ_M_ROMcanc_data: TDateField;
    FAT_SQ_M_ROMcanc_usuario: TIntegerField;
    FAT_SQ_M_ROMcancelado: TBooleanField;
    FAT_SQ_R_NFEind_nf: TIntegerField;
    FAT_SQ_R_NFEvlr_part_dest: TFMTBCDField;
    FAT_SQ_R_NFEvlr_part_orig: TFMTBCDField;
    FAT_SQ_R_NFEvlr_icm_desc: TFMTBCDField;
    FAT_SQ_R_NFEid_ors: TIntegerField;
    FAT_SQ_R_NFEvlr_fcp: TFMTBCDField;
    FAT_SQ_R_NFEint_notacancelada: TWideStringField;
    FIN_DP_R_CSC: TDataSetProvider;
    FIN_SQ_R_CSC: TSQLDataSet;
    CAD_SQ_C_PAR_CTRassociado_acavasf: TBooleanField;
    FIN_DP_R_EXT_CLI_NCR: TDataSetProvider;
    FIN_SQ_R_EXT_CLI_NCR: TSQLDataSet;
    ACE_DP_M_IDN: TDataSetProvider;
    ACE_SQ_M_IDN: TSQLDataSet;
    ACE_DP_M_PRO: TDataSetProvider;
    ACE_SQ_M_IDNtipo: TWideMemoField;
    ACE_SQ_M_IDNcliente: TWideStringField;
    ACE_SQ_M_IDNdta_arquivo: TWideMemoField;
    ACE_SQ_M_PRO: TSQLDataSet;
    ACE_DP_M_FIL: TDataSetProvider;
    ACE_SQ_M_FIL: TSQLDataSet;
    ACE_DP_M_EST_DEP: TDataSetProvider;
    ACE_SQ_M_EST_DEP: TSQLDataSet;
    ACE_SQ_M_EST_DEPdoc_cnpj: TWideStringField;
    ACE_SQ_M_EST_DEPemp_cnpj: TWideStringField;
    ACE_SQ_M_EST_DEPnome_for: TWideStringField;
    ACE_SQ_M_EST_DEPqtde: TFloatField;
    ACE_DP_M_EST_FOP: TDataSetProvider;
    ACE_SQ_M_EST_FOP: TSQLDataSet;
    ACE_SQ_M_EST_FOPdoc_cnpj: TWideStringField;
    ACE_SQ_M_EST_FOPemp_cnpj: TWideStringField;
    ACE_SQ_M_EST_FOPnome_for: TWideStringField;
    ACE_SQ_M_EST_FOPid_empresa: TIntegerField;
    ACE_SQ_M_EST_FOPqtde: TFloatField;
    ACE_DP_M_VND: TDataSetProvider;
    ACE_SQ_M_VND: TSQLDataSet;
    ACE_SQ_M_CLI: TSQLDataSet;
    ACE_DP_M_CLI: TDataSetProvider;
    ACE_DP_M_NFE: TDataSetProvider;
    ACE_SQ_M_NFE: TSQLDataSet;
    FAT_SQ_M_PED_ITEint_rua: TWideStringField;
    FAT_SQ_M_PED_ITEint_prateleira: TWideStringField;
    FAT_SQ_M_PED_ITEint_escaninho: TWideStringField;
    CAD_SQ_C_PAR_CTRtipo_impressao: TIntegerField;
    CAD_SQ_C_CLIid_vendedor: TIntegerField;
    BUS_DP_C_FUN_CRG_GER: TDataSetProvider;
    BUS_SQ_C_FUN_CRG_GER: TSQLDataSet;
    ACE_SQ_M_PROtipo: TWideStringField;
    ACE_SQ_M_PROcod_fabricante: TWideStringField;
    ACE_SQ_M_PROdes_fabricante: TWideStringField;
    ACE_SQ_M_PROcod_produto: TIntegerField;
    ACE_SQ_M_PROid_empresa: TIntegerField;
    ACE_SQ_M_PROdes_produto: TWideStringField;
    ACE_SQ_M_PROcod_grupo: TWideStringField;
    ACE_SQ_M_PROdes_grupo: TWideStringField;
    ACE_SQ_M_PROcod_familia: TWideStringField;
    ACE_SQ_M_PROdes_familia: TWideStringField;
    ACE_SQ_M_PROcod_sub_familia: TWideStringField;
    ACE_SQ_M_PROdes_sub_familia: TWideStringField;
    ACE_SQ_M_PROtipo_cod_barra: TWideStringField;
    ACE_SQ_M_PROembalagem: TWideStringField;
    ACE_SQ_M_PROvolume: TFloatField;
    ACE_SQ_M_PROund: TWideStringField;
    ACE_SQ_M_PROdta_cadastro: TWideStringField;
    ACE_SQ_M_PROativo: TWideStringField;
    ACE_SQ_M_FILtipo: TWideStringField;
    ACE_SQ_M_FILcliente: TWideStringField;
    ACE_SQ_M_FILemp_razao: TWideStringField;
    ACE_SQ_M_FILuf: TWideStringField;
    ACE_SQ_M_FILcidade: TWideStringField;
    ACE_SQ_M_FILemp_bairro: TWideStringField;
    ACE_SQ_M_FILemp_cep: TWideStringField;
    ACE_SQ_M_FILstatus: TWideStringField;
    ACE_SQ_M_VNDtipo: TWideStringField;
    ACE_SQ_M_VNDemp_cnpj: TWideStringField;
    ACE_SQ_M_VNDcod_fab: TWideStringField;
    ACE_SQ_M_VNDdescricao: TWideStringField;
    ACE_SQ_M_VNDnum_lote: TWideStringField;
    ACE_SQ_M_VNDval_lote: TWideStringField;
    ACE_SQ_M_VNDlivre1: TWideStringField;
    ACE_SQ_M_VNDlivre2: TWideStringField;
    ACE_SQ_M_VNDqtde: TFloatField;
    ACE_SQ_M_VNDvlr_liq_total: TFMTBCDField;
    ACE_SQ_M_VNDmoeda: TWideStringField;
    ACE_SQ_M_VNDid_transacao: TIntegerField;
    ACE_SQ_M_VNDid_empresa: TIntegerField;
    ACE_SQ_M_VNDdta_estoque: TWideStringField;
    ACE_SQ_M_VNDtipo_transacao: TWideStringField;
    ACE_SQ_M_VNDid_cfo: TWideStringField;
    ACE_SQ_M_VNDtipo_pdv: TWideStringField;
    ACE_SQ_M_VNDid_pdv: TWideStringField;
    ACE_SQ_M_VNDdes_pdv: TWideStringField;
    ACE_SQ_M_VNDcep_pdv: TWideStringField;
    ACE_SQ_M_VNDcla_pdv: TWideStringField;
    ACE_SQ_M_VNDnome_vnd: TWideStringField;
    ACE_SQ_M_NFEtipo: TWideStringField;
    ACE_SQ_M_NFEcd_loja: TWideStringField;
    ACE_SQ_M_NFEnota_fiscal: TIntegerField;
    ACE_SQ_M_NFEacao: TWideStringField;
    ACE_SQ_M_NFEvalor: TFMTBCDField;
    ACE_SQ_M_NFEqtde: TFloatField;
    ACE_SQ_M_NFEid_empresa: TIntegerField;
    ACE_SQ_M_NFEdta_acao: TWideStringField;
    ACE_SQ_M_NFEdta_entrada: TWideStringField;
    PCP_SQ_C_REGdesc_perc: TFloatField;
    CAD_SQ_C_CLIint_reg_desc_perc: TFloatField;
    ACE_SQ_M_CLItipo: TWideStringField;
    ACE_SQ_M_CLIrazao_social: TWideStringField;
    ACE_SQ_M_CLIfantasia: TWideStringField;
    ACE_SQ_M_CLIpais: TWideStringField;
    ACE_SQ_M_CLIregiao: TWideStringField;
    ACE_SQ_M_CLIestado: TWideStringField;
    ACE_SQ_M_CLIcidade: TWideStringField;
    ACE_SQ_M_CLIbairro: TWideStringField;
    ACE_SQ_M_CLIendereco: TWideStringField;
    ACE_SQ_M_CLIgruporede: TWideStringField;
    ACE_SQ_M_CLIcontato: TWideStringField;
    ACE_SQ_M_CLIclassificacao: TWideStringField;
    ACE_SQ_M_CLIvendedor: TWideStringField;
    ACE_SQ_M_CLIdta_cadastro: TWideStringField;
    ACE_SQ_M_CLIstatus: TWideStringField;
    FAT_SQ_M_PED_ITEper_desc_max: TFloatField;
    FIN_SQ_M_RBXvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_PAGid_obra: TIntegerField;
    FIN_SQ_M_RECid_obra: TIntegerField;
    FIN_SQ_M_CTAid_obra: TIntegerField;
    CTC_DP_M_PRO: TDataSetProvider;
    CTC_SQ_M_PRO: TSQLDataSet;
    CTC_SQ_M_PROid_item: TIntegerField;
    CTC_SQ_M_PROdata: TDateField;
    CTC_SQ_M_PROdescricao: TWideStringField;
    CTC_SQ_M_PROarquivo: TWideStringField;
    FIN_SQ_M_PBXvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_RBXvlr_pago_ger: TFMTBCDField;
    CAD_SQ_C_FAMid_familia: TIntegerField;
    CAD_SQ_C_FAMdescricao: TWideStringField;
    CAD_SQ_C_FAMfaz_corr_preco_perfil: TBooleanField;
    CAD_SQ_C_ITEint_ctcepi: TBooleanField;
    CTC_DP_M_APG: TDataSetProvider;
    CTC_SQ_M_APG: TSQLDataSet;
    CTC_SQ_M_APGid_apg: TIntegerField;
    CTC_SQ_M_APGid_empresa: TIntegerField;
    CTC_SQ_M_APGdia: TWideStringField;
    CTC_SQ_M_APGhistorico: TWideStringField;
    CTC_SQ_M_APGvlr_previsto: TFMTBCDField;
    CTC_SQ_M_APGid_obra: TIntegerField;
    FAT_SQ_M_XMLfre_valor: TFMTBCDField;
    CAD_SQ_C_FUNseg_ctc_apg: TBooleanField;
    CTC_DP_M_SLM: TDataSetProvider;
    CTC_SQ_M_SLM: TSQLDataSet;
    CTC_DS_M_SLM: TDataSource;
    CTC_SQ_M_SLM_ITE: TSQLDataSet;
    CTC_SQ_M_SLMid_controle: TIntegerField;
    CTC_SQ_M_SLMdata: TDateField;
    CTC_SQ_M_SLMid_responsavel: TIntegerField;
    CTC_SQ_M_SLMid_obra: TIntegerField;
    CTC_SQ_M_SLMobservacao: TWideStringField;
    CTC_SQ_M_SLM_ITEid_controle: TIntegerField;
    CTC_SQ_M_SLM_ITEid_item: TIntegerField;
    CTC_SQ_M_SLM_ITEqtde: TFloatField;
    CTC_SQ_M_SLM_ITEobservacao: TWideStringField;
    CTC_SQ_M_SLMint_nomeresp: TWideStringField;
    CTC_SQ_M_SLM_ITEint_nomeite: TWideStringField;
    EST_SQ_M_MALid_almoxarifado_dest: TIntegerField;
    EST_SQ_M_MALint_indicadortme: TIntegerField;
    CTC_SQ_M_SLMid_empresa: TIntegerField;
    CTC_DP_R_SLM: TDataSetProvider;
    CTC_SQ_R_SLM: TSQLDataSet;
    CTC_DS_R_SLM: TDataSource;
    CTC_SQ_R_SLM_ITE: TSQLDataSet;
    CTC_SQ_R_SLMid_controle: TIntegerField;
    CTC_SQ_R_SLMdata: TDateField;
    CTC_SQ_R_SLMid_responsavel: TIntegerField;
    CTC_SQ_R_SLMid_obra: TIntegerField;
    CTC_SQ_R_SLMobservacao: TWideStringField;
    CTC_SQ_R_SLMid_empresa: TIntegerField;
    CTC_SQ_R_SLMint_nomeresp: TWideStringField;
    CTC_SQ_R_SLMint_emprazao: TWideStringField;
    CTC_SQ_R_SLM_ITEid_controle: TIntegerField;
    CTC_SQ_R_SLM_ITEid_item: TIntegerField;
    CTC_SQ_R_SLM_ITEqtde: TFloatField;
    CTC_SQ_R_SLM_ITEobservacao: TWideStringField;
    CTC_SQ_R_SLM_ITEint_nomeite: TWideStringField;
    CTC_SQ_R_SLM_ITEint_nomeund: TWideStringField;
    FAT_SQ_M_XML_ITEvlr_icm_desc: TFMTBCDField;
    FIN_SQ_M_CXAdta_ult_reabertura: TDateField;
    FIN_SQ_M_CXAhor_ult_reabertura: TTimeField;
    CAD_SQ_C_PAR_CTRped_corr_preco_prazo: TBooleanField;
    FAT_SQ_M_PEDdias_cpg_prazo: TIntegerField;
    ACE_SQ_M_PROcod_barra: TWideStringField;
    CAD_SQ_C_PECper_correcao_financeiro: TFloatField;
    CAD_SQ_C_CLIdias_prazo_financeiro: TIntegerField;
    BUS_DP_C_CSU_ITE_PRF: TDataSetProvider;
    BUS_SQ_C_CSU_ITE_PRF: TSQLDataSet;
    ACE_SQ_M_CLIcep: TWideStringField;
    CAD_SQ_C_CPGper_desc: TFloatField;
    CAD_SQ_C_FUNseg_alt_vend_ped: TBooleanField;
    CAD_SQ_R_ITE_PRC_FIN: TSQLDataSet;
    CAD_DP_R_ITE_PRC_FIN: TDataSetProvider;
    EST_DP_R_DEZ: TDataSetProvider;
    EST_SQ_R_DEZ: TSQLDataSet;
    FAT_SQ_M_ROMtipo: TIntegerField;
    FAT_SQ_M_ROM_NFEint_fonefixo: TWideMemoField;
    FAT_SQ_M_ROM_NFEint_id_cidade: TWideMemoField;
    FAT_SQ_M_ROM_NFEint_nomecid: TWideStringField;
    FAT_SQ_M_ROM_NFEint_nomeemi: TWideStringField;
    FAT_SQ_M_ROMint_desctipo: TWideStringField;
    FAT_DP_R_GAM_700: TDataSetProvider;
    FAT_SQ_R_GAM_700: TSQLDataSet;
    FIN_DP_R_MCH_TOT: TDataSetProvider;
    FIN_SQ_R_MCH_TOT: TSQLDataSet;
    FAT_DP_R_GAM_710: TDataSetProvider;
    FAT_SQ_R_GAM_710: TSQLDataSet;
    FAT_SQ_R_GAM_710id_fiscal: TIntegerField;
    FAT_SQ_R_GAM_710id_almoxarifado: TIntegerField;
    FAT_SQ_R_GAM_710id_pedido_compra: TIntegerField;
    FAT_SQ_R_GAM_710id_condicao_pag: TIntegerField;
    FAT_SQ_R_GAM_710id_empresa: TIntegerField;
    FAT_SQ_R_GAM_710id_emitente: TIntegerField;
    FAT_SQ_R_GAM_710id_cfo: TWideStringField;
    FAT_SQ_R_GAM_710id_transportadora: TIntegerField;
    FAT_SQ_R_GAM_710id_vendedor: TIntegerField;
    FAT_SQ_R_GAM_710id_tipo_mov_estoque: TIntegerField;
    FAT_SQ_R_GAM_710uf_emitente: TWideStringField;
    FAT_SQ_R_GAM_710uf_empresa: TWideStringField;
    FAT_SQ_R_GAM_710dta_emissao: TDateField;
    FAT_SQ_R_GAM_710dta_documento: TDateField;
    FAT_SQ_R_GAM_710cpf_cnpj: TWideStringField;
    FAT_SQ_R_GAM_710numero: TIntegerField;
    FAT_SQ_R_GAM_710serie: TWideStringField;
    FAT_SQ_R_GAM_710sub_serie: TWideStringField;
    FAT_SQ_R_GAM_710modelo: TWideStringField;
    FAT_SQ_R_GAM_710status: TIntegerField;
    FAT_SQ_R_GAM_710nfe_ecf: TIntegerField;
    FAT_SQ_R_GAM_710ecf_prevenda: TIntegerField;
    FAT_SQ_R_GAM_710id_fiscal_referenciado: TIntegerField;
    FAT_SQ_R_GAM_710canc_motivo: TWideStringField;
    FAT_SQ_R_GAM_710canc_data: TDateField;
    FAT_SQ_R_GAM_710peso_liquido: TFloatField;
    FAT_SQ_R_GAM_710peso_bruto: TFloatField;
    FAT_SQ_R_GAM_710nfe_chave: TWideStringField;
    FAT_SQ_R_GAM_710nfe_obs: TWideStringField;
    FAT_SQ_R_GAM_710nfe_protocolo: TWideStringField;
    FAT_SQ_R_GAM_710nfe_recibo: TWideStringField;
    FAT_SQ_R_GAM_710nfe_canc_protocolo: TWideStringField;
    FAT_SQ_R_GAM_710nfe_canc_status: TWideStringField;
    FAT_SQ_R_GAM_710nfe_tipo_emissao: TWideStringField;
    FAT_SQ_R_GAM_710nfe_tipo_ambiente: TWideStringField;
    FAT_SQ_R_GAM_710nfe_finalidade: TIntegerField;
    FAT_SQ_R_GAM_710nfe_cod_sit: TWideStringField;
    FAT_SQ_R_GAM_710ind_operacao: TIntegerField;
    FAT_SQ_R_GAM_710ind_emitente: TIntegerField;
    FAT_SQ_R_GAM_710ind_frete: TIntegerField;
    FAT_SQ_R_GAM_710vlr_mercadoria: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_desconto: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_acrescimo: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_liquido: TFMTBCDField;
    FAT_SQ_R_GAM_710icm_n_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710icm_n_base: TFMTBCDField;
    FAT_SQ_R_GAM_710icm_s_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710icm_s_base: TFMTBCDField;
    FAT_SQ_R_GAM_710ipi_base: TFMTBCDField;
    FAT_SQ_R_GAM_710ipi_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710iss_base: TFMTBCDField;
    FAT_SQ_R_GAM_710iss_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710fre_base: TFMTBCDField;
    FAT_SQ_R_GAM_710fre_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710pis_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710pis_valor_st: TFMTBCDField;
    FAT_SQ_R_GAM_710cof_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710cof_valor_st: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_isenta: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_outras: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_seguro: TFMTBCDField;
    FAT_SQ_R_GAM_710tipo_nf: TWideStringField;
    FAT_SQ_R_GAM_710ecf_serial_impressora: TWideStringField;
    FAT_SQ_R_GAM_710ecf_marca_impressora: TWideStringField;
    FAT_SQ_R_GAM_710ecf_modelo_impressora: TWideStringField;
    FAT_SQ_R_GAM_710ecf_caixa: TWideStringField;
    FAT_SQ_R_GAM_710dta_movimento: TDateField;
    FAT_SQ_R_GAM_710origem_nf: TWideStringField;
    FAT_SQ_R_GAM_710faturada: TBooleanField;
    FAT_SQ_R_GAM_710situacao_inspecao: TIntegerField;
    FAT_SQ_R_GAM_710id_fiscal_frete: TIntegerField;
    FAT_SQ_R_GAM_710id_pedido_venda: TIntegerField;
    FAT_SQ_R_GAM_710vlr_outras_desp: TFMTBCDField;
    FAT_SQ_R_GAM_710fre_custo: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_icm_ser_nao_incide: TFMTBCDField;
    FAT_SQ_R_GAM_710cof_base: TFMTBCDField;
    FAT_SQ_R_GAM_710pis_base: TFMTBCDField;
    FAT_SQ_R_GAM_710posvenda: TBooleanField;
    FAT_SQ_R_GAM_710id_responsavel: TIntegerField;
    FAT_SQ_R_GAM_710tipo_cte: TIntegerField;
    FAT_SQ_R_GAM_710cod_lme: TWideStringField;
    FAT_SQ_R_GAM_710rev_lme: TWideStringField;
    FAT_SQ_R_GAM_710path_xml: TWideStringField;
    FAT_SQ_R_GAM_710nfref_chave: TWideStringField;
    FAT_SQ_R_GAM_710imp_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710tri_valor: TFMTBCDField;
    FAT_SQ_R_GAM_710tra_placa: TWideStringField;
    FAT_SQ_R_GAM_710tra_uf: TWideStringField;
    FAT_SQ_R_GAM_710tra_rntc: TWideStringField;
    FAT_SQ_R_GAM_710tra_qtde_vol: TFloatField;
    FAT_SQ_R_GAM_710tra_especie: TWideStringField;
    FAT_SQ_R_GAM_710tra_marca: TWideStringField;
    FAT_SQ_R_GAM_710tra_num_vol: TWideStringField;
    FAT_SQ_R_GAM_710id_iqm: TIntegerField;
    FAT_SQ_R_GAM_710id_abertura: TIntegerField;
    FAT_SQ_R_GAM_710legenda: TWideStringField;
    FAT_SQ_R_GAM_710prevenda: TBooleanField;
    FAT_SQ_R_GAM_710id_ordem: TIntegerField;
    FAT_SQ_R_GAM_710venctos_origem: TWideStringField;
    FAT_SQ_R_GAM_710canc_usuario: TIntegerField;
    FAT_SQ_R_GAM_710nro_termo: TIntegerField;
    FAT_SQ_R_GAM_710ind_nf: TIntegerField;
    FAT_SQ_R_GAM_710vlr_part_dest: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_part_orig: TFMTBCDField;
    FAT_SQ_R_GAM_710vlr_icm_desc: TFMTBCDField;
    FAT_SQ_R_GAM_710id_ors: TIntegerField;
    FAT_SQ_R_GAM_710vlr_fcp: TFMTBCDField;
    CAD_SQ_C_PAR_CTRemite_duplicata_aceite: TBooleanField;
    FIN_DP_R_BCO_SLD: TDataSetProvider;
    FIN_SQ_R_BCO_SLD: TSQLDataSet;
    BUS_SQ_M_PCA_PEDint_id_fiscal: TIntegerField;
    BUS_SQ_M_PCA_PEDint_numeronf: TIntegerField;
    FAT_SQ_M_PCA_PEDint_id_fiscal: TIntegerField;
    FAT_SQ_M_PCA_PEDint_numeronf: TIntegerField;
    CAD_SQ_C_PAR_CTRped_cli_cns_vnd_max: TFMTBCDField;
    CAD_SQ_C_CLIprofissao: TWideStringField;
    CAD_SQ_C_CLIrenda: TFMTBCDField;
    CTC_SQ_M_PROint_nomeite: TWideStringField;
    CTC_SQ_M_PROlote: TWideStringField;
    FIN_DP_R_CXA_DIA_NPD: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_NPD: TSQLDataSet;
    FIN_DP_R_CXA_DIA_NFT: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_NFT: TSQLDataSet;
    FAT_SQ_M_NFE_ITEid_fiscal_dev: TIntegerField;
    PCP_SQ_M_OPR_PEDnome: TWideStringField;
    PCP_SQ_M_OPR_PEDint_uf: TWideStringField;
    PCP_SQ_M_OPR_PEDint_nomecid: TWideStringField;
    PCP_SQ_M_OPR_PEDint_nomereg: TWideStringField;
    PCP_SQ_M_OPR_PEDint_reg_desc_perc: TFloatField;
    PCP_SQ_M_OPR_PEDint_cubagem: TFloatField;
    PCP_SQ_M_OPRid_opr: TIntegerField;
    PCP_SQ_M_OPRdta_emissao: TDateField;
    PCP_SQ_M_OPRid_responsavel: TIntegerField;
    PCP_SQ_M_OPRsituacao: TIntegerField;
    PCP_SQ_M_OPRid_empresa: TIntegerField;
    PCP_SQ_M_OPRid_tpp: TIntegerField;
    PCP_SQ_M_OPRcub_produzir: TFloatField;
    PCP_SQ_M_OPRcub_pedidos: TFloatField;
    PCP_SQ_M_OPRcod_lme: TWideStringField;
    PCP_SQ_M_OPRrev_lme: TWideStringField;
    PCP_SQ_M_OPRint_nomeres: TWideStringField;
    PCP_SQ_M_OPRint_nometpp: TWideStringField;
    PCP_SQ_M_OPR_PEDint_dtapedido: TDateField;
    PCP_SQ_M_OPRobs_administrativa: TWideStringField;
    PCP_SQ_M_OPRobs_producao: TWideStringField;
    FAT_DP_R_COV_REC: TDataSetProvider;
    FAT_SQ_R_COV_REC: TSQLDataSet;
    FAT_DP_R_COV_FAT: TDataSetProvider;
    FAT_SQ_R_COV_FAT: TSQLDataSet;
    FAT_SQ_M_NFE_DEVint_dtaemissao: TDateField;
    BUS_SQ_M_NFE_ITE_INTid_fiscal_dev: TIntegerField;
    PCP_SQ_M_OPR_PEDint_nomeven: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_selecao: TBooleanField;
    BUS_SQ_M_CSU_OPR_PEDid_opr: TIntegerField;
    BUS_SQ_M_CSU_OPR_PEDint_dtaemissaoopr: TDateField;
    BUS_SQ_M_CSU_OPR_PEDid_pedido: TIntegerField;
    BUS_SQ_M_CSU_OPR_PEDid_cliente: TIntegerField;
    BUS_SQ_M_CSU_OPR_PEDvlr_liquido: TFMTBCDField;
    BUS_SQ_M_CSU_OPR_PEDobs: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDpcp_obs: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomecli: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nometme: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomeven: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomecpg: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomeate: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomeres: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_nomeest: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_cpfcnpj: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_pessoacli: TIntegerField;
    BUS_SQ_M_CSU_OPR_PEDint_id_perfil: TIntegerField;
    BUS_SQ_M_CSU_OPR_PEDint_sitaprov: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_sitped: TWideStringField;
    BUS_SQ_M_CSU_OPR_PEDint_cubagem: TFloatField;
    BUS_DP_M_CSU_GER_PFT: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PFT: TSQLDataSet;
    BUS_DP_M_CSU_GER_PRE: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PRE: TSQLDataSet;
    BUS_DP_M_CSU_GER_PDE: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PDE: TSQLDataSet;
    BUS_DP_M_CSU_GER_PFE: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PFE: TSQLDataSet;
    BUS_DP_M_CSU_GER_PRC: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PRC: TSQLDataSet;
    BUS_DP_M_CSU_GER_PPG: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PPG: TSQLDataSet;
    BUS_DP_M_CSU_GER_XRC: TDataSetProvider;
    BUS_SQ_M_CSU_GER_XRC: TSQLDataSet;
    BUS_DP_M_CSU_GER_XPG: TDataSetProvider;
    BUS_SQ_M_CSU_GER_XPG: TSQLDataSet;
    BUS_DP_M_CSU_GER_XCB: TDataSetProvider;
    BUS_SQ_M_CSU_GER_XCB: TSQLDataSet;
    FAT_SQ_M_PED_TITint_docimpresso: TIntegerField;
    FAT_SQ_M_PCA_PEDint_cnpjcpf: TWideStringField;
    FAT_SQ_M_PCA_PEDint_obs: TWideStringField;
    FAT_SQ_M_PCA_PEDint_vlr_liquido: TFMTBCDField;
    FAT_SQ_M_PCA_PEDint_peso_liquido: TFloatField;
    CAD_SQ_C_PAR_MODcar: TBooleanField;
    ctc_sq_m_cep_epiint_nomeepi: TWideStringField;
    BUS_DP_M_CSU_GER_PFT_EMP: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PFT_EMP: TSQLDataSet;
    PCP_SQ_C_FPI: TSQLDataSet;
    PCP_DP_C_FPI: TDataSetProvider;
    PCP_DS_C_FPI: TDataSource;
    PCP_SQ_C_FPI_FTI: TSQLDataSet;
    PCP_SQ_C_FPI_FTI_ITE: TSQLDataSet;
    PCP_SQ_C_FPIid_item: TIntegerField;
    PCP_SQ_C_FPIid_cor: TIntegerField;
    PCP_SQ_C_FPIid_tamanho: TIntegerField;
    PCP_SQ_C_FPIid_fpi: TIntegerField;
    PCP_SQ_C_FPIint_nomeite: TWideStringField;
    PCP_SQ_C_FPIint_nomecor: TWideStringField;
    PCP_SQ_C_FPIint_nometam: TWideStringField;
    PCP_SQ_C_FPI_FTIid_item: TIntegerField;
    PCP_SQ_C_FPI_FTIid_cor: TIntegerField;
    PCP_SQ_C_FPI_FTIid_tamanho: TIntegerField;
    PCP_SQ_C_FPI_FTItipo_acao: TIntegerField;
    PCP_SQ_C_FPI_FTIqtde: TFloatField;
    PCP_SQ_C_FPI_FTIid_setor: TIntegerField;
    PCP_SQ_C_FPI_FTIid_fpi: TIntegerField;
    PCP_SQ_C_FPI_FTIint_nomeite: TWideStringField;
    PCP_SQ_C_FPI_FTIint_nomecor: TWideStringField;
    PCP_SQ_C_FPI_FTIint_nometam: TWideStringField;
    PCP_DS_C_FPI_FTI: TDataSource;
    PCP_SQ_C_FPI_FTI_ITEid_fpi: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEid_fpi_fti: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEid_fpi_fti_ite: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEid_item: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEid_cor: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEid_tamanho: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEqtde: TIntegerField;
    PCP_SQ_C_FPI_FTI_ITEint_nomeite: TWideStringField;
    PCP_SQ_C_FPI_FTI_ITEint_nomecor: TWideStringField;
    PCP_SQ_C_FPI_FTI_ITEint_nometam: TWideStringField;
    FIN_SQ_M_RECint_descobra: TWideStringField;
    BUS_SQ_M_OPR_OPP_INT: TSQLDataSet;
    BUS_DP_M_OPR_OPP_INT: TDataSetProvider;
    BUS_SQ_M_OPR_OPP_SOP_INT: TSQLDataSet;
    BUS_DS_M_OPR_OPP_INT: TDataSource;
    FAT_SQ_M_PEDint_nomereg: TWideStringField;
    EST_DP_R_PES_GER: TDataSetProvider;
    EST_SQ_R_PES_GER: TSQLDataSet;
    EST_DP_R_PES_ALM: TDataSetProvider;
    EST_SQ_R_PES_ALM: TSQLDataSet;
    BUS_DP_M_CSU_PEQ_TVP: TDataSetProvider;
    BUS_SQ_M_CSU_PEQ_TVP: TSQLDataSet;
    BUS_DP_M_CSU_PEQ_CMD: TDataSetProvider;
    BUS_SQ_M_CSU_PEQ_CMD: TSQLDataSet;
    BUS_DP_M_CSU_PEQ_DPV: TDataSetProvider;
    BUS_SQ_M_CSU_PEQ_DPV: TSQLDataSet;
    BUS_DP_M_CSU_PEQ_DPF: TDataSetProvider;
    BUS_SQ_M_CSU_PEQ_DPF: TSQLDataSet;
    ctc_sq_c_obrint_nomeuf: TWideStringField;
    FAT_SQ_M_PCAid_motorista: TIntegerField;
    FAT_SQ_M_PCAplaca: TWideStringField;
    FAT_SQ_M_PCAint_nomemot: TWideStringField;
    BUS_DP_M_CSU_DRE_RVN: TDataSetProvider;
    BUS_SQ_M_CSU_DRE_RVN: TSQLDataSet;
    BUS_DP_M_CSU_DRE_DVN: TDataSetProvider;
    BUS_SQ_M_CSU_DRE_DVN: TSQLDataSet;
    BUS_DP_M_CSU_DRE_DPO: TDataSetProvider;
    BUS_SQ_M_CSU_DRE_DPO: TSQLDataSet;
    BUS_DP_M_CSU_DRE_CMD: TDataSetProvider;
    BUS_SQ_M_CSU_DRE_CMD: TSQLDataSet;
    BUS_DP_M_CSU_DRE_RNO: TDataSetProvider;
    BUS_SQ_M_CSU_DRE_RNO: TSQLDataSet;
    FIN_SQ_M_CTAint_desc_obr: TWideStringField;
    FAT_SQ_M_NFE_ITEdre_perc_out_ded_ven: TFloatField;
    FAT_SQ_M_NFE_ITEdre_perc_ircs: TFloatField;
    FAT_SQ_M_NFE_ITEint_origem: TWideStringField;
    ACE_SQ_M_EST_DEPdta_movimento: TWideStringField;
    BUS_DP_BR_PREVENDA_DETALHE: TDataSetProvider;
    BUS_SQ_BR_PREVENDA_DETALHE: TSQLDataSet;
    BUS_SQ_BR_PREVENDA_DETALHEnumprevenda: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEloja: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcod_produto: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEqtd: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEun: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEvalor: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEdesconto: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEacrescimo: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEtotal: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEcancelado: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEn_cupom: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEserial: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcod_grade: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEitem: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEcod_kit: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcod_vendedor: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEdesc_produto: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEaliquota: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEservico: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEserialproduto: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEtipo: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcod_prod_tcsmart: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEtipo_bloqueado: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEflag_sis: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEflag_aceito: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEmesa_origem: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEnumprevenda_origem: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEitem_origem: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEccusto: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEncm: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEex_ipi: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEgenero: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcst_icms: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEorigem_icms: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEaliquota_ipi: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEaliquota_pis: TFMTBCDField;
    BUS_SQ_BR_PREVENDA_DETALHEtipo_item: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcfop: TIntegerField;
    BUS_SQ_BR_PREVENDA_DETALHEdesc_unidade: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEstb: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEcomplemento_item: TWideStringField;
    BUS_SQ_BR_PREVENDA_DETALHEprdcoutroscodigo: TWideStringField;
    BUS_DP_BR_CUPOM_DETALHE: TDataSetProvider;
    BUS_SQ_BR_CUPOM_DETALHE: TSQLDataSet;
    BUS_SQ_BR_CUPOM_DETALHEn_cupom: TIntegerField;
    BUS_SQ_BR_CUPOM_DETALHEcod_produto: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEn_item: TIntegerField;
    BUS_SQ_BR_CUPOM_DETALHEqtde: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEvalor_unitario: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEvalor_total: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEdesconto: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEacrecimo: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEcancelado: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEserial_impressora: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEn_caixa: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEaliquota: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEunidade: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEnumloja: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEflag_aceito: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEflag_sis: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEtanque: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEbomba: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEbico: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEei: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEef: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEcod_grade: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcartao_cliente: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcartao_autorizador: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEdesc_produto: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEnumcaixa: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEnumterminal: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEbico_posto: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEdata_ab: TDateField;
    BUS_SQ_BR_CUPOM_DETALHEhora_ab: TDateField;
    BUS_SQ_BR_CUPOM_DETALHEposicao_ab: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEserial: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEtabela: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcod_kit: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcod_vendedor: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcod_operador: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEpdeccodigo: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEprdcoutroscodigo: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEprvndescontopenota: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEprvnacrescimopenota: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEflag_servico: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEccusto: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEncm: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEex_ipi: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEgenero: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcst_icms: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEorigem_icms: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEaliquota_ipi: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEaliquota_pis: TFMTBCDField;
    BUS_SQ_BR_CUPOM_DETALHEtipo_item: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcfop: TIntegerField;
    BUS_SQ_BR_CUPOM_DETALHEdesc_unidade: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEstb: TWideStringField;
    BUS_SQ_BR_CUPOM_DETALHEcomplemento_item: TWideStringField;
    FIN_SQ_M_PAGint_nomeobr: TWideStringField;
    ACE_SQ_M_CLIid_pdv: TWideStringField;
    ACE_SQ_M_EST_DEPid_item: TWideStringField;
    ACE_SQ_M_EST_FOPid_item2: TIntegerField;
    ACE_SQ_M_EST_FOPid_item: TWideStringField;
    ACE_SQ_M_EST_FOPind_ite_bar: TIntegerField;
    CAD_SQ_C_GRUdre_perc_out_ded_ven: TFloatField;
    CAD_SQ_C_GRUdre_perc_ircs: TFloatField;
    BUS_SQ_M_OPR_OPP_INTid_opr: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTid_opr_opp: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTid_item: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTid_cor: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTid_tamanho: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTqtde_a_produzir: TFloatField;
    BUS_SQ_M_OPR_OPP_INTqtde_produzida: TFloatField;
    BUS_SQ_M_OPR_OPP_INTqtde_a_produzir_orig: TFloatField;
    BUS_SQ_M_OPR_OPP_INTid_resp_alt: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTint_nomeite: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTint_undvenda: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTint_nomecor: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTint_nometam: TWideStringField;
    BUS_SQ_M_OPR_OPP_SOP_INTid_opr: TIntegerField;
    BUS_SQ_M_OPR_OPP_SOP_INTid_opr_opp: TIntegerField;
    BUS_SQ_M_OPR_OPP_SOP_INTid_opr_sop: TIntegerField;
    BUS_SQ_M_OPR_OPP_SOP_INTid_opr_ext: TIntegerField;
    BUS_SQ_M_OPR_OPP_SOP_INTid_opr_opp_ext: TIntegerField;
    BUS_SQ_M_OPR_OPP_SOP_INTdta_utilizado: TDateField;
    BUS_SQ_M_OPR_OPP_SOP_INThor_utilizado: TTimeField;
    BUS_SQ_M_OPR_OPP_SOP_INTqtd_utilizado: TFloatField;
    BUS_SQ_M_OPR_OPP_SOP_INTint_nomeite: TWideStringField;
    BUS_SQ_M_OPR_OPP_SOP_INTint_undvenda: TWideStringField;
    BUS_SQ_M_OPR_OPP_SOP_INTint_nomecor: TWideStringField;
    BUS_SQ_M_OPR_OPP_SOP_INTint_nometam: TWideStringField;
    PCP_SQ_C_FPI_FTIint_undvenda: TWideStringField;
    PCP_SQ_C_FPIint_undvenda: TWideStringField;
    PCP_SQ_C_FPI_FTI_ITEint_undvenda: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTdta_alt: TDateField;
    BUS_SQ_M_OPR_OPP_INThora_alt: TTimeField;
    BUS_SQ_M_OPR_OPP_INTqtde_atender_opr: TFloatField;
    BUS_SQ_M_OPR_OPP_INTqtde_atender_opr_ext: TFloatField;
    BUS_SQ_M_OPR_OPP_INTsaldo_disponivel: TFloatField;
    BUS_SQ_M_OPR_OPP_INTreg_alt: TBooleanField;
    CAD_SQ_C_ITEint_dre_perc_ircs: TFloatField;
    CAD_SQ_C_ITEint_dre_perc_out_ded_ven: TFloatField;
    PCP_SQ_M_ROM_PED_ICF: TSQLDataSet;
    PCP_SQ_M_ROM_PED_ICFid_rom: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFid_pedido: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFid_sequencia: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFid_item: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFid_cor: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFid_tamanho: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFcod_barra: TWideStringField;
    PCP_SQ_M_ROM_PED_ICFid_responsavel: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFdta_conferencia: TDateField;
    PCP_SQ_M_ROM_PED_ICFhor_conferencia: TTimeField;
    PCP_SQ_M_ROM_PED_ICFid_opr_etq: TIntegerField;
    PCP_SQ_M_ROM_PED_ICFint_undvenda: TWideStringField;
    PCP_SQ_M_ROM_PED_ICFint_nomecor: TWideStringField;
    PCP_SQ_M_ROM_PED_ICFint_nometam: TWideStringField;
    PCP_DP_M_ETQ: TDataSetProvider;
    PCP_SQ_M_ETQ: TSQLDataSet;
    PCP_SQ_M_ETQid_opr: TIntegerField;
    PCP_SQ_M_ETQid_item: TIntegerField;
    PCP_SQ_M_ETQid_cor: TIntegerField;
    PCP_SQ_M_ETQid_tamanho: TIntegerField;
    PCP_SQ_M_ETQcod_barra: TWideStringField;
    PCP_SQ_M_ETQsequencia: TIntegerField;
    PCP_SQ_M_ETQdta_criacao: TDateField;
    PCP_SQ_M_ETQhor_criacao: TTimeField;
    PCP_SQ_M_ETQimpressa: TBooleanField;
    PCP_SQ_M_ROM_PEDint_codcli: TIntegerField;
    PCP_SQ_M_ROM_PED_ITEqtde_conferida: TFloatField;
    PCP_SQ_M_ROM_PEDint_cod_vend: TIntegerField;
    PCP_SQ_M_ROM_PEDint_nomevend: TWideStringField;
    PCP_SQ_C_FPI_FTIid_busca_item: TWideStringField;
    PCP_SQ_C_FPI_FTI_ITEid_busca_item: TWideStringField;
    PCP_SQ_C_FPI_FTIint_nomeset: TWideStringField;
    PCP_SQ_M_ROM_PEDstatus: TIntegerField;
    BUS_DP_M_PED_INT: TDataSetProvider;
    BUS_SQ_M_PED_INT: TSQLDataSet;
    BUS_SQ_M_OPR_PED_INT: TSQLDataSet;
    BUS_DP_M_OPR_PED_INT: TDataSetProvider;
    PCP_SQ_M_ETQint_und_venda: TWideStringField;
    PCP_SQ_M_ETQint_nomecor: TWideStringField;
    PCP_SQ_M_ETQint_nometam: TWideStringField;
    AUD_DP_M_AUD: TDataSetProvider;
    AUD_SQ_M_AUD: TSQLDataSet;
    AUD_CD_M_AUD: TClientDataSet;
    PCP_SQ_C_FPI_FTIid_fpi_fti: TIntegerField;
    CAD_SQ_C_GRUctr_lot_entr: TBooleanField;
    FAT_SQ_M_NFE_ITEint_rt_composicao: TWideStringField;
    CAD_SQ_C_ITErt_registro: TWideStringField;
    FAT_SQ_M_NFE_ITEint_rt_registro: TWideStringField;
    FAT_SQ_M_NFE_ITEdta_vencimento: TDateField;
    CAD_SQ_C_ITEint_ctr_lot_entr: TBooleanField;
    FIN_SQ_M_PBX_GERche_numero: TIntegerField;
    FIN_DP_R_EXT_CLI_EST: TDataSetProvider;
    FIN_SQ_R_EXT_CLI_EST: TSQLDataSet;
    ACE_SQ_M_VNDcod_barra: TWideStringField;
    BUS_SQ_M_OPR_OPP_SOP: TSQLDataSet;
    BUS_DP_M_OPR_OPP_SOP: TDataSetProvider;
    BUS_DP_M_REC_INT: TDataSetProvider;
    BUS_SQ_M_REC_INT: TSQLDataSet;
    FIN_SQ_M_RBXvlr_tot_ger: TFMTBCDField;
    PCP_SQ_M_OPR_OPPid_opr: TIntegerField;
    PCP_SQ_M_OPR_OPPid_opr_opp: TIntegerField;
    PCP_SQ_M_OPR_OPPid_item: TIntegerField;
    PCP_SQ_M_OPR_OPPid_cor: TIntegerField;
    PCP_SQ_M_OPR_OPPid_tamanho: TIntegerField;
    PCP_SQ_M_OPR_OPPqtde_a_produzir: TFloatField;
    PCP_SQ_M_OPR_OPPqtde_produzida: TFloatField;
    PCP_SQ_M_OPR_OPPqtde_a_produzir_orig: TFloatField;
    PCP_SQ_M_OPR_OPPid_resp_alt: TIntegerField;
    PCP_SQ_M_OPR_OPPdta_alt: TDateField;
    PCP_SQ_M_OPR_OPPhora_alt: TTimeField;
    PCP_SQ_M_OPR_OPPqtde_atender_opr: TFloatField;
    PCP_SQ_M_OPR_OPPqtde_atender_opr_ext: TFloatField;
    PCP_SQ_M_OPR_OPPsaldo_disponivel: TFloatField;
    PCP_SQ_M_OPR_OPPreg_alt: TBooleanField;
    PCP_SQ_M_OPR_OPPhistorico_alt: TWideStringField;
    PCP_SQ_M_OPR_OPPmotivo_alt: TWideStringField;
    PCP_SQ_M_OPR_OPPint_nomeite: TWideStringField;
    PCP_SQ_M_OPR_OPPint_undvenda: TWideStringField;
    PCP_SQ_M_OPR_OPPint_nomecor: TWideStringField;
    PCP_SQ_M_OPR_OPPint_nometam: TWideStringField;
    PCP_SQ_M_OPR_OPPint_nomeresp: TWideStringField;
    PCP_DS_M_OPR_OPP: TDataSource;
    PCP_SQ_M_OPR_OPP_SOP: TSQLDataSet;
    PCP_SQ_M_OPR_OPP_SOPid_opr: TIntegerField;
    PCP_SQ_M_OPR_OPP_SOPid_opr_opp: TIntegerField;
    PCP_SQ_M_OPR_OPP_SOPid_opr_sop: TIntegerField;
    PCP_SQ_M_OPR_OPP_SOPid_opr_ext: TIntegerField;
    PCP_SQ_M_OPR_OPP_SOPid_opr_opp_ext: TIntegerField;
    PCP_SQ_M_OPR_OPP_SOPdta_utilizado: TDateField;
    PCP_SQ_M_OPR_OPP_SOPhor_utilizado: TTimeField;
    PCP_SQ_M_OPR_OPP_SOPqtd_utilizado: TFloatField;
    PCP_SQ_M_OPR_OPP_SOPint_dtaemissao_ext: TDateField;
    BUS_DP_M_CSU_GER_PFF: TDataSetProvider;
    BUS_SQ_M_CSU_GER_PFF: TSQLDataSet;
    FAT_SQ_M_NFE_ITEdi_draw: TWideStringField;
    FAT_SQ_M_NFE_ITEdi_tp_viatransp: TIntegerField;
    FAT_SQ_M_NFE_ITEdi_tp_intermedio: TIntegerField;
    BUS_SQ_C_PAR_CTRfp_per_cust_ven_mens: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_icms_ven: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_simples: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_comissao: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_frete_ven: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_cust_fin_ven: TFloatField;
    BUS_SQ_C_PAR_CTRfp_per_prc_prz_ven_prat: TFloatField;
    BUS_SQ_C_PAR_CTRassociado_acavasf: TBooleanField;
    BUS_SQ_C_PAR_CTRtipo_impressao: TIntegerField;
    BUS_SQ_C_PAR_CTRped_corr_preco_prazo: TBooleanField;
    BUS_SQ_C_PAR_CTRemite_duplicata_aceite: TBooleanField;
    BUS_SQ_C_PAR_CTRped_cli_cns_vnd_max: TFMTBCDField;
    BUS_SQ_C_PAR_CTRcxa_id_tipo_fin_canc_ant: TIntegerField;
    BUS_SQ_C_PAR_CTRcxa_id_plano_canc_ant: TWideStringField;
    CAD_SQ_C_PAR_CTRcxa_id_tipo_fin_canc_ant: TIntegerField;
    CAD_SQ_C_PAR_CTRcxa_id_plano_canc_ant: TWideStringField;
    CAD_SQ_C_PAR_CTRprc_ite_manual: TBooleanField;
    CAD_SQ_C_ITE_PRC: TSQLDataSet;
    CAD_SQ_C_ITE_PRCid_item: TIntegerField;
    CAD_SQ_C_ITE_PRCid_perfil_cli: TIntegerField;
    CAD_SQ_C_ITE_PRCpreco_avista: TFMTBCDField;
    CAD_SQ_C_ITE_PRCpreco1: TFMTBCDField;
    CAD_SQ_C_ITE_PRCpreco2: TFMTBCDField;
    CAD_SQ_C_ITE_PRCpreco3: TFMTBCDField;
    CAD_SQ_C_ITE_PRCpreco4: TFMTBCDField;
    CAD_SQ_C_ITE_PRCint_desc_perfil: TWideStringField;
    BUS_DP_C_ITE_PRC: TDataSetProvider;
    BUS_SQ_C_ITE_PRC: TSQLDataSet;
    CAD_DP_R_ITE_PRC_MNL: TDataSetProvider;
    CAD_SQ_R_ITE_PRC_MNL: TSQLDataSet;
    EST_SQ_M_LOTdta_vencimento: TDateField;
    CAD_DP_C_PAI: TDataSetProvider;
    CAD_SQ_C_PAI: TSQLDataSet;
    CAD_SQ_C_PAIid_pais: TWideStringField;
    CAD_SQ_C_PAIdescricao: TWideStringField;
    CAD_SQ_C_CLIint_nomepai: TWideStringField;
    CAD_SQ_C_CIDcod_pais: TWideStringField;
    CAD_SQ_C_CIDint_nomepai: TWideStringField;
    PCP_DP_M_OPR_REQ: TDataSetProvider;
    PCP_SQ_M_OPR_REQ: TSQLDataSet;
    PCP_DS_M_OPR_REQ: TDataSource;
    PCP_SQ_M_OPR_REQ_ITE: TSQLDataSet;
    PCP_SQ_M_OPR_REQid_opr: TIntegerField;
    PCP_SQ_M_OPR_REQid_opr_req: TIntegerField;
    PCP_SQ_M_OPR_REQdta_emissao: TDateField;
    PCP_SQ_M_OPR_REQid_funcionario_canc: TIntegerField;
    PCP_SQ_M_OPR_REQdta_canc: TDateField;
    PCP_SQ_M_OPR_REQhor_canc: TTimeField;
    PCP_SQ_M_OPR_REQint_nomefuncanc: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEid_opr: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_opr_req: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_opr_req_ite: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_item: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_cor: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEqtde: TFloatField;
    PCP_SQ_M_OPR_REQ_ITEqtde_atendida: TFloatField;
    PCP_SQ_M_OPR_REQ_ITEdta_canc: TDateField;
    PCP_SQ_M_OPR_REQ_ITEhor_canc: TTimeField;
    PCP_SQ_M_OPR_REQ_ITEid_funcionario_canc: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEsituacao: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEid_setor: TIntegerField;
    PCP_SQ_M_OPR_REQ_ITEint_nomeite: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEint_nometam: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEint_nomefuncanc: TWideStringField;
    PCP_SQ_M_OPR_REQid_responsavel: TIntegerField;
    PCP_SQ_M_OPR_REQint_nomeresp: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEid_busca_item: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEint_undvenda: TWideStringField;
    PCP_SQ_M_OPR_REQcod_lme: TWideStringField;
    PCP_SQ_M_OPR_REQrev_lme: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEnum_lote: TWideStringField;
    PCP_SQ_M_OPR_REQ_ITEgerado_automatico: TBooleanField;
    BUS_SQ_M_LOT_EST: TSQLDataSet;
    BUS_DP_M_LOT_EST: TDataSetProvider;
    PCP_SQ_M_OPRid_almoxarifado: TIntegerField;
    PCP_SQ_M_OPRint_nomealm: TWideStringField;
    AUD_SQ_M_AUDdta_servidor: TDateField;
    AUD_SQ_M_AUDhor_servidor: TTimeField;
    AUD_SQ_M_AUDarq_auditoria: TBlobField;
    AUD_SQ_M_AUDid_usuario: TIntegerField;
    AUD_SQ_M_AUDid_empresa: TIntegerField;
    AUD_SQ_M_AUDprograma: TWideStringField;
    AUD_SQ_M_AUDid_aud: TIntegerField;
    AUD_CD_M_AUDdta_servidor: TDateField;
    AUD_CD_M_AUDhor_servidor: TTimeField;
    AUD_CD_M_AUDarq_auditoria: TBlobField;
    AUD_CD_M_AUDid_usuario: TIntegerField;
    AUD_CD_M_AUDid_empresa: TIntegerField;
    AUD_CD_M_AUDprograma: TWideStringField;
    AUD_CD_M_AUDid_aud: TIntegerField;
    EST_SQ_R_PES_GER_PND: TSQLDataSet;
    EST_DP_R_PES_GER_PND: TDataSetProvider;
    EST_DP_R_PES_ALM_PND: TDataSetProvider;
    EST_SQ_R_PES_ALM_PND: TSQLDataSet;
    PCP_SQ_M_OPR_REQ_ITEint_nomestr: TWideStringField;
    CMP_SQ_M_SOLid_opr_req: TIntegerField;
    PCP_SQ_M_OPRid_setor: TIntegerField;
    PCP_SQ_M_OPRint_nomestr: TWideStringField;
    CAD_SQ_C_PAR_CTRsgq_opr_id_setor: TIntegerField;
    BUS_SQ_C_PAR_CTRsgq_opr_id_setor: TIntegerField;
    BUS_DP_M_ITE_EST_MIN: TDataSetProvider;
    BUS_SQ_M_ITE_EST_MIN: TSQLDataSet;
    CTC_SQ_M_PROdoc_pro: TBlobField;
    PCP_SQ_M_OPR_REQcancelado: TBooleanField;
    PCP_SQ_M_OPR_REQ_ITEcancelado: TBooleanField;
    PCP_SQ_M_OPR_OPSnum_lote_bordadeira: TWideStringField;
    PCP_SQ_M_OPR_OPSnum_lote_tecido: TWideStringField;
    PCP_SQ_M_OPR_OPSnum_lote_tnt: TWideStringField;
    PCP_SQ_M_OPR_OPSqtde_acabado: TFloatField;
    PCP_SQ_M_OPR_OPSnum_lote_espuma: TWideStringField;
    PCP_SQ_M_OPR_OPSint_trs_ite: TWideStringField;
    PCP_SQ_M_OPR_OPSint_desc_setor: TWideStringField;
    PCP_SQ_M_OPR_OPSint_tipodesc_setor: TWideStringField;
    PCP_SQ_M_OPR_OPSint_tipo_setor: TIntegerField;
    CAD_SQ_C_SETint_tipo_desc: TWideStringField;
    PCP_SQ_M_OPR_OPSint_nomeite_acab: TWideStringField;
    PCP_SQ_M_OPR_OPSint_nomeite: TWideStringField;
    PCP_SQ_M_ETQid_etq: TIntegerField;
    PCP_SQ_M_ETQdta_entrada_est: TDateField;
    PCP_SQ_M_ETQhor_entrada_est: TTimeField;
    PCP_SQ_M_ETQid_funcionario_est: TIntegerField;
    PCP_SQ_M_ETQhor_impressa: TTimeField;
    PCP_SQ_M_ETQdta_impressa: TDateField;
    PCP_SQ_M_ETQid_func_impressa: TIntegerField;
    PCP_SQ_M_OPR_OPSint_undvenda: TWideStringField;
    PCP_SQ_M_ETQid_opr_origem: TIntegerField;
    BUS_DP_M_OPR_ETQ: TDataSetProvider;
    BUS_SQ_M_OPR_ETQ: TSQLDataSet;
    PCP_SQ_M_OPR_OPSint_cod_tipo_rast: TIntegerField;
    PCP_SQ_M_OPR_OPPint_selecao: TBooleanField;
    PCP_SQ_M_ETQint_selecao: TBooleanField;
    PCP_SQ_M_ETQint_medidaite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_recomendacoes1ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_recomendacoes2ite: TWideStringField;
    PCP_SQ_M_ETQint_nomecue: TWideStringField;
    PCP_SQ_M_ETQint_nomeseloetq: TWideStringField;
    PCP_SQ_M_ETQint_etiq_modelo: TWideStringField;
    PCP_SQ_M_ETQint_fteetq: TIntegerField;
    PCP_SQ_M_ETQint_impselo: TBooleanField;
    PCP_SQ_M_ETQint_impmsgetq: TBooleanField;
    PCP_SQ_M_ETQint_modeloftq_etq: TIntegerField;
    PCP_SQ_M_ETQint_nome_layout_etq: TWideStringField;
    CAD_SQ_C_FUNseq_vis_alert_est_min: TBooleanField;
    FIN_SQ_M_PBXvlr_tot_novo_tit: TFMTBCDField;
    CAD_SQ_C_CLIid_responsavel: TIntegerField;
    CAD_SQ_C_CLIint_nomeresp: TWideStringField;
    CAD_SQ_C_CLIint_pessoa: TWideStringField;
    CAD_SQ_C_CLIint_nomepec: TWideStringField;
    CAD_DP_C_CLI_EXT_ITE: TDataSetProvider;
    CAD_SQ_C_CLI_EXT_ITE: TSQLDataSet;
    CAD_SQ_C_PAR_CTRmal_tipo_estoque_ent: TIntegerField;
    BUS_SQ_C_PAR_CTRprc_ite_manual: TBooleanField;
    BUS_SQ_C_PAR_CTRmal_tipo_estoque_ent: TIntegerField;
    CAD_SQ_C_FPGvlr_min_parcela: TFMTBCDField;
    PCP_SQ_M_ETQcod_int_etq: TWideStringField;
    PCP_SQ_M_ETQcod_int_etq_rev: TWideStringField;
    PCP_SQ_M_ETQdescricao: TWideStringField;
    PCP_SQ_M_ETQetq_tecnica: TBooleanField;
    PCP_SQ_M_ETQespecificacoes: TWideStringField;
    PCP_SQ_M_ETQtexto_livre1: TWideStringField;
    PCP_SQ_M_ETQtexto_livre2: TWideStringField;
    PCP_SQ_M_ETQid_fte_etq: TIntegerField;
    PCP_SQ_M_ETQmodelo_etq: TIntegerField;
    PCP_SQ_M_ETQid_fte: TIntegerField;
    PCP_SQ_M_ETQcod_lme: TWideStringField;
    PCP_SQ_M_ETQrev_lme: TWideStringField;
    PCP_SQ_M_ETQrequisitos: TWideStringField;
    PCP_SQ_M_ETQinf_contato: TWideStringField;
    PCP_SQ_M_ETQinf_remocao: TWideStringField;
    PCP_SQ_M_ETQinf_sac: TWideStringField;
    FIN_SQ_M_REC_PAGvlr_acrescimo: TFMTBCDField;
    FIN_SQ_M_REC_PAGbol_nome_arq_ret: TWideStringField;
    FAT_SQ_M_XML_ITEint_codbarra: TWideStringField;
    CAD_SQ_C_FORint_nomepais: TWideStringField;
    BUS_DP_M_CSU_GER_RFO: TDataSetProvider;
    BUS_SQ_M_CSU_GER_RFO: TSQLDataSet;
    BUS_SQ_M_CSU_GER_RVE: TSQLDataSet;
    BUS_DP_M_CSU_GER_RVE: TDataSetProvider;
    PCP_DP_M_EPP: TDataSetProvider;
    PCP_SQ_M_EPP: TSQLDataSet;
    PCP_DS_M_EPP: TDataSource;
    PCP_SQ_M_EPP_ITE: TSQLDataSet;
    PCP_SQ_M_EPPid_epp: TIntegerField;
    PCP_SQ_M_EPPid_empresa: TIntegerField;
    PCP_SQ_M_EPPcod_lme: TWideStringField;
    PCP_SQ_M_EPPrev_lme: TWideStringField;
    PCP_SQ_M_EPPid_responsavel: TIntegerField;
    PCP_SQ_M_EPPid_almoxarifado: TIntegerField;
    PCP_SQ_M_EPPdta_entrada: TDateField;
    PCP_SQ_M_EPPhor_entrada: TTimeField;
    PCP_SQ_M_EPPint_nomefun: TWideStringField;
    PCP_SQ_M_EPPint_nomealm: TWideStringField;
    PCP_SQ_M_ETQid_empresa: TIntegerField;
    PCP_SQ_M_EPP_ITEid_epp: TIntegerField;
    PCP_SQ_M_EPP_ITEid_epp_ite: TIntegerField;
    PCP_SQ_M_EPP_ITEid_item: TIntegerField;
    PCP_SQ_M_EPP_ITEid_busca_item: TWideStringField;
    PCP_SQ_M_EPP_ITEid_cor: TIntegerField;
    PCP_SQ_M_EPP_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_EPP_ITEcod_barra: TWideStringField;
    PCP_SQ_M_EPP_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_EPP_ITEint_nometam: TWideStringField;
    PCP_SQ_M_EPP_ITEint_oprorigem: TIntegerField;
    PCP_SQ_M_EPP_ITEint_opr: TIntegerField;
    PCP_SQ_M_EPP_ITEint_undvenda: TWideStringField;
    BUS_SQ_M_EPP_ITE_INT: TSQLDataSet;
    BUS_DP_M_EPP_ITE_INT: TDataSetProvider;
    CAD_SQ_C_PAR_CTRpcp_epp_id_tipo_mov_estoque: TIntegerField;
    BUS_SQ_C_PAR_CTRpcp_epp_id_tipo_mov_estoque: TIntegerField;
    EST_SQ_M_FEAid_epp: TIntegerField;
    PCP_SQ_M_EPP_ITEqtde: TFloatField;
    PCP_SQ_M_EPP_ITEint_tipo_item: TWideStringField;
    CAD_SQ_C_FORdias_entrega: TIntegerField;
    FIN_SQ_M_CTAid_titulo_pag: TIntegerField;
    FAT_SQ_M_PEX: TSQLDataSet;
    FAT_DP_M_PEX: TDataSetProvider;
    FAT_SQ_M_PEXid_pedido: TIntegerField;
    FAT_SQ_M_PEXid_empresa: TIntegerField;
    FAT_SQ_M_PEXdta_pedido: TDateField;
    FAT_SQ_M_PEXid_tipo_mov_estoque: TIntegerField;
    FAT_SQ_M_PEXid_vendedor: TIntegerField;
    FAT_SQ_M_PEXobs: TWideStringField;
    FAT_SQ_M_PEXvlr_bruto: TFMTBCDField;
    FAT_SQ_M_PEXvlr_desconto: TFMTBCDField;
    FAT_SQ_M_PEXper_desconto: TFloatField;
    FAT_SQ_M_PEXvlr_liquido: TFMTBCDField;
    FAT_SQ_M_PEXhor_pedido: TSQLTimeStampField;
    FAT_SQ_M_PEXid_condicao_pag: TIntegerField;
    FAT_SQ_M_PEXpcp_obs: TWideStringField;
    FAT_SQ_M_PEXpcp_id_opr: TIntegerField;
    FAT_SQ_M_PEXsituacao: TIntegerField;
    FAT_SQ_M_PEXsituacao_aprovacao: TIntegerField;
    FAT_SQ_M_PEXid_atendente: TIntegerField;
    FAT_SQ_M_PEXid_responsavel: TIntegerField;
    FAT_SQ_M_PEXid_cliente: TIntegerField;
    FAT_SQ_M_PEXtipo_restricao: TWideStringField;
    FAT_SQ_M_PEXid_almoxarifado: TIntegerField;
    FAT_SQ_M_PEXjustificativa: TWideStringField;
    FAT_SQ_M_PEXid_usuario_lib: TIntegerField;
    FAT_SQ_M_PEXcod_lme: TWideStringField;
    FAT_SQ_M_PEXrev_lme: TWideStringField;
    FAT_SQ_M_PEXorigem: TIntegerField;
    FAT_SQ_M_PEXdispositivo: TWideStringField;
    FAT_SQ_M_PEXgps_latitude: TFloatField;
    FAT_SQ_M_PEXgps_longitude: TFloatField;
    FAT_SQ_M_PEXcubagem: TFloatField;
    FAT_SQ_M_PEXid_orcamento: TIntegerField;
    FAT_SQ_M_PEXenvia_carga: TBooleanField;
    FAT_SQ_M_PEXdta_prev_entrega: TDateField;
    FAT_SQ_M_PEXid_abertura: TIntegerField;
    FAT_SQ_M_PEXdias_cpg_prazo: TIntegerField;
    FAT_SQ_M_PEDoffline: TBooleanField;
    BUS_SQ_M_CSU_GER_PGF: TSQLDataSet;
    BUS_DP_M_CSU_GER_PGF: TDataSetProvider;
    FAT_SQ_M_PED_ITEqtde_conferida: TFloatField;
    FAT_SQ_M_PEXoffline: TBooleanField;
    BUS_SQ_M_CSU_GER_PGFtipo_reg: TWideMemoField;
    BUS_SQ_M_CSU_GER_PGFid_empresa: TIntegerField;
    BUS_SQ_M_CSU_GER_PGFemp_fantasia: TWideStringField;
    BUS_SQ_M_CSU_GER_PGFid_forma_pag: TIntegerField;
    BUS_SQ_M_CSU_GER_PGFint_nomefpg: TWideStringField;
    BUS_SQ_M_CSU_GER_PGFvlr_saldo_vencido: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFvlr_saldo_hoje: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFPrimeiro_mes: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFSegundo_mes: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFTereceiro_mes: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFQuarto_mes: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFQuinto_mes: TFMTBCDField;
    BUS_SQ_M_CSU_GER_PGFSexto_mes: TFMTBCDField;
    CAD_SQ_C_CLI_BCOarquivo: TBlobField;
    CAD_SQ_C_CLI_BCOnome_arquivo: TWideStringField;
    FAT_SQ_R_PVE_06: TSQLDataSet;
    FAT_DP_R_PVE_06: TDataSetProvider;
    FAT_SQ_M_PEDconferido: TBooleanField;
    FAT_SQ_M_PEDid_conf: TIntegerField;
    FAT_SQ_M_PEDdta_conf: TDateField;
    FAT_SQ_M_PEDhor_conf: TTimeField;
    FAT_SQ_M_PEDresultado_conf: TIntegerField;
    EST_SQ_M_MALid_opr: TIntegerField;
    EST_SQ_M_MALid_opr_req: TIntegerField;
    EST_SQ_M_MALhora: TTimeField;
    EST_SQ_M_MAL_ITEid_opr: TIntegerField;
    EST_SQ_M_MAL_ITEid_opr_req: TIntegerField;
    EST_SQ_M_MAL_ITEid_opr_req_ite: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITE: TSQLDataSet;
    BUS_DP_M_OPR_REQ_ITE: TDataSetProvider;
    BUS_SQ_M_OPR_REQ_ITEid_opr: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_opr_req: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_opr_req_ite: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_item: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_cor: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_tamanho: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEqtde: TFloatField;
    BUS_SQ_M_OPR_REQ_ITEqtde_atendida: TFloatField;
    BUS_SQ_M_OPR_REQ_ITEdta_canc: TDateField;
    BUS_SQ_M_OPR_REQ_ITEhor_canc: TTimeField;
    BUS_SQ_M_OPR_REQ_ITEid_funcionario_canc: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEsituacao: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_setor: TIntegerField;
    BUS_SQ_M_OPR_REQ_ITEid_busca_item: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEnum_lote: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEgerado_automatico: TBooleanField;
    BUS_SQ_M_OPR_REQ_ITEcancelado: TBooleanField;
    BUS_SQ_M_OPR_REQ_ITEint_nomeite: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_nomecor: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_nometam: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_nomefuncanc: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_undvenda: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_nomestr: TWideStringField;
    BUS_SQ_M_OPR_REQ_ITEint_saldo: TFloatField;
    BUS_SQ_M_OPR_REQ_ITEint_conferido: TFMTBCDField;
    CAD_SQ_C_CLI_EXT_ITEid_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_CLI_EXT_ITEint_nometme: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEid_item: TIntegerField;
    CAD_SQ_C_CLI_EXT_ITEint_nomeite: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEint_undvenda: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEid_cor: TIntegerField;
    CAD_SQ_C_CLI_EXT_ITEint_nomecor: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEid_tamanho: TIntegerField;
    CAD_SQ_C_CLI_EXT_ITEint_nometam: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEqtde: TFloatField;
    CAD_SQ_C_CLI_EXT_ITEqtde_devolvida: TFloatField;
    CAD_SQ_C_CLI_EXT_ITEint_qtde_liq: TFloatField;
    CAD_SQ_C_CLI_EXT_ITEvlr_bruto: TFMTBCDField;
    CAD_SQ_C_CLI_EXT_ITEvlr_desconto: TFMTBCDField;
    CAD_SQ_C_CLI_EXT_ITEvlr_liquido: TFMTBCDField;
    CAD_SQ_C_CLI_EXT_ITEid_grupo: TWideStringField;
    CAD_SQ_C_CLI_EXT_ITEint_nomegru: TWideStringField;
    FAT_SQ_M_PEDid_resp_conf: TIntegerField;
    FAT_SQ_M_PEDint_nome_rcn: TWideStringField;
    CAD_SQ_C_EQP: TSQLDataSet;
    CAD_DP_C_EQP: TDataSetProvider;
    CAD_SQ_C_EQPid_equipamento: TIntegerField;
    CAD_SQ_C_EQPdescricao: TWideStringField;
    CAD_SQ_C_EQPserial: TWideStringField;
    CAD_SQ_C_EQPmodelo: TWideStringField;
    CAD_SQ_C_EQPgarantia: TBooleanField;
    BUS_DP_M_PED: TDataSetProvider;
    BUS_SQ_M_PED: TSQLDataSet;
    BUS_SQ_M_PED_ITE: TSQLDataSet;
    BUS_SQ_M_PED_TIT: TSQLDataSet;
    BUS_DS_M_PED: TDataSource;
    BUS_SQ_M_PED_ITEint_seqitem: TIntegerField;
    BUS_SQ_M_PED_ITEid_pedido: TIntegerField;
    BUS_SQ_M_PED_ITEid_sequencia: TIntegerField;
    BUS_SQ_M_PED_ITEid_item: TIntegerField;
    BUS_SQ_M_PED_ITEqtde: TFloatField;
    BUS_SQ_M_PED_ITEvlr_unitario: TFMTBCDField;
    BUS_SQ_M_PED_ITEvlr_bruto: TFMTBCDField;
    BUS_SQ_M_PED_ITEper_desconto: TFloatField;
    BUS_SQ_M_PED_ITEvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PED_ITEvlr_liquido: TFMTBCDField;
    BUS_SQ_M_PED_ITEid_cor: TIntegerField;
    BUS_SQ_M_PED_ITEid_tamanho: TIntegerField;
    BUS_SQ_M_PED_ITEid_busca_item: TWideStringField;
    BUS_SQ_M_PED_ITEvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_PED_ITEper_desc_max: TFloatField;
    BUS_SQ_M_PED_ITEqtde_conferida: TFloatField;
    BUS_SQ_M_PED_ITEint_nomeite: TWideStringField;
    BUS_SQ_M_PED_ITEint_nomecor: TWideStringField;
    BUS_SQ_M_PED_ITEint_id_und_venda: TWideStringField;
    BUS_SQ_M_PED_ITEint_rua: TWideStringField;
    BUS_SQ_M_PED_ITEint_prateleira: TWideStringField;
    BUS_SQ_M_PED_ITEint_escaninho: TWideStringField;
    BUS_SQ_M_PED_ITEint_tipo_item: TWideStringField;
    BUS_SQ_M_PED_ITEint_nometam: TWideStringField;
    BUS_SQ_M_PED_TITid_pedido: TIntegerField;
    BUS_SQ_M_PED_TITid_titulo: TIntegerField;
    BUS_SQ_M_PED_TITdias: TIntegerField;
    BUS_SQ_M_PED_TITdta_vencimento: TDateField;
    BUS_SQ_M_PED_TITvlr_titulo: TFMTBCDField;
    BUS_SQ_M_PED_TITche_banco: TWideStringField;
    BUS_SQ_M_PED_TITche_agencia: TWideStringField;
    BUS_SQ_M_PED_TITche_conta: TIntegerField;
    BUS_SQ_M_PED_TITche_numero: TIntegerField;
    BUS_SQ_M_PED_TITche_emitente: TWideStringField;
    BUS_SQ_M_PED_TITid_forma_pag: TIntegerField;
    BUS_SQ_M_PED_TITbol_nosso_numero: TIntegerField;
    BUS_SQ_M_PED_TITid_maquineta: TIntegerField;
    BUS_SQ_M_PED_TITint_nomefpg: TWideStringField;
    BUS_SQ_M_PED_TITint_docimpresso: TIntegerField;
    FAT_SQ_M_NFEint_doc_ip: TWideMemoField;
    EST_SQ_M_FESint_sld_disponivel: TFMTBCDField;
    BUS_SQ_M_SLD_ITE: TSQLDataSet;
    BUS_DP_M_SLD_ITE: TDataSetProvider;
    PCP_SQ_M_OPR_OPPint_id_grupo: TWideStringField;
    PCP_SQ_M_OPR_OPPint_nomegru: TWideStringField;
    OFI_SQ_M_OCV_ITEnome_ite: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdre_perc_out_ded_ven: TFloatField;
    BUS_SQ_M_NFE_ITE_INTdre_perc_ircs: TFloatField;
    BUS_SQ_M_NFE_ITE_INTdta_vencimento: TDateField;
    BUS_SQ_M_NFE_ITE_INTdi_draw: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTdi_tp_viatransp: TIntegerField;
    BUS_SQ_M_NFE_ITE_INTdi_tp_intermedio: TIntegerField;
    CAD_SQ_C_PAR_CTRpath_remessa: TWideStringField;
    PCP_SQ_M_OPR_OPPgerado_aut: TBooleanField;
    PCP_SQ_M_OPR_OPPmotivo_ger_man: TWideStringField;
    PCP_SQ_M_OPR_OPPid_resp_man: TIntegerField;
    PCP_SQ_M_OPR_OPPdta_man: TDateField;
    PCP_SQ_M_OPR_OPPhor_man: TTimeField;
    PCP_SQ_M_OPR_OPPint_nomeresp_man: TWideStringField;
    OFI_SQ_M_OCVhor_orcamento: TTimeField;
    OFI_SQ_M_ORVhor_emissao: TTimeField;
    OFI_SQ_M_ORVhor_fechamento: TTimeField;
    CAD_SQ_C_CLIid_controle_fpg_hrq: TIntegerField;
    CAD_SQ_C_PAR_CTRativa_forma_fpg_hrq: TBooleanField;
    CAD_DP_C_HFG: TDataSetProvider;
    CAD_SQ_C_HFG: TSQLDataSet;
    CAD_SQ_C_HFGid_controle: TIntegerField;
    CAD_SQ_C_HFGnivel: TIntegerField;
    CAD_SQ_C_HFGid_forma_pag: TIntegerField;
    CAD_SQ_C_HFGint_nomefpg: TWideStringField;
    PCP_SQ_M_OPR_OPPid_busca_item: TWideStringField;
    BUS_SQ_M_OPR_OPP_INThistorico_alt: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTmotivo_alt: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTgerado_aut: TBooleanField;
    BUS_SQ_M_OPR_OPP_INTmotivo_ger_man: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTid_resp_man: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTdta_man: TDateField;
    BUS_SQ_M_OPR_OPP_INThor_man: TTimeField;
    BUS_SQ_M_OPR_OPP_INTid_busca_item: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTint_nomeres_man: TWideStringField;
    FAT_DP_R_PVE_07: TDataSetProvider;
    FAT_SQ_R_PVE_07: TSQLDataSet;
    CAD_SQ_C_CLI_PRD: TSQLDataSet;
    CAD_SQ_C_CLI_PRDid_cliente: TIntegerField;
    CAD_SQ_C_CLI_PRDid_sequencia: TIntegerField;
    CAD_SQ_C_CLI_PRDdias: TIntegerField;
    BUS_DP_C_CLI_PRD: TDataSetProvider;
    BUS_SQ_C_CLI_PRD: TSQLDataSet;
    CAD_SQ_C_CLIpermitir_alterar_dias_tit_ped: TBooleanField;
    FIN_SQ_M_BRD: TSQLDataSet;
    FIN_DP_M_BRD: TDataSetProvider;
    FIN_SQ_M_BRD_TIT: TSQLDataSet;
    FIN_DS_M_BRD: TDataSource;
    FIN_SQ_M_BRD_TITid_brd: TIntegerField;
    FIN_SQ_M_BRD_TITid_titulo: TIntegerField;
    FIN_SQ_M_BRD_TITvlr_pagamento: TFMTBCDField;
    FIN_SQ_M_BRD_TITvlr_juros: TFMTBCDField;
    FIN_SQ_M_BRD_TITvlr_desconto: TFMTBCDField;
    FIN_SQ_M_BRD_TITper_desconto: TFloatField;
    FIN_SQ_M_BRD_TITvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_BRD_TITvlr_restante: TFMTBCDField;
    FIN_SQ_M_BRD_TITdta_vencimento: TDateField;
    FIN_SQ_M_BRD_TITvlr_titulo: TFMTBCDField;
    FIN_SQ_M_BRD_TITnum_parcela: TWideStringField;
    FIN_SQ_M_BRD_TITvlr_multa: TFMTBCDField;
    FIN_SQ_M_BRD_TITatraso: TIntegerField;
    FIN_SQ_M_BRD_TITid_conta: TIntegerField;
    FIN_SQ_M_BRD_TITid_plano: TWideStringField;
    FIN_SQ_M_BRD_TITid_ccusto: TIntegerField;
    FIN_SQ_M_BRD_TITint_nomepct: TWideStringField;
    FIN_SQ_M_BRD_TITint_nomeccu: TWideStringField;
    FIN_SQ_M_BRDid_brd: TIntegerField;
    FIN_SQ_M_BRDid_empresa: TIntegerField;
    FIN_SQ_M_BRDdta_criacao: TDateField;
    FIN_SQ_M_BRDhor_criacao: TTimeField;
    FIN_SQ_M_BRDid_resp_criacao: TIntegerField;
    FIN_SQ_M_BRDdta_lib: TDateField;
    FIN_SQ_M_BRDhor_lib: TTimeField;
    FIN_SQ_M_BRDid_resp_lib: TIntegerField;
    FIN_SQ_M_BRDdta_bxa: TDateField;
    FIN_SQ_M_BRDhor_bxa: TTimeField;
    FIN_SQ_M_BRDid_resp_bxa: TIntegerField;
    FIN_SQ_M_BRDvlr_a_pagar: TFMTBCDField;
    FIN_SQ_M_BRDid_forma_pag: TIntegerField;
    FIN_SQ_M_BRDid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_BRDobs: TWideStringField;
    FIN_SQ_M_BRDid_conta: TIntegerField;
    FIN_SQ_M_BRDid_abertura: TIntegerField;
    FIN_SQ_M_BRDint_nomectc: TWideStringField;
    FIN_SQ_M_BRDint_nometif: TWideStringField;
    FIN_SQ_M_BRDint_nomefpg: TWideStringField;
    FIN_SQ_M_BRDcod_lme: TWideStringField;
    FIN_SQ_M_BRDrev_lme: TWideStringField;
    FIN_SQ_M_BRDint_nomeresp_cria: TWideStringField;
    FIN_SQ_M_BRDint_nomeresp_lib: TWideStringField;
    FIN_SQ_M_BRDint_nomeresp_bxa: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTint_novoreg: TWideStringField;
    CAD_SQ_C_MAR: TSQLDataSet;
    CAD_DP_C_MAR: TDataSetProvider;
    CAD_SQ_C_MARid_mar: TIntegerField;
    CAD_SQ_C_MARdescricao: TWideStringField;
    CAD_SQ_C_MARcod_lme: TWideStringField;
    CAD_SQ_C_MARrev_lme: TWideStringField;
    FIN_SQ_M_BRD_TITint_nomefor: TWideStringField;
    BUS_SQ_R_OCV_PROnome_ite: TWideStringField;
    BUS_SQ_R_OCV_SERnome_ite: TWideStringField;
    BUS_SQ_R_ORVstatus_painel: TIntegerField;
    BUS_SQ_R_ORVhor_emissao: TTimeField;
    BUS_SQ_R_ORVhor_fechamento: TTimeField;
    CAD_SQ_C_FUNexcluir_caixa: TBooleanField;
    FIS_SQ_R_LRE: TSQLDataSet;
    FIS_DP_R_LRE: TDataSetProvider;
    FIS_SQ_R_LRS: TSQLDataSet;
    FIS_DP_R_LRS: TDataSetProvider;
    FIS_SQ_R_LAI: TSQLDataSet;
    FIS_DP_R_LAI: TDataSetProvider;
    BUS_DP_C_ITE_EST_MPA: TDataSetProvider;
    BUS_SQ_C_ITE_EST_MPA: TSQLDataSet;
    BUS_DP_C_ITE_EST_VCM: TDataSetProvider;
    BUS_SQ_C_ITE_EST_VCM: TSQLDataSet;
    BUS_DP_C_ITE_EST_VVM: TDataSetProvider;
    BUS_SQ_C_ITE_EST_VVM: TSQLDataSet;
    BUS_DP_C_ITE_EST_SRH: TDataSetProvider;
    BUS_SQ_C_ITE_EST_SRH: TSQLDataSet;
    BUS_DP_C_ITE_EST_PFC: TDataSetProvider;
    BUS_SQ_C_ITE_EST_PFC: TSQLDataSet;
    BUS_DP_C_ITE_EST_MCV: TDataSetProvider;
    BUS_SQ_C_ITE_EST_MCV: TSQLDataSet;
    FIN_SQ_M_BRDliberado: TBooleanField;
    FIN_SQ_M_BRDbaixado: TBooleanField;
    FIN_SQ_M_BRDcancelado: TBooleanField;
    FIN_SQ_M_BRDid_resp_canc: TIntegerField;
    FIN_SQ_M_BRDdta_canc: TDateField;
    FIN_SQ_M_BRDint_nomeresp_can: TWideStringField;
    FAT_SQ_M_PED_ITEpcp_obs_item: TWideStringField;
    BUS_DS_M_PED_INT: TDataSource;
    BUS_SQ_M_PED_ITT_INT: TSQLDataSet;
    BUS_SQ_M_PED_INTid_pedido: TIntegerField;
    BUS_SQ_M_PED_INTid_empresa: TIntegerField;
    BUS_SQ_M_PED_INTdta_pedido: TDateField;
    BUS_SQ_M_PED_INTid_tipo_mov_estoque: TIntegerField;
    BUS_SQ_M_PED_INTid_vendedor: TIntegerField;
    BUS_SQ_M_PED_INTvlr_bruto: TFMTBCDField;
    BUS_SQ_M_PED_INTvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PED_INTper_desconto: TFloatField;
    BUS_SQ_M_PED_INTvlr_liquido: TFMTBCDField;
    BUS_SQ_M_PED_INThor_pedido: TSQLTimeStampField;
    BUS_SQ_M_PED_INTid_condicao_pag: TIntegerField;
    BUS_SQ_M_PED_INTpcp_id_opr: TIntegerField;
    BUS_SQ_M_PED_INTsituacao: TIntegerField;
    BUS_SQ_M_PED_INTsituacao_aprovacao: TIntegerField;
    BUS_SQ_M_PED_INTid_atendente: TIntegerField;
    BUS_SQ_M_PED_INTid_responsavel: TIntegerField;
    BUS_SQ_M_PED_INTid_cliente: TIntegerField;
    BUS_SQ_M_PED_INTtipo_restricao: TWideStringField;
    BUS_SQ_M_PED_INTid_almoxarifado: TIntegerField;
    BUS_SQ_M_PED_INTjustificativa: TWideStringField;
    BUS_SQ_M_PED_INTid_usuario_lib: TIntegerField;
    BUS_SQ_M_PED_INTcod_lme: TWideStringField;
    BUS_SQ_M_PED_INTrev_lme: TWideStringField;
    BUS_SQ_M_PED_INTorigem: TIntegerField;
    BUS_SQ_M_PED_INTdispositivo: TWideStringField;
    BUS_SQ_M_PED_INTgps_latitude: TFloatField;
    BUS_SQ_M_PED_INTgps_longitude: TFloatField;
    BUS_SQ_M_PED_INTcubagem: TFloatField;
    BUS_SQ_M_PED_INTid_orcamento: TIntegerField;
    BUS_SQ_M_PED_INTenvia_carga: TBooleanField;
    BUS_SQ_M_PED_INTdta_prev_entrega: TDateField;
    BUS_SQ_M_PED_INTid_abertura: TIntegerField;
    BUS_SQ_M_PED_INTdias_cpg_prazo: TIntegerField;
    BUS_SQ_M_PED_INToffline: TBooleanField;
    BUS_SQ_M_PED_INTconferido: TBooleanField;
    BUS_SQ_M_PED_INTid_conf: TIntegerField;
    BUS_SQ_M_PED_INTdta_conf: TDateField;
    BUS_SQ_M_PED_INThor_conf: TTimeField;
    BUS_SQ_M_PED_INTresultado_conf: TIntegerField;
    BUS_SQ_M_PED_INTid_resp_conf: TIntegerField;
    BUS_SQ_M_PED_ITT_INTid_pedido: TIntegerField;
    BUS_SQ_M_PED_ITT_INTid_sequencia: TIntegerField;
    BUS_SQ_M_PED_ITT_INTid_item: TIntegerField;
    BUS_SQ_M_PED_ITT_INTqtde: TFloatField;
    BUS_SQ_M_PED_ITT_INTvlr_unitario: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTvlr_bruto: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTper_desconto: TFloatField;
    BUS_SQ_M_PED_ITT_INTvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTvlr_liquido: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTid_cor: TIntegerField;
    BUS_SQ_M_PED_ITT_INTid_tamanho: TIntegerField;
    BUS_SQ_M_PED_ITT_INTid_busca_item: TWideStringField;
    BUS_SQ_M_PED_ITT_INTvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTper_desc_max: TFloatField;
    BUS_SQ_M_PED_ITT_INTqtde_conferida: TFloatField;
    BUS_SQ_M_PED_ITT_INTpcp_obs_item: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTobs_producao: TWideStringField;
    PCP_SQ_M_OPR_OPPobs_producao: TWideStringField;
    BUS_DP_M_RBX_TIT: TDataSetProvider;
    BUS_SQ_M_RBX_TIT: TSQLDataSet;
    FIN_SQ_M_RECdta_venc_original: TDateField;
    BUS_DP_M_BRD_TIT_INT: TDataSetProvider;
    BUS_SQ_M_BRD_TIT_INT: TSQLDataSet;
    FIN_SQ_M_CTAid_brd: TIntegerField;
    FIN_SQ_M_PAG_PAGid_brd: TIntegerField;
    CAD_SQ_C_FUNseg_hab_lib_brd: TBooleanField;
    FIN_SQ_M_BRD_TITint_id_fornecedor: TIntegerField;
    FIN_SQ_M_BRD_TITint_id_empresa: TIntegerField;
    CAD_SQ_C_FPGativa_red_parc_car_rec: TBooleanField;
    CAD_SQ_C_CLIint_nomevnd: TWideStringField;
    FIN_SQ_M_RECint_tit_vlr_alt: TBooleanField;
    CAD_SQ_C_MVEid_mar: TIntegerField;
    CAD_SQ_C_MVEint_nomemar: TWideStringField;
    CAD_SQ_C_MVEid_cat: TIntegerField;
    CAD_SQ_C_MVEint_nomecat: TWideStringField;
    CAD_SQ_C_ITE_CAT: TSQLDataSet;
    CAD_SQ_C_ITE_CATid_item: TIntegerField;
    CAD_SQ_C_ITE_CATid_cat: TIntegerField;
    CAD_SQ_C_ITE_CATpreco: TFMTBCDField;
    CAD_SQ_C_ITE_CATint_nomecat: TWideStringField;
    OFI_DP_C_CAT: TDataSetProvider;
    OFI_SQ_C_CAT: TSQLDataSet;
    OFI_SQ_C_CATid_cat: TIntegerField;
    OFI_SQ_C_CATdescricao: TWideStringField;
    OFI_SQ_C_CATcod_lme: TWideStringField;
    OFI_SQ_C_CATrev_lme: TWideStringField;
    FIN_SQ_R_ANV: TSQLDataSet;
    FIN_DP_R_ANV: TDataSetProvider;
    OFI_SQ_R_OFV_ABC_003: TSQLDataSet;
    OFI_DP_R_OFV_ABC_003: TDataSetProvider;
    BUS_DP_C_ITE_CAT: TDataSetProvider;
    BUS_SQ_C_ITE_CAT: TSQLDataSet;
    OFI_DP_R_FIV_VEI: TDataSetProvider;
    OFI_SQ_R_FIV_VEI: TSQLDataSet;
    OFI_SQ_R_FIV_ORV: TSQLDataSet;
    OFI_SQ_R_FIV_OCV: TSQLDataSet;
    OFI_SQ_R_FIV_POS: TSQLDataSet;
    OFI_SQ_R_FIV_VEIid_veiculo: TIntegerField;
    OFI_SQ_R_FIV_VEIid_placa: TWideStringField;
    OFI_SQ_R_FIV_VEIdescricao: TWideStringField;
    OFI_SQ_R_FIV_VEIid_mve: TIntegerField;
    OFI_SQ_R_FIV_VEIkm_aquisicao: TFloatField;
    OFI_SQ_R_FIV_VEIdta_aquisicao: TDateField;
    OFI_SQ_R_FIV_VEIkm_atual: TFloatField;
    OFI_SQ_R_FIV_VEIchassi: TWideStringField;
    OFI_SQ_R_FIV_VEIano_modelo: TWideStringField;
    OFI_SQ_R_FIV_VEIano_fabricacao: TWideStringField;
    OFI_SQ_R_FIV_VEIrenavam: TWideStringField;
    OFI_SQ_R_FIV_VEIalimentacao: TIntegerField;
    OFI_SQ_R_FIV_VEIcombustivel: TIntegerField;
    OFI_SQ_R_FIV_VEIserie: TWideStringField;
    OFI_SQ_R_FIV_VEImotor: TWideStringField;
    OFI_SQ_R_FIV_VEImotor_num: TWideStringField;
    OFI_SQ_R_FIV_VEIrastreado: TBooleanField;
    OFI_SQ_R_FIV_VEItipo: TIntegerField;
    OFI_SQ_R_FIV_VEIstatus: TIntegerField;
    OFI_SQ_R_FIV_VEIid_cor: TIntegerField;
    OFI_SQ_R_FIV_VEIcod_lme: TWideStringField;
    OFI_SQ_R_FIV_VEIrev_lme: TWideStringField;
    OFI_SQ_R_FIV_VEImedia_consumo: TFloatField;
    OFI_SQ_R_FIV_VEIeqp_terceiro: TBooleanField;
    OFI_SQ_R_FIV_VEItipo_rodado: TSmallintField;
    OFI_SQ_R_FIV_VEItipo_carroceria: TSmallintField;
    OFI_SQ_R_FIV_VEIcap_veiculo: TFloatField;
    OFI_SQ_R_FIV_VEItara: TFloatField;
    OFI_SQ_R_FIV_VEIuf_licenciado: TWideStringField;
    OFI_SQ_R_FIV_VEIint_alimentacao: TWideMemoField;
    OFI_SQ_R_FIV_VEIint_combustivel: TWideMemoField;
    OFI_SQ_R_FIV_VEIint_tipo: TWideMemoField;
    OFI_SQ_R_FIV_VEIint_tipo_rodado: TWideMemoField;
    OFI_SQ_R_FIV_VEIint_tipo_carroceria: TWideMemoField;
    OFI_DP_R_FIV_OCV: TDataSetProvider;
    OFI_DP_R_FIV_ORV: TDataSetProvider;
    OFI_DP_R_FIV_POS: TDataSetProvider;
    EST_SQ_R_ISM: TSQLDataSet;
    EST_DP_R_ISM: TDataSetProvider;
    CAD_SQ_C_PAR_NFEcod_lot_rps: TIntegerField;
    FAT_SQ_M_XMLvlr_outras: TFMTBCDField;
    FAT_SQ_M_XML_ITEvlr_outras: TFMTBCDField;
    CAD_SQ_C_PAR_NFEreg_esp_tri: TIntegerField;
    FIN_SQ_R_ANVsubstr: TWideMemoField;
    FIN_SQ_R_ANVint_mes_aniver: TWideMemoField;
    FIN_SQ_R_ANVint_ordem_aniver: TIntegerField;
    FIN_SQ_R_ANVid_cliente: TIntegerField;
    FIN_SQ_R_ANVnome: TWideStringField;
    FIN_SQ_R_ANVtel_fixo: TWideStringField;
    FIN_SQ_R_ANVint_celular: TWideStringField;
    FIN_SQ_R_ANVemail: TWideStringField;
    FIN_SQ_R_ANVdta_nascimento: TDateField;
    FIN_SQ_R_ANVid_perfil_cli: TIntegerField;
    FIN_SQ_R_ANVint_nomepec: TWideStringField;
    OFI_SQ_M_OCVcan_motivo: TWideStringField;
    OFI_SQ_M_OCVcan_data: TDateField;
    OFI_SQ_M_OCVcan_hora: TTimeField;
    OFI_SQ_M_OCVcan_usuario: TIntegerField;
    OFI_SQ_M_ORVsepara_prod_serv: TBooleanField;
    CAD_SQ_C_VEIint_id_cat: TIntegerField;
    CAD_SQ_C_VEIint_nomecat: TWideStringField;
    OFI_SQ_M_ORVid_equipamento: TIntegerField;
    OFI_SQ_M_ORVint_nomeeqp: TWideStringField;
    ctc_sq_m_bdevlr_combustivel: TFMTBCDField;
    ctc_sq_m_bdehori_total: TFloatField;
    ctc_sq_m_bdevlr_bruto: TFMTBCDField;
    ctc_sq_m_bdenro_bde: TIntegerField;
    PCP_SQ_C_MEQvlr_hora: TFMTBCDField;
    PCP_SQ_C_MEQvlr_comissao: TFMTBCDField;
    ctc_sq_m_bdeint_vlrhora: TFMTBCDField;
    ctc_sq_m_bdeint_vlrcomissao: TFMTBCDField;
    OFI_SQ_R_FIV_VEIint_nomecor: TWideStringField;
    OFI_SQ_R_FIV_VEIint_nomemve: TWideStringField;
    CAD_SQ_C_PAR_MODoqp: TBooleanField;
    BUS_SQ_R_ORVsepara_prod_serv: TBooleanField;
    BUS_SQ_R_ORVid_equipamento: TIntegerField;
    BUS_SQ_R_ORVint_nomeeqp: TWideStringField;
    BUS_SQ_R_ORVint_modeloeqp: TWideStringField;
    BUS_SQ_R_ORVint_serialeqp: TWideStringField;
    BUS_SQ_R_ORVint_garantiaeqp: TBooleanField;
    ctc_sq_m_bde_oco: TSQLDataSet;
    ctc_sq_m_bde_ocoid_bde: TIntegerField;
    ctc_sq_m_bde_ocoid_ocorrencia: TIntegerField;
    ctc_sq_m_bde_ocoqtde: TFloatField;
    ctc_sq_m_bde_ocoint_nomeoco: TWideStringField;
    ctc_ds_m_bde: TDataSource;
    ctc_sq_c_oco: TSQLDataSet;
    ctc_dp_c_oco: TDataSetProvider;
    OFI_SQ_R_OFV_POS_002: TSQLDataSet;
    OFI_SQ_R_OFV_POS_002id_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_002dta_emissao: TDateField;
    OFI_SQ_R_OFV_POS_002id_cliente: TIntegerField;
    OFI_SQ_R_OFV_POS_002int_nomecli: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_nomeana: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_nomecpg: TWideStringField;
    OFI_SQ_R_OFV_POS_002id_veiculo: TIntegerField;
    OFI_SQ_R_OFV_POS_002int_placa: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_nomevei: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_nometio: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_orvsituacao: TWideStringField;
    OFI_SQ_R_OFV_POS_002dta_entrega: TDateField;
    OFI_SQ_R_OFV_POS_002can_data: TDateField;
    OFI_SQ_R_OFV_POS_002can_motivo: TWideStringField;
    OFI_SQ_R_OFV_POS_002vlr_despesas: TFMTBCDField;
    OFI_SQ_R_OFV_POS_002dta_emissao_1: TDateField;
    OFI_SQ_R_OFV_POS_002int_atraso: TIntegerField;
    OFI_SQ_R_OFV_POS_002vlr_liquido_ser: TFMTBCDField;
    OFI_SQ_R_OFV_POS_002vlr_liquido_pro: TFMTBCDField;
    OFI_SQ_R_OFV_POS_002vlr_total_sem_desp: TFMTBCDField;
    OFI_SQ_R_OFV_POS_002vlr_total_com_desp: TFMTBCDField;
    OFI_SQ_R_OFV_POS_002id_analista: TIntegerField;
    OFI_DP_R_OFV_POS_002: TDataSetProvider;
    OFI_SQ_R_OFV_POS_003: TSQLDataSet;
    WideStringField152: TWideStringField;
    IntegerField128: TIntegerField;
    DateField27: TDateField;
    IntegerField129: TIntegerField;
    WideStringField153: TWideStringField;
    WideStringField154: TWideStringField;
    WideStringField155: TWideStringField;
    IntegerField130: TIntegerField;
    WideStringField156: TWideStringField;
    WideStringField157: TWideStringField;
    IntegerField131: TIntegerField;
    WideStringField162: TWideStringField;
    WideStringField163: TWideStringField;
    DateField28: TDateField;
    DateField29: TDateField;
    WideStringField164: TWideStringField;
    FMTBCDField102: TFMTBCDField;
    DateField30: TDateField;
    IntegerField132: TIntegerField;
    FMTBCDField103: TFMTBCDField;
    FMTBCDField104: TFMTBCDField;
    FMTBCDField105: TFMTBCDField;
    FMTBCDField107: TFMTBCDField;
    IntegerField133: TIntegerField;
    OFI_DP_R_OFV_POS_003: TDataSetProvider;
    CAD_SQ_C_PCTcod_contabil: TWideStringField;
    BUS_SQ_R_RQVint_nomeeqp: TWideStringField;
    EST_SQ_M_MAL_ITEint_cod_barra: TWideStringField;
    EST_SQ_M_MAL_ITEint_cod_fabrica: TWideStringField;
    BUS_SQ_M_REC: TSQLDataSet;
    BUS_SQ_M_RECid_titulo: TIntegerField;
    BUS_SQ_M_RECid_empresa: TIntegerField;
    BUS_SQ_M_RECid_cliente: TIntegerField;
    BUS_SQ_M_RECnum_parcela: TWideStringField;
    BUS_SQ_M_RECdta_emissao: TDateField;
    BUS_SQ_M_REChistorico: TWideStringField;
    BUS_SQ_M_RECvlr_parcela: TFMTBCDField;
    BUS_SQ_M_RECvlr_original: TFMTBCDField;
    BUS_SQ_M_RECdta_vencimento: TDateField;
    BUS_SQ_M_RECdta_original: TDateField;
    BUS_SQ_M_RECvlr_saldo: TFMTBCDField;
    BUS_SQ_M_RECid_fiscal: TIntegerField;
    BUS_SQ_M_RECorigem: TIntegerField;
    BUS_SQ_M_RECid_forma_pag: TIntegerField;
    BUS_SQ_M_RECche_conta: TIntegerField;
    BUS_SQ_M_RECche_cheque: TIntegerField;
    BUS_SQ_M_RECche_banco: TWideStringField;
    BUS_SQ_M_RECche_emitente: TWideStringField;
    BUS_SQ_M_RECche_agencia: TWideStringField;
    BUS_SQ_M_RECtipo_lancamento: TIntegerField;
    BUS_SQ_M_RECid_local_titulo: TIntegerField;
    BUS_SQ_M_RECid_plano: TWideStringField;
    BUS_SQ_M_RECbol_nosso_numero: TWideStringField;
    BUS_SQ_M_RECcar_taxa: TFloatField;
    BUS_SQ_M_RECcar_motivo_can: TWideStringField;
    BUS_SQ_M_RECcar_dta_can: TDateField;
    BUS_SQ_M_RECcod_lme: TWideStringField;
    BUS_SQ_M_RECrev_lme: TWideStringField;
    BUS_SQ_M_RECint_nomecli: TWideStringField;
    BUS_SQ_M_RECint_nomefpg: TWideStringField;
    BUS_SQ_M_RECint_nomelto: TWideStringField;
    BUS_SQ_M_RECint_nomepct: TWideStringField;
    BUS_SQ_M_RECint_nomeemp: TWideStringField;
    BUS_SQ_M_RECseq_nosso_numero: TIntegerField;
    BUS_SQ_M_RECint_numeronf: TIntegerField;
    BUS_SQ_M_RECbol_chave: TIntegerField;
    BUS_SQ_M_RECbol_id_conta: TIntegerField;
    BUS_SQ_M_RECcar_taxa_ope: TFloatField;
    BUS_SQ_M_RECcar_n_lote_id_resp: TIntegerField;
    BUS_SQ_M_RECcar_n_lote_id_conta: TIntegerField;
    BUS_SQ_M_RECid_baixa: TIntegerField;
    BUS_SQ_M_RECcar_n_lote: TWideStringField;
    BUS_SQ_M_RECint_selecao: TBooleanField;
    BUS_SQ_M_RECsituacao_chq: TIntegerField;
    BUS_SQ_M_RECid_mch: TIntegerField;
    BUS_SQ_M_RECid_vendedor: TIntegerField;
    BUS_SQ_M_RECcar_id_maquineta: TIntegerField;
    BUS_SQ_M_RECid_credito: TIntegerField;
    BUS_SQ_M_RECint_nomectcbol: TWideStringField;
    BUS_SQ_M_RECint_descorigem: TWideStringField;
    BUS_SQ_M_RECint_atraso: TIntegerField;
    BUS_SQ_M_RECint_vlr_corrigido: TFloatField;
    BUS_SQ_M_RECint_vlr_juros: TFloatField;
    BUS_SQ_M_RECint_numpedvenda: TIntegerField;
    BUS_SQ_M_RECbol_banco: TIntegerField;
    BUS_SQ_M_RECint_docimpresso: TIntegerField;
    BUS_DP_M_REC: TDataSetProvider;
    BUS_DS_M_REC: TDataSource;
    BUS_SQ_M_REC_FAT: TSQLDataSet;
    BUS_SQ_M_REC_FATid_fiscal: TIntegerField;
    BUS_SQ_M_REC_FATid_item: TIntegerField;
    BUS_SQ_M_REC_FATqtde: TFloatField;
    BUS_SQ_M_REC_FATvlr_unitario: TFMTBCDField;
    BUS_SQ_M_REC_FATvlr_desconto: TFMTBCDField;
    BUS_SQ_M_REC_FATvlr_liquido: TFMTBCDField;
    BUS_SQ_M_REC_FATint_desc_item: TWideStringField;
    BUS_SQ_M_REC_FATint_und_venda: TWideStringField;
    BUS_SQ_M_REC_FATint_tipo_item: TIntegerField;
    BUS_SQ_M_REC_FATint_nomecor: TWideStringField;
    BUS_SQ_M_REC_FATint_nometam: TWideStringField;
    BUS_SQ_M_REC_FATint_id_ncm: TWideStringField;
    BUS_SQ_M_REC_FATdta_emissao: TDateField;
    BUS_SQ_M_REC_FATnumero: TIntegerField;
    BUS_SQ_M_REC_PAG: TSQLDataSet;
    BUS_SQ_M_REC_PAGid_titulo: TIntegerField;
    BUS_SQ_M_REC_PAGid_baixa: TIntegerField;
    BUS_SQ_M_REC_PAGdta_pagamento: TDateField;
    BUS_SQ_M_REC_PAGvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_REC_PAGper_juros: TFMTBCDField;
    BUS_SQ_M_REC_PAGvlr_juros: TFMTBCDField;
    BUS_SQ_M_REC_PAGvlr_desconto: TFMTBCDField;
    BUS_SQ_M_REC_PAGhistorico: TWideStringField;
    BUS_SQ_M_REC_PAGid_forma_pag: TIntegerField;
    BUS_SQ_M_REC_PAGid_plano: TWideStringField;
    BUS_SQ_M_REC_PAGid_plano_juros: TWideStringField;
    BUS_SQ_M_REC_PAGchp_id_situacao_chq: TIntegerField;
    BUS_SQ_M_REC_PAGchp_vlr_anterior: TFMTBCDField;
    BUS_SQ_M_REC_PAGid_alinea: TWideStringField;
    BUS_SQ_M_REC_PAGchp_tipo_ocorrencia: TWideStringField;
    BUS_SQ_M_REC_PAGid_responsavel: TIntegerField;
    BUS_SQ_M_REC_PAGcom_substituicao: TBooleanField;
    BUS_SQ_M_REC_PAGint_nomefpg: TWideStringField;
    BUS_SQ_M_REC_PAGint_nomeresp: TWideStringField;
    BUS_SQ_M_REC_PAGid_ccusto: TIntegerField;
    BUS_SQ_M_REC_PAGid_plano_desconto: TWideStringField;
    BUS_SQ_M_REC_PAGid_fiscal: TIntegerField;
    BUS_SQ_M_REC_PAGorigem: TIntegerField;
    BUS_SQ_M_REC_PAGid_abertura: TIntegerField;
    BUS_SQ_M_REC_PAGvlr_cred_utilizado: TFMTBCDField;
    BUS_SQ_M_REC_PAGid_mch: TIntegerField;
    BUS_SQ_M_REC_PAGid_cbx: TIntegerField;
    BUS_SQ_M_REC_PAGint_obs_rbx: TWideStringField;
    BUS_SQ_M_REC_PAGvlr_acrescimo: TFMTBCDField;
    BUS_SQ_M_REC_PAGbol_nome_arq_ret: TWideStringField;
    BUS_SQ_R_ORV_TIT_SER: TSQLDataSet;
    IntegerField134: TIntegerField;
    IntegerField176: TIntegerField;
    IntegerField177: TIntegerField;
    DateField31: TDateField;
    FMTBCDField108: TFMTBCDField;
    WideStringField165: TWideStringField;
    WideStringField166: TWideStringField;
    IntegerField178: TIntegerField;
    IntegerField179: TIntegerField;
    WideStringField167: TWideStringField;
    IntegerField180: TIntegerField;
    WideStringField168: TWideStringField;
    ctc_ds_c_tpr_ite: TDataSource;
    ctc_sq_c_tpr_ite_com: TSQLDataSet;
    ctc_sq_c_tpr_ite_comid_tpr: TIntegerField;
    ctc_sq_c_tpr_ite_comid_item: TWideStringField;
    ctc_sq_c_tpr_ite_comid_item_comp: TWideStringField;
    ctc_sq_c_tpr_ite_comqtde: TFloatField;
    ctc_sq_c_tpr_iteint_nomeite: TWideStringField;
    CAD_SQ_C_FORcod_fab_danfe: TBooleanField;
    FAT_SQ_M_NFE_ITEint_cod_fabrica: TWideStringField;
    FAT_SQ_M_NFE_ITEint_cod_fab_danfe: TBooleanField;
    CAD_SQ_C_PAR_CTRid_tif_deb: TIntegerField;
    CAD_SQ_C_PAR_CTRid_tif_cre: TIntegerField;
    CAD_SQ_C_PAR_NFEcod_tri_mcp: TWideStringField;
    CAD_SQ_C_PAR_NFEcod_ite_ser: TWideStringField;
    CAD_DP_C_CUL: TDataSetProvider;
    CAD_SQ_C_CUL: TSQLDataSet;
    CAD_SQ_C_CULid_cultura: TIntegerField;
    CAD_SQ_C_CULdescricao: TWideStringField;
    FAT_SQ_M_PED_ITEid_cultura: TIntegerField;
    FAT_SQ_M_PED_ITEint_nomecul: TWideStringField;
    CAD_SQ_C_ITE_CUL: TSQLDataSet;
    CAD_SQ_C_ITE_CULid_item: TIntegerField;
    CAD_SQ_C_ITE_CULid_cultura: TIntegerField;
    CAD_SQ_C_ITE_CULobs: TWideStringField;
    CAD_SQ_C_ITE_CULint_nomecul: TWideStringField;
    BUS_DP_C_ITE_CUL: TDataSetProvider;
    BUS_SQ_C_ITE_CUL: TSQLDataSet;
    CAD_SQ_C_CLI_PRO: TSQLDataSet;
    CAD_SQ_C_CLI_PROid_cliente: TIntegerField;
    CAD_SQ_C_CLI_PROid_propriedade: TIntegerField;
    CAD_SQ_C_CLI_PROtipo: TIntegerField;
    CAD_SQ_C_CLI_PROnome: TWideStringField;
    CAD_SQ_C_CLI_PRObairro: TWideStringField;
    CAD_SQ_C_CLI_PROid_cidade: TWideStringField;
    CAD_SQ_C_CLI_PROdoc_ip: TWideStringField;
    CAD_SQ_C_CLI_PROdoc_incra: TWideStringField;
    CAD_SQ_C_CLI_PROdoc_cnpj: TWideStringField;
    CAD_SQ_C_CLI_PROdoc_ie: TWideStringField;
    CAD_SQ_C_CLI_PROadministrador: TWideStringField;
    CAD_SQ_C_CLI_PROendereco: TWideStringField;
    CAD_SQ_C_CLI_PROcep: TWideStringField;
    CAD_SQ_C_CLI_PROnumero: TWideStringField;
    CAD_SQ_C_CLI_PROint_nomecid: TWideStringField;
    CAD_SQ_C_CLI_PROint_uf: TWideStringField;
    CAD_SQ_C_CLI_PROint_desc_tipo: TWideStringField;
    CAD_SQ_C_TMEcfo_exterior_pf: TWideStringField;
    CAD_SQ_C_TMEcfo_exterior_pj: TWideStringField;
    ctc_sq_c_tpr_ite_comint_nomeitetpr: TWideStringField;
    CAD_SQ_C_FUNseg_vis_custo_csu_ite: TBooleanField;
    CAD_SQ_C_PAR_CTRavf_peso_01: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_02: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_03: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_04: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_05: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_06: TFloatField;
    CAD_SQ_C_PAR_CTRavf_peso_07: TFloatField;
    BUS_DP_C_CLI_PRO: TDataSetProvider;
    BUS_SQ_C_CLI_PRO: TSQLDataSet;
    FAT_SQ_M_PEDid_propriedade: TIntegerField;
    FIN_SQ_M_PBXint_nomepct: TWideStringField;
    ACE_DP_R_CLI: TDataSetProvider;
    ACE_SQ_R_CLI: TSQLDataSet;
    CAD_SQ_C_ITE_COJ: TSQLDataSet;
    CAD_SQ_C_ITE_COJid_item: TIntegerField;
    CAD_SQ_C_ITE_COJid_item_conjugado: TIntegerField;
    CAD_SQ_C_ITE_COJqtde: TFloatField;
    CAD_SQ_C_ITE_COJint_nomeite_coj: TWideStringField;
    CAD_SQ_C_ITE_COJint_und_coj: TWideStringField;
    CAD_SQ_C_PAR_CTRativa_ite_conj: TBooleanField;
    CAD_SQ_C_ITE_COJid_busca_item: TWideStringField;
    BUS_DP_R_CTE_ITE_NCT: TDataSetProvider;
    BUS_SQ_R_CTE_ITE_NCT: TSQLDataSet;
    SQ_BR_PREVENDAnumprevenda: TIntegerField;
    SQ_BR_PREVENDAdata_cad: TDateField;
    SQ_BR_PREVENDAdata_emissao: TDateField;
    SQ_BR_PREVENDAvendedor: TWideStringField;
    SQ_BR_PREVENDAplano: TWideStringField;
    SQ_BR_PREVENDAid_cliente: TWideStringField;
    SQ_BR_PREVENDAnumloja: TWideStringField;
    SQ_BR_PREVENDAcancelado: TWideStringField;
    SQ_BR_PREVENDAn_cupom: TIntegerField;
    SQ_BR_PREVENDAserial: TWideStringField;
    SQ_BR_PREVENDAcontrz: TIntegerField;
    SQ_BR_PREVENDAcpf_cnpj: TWideStringField;
    SQ_BR_PREVENDAendereco: TWideStringField;
    SQ_BR_PREVENDAnome: TWideStringField;
    SQ_BR_PREVENDAbairro: TWideStringField;
    SQ_BR_PREVENDAcidade: TWideStringField;
    SQ_BR_PREVENDAcep: TWideStringField;
    SQ_BR_PREVENDAuf: TWideStringField;
    SQ_BR_PREVENDAfone1: TWideStringField;
    SQ_BR_PREVENDAfone2: TWideStringField;
    SQ_BR_PREVENDAemail: TWideStringField;
    SQ_BR_PREVENDAdesconto: TFMTBCDField;
    SQ_BR_PREVENDAacrescimo: TFMTBCDField;
    SQ_BR_PREVENDAflag_liberado: TWideStringField;
    SQ_BR_PREVENDAusuario_lib: TWideStringField;
    SQ_BR_PREVENDAdthora_lib: TDateField;
    SQ_BR_PREVENDAtipo: TWideStringField;
    SQ_BR_PREVENDAserialpv: TWideStringField;
    SQ_BR_PREVENDAflag_aceito: TWideStringField;
    SQ_BR_PREVENDAflag_sis: TWideStringField;
    SQ_BR_PREVENDAdav_impresso: TWideStringField;
    SQ_BR_PREVENDAmesa: TWideStringField;
    SQ_BR_PREVENDAconferencia: TWideStringField;
    SQ_BR_PREVENDAcaixa_conf: TIntegerField;
    SQ_BR_PREVENDAcoo_conf: TIntegerField;
    SQ_BR_PREVENDAcer_conf: TIntegerField;
    SQ_BR_PREVENDAdata_abertura: TDateField;
    SQ_BR_PREVENDAplaca: TWideStringField;
    SQ_BR_PREVENDArenavan: TWideStringField;
    SQ_BR_PREVENDAano: TWideStringField;
    SQ_BR_PREVENDAmarca: TWideStringField;
    SQ_BR_PREVENDAmodelo: TWideStringField;
    SQ_BR_PREVENDAccf: TIntegerField;
    BUS_DP_C_ITE_COJ: TDataSetProvider;
    BUS_SQ_C_ITE_COJ: TSQLDataSet;
    BUS_SQ_C_PAR_CTRativa_ite_conj: TBooleanField;
    EST_SQ_M_FEAid_coj_ite: TIntegerField;
    FAT_SQ_M_NFEid_ccusto: TIntegerField;
    FAT_SQ_M_NFEint_desc_ccu: TWideStringField;
    CAD_SQ_C_ITEcusto_servico: TFMTBCDField;
    FAT_SQ_M_NFEdi_estrangeiro: TWideStringField;
    CAD_SQ_C_PAR_NFEpath_xml_outros: TWideStringField;
    BUS_SQ_M_REC_PAGint_observacoes: TWideStringField;
    CAD_SQ_C_FUNseg_zerar_est: TBooleanField;
    EST_SQ_M_MALint_nomealm_dest: TWideStringField;
    CAD_SQ_C_CLI_INFdta_ult_compra: TDateField;
    CAD_SQ_C_CLI_INFvlr_ult_compra: TFMTBCDField;
    FIN_SQ_M_PAGdta_lancamento: TDateField;
    EST_SQ_M_MALid_ccusto: TIntegerField;
    BUS_SQ_M_CSU_CMP_ITE: TSQLDataSet;
    BUS_DP_M_CSU_CMP_ITE: TDataSetProvider;
    FAT_DP_R_PVE_08: TDataSetProvider;
    FAT_SQ_R_PVE_08: TSQLDataSet;
    EST_SQ_M_CTEcorrigir_custo_medio: TBooleanField;
    EST_SQ_M_CTE_ITEdta_vencimento: TDateField;
    FAT_SQ_M_MKT: TSQLDataSet;
    FAT_DP_M_MKT: TDataSetProvider;
    FAT_DS_M_MKT: TDataSource;
    FAT_SQ_M_MKTid_mkt: TIntegerField;
    FAT_SQ_M_MKTdta_criacao: TDateField;
    FAT_SQ_M_MKThor_criacao: TTimeField;
    FAT_SQ_M_MKTid_responsavel: TIntegerField;
    FAT_SQ_M_MKTid_rota: TIntegerField;
    FAT_SQ_M_MKTid_empresa: TIntegerField;
    FAT_SQ_M_MKTint_nomeresp: TWideStringField;
    FAT_SQ_M_MKTint_nomerot: TWideStringField;
    FAT_SQ_M_MKTint_nomefan: TWideStringField;
    FAT_SQ_M_MKT_CLI: TSQLDataSet;
    FAT_SQ_M_MKT_CLIid_mkt: TIntegerField;
    FAT_SQ_M_MKT_CLIid_cliente: TIntegerField;
    FAT_SQ_M_MKT_CLIdta_gravacao: TDateField;
    FAT_SQ_M_MKT_CLIhor_gravacao: TTimeField;
    FAT_SQ_M_MKT_CLIobs: TWideStringField;
    FAT_SQ_M_MKT_CLIint_nomecli: TWideStringField;
    FAT_SQ_M_MKTcod_lme: TWideStringField;
    FAT_SQ_M_MKTrev_lme: TWideStringField;
    FAT_SQ_M_MKT_CLIint_fantasiacli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_telfixocli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_telmovelcli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_endercli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_bairrocli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_idcidadecli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_nomecidcli: TWideStringField;
    FAT_SQ_M_MKT_CLIint_ufcidcli: TWideStringField;
    CAD_SQ_C_PAR_CTRped_utiliza_frete: TBooleanField;
    FAT_SQ_M_PEDmod_frete: TIntegerField;
    FAT_SQ_M_PEDvlr_frete: TFMTBCDField;
    FAT_SQ_M_MKT_CLIselecao: TBooleanField;
    CAD_DP_C_MTV: TDataSetProvider;
    CAD_SQ_C_MTV: TSQLDataSet;
    CAD_DS_C_MTV: TDataSource;
    CAD_SQ_C_MTV_MES: TSQLDataSet;
    CAD_SQ_C_MTVid_vendedor: TIntegerField;
    CAD_SQ_C_MTVano: TIntegerField;
    CAD_SQ_C_MTVid_grupo_prod: TIntegerField;
    CAD_SQ_C_MTVid_mtv: TIntegerField;
    CAD_SQ_C_SEQ: TSQLDataSet;
    CAD_DP_C_SEQ: TDataSetProvider;
    FAT_SQ_M_PEDid_mkt: TIntegerField;
    CAD_SQ_C_MTV_MESid_mtv: TIntegerField;
    CAD_SQ_C_MTV_MESqtde_mes_01: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_01: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_02: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_02: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_03: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_03: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_04: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_04: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_05: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_05: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_06: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_06: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_07: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_07: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_08: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_08: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_09: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_09: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_10: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_10: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_11: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_11: TFMTBCDField;
    CAD_SQ_C_MTV_MESqtde_mes_12: TFloatField;
    CAD_SQ_C_MTV_MESvalor_mes_12: TFMTBCDField;
    CAD_DP_C_GRP: TDataSetProvider;
    CAD_SQ_C_GRP: TSQLDataSet;
    CAD_SQ_C_GRPid_codigo: TIntegerField;
    CAD_SQ_C_GRPdescricao: TWideStringField;
    CAD_SQ_C_MTVint_nomegrp: TWideStringField;
    CAD_SQ_C_ITEid_grupo_prod: TIntegerField;
    CAD_SQ_C_ITEint_nomegrp: TWideStringField;
    CAD_SQ_C_MTVint_nomefun: TWideStringField;
    BUS_DP_C_CSU_MTV_HST: TDataSetProvider;
    BUS_SQ_C_CSU_MTV_HST: TSQLDataSet;
    FAT_SQ_M_MKT_CLIid_banco_info: TIntegerField;
    OFI_SQ_M_OCVtipo_orcamento: TIntegerField;
    OFI_SQ_M_OCVchassi: TWideStringField;
    BUS_SQ_R_OCVtipo_orcamento: TIntegerField;
    BUS_SQ_R_OCVchassi: TWideStringField;
    OFI_DP_R_HIV: TDataSetProvider;
    OFI_SQ_R_HIV: TSQLDataSet;
    OFI_DS_R_HIV: TDataSource;
    OFI_SQ_R_HIV_PRO: TSQLDataSet;
    OFI_SQ_R_HIV_SER: TSQLDataSet;
    OFI_SQ_R_HIVid_ordem: TIntegerField;
    OFI_SQ_R_HIVid_empresa: TIntegerField;
    OFI_SQ_R_HIVdta_emissao: TDateField;
    OFI_SQ_R_HIVdta_entrega: TDateField;
    OFI_SQ_R_HIVid_cliente: TIntegerField;
    OFI_SQ_R_HIVid_veiculo: TIntegerField;
    OFI_SQ_R_HIVkm_atual: TIntegerField;
    OFI_SQ_R_HIVtanque_combus: TIntegerField;
    OFI_SQ_R_HIVid_forma_pag: TIntegerField;
    OFI_SQ_R_HIVid_condicao_pag: TIntegerField;
    OFI_SQ_R_HIVid_analista: TIntegerField;
    OFI_SQ_R_HIVid_orcamento: TIntegerField;
    OFI_SQ_R_HIVobs_reclamacao: TWideStringField;
    OFI_SQ_R_HIVobs_problema: TWideStringField;
    OFI_SQ_R_HIVstatus: TIntegerField;
    OFI_SQ_R_HIVvlr_produtos: TFMTBCDField;
    OFI_SQ_R_HIVvlr_desc_produtos: TFMTBCDField;
    OFI_SQ_R_HIVper_desc_produtos: TFloatField;
    OFI_SQ_R_HIVvlr_prod_liquido: TFMTBCDField;
    OFI_SQ_R_HIVvlr_serv_bruto: TFMTBCDField;
    OFI_SQ_R_HIVvlr_desc_servicos: TFMTBCDField;
    OFI_SQ_R_HIVper_desc_servicos: TFloatField;
    OFI_SQ_R_HIVvlr_ser_liquido: TFMTBCDField;
    OFI_SQ_R_HIVvlr_terceiro: TFMTBCDField;
    OFI_SQ_R_HIVvlr_desc_terceiro: TFMTBCDField;
    OFI_SQ_R_HIVper_desc_terceiro: TFloatField;
    OFI_SQ_R_HIVvlr_terc_liquido: TFMTBCDField;
    OFI_SQ_R_HIVvlr_despesas: TFMTBCDField;
    OFI_SQ_R_HIVvlr_credito: TFMTBCDField;
    OFI_SQ_R_HIVvlr_total: TFMTBCDField;
    OFI_SQ_R_HIVid_tipo_os: TIntegerField;
    OFI_SQ_R_HIVid_responsavel: TIntegerField;
    OFI_SQ_R_HIVcan_usuario: TIntegerField;
    OFI_SQ_R_HIVcan_data: TDateField;
    OFI_SQ_R_HIVcan_motivo: TWideStringField;
    OFI_SQ_R_HIVcan_hora: TTimeField;
    OFI_SQ_R_HIVrea_usuario: TIntegerField;
    OFI_SQ_R_HIVrea_data: TDateField;
    OFI_SQ_R_HIVrea_hora: TTimeField;
    OFI_SQ_R_HIVrea_motivo: TWideStringField;
    OFI_SQ_R_HIVdta_fechamento: TDateField;
    OFI_SQ_R_HIVid_almoxarifado: TIntegerField;
    OFI_SQ_R_HIVvlr_cred_produtos: TFMTBCDField;
    OFI_SQ_R_HIVvlr_cred_servicos: TFMTBCDField;
    OFI_SQ_R_HIVobservacoes: TWideStringField;
    OFI_SQ_R_HIVstatus_painel: TIntegerField;
    OFI_SQ_R_HIVhor_emissao: TTimeField;
    OFI_SQ_R_HIVhor_fechamento: TTimeField;
    OFI_SQ_R_HIVsepara_prod_serv: TBooleanField;
    OFI_SQ_R_HIVid_equipamento: TIntegerField;
    OFI_SQ_R_HIVint_nomecli: TWideStringField;
    OFI_SQ_R_HIVint_telfix: TWideStringField;
    OFI_SQ_R_HIVint_telmov: TWideStringField;
    OFI_SQ_R_HIVint_cnpjcpfcli: TWideStringField;
    OFI_SQ_R_HIVint_enderecocli: TWideStringField;
    OFI_SQ_R_HIVint_bairrocli: TWideStringField;
    OFI_SQ_R_HIVint_cepcli: TWideStringField;
    OFI_SQ_R_HIVint_nomecid: TWideStringField;
    OFI_SQ_R_HIVint_ufcid: TWideStringField;
    OFI_SQ_R_HIVint_numerocli: TWideStringField;
    OFI_SQ_R_HIVint_nomecom: TWideMemoField;
    OFI_SQ_R_HIVint_placa: TWideStringField;
    OFI_SQ_R_HIVint_nomevei: TWideStringField;
    OFI_SQ_R_HIVint_chassivei: TWideStringField;
    OFI_SQ_R_HIVint_anomodelo: TWideStringField;
    OFI_SQ_R_HIVint_anofabric: TWideStringField;
    OFI_SQ_R_HIVint_motorvei: TWideStringField;
    OFI_SQ_R_HIVint_modelomve: TWideStringField;
    OFI_SQ_R_HIVint_nomecor: TWideStringField;
    OFI_SQ_R_HIVint_nometio: TWideStringField;
    OFI_SQ_R_HIVint_nomecpg: TWideStringField;
    OFI_SQ_R_HIVint_nomeana: TWideStringField;
    OFI_SQ_R_HIVint_nomeeqp: TWideStringField;
    OFI_SQ_R_HIVint_modeloeqp: TWideStringField;
    OFI_SQ_R_HIVint_serialeqp: TWideStringField;
    OFI_SQ_R_HIVint_garantiaeqp: TBooleanField;
    OFI_SQ_R_HIV_SERid_ordem: TIntegerField;
    OFI_SQ_R_HIV_SERid_cor: TIntegerField;
    OFI_SQ_R_HIV_SERid_tamanho: TIntegerField;
    OFI_SQ_R_HIV_SERid_item: TIntegerField;
    OFI_SQ_R_HIV_SERint_nomeite: TWideStringField;
    OFI_SQ_R_HIV_SERint_nomeund: TWideStringField;
    OFI_SQ_R_HIV_SERint_nomeapl: TWideStringField;
    OFI_SQ_R_HIV_SERint_nomeref: TWideStringField;
    OFI_SQ_R_HIV_SERint_tipoitem: TWideStringField;
    OFI_SQ_R_HIV_SERvlr_unitario: TFMTBCDField;
    OFI_SQ_R_HIV_SERqtde: TFloatField;
    OFI_SQ_R_HIV_SERvlr_bruto: TFloatField;
    OFI_SQ_R_HIV_SERvlr_desconto: TFMTBCDField;
    OFI_SQ_R_HIV_SERvlr_liquido: TFloatField;
    OFI_SQ_R_HIV_PROid_ordem: TIntegerField;
    OFI_SQ_R_HIV_PROid_cor: TIntegerField;
    OFI_SQ_R_HIV_PROid_tamanho: TIntegerField;
    OFI_SQ_R_HIV_PROid_item: TIntegerField;
    OFI_SQ_R_HIV_PROint_nomeite: TWideStringField;
    OFI_SQ_R_HIV_PROint_nomeund: TWideStringField;
    OFI_SQ_R_HIV_PROint_nomeapl: TWideStringField;
    OFI_SQ_R_HIV_PROint_nomeref: TWideStringField;
    OFI_SQ_R_HIV_PROint_tipoitem: TWideStringField;
    OFI_SQ_R_HIV_PROvlr_unitario: TFMTBCDField;
    OFI_SQ_R_HIV_PROqtde: TFloatField;
    OFI_SQ_R_HIV_PROvlr_bruto: TFloatField;
    OFI_SQ_R_HIV_PROvlr_desconto: TFMTBCDField;
    OFI_SQ_R_HIV_PROvlr_liquido: TFloatField;
    OFI_DP_R_OFV_POC_001: TDataSetProvider;
    OFI_SQ_R_OFV_POC_001: TSQLDataSet;
    OFI_DS_R_OFV_POC_001: TDataSource;
    OFI_SQ_R_OFV_POC_001_SER: TSQLDataSet;
    OFI_SQ_R_OFV_POC_001_PRO: TSQLDataSet;
    OFI_DP_R_OFV_POC_002: TDataSetProvider;
    OFI_SQ_R_OFV_POC_002: TSQLDataSet;
    OFI_SQ_R_OFV_POC_001id_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POC_001id_empresa: TIntegerField;
    OFI_SQ_R_OFV_POC_001placa: TWideStringField;
    OFI_SQ_R_OFV_POC_001km_atual: TIntegerField;
    OFI_SQ_R_OFV_POC_001dta_orcamento: TDateField;
    OFI_SQ_R_OFV_POC_001dta_validade: TDateField;
    OFI_SQ_R_OFV_POC_001id_cliente: TIntegerField;
    OFI_SQ_R_OFV_POC_001nome_cliente: TWideStringField;
    OFI_SQ_R_OFV_POC_001id_funcionario: TIntegerField;
    OFI_SQ_R_OFV_POC_001id_analista: TIntegerField;
    OFI_SQ_R_OFV_POC_001id_condicao_pag: TIntegerField;
    OFI_SQ_R_OFV_POC_001vlr_servicos: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001vlr_produtos: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001vlr_terceiro: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001des_servicos: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001des_produtos: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001vlr_total: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001status: TIntegerField;
    OFI_SQ_R_OFV_POC_001obs: TWideStringField;
    OFI_SQ_R_OFV_POC_001doc_cnpj_cpf: TWideStringField;
    OFI_SQ_R_OFV_POC_001hor_orcamento: TTimeField;
    OFI_SQ_R_OFV_POC_001can_motivo: TWideStringField;
    OFI_SQ_R_OFV_POC_001can_data: TDateField;
    OFI_SQ_R_OFV_POC_001can_hora: TTimeField;
    OFI_SQ_R_OFV_POC_001can_usuario: TIntegerField;
    OFI_SQ_R_OFV_POC_001tipo_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POC_001chassi: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_cpfcnpj: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_pessoacli: TIntegerField;
    OFI_SQ_R_OFV_POC_001int_nomecli: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_telfix: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_telmov: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_ocvsituacao: TWideMemoField;
    OFI_SQ_R_OFV_POC_001int_nomecom: TWideMemoField;
    OFI_SQ_R_OFV_POC_001int_placa: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_nomevei: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_ufcli: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_nomecpg: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERid_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POC_001_SERid_sequencia: TIntegerField;
    OFI_SQ_R_OFV_POC_001_SERid_item: TIntegerField;
    OFI_SQ_R_OFV_POC_001_SERid_busca_item: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERqtde: TFloatField;
    OFI_SQ_R_OFV_POC_001_SERvlr_unitario: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_SERvlr_bruto: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_SERper_desconto: TFloatField;
    OFI_SQ_R_OFV_POC_001_SERvlr_desconto: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_SERvlr_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_SERid_terceiro: TIntegerField;
    OFI_SQ_R_OFV_POC_001_SERvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_SERnome_ite: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_nomeite: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_nomeund: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_nomeapl: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_nomeref: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_tipoitem: TWideStringField;
    OFI_SQ_R_OFV_POC_001_SERint_serterceiro: TBooleanField;
    OFI_SQ_R_OFV_POC_001_PROid_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POC_001_PROid_sequencia: TIntegerField;
    OFI_SQ_R_OFV_POC_001_PROid_item: TIntegerField;
    OFI_SQ_R_OFV_POC_001_PROid_busca_item: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROqtde: TFloatField;
    OFI_SQ_R_OFV_POC_001_PROvlr_unitario: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_PROvlr_bruto: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_PROper_desconto: TFloatField;
    OFI_SQ_R_OFV_POC_001_PROvlr_desconto: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_PROvlr_liquido: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_PROid_terceiro: TIntegerField;
    OFI_SQ_R_OFV_POC_001_PROvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_R_OFV_POC_001_PROnome_ite: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROint_nomeite: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROint_nomeund: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROint_nomeapl: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROint_nomeref: TWideStringField;
    OFI_SQ_R_OFV_POC_001_PROint_tipoitem: TWideStringField;
    OFI_SQ_R_OFV_POC_002id_orcamento: TIntegerField;
    OFI_SQ_R_OFV_POC_002dta_orcamento: TDateField;
    OFI_SQ_R_OFV_POC_002dta_validade: TDateField;
    OFI_SQ_R_OFV_POC_002id_cliente: TIntegerField;
    OFI_SQ_R_OFV_POC_002int_nomecli: TWideStringField;
    OFI_SQ_R_OFV_POC_002int_nomecpg: TWideStringField;
    OFI_SQ_R_OFV_POC_002id_veiculo: TIntegerField;
    OFI_SQ_R_OFV_POC_002int_placa: TWideStringField;
    OFI_SQ_R_OFV_POC_002int_nomevei: TWideStringField;
    OFI_SQ_R_OFV_POC_002int_ocvsituacao: TWideStringField;
    OFI_SQ_R_OFV_POC_002vlr_liquido_ser: TFMTBCDField;
    OFI_SQ_R_OFV_POC_002vlr_liquido_pro: TFMTBCDField;
    OFI_SQ_R_OFV_POC_002id_funcionario: TIntegerField;
    OFI_SQ_R_OFV_POC_002int_nomefun: TWideStringField;
    OFI_SQ_R_OFV_POC_001int_nomefun: TWideStringField;
    BUS_DP_C_CSU_MTV: TDataSetProvider;
    BUS_SQ_C_CSU_MTV: TSQLDataSet;
    BUS_DP_C_CSU_MTV_VND: TDataSetProvider;
    BUS_SQ_C_CSU_MTV_VND: TSQLDataSet;
    CAD_SQ_C_MTV_MESqtde_total: TFloatField;
    CAD_SQ_C_MTV_MESvalor_total: TFMTBCDField;
    FAT_SQ_R_NFE_TMEnfe_cod_sit: TWideStringField;
    BUS_SQ_M_ROM_PED_ICF: TSQLDataSet;
    BUS_SQ_M_ROM_PED_ICFid_rom: TIntegerField;
    BUS_SQ_M_ROM_PED_ICFid_pedido: TIntegerField;
    BUS_SQ_M_ROM_PED_ICFid_item: TIntegerField;
    BUS_SQ_M_ROM_PED_ICFid_cor: TIntegerField;
    BUS_SQ_M_ROM_PED_ICFid_tamanho: TIntegerField;
    BUS_SQ_M_ROM_PED_ICFint_tipo_item: TWideStringField;
    BUS_SQ_M_ROM_PED_ICFqtde: TFMTBCDField;
    BUS_SQ_M_ROM_PED_ICFvlr_unitario: TFMTBCDField;
    BUS_SQ_M_ROM_PED_ICFvlr_liquido: TFMTBCDField;
    BUS_SQ_M_ROM_PED_ICFint_nomecor: TWideStringField;
    BUS_SQ_M_ROM_PED_ICFint_nometam: TWideStringField;
    BUS_SQ_M_ROM_PED_ICFint_nomeite: TWideStringField;
    BUS_DP_M_ROM_PED_ICF: TDataSetProvider;
    PCP_SQ_M_ORS_ICO: TSQLDataSet;
    PCP_SQ_M_ORS_ICOid_ors: TIntegerField;
    PCP_SQ_M_ORS_ICOid_sequencia: TIntegerField;
    PCP_SQ_M_ORS_ICOid_item: TIntegerField;
    PCP_SQ_M_ORS_ICOid_cor: TIntegerField;
    PCP_SQ_M_ORS_ICOid_tamanho: TIntegerField;
    PCP_SQ_M_ORS_ICOqtde: TFloatField;
    PCP_SQ_M_ORS_ICOvlr_unitario: TFMTBCDField;
    PCP_SQ_M_ORS_ICOvlr_bruto: TFMTBCDField;
    PCP_SQ_M_ORS_ICOvlr_liquido: TFMTBCDField;
    PCP_SQ_M_ORS_ICOvlr_desconto: TFMTBCDField;
    PCP_SQ_M_ORS_ICOper_desconto: TFloatField;
    PCP_SQ_M_ORS_ICOint_nomeite: TWideStringField;
    PCP_SQ_M_ORS_ICOint_nomecor: TWideStringField;
    PCP_SQ_M_ORS_ICOint_nometam: TWideStringField;
    PCP_SQ_M_ORS_ICOint_tipo_item: TWideStringField;
    PCP_SQ_M_ORS_ICOint_und_venda: TWideStringField;
    BUS_SQ_M_ORS_ICO_INT: TSQLDataSet;
    BUS_DP_M_ORS_ICO_INT: TDataSetProvider;
    PCP_SQ_M_ETQdta_saida: TDateField;
    PCP_SQ_M_ETQhor_saida: TTimeField;
    PCP_SQ_M_ETQid_ors_saida: TIntegerField;
    PCP_SQ_M_ETQid_rom_saida: TIntegerField;
    PCP_SQ_M_ETQid_funcionario_sai: TWideStringField;
    OFI_SQ_M_ORVchassi: TWideStringField;
    OFI_SQ_M_ORVtipo_ordem: TIntegerField;
    CAD_SQ_C_PAR_RST: TSQLDataSet;
    CAD_SQ_C_PAR_RSTid_empresa: TIntegerField;
    CAD_SQ_C_PAR_RSTletra_restricao: TWideStringField;
    CAD_SQ_C_PAR_RSTtipo_restricao: TIntegerField;
    CAD_SQ_C_PAR_RSTint_fantasia: TWideStringField;
    BUS_DP_C_CLI_EST_SRH: TDataSetProvider;
    BUS_SQ_C_CLI_EST_SRH: TSQLDataSet;
    BUS_DP_C_CLI_EST_MPA: TDataSetProvider;
    BUS_SQ_C_CLI_EST_MPA: TSQLDataSet;
    BUS_DP_C_CLI_EST_VNP: TDataSetProvider;
    BUS_SQ_C_CLI_EST_VNP: TSQLDataSet;
    BUS_DP_M_CSU_GER_ORV_MAR: TDataSetProvider;
    BUS_SQ_M_CSU_GER_ORV_MAR: TSQLDataSet;
    BUS_DP_M_CSU_ORV_ITE: TDataSetProvider;
    BUS_SQ_M_CSU_ORV_ITE: TSQLDataSet;
    CAD_SQ_C_PAR_RSTdescricao: TWideStringField;
    FIN_DP_R_PAG_CXA: TDataSetProvider;
    FIN_SQ_R_PAG_CXA: TSQLDataSet;
    BUS_DP_M_CSU_GER_ORV: TDataSetProvider;
    BUS_SQ_M_CSU_GER_ORV: TSQLDataSet;
    OFI_SQ_R_OFV_POS_001tipo_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_001chassi: TWideStringField;
    OFI_SQ_R_OFV_POS_002tipo_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_002chassi: TWideStringField;
    OFI_SQ_R_OFV_POS_003tipo_ordem: TIntegerField;
    OFI_SQ_R_OFV_POS_003chassi: TWideStringField;
    BUS_SQ_R_ORV_SERint_codmec: TIntegerField;
    BUS_SQ_R_ORV_SERint_nomemec: TWideStringField;
    BUS_SQ_M_RECint_numordem: TIntegerField;
    FIN_DP_M_LMF: TDataSetProvider;
    FIN_SQ_M_LMF: TSQLDataSet;
    FIN_DP_M_PRC: TDataSetProvider;
    FIN_SQ_M_PRC: TSQLDataSet;
    FIN_DS_M_PRC: TDataSource;
    FIN_SQ_M_PRC_DET: TSQLDataSet;
    CAD_SQ_C_PAR_MODadf: TBooleanField;
    CAD_SQ_C_TIFprestacao_conta: TBooleanField;
    FIN_SQ_M_LMFid_lmf: TIntegerField;
    FIN_SQ_M_LMFid_conta: TIntegerField;
    FIN_SQ_M_LMFid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_LMFdta_movimento: TDateField;
    FIN_SQ_M_LMFid_funcionario: TIntegerField;
    FIN_SQ_M_LMFhistorico: TWideStringField;
    FIN_SQ_M_LMFvlr_movimento: TFMTBCDField;
    FIN_SQ_M_LMFvlr_saldo: TFMTBCDField;
    FIN_SQ_M_LMFstatus: TIntegerField;
    FIN_SQ_M_LMFid_plano: TWideStringField;
    FIN_SQ_M_LMFdta_vencimento: TDateField;
    FIN_SQ_M_LMFid_empresa: TIntegerField;
    FIN_SQ_M_LMFint_nomefun: TWideStringField;
    FIN_SQ_M_LMFint_nomepct: TWideStringField;
    FIN_SQ_M_LMFint_nometif: TWideStringField;
    FIN_SQ_M_PRC_DETid_prc: TIntegerField;
    FIN_SQ_M_PRC_DETid_tipo_financeiro: TIntegerField;
    FIN_SQ_M_PRC_DETid_tipo_titulo: TIntegerField;
    FIN_SQ_M_PRC_DETid_plano: TWideStringField;
    FIN_SQ_M_PRC_DETid_conta: TIntegerField;
    FIN_SQ_M_PRC_DETvlr_prestacao: TFMTBCDField;
    FIN_SQ_M_PRC_DEThistorico: TWideStringField;
    FIN_SQ_M_PRC_DETid_tipo_financeiro_cp: TIntegerField;
    FIN_SQ_M_PRC_DETint_nomepct: TWideStringField;
    FIN_SQ_M_PRCid_prc: TIntegerField;
    FIN_SQ_M_PRCid_lmf: TIntegerField;
    FIN_SQ_M_PRCvlr_total_prc: TFMTBCDField;
    FIN_SQ_M_PRCid_empresa: TIntegerField;
    FIN_SQ_M_PRCint_codfun: TIntegerField;
    FIN_SQ_M_PRCint_dta_mov: TDateField;
    FIN_SQ_M_PRCint_vlr_mov: TFMTBCDField;
    FIN_SQ_M_PRCint_vlr_saldo: TFMTBCDField;
    FIN_SQ_M_PRCint_nomefun: TWideStringField;
    FIN_SQ_M_PRCdta_prestacao: TDateField;
    FAT_SQ_M_PEDcan_usuario: TIntegerField;
    FAT_SQ_M_PEDcan_data: TDateField;
    FAT_SQ_M_PEDcan_motivo: TWideStringField;
    FAT_SQ_M_PEDcan_hora: TTimeField;
    FIN_SQ_M_PRC_DETint_nometif: TWideStringField;
    FIN_SQ_M_PRC_DETint_nometif_cp: TWideStringField;
    FIN_SQ_M_PRC_DETint_nomefpg: TWideStringField;
    FIN_SQ_M_PRC_DETint_nomectc: TWideStringField;
    BUS_SQ_R_ORV_PROint_codmec: TIntegerField;
    BUS_SQ_R_ORV_PROint_nomemec: TWideStringField;
    CAD_SQ_C_GRUimp_etq_simples: TBooleanField;
    CAD_SQ_C_GRUpath_etq_simples: TWideStringField;
    PCP_SQ_M_ETQint_impetqsimples: TBooleanField;
    PCP_SQ_M_ETQint_pathetqsimples: TWideStringField;
    CAD_SQ_C_ITEint_impetqsimples: TBooleanField;
    CAD_SQ_C_ITEint_pathetqsimples: TWideStringField;
    CAD_SQ_C_TIFgera_deb_cre: TBooleanField;
    FIN_SQ_M_LMFvlr_pago: TFMTBCDField;
    FIN_SQ_M_CTAid_lmf: TIntegerField;
    FIN_SQ_M_CTAid_prc: TIntegerField;
    FIN_SQ_M_CTAid_prc_det: TIntegerField;
    FIN_SQ_M_PAGid_lmf: TIntegerField;
    FIN_SQ_M_PAGid_prc: TIntegerField;
    FIN_SQ_M_PAGid_prc_det: TIntegerField;
    CAD_SQ_C_TIFint_prestacao_conta: TWideStringField;
    FIN_SQ_M_CTA_INTid_lmf: TIntegerField;
    FIN_SQ_M_CTA_INTid_prc: TIntegerField;
    FIN_SQ_M_CTA_INTid_prc_det: TIntegerField;
    CAD_SQ_C_PAR_CTRutiliza_mecanico: TBooleanField;
    CAD_SQ_C_TIFint_deb_cre: TWideStringField;
    FIN_SQ_M_PRC_DETid_sequencia: TIntegerField;
    FIN_DP_R_LMF_MOV: TDataSetProvider;
    FIN_SQ_R_LMF_MOV: TSQLDataSet;
    FIN_DP_R_LMF_EXT: TDataSetProvider;
    FIN_SQ_R_LMF_EXT: TSQLDataSet;
    FIN_DP_R_PRC: TDataSetProvider;
    FIN_SQ_R_PRC: TSQLDataSet;
    CAD_SQ_C_FPGaval_duplicata: TBooleanField;
    FIN_DS_R_PRC: TDataSource;
    FIN_SQ_R_PRC_DET: TSQLDataSet;
    FIN_SQ_R_PRC_DETid_prc: TIntegerField;
    FIN_SQ_R_PRC_DETid_tipo_financeiro: TIntegerField;
    FIN_SQ_R_PRC_DETid_tipo_titulo: TIntegerField;
    FIN_SQ_R_PRC_DETid_plano: TWideStringField;
    FIN_SQ_R_PRC_DETid_conta: TIntegerField;
    FIN_SQ_R_PRC_DETvlr_prestacao: TFMTBCDField;
    FIN_SQ_R_PRC_DEThistorico: TWideStringField;
    FIN_SQ_R_PRC_DETid_tipo_financeiro_cp: TIntegerField;
    FIN_SQ_R_PRC_DETid_sequencia: TIntegerField;
    FIN_SQ_R_PRC_DETint_nomepct: TWideStringField;
    FIN_SQ_R_PRC_DETint_nometif: TWideStringField;
    FIN_SQ_R_PRC_DETint_nometif_cp: TWideStringField;
    FIN_SQ_R_PRC_DETint_nomefpg: TWideStringField;
    FIN_SQ_R_PRC_DETint_nomectc: TWideStringField;
    FIN_SQ_R_PRCid_prc: TIntegerField;
    FIN_SQ_R_PRCid_lmf: TIntegerField;
    FIN_SQ_R_PRCvlr_total_prc: TFMTBCDField;
    FIN_SQ_R_PRCid_empresa: TIntegerField;
    FIN_SQ_R_PRCdta_prestacao: TDateField;
    FIN_SQ_R_PRCdta_movimento: TDateField;
    FIN_SQ_R_PRCvlr_movimento: TFMTBCDField;
    FIN_SQ_R_PRCvlr_saldo: TFMTBCDField;
    FIN_SQ_R_PRCid_funcionario: TIntegerField;
    FIN_SQ_R_PRCint_nomefun: TWideStringField;
    FIN_SQ_M_LMFid_obra: TIntegerField;
    FIN_SQ_M_LMFint_nomeobr: TWideStringField;
    FIN_SQ_M_CTA_INTid_obra: TIntegerField;
    CAD_SQ_C_FUNseg_vis_nota_csu_ite: TBooleanField;
    CAD_SQ_C_ITEpreco_sugerido: TFMTBCDField;
    FIN_SQ_M_MCH_CHEint_atraso: TIntegerField;
    FIN_SQ_M_MCH_CHEint_vlr_juros: TFloatField;
    PCP_SQ_M_OPRnum_lote: TWideStringField;
    FIN_SQ_M_MCHvlr_tot_juros_che: TFMTBCDField;
    FAT_SQ_M_NFEid_ordem_gar: TIntegerField;
    OFI_SQ_M_ORVid_ordem_orig_gar: TIntegerField;
    OFI_SQ_M_ORV_ITEint_selecao: TBooleanField;
    OFI_SQ_M_ORV_ITEint_qtde_gar: TIntegerField;
    OFI_SQ_C_TIOtipo: TIntegerField;
    BUS_SQ_M_ORV_ITE_INTint_nomefor: TWideStringField;
    BUS_SQ_M_ORV_ITE_INTint_codfor: TIntegerField;
    FAT_SQ_M_PEDint_numloteopr: TWideStringField;
    PCP_SQ_M_ORSint_numloteopr: TWideStringField;
    FAT_SQ_R_ROT: TSQLDataSet;
    FAT_DP_R_ROT: TDataSetProvider;
    CAD_SQ_C_PAR_CTRorv_id_tme_dev_gar: TIntegerField;
    CAD_SQ_C_PAR_CTRorv_id_tme_dev_cli_gar: TIntegerField;
    EST_SQ_M_MALid_equipamento: TIntegerField;
    FAT_SQ_R_ROTid_emitente: TIntegerField;
    FAT_SQ_R_ROTnumero: TIntegerField;
    FAT_SQ_R_ROTint_cliente: TWideStringField;
    FAT_SQ_R_ROTint_vendedor: TWideStringField;
    FAT_SQ_R_ROTid_pedido_venda: TIntegerField;
    FAT_SQ_R_ROTid_rota: TIntegerField;
    FAT_SQ_R_ROTint_rota: TWideStringField;
    FAT_SQ_R_ROTdta_emissao: TDateField;
    FAT_SQ_R_ROTvlr_liquido: TFloatField;
    FAT_SQ_R_ROTvlr_desconto: TFMTBCDField;
    FAT_SQ_R_ROTqtde: TFloatField;
    FAT_SQ_R_ROTqtde_dev: TFloatField;
    FAT_SQ_R_NOT_ROT: TSQLDataSet;
    FAT_DP_R_NOT_ROT: TDataSetProvider;
    FAT_SQ_R_NOT_ROTid_cliente: TIntegerField;
    FAT_SQ_R_NOT_ROTint_cliente: TWideStringField;
    EST_SQ_M_MAL_ITEint_tipo_item: TWideStringField;
    EST_SQ_M_MALint_nomeqp: TWideStringField;
    CAD_SQ_C_VIT: TSQLDataSet;
    CAD_SQ_C_VITid_visita: TIntegerField;
    CAD_SQ_C_VITid_vendedor: TIntegerField;
    CAD_SQ_C_VITid_veiculo: TIntegerField;
    CAD_SQ_C_VITdta_visita: TDateField;
    CAD_SQ_C_VITobs: TWideStringField;
    CAD_SQ_C_VITrecomendacoes: TWideStringField;
    CAD_SQ_C_VITint_vendedor: TWideStringField;
    CAD_SQ_C_VITint_cliente: TWideStringField;
    CAD_SQ_C_VITplaca: TWideStringField;
    CAD_SQ_C_VITdoc_cnpj_cpf: TWideStringField;
    CAD_DP_C_VIT: TDataSetProvider;
    CAD_DS_C_VIT: TDataSource;
    CAD_SQ_C_VIT_FOT: TSQLDataSet;
    CAD_SQ_C_VIT_FOTid_visita: TIntegerField;
    CAD_SQ_C_VIT_FOTid_vit_fot: TIntegerField;
    CAD_SQ_C_VIT_FOTcaminho_foto: TWideStringField;
    CAD_SQ_C_VIT_KMT: TSQLDataSet;
    CAD_SQ_C_VIT_KMTid_visita: TIntegerField;
    CAD_SQ_C_VIT_KMTid_km: TIntegerField;
    CAD_SQ_C_VIT_KMTid_veiculo: TIntegerField;
    CAD_SQ_C_VIT_KMTkm_inicial: TFloatField;
    CAD_SQ_C_VIT_KMTkm_final: TFloatField;
    CAD_SQ_C_VIT_KMTid_placa: TWideStringField;
    CAD_SQ_C_VIS: TSQLDataSet;
    CAD_SQ_C_VISid_vis: TIntegerField;
    CAD_SQ_C_VISsemana: TIntegerField;
    CAD_SQ_C_VISid_vendedor: TIntegerField;
    CAD_SQ_C_VISint_vendedor: TWideStringField;
    CAD_DP_C_VIS: TDataSetProvider;
    CAD_DS_C_VIS: TDataSource;
    CAD_SQ_C_VIS_CLI: TSQLDataSet;
    CAD_SQ_C_VIS_CLIid_vis: TIntegerField;
    CAD_SQ_C_VIS_CLIid_vis_cli: TIntegerField;
    CAD_SQ_C_VIS_CLIdoc_cnpj_cpf: TWideStringField;
    CAD_SQ_C_VIS_CLInome: TWideStringField;
    CAD_SQ_C_VITid_empresa: TIntegerField;
    CAD_SQ_C_VISid_empresa: TIntegerField;
    FAT_SQ_M_NFEid_fiscal_ref_comp: TIntegerField;
    FAT_SQ_M_NFEid_seq_fat_gar: TIntegerField;
    BUS_SQ_M_NFE_INTid_seq_fat_gar: TIntegerField;
    CAD_SQ_C_FUNid_empresa_mob: TIntegerField;
    FAT_SQ_M_ROM_NFEimportada: TBooleanField;
    FAT_SQ_M_ROM_NFEint_uf: TWideStringField;
    OFI_SQ_M_ORVint_tipo_os: TIntegerField;
    CAD_SQ_C_VIS_CLIdta_visita: TDateField;
    CAD_SQ_C_VISfechada: TBooleanField;
    FAT_SQ_M_ROM_PER: TSQLDataSet;
    BUS_SQ_C_VIT_CON: TSQLDataSet;
    BUS_DP_C_VIT_CON: TDataSetProvider;
    BUS_SQ_C_VIT_CONid_visita: TIntegerField;
    BUS_SQ_C_VIT_CONid_vendedor: TIntegerField;
    BUS_SQ_C_VIT_CONdoc_cnpj_cpf: TWideStringField;
    BUS_SQ_C_VIT_CONid_veiculo: TIntegerField;
    BUS_SQ_C_VIT_CONdta_visita: TDateField;
    BUS_SQ_C_VIT_CONobs: TWideStringField;
    BUS_SQ_C_VIT_CONrecomendacoes: TWideStringField;
    BUS_SQ_C_VIT_CONid_empresa: TIntegerField;
    BUS_SQ_C_VIT_CONkm_inicial: TFloatField;
    BUS_SQ_C_VIT_CONkm_final: TFloatField;
    BUS_SQ_C_VIT_CONemp_fantasia: TWideStringField;
    BUS_SQ_C_VIT_CONnome: TWideStringField;
    BUS_SQ_C_VIT_CONnome_carro: TWideStringField;
    BUS_SQ_C_VIT_CONnome_cli: TWideStringField;
    BUS_SQ_C_VIT_CONgps_latitude: TFloatField;
    BUS_SQ_C_VIT_CONgps_longitude: TFloatField;
    BUS_SQ_C_VIT_CONhor_ini: TTimeField;
    BUS_SQ_C_VIT_CONhor_fim: TTimeField;
    BUS_SQ_C_VIT_CONsemana: TIntegerField;
    CAD_SQ_C_ITE_PRCid_empresa: TIntegerField;
    CAD_SQ_C_PAR_CTRpreco_por_filial: TBooleanField;
    CAD_SQ_C_PAR_BXR: TSQLDataSet;
    CAD_SQ_C_PAR_CTRperm_bxa_rec_n_emp: TBooleanField;
    CAD_SQ_C_PAR_BXRid_empresa: TIntegerField;
    CAD_SQ_C_PAR_BXRid_empresa_bxr: TIntegerField;
    CAD_SQ_C_PAR_BXRpermite_baixar: TBooleanField;
    CAD_SQ_C_PAR_BXRint_fantasia: TWideStringField;
    FIN_SQ_R_EXT_FOR_NCR: TSQLDataSet;
    FIN_DP_R_EXT_FOR_NCR: TDataSetProvider;
    FIN_SQ_R_EXT_FOR_EST: TSQLDataSet;
    FIN_DP_R_EXT_FOR_EST: TDataSetProvider;
    OFI_SQ_R_OFV_POS_EST: TSQLDataSet;
    OFI_DP_R_OFV_POS_EST: TDataSetProvider;
    FIN_SQ_M_PAGid_conciliacao: TIntegerField;
    FIN_SQ_M_RECid_conciliacao: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_forma_pag_rec: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_forma_pag_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_local_titulo_rec: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_local_titulo_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_ccusto_pag: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_titulo_rec: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_titulo_pag: TIntegerField;
    FIN_SQ_M_CON_CXB_DETtipo_titulo: TIntegerField;
    FIN_SQ_M_CON_CXB_DETvlr_titulo: TFMTBCDField;
    FIN_SQ_M_CON_CXB_DETvlr_juros: TFMTBCDField;
    FIN_SQ_M_CON_CXB_AUXid_emitente: TIntegerField;
    FIN_SQ_M_CON_CXB_DETid_emitente: TIntegerField;
    FIN_SQ_M_CON_CXB_AUXtipo_titulo: TIntegerField;
    FIN_SQ_M_CON_CXB_AUXint_nomeemi: TWideStringField;
    FIN_SQ_M_CON_CXB_DETint_nomeemi: TWideStringField;
    CAD_SQ_C_PAR_CTRcon_id_tipo_financeiro_rec: TIntegerField;
    CAD_SQ_C_PAR_CTRcon_id_tipo_financeiro_pag: TIntegerField;
    FIN_SQ_M_PAGint_selecao: TBooleanField;
    FIN_SQ_M_RECint_selecao: TBooleanField;
    CAD_SQ_C_PAR_CTRcalc_icm_dispensado: TBooleanField;
    CAD_SQ_C_TRI_REGdis_aliquota: TFloatField;
    FAT_SQ_M_NFEdis_icm_dispensado: TFMTBCDField;
    FAT_SQ_M_NFE_ITEdis_aliquota: TFloatField;
    FAT_SQ_M_NFE_ITEdis_icm_dispensado: TFMTBCDField;
    BUS_SQ_C_PAR_CTRcon_id_forma_pag_rec: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_forma_pag_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_local_titulo_rec: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_local_titulo_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_ccusto_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_tipo_financeiro_rec: TIntegerField;
    BUS_SQ_C_PAR_CTRcon_id_tipo_financeiro_pag: TIntegerField;
    BUS_SQ_C_VIT_CONplaca: TWideStringField;
    BUS_SQ_C_VIT_CONid_pedido_mobile: TIntegerField;
    BUS_SQ_C_VIT_CONtipo_mobile: TIntegerField;
    FIN_SQ_M_RCRcancelado: TBooleanField;
    FAT_SQ_R_NFE_TMEid_empresa: TIntegerField;
    FAT_SQ_R_NFE_TMEint_nomeemp: TWideStringField;
    FIN_SQ_M_MCH_CHEvlr_juros: TFMTBCDField;
    CAD_SQ_C_PAR_CTRativa_preco_cat_ser: TBooleanField;
    FIN_SQ_M_CON_CXB_DETvlr_desconto_ope: TFMTBCDField;
    FIN_SQ_M_CON_CXB_DETdoc_impresso: TIntegerField;
    FIN_SQ_M_PAGint_docimpresso: TIntegerField;
    CAD_SQ_C_CLIint_selecao: TBooleanField;
    FAT_SQ_M_NFE_ITEvlr_unitario: TFMTBCDField;
    FAT_SQ_M_NFE_ITEint_selecao: TBooleanField;
    CTC_SQ_M_PME: TSQLDataSet;
    CTC_DP_M_PME: TDataSetProvider;
    FIN_SQ_M_REC_PAGid_empresa_bxa: TIntegerField;
    CAD_SQ_C_PAR_CTRmob_id_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_PAR_CTRmob_periodo_ult_vend: TIntegerField;
    CAD_SQ_C_CLI_RVD: TSQLDataSet;
    CAD_SQ_C_CLI_RVDid_cliente: TIntegerField;
    CAD_SQ_C_CLI_RVDid_rvd: TIntegerField;
    CAD_DP_C_RVD: TDataSetProvider;
    CAD_SQ_C_RVD: TSQLDataSet;
    CAD_SQ_C_RVDid_rvd: TIntegerField;
    CAD_SQ_C_RVDdescricao: TWideStringField;
    CAD_SQ_C_CLI_RVDint_descrev: TWideStringField;
    CTC_SQ_M_PMEid_pme: TIntegerField;
    CTC_SQ_M_PMEid_equip: TWideStringField;
    CTC_SQ_M_PMEtipo_cont: TWideStringField;
    CTC_SQ_M_PMEmodelo: TWideStringField;
    CTC_SQ_M_PMEult_manu: TWideStringField;
    CTC_SQ_M_PMEatual_manu: TWideStringField;
    CTC_SQ_M_PMEprox_manu: TWideStringField;
    CTC_SQ_M_PMEtipo_prox_manu: TWideStringField;
    CTC_SQ_M_PMEper_restante: TWideStringField;
    CTC_SQ_M_PMEper_excedido: TWideStringField;
    CTC_SQ_M_PMElocal: TWideStringField;
    CTC_SQ_M_PMEobservacao: TWideStringField;
    CTC_SQ_M_PMEtipo_equip: TWideStringField;
    CTC_SQ_M_PMEdta_ult_dado: TDateField;
    CTC_SQ_M_PMEint_equipamento: TWideStringField;
    FIN_DP_M_DCT: TDataSetProvider;
    FIN_SQ_M_DCT: TSQLDataSet;
    FIN_DS_M_DCT: TDataSource;
    FIN_SQ_M_DCT_TIT: TSQLDataSet;
    FIN_SQ_M_DCTid_dct: TIntegerField;
    FIN_SQ_M_DCTdata_operacao: TDateField;
    FIN_SQ_M_DCTdata_original: TDateField;
    FIN_SQ_M_DCTid_conta: TIntegerField;
    FIN_SQ_M_DCTid_local_titulo: TIntegerField;
    FIN_SQ_M_DCTper_taxa_desc: TFMTBCDField;
    FIN_SQ_M_DCTvlr_taxa_desc: TFMTBCDField;
    FIN_SQ_M_DCTtipo_operacao: TIntegerField;
    FIN_SQ_M_DCTint_descconta: TWideStringField;
    FIN_SQ_M_DCTint_desc_localtit: TWideStringField;
    FIN_SQ_M_DCT_TITid_dct: TIntegerField;
    FIN_SQ_M_DCT_TITid_titulo: TIntegerField;
    FIN_SQ_M_DCT_TITvlr_cobrado_canc_desc: TFMTBCDField;
    FIN_SQ_M_RECdct_id_conta: TIntegerField;
    FIN_SQ_M_CTAid_dct_desc: TIntegerField;
    FIN_SQ_M_CTAid_dct_canc: TIntegerField;
    FIN_SQ_M_REC_PAGid_dct_bxa: TIntegerField;
    CAD_SQ_C_VISano: TIntegerField;
    CAD_SQ_C_VISdta_criacao: TDateField;
    FAT_SQ_M_NFEped_mod_frete: TIntegerField;
    FAT_SQ_M_NFEped_vlr_frete: TFMTBCDField;
    FIN_SQ_M_DCT_TITint_vlr_saldo: TFMTBCDField;
    FIN_SQ_M_DCT_TITint_dta_emissao: TDateField;
    FIN_SQ_M_DCT_TITint_dta_original: TDateField;
    FIN_SQ_M_DCT_TITint_dta_vencimento: TDateField;
    FIN_SQ_M_DCT_TITint_cod_cliente: TIntegerField;
    FIN_SQ_M_DCT_TITint_nomecli: TWideStringField;
    FAT_SQ_M_ROMtotal_notas: TFMTBCDField;
    FAT_SQ_M_PEDid_motorista: TIntegerField;
    FAT_SQ_M_PEDid_placa: TWideStringField;
    FIN_SQ_M_DCT_TITint_selecao: TBooleanField;
    CAD_SQ_C_PAR_CTRdct_id_tipo_financeiro_cred: TIntegerField;
    CAD_SQ_C_PAR_CTRdct_id_tipo_financeiro_desc_taxa: TIntegerField;
    CAD_SQ_C_PAR_CTRdct_id_tipo_financeiro_canc: TIntegerField;
    CAD_SQ_C_PAR_CTRdct_id_plano_cred: TWideStringField;
    CAD_SQ_C_PAR_CTRdct_id_plano_desc_taxa: TWideStringField;
    CAD_SQ_C_PAR_CTRdct_id_forma_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRdct_id_plano_canc: TWideStringField;
    FIN_SQ_M_DCTvlr_total_titulos: TFMTBCDField;
    FIN_SQ_M_DCTid_empresa: TIntegerField;
    FIN_SQ_M_RECdct_dta_descontado: TDateField;
    BUS_SQ_C_PAR_CTRdct_id_tipo_financeiro_cred: TIntegerField;
    BUS_SQ_C_PAR_CTRdct_id_tipo_financeiro_desc_taxa: TIntegerField;
    BUS_SQ_C_PAR_CTRdct_id_tipo_financeiro_canc: TIntegerField;
    BUS_SQ_C_PAR_CTRdct_id_plano_cred: TWideStringField;
    BUS_SQ_C_PAR_CTRdct_id_plano_desc_taxa: TWideStringField;
    BUS_SQ_C_PAR_CTRdct_id_forma_pag: TIntegerField;
    BUS_SQ_C_PAR_CTRdct_id_plano_canc: TWideStringField;
    BUS_SQ_M_RECdct_id_conta: TIntegerField;
    BUS_SQ_M_RECdct_dta_descontado: TDateField;
    FIN_SQ_M_DCTid_responsavel: TIntegerField;
    FAT_SQ_M_MKTid_vis: TIntegerField;
    FIN_SQ_M_PCRid_fiscal: TIntegerField;
    CAD_SQ_C_GRUper_cmv_interno: TFMTBCDField;
    CAD_SQ_C_GRUper_cmv_externo: TFMTBCDField;
    CAD_SQ_C_FUNvnd_interno_externo: TIntegerField;
    OFI_SQ_M_OCQ: TSQLDataSet;
    OFI_SQ_M_OCQid_orcamento: TIntegerField;
    OFI_SQ_M_OCQid_empresa: TIntegerField;
    OFI_SQ_M_OCQid_equipamento: TIntegerField;
    OFI_SQ_M_OCQdta_orcamento: TDateField;
    OFI_SQ_M_OCQdta_validade: TDateField;
    OFI_SQ_M_OCQid_cliente: TIntegerField;
    OFI_SQ_M_OCQnome_cliente: TWideStringField;
    OFI_SQ_M_OCQid_funcionario: TIntegerField;
    OFI_SQ_M_OCQid_analista: TIntegerField;
    OFI_SQ_M_OCQid_condicao_pag: TIntegerField;
    OFI_SQ_M_OCQvlr_servicos: TFMTBCDField;
    OFI_SQ_M_OCQvlr_produtos: TFMTBCDField;
    OFI_SQ_M_OCQvlr_terceiro: TFMTBCDField;
    OFI_SQ_M_OCQdes_servicos: TFMTBCDField;
    OFI_SQ_M_OCQdes_produtos: TFMTBCDField;
    OFI_SQ_M_OCQvlr_total: TFMTBCDField;
    OFI_SQ_M_OCQstatus: TIntegerField;
    OFI_SQ_M_OCQobs: TWideStringField;
    OFI_SQ_M_OCQdoc_cnpj_cpf: TWideStringField;
    OFI_SQ_M_OCQhor_orcamento: TTimeField;
    OFI_SQ_M_OCQcan_motivo: TWideStringField;
    OFI_SQ_M_OCQcan_data: TDateField;
    OFI_SQ_M_OCQcan_hora: TTimeField;
    OFI_SQ_M_OCQcan_usuario: TIntegerField;
    OFI_SQ_M_OCQserial: TWideStringField;
    OFI_SQ_M_OCQint_nomefuc: TWideStringField;
    OFI_SQ_M_OCQint_nomeana: TWideStringField;
    OFI_SQ_M_OCQint_nomecpg: TWideStringField;
    OFI_SQ_M_OCQint_nomeeqp: TWideStringField;
    OFI_DP_M_OCQ: TDataSetProvider;
    OFI_DS_M_OCQ: TDataSource;
    OFI_SQ_M_OCQ_ITE: TSQLDataSet;
    OFI_SQ_M_OCQ_ITEid_orcamento: TIntegerField;
    OFI_SQ_M_OCQ_ITEid_sequencia: TIntegerField;
    OFI_SQ_M_OCQ_ITEid_item: TIntegerField;
    OFI_SQ_M_OCQ_ITEid_busca_item: TWideStringField;
    OFI_SQ_M_OCQ_ITEqtde: TFloatField;
    OFI_SQ_M_OCQ_ITEvlr_unitario: TFMTBCDField;
    OFI_SQ_M_OCQ_ITEvlr_bruto: TFMTBCDField;
    OFI_SQ_M_OCQ_ITEper_desconto: TFloatField;
    OFI_SQ_M_OCQ_ITEvlr_desconto: TFMTBCDField;
    OFI_SQ_M_OCQ_ITEvlr_liquido: TFMTBCDField;
    OFI_SQ_M_OCQ_ITEid_terceiro: TIntegerField;
    OFI_SQ_M_OCQ_ITEvlr_unitario_orig: TFMTBCDField;
    OFI_SQ_M_OCQ_ITEnome_ite: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_nomeite: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_nomeund: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_nomeapl: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_nomeref: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_nometer: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_tipo_item: TWideStringField;
    OFI_SQ_M_OCQ_ITEint_serterceiro: TBooleanField;
    BUS_SQ_R_OCQ: TSQLDataSet;
    BUS_SQ_R_OCQ_SER: TSQLDataSet;
    BUS_SQ_R_OCQ_PRO: TSQLDataSet;
    BUS_DP_R_OCQ: TDataSetProvider;
    BUS_DS_R_OCQ: TDataSource;
    BUS_SQ_R_OCQid_orcamento: TIntegerField;
    BUS_SQ_R_OCQid_empresa: TIntegerField;
    BUS_SQ_R_OCQid_equipamento: TIntegerField;
    BUS_SQ_R_OCQdta_orcamento: TDateField;
    BUS_SQ_R_OCQdta_validade: TDateField;
    BUS_SQ_R_OCQid_cliente: TIntegerField;
    BUS_SQ_R_OCQnome_cliente: TWideStringField;
    BUS_SQ_R_OCQid_funcionario: TIntegerField;
    BUS_SQ_R_OCQid_analista: TIntegerField;
    BUS_SQ_R_OCQid_condicao_pag: TIntegerField;
    BUS_SQ_R_OCQvlr_servicos: TFMTBCDField;
    BUS_SQ_R_OCQvlr_produtos: TFMTBCDField;
    BUS_SQ_R_OCQvlr_terceiro: TFMTBCDField;
    BUS_SQ_R_OCQdes_servicos: TFMTBCDField;
    BUS_SQ_R_OCQdes_produtos: TFMTBCDField;
    BUS_SQ_R_OCQvlr_total: TFMTBCDField;
    BUS_SQ_R_OCQstatus: TIntegerField;
    BUS_SQ_R_OCQobs: TWideStringField;
    BUS_SQ_R_OCQdoc_cnpj_cpf: TWideStringField;
    BUS_SQ_R_OCQhor_orcamento: TTimeField;
    BUS_SQ_R_OCQcan_motivo: TWideStringField;
    BUS_SQ_R_OCQcan_data: TDateField;
    BUS_SQ_R_OCQcan_hora: TTimeField;
    BUS_SQ_R_OCQcan_usuario: TIntegerField;
    BUS_SQ_R_OCQserial: TWideStringField;
    BUS_SQ_R_OCQint_nomefuc: TWideStringField;
    BUS_SQ_R_OCQint_nomeana: TWideStringField;
    BUS_SQ_R_OCQint_nomecpg: TWideStringField;
    BUS_SQ_R_OCQ_SERid_orcamento: TIntegerField;
    BUS_SQ_R_OCQ_SERid_sequencia: TIntegerField;
    BUS_SQ_R_OCQ_SERid_item: TIntegerField;
    BUS_SQ_R_OCQ_SERid_busca_item: TWideStringField;
    BUS_SQ_R_OCQ_SERqtde: TFloatField;
    BUS_SQ_R_OCQ_SERvlr_unitario: TFMTBCDField;
    BUS_SQ_R_OCQ_SERvlr_bruto: TFMTBCDField;
    BUS_SQ_R_OCQ_SERper_desconto: TFloatField;
    BUS_SQ_R_OCQ_SERvlr_desconto: TFMTBCDField;
    BUS_SQ_R_OCQ_SERvlr_liquido: TFMTBCDField;
    BUS_SQ_R_OCQ_SERid_terceiro: TIntegerField;
    BUS_SQ_R_OCQ_SERvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_R_OCQ_SERnome_ite: TWideStringField;
    BUS_SQ_R_OCQ_SERint_nomeite: TWideStringField;
    BUS_SQ_R_OCQ_SERint_nomeund: TWideStringField;
    BUS_SQ_R_OCQ_SERint_nomeapl: TWideStringField;
    BUS_SQ_R_OCQ_SERint_nomeref: TWideStringField;
    BUS_SQ_R_OCQ_SERint_nometer: TWideStringField;
    BUS_SQ_R_OCQ_SERint_tipo_item: TIntegerField;
    BUS_SQ_R_OCQ_PROid_orcamento: TIntegerField;
    BUS_SQ_R_OCQ_PROid_sequencia: TIntegerField;
    BUS_SQ_R_OCQ_PROid_item: TIntegerField;
    BUS_SQ_R_OCQ_PROid_busca_item: TWideStringField;
    BUS_SQ_R_OCQ_PROqtde: TFloatField;
    BUS_SQ_R_OCQ_PROvlr_unitario: TFMTBCDField;
    BUS_SQ_R_OCQ_PROvlr_bruto: TFMTBCDField;
    BUS_SQ_R_OCQ_PROper_desconto: TFloatField;
    BUS_SQ_R_OCQ_PROvlr_desconto: TFMTBCDField;
    BUS_SQ_R_OCQ_PROvlr_liquido: TFMTBCDField;
    BUS_SQ_R_OCQ_PROid_terceiro: TIntegerField;
    BUS_SQ_R_OCQ_PROvlr_unitario_orig: TFMTBCDField;
    BUS_SQ_R_OCQ_PROnome_ite: TWideStringField;
    BUS_SQ_R_OCQ_PROint_nomeite: TWideStringField;
    BUS_SQ_R_OCQ_PROint_nomeund: TWideStringField;
    BUS_SQ_R_OCQ_PROint_nomeapl: TWideStringField;
    BUS_SQ_R_OCQ_PROint_nomeref: TWideStringField;
    BUS_SQ_R_OCQ_PROint_nometer: TWideStringField;
    BUS_SQ_R_OCQ_PROint_tipo_item: TIntegerField;
    BUS_SQ_R_OCQint_nomeeqp: TWideStringField;
    FAT_SQ_M_PEDint_nomemta: TWideStringField;
    FIN_SQ_R_REC_ABE_PPGcar_taxa: TFloatField;
    FIN_SQ_R_REC_ABE_PPGdoc_impresso: TIntegerField;
    CAD_SQ_C_PARbanco: TIntegerField;
    CAD_SQ_C_PARagencia: TWideStringField;
    CAD_SQ_C_PARconta_corrente: TWideStringField;
    CAD_SQ_C_PARagencia_dig: TIntegerField;
    CAD_SQ_C_PARconta_corrente_dig: TIntegerField;
    CAD_SQ_C_AUS: TSQLDataSet;
    CAD_SQ_C_AUSid_aus: TIntegerField;
    CAD_SQ_C_AUSid_empresa: TIntegerField;
    CAD_SQ_C_AUSid_funcionario: TIntegerField;
    CAD_DP_C_AUS: TDataSetProvider;
    CAD_DS_C_AUS: TDataSource;
    CAD_SQ_C_AUS_PRG: TSQLDataSet;
    CAD_SQ_C_AUS_PRGid_aus: TIntegerField;
    CAD_SQ_C_AUS_PRGid_perfil_seg: TIntegerField;
    CAD_SQ_C_AUS_PRGformulario: TWideStringField;
    CAD_SQ_C_AUS_PRGchave: TWideStringField;
    CAD_SQ_C_AUS_PRGid_empresa: TIntegerField;
    CAD_SQ_C_AUS_PRGadicionar: TBooleanField;
    CAD_SQ_C_AUS_PRGalterar: TBooleanField;
    CAD_SQ_C_AUS_PRGexcluir: TBooleanField;
    CAD_SQ_C_AUS_PRGconsulta: TBooleanField;
    CAD_SQ_C_AUS_PRGid_aus_prg: TIntegerField;
    CAD_SQ_C_AUSint_nomefuncionario: TWideStringField;
    CAD_SQ_C_AUSint_perfilseg: TWideStringField;
    FAT_SQ_M_ROMmdf_encerrado: TBooleanField;
    CAD_SQ_C_ITE_COJid_cor: TIntegerField;
    CAD_SQ_C_ITE_COJid_tamanho: TIntegerField;
    CAD_SQ_C_ITE_COJint_nomecor: TWideStringField;
    CAD_SQ_C_ITE_COJint_nometam: TWideStringField;
    EST_SQ_M_FESdata_ult_compra: TDateField;
    CAD_SQ_C_FPGdias_vencimento: TIntegerField;
    CAD_SQ_C_AUS_PRGmenu: TWideStringField;
    CAD_SQ_C_AUS_PRGmodulo: TWideStringField;
    CAD_SQ_C_AUS_PRGdescricao: TWideStringField;
    PCP_SQ_M_ROM_PEDqtde_total_item_conj: TFloatField;
    PCP_SQ_M_ROM_PED_ICFitem_conjugado: TBooleanField;
    PCP_SQ_M_ROM_PEDqtde_total_item_conj_conf: TFloatField;
    CAD_SQ_C_VEIid_cliente: TIntegerField;
    CAD_SQ_C_VEIint_nomecli: TWideStringField;
    FAT_SQ_M_XMLvlr_desconto: TFMTBCDField;
    FIN_SQ_M_CON_CXB_DETvlr_desconto: TFMTBCDField;
    CAD_SQ_C_GRUsgq_inf_qtde_ite_carg: TBooleanField;
    CAD_SQ_C_FORfin_conta_dig: TWideStringField;
    FAT_SQ_M_PEDvlr_credito: TFMTBCDField;
    CAD_SQ_C_PAR_CTRped_id_forma_pag_rcr: TIntegerField;
    FIN_SQ_M_RBX_TITdta_novo_venc: TDateField;
    PCP_SQ_M_ROM_PED_ICJ: TSQLDataSet;
    PCP_SQ_M_ROM_PED_ICJid_rom: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_pedido: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_sequencia: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_item: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_cor: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_tamanho: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJid_responsavel: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJdta_conferencia: TDateField;
    PCP_SQ_M_ROM_PED_ICJhor_conferencia: TTimeField;
    PCP_SQ_M_ROM_PED_ICJid_ped_ite: TIntegerField;
    PCP_SQ_M_ROM_PED_ICJqtde_a_inserir: TFloatField;
    PCP_SQ_M_ROM_PED_ICJqtde_conf: TFloatField;
    PCP_SQ_M_ROM_PED_ICJint_nomeite: TWideStringField;
    PCP_SQ_M_ROM_PED_ICJint_undvenda: TWideStringField;
    PCP_SQ_M_ROM_PED_ICJint_nomecor: TWideStringField;
    PCP_SQ_M_ROM_PED_ICJint_nometam: TWideStringField;
    FIN_DP_R_PAG_SLD: TDataSetProvider;
    FIN_SQ_R_PAG_SLD: TSQLDataSet;
    PCP_SQ_M_ROM_PED_ITEqtde_conj: TFloatField;
    PCP_SQ_M_ROM_PED_ITEqtde_conj_conf: TFloatField;
    CAD_SQ_C_CLIper_comissao: TFloatField;
    OFI_SQ_M_ORVid_fiscal_ref_entrada: TIntegerField;
    PCP_SQ_M_OPR_OPSobs_producao: TWideStringField;
    PCP_SQ_M_OPR_OPSint_nomegru: TWideStringField;
    PCP_SQ_M_OPR_OPSint_id_grupo_ibb: TWideStringField;
    CAD_SQ_C_PAR_CTReff_layout: TIntegerField;
    BUS_SQ_C_PAR_CTReff_layout: TIntegerField;
    BUS_DS_C_VIT_CON: TDataSource;
    BUS_SQ_C_VIT_FOT_CON: TSQLDataSet;
    BUS_SQ_C_VIT_FOT_CONid_visita: TIntegerField;
    BUS_SQ_C_VIT_FOT_CONid_vit_fot: TIntegerField;
    BUS_SQ_C_VIT_FOT_CONcaminho_foto: TWideStringField;
    BUS_SQ_C_VIT_FOT_CONobs: TWideStringField;
    CAD_SQ_R_VIT: TSQLDataSet;
    CAD_DP_R_VIT: TDataSetProvider;
    CAD_SQ_R_VITid_visita: TIntegerField;
    CAD_SQ_R_VITid_vendedor: TIntegerField;
    CAD_SQ_R_VITdoc_cnpj_cpf: TWideStringField;
    CAD_SQ_R_VITid_veiculo: TIntegerField;
    CAD_SQ_R_VITdta_visita: TDateField;
    CAD_SQ_R_VITobs: TWideStringField;
    CAD_SQ_R_VITrecomendacoes: TWideStringField;
    CAD_SQ_R_VITid_empresa: TIntegerField;
    CAD_SQ_R_VITgps_latitude: TFloatField;
    CAD_SQ_R_VITgps_longitude: TFloatField;
    CAD_SQ_R_VIThor_ini: TTimeField;
    CAD_SQ_R_VIThor_fim: TTimeField;
    CAD_SQ_R_VITsemana: TIntegerField;
    CAD_SQ_R_VITplaca: TWideStringField;
    CAD_SQ_R_VITid_pedido_mobile: TIntegerField;
    CAD_SQ_R_VITtipo_mobile: TIntegerField;
    CAD_SQ_R_VITremarcar_vis: TBooleanField;
    CAD_SQ_R_VITdta_prox_vis: TDateField;
    CAD_SQ_R_VITsemana_prox_vis: TIntegerField;
    CAD_SQ_R_VITkm_final: TFloatField;
    CAD_SQ_R_VITkm_inicial: TFloatField;
    CAD_SQ_R_VITid_funcionario: TIntegerField;
    CAD_SQ_C_CLI_PRO_CUL: TSQLDataSet;
    CAD_SQ_C_CLI_PRO_CULid_cliente: TIntegerField;
    CAD_SQ_C_CLI_PRO_CULid_propriedade: TIntegerField;
    CAD_SQ_C_CLI_PRO_CULlote: TWideStringField;
    CAD_SQ_C_CLI_PRO_CULid_cultura: TIntegerField;
    CAD_SQ_C_CLI_PRO_CULidade: TSmallintField;
    CAD_SQ_C_CLI_PRO_CULarea: TFloatField;
    CAD_SQ_C_CLI_PRO_CULprodutividade: TFloatField;
    CAD_SQ_C_CLI_PRO_CULobs: TWideStringField;
    CAD_SQ_C_CLI_PRO_CULvariedade: TWideStringField;
    CAD_SQ_C_CLI_PRO_CULproducao_estimada: TFloatField;
    CAD_SQ_C_CLI_PRO_CULint_nomecultura: TWideStringField;
    CAD_DS_C_CLI_PRO: TDataSource;
    FIN_SQ_M_DCT_TITint_vlr_parcela: TFMTBCDField;
    FIN_SQ_M_DCTcan_motivo: TWideStringField;
    FIN_SQ_M_DCTcancelado: TBooleanField;
    FIN_SQ_M_DCT_TITvlr_taxa_desc: TFMTBCDField;
    FIN_SQ_M_RECdct_id_local_titulo: TIntegerField;
    FIN_SQ_M_RECdct_id_desc: TIntegerField;
    BUS_DP_M_DCT_TIT: TDataSetProvider;
    BUS_SQ_M_DCT_TIT: TSQLDataSet;
    BUS_SQ_C_PES_MOD: TSQLDataSet;
    BUS_SQ_C_PES_MODid_perfil_seg: TIntegerField;
    BUS_SQ_C_PES_MODformulario: TWideStringField;
    BUS_SQ_C_PES_MODativo: TBooleanField;
    BUS_SQ_C_PES_MODchave: TWideStringField;
    BUS_SQ_C_PES_MODdescricao: TWideStringField;
    BUS_SQ_C_PES_MODmenu: TWideStringField;
    BUS_SQ_C_PES_MODmodulo: TWideStringField;
    BUS_SQ_C_PES_MODmodulo_desc: TWideStringField;
    BUS_DP_C_PES_MOD: TDataSetProvider;
    BUS_SQ_C_PES_MODint_perfilseg: TWideStringField;
    FIN_SQ_R_EXT_CLI_RPC: TSQLDataSet;
    FIN_DP_R_EXT_CLI_RPC: TDataSetProvider;
    FIN_SQ_R_EXT_CLI_RPCid_cliente: TIntegerField;
    FIN_SQ_R_EXT_CLI_RPCnome: TWideStringField;
    FIN_SQ_R_EXT_CLI_RPCsaldo: TFMTBCDField;
    BUS_DP_C_ITE_COM: TDataSetProvider;
    BUS_SQ_C_ITE_COM: TSQLDataSet;
    CAD_SQ_C_PAR_MODtor: TBooleanField;
    CAD_SQ_C_PAR_CTRperm_bxa_rec_n_tit: TBooleanField;
    BUS_SQ_M_RECdct_id_desc: TIntegerField;
    CAD_SQ_C_FUNtipo: TIntegerField;
    FAT_SQ_M_XMLvlr_outras_desp: TFMTBCDField;
    CAD_SQ_C_VIT_KMTkm_inicial_orig: TFloatField;
    CAD_SQ_C_VIT_KMTkm_final_orig: TFloatField;
    FIN_DP_R_CXA_DIA_MTF: TDataSetProvider;
    FIN_SQ_R_CXA_DIA_MTF: TSQLDataSet;
    CAD_SQ_C_VIS_CLIid_cliente: TIntegerField;
    CAD_SQ_C_VITid_cliente: TIntegerField;
    CAD_SQ_C_ITEint_inf_tempo_ite_coj: TBooleanField;
    CAD_SQ_C_UNDinf_tempo_ite_coj: TBooleanField;
    CAD_SQ_R_VITint_nomevendedor: TWideStringField;
    EST_SQ_M_FEAcoj_ite_hrq: TWideStringField;
    CAD_SQ_C_AUSint_id_perfilseg: TIntegerField;
    BUS_SQ_CSU_ITEint_ctc_epi: TBooleanField;
    CAD_SQ_C_ITEint_ctc_epi: TBooleanField;
    EST_SQ_M_FEAid_seq_coj: TIntegerField;
    CAD_SQ_C_ITE_COJint_inf_tempo_ite_coj: TBooleanField;
    BUS_SQ_M_RECint_situacao_titulo: TWideStringField;
    BUS_SQ_M_PAGint_situacao_titulo: TWideStringField;
    FAT_DP_R_GAM_INV_ITE: TDataSetProvider;
    FAT_SQ_R_GAM_INV_ITE: TSQLDataSet;
    EST_SQ_M_MAL_ITEvlr_unitario: TFMTBCDField;
    EST_SQ_M_MAL_ITEvlr_total: TFMTBCDField;
    EST_DP_R_MAL: TDataSetProvider;
    EST_SQ_R_MAL: TSQLDataSet;
    CAD_SQ_C_ITE_COJqtde_tempo: TWideStringField;
    FIN_SQ_R_PCP_FOR: TSQLDataSet;
    FIN_DP_R_PCP_FOR: TDataSetProvider;
    FIN_SQ_R_PCP_OBR: TSQLDataSet;
    FIN_DP_R_PCP_OBR: TDataSetProvider;
    FIN_SQ_R_PCP_PCT: TSQLDataSet;
    FIN_DP_R_PCP_PCT: TDataSetProvider;
    OFI_SQ_M_ORV_ITEid_ordem_subst: TIntegerField;
    OFI_SQ_M_ORVint_selecao: TBooleanField;
    BUS_DP_M_ORV: TDataSetProvider;
    BUS_SQ_M_ORV: TSQLDataSet;
    EST_SQ_M_FEAid_ordem_asub: TIntegerField;
    OFI_SQ_M_ORVordem_substituicao: TBooleanField;
    BUS_SQ_M_ORVid_ordem: TIntegerField;
    BUS_SQ_M_ORVid_empresa: TIntegerField;
    BUS_SQ_M_ORVdta_emissao: TDateField;
    BUS_SQ_M_ORVdta_entrega: TDateField;
    BUS_SQ_M_ORVid_cliente: TIntegerField;
    BUS_SQ_M_ORVid_veiculo: TIntegerField;
    BUS_SQ_M_ORVkm_atual: TIntegerField;
    BUS_SQ_M_ORVtanque_combus: TIntegerField;
    BUS_SQ_M_ORVid_forma_pag: TIntegerField;
    BUS_SQ_M_ORVid_condicao_pag: TIntegerField;
    BUS_SQ_M_ORVid_analista: TIntegerField;
    BUS_SQ_M_ORVid_orcamento: TIntegerField;
    BUS_SQ_M_ORVobs_reclamacao: TWideStringField;
    BUS_SQ_M_ORVobs_problema: TWideStringField;
    BUS_SQ_M_ORVstatus: TIntegerField;
    BUS_SQ_M_ORVvlr_produtos: TFMTBCDField;
    BUS_SQ_M_ORVvlr_desc_produtos: TFMTBCDField;
    BUS_SQ_M_ORVper_desc_produtos: TFloatField;
    BUS_SQ_M_ORVvlr_prod_liquido: TFMTBCDField;
    BUS_SQ_M_ORVvlr_serv_bruto: TFMTBCDField;
    BUS_SQ_M_ORVvlr_desc_servicos: TFMTBCDField;
    BUS_SQ_M_ORVper_desc_servicos: TFloatField;
    BUS_SQ_M_ORVvlr_ser_liquido: TFMTBCDField;
    BUS_SQ_M_ORVvlr_terceiro: TFMTBCDField;
    BUS_SQ_M_ORVvlr_desc_terceiro: TFMTBCDField;
    BUS_SQ_M_ORVper_desc_terceiro: TFloatField;
    BUS_SQ_M_ORVvlr_terc_liquido: TFMTBCDField;
    BUS_SQ_M_ORVvlr_despesas: TFMTBCDField;
    BUS_SQ_M_ORVvlr_credito: TFMTBCDField;
    BUS_SQ_M_ORVvlr_total: TFMTBCDField;
    BUS_SQ_M_ORVid_tipo_os: TIntegerField;
    BUS_SQ_M_ORVid_responsavel: TIntegerField;
    BUS_SQ_M_ORVcan_usuario: TIntegerField;
    BUS_SQ_M_ORVcan_data: TDateField;
    BUS_SQ_M_ORVcan_motivo: TWideStringField;
    BUS_SQ_M_ORVcan_hora: TTimeField;
    BUS_SQ_M_ORVrea_usuario: TIntegerField;
    BUS_SQ_M_ORVrea_data: TDateField;
    BUS_SQ_M_ORVrea_hora: TTimeField;
    BUS_SQ_M_ORVrea_motivo: TWideStringField;
    BUS_SQ_M_ORVdta_fechamento: TDateField;
    BUS_SQ_M_ORVid_almoxarifado: TIntegerField;
    BUS_SQ_M_ORVvlr_cred_produtos: TFMTBCDField;
    BUS_SQ_M_ORVvlr_cred_servicos: TFMTBCDField;
    BUS_SQ_M_ORVobservacoes: TWideStringField;
    BUS_SQ_M_ORVstatus_painel: TIntegerField;
    BUS_SQ_M_ORVhor_emissao: TTimeField;
    BUS_SQ_M_ORVhor_fechamento: TTimeField;
    BUS_SQ_M_ORVsepara_prod_serv: TBooleanField;
    BUS_SQ_M_ORVid_equipamento: TIntegerField;
    BUS_SQ_M_ORVtipo_ordem: TIntegerField;
    BUS_SQ_M_ORVchassi: TWideStringField;
    BUS_SQ_M_ORVid_ordem_orig_gar: TIntegerField;
    BUS_SQ_M_ORVid_fiscal_ref_entrada: TIntegerField;
    BUS_SQ_M_ORVordem_substituicao: TBooleanField;
    BUS_SQ_M_ORVint_cpfcnpj: TWideStringField;
    BUS_SQ_M_ORVint_pessoacli: TIntegerField;
    BUS_SQ_M_ORVint_nomecli: TWideStringField;
    BUS_SQ_M_ORVint_telfix: TWideStringField;
    BUS_SQ_M_ORVint_telmov: TWideStringField;
    BUS_SQ_M_ORVint_nomecom: TWideMemoField;
    BUS_SQ_M_ORVint_placa: TWideStringField;
    BUS_SQ_M_ORVint_nomevei: TWideStringField;
    BUS_SQ_M_ORVint_nometio: TWideStringField;
    BUS_SQ_M_ORVint_tipo_os: TIntegerField;
    BUS_SQ_M_ORVint_ufcli: TWideStringField;
    BUS_SQ_M_ORVint_nomemve: TWideStringField;
    BUS_SQ_M_ORVint_statuspainel: TWideStringField;
    BUS_SQ_M_ORVint_nomeeqp: TWideStringField;
    CMP_SQ_M_SOL_ITEdesc_item: TWideStringField;
    CMP_SQ_M_SOL_ITEund_item: TWideStringField;
    CAD_SQ_C_PAR_CTRsubstituir_os: TBooleanField;
    FIN_DP_R_CSC_EMP: TDataSetProvider;
    FIN_SQ_R_CSC_EMP: TSQLDataSet;
    FIN_SQ_M_REC_PAGvlr_tarifa: TFMTBCDField;
    FAT_SQ_R_VIS: TSQLDataSet;
    FAT_DP_R_VIS: TDataSetProvider;
    FAT_SQ_M_PEDvlr_desc_especial: TFMTBCDField;
    FAT_SQ_M_PEDvlr_desc_basico: TFMTBCDField;
    FAT_SQ_M_XMLvlr_icms: TFMTBCDField;
    FAT_SQ_M_XMLvlr_Base: TFMTBCDField;
    CAD_SQ_C_PAR_NFErps_nat_opr: TWideStringField;
    FAT_SQ_M_NFEint_doc_im: TWideMemoField;
    CAD_SQ_C_PAR_NFErps_prefeitura: TWideStringField;
    CAD_SQ_C_PAR_NFErps_cod_cnae: TWideStringField;
    BUS_SQ_C_ANV: TSQLDataSet;
    BUS_DP_C_ANV: TDataSetProvider;
    FAT_SQ_M_NFEnum_rps: TIntegerField;
    CAD_SQ_C_FUNaniversariante_mes: TBooleanField;
    FAT_SQ_R_NFE_DPI: TSQLDataSet;
    FAT_DP_R_NFE_DPI: TDataSetProvider;
    CAD_SQ_C_PAR_CTRinformar_caixa_nfe: TBooleanField;
    CAD_SQ_C_CPGperm_desc_especial: TBooleanField;
    CAD_SQ_C_PAR_CTRper_desc_especial: TFloatField;
    CAD_SQ_C_PAR_CTRorv_gera_fin_separado: TBooleanField;
    CAD_SQ_C_PAR_CTRnfe_id_tipo_financeiro: TIntegerField;
    FIN_SQ_M_PAG_PAGid_fiscal: TIntegerField;
    BUS_SQ_C_PAR_CTRnfe_id_tipo_financeiro: TIntegerField;
    FIN_SQ_M_PAGint_tipopag: TIntegerField;
    FAT_SQ_R_VISid_vis: TIntegerField;
    FAT_SQ_R_VISsemana: TIntegerField;
    FAT_SQ_R_VISid_vendedor: TIntegerField;
    FAT_SQ_R_VISfechada: TBooleanField;
    FAT_SQ_R_VISid_empresa: TIntegerField;
    FAT_SQ_R_VISano: TIntegerField;
    FAT_SQ_R_VISdta_criacao: TDateField;
    FAT_SQ_R_VISint_nomeven: TWideStringField;
    FAT_SQ_R_VISint_nomecli: TWideStringField;
    FAT_SQ_R_VISdoc_cnpj_cpf: TWideStringField;
    FAT_SQ_R_VISdta_visita: TDateField;
    FAT_SQ_R_VISid_cliente: TIntegerField;
    FAT_SQ_R_VISid_vis_cli: TIntegerField;
    CAD_SQ_C_CLIgps_latitude: TFloatField;
    CAD_SQ_C_CLIgps_longitude: TFloatField;
    CAD_SQ_C_PARgps_latitude: TFloatField;
    CAD_SQ_C_PARgps_longitude: TFloatField;
    CAD_SQ_C_ITEper_cmv_interno: TFMTBCDField;
    CAD_SQ_C_ITEper_cmv_externo: TFMTBCDField;
    CAD_SQ_C_PAR_NFEnfe_permite_salv_xml: TBooleanField;
    FAT_SQ_M_NFE_ARQ: TSQLDataSet;
    FAT_SQ_M_NFE_ARQid_fiscal: TIntegerField;
    FAT_SQ_M_NFE_ARQarq_xml: TBlobField;
    BUS_SQ_M_NFE_ITE_INTper_cmv_interno: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTper_cmv_externo: TFMTBCDField;
    BUS_SQ_M_NFE_INTind_nf: TIntegerField;
    BUS_SQ_M_NFE_INTvlr_icm_desc: TFMTBCDField;
    OFI_SQ_M_ORVorv_gera_fin_separado: TBooleanField;
    FAT_SQ_M_NFE_ITEper_cmv: TFMTBCDField;
    CAD_SQ_C_PAR_CTRhab_vlr_custo_cte: TBooleanField;
    CAD_SQ_R_VITcod_cliente: TIntegerField;
    CAD_SQ_R_VITint_nomecliente: TWideStringField;
    CSU_SQ_M_AUD: TSQLDataSet;
    CSU_SQ_M_AUDdta_servidor: TDateField;
    CSU_SQ_M_AUDhor_servidor: TTimeField;
    CSU_SQ_M_AUDarq_auditoria: TBlobField;
    CSU_SQ_M_AUDid_usuario: TIntegerField;
    CSU_SQ_M_AUDid_empresa: TIntegerField;
    CSU_SQ_M_AUDprograma: TWideStringField;
    CSU_SQ_M_AUDid_aud: TIntegerField;
    CSU_DP_M_AUD: TDataSetProvider;
    CSU_SQ_M_AUDint_nomefun: TWideStringField;
    CSU_SQ_M_AUDint_empresa: TWideStringField;
    BUS_SQ_M_NFE_ITE_INTper_cmv: TFMTBCDField;
    FAT_DP_R_PVE_QTD_CLI: TDataSetProvider;
    FAT_SQ_R_PVE_QTD_CLI: TSQLDataSet;
    BUS_SQ_M_PRO: TSQLDataSet;
    BUS_DP_M_PRO: TDataSetProvider;
    BUS_SQ_M_PROformulario: TWideStringField;
    BUS_SQ_M_PROmenu: TWideStringField;
    BUS_SQ_M_PROdescricao: TWideStringField;
    BUS_SQ_M_PROmodulo: TWideStringField;
    CAD_SQ_C_CTCimp_msg_juros_mora: TBooleanField;
    CAD_SQ_C_PAR_NFEnfe_separar_xml_mes: TBooleanField;
    CAD_SQ_C_CFOdesc_nat_operacao_nfe: TWideStringField;
    FAT_SQ_M_NFEint_natope_nfe: TWideStringField;
    FAT_DP_R_COV_FAT_PED: TDataSetProvider;
    FAT_SQ_R_COV_FAT_PED: TSQLDataSet;
    FAT_SQ_M_PEDsgq_per_comissao: TFloatField;
    CAD_SQ_C_PAR_CTRsgq_tipo_comissao: TIntegerField;
    CAD_SQ_C_PAR_CTRsgq_per_comissao_max: TFloatField;
    CAD_SQ_C_FPGqtde_red_parc_car_rec: TIntegerField;
    CAD_SQ_C_PAR_CTRperm_bxa_pag_n_tit: TBooleanField;
    BUS_SQ_M_PAGint_selecao: TBooleanField;
    CAD_SQ_C_PAR_CTRpbx_gravar_obs_tit: TBooleanField;
    CAD_SQ_C_PAR_CTRrbx_gravar_obs_tit: TBooleanField;
    BUS_SQ_C_PAR_CTRpbx_gravar_obs_tit: TBooleanField;
    BUS_SQ_C_PAR_CTRrbx_gravar_obs_tit: TBooleanField;
    FIN_SQ_M_PBX_TITint_historico: TWideStringField;
    FIN_SQ_M_RBX_TITint_historico: TWideStringField;
    FAT_SQ_R_PVE_AXC: TSQLDataSet;
    FAT_DP_R_PVE_AXC: TDataSetProvider;
    FAT_DP_R_PVE_AXP: TDataSetProvider;
    FAT_SQ_R_PVE_AXP: TSQLDataSet;
    FAT_SQ_R_PVE_AXV: TSQLDataSet;
    FAT_DP_R_PVE_AXV: TDataSetProvider;
    FAT_DP_R_PVE_AXD: TDataSetProvider;
    FAT_SQ_R_PVE_AXD: TSQLDataSet;
    FIN_SQ_M_PBX_TITint_cod_plano: TWideStringField;
    FIN_SQ_M_PBX_TITint_nomepct: TWideStringField;
    FAT_SQ_M_XMLipi_valor: TFMTBCDField;
    FAT_SQ_M_XMLicm_s_valor: TFMTBCDField;
    FAT_DP_R_COV_FAT_ITE: TDataSetProvider;
    FAT_SQ_R_COV_FAT_ITE: TSQLDataSet;
    CAD_SQ_C_PAR_CTRnfce_permite_cheque: TBooleanField;
    FAT_SQ_M_XMLnref_chave: TWideStringField;
    FAT_SQ_M_XMLnfe_finalidade: TIntegerField;
    CAD_SQ_C_PAR_CTRdta_pag_ret_banco: TIntegerField;
    BUS_SQ_C_PAR_CTRdta_pag_ret_banco: TIntegerField;
    PCP_SQ_M_ETQid_epp: TIntegerField;
    CAD_SQ_C_PAR_NFEativar_nat_ope_nfe_comp: TBooleanField;
    CAD_SQ_C_PAR_NFEinf_nat_ope_nfe_comp: TWideStringField;
    FAT_SQ_M_PED_ITEint_selecao: TBooleanField;
    FAT_SQ_M_PEDint_sitped2: TWideStringField;
    PCP_SQ_M_ROM_PED_ITEint_qtde_ped_ite: TFloatField;
    CAD_SQ_C_PAR_CTRfrete_fob_total_ped: TBooleanField;
    PCP_SQ_M_ETQpcp_obs_item: TWideStringField;
    PCP_SQ_M_ETQint_nomeite_pers: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTpcp_desc_item_person: TWideStringField;
    PCP_SQ_M_ROM_PED_ITEint_nomeite: TWideStringField;
    PCP_SQ_M_ETQint_nomeite: TWideStringField;
    PCP_SQ_M_ROM_PED_ICFint_nomeite: TWideStringField;
    FAT_SQ_M_PED_ITEvlr_frete: TFMTBCDField;
    BUS_SQ_C_PAR_CTRfrete_fob_total_ped: TBooleanField;
    PCP_SQ_M_ACRid_pedido_venda: TIntegerField;
    PCP_SQ_M_ETQint_etiq_marca: TWideStringField;
    PCP_SQ_M_ETQint_num_lote_opr: TWideStringField;
    FAT_SQ_M_NFE_ITEmotivo_icms_des: TIntegerField;
    CAD_SQ_C_PAR_NFEpath_logo_prefeitura: TWideStringField;
    FAT_SQ_M_XML_ITEmotivo_icms_des: TIntegerField;
    CAD_SQ_C_CLI_VEI: TSQLDataSet;
    CAD_SQ_C_CLI_VEIid_cliente: TIntegerField;
    CAD_SQ_C_CLI_VEIid_veiculo: TIntegerField;
    CAD_SQ_C_CLI_VEIint_placa: TWideStringField;
    CAD_SQ_C_CLI_VEIint_descricao: TWideStringField;
    EST_SQ_M_CTE_ITEint_rua: TWideStringField;
    EST_SQ_M_CTE_ITEint_prateleira: TWideStringField;
    EST_SQ_M_CTE_ITEint_escaninho: TWideStringField;
    FAT_SQ_R_VISint_id_vis_cli: TIntegerField;
    EST_SQ_M_CTEoffline: TBooleanField;
    CAD_SQ_C_PAR_CTRsgq_calc_sld_produzir_opr: TBooleanField;
    BUS_SQ_C_PAR_CTRsgq_calc_sld_produzir_opr: TBooleanField;
    CAD_SQ_C_FUN_EMP: TSQLDataSet;
    CAD_SQ_C_FUN_EMPid_funcionario: TIntegerField;
    CAD_SQ_C_FUN_EMPid_empresa: TIntegerField;
    CAD_SQ_C_FUN_EMPpermitir_acesso: TBooleanField;
    CAD_SQ_C_FUN_EMPint_empfantasia: TWideStringField;
    CAD_SQ_C_PAR_CTRcalcular_iss_retido: TBooleanField;
    FAT_SQ_M_NFEiss_valor_retido: TFMTBCDField;
    OFI_SQ_M_ORViss_valor_retido: TFMTBCDField;
    FAT_SQ_M_NFEint_substituto_tributario: TBooleanField;
    CAD_SQ_C_CLIsubstituto_tributario: TBooleanField;
    OFI_SQ_M_ORVint_subst_trib: TBooleanField;
    PCP_SQ_M_ETQint_nomecle: TWideStringField;
    FAT_SQ_M_NFEint_tot_vlr_bruto: TFMTBCDField;
    FAT_SQ_M_NFEint_tot_vlr_liquido: TFMTBCDField;
    ctc_sq_m_bdeqtde_combustivel: TFloatField;
    CAD_SQ_C_FUNsgq_reimprime_etq: TBooleanField;
    PCP_SQ_M_ETQdta_reimpressa: TDateField;
    PCP_SQ_M_ETQhor_reimpressa: TTimeField;
    PCP_SQ_M_ETQid_func_reimpressa: TIntegerField;
    PCP_SQ_M_ETQmotivo_reimpressa: TWideStringField;
    PCP_SQ_M_ETQint_nome_func_reimp: TWideStringField;
    BUS_SQ_M_OPR_OPP_INTsaldo_fisico_momento: TFloatField;
    BUS_SQ_M_OPR_OPP_INTsaldo_pendente: TFloatField;
    BUS_SQ_M_OPR_OPP_INTsaldo_disponivel_est: TFloatField;
    BUS_SQ_M_OPR_OPP_INTsaldo_disp_outras_opr: TFloatField;
    CAD_SQ_C_ITE_LOC: TSQLDataSet;
    CAD_SQ_C_ITE_LOCid_item: TIntegerField;
    CAD_SQ_C_ITE_LOCid_empresa: TIntegerField;
    PCP_SQ_M_EPP_ITEint_numlote_opr: TWideStringField;
    PCP_SQ_M_OPR_OPPint_rest_a_produzir: TFloatField;
    PCP_SQ_M_OPR_OPPsaldo_fisico_momento: TFloatField;
    PCP_SQ_M_OPR_OPPsaldo_pendente: TFloatField;
    PCP_SQ_M_OPR_OPPsaldo_disponivel_est: TFloatField;
    PCP_SQ_M_OPR_OPPsaldo_disp_outras_opr: TFloatField;
    ctc_ds_c_obr: TDataSource;
    ctc_sq_c_obr_eqp: TSQLDataSet;
    ctc_sq_c_obr_crg: TSQLDataSet;
    ctc_sq_c_obr_eqpid_obra: TIntegerField;
    ctc_sq_c_obr_eqpid_obra_seq: TIntegerField;
    ctc_sq_c_obr_eqpid_meq: TIntegerField;
    ctc_sq_c_obr_eqpvalor: TFMTBCDField;
    ctc_sq_c_obr_eqpint_nome_eqp: TWideStringField;
    ctc_sq_c_obr_crgid_obra: TIntegerField;
    ctc_sq_c_obr_crgid_cargo: TIntegerField;
    ctc_sq_c_obr_crgqtde_func: TIntegerField;
    ctc_sq_c_obr_crgvalor: TFMTBCDField;
    ctc_sq_c_obr_crgint_nome_crg: TWideStringField;
    BUS_SQ_M_OPR_QTD_TOT_ITE: TSQLDataSet;
    BUS_DP_M_OPR_QTD_TOT_ITE: TDataSetProvider;
    BUS_SQ_M_OPR_QTD_ITE_PED: TSQLDataSet;
    BUS_DP_M_OPR_QTD_ITE_PED: TDataSetProvider;
    BUS_DP_M_EST_ALM_PEN: TDataSetProvider;
    BUS_SQ_M_EST_ALM_PEN: TSQLDataSet;
    CAD_SQ_C_CLI_EML: TSQLDataSet;
    CAD_SQ_C_CLI_EMLid_cliente: TIntegerField;
    CAD_SQ_C_CLI_EMLemail: TWideStringField;
    FAT_SQ_M_NFE_ITEiss_valor_retido: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_base_icms_dest: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTiss_valor_retido: TFMTBCDField;
    BUS_SQ_M_NFE_ITE_INTvlr_base_icms_dest: TFMTBCDField;
    BUS_SQ_C_CLI_EML: TSQLDataSet;
    BUS_DP_C_CLI_EML: TDataSetProvider;
    ctc_sq_m_cep_epidta_entrega: TDateField;
    ctc_sq_m_cep_epiqtde: TIntegerField;
    CTC_SQ_R_OBR_CRG: TSQLDataSet;
    CTC_SQ_R_OBR_EQP: TSQLDataSet;
    CAD_SQ_C_ALMid_obra: TIntegerField;
    CAD_SQ_C_ALMint_nomeobr: TWideStringField;
    PCP_DP_R_EPP: TDataSetProvider;
    PCP_SQ_R_EPP: TSQLDataSet;
    ctc_sq_c_obr_eqpdta_ini_contrato: TDateField;
    ctc_sq_c_obr_eqpdta_fim_contrato: TDateField;
    ctc_sq_c_obr_eqpobs: TWideStringField;
    ctc_sq_c_obr_crgdta_ini_contrato: TDateField;
    ctc_sq_c_obr_crgdta_fim_contrato: TDateField;
    ctc_sq_c_obr_crgobs: TWideStringField;
    ctc_sq_c_obr_crgid_obra_crg: TIntegerField;
    ctc_sq_c_obr_ite: TSQLDataSet;
    ctc_sq_c_obr_iteid_obra: TIntegerField;
    ctc_sq_c_obr_iteid_obra_ite: TIntegerField;
    ctc_sq_c_obr_iteid_item: TIntegerField;
    ctc_sq_c_obr_itedta_ini_contrato: TDateField;
    ctc_sq_c_obr_itedta_fim_contrato: TDateField;
    ctc_sq_c_obr_iteobs: TWideStringField;
    ctc_sq_c_obr_itevalor: TFMTBCDField;
    ctc_sq_c_obr_iteint_nomeite: TWideStringField;
    ctc_sq_c_obr_iteint_undvenda: TWideStringField;
    CTC_SQ_R_OBR_ITE: TSQLDataSet;
    CAD_SQ_C_ITEsgq_tamanho_ite_epp: TFloatField;
    CAD_DS_C_FAM: TDataSource;
    CAD_SQ_C_FAM_EMP: TSQLDataSet;
    CAD_SQ_C_FAM_EMPid_familia: TIntegerField;
    CAD_SQ_C_FAM_EMPid_empresa: TIntegerField;
    CAD_SQ_C_FAM_EMPfaz_corr_preco_perfil: TBooleanField;
    CAD_DS_C_PEC: TDataSource;
    CAD_SQ_C_PEC_EMP: TSQLDataSet;
    CAD_SQ_C_PEC_EMPid_perfil_cli: TIntegerField;
    CAD_SQ_C_PEC_EMPid_empresa: TIntegerField;
    CAD_SQ_C_PEC_EMPper_correcao: TFloatField;
    CAD_SQ_C_PEC_EMPper_correcao_aprazo: TFloatField;
    CAD_SQ_C_PEC_EMPper_correcao_financeiro: TFloatField;
    CAD_SQ_C_ITEetiq_marca: TWideStringField;
    CTC_SQ_R_OBR: TSQLDataSet;
    CTC_DP_R_OBR: TDataSetProvider;
    CTC_SQ_R_OBR_CRGint_nomteobr: TWideStringField;
    CTC_SQ_R_OBR_CRGid_obra: TIntegerField;
    CTC_SQ_R_OBR_CRGid_cargo: TIntegerField;
    CTC_SQ_R_OBR_CRGqtde_func: TIntegerField;
    CTC_SQ_R_OBR_CRGvalor: TFMTBCDField;
    CTC_SQ_R_OBR_CRGdta_ini_contrato: TDateField;
    CTC_SQ_R_OBR_CRGdta_fim_contrato: TDateField;
    CTC_SQ_R_OBR_CRGobs: TWideStringField;
    CTC_SQ_R_OBR_CRGid_obra_crg: TIntegerField;
    CTC_SQ_R_OBR_CRGint_nomecrg: TWideStringField;
    CTC_SQ_R_OBR_EQPint_nomteobr: TWideStringField;
    CTC_SQ_R_OBR_EQPid_obra: TIntegerField;
    CTC_SQ_R_OBR_EQPid_obra_seq: TIntegerField;
    CTC_SQ_R_OBR_EQPid_meq: TIntegerField;
    CTC_SQ_R_OBR_EQPvalor: TFMTBCDField;
    CTC_SQ_R_OBR_EQPdta_ini_contrato: TDateField;
    CTC_SQ_R_OBR_EQPdta_fim_contrato: TDateField;
    CTC_SQ_R_OBR_EQPobs: TWideStringField;
    CTC_SQ_R_OBR_EQPint_nomeeqp: TWideStringField;
    CTC_SQ_R_OBR_ITEint_nomteobr: TWideStringField;
    CTC_SQ_R_OBR_ITEid_obra: TIntegerField;
    CTC_SQ_R_OBR_ITEid_obra_ite: TIntegerField;
    CTC_SQ_R_OBR_ITEid_item: TIntegerField;
    CTC_SQ_R_OBR_ITEdta_ini_contrato: TDateField;
    CTC_SQ_R_OBR_ITEdta_fim_contrato: TDateField;
    CTC_SQ_R_OBR_ITEobs: TWideStringField;
    CTC_SQ_R_OBR_ITEvalor: TFMTBCDField;
    CTC_SQ_R_OBR_ITEint_nomeite: TWideStringField;
    CTC_SQ_R_OBR_ITEint_undvenda: TWideStringField;
    CTC_DP_R_OBR_CRG: TDataSetProvider;
    CTC_DP_R_OBR_EQP: TDataSetProvider;
    CTC_DP_R_OBR_ITE: TDataSetProvider;
    CAD_SQ_C_FUNmob_alt_preco_ped: TBooleanField;
    FAT_SQ_M_PEDqtde_volume: TFloatField;
    PCP_DS_C_REG: TDataSource;
    PCP_SQ_C_REG_ITE: TSQLDataSet;
    PCP_SQ_C_REG_ITEid_regiao: TIntegerField;
    PCP_SQ_C_REG_ITEtipo: TIntegerField;
    PCP_SQ_C_REG_ITEid_grupo: TWideStringField;
    PCP_SQ_C_REG_ITEid_item: TIntegerField;
    PCP_SQ_C_REG_ITEper_desconto: TFloatField;
    PCP_SQ_C_REG_ITEint_nomeite: TWideStringField;
    PCP_SQ_C_REG_ITEint_undvenda: TWideStringField;
    PCP_SQ_C_REG_ITEint_nomegru: TWideStringField;
    FAT_SQ_M_NFEqtde_volume: TFloatField;
    CAD_SQ_C_FUNseg_per_desc_maior: TBooleanField;
    FIN_SQ_R_REC_ABE_PPGdta_original: TDateField;
    CAD_SQ_C_ITEtipo_servico: TBooleanField;
    FIN_SQ_M_MCH_CHEint_emissao: TDateField;
    FIN_SQ_M_MCHint_conta_descricao: TWideStringField;
    FIN_SQ_M_MCHint_conta_banco: TIntegerField;
    FIN_SQ_M_MCHint_conta_agencia: TWideStringField;
    FIN_SQ_M_MCHint_contacorrente: TWideStringField;
    PCP_SQ_C_MTAmob_id_empresa: TIntegerField;
    PCP_SQ_C_MTAmob_senha: TWideStringField;
    PCP_SQ_C_MTAmob_login: TWideStringField;
    FIN_DP_M_LDM: TDataSetProvider;
    FIN_SQ_M_LDM: TSQLDataSet;
    FIN_SQ_M_LDMid_ldm: TIntegerField;
    FIN_SQ_M_LDMid_conta: TIntegerField;
    FIN_SQ_M_LDMnatureza: TIntegerField;
    FIN_SQ_M_LDMid_motorista: TIntegerField;
    FIN_SQ_M_LDMid_forma_pag: TIntegerField;
    FIN_SQ_M_LDMid_plano: TWideStringField;
    FIN_SQ_M_LDMdta_emissao: TDateField;
    FIN_SQ_M_LDMdta_vencimento: TDateField;
    FIN_SQ_M_LDMnum_parcela: TWideStringField;
    FIN_SQ_M_LDMhistorico: TWideStringField;
    FIN_SQ_M_LDMvlr_titulo: TFMTBCDField;
    FIN_SQ_M_LDMlatitude: TFloatField;
    FIN_SQ_M_LDMlongitude: TFloatField;
    FIN_SQ_M_LDMmob_id_ldm: TIntegerField;
    FIN_SQ_M_LDMid_empresa: TIntegerField;
    FIN_SQ_M_LDMcaminho_foto: TWideStringField;
    FIN_SQ_M_LDMint_nome_mot: TWideStringField;
    FAT_DP_M_ETG: TDataSetProvider;
    FAT_SQ_M_ETG: TSQLDataSet;
    FAT_DS_M_ETG: TDataSource;
    FAT_SQ_M_ETG_DEV: TSQLDataSet;
    FAT_SQ_M_ETGid_entrega: TIntegerField;
    FAT_SQ_M_ETGid_pedido: TIntegerField;
    FAT_SQ_M_ETGid_forma_pag: TIntegerField;
    FAT_SQ_M_ETGvlr_pagamento: TFMTBCDField;
    FAT_SQ_M_ETGlatitude: TFloatField;
    FAT_SQ_M_ETGlongitude: TFloatField;
    FAT_SQ_M_ETGmob_id_entrega: TIntegerField;
    FAT_SQ_M_ETGid_empresa: TIntegerField;
    FAT_SQ_M_ETG_DEVid_entrega: TIntegerField;
    FAT_SQ_M_ETG_DEVid_sequencia: TIntegerField;
    FAT_SQ_M_ETG_DEVid_item: TIntegerField;
    FAT_SQ_M_ETG_DEVqtde: TFloatField;
    CAD_SQ_C_PAR_CTRmob_tipo_ordem: TIntegerField;
    FAT_SQ_M_ETGint_nomefpg: TWideStringField;
    FAT_SQ_M_ETG_DEVmotivo: TWideStringField;
    FAT_SQ_M_ETG_DEVint_nomeite: TWideStringField;
    FAT_SQ_M_ETG_DEVint_undvenda: TWideStringField;
    FIN_SQ_M_LDMint_nomefpg: TWideStringField;
    CAD_SQ_C_PAR_CTRpreco_por_perfil: TBooleanField;
    FAT_DP_R_PED_ITE_NFE: TDataSetProvider;
    FAT_SQ_R_PED_ITE_NFE: TSQLDataSet;
    CAD_SQ_C_FUNseg_cancelar_os: TBooleanField;
    CAD_SQ_C_ITEmob_nome_foto: TWideStringField;
    CAD_SQ_C_ITEfoto_temp: TBlobField;
    CAD_SQ_C_GRUmob_nome_foto: TWideStringField;
    CAD_SQ_C_GRUfoto_temp: TBlobField;
    CAD_SQ_R_VITkm_rodado: TFloatField;
    FAT_SQ_M_NFE_DEV_ITEint_icm_n_valor: TFMTBCDField;
    FAT_SQ_M_ETG_DEVint_qtde_ped: TFloatField;
    FAT_SQ_M_PED_ITEint_rua2: TWideStringField;
    FAT_SQ_M_PED_ITEint_prateleira2: TWideStringField;
    FAT_SQ_M_PED_ITEint_escaninho2: TWideStringField;
    BUS_DP_M_PCA_PED_ITE: TDataSetProvider;
    BUS_SQ_M_PCA_PED_ITE: TSQLDataSet;
    FAT_SQ_M_PEDvlr_icm_desn: TFMTBCDField;
    FAT_SQ_M_PED_ITEvlr_icm_desn: TFMTBCDField;
    BUS_SQ_M_PED_ITEvlr_icm_desn: TFMTBCDField;
    CAD_SQ_C_PAR_CTRhab_icms_desn_saida: TBooleanField;
    FAT_DP_R_POS: TDataSetProvider;
    FAT_SQ_R_POS: TSQLDataSet;
    FAT_DS_R_POS: TDataSource;
    FAT_SQ_M_POS_NFE: TSQLDataSet;
    CAD_SQ_C_PAR_MODomp: TBooleanField;
    OFI_SQ_M_ORVid_meq: TIntegerField;
    OFI_SQ_M_ORVint_nomemeq: TWideStringField;
    BUS_SQ_R_ORVid_meq: TIntegerField;
    BUS_SQ_R_ORVint_nomemeq: TWideStringField;
    BUS_SQ_R_ORVint_seriemeq: TWideStringField;
    BUS_SQ_R_ORVint_modelomeq: TWideStringField;
    OFI_SQ_R_OFV_POS_001id_meq: TIntegerField;
    OFI_SQ_R_OFV_POS_001int_nomemeq: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_seriemeq: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_modelomeq: TWideStringField;
    OFI_SQ_R_OFV_POS_002id_meq: TIntegerField;
    OFI_SQ_R_OFV_POS_002int_nomemeq: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_seriemeq: TWideStringField;
    OFI_SQ_R_OFV_POS_002int_modelomeq: TWideStringField;
    PCP_SQ_C_MEQid_placa: TWideStringField;
    PCP_SQ_C_MEQkm_aquisicao: TFloatField;
    PCP_SQ_C_MEQdta_aquisicao: TDateField;
    PCP_SQ_C_MEQkm_atual: TFloatField;
    PCP_SQ_C_MEQchassi: TWideStringField;
    PCP_SQ_C_MEQano_modelo: TWideStringField;
    PCP_SQ_C_MEQano_fabricacao: TWideStringField;
    PCP_SQ_C_MEQrenavam: TWideStringField;
    PCP_SQ_C_MEQalimentacao: TIntegerField;
    PCP_SQ_C_MEQcombustivel: TIntegerField;
    PCP_SQ_C_MEQmotor: TWideStringField;
    PCP_SQ_C_MEQmotor_num: TWideStringField;
    PCP_SQ_C_MEQrastreado: TBooleanField;
    PCP_SQ_C_MEQtipo: TIntegerField;
    PCP_SQ_C_MEQstatus: TIntegerField;
    PCP_SQ_C_MEQid_cor: TIntegerField;
    PCP_SQ_C_MEQmedia_consumo: TFloatField;
    PCP_SQ_C_MEQeqp_terceiro: TBooleanField;
    PCP_SQ_C_MEQtipo_rodado: TSmallintField;
    PCP_SQ_C_MEQtipo_carroceria: TSmallintField;
    PCP_SQ_C_MEQcap_veiculo: TFloatField;
    PCP_SQ_C_MEQtara: TFloatField;
    PCP_SQ_C_MEQuf_licenciado: TWideStringField;
    OFI_DP_R_FIV_MEQ: TDataSetProvider;
    OFI_SQ_R_FIV_MEQ: TSQLDataSet;
    OFI_SQ_R_HIVid_meq: TIntegerField;
    OFI_SQ_R_HIVint_nomemeq: TWideStringField;
    OFI_SQ_R_HIVint_nomemde: TWideStringField;
    OFI_SQ_R_HIVint_nomecom_meq: TWideMemoField;
    OFI_SQ_R_HIVint_chassi_meq: TWideStringField;
    OFI_SQ_R_HIVint_placa_meq: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_placa_meq: TWideStringField;
    OFI_SQ_R_OFV_POS_001int_nomecom_meq: TWideMemoField;
    OFI_SQ_R_OFV_POS_002int_placa_meq: TWideStringField;
    OFI_SQ_M_ORVhorimetro: TFloatField;
    BUS_SQ_R_ORVhorimetro: TFloatField;
    BUS_SQ_R_ORVint_tipomeq: TIntegerField;
    BUS_SQ_R_ORVint_placa_meq: TWideStringField;
    BUS_SQ_R_ORVint_anomodelo_meq: TWideStringField;
    BUS_SQ_R_ORVint_anofab_meq: TWideStringField;
    BUS_SQ_R_ORVint_nomecor_meq: TWideStringField;
    BUS_SQ_R_ORVint_chassi_meq: TWideStringField;
    OFI_SQ_M_ORVint_tipomei: TIntegerField;
    BUS_SQ_R_ORVint_tipomei: TIntegerField;
    CAD_DS_C_GRU: TDataSource;
    CAD_SQ_C_GRU_EMP: TSQLDataSet;
    CAD_SQ_C_GRU_EMPid_grupo: TWideStringField;
    CAD_SQ_C_GRU_EMPid_empresa: TIntegerField;
    CAD_SQ_C_GRU_EMPfator_corr_aprazo: TFloatField;
    CAD_SQ_C_GRU_EMPfator_corr_avista: TFloatField;
    CAD_SQ_C_PAR_CTRcorrecao_prc_por_grupo: TBooleanField;
    CAD_SQ_C_PAR_CTRchave_bloqueio: TWideStringField;
    CAD_SQ_C_PAR_CTRstatus_internet: TBooleanField;
    CAD_SQ_C_FUNadm_sistema: TBooleanField;
    FAT_SQ_R_VIS_RES_VEN: TSQLDataSet;
    FAT_DP_R_VIS_RES_VEN: TDataSetProvider;
    FAT_SQ_R_VIS_RES_VEN_CLI: TSQLDataSet;
    FAT_DP_R_VIS_RES_VEN_CLI: TDataSetProvider;
    FAT_SQ_R_VIS_RES_VEN_CLI_PRO: TSQLDataSet;
    FAT_DP_R_VIS_RES_VEN_CLI_PRO: TDataSetProvider;
    FAT_SQ_R_VIS_RES_VEN_CLI_EXT: TSQLDataSet;
    FAT_DP_R_VIS_RES_VEN_CLI_EXT: TDataSetProvider;
    CAD_SQ_C_PAR_CTRid_fun_aviso_debito: TIntegerField;
    CAD_SQ_C_PAR_CTRhorario_aviso_debito: TTimeField;
    OFI_DP_M_CVL: TDataSetProvider;
    OFI_SQ_M_CVL: TSQLDataSet;
    OFI_DS_M_CVL: TDataSource;
    OFI_SQ_M_CVL_IPV: TSQLDataSet;
    OFI_SQ_M_CVL_MLT: TSQLDataSet;
    OFI_SQ_M_CVL_SGR: TSQLDataSet;
    OFI_SQ_M_CVLid_controle: TIntegerField;
    OFI_SQ_M_CVLdta_controle: TDateField;
    OFI_SQ_M_CVLtipo_movimento: TIntegerField;
    OFI_SQ_M_CVLid_meq: TIntegerField;
    OFI_SQ_M_CVLint_placa: TWideStringField;
    OFI_SQ_M_CVL_IPVid_controle: TIntegerField;
    OFI_SQ_M_CVL_IPVid_ipva: TIntegerField;
    OFI_SQ_M_CVL_IPVano_exercicio: TWideStringField;
    OFI_SQ_M_CVL_IPVvlr_seguro_obg: TFMTBCDField;
    OFI_SQ_M_CVL_IPVvlr_ipva: TFMTBCDField;
    OFI_SQ_M_CVL_IPVdta_venc_unica: TDateField;
    OFI_SQ_M_CVL_IPVdta_pag_unica: TDateField;
    OFI_SQ_M_CVL_IPVdta_venc_cta01: TDateField;
    OFI_SQ_M_CVL_IPVdta_pag_cta01: TDateField;
    OFI_SQ_M_CVL_IPVvalor_cta01: TFMTBCDField;
    OFI_SQ_M_CVL_IPVdta_venc_cta02: TDateField;
    OFI_SQ_M_CVL_IPVdta_pag_cta02: TDateField;
    OFI_SQ_M_CVL_IPVvalor_cta02: TFMTBCDField;
    OFI_SQ_M_CVL_IPVdta_venc_cta03: TDateField;
    OFI_SQ_M_CVL_IPVdta_pag_cta03: TDateField;
    OFI_SQ_M_CVL_IPVvalor_cta03: TFMTBCDField;
    OFI_SQ_M_CVL_MLTid_controle: TIntegerField;
    OFI_SQ_M_CVL_MLTid_multa: TIntegerField;
    OFI_SQ_M_CVL_MLTlocal: TWideStringField;
    OFI_SQ_M_CVL_MLTcod_infracao: TWideStringField;
    OFI_SQ_M_CVL_MLTdta_vencimento: TDateField;
    OFI_SQ_M_CVL_MLTvlr_multa: TFMTBCDField;
    OFI_SQ_M_CVL_MLTvlr_pago: TFMTBCDField;
    OFI_SQ_M_CVL_MLTdta_pagamento: TDateField;
    OFI_SQ_M_CVL_MLTprocesso: TWideStringField;
    OFI_SQ_M_CVL_MLTrecurso: TBooleanField;
    OFI_SQ_M_CVL_MLTrecurso_aceito: TBooleanField;
    OFI_SQ_M_CVL_MLTpago: TBooleanField;
    OFI_SQ_M_CVL_MLTobs: TWideStringField;
    OFI_SQ_M_CVL_SGRid_controle: TIntegerField;
    OFI_SQ_M_CVL_SGRid_seguro: TIntegerField;
    OFI_SQ_M_CVL_SGRdta_contrato: TDateField;
    OFI_SQ_M_CVL_SGRdta_vigencia: TDateField;
    OFI_SQ_M_CVL_SGRnum_apolice: TWideStringField;
    OFI_SQ_M_CVL_SGRvlr_seguro: TFMTBCDField;
    OFI_SQ_M_CVL_SGRvlr_franquia: TFMTBCDField;
    OFI_SQ_M_CVL_SGRvlr_cobertura: TFMTBCDField;
    OFI_SQ_M_CVL_SGRvlr_danos_materiais: TFMTBCDField;
    OFI_SQ_M_CVL_SGRvlr_danos_corporais: TFMTBCDField;
    OFI_SQ_M_CVL_SGRcorretor_nome: TWideStringField;
    OFI_SQ_M_CVL_SGRcorretor_telefone: TWideStringField;
    OFI_SQ_M_CVL_SGRcorretor_celular: TWideStringField;
    OFI_SQ_M_CVLid_empresa: TIntegerField;
    OFI_SQ_M_CVLint_descricao: TWideStringField;
    ctc_sq_m_bde_vrf: TSQLDataSet;
    ctc_sq_m_bde_vrfid_bde: TIntegerField;
    ctc_sq_m_bde_vrfid_verificacao: TIntegerField;
    ctc_sq_m_bde_vrfpad_buz_funciona: TWideStringField;
    ctc_sq_m_bde_vrfpad_extintor_incendio: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_cinto_seguranca: TWideStringField;
    ctc_sq_m_bde_vrfpad_veic_possui_mac: TWideStringField;
    ctc_sq_m_bde_vrfpad_veic_possui_chv_roda: TWideStringField;
    ctc_sq_m_bde_vrfpad_veic_possui_mao_forca: TWideStringField;
    ctc_sq_m_bde_vrfpad_veic_possui_triangulo: TWideStringField;
    ctc_sq_m_bde_vrfpad_veic_possui_martelo_mad: TWideStringField;
    ctc_sq_m_bde_vrfpad_sis_freio_funciona: TWideStringField;
    ctc_sq_m_bde_vrfpad_ind_pres_oleo_funciona: TWideStringField;
    ctc_sq_m_bde_vrfpad_drenagem_tanq_filtro: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_pres_calib_pneus: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_folga_rol_rosca_fim: TWideStringField;
    ctc_sq_m_bde_vrfpad_feita_dren_baloes_ar: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_estado_correias: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_estado_maq_geral: TWideStringField;
    ctc_sq_m_bde_vrfpad_feita_lubrif_ger_equip: TWideStringField;
    ctc_sq_m_bde_vrfpad_equip_ise_vaz_hidraulico: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_nivel_agua_radiador: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_nivel_oleo_mot_hid_freio: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_conserv_polos_baterias: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_filtro_ar_cabine: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_instalacao_instrum_eletr: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_estado_vidragem_ger: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_doc_equip: TWideStringField;
    ctc_sq_m_bde_vrfpad_verif_estado_mat_rodante: TWideStringField;
    ctc_sq_m_bde_vrfpad_ha_vazamento_oleo_combust: TWideStringField;
    ctc_sq_m_bde_vrfpad_maq_kit_mitigacao: TWideStringField;
    ctc_sq_m_bde_vrfpad_maq_ruid_excess: TWideStringField;
    ctc_sq_m_bde_vrfpneu_isento_picotamento: TWideStringField;
    ctc_sq_m_bde_vrfpneu_livre_corte_lateral: TWideStringField;
    ctc_sq_m_bde_vrfpneu_banda_rol_isenta_solt: TWideStringField;
    ctc_sq_m_bde_vrfimple_p_lubrif_cruz_eixo_conjunto: TWideStringField;
    ctc_sq_m_bde_vrfimple_p_bord_tom_isenta_vazam: TWideStringField;
    ctc_sq_m_bde_vrfimple_p_verif_niv_oleo_cxa_mult: TWideStringField;
    ctc_sq_m_bde_vrfimple_p_verif_corr_gax_bomba: TWideStringField;
    ctc_sq_m_bde_vrfimple_p_algum_vaz_tanq_trans_ag: TWideStringField;
    ctc_sq_m_bde_vrfimple_b_verif_niv_oleo_hid_basc: TWideStringField;
    ctc_sq_m_bde_vrfimple_b_sis_hid_isento_vaz: TWideStringField;
    ctc_sq_m_bde_vrfimple_b_lub_pin_cilin_cruz_tom: TWideStringField;
    ctc_sq_m_bde_vrfimple_m_verif_niv_oleo_mot_comp: TWideStringField;
    ctc_sq_m_bde_vrfimple_m_drenag_reserv_ar_comp: TWideStringField;
    ctc_sq_m_bde_vrfimple_m_prop_j_v_c_tub_isento_vaz: TWideStringField;
    ctc_sq_m_bde_vrfimple_m_lub_ger_grax: TWideStringField;
    ctc_sq_m_bde_vrfimple_m_verif_corr_acopl_sis: TWideStringField;
    PCP_SQ_C_MEQint_nomecor: TWideStringField;
    OFI_SQ_M_CVLint_tipo_mov: TWideStringField;
    BUS_SQ_R_ORV_SERint_nometer: TWideStringField;
    BUS_SQ_R_ORV_SERint_codter: TIntegerField;
    CAD_SQ_C_VITsemana_visitada: TIntegerField;
    CAD_SQ_C_CLIdesenvolvimento: TBooleanField;
    CAD_SQ_C_CLIdta_inicio_desnv: TDateField;
    CAD_SQ_C_PAR_CTRdata_aviso_debito: TDateField;
    CAD_SQ_C_PAR_CTRfiltro_pad_csu_ite: TIntegerField;
    CAD_SQ_C_PAR_CTRfiltro_pad_psq_ite: TIntegerField;
    BUS_DP_C_ITE_LOC_2: TDataSetProvider;
    BUS_SQ_C_ITE_LOC_2: TSQLDataSet;
    FAT_SQ_M_ETGid_motorista: TIntegerField;
    FAT_SQ_M_ETGint_nome_mot: TWideStringField;
    FIN_SQ_M_RECvlr_saldo_anterior: TFMTBCDField;
    CAD_SQ_C_PAR_CTRlimite_cred_fpg: TBooleanField;
    CAD_SQ_C_CLI_CRD: TSQLDataSet;
    CAD_SQ_C_CLI_CRDid_cliente: TIntegerField;
    CAD_SQ_C_CLI_CRDid_forma_pag: TIntegerField;
    CAD_SQ_C_CLI_CRDlim_valor: TFMTBCDField;
    CAD_SQ_C_CLI_CRDlim_saldo: TFMTBCDField;
    CAD_SQ_C_CLI_CRDint_nomefpg: TWideStringField;
    BUS_SQ_C_PAR_CTRlimite_cred_fpg: TBooleanField;
    FAT_SQ_M_PEDint_sitord: TIntegerField;
    FAT_DP_R_PVE_TOL_GRU: TDataSetProvider;
    FAT_SQ_R_PVE_TOL_GRU: TSQLDataSet;
    BUS_DP_M_CSU_GRV_FVN: TDataSetProvider;
    BUS_SQ_M_CSU_GRV_FVN: TSQLDataSet;
    BUS_DP_M_CSU_GRV_NCL: TDataSetProvider;
    BUS_SQ_M_CSU_GRV_NCL: TSQLDataSet;
    CAD_SQ_C_ECFid_empresa: TIntegerField;
    CAD_SQ_C_PAR_CTRpermitir_saida_est_emp: TBooleanField;
    CAD_SQ_C_GRUutiliza_lote: TBooleanField;
    FAT_DS_M_XML_ITE: TDataSource;
    FAT_SQ_M_XML_ITE_LOT: TSQLDataSet;
    FAT_SQ_M_XML_ITE_LOTid_controle: TIntegerField;
    FAT_SQ_M_XML_ITE_LOTid_sequencia: TIntegerField;
    FAT_SQ_M_XML_ITE_LOTnum_lote: TWideStringField;
    FAT_SQ_M_XML_ITE_LOTqtde: TFloatField;
    FAT_SQ_M_XML_ITEint_utiliza_lote: TBooleanField;
    CAD_SQ_C_ITEint_lote_gru: TBooleanField;
    BUS_SQ_CSU_ITEint_lote_gru: TBooleanField;
    CAD_SQ_C_PAR_CTRtipo_controle_lote: TIntegerField;
    FAT_SQ_M_XML_ITE_LOTdta_vencimento: TDateField;
    BUS_SQ_C_VIT_CONsemana_visitada: TIntegerField;
    FAT_SQ_M_PED_ITEnum_lote: TWideStringField;
    FAT_SQ_M_PED_ITEint_lote_gru: TBooleanField;
    FAT_SQ_M_MKT_CLIcliente_contato: TBooleanField;
    FAT_SQ_M_MKT_CLIcliente_avulso: TBooleanField;
    CAD_SQ_C_PAR_CTRcad_cli_simplificado: TBooleanField;
    CAD_SQ_C_PAR_CTRcad_vei_simplificado: TBooleanField;
    FAT_SQ_R_SIN_050: TSQLDataSet;
    FAT_DP_R_SIN_050: TDataSetProvider;
    FAT_SQ_R_SIN_051: TSQLDataSet;
    FAT_DP_R_SIN_051: TDataSetProvider;
    FAT_SQ_R_SIN_053: TSQLDataSet;
    FAT_DP_R_SIN_053: TDataSetProvider;
    FAT_SQ_R_SIN_054: TSQLDataSet;
    FAT_DP_R_SIN_054: TDataSetProvider;
    FAT_SQ_R_SIN_60M: TSQLDataSet;
    FAT_DP_R_SIN_60M: TDataSetProvider;
    FAT_SQ_R_SIN_60A: TSQLDataSet;
    FAT_DP_R_SIN_60A: TDataSetProvider;
    FAT_SQ_R_SIN_60D: TSQLDataSet;
    FAT_DP_R_SIN_60D: TDataSetProvider;
    FAT_SQ_R_SIN_60I: TSQLDataSet;
    FAT_DP_R_SIN_60I: TDataSetProvider;
    FAT_SQ_R_SIN_075: TSQLDataSet;
    FAT_DP_R_SIN_075: TDataSetProvider;
    CAD_SQ_C_PAR_CTRenviar_rel_grv: TBooleanField;
    CAD_SQ_C_PAR_EML: TSQLDataSet;
    CAD_SQ_C_PAR_EMLid_empresa: TIntegerField;
    CAD_SQ_C_PAR_EMLemail: TWideStringField;
    CAD_SQ_C_FUNper_comissao: TFloatField;
    FAT_SQ_M_PEDvlr_desc_produtos: TFMTBCDField;
    FAT_SQ_M_PEDper_desc_produtos: TFloatField;
    FAT_SQ_M_PEDvlr_produtos: TFMTBCDField;
    FAT_SQ_M_PEDvlr_serv_bruto: TFMTBCDField;
    FAT_SQ_M_PEDvlr_desc_servicos: TFMTBCDField;
    FAT_SQ_M_PEDper_desc_servicos: TFloatField;
    FAT_SQ_M_PEDvlr_ser_liquido: TFMTBCDField;
    FAT_SQ_M_PEDvlr_terceiro: TFMTBCDField;
    FAT_SQ_M_PEDvlr_desc_terceiro: TFMTBCDField;
    FAT_SQ_M_PEDper_desc_terceiro: TFloatField;
    FAT_SQ_M_PEDvlr_terc_liquido: TFMTBCDField;
    FAT_SQ_M_PEDped_gera_fin_separado: TBooleanField;
    FAT_SQ_M_PED_ITEmotivo_icms_des: TIntegerField;
    CAD_SQ_C_CTCespecie_tit: TWideStringField;
    CAD_SQ_C_CTCaceite_tit: TWideStringField;
    FAT_SQ_M_PED_TIT_SER: TSQLDataSet;
    FAT_SQ_M_PED_TIT_SERid_pedido: TIntegerField;
    FAT_SQ_M_PED_TIT_SERid_titulo: TIntegerField;
    FAT_SQ_M_PED_TIT_SERdias: TIntegerField;
    FAT_SQ_M_PED_TIT_SERdta_vencimento: TDateField;
    FAT_SQ_M_PED_TIT_SERvlr_titulo: TFMTBCDField;
    FAT_SQ_M_PED_TIT_SERche_banco: TWideStringField;
    FAT_SQ_M_PED_TIT_SERche_agencia: TWideStringField;
    FAT_SQ_M_PED_TIT_SERche_conta: TIntegerField;
    FAT_SQ_M_PED_TIT_SERche_numero: TIntegerField;
    FAT_SQ_M_PED_TIT_SERche_emitente: TWideStringField;
    FAT_SQ_M_PED_TIT_SERid_forma_pag: TIntegerField;
    FAT_SQ_M_PED_TIT_SERbol_nosso_numero: TIntegerField;
    FAT_SQ_M_PED_TIT_SERid_maquineta: TIntegerField;
    FAT_SQ_M_PED_TIT_SERint_nomefpg: TWideStringField;
    FAT_SQ_M_PED_TIT_SERint_docimpresso: TIntegerField;
    BUS_DP_M_PED_TIT_SER_INT: TDataSetProvider;
    BUS_SQ_M_PED_TIT_SER_INT: TSQLDataSet;
    FAT_SQ_M_PED_ITEint_serterceiro: TBooleanField;
    FAT_SQ_M_PEDvlr_prod_liquido: TFMTBCDField;
    FAT_SQ_M_PEDsepara_prod_serv: TBooleanField;
    FAT_SQ_M_PEDvlr_cred_produtos: TFMTBCDField;
    FAT_SQ_M_PEDvlr_cred_servicos: TFMTBCDField;
    CTC_SQ_M_SLMint_desc_obr: TWideStringField;
    CAD_SQ_C_PAR_NFEdanfe_cod_item: TIntegerField;
    BUS_SQ_M_PAGint_nomecusto: TWideStringField;
    FAT_SQ_M_PED_ITEid_mecanico: TIntegerField;
    FAT_SQ_M_PED_ITEint_nomemec: TWideStringField;
    CAD_SQ_C_ITEpneu_largura: TWideStringField;
    CAD_SQ_C_ITEpneu_altura: TWideStringField;
    CAD_SQ_C_ITEpneu_aro: TWideStringField;
    CAD_SQ_C_GRUtipo_produto: TIntegerField;
    CAD_SQ_C_ITEint_tipo_produto: TIntegerField;
    CAD_SQ_C_PAR_CTRexibir_cond_sem_pag: TBooleanField;
    CAD_DP_C_PCC: TDataSetProvider;
    CAD_SQ_C_PCC: TSQLDataSet;
    CAD_SQ_C_PCCcod_nat_cc: TWideStringField;
    CAD_SQ_C_PCCind_cta: TWideStringField;
    CAD_SQ_C_PCCcod_cta: TWideStringField;
    CAD_SQ_C_PCCnome_cta: TWideStringField;
    CAD_SQ_C_PCCcod_cta_ref: TWideStringField;
    CAD_SQ_C_CFOcod_cta: TWideStringField;
    CAD_SQ_C_PAR_CTRped_utiliza_mecanico: TBooleanField;
    FAT_SQ_M_PEDobs: TWideStringField;
    CAD_SQ_C_PAR_CTRexibir_obs_ped_nfe_fisco: TBooleanField;
    BUS_DP_C_CLI_VEI: TDataSetProvider;
    BUS_SQ_C_CLI_VEI: TSQLDataSet;
    OFI_SQ_M_ORVint_anomodelo: TWideStringField;
    OFI_SQ_M_ORVint_anofabric: TWideStringField;
    OFI_SQ_M_ORVint_motorvei: TWideStringField;
    OFI_SQ_M_ORVid_atendente: TIntegerField;
    OFI_SQ_M_ORVint_nomeate: TWideStringField;
    BUS_SQ_R_ORVid_atendente: TIntegerField;
    BUS_SQ_R_ORVint_nomeate: TWideStringField;
    CAD_SQ_C_PAR_CTRpermitir_nova_os_cli_placa: TBooleanField;
    CAD_SQ_C_PAR_CTRobrig_dados_cheque_ped_vnd: TBooleanField;
    CAD_SQ_C_PAR_CTRped_vnd_tme_padrao: TIntegerField;
    CAD_SQ_C_PAR_CTRativo_ped_vnd_tme_padrao: TBooleanField;
    CAD_SQ_C_PAR_CTRgerar_nota_fechamento_os: TBooleanField;
    BUS_SQ_C_PAR_CTRgerar_nota_fechamento_os: TBooleanField;
    CAD_SQ_C_PAR_CTRalterar_vlr_dup_nota_fat: TBooleanField;
    CAD_SQ_C_ITE_LOCloca_rua: TWideStringField;
    CAD_SQ_C_ITE_LOCloca_prateleira: TWideStringField;
    CAD_SQ_C_ITE_LOCloca_escaninho: TWideStringField;
    CAD_SQ_C_ITEloca_rua: TWideStringField;
    CAD_SQ_C_ITEloca_prateleira: TWideStringField;
    CAD_SQ_C_ITEloca_escaninho: TWideStringField;
    CAD_SQ_C_PAR_CTRn_utilizar_cond_pag_os: TBooleanField;
    CAD_SQ_C_PAR_CTRtipo_preco_sem_cond_pag_os: TIntegerField;
    CAD_SQ_C_PAR_CTRpermitir_alterar_dta_baixa_rbx: TBooleanField;
    BUS_DP_M_FEA_SLD: TDataSetProvider;
    BUS_SQ_M_FEA_SLD: TSQLDataSet;
    CAD_SQ_C_FPGutilizado_ped_vnd: TBooleanField;
    CAD_SQ_C_PAR_CTRativar_util_fpg_ped_vnd: TBooleanField;
    CAD_SQ_C_PAR_CTRletras_maius_obs_ped: TBooleanField;
    FAT_DP_R_GAM_D_190: TDataSetProvider;
    FAT_SQ_R_GAM_D_190: TSQLDataSet;
    ctc_sq_m_bdeobs: TWideStringField;
    CAD_SQ_C_ITEint_ali_interna_icms: TFloatField;
    CAD_SQ_C_ITEint_cest: TWideStringField;
    SQ_BR_PREVENDA_DETALHEnumprevenda: TIntegerField;
    SQ_BR_PREVENDA_DETALHEloja: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcod_produto: TWideStringField;
    SQ_BR_PREVENDA_DETALHEqtd: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEun: TWideStringField;
    SQ_BR_PREVENDA_DETALHEvalor: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEdesconto: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEacrescimo: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEtotal: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEcancelado: TWideStringField;
    SQ_BR_PREVENDA_DETALHEn_cupom: TIntegerField;
    SQ_BR_PREVENDA_DETALHEserial: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcod_grade: TWideStringField;
    SQ_BR_PREVENDA_DETALHEitem: TIntegerField;
    SQ_BR_PREVENDA_DETALHEcod_kit: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcod_vendedor: TWideStringField;
    SQ_BR_PREVENDA_DETALHEdesc_produto: TWideStringField;
    SQ_BR_PREVENDA_DETALHEaliquota: TWideStringField;
    SQ_BR_PREVENDA_DETALHEservico: TWideStringField;
    SQ_BR_PREVENDA_DETALHEserialproduto: TWideStringField;
    SQ_BR_PREVENDA_DETALHEtipo: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcod_prod_tcsmart: TWideStringField;
    SQ_BR_PREVENDA_DETALHEtipo_bloqueado: TWideStringField;
    SQ_BR_PREVENDA_DETALHEflag_sis: TWideStringField;
    SQ_BR_PREVENDA_DETALHEflag_aceito: TWideStringField;
    SQ_BR_PREVENDA_DETALHEmesa_origem: TWideStringField;
    SQ_BR_PREVENDA_DETALHEnumprevenda_origem: TIntegerField;
    SQ_BR_PREVENDA_DETALHEitem_origem: TIntegerField;
    SQ_BR_PREVENDA_DETALHEccusto: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEncm: TWideStringField;
    SQ_BR_PREVENDA_DETALHEex_ipi: TWideStringField;
    SQ_BR_PREVENDA_DETALHEgenero: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcst_icms: TWideStringField;
    SQ_BR_PREVENDA_DETALHEorigem_icms: TWideStringField;
    SQ_BR_PREVENDA_DETALHEaliquota_ipi: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEaliquota_pis: TFMTBCDField;
    SQ_BR_PREVENDA_DETALHEtipo_item: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcfop: TIntegerField;
    SQ_BR_PREVENDA_DETALHEdesc_unidade: TWideStringField;
    SQ_BR_PREVENDA_DETALHEstb: TWideStringField;
    SQ_BR_PREVENDA_DETALHEcomplemento_item: TWideStringField;
    SQ_BR_PREVENDA_DETALHEprdcoutroscodigo: TWideStringField;
    CAD_SQ_C_FUNseg_alt_cli_ped: TBooleanField;
    CAD_SQ_C_ITEid_marca: TIntegerField;
    CAD_SQ_C_ITEint_nomemar: TWideStringField;
    CAD_DP_C_NTR: TDataSetProvider;
    CAD_SQ_C_NTR: TSQLDataSet;
    CAD_SQ_C_NTRcodigo: TWideStringField;
    CAD_SQ_C_NTRdescricao: TWideStringField;
    CAD_SQ_C_GRUcod_ntr: TWideStringField;
    CAD_SQ_C_PAR_CTRinformar_mec_por_item_ped: TBooleanField;
    CAD_SQ_C_PAR_CTRinformar_mec_por_item_os: TBooleanField;
    FAT_SQ_M_PEDid_mecanico: TIntegerField;
    OFI_SQ_M_ORVid_mecanico: TIntegerField;
    FIN_SQ_M_CTAid_cliente: TIntegerField;
    FIN_SQ_M_CTAint_nomecli: TWideStringField;
    FIN_SQ_M_CTApag_cred_cli: TIntegerField;
    FIN_SQ_M_RCRid_cta: TIntegerField;
    EST_SQ_M_MALkm_atual: TFloatField;
    CAD_SQ_C_PAR_CTRcsu_cli_fin_separar_fpg: TBooleanField;
    FAT_DP_R_GAM_E_A_305: TDataSetProvider;
    FAT_SQ_R_GAM_E_A_305: TSQLDataSet;
    FAT_SQ_R_GAM_E_B_305: TSQLDataSet;
    FAT_SQ_R_GAM_E_C_305: TSQLDataSet;
    FAT_DP_R_GAM_E_B_305: TDataSetProvider;
    FAT_DP_R_GAM_E_C_305: TDataSetProvider;
    CAD_SQ_C_PAR_NFEprot_com_ssllib: TIntegerField;
    CAD_SQ_C_PAR_NFEprot_com_criptlib: TIntegerField;
    CAD_SQ_C_PAR_NFEprot_com_httplib: TIntegerField;
    CAD_SQ_C_PAR_NFEprot_com_xmlsignlib: TIntegerField;
    CAD_SQ_C_PAR_NFEnfe_versao: TIntegerField;
    FAT_SQ_M_NFEvlr_fcp_ope_int: TFMTBCDField;
    FAT_SQ_M_NFEvlr_fcp_st_ope_int: TFMTBCDField;
    FAT_SQ_M_NFEvlr_fcp_st_ret_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_fcp_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_fcp_ope_int: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_fcp_base_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_fcp_st_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_fcp_st_ope_int: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_fcp_st_base_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_st_sup_cons_final_ope_int: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_fcp_st_ret_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEper_fcp_st_ret_ope_int: TFloatField;
    FAT_SQ_M_NFE_ITEvlr_fcp_st_ret_base_ope_int: TFMTBCDField;
    FAT_SQ_M_NFE_ITEvlr_fcp_base_uf_dest: TFMTBCDField;
    FAT_SQ_M_NFE_ITEint_cod_barra: TWideStringField;
    CAD_SQ_C_PAR_NFEcert_caminho_pfx: TWideStringField;
    CAD_SQ_C_PAR_NFEcert_senha_pfx: TWideStringField;
    PCP_SQ_M_EPP_ITEint_nomeite: TWideStringField;
    CAD_SQ_C_ITEsgq_personalizado: TBooleanField;
    FAT_SQ_M_NFE_ITEint_sgq_person: TBooleanField;
    FAT_SQ_M_NFE_ITEpcp_obs_item: TWideStringField;
    CAD_SQ_C_GRUsgq_verif_cod_barra_ped: TBooleanField;
    CAD_SQ_C_ITEint_verif_cod_barra_ped: TBooleanField;
    PCP_SQ_M_ETQint_cod_barra_gtin: TWideStringField;
    CAD_SQ_C_PAR_CTRsgq_verif_op_ped: TBooleanField;
    PCP_SQ_M_ROM_PEDint_status: TWideMemoField;
    CAD_SQ_C_ITEetiq_madeira: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma1: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma2: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma3: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento1: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento2: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento3: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma4: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma5: TWideStringField;
    CAD_SQ_C_ITEetiq_espuma6: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento4: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento5: TWideStringField;
    CAD_SQ_C_ITEetiq_revestimento6: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma1ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma2ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma3ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma4ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma5ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_espuma6ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_madeiraite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento1ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento2ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento3ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento4ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento5ite: TWideStringField;
    PCP_SQ_M_ETQint_etiq_revestimento6ite: TWideStringField;
    BUS_DP_M_OPR_INT: TDataSetProvider;
    BUS_SQ_M_OPR_INT: TSQLDataSet;
    FAT_SQ_M_ORC_ITEpcp_obs_item: TWideStringField;
    CAD_SQ_C_FPGsgq_prestacao_conta: TBooleanField;
    FIN_SQ_M_RBX_PPE: TSQLDataSet;
    FIN_SQ_M_RBX_PPEid_baixa: TIntegerField;
    FIN_SQ_M_RBX_PPEid_pedido: TIntegerField;
    FIN_SQ_M_RBX_PPEvlr_desc_pos_fat: TFMTBCDField;
    FIN_SQ_M_RBX_PPEint_id_cliente: TIntegerField;
    FIN_SQ_M_RBX_PPEint_nomecli: TWideStringField;
    FIN_SQ_M_RBX_TITint_id_ors: TIntegerField;
    FIN_SQ_M_RBX_TITint_id_pedido: TIntegerField;
    FIN_SQ_M_RBX_TITint_id_forma_pag: TIntegerField;
    FIN_SQ_M_RBX_TITint_fpg_sgq_presta_conta: TBooleanField;
    BUS_SQ_M_RECint_id_ors: TIntegerField;
    BUS_SQ_M_RECint_fpg_sgq_presta_conta: TBooleanField;
    CAD_SQ_C_FUNsgq_perm_alt_comissao_ped: TBooleanField;
    FAT_SQ_M_PEDsgq_texto_cond_pgto: TWideStringField;
    CAD_SQ_C_CPGsgq_texto_cnd_ped: TBooleanField;
    CAD_SQ_C_PAR_CTRsgq_preenc_vlr_pago_bx_tit: TBooleanField;
    CAD_SQ_C_CTCqtde_dias_protesto: TIntegerField;
    CAD_SQ_C_CTCprotestar_negativar: TIntegerField;
    CAD_SQ_C_CTCperc_multa: TFloatField;
    CAD_SQ_C_CLIaval_doc_cnpj_cpf: TWideStringField;
    CAD_SQ_C_CLIaval_nome: TWideStringField;
    CAD_SQ_C_CLIaval_logradouro: TWideStringField;
    CAD_SQ_C_CLIaval_nro: TWideStringField;
    CAD_SQ_C_CLIaval_bairro: TWideStringField;
    CAD_SQ_C_CLIaval_id_cidade: TWideStringField;
    CAD_SQ_C_CLIaval_cep: TWideStringField;
    CAD_SQ_C_CLIaval_fone: TWideStringField;
    CAD_SQ_C_CLIaval_email: TWideStringField;
    CAD_SQ_C_CLIint_aval_uf: TWideStringField;
    CAD_SQ_C_CLIint_aval_nomecid: TWideStringField;
    PCP_SQ_M_ORSint_id_cliente: TIntegerField;
    CAD_SQ_C_PAR_CTRsgq_id_almoxarifado_pad_epp: TIntegerField;
    FAT_SQ_M_PCA_PED_ITE: TSQLDataSet;
    FAT_DS_M_PCA_PED: TDataSource;
    FAT_SQ_M_PCA_PED_ITEid_carregamento: TIntegerField;
    FAT_SQ_M_PCA_PED_ITEid_pedido: TIntegerField;
    FAT_SQ_M_PCA_PED_ITEid_sequencia: TIntegerField;
    FAT_SQ_M_PCA_PED_ITEid_item: TIntegerField;
    FAT_SQ_M_PCA_PED_ITEqtde: TFloatField;
    FAT_SQ_M_PCA_PED_ITEid_cor: TIntegerField;
    FAT_SQ_M_PCA_PED_ITEid_tamanho: TIntegerField;
    FAT_SQ_M_PCA_PEDint_cubagem: TFloatField;
    FAT_SQ_M_PCA_PED_ITEint_nomecor: TWideStringField;
    FAT_SQ_M_PCA_PED_ITEint_id_und_venda: TWideStringField;
    FAT_SQ_M_PCA_PED_ITEpcp_obs_item: TWideStringField;
    FAT_DP_R_PCA: TDataSetProvider;
    FAT_SQ_R_PCA: TSQLDataSet;
    IntegerField181: TIntegerField;
    IntegerField182: TIntegerField;
    DateField32: TDateField;
    WideStringField169: TWideStringField;
    IntegerField183: TIntegerField;
    IntegerField184: TIntegerField;
    WideStringField198: TWideStringField;
    WideStringField199: TWideStringField;
    FAT_DS_R_PCA: TDataSource;
    FAT_SQ_R_PCA_PED_ITE: TSQLDataSet;
    FAT_SQ_R_PCA_PED_ITEid_item: TIntegerField;
    FAT_SQ_R_PCA_PED_ITEid_cor: TIntegerField;
    FAT_SQ_R_PCA_PED_ITEint_nomeite: TWideStringField;
    FAT_SQ_R_PCA_PED_ITEint_nomecor: TWideStringField;
    FAT_SQ_R_PCA_PED_ITEint_id_und_venda: TWideStringField;
    FAT_SQ_R_PCA_PED_ITEqtde: TFloatField;
    FAT_SQ_R_PCA_PED_ITEid_grupo: TWideStringField;
    FAT_SQ_M_PCA_PEDint_num_lote_opr: TWideStringField;
    PCP_DP_R_EPP_GRU: TDataSetProvider;
    PCP_SQ_R_EPP_GRU: TSQLDataSet;
    BUS_SQ_M_NFE_ITE_INTpcp_obs_item: TWideStringField;
    CAD_SQ_C_FUNseg_alterar_local_tit_fin: TBooleanField;
    CAD_SQ_C_LTOem_protesto: TBooleanField;
    CAD_SQ_C_LTOem_spc: TBooleanField;
    CAD_SQ_C_FUNseg_vis_aviso_tit_spc_protesto: TBooleanField;
    PCP_SQ_M_EPPtipo_entrada: TIntegerField;
    PCP_SQ_M_ETQcontagem: TBooleanField;
    PCP_SQ_M_ETQdta_entrada_antes_contagem: TDateField;
    PCP_SQ_M_ETQhor_entrada_antes_contagem: TTimeField;
    PCP_SQ_R_POP: TSQLDataSet;
    PCP_DP_R_POP: TDataSetProvider;
    FAT_SQ_M_PEDper_desc_basico: TFloatField;
    FAT_SQ_M_PEDper_desc_especial: TFloatField;
    FAT_SQ_M_PED_ITEper_desc_basico: TFloatField;
    FAT_SQ_M_PED_ITEvlr_desc_basico: TFMTBCDField;
    FAT_SQ_M_PED_ITEper_desc_especial: TFloatField;
    FAT_SQ_M_PED_ITEvlr_desc_especial: TFMTBCDField;
    CAD_SQ_C_FUNsgq_perm_botao_ger_prod: TBooleanField;
    FAT_SQ_M_PEDdta_liberacao: TDateField;
    FAT_SQ_M_PEDint_nomelib: TWideStringField;
    PCP_SQ_M_EPP_ITEint_ite_sgq_personalizado: TBooleanField;
    CAD_SQ_C_FUNsgq_perm_atual_contagem: TBooleanField;
    EST_SQ_M_CTE_ITEsaldo_estoque_momento: TFloatField;
    FAT_SQ_M_PCA_PED_ITEint_nomeite: TWideStringField;
    BUS_SQ_C_PAR_CTRpcp_cpa_id_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_PAR_CTRpcp_cpa_id_tipo_mov_estoque: TIntegerField;
    CAD_SQ_C_GRUsgq_descartar_op_etq_cof: TBooleanField;
    BUS_SQ_M_PCA_PEDint_situacaoped: TIntegerField;
    PCP_SQ_M_ROMid_pca: TIntegerField;
    PCP_SQ_M_ROM_PEDimportado: TBooleanField;
    PCP_SQ_M_ROM_ITE: TSQLDataSet;
    PCP_SQ_M_ROM_ICF: TSQLDataSet;
    PCP_SQ_M_ROM_ICFid_rom: TIntegerField;
    PCP_SQ_M_ROM_ICFid_rom_icf: TIntegerField;
    PCP_SQ_M_ROM_ICFid_item: TIntegerField;
    PCP_SQ_M_ROM_ICFid_cor: TIntegerField;
    PCP_SQ_M_ROM_ICFid_tamanho: TIntegerField;
    PCP_SQ_M_ROM_ICFcod_barra: TWideStringField;
    PCP_SQ_M_ROM_ICFid_responsavel: TIntegerField;
    PCP_SQ_M_ROM_ICFdta_conferencia: TDateField;
    PCP_SQ_M_ROM_ICFhor_conferencia: TTimeField;
    PCP_SQ_M_ROM_ICFid_opr_etq: TIntegerField;
    PCP_SQ_M_ROM_ICFitem_conjugado: TBooleanField;
    PCP_SQ_M_ROM_ICFtemp_cod_barra_antigo: TWideStringField;
    PCP_SQ_M_ROM_ICFint_undvenda: TWideStringField;
    PCP_SQ_M_ROM_ICFint_nomecor: TWideStringField;
    PCP_SQ_M_ROM_ICFint_nometam: TWideStringField;
    PCP_SQ_M_ROM_ITEid_rom: TIntegerField;
    PCP_SQ_M_ROM_ITEid_rom_ite: TIntegerField;
    PCP_SQ_M_ROM_ITEid_item: TIntegerField;
    PCP_SQ_M_ROM_ITEid_cor: TIntegerField;
    PCP_SQ_M_ROM_ITEid_tamanho: TIntegerField;
    PCP_SQ_M_ROM_ITEqtde: TFloatField;
    PCP_SQ_M_ROM_ITEqtde_conferida: TFloatField;
    PCP_SQ_M_ROM_ITEqtde_conj: TFloatField;
    PCP_SQ_M_ROM_ITEqtde_conj_conf: TFloatField;
    PCP_SQ_M_ROM_ITEnome_ite: TWideStringField;
    PCP_SQ_M_ROM_ITEint_undvenda: TWideStringField;
    PCP_SQ_M_ROM_ITEint_nomecor: TWideStringField;
    PCP_SQ_M_ROM_ITEint_nometam: TWideStringField;
    PCP_SQ_M_ROM_ICFint_nomeite: TWideStringField;
    PCP_SQ_M_ROM_PEDint_id_opr: TIntegerField;
    PCP_SQ_M_ROM_PEDint_horpedido: TSQLTimeStampField;
    PCP_SQ_M_ROMqtde_total_ite_conf: TFloatField;
    FAT_SQ_M_PCA_PEDint_uf: TWideStringField;
    PCP_SQ_M_ROM_ICFid_pedido: TIntegerField;
    FAT_SQ_M_PEDpcp_obs: TWideStringField;
    FAT_SQ_M_PEDpedido_automatico: TBooleanField;
    BUS_DS_M_PED_GER: TDataSource;
    BUS_DP_M_PED_GER: TDataSetProvider;
    BUS_SQ_M_PED_GER: TSQLDataSet;
    BUS_SQ_M_PED_ITE_GER: TSQLDataSet;
    IntegerField215: TIntegerField;
    IntegerField216: TIntegerField;
    IntegerField217: TIntegerField;
    FloatField54: TFloatField;
    FMTBCDField142: TFMTBCDField;
    FMTBCDField143: TFMTBCDField;
    FloatField55: TFloatField;
    FMTBCDField144: TFMTBCDField;
    FMTBCDField145: TFMTBCDField;
    IntegerField218: TIntegerField;
    IntegerField219: TIntegerField;
    WideStringField228: TWideStringField;
    WideStringField229: TWideStringField;
    WideStringField230: TWideStringField;
    WideStringField231: TWideStringField;
    WideStringField232: TWideStringField;
    FMTBCDField146: TFMTBCDField;
    WideStringField233: TWideStringField;
    IntegerField220: TIntegerField;
    WideStringField234: TWideStringField;
    WideStringField235: TWideStringField;
    WideStringField236: TWideStringField;
    FloatField56: TFloatField;
    FloatField57: TFloatField;
    WideStringField237: TWideStringField;
    IntegerField221: TIntegerField;
    WideStringField238: TWideStringField;
    BooleanField15: TBooleanField;
    FMTBCDField147: TFMTBCDField;
    WideStringField239: TWideStringField;
    WideStringField240: TWideStringField;
    WideStringField241: TWideStringField;
    FMTBCDField148: TFMTBCDField;
    WideStringField242: TWideStringField;
    BooleanField16: TBooleanField;
    IntegerField222: TIntegerField;
    BooleanField17: TBooleanField;
    IntegerField223: TIntegerField;
    WideStringField243: TWideStringField;
    FloatField58: TFloatField;
    FMTBCDField149: TFMTBCDField;
    FloatField59: TFloatField;
    FMTBCDField150: TFMTBCDField;
    BUS_SQ_M_PED_TIT_GER: TSQLDataSet;
    IntegerField224: TIntegerField;
    IntegerField225: TIntegerField;
    IntegerField226: TIntegerField;
    DateField38: TDateField;
    FMTBCDField151: TFMTBCDField;
    WideStringField244: TWideStringField;
    WideStringField245: TWideStringField;
    IntegerField227: TIntegerField;
    IntegerField228: TIntegerField;
    WideStringField246: TWideStringField;
    IntegerField229: TIntegerField;
    IntegerField230: TIntegerField;
    WideStringField247: TWideStringField;
    IntegerField231: TIntegerField;
    IntegerField232: TIntegerField;
    BUS_SQ_M_PED_GERint_selecao: TBooleanField;
    BUS_SQ_M_PED_GERid_pedido: TIntegerField;
    BUS_SQ_M_PED_GERid_empresa: TIntegerField;
    BUS_SQ_M_PED_GERdta_pedido: TDateField;
    BUS_SQ_M_PED_GERid_tipo_mov_estoque: TIntegerField;
    BUS_SQ_M_PED_GERid_vendedor: TIntegerField;
    BUS_SQ_M_PED_GERobs: TWideStringField;
    BUS_SQ_M_PED_GERvlr_bruto: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PED_GERper_desconto: TFloatField;
    BUS_SQ_M_PED_GERvlr_liquido: TFMTBCDField;
    BUS_SQ_M_PED_GERhor_pedido: TSQLTimeStampField;
    BUS_SQ_M_PED_GERid_condicao_pag: TIntegerField;
    BUS_SQ_M_PED_GERpcp_obs: TWideStringField;
    BUS_SQ_M_PED_GERpcp_id_opr: TIntegerField;
    BUS_SQ_M_PED_GERsituacao: TIntegerField;
    BUS_SQ_M_PED_GERsituacao_aprovacao: TIntegerField;
    BUS_SQ_M_PED_GERid_atendente: TIntegerField;
    BUS_SQ_M_PED_GERid_responsavel: TIntegerField;
    BUS_SQ_M_PED_GERid_cliente: TIntegerField;
    BUS_SQ_M_PED_GERtipo_restricao: TWideStringField;
    BUS_SQ_M_PED_GERid_almoxarifado: TIntegerField;
    BUS_SQ_M_PED_GERjustificativa: TWideStringField;
    BUS_SQ_M_PED_GERid_usuario_lib: TIntegerField;
    BUS_SQ_M_PED_GERcod_lme: TWideStringField;
    BUS_SQ_M_PED_GERrev_lme: TWideStringField;
    BUS_SQ_M_PED_GERorigem: TIntegerField;
    BUS_SQ_M_PED_GERdispositivo: TWideStringField;
    BUS_SQ_M_PED_GERgps_latitude: TFloatField;
    BUS_SQ_M_PED_GERgps_longitude: TFloatField;
    BUS_SQ_M_PED_GERcubagem: TFloatField;
    BUS_SQ_M_PED_GERid_orcamento: TIntegerField;
    BUS_SQ_M_PED_GERenvia_carga: TBooleanField;
    BUS_SQ_M_PED_GERdta_prev_entrega: TDateField;
    BUS_SQ_M_PED_GERid_abertura: TIntegerField;
    BUS_SQ_M_PED_GERdias_cpg_prazo: TIntegerField;
    BUS_SQ_M_PED_GERoffline: TBooleanField;
    BUS_SQ_M_PED_GERconferido: TBooleanField;
    BUS_SQ_M_PED_GERid_conf: TIntegerField;
    BUS_SQ_M_PED_GERdta_conf: TDateField;
    BUS_SQ_M_PED_GERhor_conf: TTimeField;
    BUS_SQ_M_PED_GERresultado_conf: TIntegerField;
    BUS_SQ_M_PED_GERid_resp_conf: TIntegerField;
    BUS_SQ_M_PED_GERid_propriedade: TIntegerField;
    BUS_SQ_M_PED_GERid_mkt: TIntegerField;
    BUS_SQ_M_PED_GERvlr_frete: TFMTBCDField;
    BUS_SQ_M_PED_GERmod_frete: TIntegerField;
    BUS_SQ_M_PED_GERcan_usuario: TIntegerField;
    BUS_SQ_M_PED_GERcan_data: TDateField;
    BUS_SQ_M_PED_GERcan_motivo: TWideStringField;
    BUS_SQ_M_PED_GERcan_hora: TTimeField;
    BUS_SQ_M_PED_GERsemana: TIntegerField;
    BUS_SQ_M_PED_GERid_motorista: TIntegerField;
    BUS_SQ_M_PED_GERid_placa: TWideStringField;
    BUS_SQ_M_PED_GERvlr_credito: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desc_especial: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desc_basico: TFMTBCDField;
    BUS_SQ_M_PED_GERsgq_per_comissao: TFloatField;
    BUS_SQ_M_PED_GERqtde_volume: TFloatField;
    BUS_SQ_M_PED_GERvlr_icm_desn: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desc_produtos: TFMTBCDField;
    BUS_SQ_M_PED_GERper_desc_produtos: TFloatField;
    BUS_SQ_M_PED_GERvlr_produtos: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_serv_bruto: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desc_servicos: TFMTBCDField;
    BUS_SQ_M_PED_GERper_desc_servicos: TFloatField;
    BUS_SQ_M_PED_GERvlr_ser_liquido: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_terceiro: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_desc_terceiro: TFMTBCDField;
    BUS_SQ_M_PED_GERper_desc_terceiro: TFloatField;
    BUS_SQ_M_PED_GERvlr_terc_liquido: TFMTBCDField;
    BUS_SQ_M_PED_GERped_gera_fin_separado: TBooleanField;
    BUS_SQ_M_PED_GERvlr_prod_liquido: TFMTBCDField;
    BUS_SQ_M_PED_GERsepara_prod_serv: TBooleanField;
    BUS_SQ_M_PED_GERvlr_cred_produtos: TFMTBCDField;
    BUS_SQ_M_PED_GERvlr_cred_servicos: TFMTBCDField;
    BUS_SQ_M_PED_GERid_pedido_orig: TIntegerField;
    BUS_SQ_M_PED_GERid_mecanico: TIntegerField;
    BUS_SQ_M_PED_GERsgq_texto_cond_pgto: TWideStringField;
    BUS_SQ_M_PED_GERper_desc_basico: TFloatField;
    BUS_SQ_M_PED_GERper_desc_especial: TFloatField;
    BUS_SQ_M_PED_GERdta_liberacao: TDateField;
    BUS_SQ_M_PED_GERpedido_automatico: TBooleanField;
    BUS_SQ_M_PED_GERint_nomecli: TWideStringField;
    BUS_SQ_M_PED_GERint_nometme: TWideStringField;
    BUS_SQ_M_PED_GERint_nomefun: TWideStringField;
    BUS_SQ_M_PED_GERint_nomecpg: TWideStringField;
    BUS_SQ_M_PED_GERint_nomeate: TWideStringField;
    BUS_SQ_M_PED_GERint_nome_rcn: TWideStringField;
    BUS_SQ_M_PED_GERint_nomeres: TWideStringField;
    BUS_SQ_M_PED_GERint_nomecid: TWideStringField;
    BUS_SQ_M_PED_GERint_nomeest: TWideStringField;
    BUS_SQ_M_PED_GERint_cpfcnpj: TWideStringField;
    BUS_SQ_M_PED_GERint_pessoacli: TIntegerField;
    BUS_SQ_M_PED_GERint_nomelib: TWideStringField;
    BUS_SQ_M_PED_GERint_id_perfil: TIntegerField;
    BUS_SQ_M_PED_GERid_ors: TIntegerField;
    BUS_SQ_M_PED_GERint_sitaprov: TWideStringField;
    BUS_SQ_M_PED_GERint_sitped: TWideStringField;
    BUS_SQ_M_PED_GERint_sitped2: TWideStringField;
    BUS_SQ_M_PED_GERint_sitord: TIntegerField;
    BUS_SQ_M_PED_GERint_ie_rg_cli: TWideStringField;
    BUS_SQ_M_PED_GERint_nomereg: TWideStringField;
    BUS_SQ_M_PED_GERint_numloteopr: TWideStringField;
    BUS_SQ_M_PED_GERint_nomemta: TWideStringField;
    FAT_SQ_M_PEDpedido_origem_aut: TIntegerField;
    BUS_SQ_M_PED_GERpedido_origem_aut: TIntegerField;
    PCP_SQ_M_OPR_PEDorigem_insercao: TIntegerField;
    FAT_SQ_M_NFEid_pedido_prod_1: TIntegerField;
    FAT_SQ_M_NFEvlr_liquido_ped_prod_1: TFMTBCDField;
    FAT_SQ_M_NFEid_pedido_prod_2: TIntegerField;
    FAT_SQ_M_NFEvlr_liquido_ped_prod_2: TFMTBCDField;
    FAT_SQ_M_NFEid_pedido_prod_3: TIntegerField;
    FAT_SQ_M_NFEvlr_liquido_ped_prod_3: TFMTBCDField;
    FAT_SQ_M_NFEid_pedido_prod_4: TIntegerField;
    FAT_SQ_M_NFEvlr_liquido_ped_prod_4: TFMTBCDField;
    CAD_SQ_C_PAR_CTRpcp_atualiza_fin_base_prod: TBooleanField;
    CAD_SQ_C_PAR_CTRpcp_id_empresa_base_prod: TIntegerField;
    CAD_SQ_C_GRUsgq_bloco_espuma: TBooleanField;
    CAD_SQ_C_GRUsgq_calc_bloco_produzir: TBooleanField;
    CAD_SQ_C_GRUid_item_bloco_espuma: TIntegerField;
    CAD_SQ_C_GRUint_nomeite_espuma: TWideStringField;
    CAD_SQ_C_ITEint_sgqblocoespuma: TBooleanField;
    CAD_SQ_C_ITEint_sgqcalcbloco: TBooleanField;
    FAT_SQ_M_NFEid_pedido_prod_5: TIntegerField;
    FAT_SQ_M_NFEvlr_liquido_ped_prod_5: TFMTBCDField;
    PCP_SQ_M_ORSid_fiscal: TIntegerField;
    CAD_SQ_C_CTCsequencia_remessa: TIntegerField;
    CAD_SQ_C_PAR_CTRpcp_id_empresa_base_fat: TIntegerField;
    FAT_SQ_M_PEDgerar_pedido_diferenca: TBooleanField;
    BUS_SQ_M_PED_GERgerar_pedido_diferenca: TBooleanField;
    BUS_SQ_M_PED_GERid_pedido_gerado: TIntegerField;
    FAT_SQ_M_PEDid_pedido_gerado: TIntegerField;
    FAT_SQ_M_ROMdta_hor_ini_viagem: TSQLTimeStampField;
    BUS_SQ_M_PED_INTobs: TWideStringField;
    BUS_SQ_M_PED_INTpcp_obs: TWideStringField;
    BUS_SQ_M_PEDint_selecao: TBooleanField;
    BUS_SQ_M_PEDid_pedido: TIntegerField;
    BUS_SQ_M_PEDid_empresa: TIntegerField;
    BUS_SQ_M_PEDdta_pedido: TDateField;
    BUS_SQ_M_PEDid_tipo_mov_estoque: TIntegerField;
    BUS_SQ_M_PEDid_vendedor: TIntegerField;
    BUS_SQ_M_PEDobs: TWideStringField;
    BUS_SQ_M_PEDvlr_bruto: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desconto: TFMTBCDField;
    BUS_SQ_M_PEDper_desconto: TFloatField;
    BUS_SQ_M_PEDvlr_liquido: TFMTBCDField;
    BUS_SQ_M_PEDhor_pedido: TSQLTimeStampField;
    BUS_SQ_M_PEDid_condicao_pag: TIntegerField;
    BUS_SQ_M_PEDpcp_obs: TWideStringField;
    BUS_SQ_M_PEDpcp_id_opr: TIntegerField;
    BUS_SQ_M_PEDsituacao: TIntegerField;
    BUS_SQ_M_PEDsituacao_aprovacao: TIntegerField;
    BUS_SQ_M_PEDid_atendente: TIntegerField;
    BUS_SQ_M_PEDid_responsavel: TIntegerField;
    BUS_SQ_M_PEDid_cliente: TIntegerField;
    BUS_SQ_M_PEDtipo_restricao: TWideStringField;
    BUS_SQ_M_PEDid_almoxarifado: TIntegerField;
    BUS_SQ_M_PEDjustificativa: TWideStringField;
    BUS_SQ_M_PEDid_usuario_lib: TIntegerField;
    BUS_SQ_M_PEDcod_lme: TWideStringField;
    BUS_SQ_M_PEDrev_lme: TWideStringField;
    BUS_SQ_M_PEDorigem: TIntegerField;
    BUS_SQ_M_PEDdispositivo: TWideStringField;
    BUS_SQ_M_PEDgps_latitude: TFloatField;
    BUS_SQ_M_PEDgps_longitude: TFloatField;
    BUS_SQ_M_PEDcubagem: TFloatField;
    BUS_SQ_M_PEDid_orcamento: TIntegerField;
    BUS_SQ_M_PEDenvia_carga: TBooleanField;
    BUS_SQ_M_PEDdta_prev_entrega: TDateField;
    BUS_SQ_M_PEDid_abertura: TIntegerField;
    BUS_SQ_M_PEDdias_cpg_prazo: TIntegerField;
    BUS_SQ_M_PEDoffline: TBooleanField;
    BUS_SQ_M_PEDconferido: TBooleanField;
    BUS_SQ_M_PEDid_conf: TIntegerField;
    BUS_SQ_M_PEDdta_conf: TDateField;
    BUS_SQ_M_PEDhor_conf: TTimeField;
    BUS_SQ_M_PEDresultado_conf: TIntegerField;
    BUS_SQ_M_PEDid_resp_conf: TIntegerField;
    BUS_SQ_M_PEDid_propriedade: TIntegerField;
    BUS_SQ_M_PEDid_mkt: TIntegerField;
    BUS_SQ_M_PEDvlr_frete: TFMTBCDField;
    BUS_SQ_M_PEDmod_frete: TIntegerField;
    BUS_SQ_M_PEDcan_usuario: TIntegerField;
    BUS_SQ_M_PEDcan_data: TDateField;
    BUS_SQ_M_PEDcan_motivo: TWideStringField;
    BUS_SQ_M_PEDcan_hora: TTimeField;
    BUS_SQ_M_PEDid_motorista: TIntegerField;
    BUS_SQ_M_PEDid_placa: TWideStringField;
    BUS_SQ_M_PEDvlr_credito: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desc_especial: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desc_basico: TFMTBCDField;
    BUS_SQ_M_PEDsgq_per_comissao: TFloatField;
    BUS_SQ_M_PEDqtde_volume: TFloatField;
    BUS_SQ_M_PEDvlr_icm_desn: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desc_produtos: TFMTBCDField;
    BUS_SQ_M_PEDper_desc_produtos: TFloatField;
    BUS_SQ_M_PEDvlr_produtos: TFMTBCDField;
    BUS_SQ_M_PEDvlr_serv_bruto: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desc_servicos: TFMTBCDField;
    BUS_SQ_M_PEDper_desc_servicos: TFloatField;
    BUS_SQ_M_PEDvlr_ser_liquido: TFMTBCDField;
    BUS_SQ_M_PEDvlr_terceiro: TFMTBCDField;
    BUS_SQ_M_PEDvlr_desc_terceiro: TFMTBCDField;
    BUS_SQ_M_PEDper_desc_terceiro: TFloatField;
    BUS_SQ_M_PEDvlr_terc_liquido: TFMTBCDField;
    BUS_SQ_M_PEDped_gera_fin_separado: TBooleanField;
    BUS_SQ_M_PEDvlr_prod_liquido: TFMTBCDField;
    BUS_SQ_M_PEDsepara_prod_serv: TBooleanField;
    BUS_SQ_M_PEDvlr_cred_produtos: TFMTBCDField;
    BUS_SQ_M_PEDvlr_cred_servicos: TFMTBCDField;
    BUS_SQ_M_PEDid_pedido_orig: TIntegerField;
    BUS_SQ_M_PEDid_mecanico: TIntegerField;
    BUS_SQ_M_PEDvlr_desc_pos_fat: TFMTBCDField;
    BUS_SQ_M_PEDsgq_texto_cond_pgto: TWideStringField;
    BUS_SQ_M_PEDper_desc_basico: TFloatField;
    BUS_SQ_M_PEDper_desc_especial: TFloatField;
    BUS_SQ_M_PEDdta_liberacao: TDateField;
    BUS_SQ_M_PEDpedido_automatico: TBooleanField;
    BUS_SQ_M_PEDpedido_origem_aut: TIntegerField;
    BUS_SQ_M_PEDgerar_pedido_diferenca: TBooleanField;
    BUS_SQ_M_PEDid_pedido_gerado: TIntegerField;
    BUS_SQ_M_PEDint_nomecli: TWideStringField;
    BUS_SQ_M_PEDint_nometme: TWideStringField;
    BUS_SQ_M_PEDint_nomefun: TWideStringField;
    BUS_SQ_M_PEDint_nomecpg: TWideStringField;
    BUS_SQ_M_PEDint_nomeate: TWideStringField;
    BUS_SQ_M_PEDint_nome_rcn: TWideStringField;
    BUS_SQ_M_PEDint_nomeres: TWideStringField;
    BUS_SQ_M_PEDint_nomecid: TWideStringField;
    BUS_SQ_M_PEDint_nomeest: TWideStringField;
    BUS_SQ_M_PEDint_cpfcnpj: TWideStringField;
    BUS_SQ_M_PEDint_pessoacli: TIntegerField;
    BUS_SQ_M_PEDint_id_perfil: TIntegerField;
    BUS_SQ_M_PEDid_ors: TIntegerField;
    BUS_SQ_M_PEDint_sitaprov: TWideStringField;
    BUS_SQ_M_PEDint_sitped: TWideStringField;
    BUS_SQ_M_PEDint_ie_rg_cli: TWideStringField;
    BUS_SQ_M_PEDint_nomereg: TWideStringField;
    BUS_SQ_M_PEDint_num_lote_opr: TWideStringField;
    BUS_DP_M_OPR_OPP: TDataSetProvider;
    BUS_SQ_M_OPR_OPP: TSQLDataSet;
    PCP_SQ_M_ROM_PEDint_situacaoped: TIntegerField;
    PCP_SQ_M_ROM_PEDint_dtaemissao_ors: TDateField;
    PCP_SQ_M_ROM_PEDint_id_ors: TIntegerField;
    FIN_SQ_M_RECbol_remessa_env: TBooleanField;
    FIN_SQ_M_RECbol_remessa_dta: TDateField;
    FIN_SQ_M_RECbol_remessa_id_func: TIntegerField;
    FIN_SQ_M_RECbol_remessa_nome_arq: TWideStringField;
    BUS_SQ_M_RECbol_remessa_env: TBooleanField;
    BUS_SQ_M_RECbol_remessa_dta: TDateField;
    BUS_SQ_M_RECbol_remessa_id_func: TIntegerField;
    BUS_SQ_M_RECbol_remessa_nome_arq: TWideStringField;
    CAD_SQ_C_ITEcod_item_prod: TIntegerField;
    FAT_SQ_M_PEDper_desconto_fat: TFloatField;
    BUS_SQ_M_PED_GERper_desconto_fat: TFloatField;
    BUS_SQ_M_PEDper_desconto_fat: TFloatField;
    BUS_DP_M_ROM_ICF: TDataSetProvider;
    BUS_SQ_M_ROM_ICF: TSQLDataSet;
    PCP_SQ_M_ROM_PEDint_ped_vlr_liquido: TFMTBCDField;
    BUS_DP_R_ROM_VLC: TDataSetProvider;
    BUS_SQ_R_ROM_VLC: TSQLDataSet;
    BUS_SQ_R_ROM_VLC_PED: TSQLDataSet;
    BUS_SQ_R_ROM_VLC_PEDid_pedido: TIntegerField;
    BUS_SQ_R_ROM_VLC_PEDdta_pedido: TDateField;
    BUS_SQ_R_ROM_VLC_PEDnome: TWideStringField;
    BUS_SQ_R_ROM_VLC_PEDvlr_liquido: TFMTBCDField;
    BUS_SQ_R_ROM_VLCid_rom: TIntegerField;
    BUS_SQ_R_ROM_VLCid_empresa: TIntegerField;
    BUS_SQ_R_ROM_VLCdta_emissao: TDateField;
    BUS_SQ_R_ROM_VLCid_responsavel: TIntegerField;
    BUS_SQ_R_ROM_VLCid_motorista: TIntegerField;
    BUS_SQ_R_ROM_VLCobservacao: TWideStringField;
    BUS_SQ_R_ROM_VLCcod_lme: TWideStringField;
    BUS_SQ_R_ROM_VLCrev_lme: TWideStringField;
    BUS_SQ_R_ROM_VLCplaca: TWideStringField;
    BUS_SQ_R_ROM_VLClot_qtde_total: TFloatField;
    BUS_SQ_R_ROM_VLChor_emissao: TTimeField;
    BUS_SQ_R_ROM_VLChor_alt: TTimeField;
    BUS_SQ_R_ROM_VLCid_resp_alt: TIntegerField;
    BUS_SQ_R_ROM_VLCdta_alt: TDateField;
    BUS_SQ_R_ROM_VLChor_fin: TTimeField;
    BUS_SQ_R_ROM_VLCdta_fin: TDateField;
    BUS_SQ_R_ROM_VLCid_resp_fin: TIntegerField;
    BUS_SQ_R_ROM_VLCped_ite_qtde_total: TIntegerField;
    BUS_SQ_R_ROM_VLCid_pca: TIntegerField;
    BUS_SQ_R_ROM_VLCqtde_total_ite_conf: TFloatField;
    BUS_SQ_R_ROM_VLCnome: TWideStringField;
    BUS_SQ_R_ROM_VLCvlr_carga: TFMTBCDField;
    BUS_DS_R_ROM_VLC: TDataSource;
    BUS_SQ_R_ROM_VLC_PEDid_cliente: TIntegerField;
    BUS_SQ_R_ROM_VLC_PEDint_nomeven: TWideStringField;
    CAD_SQ_C_FUNsgq_vis_vlr_tot_carga: TBooleanField;
    FAT_SQ_R_PCA_PED_ITEnro_lotes_opr: TWideMemoField;
    CAD_SQ_C_FUNseg_alterar_fpg_tit_fin: TBooleanField;
    FAT_SQ_M_PCAseq_carreg_anual: TIntegerField;
    FAT_SQ_R_PCAseq_carreg_anual: TIntegerField;
    PCP_SQ_M_ROMseq_pca_carreg_anual: TIntegerField;
    BUS_SQ_M_PCAseq_carreg_anual: TIntegerField;
    BUS_SQ_M_PCA_PEDint_seq_carreg_anual: TIntegerField;
    CAD_SQ_C_FUNseg_alterar_ped_sit: TIntegerField;
    CAD_SQ_C_FUNsgq_per_comissao: TFloatField;
    CAD_SQ_C_ITEetiq_tipo_produto: TIntegerField;
    CAD_SQ_C_ITEint_etiq_tipo_produto: TWideStringField;
    PCP_SQ_M_ETQint_etiq_tipo_produto: TWideStringField;
    PCP_SQ_C_MTAfiliacao: TWideStringField;
    PCP_SQ_C_MTAnome_contato_1: TWideStringField;
    PCP_SQ_C_MTAfone_contato_1: TWideStringField;
    PCP_SQ_C_MTAtipo_cnh: TWideStringField;
    CAD_SQ_C_VEIcubagem_carga: TFloatField;
    CMP_SQ_M_PEDint_aprovado: TWideStringField;
    BUS_SQ_M_ILC_RBX_TIT: TSQLDataSet;
    BUS_DP_M_ILC_RBX_PED: TDataSetProvider;
    BUS_SQ_M_ILC_RBX_GER: TSQLDataSet;
    BUS_DS_M_ILC_RBX_PED: TDataSource;
    BUS_SQ_M_ILC_RBX_GERid_baixa: TIntegerField;
    BUS_SQ_M_ILC_RBX_GERid_controle: TIntegerField;
    BUS_SQ_M_ILC_RBX_GERvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_GERdta_vencimento: TDateField;
    BUS_SQ_M_ILC_RBX_GERche_conta: TIntegerField;
    BUS_SQ_M_ILC_RBX_GERche_cheque: TIntegerField;
    BUS_SQ_M_ILC_RBX_GERche_banco: TWideStringField;
    BUS_SQ_M_ILC_RBX_GERche_emitente: TWideStringField;
    BUS_SQ_M_ILC_RBX_GERche_agencia: TWideStringField;
    BUS_SQ_M_ILC_RBX_TITid_pedido: TIntegerField;
    BUS_SQ_M_ILC_RBX_TITid_ors: TIntegerField;
    BUS_SQ_M_ILC_RBX_TITdta_emissao: TDateField;
    BUS_SQ_M_ILC_RBX_TITvlr_liquido: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_TITid_baixa: TIntegerField;
    BUS_SQ_M_ILC_RBX_TITid_titulo: TIntegerField;
    BUS_SQ_M_ILC_RBX_TITnum_parcela: TWideStringField;
    BUS_SQ_M_ILC_RBX_TITdta_pagamento: TDateField;
    BUS_SQ_M_ILC_RBX_TITvlr_desconto: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_TITvlr_pagamento: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_TITdta_vencimento: TDateField;
    BUS_SQ_M_ILC_RBX_PED: TSQLDataSet;
    BUS_SQ_M_ILC_RBX_PEDid_pedido: TIntegerField;
    BUS_SQ_M_ILC_RBX_TITvlr_parcela: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_TITforma_pag: TWideStringField;
    BUS_SQ_M_ILC_RBX_TITforma_pag_rbx: TWideStringField;
    BUS_SQ_M_ILC_RBX_PEDid_ors: TIntegerField;
    BUS_SQ_M_ILC_RBX_PEDdta_emissao: TDateField;
    BUS_SQ_M_ILC_RBX_PEDvlr_liquido: TFMTBCDField;
    BUS_SQ_M_ILC_RBX_PEDdesc_cpg: TWideStringField;
    FIN_SQ_M_RBXint_doc_impresso: TIntegerField;
    FIN_SQ_M_RBX_TITint_dta_emissao_ors: TDateField;
    CAD_SQ_C_ITEtam_esp_espessura_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_espessura_2: TFloatField;
    CAD_SQ_C_ITEtam_esp_espessura_3: TFloatField;
    CAD_SQ_C_ITEtam_esp_comprimento_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_comprimento_2: TFloatField;
    CAD_SQ_C_ITEtam_esp_comprimento_3: TFloatField;
    CAD_SQ_C_ITEtam_esp_largura_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_largura_2: TFloatField;
    CAD_SQ_C_ITEtam_esp_largura_3: TFloatField;
    CAD_SQ_C_ITEcubagem_esp_1: TFloatField;
    CAD_SQ_C_ITEcubagem_esp_2: TFloatField;
    CAD_SQ_C_ITEcubagem_esp_3: TFloatField;
    CAD_SQ_C_GRUid_item_bloco_espuma_2: TIntegerField;
    CAD_SQ_C_GRUid_item_bloco_espuma_3: TIntegerField;
    CAD_SQ_C_GRUint_nomeite_espuma_2: TWideStringField;
    CAD_SQ_C_GRUint_nomeite_espuma_3: TWideStringField;
    PCP_SQ_M_OPB_OBL: TSQLDataSet;
    PCP_SQ_M_OPBorigem: TIntegerField;
    PCP_SQ_M_OPBid_opr: TIntegerField;
    PCP_SQ_M_OPB_BLO: TSQLDataSet;
    PCP_SQ_M_OPB_OBLid_opb: TIntegerField;
    PCP_SQ_M_OPB_OBLid_opb_obl: TIntegerField;
    PCP_SQ_M_OPB_OBLid_cor: TIntegerField;
    PCP_SQ_M_OPB_OBLid_tamanho: TIntegerField;
    PCP_SQ_M_OPB_OBLcubagem_a_produzir: TFloatField;
    PCP_SQ_M_OPB_OBLobs: TWideStringField;
    PCP_SQ_M_OPB_BLOid_opb: TIntegerField;
    PCP_SQ_M_OPB_BLOnum_lote: TWideStringField;
    PCP_SQ_M_OPB_BLOdta_emissao: TDateField;
    PCP_SQ_M_OPB_BLOhor_emissao: TTimeField;
    PCP_SQ_M_OPB_BLOid_item_bloco: TIntegerField;
    PCP_SQ_M_OPB_BLOid_cor: TIntegerField;
    PCP_SQ_M_OPB_BLOid_tamanho: TIntegerField;
    PCP_SQ_M_OPB_BLObloco_aprovado: TBooleanField;
    PCP_SQ_M_OPB_BLOint_nomeite: TWideStringField;
    PCP_SQ_M_OPB_BLOint_cubagem_bloco: TFloatField;
    PCP_SQ_M_OPB_BLOint_nomecor: TWideStringField;
    PCP_SQ_M_OPB_BLOint_nometam: TWideStringField;
    PCP_SQ_M_OPB_OBLint_nomeite: TWideStringField;
    PCP_SQ_M_OPB_OBLint_nomecor: TWideStringField;
    PCP_SQ_M_OPB_OBLint_nometam: TWideStringField;
    BUS_SQ_M_OPB_OBL: TSQLDataSet;
    BUS_DP_M_OPB_OBL: TDataSetProvider;
    BUS_SQ_M_OPB_OBLid_opb: TIntegerField;
    BUS_SQ_M_OPB_OBLid_opb_obl: TIntegerField;
    BUS_SQ_M_OPB_OBLid_cor: TIntegerField;
    BUS_SQ_M_OPB_OBLid_tamanho: TIntegerField;
    BUS_SQ_M_OPB_OBLcubagem_a_produzir: TFloatField;
    BUS_SQ_M_OPB_OBLobs: TWideStringField;
    BUS_SQ_M_OPB_OBLint_nomeite: TWideStringField;
    BUS_SQ_M_OPB_OBLint_nomecor: TWideStringField;
    BUS_SQ_M_OPB_OBLint_nometam: TWideStringField;
    BUS_SQ_M_OPB_OBLdta_emissao: TDateField;
    BUS_SQ_M_OPB_OBLid_responsavel: TIntegerField;
    BUS_SQ_M_OPB_OBLint_nomeres: TWideStringField;
    BUS_DP_M_OPR_GER_OPB: TDataSetProvider;
    BUS_SQ_M_OPR_GER_OPB: TSQLDataSet;
    BUS_SQ_M_OPR_OPP_INTbloco_gerado: TIntegerField;
    BUS_SQ_M_OPR_OPP_INTid_opb: TIntegerField;
    PCP_SQ_M_OPR_OPPbloco_gerado: TIntegerField;
    PCP_SQ_M_OPR_OPPid_opb: TIntegerField;
    BUS_DP_M_OPR_ITE_SCB: TDataSetProvider;
    BUS_SQ_M_OPR_ITE_SCB: TSQLDataSet;
    BUS_SQ_M_OPR_ITE_SCBid_item: TIntegerField;
    BUS_SQ_M_OPR_ITE_SCBdescricao: TWideStringField;
    BUS_SQ_M_OPR_ITE_SCBcubagem1: TWideStringField;
    BUS_SQ_M_OPR_ITE_SCBcubagem2: TWideStringField;
    BUS_SQ_M_OPR_ITE_SCBcubagem3: TWideStringField;
    PCP_SQ_M_OPR_OPPcriado_em: TDateField;
    PCP_SQ_M_OPR_OPPhora_criado: TTimeField;
    BUS_SQ_M_OPR_OPP_INTcriado_em: TDateField;
    BUS_SQ_M_OPR_OPP_INThora_criado: TTimeField;
    PCP_SQ_M_OPBint_numlote_opr: TWideStringField;
    PCP_SQ_M_OPB_BLOint_selecao: TBooleanField;
    CAD_SQ_C_PAR_CTRpcp_rom_ano_corrente: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_tam_letras: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_simb_conserv: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_inform_cadast_cont: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_cobert_garant_e_perda: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_tabela_garantia_biotipo: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_aviso_colchao_baby: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_desenho_esquem_colch: TIntegerField;
    FAT_SQ_M_IQM_ITEmanual_aviso_asfixia: TIntegerField;
    CAD_SQ_C_PAR_CTRpcp_atualiza_dta_pedido: TBooleanField;
    CAD_SQ_C_FPGacresc_dias_em_vencto: TIntegerField;
    CAD_SQ_C_FUNper_alterar_repres: TBooleanField;
    FAT_SQ_M_PEDid_func_pri_impressao: TIntegerField;
    FAT_SQ_M_PEDdta_pri_impressao: TDateField;
    FAT_SQ_M_PEDhor_pri_impressao: TTimeField;
    FAT_SQ_M_PEDid_func_seg_impressao: TIntegerField;
    FAT_SQ_M_PEDdta_seg_impressao: TDateField;
    FAT_SQ_M_PEDhor_seg_impressao: TTimeField;
    FAT_SQ_M_PEDid_func_ter_impressao: TIntegerField;
    FAT_SQ_M_PEDdta_ter_impressao: TDateField;
    FAT_SQ_M_PEDhor_ter_impressao: TTimeField;
    FAT_SQ_M_PEDmotivo_seg_impressao: TWideStringField;
    FAT_SQ_M_PEDmotivo_ter_impressao: TWideStringField;
    FAT_SQ_M_PEDint_nomepri_impres: TWideStringField;
    FAT_SQ_M_PEDint_nomeseg_impres: TWideStringField;
    FAT_SQ_M_PEDint_nometer_impres: TWideStringField;
    BUS_SQ_M_PEDid_func_pri_impressao: TIntegerField;
    BUS_SQ_M_PEDdta_pri_impressao: TDateField;
    BUS_SQ_M_PEDhor_pri_impressao: TTimeField;
    BUS_SQ_M_PEDid_func_seg_impressao: TIntegerField;
    BUS_SQ_M_PEDdta_seg_impressao: TDateField;
    BUS_SQ_M_PEDhor_seg_impressao: TTimeField;
    BUS_SQ_M_PEDid_func_ter_impressao: TIntegerField;
    BUS_SQ_M_PEDdta_ter_impressao: TDateField;
    BUS_SQ_M_PEDhor_ter_impressao: TTimeField;
    BUS_SQ_M_PEDmotivo_seg_impressao: TWideStringField;
    BUS_SQ_M_PEDmotivo_ter_impressao: TWideStringField;
    BUS_SQ_M_PED_GERid_func_pri_impressao: TIntegerField;
    BUS_SQ_M_PED_GERdta_pri_impressao: TDateField;
    BUS_SQ_M_PED_GERhor_pri_impressao: TTimeField;
    BUS_SQ_M_PED_GERid_func_seg_impressao: TIntegerField;
    BUS_SQ_M_PED_GERdta_seg_impressao: TDateField;
    BUS_SQ_M_PED_GERhor_seg_impressao: TTimeField;
    BUS_SQ_M_PED_GERid_func_ter_impressao: TIntegerField;
    BUS_SQ_M_PED_GERdta_ter_impressao: TDateField;
    BUS_SQ_M_PED_GERhor_ter_impressao: TTimeField;
    BUS_SQ_M_PED_GERmotivo_seg_impressao: TWideStringField;
    BUS_SQ_M_PED_GERmotivo_ter_impressao: TWideStringField;
    BUS_SQ_M_PED_GERint_nomepri_impres: TWideStringField;
    BUS_SQ_M_PED_GERint_nomeseg_impres: TWideStringField;
    BUS_SQ_M_PED_GERint_nometer_impres: TWideStringField;
    BUS_SQ_M_PEDint_nomepri_impres: TWideStringField;
    BUS_SQ_M_PEDint_nomeseg_impres: TWideStringField;
    BUS_SQ_M_PEDint_nometer_impres: TWideStringField;
    CAD_SQ_C_ITEtipo_produto: TIntegerField;
    PCP_SQ_M_ROM_PEDint_nomecpg: TWideStringField;
    PCP_SQ_M_ROM_PEDint_tipopag: TIntegerField;
    BUS_SQ_M_OPR_GER_OPBid_item_bloco_espuma: TIntegerField;
    BUS_SQ_M_OPR_GER_OPBcubagem_esp_1: TFloatField;
    BUS_SQ_M_OPR_GER_OPBbloco: TWideStringField;
    BUS_SQ_M_OPR_GER_OPBsaldo_fisico: TFloatField;
    BUS_SQ_M_OPR_GER_OPBcubagem_da_op: TFloatField;
    BUS_SQ_M_OPR_GER_OPBqtde_a_produzir: TFloatField;
    BUS_SQ_M_OPR_GER_OPBqtde_a_abater_no_sld: TFloatField;
    PCP_SQ_M_OPB_OBLqtde_abater_sld: TFloatField;
    CAD_SQ_C_PAR_CTRpcp_opb_id_tipo_mov_estoque: TIntegerField;
    BUS_SQ_M_OPB_OBL_INT: TSQLDataSet;
    BUS_DP_M_OPB_OBL_INT: TDataSetProvider;
    BUS_SQ_C_PAR_CTRpcp_opb_id_tipo_mov_estoque: TIntegerField;
    PCP_SQ_M_OPBid_almoxarifado: TIntegerField;
    EST_SQ_M_FEAid_opb: TIntegerField;
    PCP_SQ_M_OPB_OBLint_tipo_item: TWideStringField;
    PCP_SQ_M_OPB_OBLid_item: TIntegerField;
    BUS_SQ_M_OPB_OBLid_item: TIntegerField;
    BUS_SQ_M_OPB_OBLqtde_abater_sld: TFloatField;
    PCP_SQ_M_OPB_OBLnum_lote: TWideStringField;
    BUS_SQ_M_OPB_OBLnum_lote: TWideStringField;
    PCP_SQ_M_OPB_OBLop_espumacao_impressa: TBooleanField;
    PCP_SQ_M_OPB_OBLop_impressa_por: TIntegerField;
    PCP_SQ_M_OPB_OBLop_impressa_em: TDateField;
    BUS_SQ_M_OPB_OBLop_espumacao_impressa: TBooleanField;
    BUS_SQ_M_OPB_OBLop_impressa_por: TIntegerField;
    BUS_SQ_M_OPB_OBLop_impressa_em: TDateField;
    BUS_SQ_M_OPB_OBLint_nome_imp: TWideStringField;
    PCP_SQ_M_OPB_OBLint_nome_imp: TWideStringField;
    BUS_SQ_M_OPB_OBLint_cubagem_esp1: TFloatField;
    PCP_SQ_M_EPP_ITEid_func_colchoaria: TIntegerField;
    PCP_SQ_M_EPP_ITEint_nomefunc_colc: TWideStringField;
    PCP_SQ_R_EPP_FUN: TSQLDataSet;
    PCP_DP_R_EPP_FUN: TDataSetProvider;
    PCP_SQ_R_EPP_FUN_DET: TSQLDataSet;
    PCP_SQ_R_EPP_FUNid_empresa: TIntegerField;
    PCP_SQ_R_EPP_FUNemp_fantasia: TWideStringField;
    PCP_SQ_R_EPP_FUNid_almoxarifado: TIntegerField;
    PCP_SQ_R_EPP_FUNint_nomealm: TWideStringField;
    PCP_SQ_R_EPP_FUNid_func_colchoaria: TIntegerField;
    PCP_SQ_R_EPP_FUNint_nomefun: TWideStringField;
    PCP_SQ_R_EPP_FUNqtde: TFloatField;
    PCP_SQ_R_EPP_FUNid_grupo: TWideStringField;
    PCP_SQ_R_EPP_FUNdescricao: TWideStringField;
    PCP_DP_R_EPP_FUN_DET: TDataSetProvider;
    PCP_SQ_R_EPP_FUN_DETid_empresa: TIntegerField;
    PCP_SQ_R_EPP_FUN_DETemp_fantasia: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETid_almoxarifado: TIntegerField;
    PCP_SQ_R_EPP_FUN_DETint_nomealm: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETid_func_colchoaria: TIntegerField;
    PCP_SQ_R_EPP_FUN_DETint_nomefun: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETid_grupo: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETdescricao: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETid_item: TIntegerField;
    PCP_SQ_R_EPP_FUN_DETint_nomeite: TWideStringField;
    PCP_SQ_R_EPP_FUN_DETqtde: TFloatField;
    PCP_SQ_M_EPP_ITElancto_func_colch_manual: TBooleanField;
    BUS_SQ_M_ETQ: TSQLDataSet;
    IntegerField185: TIntegerField;
    IntegerField186: TIntegerField;
    IntegerField187: TIntegerField;
    IntegerField188: TIntegerField;
    WideStringField200: TWideStringField;
    IntegerField189: TIntegerField;
    DateField33: TDateField;
    TimeField3: TTimeField;
    BooleanField7: TBooleanField;
    WideStringField201: TWideStringField;
    WideStringField202: TWideStringField;
    WideStringField203: TWideStringField;
    IntegerField190: TIntegerField;
    DateField34: TDateField;
    TimeField4: TTimeField;
    IntegerField191: TIntegerField;
    TimeField5: TTimeField;
    DateField35: TDateField;
    IntegerField192: TIntegerField;
    IntegerField193: TIntegerField;
    BooleanField9: TBooleanField;
    WideStringField204: TWideStringField;
    WideStringField205: TWideStringField;
    WideStringField206: TWideStringField;
    WideStringField207: TWideStringField;
    WideStringField208: TWideStringField;
    WideStringField209: TWideStringField;
    IntegerField194: TIntegerField;
    BooleanField10: TBooleanField;
    BooleanField11: TBooleanField;
    IntegerField195: TIntegerField;
    WideStringField210: TWideStringField;
    WideStringField211: TWideStringField;
    WideStringField212: TWideStringField;
    WideStringField213: TWideStringField;
    BooleanField12: TBooleanField;
    WideStringField214: TWideStringField;
    WideStringField215: TWideStringField;
    WideStringField216: TWideStringField;
    IntegerField196: TIntegerField;
    IntegerField197: TIntegerField;
    IntegerField198: TIntegerField;
    WideStringField217: TWideStringField;
    WideStringField218: TWideStringField;
    WideStringField219: TWideStringField;
    WideStringField220: TWideStringField;
    WideStringField221: TWideStringField;
    WideStringField222: TWideStringField;
    IntegerField199: TIntegerField;
    DateField36: TDateField;
    TimeField6: TTimeField;
    IntegerField200: TIntegerField;
    IntegerField201: TIntegerField;
    WideStringField223: TWideStringField;
    BooleanField13: TBooleanField;
    WideStringField224: TWideStringField;
    IntegerField202: TIntegerField;
    WideStringField225: TWideStringField;
    WideStringField226: TWideStringField;
    WideStringField227: TWideStringField;
    WideStringField248: TWideStringField;
    WideStringField249: TWideStringField;
    WideStringField250: TWideStringField;
    DateField37: TDateField;
    TimeField7: TTimeField;
    IntegerField203: TIntegerField;
    WideStringField251: TWideStringField;
    WideStringField252: TWideStringField;
    WideStringField253: TWideStringField;
    WideStringField254: TWideStringField;
    WideStringField255: TWideStringField;
    WideStringField256: TWideStringField;
    WideStringField257: TWideStringField;
    WideStringField258: TWideStringField;
    WideStringField259: TWideStringField;
    WideStringField260: TWideStringField;
    WideStringField261: TWideStringField;
    WideStringField262: TWideStringField;
    WideStringField263: TWideStringField;
    WideStringField264: TWideStringField;
    WideStringField265: TWideStringField;
    WideStringField266: TWideStringField;
    BooleanField14: TBooleanField;
    DateField39: TDateField;
    TimeField8: TTimeField;
    WideStringField267: TWideStringField;
    CAD_SQ_C_ITEtam_esp_espessura_revest_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_espessura_revest_2: TFloatField;
    CAD_SQ_C_ITEtam_esp_comp_revest_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_comp_revest_2: TFloatField;
    CAD_SQ_C_ITEtam_esp_largura_revest_1: TFloatField;
    CAD_SQ_C_ITEtam_esp_largura_revest_2: TFloatField;
    CAD_SQ_C_ITEcubagem_esp_revest_1: TFloatField;
    CAD_SQ_C_ITEcubagem_esp_revest_2: TFloatField;
    CAD_SQ_C_ITEdensidade_esp_revest_1: TFloatField;
    CAD_SQ_C_ITEdensidade_esp_revest_2: TFloatField;
    CAD_SQ_C_GRUid_item_bloco_espuma_revest_1: TIntegerField;
    CAD_SQ_C_GRUid_item_bloco_espuma_revest_2: TIntegerField;
    CAD_SQ_C_GRUint_nomeite_espuma_revest_1: TWideStringField;
    CAD_SQ_C_GRUint_nomeite_espuma_revest_2: TWideStringField;
    BUS_SQ_M_OPR_ITE_SCBcubagem_resvestimento_1: TWideStringField;
    BUS_SQ_M_OPR_ITE_SCBcubagem_resvestimento_2: TWideStringField;
    PCP_SQ_M_OPR_PEDid_responsavel: TIntegerField;
    PCP_SQ_M_OPR_PEDdta_importacao: TDateField;
    PCP_SQ_M_OPR_PEDhor_importacao: TTimeField;
    PCP_SQ_M_OPR_PEDint_nomeresp_impot: TWideStringField;
    CAD_SQ_C_FORid_plano: TWideStringField;
    CAD_SQ_C_FORint_nomepct: TWideStringField;
    BUS_DP_M_ETQ: TDataSetProvider;
    FAT_SQ_M_PEDint_telmovel_ven: TWideStringField;
    FAT_SQ_M_PEDint_telfixo_ven: TWideStringField;
    BUS_SQ_M_PED_GERint_telmovel_ven: TWideStringField;
    BUS_SQ_M_PED_GERint_telfixo_ven: TWideStringField;
    CAD_SQ_C_PAR_NFEnfc_nome_arq_rel: TWideStringField;
    FAT_SQ_R_NFEvlr_icm: TFMTBCDField;
    FAT_SQ_R_NFEvlr_icm_subs: TFMTBCDField;
    CAD_SQ_C_FUN_CPN: TSQLDataSet;
    CAD_SQ_C_FUN_CPNid_funcionario: TIntegerField;
    CAD_SQ_C_FUN_CPNid_condicao_pag: TIntegerField;
    CAD_SQ_C_FUN_CPNint_nomecpg: TWideStringField;
    BUS_SQ_M_PED_ITT_INTper_desc_basico: TFloatField;
    BUS_SQ_M_PED_ITT_INTvlr_desc_basico: TFMTBCDField;
    BUS_SQ_M_PED_ITT_INTper_desc_especial: TFloatField;
    BUS_SQ_M_PED_ITT_INTvlr_desc_especial: TFMTBCDField;
    FIN_SQ_R_CSCRepresentante: TWideStringField;
    FIN_SQ_R_CSCCdcliente: TIntegerField;
    FIN_SQ_R_CSCnome: TWideStringField;
    FIN_SQ_R_CSCFixo: TWideStringField;
    FIN_SQ_R_CSCCelular: TWideStringField;
    FIN_SQ_R_CSCendereco: TWideStringField;
    FIN_SQ_R_CSCnumero: TWideStringField;
    FIN_SQ_R_CSCint_nomecid: TWideStringField;
    FIN_SQ_R_CSCltvenda: TDateField;
    FIN_SQ_R_CSCid_vendedor: TIntegerField;
    FIN_SQ_R_CSCemail: TWideStringField;
    FIN_SQ_R_CSCativo: TBooleanField;
    FIN_SQ_R_CSCqtde_dias_sem_compras: TIntegerField;
    FIN_SQ_R_CSCint_situacao: TWideStringField;
    FIN_SQ_R_CSCint_sexo: TWideStringField;
    FIN_SQ_R_CSCint_tipocliente: TWideStringField;
    FIN_SQ_R_CSCint_uf: TWideStringField;
    CAD_SQ_C_FORmetodo3_dta_auto_avaliacao: TDateField;
    CAD_SQ_C_GRUrastrea_espumacao: TBooleanField;
    CAD_SQ_C_GRUrastrea_laminacao: TBooleanField;
    CAD_SQ_C_GRUrastrea_bordadeira: TBooleanField;
    CAD_SQ_C_GRUrastrea_corte_costura: TBooleanField;
    CAD_SQ_C_GRUrastrea_colagem_tampo_alfin: TBooleanField;
    CAD_SQ_C_GRUrastrea_colagem_molas: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_espumacao: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_laminacao: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_bordadeira: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_corte_costura: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_colagem_tampo_alfin: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_colagem_molas: TBooleanField;
    CAD_SQ_C_GRUrastrea_montagem_caixa_box: TBooleanField;
    CAD_SQ_C_GRUexibe_na_impressao_op: TBooleanField;
    CAD_SQ_C_ITEint_nome_item_caixa_itt: TWideStringField;
    CAD_SQ_C_ITEid_item_caixa: TIntegerField;
    BUS_SQ_CSU_ITEtipo_produto: TIntegerField;
    BUS_SQ_CSU_ITEid_item_caixa: TIntegerField;
    PCP_SQ_M_OPR_OPPint_exibe_na_impressao_op: TBooleanField;
    PCP_SQ_M_OPR_OPPint_rastrea_montagem_caixa_box: TBooleanField;
    PCP_SQ_C_REGunifica_desc_reg: TBooleanField;
    CAD_SQ_C_CLIint_unif_desc_reg: TBooleanField;
    CAD_SQ_C_GRU_COR: TSQLDataSet;
    CAD_SQ_C_GRU_CORid_grupo: TWideStringField;
    CAD_SQ_C_GRU_CORid_cor: TIntegerField;
    CAD_SQ_C_GRU_CORint_nomecor: TWideStringField;
    CAD_SQ_C_PAR_CTRsgq_nome_etq_maquete: TWideStringField;
    CAD_SQ_C_CLInome_proprietario: TWideStringField;
    CAD_SQ_C_CLIdoc_cnpj_cpf_proprietario: TWideStringField;
    FIN_SQ_M_CON_CXBdta_movimento: TDateField;
    FIN_SQ_M_RBXint_doccnpjcpf: TWideStringField;
    FIN_SQ_M_PBXint_doccnpj: TWideStringField;
    FIN_SQ_M_RBXfaz_conciliacao: TBooleanField;
    FIN_SQ_M_RBX_TITconcilia: TBooleanField;
    FAT_SQ_M_ROMint_placa_reboque: TWideStringField;
    FAT_SQ_M_ROMint_tara_reboque: TFloatField;
    FAT_SQ_M_ROMint_cap_reboque: TFloatField;
    FAT_SQ_M_ROMint_cubagem_reboque: TFloatField;
    CAD_SQ_C_VEIplaca_reboque: TWideStringField;
    CAD_SQ_C_VEItara_reboque: TFloatField;
    CAD_SQ_C_VEIcap_reboque: TFloatField;
    CAD_SQ_C_VEIcubagem_reboque: TFloatField;
    CAD_SQ_C_GRUnome_selo_inmetro_etq: TWideStringField;
    PCP_SQ_M_ETQint_nome_selo_inmetro_etq: TWideStringField;
    FAT_SQ_M_ORCvlr_bruto: TFMTBCDField;
    FAT_SQ_M_ORCvlr_desc_basico: TFMTBCDField;
    FAT_SQ_M_ORCper_desc_basico: TFloatField;
    FAT_SQ_M_ORCper_desc_especial: TFloatField;
    FAT_SQ_M_ORCvlr_desconto: TFMTBCDField;
    FAT_SQ_M_ORCper_desconto: TFloatField;
    FAT_SQ_M_ORCvlr_liquido: TFMTBCDField;
    FAT_SQ_M_ORCvlr_frete: TFMTBCDField;
    FAT_SQ_M_ORC_ITEper_desc_max: TFloatField;
    FAT_SQ_M_ORCsepara_prod_serv: TBooleanField;
    FAT_SQ_M_ORC_ITEvlr_frete: TFMTBCDField;
    FAT_SQ_M_ORCvlr_desc_especial: TFMTBCDField;
    CAD_SQ_C_PAR_CTRsgq_fat_orc_id_condicao_pag: TIntegerField;
    CAD_SQ_C_PAR_CTRsgq_fat_ped_id_condicao_pag: TIntegerField;
    FAT_SQ_M_ORC_ITEper_desc_basico: TFloatField;
    FAT_SQ_M_ORC_ITEvlr_desc_basico: TFMTBCDField;
    FAT_SQ_M_ORC_ITEper_desc_especial: TFloatField;
    FAT_SQ_M_ORC_ITEvlr_desc_especial: TFMTBCDField;
    FAT_SQ_M_ORCvlr_icm_desn: TFMTBCDField;
    CAD_SQ_C_PAR_CTRfat_validade_orc: TIntegerField;
    CAD_SQ_C_PAR_CTRfat_id_tipo_mov_estoque_rep: TIntegerField;
    CAD_SQ_C_FUNbus_som_ped_sem_pagtos: TBooleanField;
    CAD_SQ_C_FUNsgq_perm_inserir_itens_op: TBooleanField;
    CAD_SQ_C_PAR_CTRfat_qtde_dias_canc_ped_autom: TIntegerField;
    function CAD_DP_C_CNEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CMP_DP_M_SOLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CIDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_RAMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CINDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CCUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CTCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_LTODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_TIFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_TMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_FPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_UNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_NCMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_INFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_NATDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CFODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_TRIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_ECFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_FUNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PESDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_ALMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CDRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CNFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_DISDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_ESPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_LMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_MTADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_REGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_ROTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_TLMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_FEADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_FESDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PAR_SERDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_NFFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_TRI_REGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PARDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_SETDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_PREDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_ORCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_FES_ALMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_TAMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_CTEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_PRPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_LOTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_INSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_ACRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_RAADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_PSCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_COBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_RECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_RCRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_CTADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CMP_DP_M_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_RBXDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PBXDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure DspCommonUpdateError(Sender: TObject;
      DataSet: TCustomClientDataSet; E: EUpdateError; UpdateKind: TUpdateKind;
      var Response: TResolverResponse);
    function BUS_DP_M_RAADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFI_RAADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_MALDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CSU_DP_M_PSCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_PAGBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function BUS_DP_M_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_PBXBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function PCP_DP_C_FTEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_ORSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_ROMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_OPRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_PESBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function FIN_DP_R_PAG_ABEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PCRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_REPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_PBXUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function PCP_DP_R_PSCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_IQM_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_RAADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_CXADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PAG_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PBX_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_LME_DOCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_CNEUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure dspCustomerGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function CMP_DP_M_COTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PAG_ABE_PPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CTCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_TDFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_MEQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_VVEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_NCFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_VEIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_MDEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_MVEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_CONDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_PRQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CDPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_RPTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_TPPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_TINDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CINDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_ORIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_MCPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_RVCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CME_MEQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_CMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_NFEUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function PCP_DP_M_LPRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_CACDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_CRPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_CRQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_LBEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_OPBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_AGEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_OCVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_C_TIODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_ORVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FTE_ETQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_LME_DOC_DPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_IQFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_PCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_PRQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_PRPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_LMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_FPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FAT_NFE_CUSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_CORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_TAMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_PRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_CTEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_ACRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_CNEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_CFODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_IQMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_IQF_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_TRI_REGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_IQF_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_FUNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_IQFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_MOVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_CDPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_CDRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_MEQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_CRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_EST_SLD_ANTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_FICDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_IQMUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FAT_DP_M_IQM_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_FUN_CRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_c_obrDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_c_tprDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure ctc_dp_m_orcUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function ctc_dp_m_orcDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_FAMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_FAMBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function ctc_dp_m_facDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_m_avfDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_RECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_c_epiDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure ctc_dp_c_epiBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function ctc_dp_m_cepDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_m_cfeDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_m_locDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_m_ofiDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PAG_BXADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_m_bdeDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_r_bdeDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure ctc_dp_c_tprBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function FAT_DP_R_DEV_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_REC_ABEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_REC_ABE_PPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_REC_BXADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_REC_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_RBXUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FIN_DP_M_RBX_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_REC_ABE_PRRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_MCHDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ULT_NFE_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_CSU_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_XMLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PAR_CPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_NFE_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FEA_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FOR_SLD_TITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_ORCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PAG_DIADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_REC_DIADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_01DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PAR_CTRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PAR_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_02DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_03DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_04DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_05DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ICM_CSTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ICM_CFODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ICM_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PIS_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PIS_CIPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_RET_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_RET_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ECF_FPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function DP_BR_PREVENDADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function DP_BR_SEQ_IDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_POS_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_PEDUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FAT_DP_R_RET_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_RET_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_RET_VNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure EST_DP_M_MALUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_MAL_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PED_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_SLADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_VNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_RECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_MOPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_MPLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_BR_PREVENDADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_TIT_GRPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_ECF_FPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PED_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_CRP_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_INVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_CRP_ITE_BXIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ABC_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ABC_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ABC_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_COB_COBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_COB_ACODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CTE_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_CLI_ABEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_CLI_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_FOR_ABEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_FOR_PAGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_CXAUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure BUS_DP_M_PAGBeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function BUS_DP_M_NFE_DEV_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_DEV_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_EXT_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_TER_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_NFE_TMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_NFE_CFODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure DSServerModuleCreate(Sender: TObject);
    procedure DSServerModuleDestroy(Sender: TObject);
    function FAT_DP_R_GAM_150DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E20DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E25DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_100DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_105DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PED_NIPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_120DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_H30DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_H20DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_H50DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_H60DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CXA_RES_CARDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CXA_DET_CNFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CXA_DET_CRBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CXA_CARDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_PESDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_TMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_MCHDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_C20DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_300DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_600DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_610DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_200DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_MCHUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FAT_DP_M_ROMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_MCH_CHE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_REC_HCH_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CON_CTA_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CON_GER_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_CONUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_R_OCVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OCVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CTADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_ORVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ROM_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ROM_REGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_RQVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_FUN_MECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure OFI_DP_M_ORVUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FAT_DP_R_GAM_190DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_405DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_500DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_510DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_590DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_D_100DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_D_500DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_D_510DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_D_590DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_A_100DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_A_170DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_481DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_485DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORV_PRO_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_420DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_425DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_490DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_501DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_505DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORV_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORV_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_460DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_470DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_MCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORV_TIT_SER_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CXA_DET_CRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_RVEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_OPR_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_FIVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POS_001DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POS_002DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_COM_001DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_COM_002DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_ABC_001DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_ABC_002DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_POS_STADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function bus_dp_m_ctc_tprDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_POS_OSPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PNODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PNMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_c_eocDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_ABC_VLRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_ABC_QTDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_ORCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_COMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_GIRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CUEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_CLEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_MLTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_ORC_ITE_MEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PAR_CPG_INFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_CTE_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_CHQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CCRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_NFE_TIT_MAQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_INDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_MOV_SPRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_0190DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_0400DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_0405DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_CBXDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_CBXUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_CBX_TITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_BCO_EXBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_BCO_CCBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_BCO_SBCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure EST_DP_M_CTEUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_CTE_RES_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PIS_NFLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_600DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_610DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_615DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_605DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_620DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_G_625DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function DP_BR_CUPOM_MESTREDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_COBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_COB_TIT_TITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_CTA_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_CTAUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_C_PCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_M_METDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure EST_DP_M_METUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_MET_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PIS_RPCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure PCP_DP_M_ORSUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_ORS_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORS_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_RCRUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function PCP_DP_R_ORSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_PCADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PCADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E60DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E65DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E80DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E85DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_XMLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FAT_PCA_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FES_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORC_PLCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CSCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_CLI_NCRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_IDNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_PRODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_FILDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_EST_DEPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_EST_FOPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_VNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_M_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_FUN_CRG_GERDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_M_PRODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_M_APGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_M_SLMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_SLMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CSU_ITE_PRFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_ITE_PRC_FINDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_DEZDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_700DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_MCH_TOTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_710DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_BCO_SLDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_ROMUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FIN_DP_R_CXA_DIA_NPDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CXA_DIA_NFTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_COV_RECDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_COV_FATDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PFTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PREDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PDEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_XRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_XPGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_XCBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_RECUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_OPR_OPP_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_PES_GERDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_PES_ALMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_PEQ_TVPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_PEQ_CMDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_PEQ_DPVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_PEQ_DPFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_DRE_RVNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_DRE_DVNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_DRE_DPODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_DRE_CMDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_DRE_RNODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_BR_PREVENDA_DETALHEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_BR_CUPOM_DETALHEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_C_FPIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_ETQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PED_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_PED_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure EST_DP_M_MALGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FAT_DP_M_PEDGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function FIN_DP_R_EXT_CLI_ESTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_OPP_SOPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_REC_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure PCP_DP_M_OPRGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure PCP_DP_M_OPRUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_CSU_GER_PFFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_PRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_ITE_PRC_MNLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PAIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_OPR_REQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_LOT_ESTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_PES_GER_PNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_PES_ALM_PNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ITE_EST_MINDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_ETQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CLI_EXT_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PFT_EMPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_RFODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_RVEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_M_EPPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure PCP_DP_M_EPPUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_EPP_ITE_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_PEXDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_PGFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_06DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_REQ_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_EQPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_PARUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_PARGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_CLIUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_CLIGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_FORUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_FORGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FIN_DP_M_CTAGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FIN_DP_M_RECGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FIN_DP_M_RBXGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FAT_DP_M_NFEGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure PCP_DP_M_ORSGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure PCP_DP_M_ROMUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure PCP_DP_M_ROMGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_FPGUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_FPGGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_CTCUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_CTCGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FIN_DP_M_PAGUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure FIN_DP_M_PAGGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function BUS_DP_M_SLD_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_HFGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_07DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_PRDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_BRDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_MARDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIS_DP_R_LREDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIS_DP_R_LRSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIS_DP_R_LAIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_MPADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_SRHDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_PFCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_VCMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_VVMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_EST_MCVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_RBX_TITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_BRD_TIT_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_BRDUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure FIN_DP_M_BRDGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function OFI_DP_C_CATDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_ANVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_ABC_003DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_CATDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_FIV_VEIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_FIV_OCVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_FIV_ORVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_FIV_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_ISMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ctc_dp_c_ocoDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POS_003DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_CULDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_CULDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_PRODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function ACE_DP_R_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_CTE_ITE_NCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_COJDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_CMP_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_08DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_MKTGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure FAT_DP_M_MKTUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FAT_DP_M_MKTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_SEQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_MTVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_GRPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CSU_MTV_HSTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_HIVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POC_001DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POC_002DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CSU_MTV_VNDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CSU_MTVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ROM_PED_ICFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORS_ICO_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_EST_SRHDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_EST_MPADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_EST_VNPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_ORV_MARDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_ORV_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PAG_CXADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GER_ORVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_LMFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_PRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_LMFUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure FIN_DP_M_PRCUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FIN_DP_R_LMF_MOVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_LMF_EXTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PRCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_ROTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_NOT_ROTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_VITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_VISDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_ROMGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function BUS_DP_C_VIT_CONDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_FOR_NCRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_EXT_FOR_ESTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_OFV_POS_ESTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_M_PMEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_RVDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_DCTUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FIN_DP_M_DCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_OCQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_OCQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_AUSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PAG_SLDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_R_VITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_DCT_TITDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_PES_MODDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_DCTGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function FIN_DP_R_EXT_CLI_RPCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_COMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure OFI_DP_M_OCVGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure OFI_DP_M_OCVUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function FIN_DP_R_CXA_DIA_MTFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_INV_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function EST_DP_R_MALDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PCP_FORDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PCP_PCTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_PCP_OBRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ORVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_R_CSC_EMPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_VISDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ANVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_NFE_DPIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CSU_DP_M_AUDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_QTD_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PRODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_COV_FAT_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_AXCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_AXPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_AXVDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_AXDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_COV_FAT_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FIN_DP_M_CXAGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    function BUS_DP_M_OPR_QTD_TOT_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_QTD_ITE_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_EST_ALM_PENDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_LOCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_EMLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_OBR_CRGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_OBR_EQPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_EPPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_OBR_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CTC_DP_R_OBRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FIN_DP_M_LDMDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_M_ETGDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PED_ITE_NFEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_ITEUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    procedure CAD_DP_C_GRUUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_PCA_PED_ITEDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_POSDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_R_FIV_MEQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_VIS_RES_VENDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_VIS_RES_VEN_CLIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_VIS_RES_VEN_CLI_PRODataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_VIS_RES_VEN_CLI_EXTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function OFI_DP_M_CVLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_ITE_LOC_2DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PVE_TOL_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GRV_FVNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_CSU_GRV_NCLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_SIN_050DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_SIN_054DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_SIN_60MDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_SIN_60ADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_SIN_075DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_PED_TIT_SER_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_PCCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_C_CLI_VEIDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_FEA_SLDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_D_190DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function CAD_DP_C_NTRDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E_A_305DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E_B_305DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_GAM_E_C_305DataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_FUNUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_OPR_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function FAT_DP_R_PCADataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_EPP_GRUDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_POPDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure CAD_DP_C_FUNGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_ITEGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_AUSGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure CAD_DP_C_AUSUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_PED_GERDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure PCP_DP_C_REGGetDataSetProperties(Sender: TObject;
      DataSet: TDataSet; out Properties: OleVariant);
    procedure PCP_DP_C_REGUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_ROM_ICFDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_R_ROM_VLCDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure FAT_DP_M_PCABeforeUpdateRecord(Sender: TObject;
      SourceDS: TDataSet; DeltaDS: TCustomClientDataSet;
      UpdateKind: TUpdateKind; var Applied: Boolean);
    function BUS_DP_M_ILC_RBX_PEDDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPB_OBLDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_GER_OPBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_OPR_ITE_SCBDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    procedure PCP_DP_M_OPBUpdateData(Sender: TObject;
      DataSet: TCustomClientDataSet);
    function BUS_DP_M_OPB_OBL_INTDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_EPP_FUNDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function PCP_DP_R_EPP_FUN_DETDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;
    function BUS_DP_M_ETQDataRequest(Sender: TObject;
      Input: OleVariant): OleVariant;


  private
    { Private declarations }
   Transacao: TDBXTransaction;

   procedure dspUpdateData(Sender: TObject; DataSet: TCustomClientDataSet);
   procedure GerFinEntrada(Sender: TObject; DataSet: TCustomClientDataSet;IdAbertura:integer;NumeroNfe:String;
             DtaEmissaoNF: TDateTime;NFInutilizada:boolean; sm: TSM );
   procedure GerFinSaida(Sender: TObject; DataSet: TCustomClientDataSet; IdAbertura: integer; NumeroNfe,
                         SerieNF:String; DtaEmissaoNF: TDateTime);
   procedure AtualizarIQM(Sender: TObject; DataSet: TCustomClientDataSet);

   procedure AlterarDeletarTitOrv(Sender: TObject; DataSet: TCustomClientDataSet);
  public
    { Public declarations }
    var
      Connections : TDictionary<NativeInt,TSQLConnection>;
      xDiretorioImagem:String;
    procedure AbreBanco;
    procedure GerarSqlTxt(dataset: TSQLDataSet);
    procedure GerarTxt(path_arquivo,texto: String);
    function EchoString(Value: string): string;
    function ReverseString(Value: string): string;
    function enValorChave(NomeSeq: String): Integer;
    function enChaveNItens(NomeSeq: String;QtdeItens: integer): Integer;
    function enCorrigirEstoque(id_empresa,tipo_item:String): Boolean;
    function enZerarContagem(id_empresa,tipo_item:String; usa_sgq,zera_lote:Boolean): Boolean;
    function enDataServer: TDateTime;
    function enHoraServer: TDateTime;
    function UltimoDiaDoMes(Data:TDateTime): string;
    function enExisteItePrcFilial: Boolean;
    function enVerifVersao: String;
    function enVerifPedDupOrs(id_empresa,id_ors, id_pedido: String): Boolean;
    function enVerifNfeDupRom(id_empresa,id_romaneio, id_fiscal: String): Boolean;
    function enVerifCteIteDup(id_empresa,id_controle,id_item,id_cor,id_tamanho: string): String;
    function enVerifNfePendente(id_empresa,id_funcionario: string): String;

    function  enExiTitulosBaixado(Empresa:string; ID:string; Rotina:String):boolean;
    Function  enExiDebCliente(DiasProtesto,id_cliente:integer):boolean;
    function  enBuscaMenu(Perfil:Integer; Formulario:String; Acao:integer):boolean;
    function  enVerCreditoForn(Fornecedor:string):Currency;
    function  enVerCreditoCli(Cliente: string;tipo_saldo:integer=0): Currency;
    function  enVerSaldoDiaCxa(IdEmpresa,IdConta,IdAbertura: integer): Currency;
    function  enGerPeqDesp(IdFornecedor,IdAbertura, IdLocalTit,IdFormaPag,IdCcusto,IdTipoFinanceiro,IdEmpresa: Integer; IdPlano, Historico: String;
                           DtaEmissao,DtaVencto,DtaOrig: TDateTime; VlrLancto: Currency): String;
    function  enDesfPeqDesp(IdTituloPag: string): String;
    function  enNroDeCompras(Modulo,IdEmpresa, IdCliente: String): Currency;
    function  enBusTotPagMed(IdEmpresa, PctTipMov: String): Currency;
    function  enBusTotVendMed(Ano,MesAtual,IdEmpresa: String): Currency;
    function  enAtuPrcIte(IdFiscal,IdSeqItem, IdItem: String;
                          fp_vlr_tot_custo_fix_mens,fp_vlr_ven_med_mens,
                          fp_per_cust_ven_mens, fp_per_icms_ven,
                          fp_per_simples, fp_per_comissao, fp_per_frete_ven,
                          fp_per_cust_fin_ven, fp_per_lucro_ven, fp_per_total_incid,
                          fp_per_markup_div, fp_per_markup_mult, fp_per_prc_prz_ven_prat, PrcIteCalc,
                          PrcItePrat,PrcPrazoItePrat: Currency): String;

    procedure enDesfazerFat(IdFiscal: integer;BUS_CD_M_NFE:TClientDataSet;
                             var FIN_CD_M_CTA, FIN_CD_M_REC, FIN_CD_M_REC_PAG, FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,
                                 FAT_CD_M_PED,OFI_CD_M_ORV,EST_CD_M_FES: TClientDataSet;
                                 ReabrePed:String;IdAbertura:String='');



    procedure enGerFinCxaBco(Sender: TObject; origem: integer; DataSet: TCustomClientDataSet; cdsTit: TDataSet;
                              FIN_CD_M_CTA: TClientDataSet; IdAbertura: integer );
    procedure enGerFinRecPag(Sender: TObject; origem: integer; DataSet: TCustomClientDataSet; var cdsTit: TDataSet;
                             var FIN_CD_M_REC_PAG: TClientDataSet; IdAbertura: integer; NumeroNfe: String );
    procedure enGerFinRcr(Sender: TObject; origem: integer; DataSet: TCustomClientDataSet; var cdsTit: TDataSet;
                             var FIN_CD_M_RCR,FIN_CD_M_CTA_RCR: TClientDataSet; IdAbertura: Integer );

    procedure enGerFinPcr(Sender: TObject; origem: integer;DataSet: TCustomClientDataSet;var FIN_CD_M_PCR: TClientDataSet);
    function  enBusNovoSldlimCli(IdEmpresa,IdCliente,IdFormaPag: String; VlrLimiteCli:Currency ): Currency;
    function  enVerSldLimAtu(origem: integer; DataSet: TCustomClientDataSet; cdsTitulos: TDataSet; id_forma_pag_rbx: integer):Currency;
    procedure enVerSldLimFpgAtu(origem: integer; DataSet: TCustomClientDataSet;cdsTitulos:TDataSet;cdsFormaPag: TClientDataSet; id_forma_pag_rbx: integer);


    function  enFormarObsFiscoNfe(DataSet: TCustomClientDataSet; NfeObsAnt,NfeObsAtu:String): String;
    function  enAtuDadosNF(id_fiscal, id_abertura,tipo_doc: String): String;
    function  enProxNroMDFe(id_empresa: String):integer;

    function  enGerarPreVenda(id_fiscal,id_abertura,serial_pv, ecf_serial, ecf_marca,ecf_modelo, ecf_caixa: String): String;
    function  enDesfazerPreVenda(id_fiscal: String): String;
    function  enExcluirPreVenda(num_prevenda: String): String;
    function  enFinalizarCupomCxa(id_fiscal,NroCupom:integer; CupomCancelado: Boolean; ecf_prevenda, ecf_serial_impressora: String;
                                  DtaCaixa: TDateTime;ReabrePed:String): String;
    procedure enGerCupomGerConWin(id_abertura: integer);
    function  enBusFpgEcf(ecf_serial_impressora: String): TDataSet;

    function  enCancelCupom(id_fiscal: integer; DataSet: TCustomClientDataSet; var CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_C_PAR_CTR,FAT_CD_M_NFE: TClientDataSet): String;
    function  enCancelNfe(id_fiscal: integer; CanStatus,CanProtocolo,ReabrePed,IdAbertura:String): String;
    function  enReabrePed(id_fiscal: integer; ReabrePed: String): String;
    function  enAproReprPed(IdEmpresa,IdPedidos,TipoAcao, IdFuncionario, msgJustificativa: String): String;
    function  enGerarNfe(id_fiscal: integer;id_emitente:integer): String;
    function  enFecharCaixa(aud_cod_empresa,aud_cod_funcionario,aud_programa:String;IdAbertura,Status: integer; ExisteCar: Boolean; IdTitulos: String; DataSetCar: TDataSet): String;
    function  enBxaTitRetBco(DataSet_Tit: TDataSet;id_empresa:Integer;IdTitulos,IdPlano: String; IdConta, IdResponsavel, IdFormaPag, IdCCusto,IdTipoFinanceiro: integer): String;
    function  enCancBxaTitRetBco(DataSet_Tit: TDataSet; IdTitulos:String): String;
    function  enAtualMaqNfsTit(IdEmpresa,IdFiscal: Integer; Data: OleVariant): String;
    function  enAtualPedF11(id_empresa,id_pedido: integer): Boolean;
    function  enVerSldCxaEmAberto(id_empresa,id_funcionario: String): String;
    function  enValorMedioGrp(codVendedor,ano,codGrupoPrd: integer): Currency;
    function  enBuscarEstatVendProdutor(tipo, vendedor, Ano, ParIni, ParFim: String; var QtdeVisitas, QtdePedidos,
              TotalDescPed, TotalPed, QtdeCliVisProg, QtdeCliExtVis: Currency; var CliVisitados, CliVisitadosExt, Pedidos: String): OleVariant;
    function  enGetImagem(tabela: String;nome:String): TStream;

    function  enVerifTeleMarkCli(IdMkt,IdCliente: String):String;

    function  AllApplyUpdates(Delta: OleVariant ): boolean;
    function  enMD5(const texto: string): string;
    function  enMD5File(const fileName: string): string;
    function  BuscarConnBanco: TSQLConnection;

    // Auditoria
    procedure enAudInserirCampoPacote(Properties: OleVariant);
    procedure enAudGravar(Sender: TObject; DataSet: TCustomClientDataSet);
    procedure enAudRegistrarInfo(DataSet: TDataSet;id_empresa,id_funcionario,programa:String);

    // Espcifico do mdulo SGQ
    function  enSgqVefPedRom(id_pedido: String): integer;
    function  enSgqPcpImportarPed(tbItensSel: TDataSet; IdEmpresa, IdOpr,IdResp,AlmSel,PedSel,ItensSel,CorSel,TamSel: String; PreparaGeracaoBloco: integer): OleVariant;
    procedure enSgqPcpGerarReq(IdEmpresa,IdOpr,IdResp: Integer; IdAlmoxarifado: String; PCP_CD_M_OPR_REQ, cdsItensOpr: TClientDataSet; PCP_CD_M_OPR_REQ_ITE: TDataSet);
    procedure enSgqPcpGerarOps(IdEmpresa,IdOpr,IdTpp: Integer; PCP_CD_M_OPR_OPS, cdsItensOpr,BUS_CD_M_OPR_OPP_INT: TClientDataSet);
    procedure enSgqPcpGerarEtq(IdEmpresa,IdOpr: Integer; PCP_CD_M_ETQ, cdsItensOpr: TClientDataSet);
    function  enSgqPcpGerarOppEtq(IdEmpresa,IdOpr: Integer; ItensOpp: OleVariant): String;
    function  enSgqEstatisticaAcr(tipo: integer;Input: OleVariant): OleVariant;
    function  enSgqPcpVerifEtqRomPed(IdEmpresa,IdPedido,CodBarra: String): string;
    function  enSgqPcpBusSaldoPendente(IdEmpresa,IdItem,IdCor,IdTamanho: String): currency;

    function  enSgqPcpBuscarDescRegIte(IdCliente,IdItem: String): currency;

    procedure enSgqFinBucarDadosOFs(DataIni,DataFim,IdCliente: String; var cdsOFs,cdsOFsPrestCta,cdsOFsPrestCtaAberto,cdsTitPrestAberto: OleVariant);
    procedure enSgqFinBucarDadosFin(DataIni,DataFim,IdCliente: String; var cdsTitPrestAberto,cdsTitAberto,cdsChqDev,cdsTitPag,cdsChqDepositar: OleVariant);
    procedure enSgqFinBucarDadosCliILC(IdEmpresa,IdCliente: String; var txtPriCompra, txtUltCompra, txtMenorCompra, txtMaiorCompra, QtdePedidos,
                                    QtdePedidoCancelados,QtdePedidoReprovados, TotalEmCompras,TotalComprasPago,
                                    PedidosDigitados, PedidosEmProducao: String; var cdsOFsPrestCtaAberto,cdsTitPrestAberto,cdsTitAberto, cdsPedQuitados: OleVariant);


    procedure enSgqFinBuscarOprOppComSaida(op_inicial: String; var cdsOpsOpp: OleVariant);
    function  enSgqFatBuscarDescEspPedidos(IdEmpresa,pedidos: string): Currency;
    function  enSgqFatJuntarItensDosPedidos(IdEmpresa,pedidos: string): OleVariant;

    function  enSgqExistePistolagem_PcpRomPedIte(IdPedido,id_ped_ite: String): Boolean;

  end;

implementation

{$R *.dfm}

uses System.StrUtils, enSC, uServer, enFuncoes,

//uses do Framework
generics.collections,Variants,uExceptions, uTDataSetHelper ,uResourceString, dialogs,
  FIN_RN_M_PBX, CTC_RN_M_ORC, enConstantes, FIN_RN_M_RBX, FAT_RN_M_POS,
  FIN_RN_M_MCH, FIN_RN_M_PAG, FAT_RN_M_EST, CAD_RN_C_CAD, FIN_RN_M_CTA_CON,
  OFI_RN_M_ORV, OFI_RN_M_OCV, EST_RN_M_CTE, PCP_RN_M_ROM, enConstantesServer,
  FAT_RN_M_ROM, FIN_RN_M_BRD, FAT_RN_M_MKT, FIN_RN_M_DCT, uDmApoio,
  FAT_RN_M_PED;






procedure TSM.dspCustomerGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet;
  // algo mais a ser colocado no mesmo DataPacket
  out Properties: OleVariant);
begin
  // criando um array de informaes adicionais
  // a serem incluidas no mesmo packet
  // antes de enviar ao client


{  Properties := VarArrayCreate([0,4], varVariant);
  Properties[0] := VarArrayOf(['USUARIO','Guinther',True]);
  Properties[1] := VarArrayOf(['MICRO','default',True]);
  Properties[2] := VarArrayOf(['TABELA',
    IProviderSupportNG(DataSet).PSGetTableName,True]);
  Properties[3] := VarArrayOf(['DATA',Date,True]);
  Properties[4] := VarArrayOf(['HORA',Time,True]);}

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;


procedure TSM.dspUpdateData(Sender: TObject; DataSet: TCustomClientDataSet);
const
  DirLog = 'Logs\';
begin
  if not(DirectoryExists(DirLog)) then
    CreateDir(DirLog);
  with DataSet do
  begin
    SetOptionalParam('DATA',Date,True);
    SetOptionalParam('HORA',Time,True);
    SaveToFile(Format(
      DirLog + '%s,%s,%s,%s,%s,log.xml',[
      GetOptionalParam('USUARIO'),
      GetOptionalParam('MICRO'),
      GetOptionalParam('TABELA'),
      FormatDateTime('ddmmyyyy',Date),
      FormatDateTime('hhnnss',Time)]));
  end;
end;




procedure TSM.DSServerModuleCreate(Sender: TObject);
begin
 AbreBanco;
end;

procedure TSM.DSServerModuleDestroy(Sender: TObject);
begin
   FreeAndNil(Connections);
end;

function TSM.CAD_DP_R_CFODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelCfo: String;
  begin
    Result :=
      ' SELECT CFO.* , NAT.DESCRICAO AS INT_NOMENAT '+
      ' FROM CAD_TB_C_CFO CFO '+
      '   LEFT OUTER JOIN CAD_TB_C_NAT NAT ON NAT.ID_CLASSE=CFO.ID_CLASSE ';
  end;
begin

   CAD_SQ_C_CFO.Close;
   if Input[0] = 0 then
      begin
         if Input[1] <> '' then
            begin
               CAD_SQ_C_CFO.CommandText := enSqlRelCfo +
                   ' WHERE CFO.ID_CLASSE in (' + VarToStr(Input[1]) +') ' +
                   ' Order By CFO.ID_CFO ';
            end
         else
            begin
               CAD_SQ_C_CFO.CommandText := enSqlRelCfo +
                   ' Order By CFO.ID_CFO ';
            end;
      end;

   if Input[0] = 1 then
      begin
        if Input[1] <> '' then
           begin
              CAD_SQ_C_CFO.CommandText := enSqlRelCfo +
                  ' WHERE CFO.ID_CLASSE in (' + VarToStr(Input[1]) +') ' +
                  ' Order By cfo.id_classe, CFO.ID_CFO ';
           end
         else
            begin
               CAD_SQ_C_CFO.CommandText := enSqlRelCfo +
                  ' Order By cfo.id_classe, CFO.ID_CFO ';
            end;
     end;
   Result := CAD_DP_C_CFO.Data;
end;

function TSM.CAD_DP_R_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadCli: String;
  begin
    Result :=
            ' select cli.*, '+#13#10+
            ' TRIM(UPPER(regexp_replace(regexp_replace(CLI.BAIRRO,'' +'','' ''),''\t'','''') )) AS INT_BAIRRO, '+ #13#10 +
            ' pec.descricao as int_descperfil, cid.uf as int_uf, ' + #13#10 +
            ' case  cli.situacao' + #13#10 +
            '   when 0  then  ''Normal''' + #13#10 +
            '   when 1  then  ''Especial''' + #13#10 +
            '   when 2  then  ''CrditoEncerrado''' + #13#10 +
            ' end as int_situacao,' + #13#10 +
            ' (current_date-cli.dta_inicio_desnv) as dias_desnv, ' + #13#10 +
            ' cid.nome as int_nomecid, rot.descricao as int_nomerota,' + #13#10 +
            ' fun.nome as int_nomevnd ' + #13#10 +
            ' from cad_tb_c_cli cli' + #13#10 +
            '  left outer join pcp_tb_c_rot rot on' + #13#10 +
            '       (rot.id_rota = cli.id_rota)' + #13#10 +
            '  left outer join cad_tb_c_cid cid on' + #13#10 +
            '       (cid.id_cidade = cli.id_cidade)' + #13#10+
            '  left outer join cad_tb_c_fun fun on ' +#13#10+
            '       (fun.id_funcionario = cli.id_vendedor) ' +#13#10+
            ' left outer join cad_tb_c_pec pec on '+#13#10+
            '       (pec.id_perfil_cli = cli.id_perfil_cli) ';


  end;
var
   ColunaOrder: String;
begin

   {
    input[0] - 0 - Listagem Geral
               1 - Listagem por Situao
               2 - Listagem por Rota
               3 - Listagem por Vendedor
    input[1] - ativo:          Todos
                               Ativo
                               Inativo
    input[2] - Perfil de cliente
    input[3] - Tipo de cliente
    input[4] - Situao
    input[5] - Cidade
    input[6] - Classifica por: Nome do cliente
                               Apelido do cliente
                               Cidade


   }

   CAD_SQ_R_CLI.Close;
   CAD_SQ_R_CLI.CommandText := enSqlRelCadCli + ' WHERE 1 = 1 ';

   if Input[1] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText +
               ' and cli.ativo = ''' + VarToStr(Input[1]) +''' ';
      end;

   if input[2] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.id_perfil_cli in (' + VarToStr(Input[2]) +') ';
      end;

   if input[3] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.tipo_cliente in (' + VarToStr(Input[3]) +') ';
      end;

   if input[4] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText +
               ' and cli.situacao in (' + VarToStr(Input[4]) +') ';
      end;

   if input[5] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.id_cidade in (' + VarToStr(Input[5]) +') ';
      end;


   if input[7] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.id_cliente in (' + VarToStr(Input[7]) +') ';
      end;

    if input[8] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.id_vendedor in (' + VarToStr(Input[8]) +') ';
      end;

    if (input[9] <> '') AND (input[10] <> '') then
      begin
         CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cli.dta_cadastro >=''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])) ) +''' '+
               ' and cli.dta_cadastro <=''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[10])) ) +''' ';
      end;

   if input[11] <> '' then
      begin
        CAD_SQ_R_CLI.CommandText := CAD_SQ_R_CLI.CommandText +
               ' and cid.uf in (' + VarToStr(Input[11]) +') ';
      end;

   if input[6] = '0' then
      ColunaOrder := 'cli.id_cliente';
   if input[6] = '1' then
      ColunaOrder := 'cli.nome';
   if input[6] = '2' then
      ColunaOrder := 'cli.apelido';
   if input[6] = '3' then
      ColunaOrder := 'int_nomecid';

   if input[0] = 0 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by ' + ColunaOrder;
      end;
   if input[0] = 1 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by cli.situacao, ' + ColunaOrder;
      end;
   if input[0] = 2 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by  cli.id_rota,int_nomecid, ' + ColunaOrder;
      end;
   if input[0] = 3 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by  int_nomevnd, ' + ColunaOrder;
      end;
   if input[0] = 4 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by  int_bairro, ' + ColunaOrder;
      end;
   if input[0] = 5 then
      begin
        CAD_SQ_R_CLI.CommandText :=
            CAD_SQ_R_CLI.CommandText + ' order by  int_nomevnd,cli.desenvolvimento, ' + ColunaOrder;
      end;



   Result := CAD_DP_R_CLI.Data;

   CAD_SQ_R_CLI.Close;
end;



function TSM.BUS_DP_M_ILC_RBX_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIlcRbxPed: String;
  begin
    Result :=
      ' select ped.id_pedido, ors.id_ors, ors.dta_emissao, ors.vlr_liquido, ' +
      ' cast (case ' + #13#10 +
      '   when rtrim(sgq_texto_cond_pgto) <>  '''' then sgq_texto_cond_pgto' + #13#10 +
      ' else  cpg.descricao end as varchar(50) )  desc_cpg ' +
      '   from fat_tb_m_ped ped ' +
      ' inner join pcp_tb_m_ors ors on ors.id_pedido  = ped.id_pedido ' +
      ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag  = ped.id_condicao_pag ' +
      ' where ped.situacao = 3 and cpg.tipo_pagamento in (0,1) ' + #13#10;
                 { '  select ped.id_pedido from fin_tb_m_rbx_tit rbt ' +
                  '     inner join fin_tb_m_rec rec on rec.id_titulo = rbt.id_titulo  ' +
                  '     inner join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal  ' +
                  '     left outer join pcp_tb_m_ors ors on ors.id_ors = nfe.id_ors ' +
                  '     left outer join fat_tb_m_ped ped on ped.id_pedido = ors.id_pedido ' +
                  '    ' + #13#10 +
                  ' where ped.situacao = 3' + #13#10 ; };

  end;
begin
   // Criado em 24/08/2020, por Maxsuel Victor
   BUS_SQ_M_ILC_RBX_PED.Close;

   BUS_SQ_M_ILC_RBX_PED.CommandText := enSqlIlcRbxPed +
       '   and ped.id_empresa = ''' + VarToStr(Input[0]) + ''' ' +
       '   and ped.id_cliente = ''' + VarToStr(Input[1]) + ''' ' +
       ' order by ped.id_pedido desc limit 5';

   Result := BUS_DP_M_ILC_RBX_PED.Data;
end;

function TSM.BUS_DP_M_IQF_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_IQF_FOR.Close;

   // input[0] - 0 - Ir trazer qtde total de fornecedore com NF de entrada
   //            1 - Ir trazer cada fornecedor que tem NF de entrada

   if input[0] = 0 then
      begin
         BUS_SQ_M_IQF_FOR.CommandText :=
              ' select count(*) as qtde_fornecedores ' +
                         ' from cad_tb_c_for frn ' +
                         '  where id_fornecedor in ' +
                         '           (select id_emitente from fat_tb_m_iqm iqm ' +
                         '            where  iqm.id_empresa = ''' + VarToStr(Input[1]) + '''  ' +
                         '            group by iqm.id_emitente) ' ;

                        { '                   (select id_emitente from fat_tb_m_nfe nfe  ' +
                         '                          left outer join cad_tb_c_tme tme on ' +
                         '                                (tme.id_tipo_mov_estoque =    ' +
                         '                                  nfe.id_tipo_mov_estoque)    ' +
                         '                    where  nfe.id_empresa = ''' + VarToStr(Input[1]) + ''' and ' +
                         '                           tme.tipo_movimento = 0 and          ' +
                         '                           tme.indicador = 0 and          ' +
                         '                           nfe.tipo_nf = ''E'' and         ' +
                         '                           nfe.status = 1    and          ' +
                         '                           nfe.ind_emitente = 1 and       ' +
                         '                           nfe.nfe_cod_sit = ''00''       ' +
                         '                    group by nfe.id_emitente)             ' ;}
      end
   else if input[0] = 1 then
       begin
         BUS_SQ_M_IQF_FOR.CommandText :=
              ' select frn.* from cad_tb_c_for frn ' +
                         '  where id_fornecedor in ' +
                         '           (select id_emitente from fat_tb_m_iqm iqm ' +
                         '            where  iqm.id_empresa = ''' + VarToStr(Input[1]) + ''' ' +
                         '            group by iqm.id_emitente)';

                      {   '                   (select id_emitente from fat_tb_m_nfe nfe  ' +
                         '                          left outer join cad_tb_c_tme tme on ' +
                         '                                (tme.id_tipo_mov_estoque =    ' +
                         '                                  nfe.id_tipo_mov_estoque)    ' +
                         '                    where  nfe.id_empresa = ''' + VarToStr(Input[1]) + ''' and ' +
                         '                           tme.tipo_movimento = 0 and          ' +
                         '                           tme.indicador = 0 and          ' +
                         '                           nfe.tipo_nf = ''E'' and         ' +
                         '                           nfe.status = 1    and          ' +
                         '                           nfe.ind_emitente = 1 and       ' +
                         '                           nfe.nfe_cod_sit = ''00''       ' +
                         '                    group by nfe.id_emitente)             ' ; }
       end;

   Result := BUS_DP_M_IQF_FOR.Data;

   BUS_SQ_M_IQF_FOR.Close;
end;

function TSM.BUS_DP_M_IQF_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  BUS_SQ_M_IQF_NFE.Close;
  BUS_SQ_M_IQF_NFE.CommandText :=
       ' select frn.id_fornecedor,  ' +
       ' (select count(*)           ' +
       '     from  fat_tb_m_iqm iqm ' +
       '     where                  ' +
       '        iqm.id_emitente = frn.id_fornecedor and       ' +
       '        iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '        extract(year from iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '        extract(month from iqm.dta_recebimento) BETWEEN 01 and 06) as qtde_nfs_semestre1, ' +
       ' ' +
       ' (select count(*) ' +
       '     from fat_tb_m_iqm_ite_ana ana ' +
       '          left outer join fat_tb_m_iqm iqm on   ' +
       '                     (iqm.id_iqm = ' +
       '                      ana.id_iqm) ' +
       '     where iqm.id_emitente = frn.id_fornecedor and       ' +
       '           iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '           extract(year from  iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '           extract(month from iqm.dta_recebimento) BETWEEN 01 and 06) as qtde_planoacao_semestre1, ' +
       ' ' +
       ' ' +
       ' (select count(*) ' +
       '     from fat_tb_m_iqm_ite_ana ana ' +
       '          left outer join fat_tb_m_iqm iqm on   ' +
       '                     (iqm.id_iqm = ' +
       '                      ana.id_iqm) ' +
       '     where iqm.id_emitente = frn.id_fornecedor and       ' +
       '           iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '           extract(year from  iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '           extract(month from iqm.dta_recebimento) BETWEEN 07 and 12) as qtde_planoacao_semestre2, ' +
       ' ' +
       ' (select count(*)           ' +
       '     from  fat_tb_m_iqm iqm ' +
       '     where                  ' +
       '        iqm.id_emitente = frn.id_fornecedor and       ' +
       '        iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '        extract(year from iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '        extract(month from iqm.dta_recebimento) BETWEEN 07 and 12) as qtde_nfs_semestre2, ' +
       ' ' +
       '(select count(*) from fat_tb_m_iqm_ite qmi    ' +
       '      left outer join fat_tb_m_iqm iqm on     ' +
       '          (iqm.id_iqm = qmi.id_iqm)           ' +
       ' where                                        ' +
       '      iqm.id_emitente = frn.id_fornecedor and       ' +
       '      iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '      qmi.demerito > 0 and ' +
       '      extract(year from iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '      extract(month from iqm.dta_recebimento) BETWEEN 01 and 06) as qtde_nfs_demerito_sem1, ' +
       '  ' +
       '(select count(*) from fat_tb_m_iqm_ite qmi    ' +
       '      left outer join fat_tb_m_iqm iqm on     ' +
       '          (iqm.id_iqm = qmi.id_iqm)           ' +
       ' where                                        ' +
       '      iqm.id_emitente = frn.id_fornecedor and       ' +
       '      iqm.id_empresa = ''' + VarToStr(Input[0]) + ''' and ' +
       '      qmi.demerito > 0 and ' +
       '      extract(year from iqm.dta_recebimento) = ''' + VarToStr(Input[1]) + ''' and ' +
       '      extract(month from iqm.dta_recebimento) BETWEEN 01 and 06) as qtde_nfs_demerito_sem2 ' +
       ' from cad_tb_c_for frn ' +
       ' where frn.id_fornecedor in (' + VarToStr(Input[2]) +') ' +
       ' group by frn.id_fornecedor ' +
       ' order by frn.descricao ';

  result :=  BUS_DP_M_IQF_NFE.Data;
  BUS_SQ_M_IQF_NFE.Close;
end;

function TSM.BUS_DP_M_ITE_EST_MINDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlIteEstMin: String;
begin
  { TODO -oMaxsuel -cCriao : Criado em 21/07/2016 }



   BUS_SQ_M_ITE_EST_MIN.Close;

   if Input[0] = 0 then
      begin
         enSqlIteEstMin :=
                  //'-- Para mdulo SGQ'
                  ' select fes.id_empresa, par.emp_fantasia, ite.id_item, ite.descricao, ite.est_minimo, fes.saldo_fisico,' + #13#10 +
                  '     cast(  fes.saldo_fisico -( coalesce(tpe.qtde_ped_pendente,0) + coalesce(tre.qtde_req_pendente,0)) as numeric(18,4) ) as sld_disponivel   from cad_tb_c_ite ite' + #13#10 +
                  '    left outer join est_tb_m_fes fes on (fes.id_item = ite.id_item)' + #13#10 +
                  '    left outer join cad_tb_c_par par on (par.id_empresa = fes.id_empresa)' + #13#10 +
                  '    left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)' + #13#10 +
                  '    left outer join' + #13#10 +
                  '        (select ped.id_empresa, ipe.id_item, ipe.id_cor, ipe.id_tamanho, coalesce(sum(qtde),0) as qtde_ped_pendente from fat_tb_m_ped_ite ipe' + #13#10 +
                  '            left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido)' + #13#10 +
                  '         where ' + #13#10 +
                  '           ped.situacao in (2) ' + #13#10 +
                  // '           and ped.situacao_aprovacao = 1 ' + #13#10 +
                  '           and ped.situacao_aprovacao <> 2 ' + #13#10 +        // Foi alterado para "<> 2" a pedido da Globo, pois o pedido DIGITADO tambm deve mexer no saldo disponvel quando tiver em produo
                  '         group by 1,2,3,4) tpe on (tpe.id_empresa = fes.id_empresa and' + #13#10 +
                  '                                   tpe.id_item    = fes.id_item    and                                      ' + #13#10 +
                  '                                   tpe.id_cor     = fes.id_cor     and' + #13#10 +
                  '                                   tpe.id_tamanho = fes.id_tamanho)' + #13#10 +
                  '   left outer join' + #13#10 +
                  '        (select opr.id_empresa, irq.id_item, irq.id_cor, irq.id_tamanho, ' + #13#10 +
                  '                coalesce(sum(irq.qtde),0) - coalesce(sum(irq.qtde_atendida),0) as qtde_req_pendente' + #13#10 +
                  '         from pcp_tb_m_opr_req_ite irq' + #13#10 +
                  '            left outer join pcp_tb_m_opr_req req on (req.id_opr     = irq.id_opr and ' + #13#10 +
                  '                                                     req.id_opr_req = irq.id_opr_req)' + #13#10 +
                  '            left outer join pcp_tb_m_opr opr on (opr.id_opr  = req.id_opr)' + #13#10 +
                  '         where irq.cancelado <> true and  ' + #13#10 +
                  '            opr.situacao in (0,1)           ' + #13#10 +
                  '         group by 1,2,3,4) tre on (tre.id_empresa = fes.id_empresa and' + #13#10 +
                  '                                   tre.id_item    = fes.id_item    and                                      ' + #13#10 +
                  '                                   tre.id_cor     = fes.id_cor     and' + #13#10 +
                  '                                   tre.id_tamanho = fes.id_tamanho)       ' + #13#10 +
                  ' where ite.est_minimo > 0 ' + #13#10 +
                  '    and ite.est_minimo >= fes.saldo_fisico  ' + #13#10 +
                  '   and gru.tipo_item <> ''04''' + #13#10;
      end;

   if Input[0] = 1 then
      begin
         enSqlIteEstMin :=
                  //'-- Sem ser mdulo SGQ'

                  ' select fes.id_empresa, par.emp_fantasia, ite.id_item, ite.descricao, ite.est_minimo, fes.saldo_fisico, cast( 0.00 as numeric(18,4)) as sld_disponivel' + #13#10 +
                  ' from cad_tb_c_ite ite' + #13#10 +
                  '    left outer join est_tb_m_fes fes on (fes.id_item = ite.id_item)' + #13#10 +
                  '    left outer join cad_tb_c_par par on (par.id_empresa = fes.id_empresa)' + #13#10 +
                  '    left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)' + #13#10 +
                  '    ' + #13#10 +
                  ' where ite.est_minimo > 0 ' + #13#10 +
                  '   and ite.est_minimo >= fes.saldo_fisico' + #13#10;
      end;

   BUS_SQ_M_ITE_EST_MIN.CommandText := enSqlIteEstMin +
               '    and fes.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
               '  order by gru.descricao, ite.id_item ';

   Result := BUS_DP_M_ITE_EST_MIN.Data;

   BUS_SQ_M_ITE_EST_MIN.close;
end;

function TSM.BUS_DP_M_LOT_ESTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusLot: String;
begin
  BUS_SQ_M_LOT_EST.Close;

  enSqlBusLot :=

        ' select ' + #13#10 +
        '   cast(  case' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 3 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,1)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 4 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 5 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,3)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 6 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,4)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 7 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,5)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 8 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,6)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 9 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),1,7)' + #13#10 +
        '      else lot.num_lote end as integer) lote,' + #13#10 +
        '   cast( case' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 3 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),2,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 4 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),3,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 5 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),4,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 6 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),5,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 7 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),6,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 8 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),7,2)' + #13#10 +
        '      when length(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar)) = 9 then' + #13#10 +
        '          substr(cast(cast( translate(lot.num_lote,''-'','''') as integer) as varchar),8,2)' + #13#10 +
        '      else lot.num_lote end as integer) ano,' + #13#10 +
        ' lot.id_almoxarifado, lot.num_lote, lot.id_item, lot.id_cor,lot.id_tamanho, (lot.qtde_atual - coalesce(rpe.qtde_pendente,0)) as qtde_disp' + #13#10 +
        ' from est_tb_m_lot lot ' + #13#10 +
        '    left outer join ' + #13#10 +
        '            (select opr.id_almoxarifado, riq.num_lote, sum(coalesce(riq.qtde,0) - coalesce(riq.qtde_atendida,0)) as qtde_pendente from pcp_tb_m_opr_req_ite riq' + #13#10 +
        '                    left outer join pcp_tb_m_opr_req req on (req.id_opr = riq.id_opr and ' + #13#10 +
        '                                                             req.id_opr_req = riq.id_opr_req) ' + #13#10 +
        '                    left outer join pcp_tb_m_opr opr     on (opr.id_opr = req.id_opr)' + #13#10 +
        '             where riq.cancelado <> true ' +
        '             group by opr.id_almoxarifado,riq.num_lote) rpe on (rpe.num_lote = lot.num_lote)' + #13#10 +
        ' where lot.qtde_atual > 0' + #13#10;


  if input[0] = 0  then
     begin
       BUS_SQ_M_LOT_EST.CommandText := enSqlBusLot +
          '   and lot.id_almoxarifado = ''' + VarToStr(Input[1]) + ''' ' +
          '   and lot.id_item  = ''' + VarToStr(Input[2]) + ''' ' +
          '   and lot.id_cor   = ''' + VarToStr(Input[3]) + ''' ' +
          '   and lot.id_tamanho  = ''' + VarToStr(Input[4]) + ''' ';
     end;

  BUS_SQ_M_LOT_EST.CommandText := BUS_SQ_M_LOT_EST.CommandText +
                              ' order by 2,1 ';

  Result := BUS_DP_M_LOT_EST.Data;
  BUS_SQ_M_LOT_EST.close;
end;

function TSM.BUS_DP_M_MAL_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlMalIte: String;
  begin
    Result :=
        ' SELECT MIT.*, GRU.TIPO_ITEM AS INT_TIPO_ITEM FROM EST_TB_M_MAL_ITE MIT' +
        '   LEFT OUTER JOIN CAD_TB_C_ITE  ITE ON ITE.ID_ITEM = MIT.ID_ITEM  ' +
        '   LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO' ;

  end;
begin
   BUS_SQ_M_MAL_ITE_INT.Close;
   BUS_SQ_M_MAL_ITE_INT.CommandText := enSqlMalIte +
     ' WHERE MIT.ID_MAL = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_MAL_ITE_INT.Data;
end;

function TSM.BUS_DP_M_MCH_CHE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinMchInt: String;
  begin
    Result :=
             ' select che.*,                              ' +
             '  hch.situacao_chq as int_sitchq,           ' +
             '  hch.situacao_chq_ant as int_sitchqant     ' +
             '  from fin_tb_m_mch_che che                 ' +
             '    left outer join fin_tb_m_rec_hch hch on ' +
             '      (hch.id_titulo = che.id_titulo and    ' +
             '       hch.id_mch =   che.id_controle) ';
  end;
begin
  BUS_SQ_M_MCH_CHE_INT.Close;
  if input[0] = 0  then
     begin
       BUS_SQ_M_MCH_CHE_INT.CommandText := enSqlFinMchInt +
          ' WHERE CHE.ID_CONTROLE = ''' + VarToStr(Input[1]) + ''' ';
     end;
  if input[0] = 1  then
     begin
       BUS_SQ_M_MCH_CHE_INT.CommandText := enSqlFinMchInt +
          ' WHERE CHE.ID_TITULO in (' + VarToStr(Input[1]) + ') ' +
          '   AND CHE.ID_CONTROLE > ''' + VarToStr(Input[2]) + ''' ';
     end;

  Result := BUS_DP_M_MCH_CHE_INT.Data;
  BUS_SQ_M_MCH_CHE_INT.close;
end;

function TSM.BUS_DP_M_MET_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlMetIte: String;
  begin
    Result :=
        ' SELECT MEI.*, GRU.TIPO_ITEM AS INT_TIPO_ITEM FROM EST_TB_M_MET_ITE MEI' +
        '   LEFT OUTER JOIN CAD_TB_C_ITE  ITE ON ITE.ID_ITEM = MEI.ID_ITEM  ' +
        '   LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO' ;

  end;
begin
   BUS_SQ_M_MET_ITE_INT.Close;
   BUS_SQ_M_MET_ITE_INT.CommandText := enSqlMetIte +
     ' WHERE MEI.ID_MET = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_MET_ITE_INT.Data;

end;

function TSM.BUS_DP_M_NFE_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlNfeIteInt: String;
  begin
    Result := ' SELECT NFI.*, GRU.TIPO_ITEM AS INT_TIPO_ITEM ' +
              ' FROM FAT_TB_M_NFE_ITE NFI ' +
              '   LEFT OUTER JOIN CAD_TB_C_ITE  ITE ON ITE.ID_ITEM = NFI.ID_ITEM ' +
              '   LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO ' ;

  end;
begin
   BUS_SQ_M_NFE_ITE_INT.Close;

   if input[0] > 0 then
      begin
        BUS_SQ_M_NFE_ITE_INT.CommandText := enSqlNfeIteInt +
           ' WHERE NFI.ID_FISCAL =       ''' + VarToStr(Input[0]) +''' ';
      end;

   if input[0] = 0 then
      begin
        BUS_SQ_M_NFE_ITE_INT.CommandText := enSqlNfeIteInt +
           ' WHERE NFI.ID_FISCAL in (' + VarToStr(Input[1]) +') ' ;
      end;

   Result := BUS_DP_M_NFE_ITE_INT.Data;
end;


function TSM.DP_BR_PREVENDADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPreVend: String;
  begin
    Result := ' SELECT BPR.*,  COALESCE(BCM.CCF,0) AS CCF FROM BR_PREVENDA BPR               ' +
              ' left outer join BR_CUPOM_MESTRE BCM on      ' +
              '    (BCM.N_CUPOM = BPR.N_CUPOM AND ' +
              '     BCM.SERIAL_IMPRESSORA = BPR.SERIAL)     ' ;
  end;
begin

   SQ_BR_PREVENDA.Close;
   SQ_BR_PREVENDA.CommandText := enSqlPreVend;

   if Input[0] = 0 then
      begin
        SQ_BR_PREVENDA.CommandText := enSqlPreVend +
            ' WHERE 1 = 2 ';
      end;

   if Input[0] = 1 then
      begin
        SQ_BR_PREVENDA.CommandText := enSqlPreVend +
            ' WHERE BPR.NUMPREVENDA = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 2 then
      begin
        SQ_BR_PREVENDA.CommandText := enSqlPreVend +
            ' WHERE BPR.NUMPREVENDA = ''' + VarToStr(Input[1]) +''' ' +
            '   AND BPR.NUMLOJA = ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := DP_BR_PREVENDA.Data;
end;

function TSM.DP_BR_SEQ_IDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBrSeqId: String;
  begin
    Result := ' SELECT * FROM BR_SEQ_ID ';
  end;
begin
   SQ_BR_SEQ_ID.Close;
   SQ_BR_SEQ_ID.CommandText := enSqlBrSeqId;

   if Input[0] = 0 then
      begin
        SQ_BR_SEQ_ID.CommandText := enSqlBrSeqId +
           ' WHERE TABELA = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := DP_BR_SEQ_ID.Data;
end;

procedure TSM.DspCommonUpdateError(Sender: TObject;
  DataSet: TCustomClientDataSet; E: EUpdateError; UpdateKind: TUpdateKind;
  var Response: TResolverResponse);
begin

 DataSet.enErro:= uResourceString.PosErro+Inttostr(DataSet.RecNo)+sLineBreak+
                 'Mensagem Original :'+E.OriginalException.ToString;
end;


procedure TSM.AbreBanco;
var
  Rede:TInifile;
  MySession: TDSSession;
  Id: String;
begin
  Rede := TiniFile.Create(ExtractFilePath(Application.ExeName)+'Rede.Ini');



  Conexao.Close;
  conexao.CloseDataSets;
  Conexao.Params.Clear;

  //POstgresql 9
  Conexao.Params.Add('DriverUnit=DbxDevartPostgreSQL');
  Conexao.Params.Add('DriverPackageLoader=TDBXDynalinkDriverLoader,DBXCommonDriver180.bpl');
  Conexao.Params.Add('MetaDataPackageLoader=TDBXDevartPostgreSQLMetaDataCommandFactory,DbxDevartPostgreSQLDriver180.bpl');
  Conexao.Params.Add('ProductName=DevartPostgreSQL');
  Conexao.Params.Add('GetDriverFunc=getSQLDriverPostgreSQL');
  Conexao.Params.Add('LibraryName=dbexppgsql40.dll');
  Conexao.Params.Add('LocaleCode=0000');
  Conexao.Params.Add('IsolationLevel=ReadCommitted');
  Conexao.Params.Add('MaxBlobSize=-1');
  Conexao.Params.Add('FetchAll=True');
  Conexao.Params.Add('UseQuoteChar=False');
  Conexao.Params.Add('UseUnicode=True');
  Conexao.Params.Add('VendorLib=dbexppgsql40.dll');
  Conexao.Params.Add('BlobSize=-1');
  Conexao.Params.Add('HostName='+Rede.ReadString('DEFINICAO_DE_DATABASE','HOST',''));
  Conexao.Params.Add('SchemaName=public');
  Conexao.Params.Add('Database='+Rede.ReadString('DEFINICAO_DE_DATABASE','BANCO',''));
  Conexao.Params.Add('User_Name=postgres');
  Conexao.Params.Add('Password=ssq#0609');
  Conexao.Params.Add('EnableBCD=True');

  xDiretorioImagem := Rede.ReadString('DEFINICAO_DE_DATABASE','DIRETORIO_IMAGEM','');


  if copy( xDiretorioImagem,Length(xDiretorioImagem),1)<>'\' then
      xDiretorioImagem :=  xDiretorioImagem+'\';
  try
    begin
      //MySession := TDSSessionManager.GetThreadSession();
      Conexao.Open;
      //id := VarToStr(MySession.Id);
      Connections := TDictionary<NativeInt,TSQLConnection>.Create;
      Connections.Add(TDSSessionManager.GetThreadSession.Id, Conexao);

      //MySession.PutObject('Conn',Conexao);
    end;
  except on E:Exception do
    begin
      Application.MessageBox(Pchar('No Foi possvel conectar-se ao banco de dados!'+#13+#13+#13+
        'Descrio do erro: '+
        #13+#13+E.Message),'Ateno', MB_ICONERROR or MB_OK);
        SC.DSServer1.Stop();
        Application.Terminate;
    end;
  end;
end;

function TSM.ACE_DP_M_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCli: String;
  begin
    Result :=

              ' SELECT  CAST(''V'' AS VARCHAR(1)) AS TIPO, '+
             // ' CLI.DOC_CNPJ_CPF AS ID_PDV, '+
              ' CAST(COALESCE(REPLACE(REPLACE(REPLACE(CLI.DOC_CNPJ_CPF,''/'',''''),''.'',''''),''-'',''''),''99999999999999'')  AS VARCHAR(15))  AS ID_PDV, '+
              ' CLI.NOME AS RAZAO_SOCIAL, '+
              ' CLI.APELIDO AS FANTASIA, '+
              ' CAST(''BRA'' AS VARCHAR(4)) AS PAIS, CAST('''' AS VARCHAR(20)) AS REGIAO, '+

              ' CAST(COALESCE(CLE.UF, ''NC'') AS VARCHAR(2)) AS ESTADO, '+
              ' CAST(COALESCE(CLE.NOME, ''NO ATUALIZADO'') AS VARCHAR(30)) AS CIDADE, '+
             // ' CAST(COALESCE(CLI.BAIRRO, ''NO ATUALIZADO'') AS VARCHAR(30)) AS BAIRRO, '+
              ' CAST(COALESCE(CLI.BAIRRO, ''CENTRO'') AS VARCHAR(30)) AS BAIRRO, '+

              ' CAST(COALESCE(REPLACE(CLI.ENDERECO, '';'', '' ''), ''NO ATUALIZADO'') AS VARCHAR(40)) AS ENDERECO, '+
              ' CAST('''' AS VARCHAR(20)) AS GRUPOREDE, CAST('''' AS VARCHAR(20)) AS CONTATO,CAST('''' AS VARCHAR(20)) AS CLASSIFICACAO, '+

              ' CAST(CASE COALESCE(CLI.ID_VENDEDOR, ''0'') '+
              ' WHEN ''0'' THEN ''00-INDEFINIDO'' '+
              '  ELSE FUN.ID_FUNCIONARIO || ''-'' || FUN.NOME '+
              ' END AS VARCHAR(40)) AS VENDEDOR, '+

              ' CAST(EXTRACT(''YEAR'' FROM CLI.DTA_CADASTRO) || '+
              ' LPAD(CAST(EXTRACT(''MONTH'' FROM CLI.DTA_CADASTRO) AS VARCHAR),2,''0'') || '+
              ' LPAD(CAST(EXTRACT(''DAY'' FROM CLI.DTA_CADASTRO) AS VARCHAR),2,''0'')  AS VARCHAR(10)) AS DTA_CADASTRO, '+

              // ' CAST(COALESCE(TRIM(CLE.CEP),CLI.CEP) AS VARCHAR(9)) AS CEP, '+
              //  ' CLI.CEP, '+
              //' CAST(CASE COALESCE(CLE.CEP,'''') WHEN '''' THEN CLI.CEP  '+
              //'   ELSE CLE.CEP  END AS VARCHAR(9))  AS CEP, '+
              ' CLI.CEP, ' +
              ' CAST(COALESCE(CASE CLI.ATIVO '+
              '   WHEN ''T'' THEN ''A'' '+
              '   WHEN ''F'' THEN ''I'' '+
              ' END,''I'') AS VARCHAR(1)) AS STATUS  '+


              ' FROM CAD_TB_C_CLI CLI '+
              ' LEFT OUTER JOIN CAD_TB_C_CID CLE ON CLE.ID_CIDADE=CLI.ID_CIDADE '+
              ' LEFT OUTER JOIN FAT_TB_M_NFE NF ON NF.ID_EMITENTE=CLI.ID_CLIENTE '+
              ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=CLI.ID_VENDEDOR ';
  end;
begin
  inherited;
  ACE_SQ_M_CLI.Close;
  ACE_SQ_M_CLI.CommandText := enSqlCli + ' WHERE nf.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';

  if Input[0] = 0 then
    begin
      ACE_SQ_M_CLI.CommandText := ACE_SQ_M_CLI.CommandText +
      ' AND CLI.DTA_CADASTRO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
    end
  else
    begin
      ACE_SQ_M_CLI.CommandText := ACE_SQ_M_CLI.CommandText +
      ' AND CLI.DTA_CADASTRO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
    end;

  if VarToStr(Input[3])<>'' then
      ACE_SQ_M_CLI.CommandText := ACE_SQ_M_CLI.CommandText +
      ' AND CLI.ID_CIDADE NOT IN (' +VarToStr(Input[3]) +') ';

  if VarToStr(Input[4])<>'' then
      ACE_SQ_M_CLI.CommandText := ACE_SQ_M_CLI.CommandText +
      ' AND CLE.UF NOT IN (' +VarToStr(Input[4]) +') ';

   ACE_SQ_M_CLI.CommandText := ACE_SQ_M_CLI.CommandText +
             ' GROUP BY TIPO, ID_PDV, RAZAO_SOCIAL, FANTASIA, PAIS, REGIAO, CLE.UF, '+
             ' CIDADE,CLI.BAIRRO, CLI.ENDERECO,CLI.CEP,CLE.CEP,CLASSIFICACAO,VENDEDOR,CLI.DTA_CADASTRO, CLI.ATIVO, STATUS '+
                   ' ORDER BY ID_PDV, CLI.DTA_CADASTRO  DESC';
  Result := ACE_DP_M_CLI.Data;
end;

function TSM.ACE_DP_M_EST_DEPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEts1: String;
  begin
    Result :=
             ' SELECT '+
           //  ' FFE.ID_ITEM, '+
             ' CAST( CASE '+
             '  WHEN ITE.COD_BARRA<>'''' THEN ITE.COD_BARRA '+
             '   ELSE   CAST(ITE.ID_ITEM AS VARCHAR(50))  END   AS  VARCHAR(50)) ID_ITEM, '+

             ' FRN.DOC_CNPJ,PAR.EMP_CNPJ, FRN.DESCRICAO AS NOME_FOR, '+
             ' CAST(  EXTRACT(''YEAR'' FROM FFE.DATA) || '+
             ' LPAD(CAST(EXTRACT(''MONTH'' FROM FFE.DATA) AS VARCHAR),2,''0'') || '+
             ' LPAD(CAST(EXTRACT(''DAY'' FROM FFE.DATA) AS VARCHAR),2,''0'') AS VARCHAR(10)) AS DTA_MOVIMENTO, '+
             '       SUM(COALESCE(CASE tme.tipo_movimento '+
             '            WHEN ''1'' THEN FFE.QTDE*(-1) '+
             '            WHEN ''0'' THEN FFE.QTDE '+
             '       END,0)) AS QTDE '+
             ' FROM EST_TB_M_FEA FFE '+
             ' left outer join cad_tb_c_tme tme on (ffe.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
             ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=FFE.ID_ITEM '+
             ' LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
             ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=FFE.ID_EMPRESA '+
             ' LEFT OUTER JOIN CAD_TB_C_FAM FAM ON FAM.ID_FAMILIA=ITE.ID_FAMILIA ' +
             ' left outer join FAT_TB_M_NFE NFE     on (NFE.ID_FISCAL = FFE.ID_FISCAL) ' + #13#10 +
             ' left outer join FAT_TB_M_NFE_ITE NFI on (NFI.ID_FISCAL    = FFE.ID_FISCAL AND ' + #13#10 +
             '                                          NFI.ID_SEQUENCIA = FFE.ID_SEQ_ITEM)  ' +
             ' left outer join CAD_TB_C_CFO CFO on (CFO.ID_CFO     = NFE.ID_CFO)             ' + #13#10 +
             ' left outer join cad_tb_c_cli cli on (cli.id_cliente = NFE.id_emitente)        ' + #13#10 +
             ' left outer join cad_tb_c_cid cid on (cid.id_cidade  = cli.id_cidade)          ';
  end;

begin

  inherited;


  ACE_SQ_M_EST_DEP.Close;
  ACE_SQ_M_EST_DEP.CommandText := enSqlEts1 +
   '    where ffe.ID_EMPRESA in (' + VarToStr(Input[1]) +') '+
   '    AND FAM.ID_FAMILIA IN ('+VarToStr(Input[6])+') ';

  if Input[9] <> '' then
          BEGIN
             ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
              ' and FRN.ID_FORNECEDOR in (' + VarToStr(Input[9]) +') ';
          END;


  if Input[0] = 0 then
    begin
      ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
      '      and ffe.DATA >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[3])) -4)  +'''  '+
      '      and ffe.DATA <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[3])) )  +'''  ';

      if  VarToStr(Input[4])='0' then
          begin
             ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
              '      and ite.cod_barra = ''' + VarToStr(Input[5]) +''' ';
          end;
      if  VarToStr(Input[4])='1' then
          begin
             ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
             '      and ffe.id_item = ''' + VarToStr(Input[5]) +''' ';
          end;

      if (input[7] <> '') or (input[8] <> '') then
         begin
            //0,filial,de_inicial.Text,de_final.Text,ACE_CD_M_EST_FOPind_ite_bar.Text,ACE_CD_M_EST_FOPid_item.Text,
            //Familia,Cidade,UF,Fornecedor

            ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +

                    //' and (    (coalesce(ffe.id_fiscal,0) = 0)             '        + #13#10 +
                    //'           or                                               '  + #13#10 +
                    ' and (                                                   '        + #13#10 +
                    '                                                         '  + #13#10 +
                    '          (coalesce(ffe.id_fiscal,0) > 0                 '     + #13#10 +
                    '           and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                    '           and NFE.TIPO_NF <> ''S'''                           + #13#10 +
                    '           and NFE.STATUS = 1)  '                              + #13#10 +
                    '           or                                          '       + #13#10 +
                     '         (coalesce(ffe.id_fiscal,0) > 0                 '     + #13#10 +
                    '          and NFE.NFE_COD_SIT not in (''02'',''04'',''05'')  ' + #13#10 +
                    '          and NFE.TIPO_NF = ''S'''                             + #13#10 +
                    '          and NFE.STATUS  = 1                            '     + #13#10 +
                    '          and CFO.ID_CLASSE not in (''SP10'',''SP70'')   '     + #13#10 +
                    '          )                                              '     + #13#10 +
                    '          or                                            '      + #13#10 +
                    '          (coalesce(ffe.id_fiscal,0) > 0                 '     + #13#10 +
                    '           and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                    '           and NFE.TIPO_NF = ''S''                                             ' + #13#10 +
                    '           and NFE.STATUS  = 1                                                 ' + #13#10 +
                    '           and CFO.ID_CLASSE in (''SP10'',''SP70'')                            ' + #13#10;

            if Input[7] <> '' then
              begin
                ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                    '           and cli.id_cidade not in (' + VarToStr(Input[7]) +')                ' + #13#10;
              end;

            if Input[8] <> '' then
              begin
                ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                    '           and cid.uf not in (' + VarToStr(Input[8]) +')                       ' + #13#10;
              end;
                ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                    '          )' +
                    '      )' ;
         end;



      ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
      '  group by 1,2,3,4,5 '+
      '  order by id_item,PAR.EMP_CNPJ,frn.doc_cnpj ';
    end
   else
      begin
        ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
           '      and ffe.DATA >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) -4)  +'''  '+
           '      and ffe.DATA <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';

        if VarToStr(Input[4])='0' then
           begin
             ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
              '      and ite.cod_barra = ''' + VarToStr(Input[5]) +''' ';
           end;
        if VarToStr(Input[4])='1' then
           begin
             ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
              '      and ffe.id_item = ''' + VarToStr(Input[5]) +''' ';
           end;

        if (input[7] <> '') or (input[8] <> '') then
           begin
              ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                  ' and EXISTS ( SELECT NFI.ID_ITEM FROM FAT_TB_M_NFE NFE ' + #13#10 +
                        '          LEFT OUTER JOIN FAT_TB_M_NFE_ITE NFI ON  NFI.ID_FISCAL = NFE.ID_FISCAL AND ' + #13#10 +
                        '                                     NFI.ID_ITEM = FFE.ID_ITEM                 ' + #13#10 +
                        '          LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO = NFE.ID_CFO          ' + #13#10 +
                        '          LEFT OUTER JOIN cad_tb_c_cli cli on cli.id_cliente = nfE.id_emitente ' + #13#10 +
                        '          LEFT OUTER JOIN cad_tb_c_cid cid on cid.id_cidade  = cli.id_cidade   ' + #13#10 +
                        '        WHERE                                                                  ' + #13#10 +
                        '                                                                               ' + #13#10 +
                        '              nfi.id_item = FFE.id_item                                        ' + #13#10 +
                        '          and nfi.id_sequencia = FFE.id_seq_item                               ' + #13#10 +
                        '          and nfe.id_fiscal = FFE.id_fiscal' + #13#10 +
                        '          and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                        '          and NFE.TIPO_NF <> ''S''' + #13#10 +
                        '          and NFE.STATUS = 1 or ' + #13#10 +
                        '                                                                               ' + #13#10 +
                        '          (                                                                    ' + #13#10 +
                        '              nfi.id_item      = FFE.id_item                                   ' + #13#10 +
                        '          and nfi.id_sequencia = FFE.id_seq_item                               ' + #13#10 +
                        '          and nfe.id_fiscal    = FFE.id_fiscal' + #13#10 +
                        '          and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                        '          and NFE.TIPO_NF = ''S''' + #13#10 +
                        '          and NFE.STATUS  = 1       ' + #13#10 +
                        '          and CFO.ID_CLASSE not in (''SP10'',''SP70'') ' + #13#10 +
                        '          )                                                                    ' + #13#10 +
                        '           or                                                                  ' + #13#10 +
                        '          (                                                                    ' + #13#10 +
                        '              nfi.id_item      = FFE.id_item                                   ' + #13#10 +
                        '          and nfi.id_sequencia = FFE.id_seq_item                               ' + #13#10 +
                        '          and nfe.id_fiscal    = FFE.id_fiscal' + #13#10 +
                        '          and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                        '          and NFE.TIPO_NF = ''S''                                              ' + #13#10 +
                        '          and NFE.STATUS  = 1                                                  ' + #13#10 +
                        '          and CFO.ID_CLASSE in (''SP10'',''SP70'')                             ' + #13#10;
                  if Input[7] <> '' then
                    begin
                       ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                        '          and cli.id_cidade not in (' + VarToStr(Input[7]) +')                 ' + #13#10;
                    end;
                  if Input[8] <> '' then
                    begin
                       ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                        '          and cid.uf not in (' + VarToStr(Input[8]) +') ';
                    end;
                       ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
                        '    ) ' + #13#10+
                        '          )';
           end;

        ACE_SQ_M_EST_DEP.CommandText :=  ACE_SQ_M_EST_DEP.CommandText +
        '  group by 1,2,3,4,5 '+
        '  order by id_item,PAR.EMP_CNPJ,frn.doc_cnpj ';
      end;

  //CMServerForm.mm.Lines.Clear;
  //CMServerForm.mm.Lines.Add(ACE_SQ_M_EST_DEP.CommandText);

  Result := ACE_DP_M_EST_DEP.Data;
end;

function TSM.ACE_DP_M_EST_FOPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEts2: String;
  begin


    // Busca os itens que no tem movimento
    Result :=
              ' select ' + #13#10 +
              '        ttt.ID_ITEM AS ID_ITEM2,' + #13#10 +
              '        CAST( CASE' + #13#10 +
              '           WHEN ttt.COD_BARRA<>'''' THEN ttt.COD_BARRA' + #13#10 +
              '        ELSE   CAST(ttt.ID_ITEM AS VARCHAR(50))  END   AS  VARCHAR(50)) AS ID_ITEM,' + #13#10 +
              '        case' + #13#10 +
              '              WHEN ttt.COD_BARRA<>''''  THEN 0' + #13#10 +
              '        ELSE  1  END    AS IND_ITE_BAR,' + #13#10 +
              '        FRN.DOC_CNPJ,ttt.EMP_CNPJ, FRN.DESCRICAO AS NOME_FOR, ttt.ID_EMPRESA, 0 as QTDE' + #13#10 +
              ' from ' + #13#10 +
              '       (select ite.id_item, ite.descricao, ite.COD_BARRA, ite.id_familia, ite.id_fornecedor, par.id_empresa,par.EMP_CNPJ  ' + #13#10 +
              '        from cad_tb_c_ite ite,cad_tb_c_par par) ttt' + #13#10 +
              '    LEFT OUTER JOIN CAD_TB_C_FAM FAM ON  FAM.ID_FAMILIA=ttt.ID_FAMILIA' + #13#10 +
              '    LEFT OUTER JOIN CAD_TB_C_FOR FRN ON (FRN.ID_FORNECEDOR=ttt.ID_FORNECEDOR)' + #13#10 +
              ' where ' + #13#10 +
              '     ttt.ID_EMPRESA IN ('+VarToStr(Input[1])+') AND  '+ #13#10 +
              '     ttt.ID_FAMILIA IN ('+VarToStr(Input[4])+') AND '+ #13#10 +
              '     not exists (SELECT FFM.ID_ITEM FROM EST_TB_M_FEA FFM' + #13#10 +
              '                 where ffm.id_item    = ttt.id_item' + #13#10 +
              '                   and FFM.ID_EMPRESA = ttt.id_empresa)';
    if Input[7] <> '' then
       begin
         result := result +
              '    and ttt.ID_FORNECEDOR in (' + VarToStr(Input[7]) +')  ' + #13#10;
       end;

    {result := result + ' group by ID_ITEM2,ID_ITEM,IND_ITE_BAR, frn.doc_cnpj, frn.descricao, PAR.EMP_CNPJ, PAR.ID_EMPRESA ' + #13#10 +
                       ' union all ' + #13#10 +}

    // Busca os itens movimentados
    result := result + ' union all ' + #13#10 +

              ' SELECT  '+

              ' ITE.ID_ITEM AS ID_ITEM2, '+

              ' CAST( CASE '+
              '  WHEN ITE.COD_BARRA<>'''' THEN ITE.COD_BARRA '+
              '  ELSE   CAST(ITE.ID_ITEM AS VARCHAR(50))  END   AS  VARCHAR(50)) AS ID_ITEM, '+

              '  case '+
              '  WHEN ITE.COD_BARRA<>''''  THEN 0 '+
              '    ELSE  1  END    AS IND_ITE_BAR, '+
              ' FRN.DOC_CNPJ,PAR.EMP_CNPJ, FRN.DESCRICAO AS NOME_FOR, PAR.ID_EMPRESA, ' + #13#10 +
              '  SUM (' + #13#10 +
              '	  COALESCE (' + #13#10 +
              '		 	CASE tme.tipo_movimento' + #13#10 +
              '			WHEN ''1'' THEN' + #13#10 +
              '				FFM.QTDE * (- 1)' + #13#10 +
              '			WHEN ''0'' THEN' + #13#10 +
              '				FFM.QTDE' + #13#10 +
              '			END,0)) AS QTDE ' +
              ' ' +
              ' FROM EST_TB_M_FEA FFM ' +
              '   left outer join FAT_TB_M_NFE NFE on (NFE.ID_FISCAL = FFM.ID_FISCAL) ' + #13#10 +
              '   left outer join FAT_TB_M_NFE_ITE NFI on (NFI.ID_FISCAL    = FFM.ID_FISCAL AND ' + #13#10 +
              '                                            NFI.ID_SEQUENCIA = FFM.ID_SEQ_ITEM)  ' + #13#10 +
              '   left outer join CAD_TB_C_ITE ITE on (ITE.ID_ITEM       = FFM.ID_ITEM)       ' + #13#10 +
              '   left outer join CAD_TB_C_FAM FAM on (FAM.ID_FAMILIA    = ITE.ID_FAMILIA)    ' + #13#10 +
              '   left outer join CAD_TB_C_FOR frn on (ite.id_fornecedor = frn.id_fornecedor) ' + #13#10 +
              '   left outer join CAD_TB_C_PAR PAR on (par.id_empresa    = ffm.id_empresa)    ' + #13#10 +
              '   left outer join CAD_TB_C_CFO CFO on (CFO.ID_CFO     = NFE.ID_CFO)           ' + #13#10 +
              '   left outer join cad_tb_c_cli cli on (cli.id_cliente = nfE.id_emitente)      ' + #13#10 +
              '   left outer join cad_tb_c_cid cid on (cid.id_cidade  = cli.id_cidade)        ' + #13#10 +
              '   left outer join cad_tb_c_tme tme ON (ffm.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) ' +
              ' WHERE ' +
              '     ffm.id_empresa in (' + VarToStr(Input[1]) + ')   ' + #13#10;

    if Input[0] = '0' then
       begin
         result := result +
             '  and ffm.DATA <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';
       end;

    if Input[0] = '1' then
       begin
         result := result +
             '  and ffm.DATA <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';
       end;

    if Input[7] <> '' then
       begin
        result := result +
              '   and  frn.ID_FORNECEDOR in (' + VarToStr(Input[7]) +')  ' + #13#10;
       end;

    result := result +
              '   and fam.id_familia in (' + VarToStr(Input[4]) + ')  ' ;

    if (Input[5] <> '') or (Input[6] <> '')  then
       begin
          result := result +
                    //' and (    (coalesce(ffm.id_fiscal,0) = 0)             ' + #13#10 +
                    //'           or                                               ' + #13#10 +
                    ' and (                                                   ' + #13#10 +
                    '                                                         ' + #13#10 +
                    '          (coalesce(ffm.id_fiscal,0) > 0                 ' + #13#10 +
                    '           and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                    '           and NFE.TIPO_NF <> ''S'''                       + #13#10 +
                    '           and NFE.STATUS = 1)  '                        + #13#10 +
                    '           or                                          ' + #13#10 +
                    '         (coalesce(ffm.id_fiscal,0) > 0                 ' + #13#10 +
                    '          and NFE.NFE_COD_SIT not in (''02'',''04'',''05'')  ' + #13#10 +
                    '          and NFE.TIPO_NF = ''S'''                             + #13#10 +
                    '          and NFE.STATUS  = 1                            ' + #13#10 +
                    '          and CFO.ID_CLASSE not in (''SP10'',''SP70'')   ' + #13#10 +
                    '          )                                              ' + #13#10 +
                    '          or                                            ' + #13#10 +
                    '          (coalesce(ffm.id_fiscal,0) > 0                 ' + #13#10 +
                    '           and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') ' + #13#10 +
                    '           and NFE.TIPO_NF = ''S''                                              ' + #13#10 +
                    '           and NFE.STATUS  = 1                                                  ' + #13#10 +
                    '           and CFO.ID_CLASSE in (''SP10'',''SP70'')                             ' + #13#10;

          if Input[5] <> '' then
            begin
              result := result +
                    '           and cli.id_cidade not in (' + VarToStr(Input[5]) +')                 ' + #13#10;
            end;

          if Input[6] <> '' then
            begin
              result := result +
                    '           and cid.UF not in (' + VarToStr(Input[6]) +')                        ' + #13#10;
            end;
          result := result +
                    '          )' +
                    '      )' ;
       end;

    result := result +' group by ID_ITEM2,IND_ITE_BAR, frn.doc_cnpj, frn.descricao, PAR.EMP_CNPJ, PAR.ID_EMPRESA  '+ //+ #13#10 +
                      ' order by id_item2,EMP_CNPJ,DOC_CNPJ ';
  end;

begin
  inherited;

  ACE_SQ_M_EST_FOP.Close;
  ACE_SQ_M_EST_FOP.CommandText := enSqlEts2;

  //CMServerForm.mm.Lines.Clear;
  //CMServerForm.mm.Lines.Add(ACE_SQ_M_EST_FOP.CommandText);

  Result := ACE_DP_M_EST_FOP.Data;
end;

function TSM.ACE_DP_M_FILDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlLoj: String;
  begin
    Result :=

             ' SELECT  CAST( ''V'' AS VARCHAR(1)) AS TIPO, PAR.EMP_CNPJ AS CLIENTE, PAR.EMP_RAZAO, '+
             ' CID.UF,CID.NOME AS CIDADE,PAR.EMP_BAIRRO, PAR.EMP_CEP, '+
             ' CAST( ''A'' AS VARCHAR(1)) AS STATUS '+
              ' FROM CAD_TB_C_PAR PAR '+
              ' LEFT OUTER JOIN CAD_TB_C_CID CID ON PAR.ID_CIDADE=CID.ID_CIDADE ';
  end;
begin
  inherited;

  ACE_SQ_M_FIL.Close;
  ACE_SQ_M_FIL.CommandText := enSqlLoj + ' Where PAR.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  Result := ACE_DP_M_FIL.Data;
end;

function TSM.ACE_DP_M_IDNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIdn: String;
  begin
    Result :=
              ' SELECT ''H'' AS TIPO, '+
              '   EMP_CNPJ AS CLIENTE, '+
              '   EXTRACT(''YEAR'' FROM NOW()) || '+
              '   LPAD(CAST(EXTRACT(''MONTH'' FROM NOW()) AS VARCHAR),2,''0'') || '+
              '   LPAD(CAST(EXTRACT(''DAY'' FROM NOW()) AS VARCHAR),2,''0'') AS DTA_ARQUIVO '+
              ' FROM CAD_TB_C_PAR ';
  end;
begin
  inherited;

  ACE_SQ_M_IDN.Close;
  ACE_SQ_M_IDN.CommandText := enSqlIdn +
  ' WHERE ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  Result := ACE_DP_M_IDN.Data;
end;

function TSM.ACE_DP_M_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNfr: String;
  begin
    Result :=

              ' SELECT  CAST(''V'' AS VARCHAR(1)) AS TIPO, '+
              ' FRN.DOC_CNPJ AS CD_LOJA, '+
              ' NFE.NUMERO AS NOTA_FISCAL, '+
              ' CAST(case nfe.tipo_nf '+
              '  when ''E'' then ''E'' '+
              '  when ''D'' then ''R'' '+
              ' end AS VARCHAR(1)) AS ACAO, '+
              ' ROUND((NFE.VLR_LIQUIDO),2)*100 AS VALOR, '+
              ' SUM(NFI.QTDE)*1000 AS QTDE, '+
              ' NFE.ID_EMPRESA, '+

              ' CAST(EXTRACT(''YEAR'' FROM NFE.DTA_EMISSAO) || '+
              ' LPAD(CAST(EXTRACT(''MONTH'' FROM NFE.DTA_EMISSAO) AS VARCHAR),2,''0'') || '+
              ' LPAD(CAST(EXTRACT(''DAY'' FROM NFE.DTA_EMISSAO) AS VARCHAR),2,''0'') AS VARCHAR(10)) AS DTA_ACAO, '+

              ' CAST(EXTRACT(''YEAR'' FROM NFE.DTA_DOCUMENTO) || '+
              ' LPAD(CAST(EXTRACT(''MONTH'' FROM NFE.DTA_DOCUMENTO) AS VARCHAR),2,''0'') || '+
              ' LPAD(CAST(EXTRACT(''DAY'' FROM NFE.DTA_DOCUMENTO) AS VARCHAR),2,''0'') AS VARCHAR(10)) AS DTA_ENTRADA  '+


              ' FROM FAT_TB_M_NFE_ITE NFI '+
              ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NFI.ID_FISCAL '+
              ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NFI.ID_ITEM '+
              ' LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
              ' LEFT OUTER JOIN CAD_TB_C_FAM FAM ON FAM.ID_FAMILIA=ITE.ID_FAMILIA ';
  end;
begin
  inherited;
  ACE_SQ_M_NFE.Close;
  ACE_SQ_M_NFE.CommandText := enSqlNfr +
  ' WHERE NFE.NFE_COD_SIT = ''00'' '+
  ' AND NFE.TIPO_NF IN (''E'',''D'') '+
  ' and NFE.ID_EMPRESA in (' + VarToStr(Input[1]) +') '+
  ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';

  if Input[7] <> '' then
          BEGIN
            ACE_SQ_M_NFE.CommandText :=  ACE_SQ_M_NFE.CommandText +
              ' and FRN.ID_FORNECEDOR in (' + VarToStr(Input[7]) +') ';
          END;
  // no precisou de filtragem por cidade ele no pega notas de vendas.

  if Input[0] = 0 then
    begin
      ACE_SQ_M_NFE.CommandText :=  ACE_SQ_M_NFE.CommandText +
      ' AND NFE.DTA_DOCUMENTO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) -4)  +'''  '+
      ' AND NFE.DTA_DOCUMENTO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[2])) )  +'''  '+
      ' GROUP BY FRN.DOC_CNPJ,NFE.NUMERO, NFE.TIPO_NF,NFE.VLR_LIQUIDO, NFE.ID_EMPRESA, nfe.dta_emissao,nfe.dta_documento '+
      ' ORDER BY FRN.DOC_CNPJ, nfe.NUMERO ';
    end
  else
    begin
      ACE_SQ_M_NFE.CommandText :=  ACE_SQ_M_NFE.CommandText +
      ' AND NFE.DTA_DOCUMENTO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])))  +'''  '+
      ' AND NFE.DTA_DOCUMENTO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[3])) )  +'''  '+
      ' GROUP BY FRN.DOC_CNPJ,NFE.NUMERO, NFE.TIPO_NF,NFE.VLR_LIQUIDO, NFE.ID_EMPRESA, nfe.dta_emissao,nfe.dta_documento '+
      ' ORDER BY FRN.DOC_CNPJ, nfe.NUMERO ';
    end;

 // CMServerForm.mm.Lines.Add(ACE_SQ_M_NFE.CommandText);

  Result := ACE_DP_M_NFE.Data;
end;


function TSM.ACE_DP_M_PRODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPrd: String;
  begin
    if (input[4] = '') and (input[5] = '') then
       begin
         result := result +
            ' with itens_nota' + #13#10 +
            ' as' + #13#10 +
            '  (' + #13#10 +
            '     select nfe.id_empresa, nfi.id_item from fat_tb_m_nfe_ite nfi' + #13#10 +
            '        left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
            '        left outer join cad_tb_c_ite ite on (ite.id_Item = nfi.id_item) ' + #13#10 +
            '        left outer join cad_tb_c_fam fam on (fam.id_familia = ite.id_familia) ' + #13#10 +
            '     where ' ;
         if Input[3] <> '' then
            result := result +  ' fam.id_familia in ('+VarToStr(Input[3])+') and ';

         result := result +
            '           nfe.id_empresa in (' + vartostr(input[1]) +') ' +
            '       and nfe.dta_emissao <= ''' + formatdatetime('dd/mm/yyyy', strtodate( vartostr(input[2])) )  +''' '+
            '       and nfe.status = 1 ' +
            '       and nfe.nfe_cod_sit not in (''02'',''04'',''05'') ' +
            '     group by 1,2' + #13#10 +
            '     order by 1,2' + #13#10 +
            ')' + #13#10 +
            ' select  ';
       end
    else
       begin
          result := result +
              ' with itens_nota' + #13#10 +
                ' as' + #13#10 +
                '  (' + #13#10 +
                '     select nfe.id_empresa, nfi.id_item from fat_tb_m_nfe_ite nfi' + #13#10 +
                '        left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)   ' + #13#10 +
                '        left outer join cad_tb_c_cli cli on (cli.id_cliente = nfE.id_emitente)      ' + #13#10 +
                '        left outer join cad_tb_c_cfo cfo on (cfo.id_cfo = nfe.id_cfo)         ' + #13#10 +
                '        left outer join cad_tb_c_ite ite on (ite.id_Item = nfi.id_item)       ' + #13#10 +
                '        left outer join cad_tb_c_fam fam on (fam.id_familia = ite.id_familia) ' + #13#10 +
                '        LEFT OUTER JOIN CAD_TB_C_CID CLE ON (CLE.ID_CIDADE=CLI.ID_CIDADE)     ' + #13#10 +
                '     where ' ;
          if Input[3] <> '' then
             result := result +  '( fam.id_familia in ('+VarToStr(Input[3])+') ) and ';

          result := result +
            '       (( nfe.id_empresa in (' + vartostr(input[1]) +') ' +
            '         and fam.id_familia in ('+VarToStr(Input[3])+') ' +
            '         and nfe.dta_emissao <= ''' + formatdatetime('dd/mm/yyyy', strtodate( vartostr(input[2])) )  +''' '+
            '         and nfe.tipo_nf <> ''S''' +
            '         and nfe.status = 1 ' +
            '         and nfe.nfe_cod_sit not in (''02'',''04'',''05'') ' +
            '        ) ' +
            '       or ' +
            '        ( nfe.id_empresa in (' + vartostr(input[1]) +') ' +
            '          and fam.id_familia in ('+VarToStr(Input[3])+') ' +
            '          and nfe.dta_emissao <= ''' + formatdatetime('dd/mm/yyyy', strtodate( vartostr(input[2])) )  +''' '+
            '          and nfe.tipo_nf = ''S''' +
            '          and nfe.status = 1 ' +
            '          and nfe.nfe_cod_sit not in (''02'',''04'',''05'') ' +
            '          and cfo.id_classe not in (''SP10'',''SP70'') ' +
            '        ) ' +
            '       or ' +
            '        ( nfe.id_empresa in (' + vartostr(input[1]) +') ' +
            '          and fam.id_familia in ('+VarToStr(Input[3])+') ' +
            '          and nfe.dta_emissao <= ''' + formatdatetime('dd/mm/yyyy', strtodate( vartostr(input[2])) )  +''' '+
            '          and nfe.tipo_nf = ''S''' +
            '          and nfe.status = 1 ' +
            '          and nfe.nfe_cod_sit not in (''02'',''04'',''05'') ' +
            '          and cfo.id_classe in (''SP10'',''SP70'') ';
          if Input[4] <> '' then
            begin
              result := result +
              '          and cli.id_cidade not in (' + VarToStr(Input[4]) +') ' + #13#10;
            end;
          if Input[5] <> '' then
            begin
              result := result +
              '          and cle.uf not in (' + VarToStr(Input[5]) +') ' + #13#10;
            end;

            result := result +
            '        )) ' +
            '     group by 1,2' + #13#10 +
            '     ' + #13#10 ;


            result := result +
            ' union all ' + #13#10 +
            '  ' + #13#10 +
            ' select ' + #13#10 +
            '        ttt.ID_EMPRESA, ttt.ID_ITEM ' + #13#10 +
            ' from ' + #13#10 +
            '       (select ite.id_item, ite.descricao, ite.COD_BARRA, ite.id_familia, ite.id_fornecedor, par.id_empresa,par.EMP_CNPJ  ' + #13#10 +
            '        from cad_tb_c_ite ite,cad_tb_c_par par) ttt' + #13#10 +
            '    LEFT OUTER JOIN CAD_TB_C_FAM FAM ON  FAM.ID_FAMILIA=ttt.ID_FAMILIA' + #13#10 +
            '    LEFT OUTER JOIN CAD_TB_C_FOR FRN ON (FRN.ID_FORNECEDOR=ttt.ID_FORNECEDOR)' + #13#10 +
            ' where ' + #13#10 +
            '     ttt.ID_EMPRESA IN ('+VarToStr(Input[1])+') AND  '+ #13#10 +
            '     ttt.ID_FAMILIA IN ('+VarToStr(Input[3])+') AND '+ #13#10 +
            '     not exists (SELECT FFM.ID_ITEM FROM EST_TB_M_FEA FFM' + #13#10 +
            '                 where ffm.id_item    = ttt.id_item' + #13#10 +
            '                   and FFM.ID_EMPRESA = ttt.id_empresa)' + #13#10 +
            ' order by 1,2 ' + #13#10 +
            ')' + #13#10 +
            ' select  ';
       end;



    Result :=  result +
              '      CAST( ''V'' AS VARCHAR(1)) AS TIPO,  FN.DOC_CNPJ AS COD_FABRICANTE,  '+
              ' FN.DESCRICAO AS DES_FABRICANTE,  PRO.ID_ITEM AS COD_PRODUTO, '+
              ' inf.ID_EMPRESA AS ID_EMPRESA, PRO.DESCRICAO AS DES_PRODUTO, '+

              ' CAST(COALESCE(PRO.ID_GRUPO,''0.00.0.001'') AS VARCHAR(11)) AS COD_GRUPO, '+
              ' CAST(COALESCE(GP.DESCRICAO,''OUTROS'') AS VARCHAR(30)) AS DES_GRUPO, '+
              ' CAST( '''' AS VARCHAR(20)) AS COD_FAMILIA, '+
              ' CAST( '''' AS VARCHAR(20)) AS DES_FAMILIA, '+
              ' CAST( '''' AS VARCHAR(20)) AS COD_SUB_FAMILIA, '+
              ' CAST( '''' AS VARCHAR(20)) AS DES_SUB_FAMILIA, '+
              ' CAST(''E'' AS VARCHAR(1)) AS TIPO_COD_BARRA, '+


              ' PRO.COD_BARRA AS COD_BARRA, CAST(COALESCE(CU.DESCRICAO,''ETC'') AS VARCHAR(3)) AS EMBALAGEM, '+
              ' CAST( ''UN''  AS VARCHAR(3)) AS UND, '+
              ' COALESCE(PRO.EMB_VENDA,1)*1000 AS VOLUME, '+

              ' CAST(EXTRACT(''YEAR'' FROM PRO.DTA_CADASTRO) || '+
              ' LPAD(CAST(EXTRACT(''MONTH'' FROM PRO.DTA_CADASTRO) AS VARCHAR),2,''0'') || '+
              ' LPAD(CAST(EXTRACT(''DAY'' FROM PRO.DTA_CADASTRO) AS VARCHAR),2,''0'') AS VARCHAR(10)) AS DTA_CADASTRO, '+

              ' CAST(CASE PRO.ATIVO '+
              '  WHEN ''T'' THEN ''A'' '+
              '  WHEN ''F'' THEN ''I'' '+
              ' END  AS VARCHAR(1)) AS ATIVO '+


              ' FROM itens_nota inf '+
              '  left outer join cad_tb_c_ite pro on pro.id_item=inf.id_item ' +
              '  left outer join cad_tb_c_for fn on fn.id_fornecedor=pro.id_fornecedor '+
              '  left outer join cad_tb_c_gru gp on gp.id_grupo=pro.id_grupo ' +
              '  left outer join cad_tb_c_und cu on pro.id_und_venda=cu.id_unidade ' +
              '  left outer join cad_tb_c_fam fam on fam.id_familia=pro.id_familia ';

    if Input[6] <> '' then
      BEGIN
        result := result +
              ' where fn.ID_FORNECEDOR in (' + VarToStr(Input[6]) +') ' + #13#10;
      END;
  end;
var
 OrderBy: String;
begin
  //0, filial,de_inicial.Text,Familia,Cidade,UF,Fornecedor

   ACE_SQ_M_PRO.Close;
   ACE_SQ_M_PRO.CommandText := enSqlPrd;

   ACE_SQ_M_PRO.CommandText := ACE_SQ_M_PRO.CommandText +
                              ' ORDER BY PRO.ID_ITEM, PRO.COD_BARRA ';

   //CMServerForm.mm.Lines.Clear;
   //CMServerForm.mm.Lines.Add(ACE_SQ_M_PRO.CommandText);
   Result := ACE_DP_M_PRO.Data;

   ACE_SQ_M_PRO.close;
end;





function TSM.ACE_DP_M_VNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlVnd: String;
  begin
    Result :=
            ' SELECT CAST(''V'' AS VARCHAR(1)) AS TIPO, FIL.EMP_CNPJ, FOC.DOC_CNPJ AS COD_FAB, FOC.DESCRICAO, '+
            //' PRO.ID_ITEM AS COD_BARRA, '+

            ' CAST( CASE '+
            ' WHEN PRO.COD_BARRA<>'''' THEN PRO.COD_BARRA '+
            ' ELSE   CAST(PRO.ID_ITEM AS VARCHAR(50))  END   AS  VARCHAR(50)) AS COD_BARRA, '+



            ' CAST( '''' AS VARCHAR(20)) AS NUM_LOTE, CAST('''' AS VARCHAR(20)) AS VAL_LOTE, CAST('''' AS VARCHAR(20)) AS LIVRE1, '+
            ' CAST('''' AS VARCHAR(20)) AS LIVRE2, (NFI.QTDE)*1000 AS QTDE, '+
            ' ROUND((NFI.VLR_LIQUIDO),2)*100 AS VLR_LIQ_TOTAL,CAST( ''BRL'' AS VARCHAR(10)) AS MOEDA, '+
            ' NFE.NUMERO AS ID_TRANSACAO, NFE.ID_EMPRESA, '+

            ' CAST(EXTRACT(''YEAR'' FROM NFE.DTA_EMISSAO) || '+
            ' LPAD(CAST(EXTRACT(''MONTH'' FROM NFE.DTA_EMISSAO) AS VARCHAR),2,''0'') || '+
            ' LPAD(CAST(EXTRACT(''DAY'' FROM NFE.DTA_EMISSAO) AS VARCHAR),2,''0'') AS VARCHAR(10)) AS DTA_ESTOQUE, '+

            'CAST(CASE ' + #13#10 +
            '                  WHEN NFE.NFE_COD_SIT=''02'' ' + #13#10 +
            '                       THEN ''C'' ' + #13#10 +
            '                  WHEN NFE.STATUS = 0 AND NFE.ORIGEM_NF = ''A'' ' + #13#10 +
            '                       THEN ''P'' ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF = ''S'' AND ' + #13#10 +
            '                       NFI.ID_CFO IN (''5910'',''6910'')' + #13#10 +
            '                       THEN ''B''                   ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF   = ''S'' AND ' + #13#10 +
            '                       CFO.ID_CLASSE in (''SP10'',''SP90'')       AND' + #13#10 +
            '                       NFI.ID_CFO NOT IN (''5922'',''6922'',''5116'',''6116'',''5117'',''5117'')' + #13#10 +
            '                       THEN ''V'' ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF   = ''S'' AND ' + #13#10 +
            '                       NFI.ID_CFO IN (''5922'',''6922'',''5116'',''6116'',''5117'',''5117'')' + #13#10 +
            '                       THEN ''VF'' ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF = ''R'' ' + #13#10 +
            '                       THEN ''DV''                  ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF = ''S'' AND CFO.ID_CLASSE = ''SP30''' + #13#10 +
            '                       THEN ''SR''                                    ' + #13#10 +
            '                  WHEN NFE.STATUS = 1 AND NFE.TIPO_NF = ''S'' AND CFO.ID_CLASSE = ''SP60''' + #13#10 +
            '                       THEN ''T''                                    ' + #13#10 +
            '              END AS  VARCHAR(3)) AS TIPO_TRANSACAO, ' +
            '  NFI.ID_CFO, '+

            ' CAST(CASE CLI.PESSOA '+
            '     WHEN ''0'' THEN ''1'' '+
            '     WHEN ''1'' THEN ''2'' '+
            '  END AS VARCHAR(1)) AS TIPO_PDV, '+

            '  CLI.DOC_CNPJ_CPF AS ID_PDV, '+
            '  CLI.NOME AS DES_PDV, '+
            '  CAST(COALESCE(CLI.CEP,''56300000'') AS VARCHAR(8)) AS CEP_PDV, '+
            '  CAST('''' AS VARCHAR(20)) AS CLA_PDV, '+

            '  CAST(CASE COALESCE(NFE.ID_VENDEDOR,0) '+
            '      WHEN 0 THEN ''00-OUTRO''  '+
            '      ELSE  FUN.ID_FUNCIONARIO ||''-'' || FUN.NOME '+
            '  END AS VARCHAR(50)) AS NOME_VND  '+

              ' FROM FAT_TB_M_NFE_ITE NFI '+
              ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL  = NFI.ID_FISCAL '+
              ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO = NFE.ID_CFO          ' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_PAR FIL ON FIL.ID_EMPRESA = NFE.ID_EMPRESA '+
              ' LEFT OUTER JOIN CAD_TB_C_ITE PRO ON PRO.ID_ITEM    = NFI.ID_ITEM '+
              ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = NFE.ID_EMITENTE '+
              ' LEFT OUTER JOIN cad_tb_c_cid cid on cid.id_cidade  = cli.id_cidade   ' +
              ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO = NFE.ID_VENDEDOR '+
              ' LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR  = PRO.ID_FORNECEDOR '+
              ' LEFT OUTER JOIN CAD_TB_C_FAM FAM ON FAM.ID_FAMILIA     = PRO.ID_FAMILIA ';
  end;
begin
  ACE_SQ_M_VND.Close;
  ACE_SQ_M_VND.CommandText := enSqlVnd +
  ' Where ' +
  ' (     NFE.ID_EMPRESA in (' + VarToStr(Input[1])   + ') '+
  '   and FAM.ID_FAMILIA in (' + VarToStr(Input[4])   + ') ';

  if Input[7] <> '' then
      BEGIN
         ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
              ' and FOC.ID_FORNECEDOR in (' + VarToStr(Input[7]) +') ';
      END;

   if Input[5] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
      end;
    if Input[6] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cid.uf not in (' + VarToStr(Input[6]) +') ';
      end;

  ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
  '   and NFE.NFE_COD_SIT not in (''04'',''05'') ' + #13#10 +
  '   and NFE.TIPO_NF = ''R'' '  + #13#10 +
  '   and NFE.STATUS  = 1  ' + #13#10 ;

  if Input[0] = 0 then
    begin
      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) -29)  +''' '+
      ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';
    end
  else
    begin
      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[3])) -29)  +''' '+
      ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
    end;
  ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
  ' )       ' + #13#10 +

  ' or         ' +

  ' (     NFE.ID_EMPRESA in (' + VarToStr(Input[1])   + ') '+
  '   and FAM.ID_FAMILIA in (' + VarToStr(Input[4])   + ') ';

   if Input[5] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
      end;
   if Input[6] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cid.uf not in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      BEGIN
         ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
              ' and FOC.ID_FORNECEDOR in (' + VarToStr(Input[7]) +') ';
      END;

  ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
  '   and NFE.NFE_COD_SIT not in (''04'',''05'') ' + #13#10 +
  '   and NFE.TIPO_NF = ''S''  '  + #13#10 +
  '   and NFE.STATUS  = 1  ' + #13#10 +
  '   and CFO.ID_CLASSE in (''SP10'',''SP70'') ' + #13#10 ;
  if Input[0] = 0 then
    begin
      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) -29)  +''' '+
      ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';
    end
  else
    begin
      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[3])) -29)  +''' '+
      ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
    end;
  ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
  ' )       ' + #13#10;


  ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' or         ' +
      ' (     NFE.ID_EMPRESA in (' + VarToStr(Input[1])   + ') '+
      '   and FAM.ID_FAMILIA in (' + VarToStr(Input[4])   + ') ';

  if Input[7] <> '' then
    BEGIN
       ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        ' and FOC.ID_FORNECEDOR in (' + VarToStr(Input[7]) +') ';
    END;

      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      '   and NFE.NFE_COD_SIT not in (''04'',''05'') ' + #13#10 +
      '   and NFE.TIPO_NF = ''S''  '  + #13#10 +
      '   and NFE.STATUS  = 1  ' + #13#10 +
      '   and CFO.ID_CLASSE in (''SP30'',''SP60'') ' + #13#10;
    if Input[5] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
      end;
    if Input[6] <> '' then
      begin
        ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
        '   and cid.uf not in (' + VarToStr(Input[6]) +') ';
      end;
      if Input[0] = 0 then
        begin
          ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
          ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) -29)  +''' '+
          ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +'''  ';
        end
      else
        begin
          ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
          ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[3])) -29)  +''' '+
          ' AND NFE.DTA_EMISSAO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
        end;
      ACE_SQ_M_VND.CommandText := ACE_SQ_M_VND.CommandText +
      ' )       ' ;

  ACE_SQ_M_VND.CommandText :=
      ACE_SQ_M_VND.CommandText +
          ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,nfe.dta_emissao,pro.id_item' +
          ' ORDER BY FIL.EMP_CNPJ, PRO.ID_ITEM,NFE.NUMERO,NFE.DTA_EMISSAO  ';

  //CMServerForm.mm.Lines.Add(ACE_SQ_M_VND.CommandText);

  Result := ACE_DP_M_VND.Data;
end;

function TSM.ACE_DP_R_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelAceCli: string;
begin
  { TODO -oLuan : Criado no dia 14/11/2016 }
  enSqlRelAceCli :=
        ' SELECT cli.doc_cnpj_cpf AS DOCUMENTO,                   '+
        ' nfe.id_empresa||''-''||par.emp_razao||''/''||par.emp_fantasia AS FILIAL,   nfe.numero AS NUMERO,   '+
        ' nfe.dta_emissao AS DATA_EMISSAO, '+
        ' case '+
	      ' when (ite.cod_barra = '''') or (ite.cod_barra is null) then cast(nfi.id_item as varchar(50)) '+
        ' ELSE ite.cod_barra '+
        ' end as codigo, '+
        ' ite.descricao AS DESCRICAO, nfi.qtde AS QTDE, nfi.vlr_unitario AS VALOR_UNITARIO, nfi.vlr_liquido, '+
        ' nfi.id_cfo AS CFOP, cid.nome as CIDADE, cid.uf as UF                      '+
        ' FROM fat_tb_m_nfe_ite nfi                                                 '+
        ' LEFT OUTER JOIN fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal         '+
        ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO = NFE.ID_CFO               '+
        ' left outer join cad_tb_c_ite ite on ite.id_item = nfi.id_item             '+
        ' left outer join cad_tb_c_for foc on foc.id_fornecedor = ite.id_fornecedor '+
        ' left outer join cad_tb_c_cli cli on cli.id_cliente = nfe.id_emitente '+
        ' LEFT OUTER JOIN cad_tb_c_cid cid on cid.id_cidade  = cli.id_cidade   ' +
        ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa '+
        ' LEFT OUTER JOIN CAD_TB_C_FAM FAM ON FAM.ID_FAMILIA=ITE.ID_FAMILIA ';

  ACE_SQ_R_CLI.Close;
  ACE_SQ_R_CLI.CommandText := '';
  ACE_SQ_R_CLI.CommandText := enSqlRelAceCli;

  ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
           ' WHERE (NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) -29)+''' '+
           '    AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' ' +
           '    AND NFE.NFE_COD_SIT NOT IN (''04'', ''05'') '+
           '    and nfe.status = 1 '+
           '    and nfe.tipo_nf = ''R'' ';

  if Input[2]<>'' then
    begin
      ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                              ' AND NFE.ID_EMPRESA in ('+VarToStr(Input[2])+') ';
    end;

  if Input[3]<>'' then
    begin
      ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
          Format(' AND upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
    end;

  if Input[4]<>'' then
    begin
      ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
          ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';
    end;

  if Input[5]<>'' then
     begin
       ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
           '  and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
     end;

  if Input[6]<>'' then
     begin
       ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
           '  and cid.uf not in (' + VarToStr(Input[6]) +') ';
     end;

  if Input[7]<>'' then
     begin
       ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
           '  and foc.id_fornecedor in (' + VarToStr(Input[7]) +') ';
     end;


   ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  + ') ';

  if Input[5]<>'' then
      begin
        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 ' or ( NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) -29)+''' '+
                 '      AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' ' +
                 '      and nfe.status = 1 '+
                 '      AND NFE.NFE_COD_SIT NOT IN (''04'', ''05'') '+
                 '      and nfe.tipo_nf = ''S''  and cfo.id_classe in (''SP10'',''SP70'')  ' +
                 '      and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';

        if Input[2]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                                    ' AND NFE.ID_EMPRESA in ('+VarToStr(Input[2])+') ';
           end;

        if Input[3]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                Format(' AND upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
           end;

        if Input[4]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';
           end;

        if Input[5]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
           end;

        if Input[6]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cid.uf not in (' + VarToStr(Input[6]) +') ';
           end;

        if Input[7]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and foc.id_fornecedor in (' + VarToStr(Input[7]) +') ';
           end;

        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  + ') ';


        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 ' or ( NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) -29)+''' '+
                 '      AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' ' +
                 '      and nfe.status = 1 '+
                 '      AND NFE.NFE_COD_SIT NOT IN (''04'', ''05'') '+
                 '      and nfe.tipo_nf = ''S''  and cfo.id_classe in (''SP30'',''SP60'')  ' +
                 '      and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';

        if Input[2]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                                    ' AND NFE.ID_EMPRESA in ('+VarToStr(Input[2])+') ';
           end;

        if Input[3]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                Format(' AND upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
           end;

        if Input[4]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';
           end;

        if Input[5]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cli.id_cidade not in (' + VarToStr(Input[5]) +') ';
           end;

        if Input[6]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cid.uf not in (' + VarToStr(Input[6]) +') ';
           end;

        if Input[7]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and foc.id_fornecedor in (' + VarToStr(Input[7]) +') ';
           end;

        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  + ') ';
      end
   else
    begin
      ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 ' or ( NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) -29)+''' '+
                 '      AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' ' +
                 '      and nfe.status = 1 '+
                 '      AND NFE.NFE_COD_SIT NOT IN (''04'', ''05'') '+
                 '      and nfe.tipo_nf = ''S'' '+
                 ' and cfo.id_classe not in (''SP10'',''SP70'') ' ;

        if Input[2]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                                    ' AND NFE.ID_EMPRESA in ('+VarToStr(Input[2])+') ';
           end;

        if Input[3]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                Format(' AND upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
           end;

        if Input[4]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';
           end;

        if Input[6]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cid.uf not in (' + VarToStr(Input[6]) +') ';
           end;

        if Input[7]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and foc.id_fornecedor in (' + VarToStr(Input[7]) +') ';
           end;

        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  + ') ';


        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 ' or ( NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) -29)+''' '+
                 '      AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' ' +
                 '      and nfe.status = 1 '+
                 '      AND NFE.NFE_COD_SIT NOT IN (''04'', ''05'') '+
                 '      and nfe.tipo_nf = ''S'' '+
                 ' and cfo.id_classe not in (''SP30'',''SP60'') ' ;

        if Input[2]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                                    ' AND NFE.ID_EMPRESA in ('+VarToStr(Input[2])+') ';
           end;

        if Input[3]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                Format(' AND upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
           end;

        if Input[4]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                ' AND FAM.ID_FAMILIA IN (' + VarToStr(Input[4]) +') ';
           end;

        if Input[6]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and cid.uf not in (' + VarToStr(Input[6]) +') ';
           end;

        if Input[7]<>'' then
           begin
             ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                 '  and foc.id_fornecedor in (' + VarToStr(Input[7]) +') ';
           end;

        ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  + ') ';
    end;
  ACE_SQ_R_CLI.CommandText := ACE_SQ_R_CLI.CommandText  +
                              ' order by nfe.dta_emissao ';
  //CMServerForm.mm.Lines.Add(ACE_SQ_R_CLI.CommandText);
  Result := ACE_DP_R_CLI.Data;
end;

function TSM.AllApplyUpdates(Delta: OleVariant): boolean;
 var
   Vtran: TDBXTransaction;
   Lista:TList<TClientDataSet>;
   cds:TClientDataSet;
   i:integer;
   Arraydelta:array of OleVariant;
   Conn: TSQLConnection;
 begin
   result:=false;
   if VarIsArray(Delta) then
      begin
        Arraydelta:=delta;
        Lista:=TList<TClientDataSet>.Create;
        try
          i:=0;
          Conn := BuscarConnBanco;
          Vtran := Conn.BeginTransaction;
          try
             while i <=  High(Arraydelta) do
               begin
                 cds:=TClientDataSet.Create(self);
                   With cds do
                     begin
                       ProviderName:= Arraydelta[i];
                       open;
                       i:=i+1;
                       data:=Arraydelta[i];
                       if not (ApplyUpdates(0) = 0) then
                        begin
                         raise TAllApplyUpdatesError.Create(uResourceString.PrefixoErro
                                                             +ProviderName+sLineBreak+
                                                              cds.enErro);
                        end;

                       i:=i+1;
                     end;
                Lista.Add(Cds);
            end;
          Conn.CommitFreeAndNil(Vtran);
          result:=true;
     finally
        Conn.RollbackIncompleteFreeAndNil(Vtran);
     end;
   finally
     begin
       for cds In Lista do
       cds.Free;
       Lista.Free;
       end;
   end;
 end;
 end;

//Criptografar uma String
function TSM.enMD5(const texto: string): string;
var
  idmd5: TIdHashMessageDigest5;
begin
  idmd5 := TIdHashMessageDigest5.Create;
  try
   result := idmd5.HashStringAsHex(texto);
  finally
   idmd5.Free;
  end;
end;


function TSM.enExcluirPreVenda(num_prevenda: String): String;
var
  CD_BR_CUPOM_MESTRE,CD_BR_PREVENDA: TClientDataSet;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 16/11/2016
    Tem a funo de excluir a PrVenda. }


   result := '';


   CD_BR_CUPOM_MESTRE := TClientDataSet.Create(self);
   CD_BR_CUPOM_MESTRE.SetProvider(DP_BR_CUPOM_MESTRE);

   CD_BR_PREVENDA     := TClientDataSet.Create(self);
   CD_BR_PREVENDA.SetProvider(DP_BR_PREVENDA);

   CD_BR_CUPOM_MESTRE.Close;
       CD_BR_CUPOM_MESTRE.Data :=
           CD_BR_CUPOM_MESTRE.DataRequest(VarArrayOf([8,
                     num_prevenda]));
   if CD_BR_CUPOM_MESTRE.IsEmpty then
      begin
        CD_BR_PREVENDA.Close;
        CD_BR_PREVENDA.Data :=
           CD_BR_PREVENDA.DataRequest(VarArrayOf([1,num_prevenda]));
        if not CD_BR_PREVENDA.IsEmpty then
           begin
             CD_BR_PREVENDA.delete;
             try
               if CD_BR_PREVENDA.ApplyUpdates(0) = 0 then
                  begin
                    result := 'OK';
                  end;
             except
                 on e: exception do
                    begin
                       raise Exception.Create('Erro ao tentar excluir a pr-venda!' + #13 + e.Message);
                    end;
             end;
           end;
        CD_BR_PREVENDA.Close;
      end;

   FreeAndNil(CD_BR_PREVENDA);
   FreeAndNil(CD_BR_CUPOM_MESTRE);
end;

Function TSM.enExiDebCliente(DiasProtesto,id_cliente:integer):boolean;
var xSql:string;
begin
  result:=false;
  xSql:=
    ' select coalesce(SUM( RC.VLR_SALDO ),0) AS VLR_SALDO '+
    ' from FIN_TB_M_REC RC '+
    '   LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = RC.ID_FORMA_PAG '+
    ' WHERE RC.ID_CLIENTE = '''+IntToStr(id_Cliente)+''' and FPG.CRI_DEBI_CLIENTE='''+'TRUE'+''' ' +
    '  AND  (RC.DTA_VENCIMENTO + ' + inttostr(DiasProtesto) + ') <  CURRENT_DATE ';
  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add(xsql);
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       if qryBusca.FieldByName('VLR_SALDO').AsCurrency > 0 then
          begin
            result:=true;
          end;
     end;

end;

//Criptografar um arquivo inteiro
function TSM.enMD5File(const fileName: string): string;
var
  idmd5 : TIdHashMessageDigest5;
  fs : TFileStream;
begin
  idmd5 := TIdHashMessageDigest5.Create;
  fs := TFileStream.Create(fileName, fmOpenRead OR fmShareDenyWrite) ;
  try
   result := idmd5.HashStreamAsHex(fs);
  finally
   fs.Free;
   idmd5.Free;
  end;
end;


function TSM.enNroDeCompras(Modulo, IdEmpresa, IdCliente: String): Currency;
var
  qry: TSQLQuery;
  sql: String;
begin

   { TODO -oMaxsuel -cCriao :
     Criado em 01/03/2021
     Mtodo utilizado para pegar o nro de compras do cliente. }

   qry:=TSqlQuery.Create(self);
   qry.SQLConnection:=self.conexao;

   qry.Close;
   qry.SQL.Clear;


   if Modulo = 'SGQ' then
      begin

        result := 0;

        sql :=  ' select count(*) qtde from pcp_tb_m_ors ors ' +
                '   inner join fat_tb_m_ped ped on ped.id_pedido = ors.id_pedido      ' +
                ' where                                ' +
                '    ors.id_empresa =  ''' + IdEmpresa + ''' and ' +
                '    ped.id_cliente =  ''' + IdCliente + ''' ';
        qry.SQL.Add(sql);
        qry.Open;
        if not qry.IsEmpty then
           begin
             result := qry.FieldByName('qtde').AsCurrency;
           end;
      end;
   qry.Close;
   qry.Destroy();

end;

function TSM.enProxNroMDFe(id_empresa: String): integer;
var
  BUS_CD_C_PAR_SER: TClientDataSet;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 06/04/2016
    Mtodo utilizado para pegar o prximo nmero do MDFe. }
  try

  BUS_CD_C_PAR_SER := TClientDataSet.Create(self);
  BUS_CD_C_PAR_SER.SetProvider(BUS_DP_C_PAR_SER);


  BUS_CD_C_PAR_SER.Close;
  BUS_CD_C_PAR_SER.Data :=
            BUS_CD_C_PAR_SER.DataRequest(
                     VarArrayOf([id_empresa,'M']));
  if not BUS_CD_C_PAR_SER.IsEmpty then
     begin
       BUS_CD_C_PAR_SER.Edit;
       result := BUS_CD_C_PAR_SER.FieldByName('NFE_NUMERO').AsInteger + 1;
       BUS_CD_C_PAR_SER.FieldByName('NFE_NUMERO').AsInteger := result;
     end
  else
     begin
       BUS_CD_C_PAR_SER.Insert;
       result := 1;
       BUS_CD_C_PAR_SER.FieldByName('id_empresa').AsString := id_empresa;
       BUS_CD_C_PAR_SER.FieldByName('nfe_serie').AsString := 'M';
       BUS_CD_C_PAR_SER.FieldByName('NFE_NUMERO').AsInteger := 1;
     end;
  BUS_CD_C_PAR_SER.Post;
  BUS_CD_C_PAR_SER.ApplyUpdates(0);

 finally
   FreeAndNil(BUS_CD_C_PAR_SER);
 end;



end;

function TSM.enReabrePed(id_fiscal: integer; ReabrePed: String): String;
var
  BUS_CD_M_NFE,BUS_CD_M_NFE_INT: TClientDataSet;
  FAT_CD_M_PED,FAT_CD_M_PED_ITE,OFI_CD_M_ORV,BUS_CD_M_NFE_ORV: TClientdataset;
  PermCancelarOrv:Boolean;
  Vtran: TDBXTransaction;
  vlrSldAcres: Currency;
  Conn: TSQLConnection;
begin
   { TODO -oMaxsuel Victor -cCriao :
     Criado em 11/12/2015

     Este mtodo tem a funo de reabrir o pedido de venda }

   // Cancelamento de uma Nfe

        BUS_CD_M_NFE := TClientDataSet.Create(self);
        BUS_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
        BUS_CD_M_NFE.Close;
        BUS_CD_M_NFE.Data :=
            BUS_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));



        if BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger > 0 then
           begin
              // Busca o pedido de venda para ser cancelado
              FAT_CD_M_PED := TClientDataSet.Create(nil);
              FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
              FAT_CD_M_PED.Close;
              FAT_CD_M_PED.Data :=
                   FAT_CD_M_PED.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,
                                                          BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger ]));
              FAT_CD_M_PED_ITE := TClientDataSet.Create(nil);
              FAT_CD_M_PED_ITE.DataSetField := TDataSetField(FAT_CD_M_PED.FieldByName('FAT_SQ_M_PED_ITE'));


              if not (FAT_CD_M_PED.IsEmpty) then
                 begin
                   FAT_CD_M_PED.Edit;
                   if ReabrePed = 'S' then
                      begin
                        // Maxsuel Victor , em 01/12/2015
                        // Procedimento quando Cancela a nota fiscal:
                        FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger           := 0; // Em aberto;
                        if FAT_CD_M_PED.FieldByName('pcp_id_opr').AsInteger > 0 then
                           FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger           := 2; // Em produo;

                        FAT_CD_M_PED.FieldByName('SITUACAO_APROVACAO').AsInteger := 0; // Em espera;

                        FAT_CD_M_PED.FieldByName('CONFERIDO').AsBoolean := false;
                        FAT_CD_M_PED.FieldByName('RESULTADO_CONF').AsInteger := 0;
                        FAT_CD_M_PED.FieldByName('ID_RESP_CONF').AsString := '';
                        FAT_CD_M_PED.FieldByName('DTA_CONF').AsString := '';
                        FAT_CD_M_PED.FieldByName('HOR_CONF').AsString := '';

                        FAT_CD_M_PED_ITE.First;

                        while not FAT_CD_M_PED_ITE.EOF  do
                          BEGIN
                            FAT_CD_M_PED_ITE.Edit;

                            FAT_CD_M_PED_ITE.FieldByName('QTDE_CONFERIDA').AsInteger := 0;

                            FAT_CD_M_PED_ITE.Post;
                            FAT_CD_M_PED_ITE.Next;
                          END;

                        {if not (pos('G',FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text) <> 0) then
                           begin
                             FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text :=
                                 FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text + 'G';
                           end;}

                      end;

                   if ReabrePed = 'N' then
                      FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 4; // cancelado;

                   FAT_CD_M_PED.Post;
                 end;
           end;

        if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger > 0 then
          begin
             PermCancelarOrv := true;

            // Busca as notas fiscais da ordem de servio
            BUS_CD_M_NFE_ORV := TClientDataSet.Create(nil);
            BUS_CD_M_NFE_ORV.SetProvider(BUS_DP_M_NFE_INT);
            BUS_CD_M_NFE_ORV.Close;
            BUS_CD_M_NFE_ORV.Data :=
                 BUS_CD_M_NFE_ORV.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger]));
            if not BUS_CD_M_NFE_ORV.IsEmpty then
               begin
                 if BUS_CD_M_NFE_ORV.RecordCount > 1 then
                    begin
                      while not BUS_CD_M_NFE_ORV.Eof do
                         begin
                           if BUS_CD_M_NFE_ORV.FieldByName('ID_FISCAL').AsInteger <> id_fiscal then
                              begin
                                if (BUS_CD_M_NFE_ORV.FieldByName('NFE_COD_SIT').AsString <> '02') and
                                   (BUS_CD_M_NFE_ORV.FieldByName('NFE_COD_SIT').AsString <> '04') and
                                   (BUS_CD_M_NFE_ORV.FieldByName('NFE_COD_SIT').AsString <> '05') and
                                   (not( (BUS_CD_M_NFE_ORV.FieldByName('NUMERO').AsInteger =0) and
                                   (BUS_CD_M_NFE_ORV.FieldByName('STATUS').AsInteger =0))) then
                                      PermCancelarOrv := false;
                              end;
                           BUS_CD_M_NFE_ORV.Next;
                         end;
                    end;
                 BUS_CD_M_NFE_ORV.close;

                 if PermCancelarOrv then
                    begin
                      // Busca a ordem de sada para ser cancelado
                      OFI_CD_M_ORV := TClientDataSet.Create(nil);
                      OFI_CD_M_ORV.SetProvider(OFI_DP_M_ORV);
                      OFI_CD_M_ORV.Close;
                         OFI_CD_M_ORV.Data :=
                             OFI_CD_M_ORV.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger,
                                                                    BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,'1','']));
                      if not (OFI_CD_M_ORV.IsEmpty) then
                         begin
                           OFI_CD_M_ORV.Edit;
                           if ReabrePed='N' then
                             begin
                              OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 4; // cancelado;
                             end;
                           if ReabrePed='S' then
                             begin
                              OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 0; // em aberto;
                             end;
                           OFI_CD_M_ORV.Post;
                         end;
                    end;

               end;
          end;

        BUS_CD_M_NFE.edit;
        BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger := 0;


        if ReabrePed='S' then
           begin
             if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger >0 then
                 begin
                   BUS_CD_M_NFE_INT := TClientDataSet.Create(self);
                   BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
                   BUS_CD_M_NFE_INT.Close;
                   BUS_CD_M_NFE_INT.Data :=
                   BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger]));
                   BUS_CD_M_NFE_INT.First;


                   while not BUS_CD_M_NFE_INT.EOF do
                     begin
                       if  BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> id_fiscal then
                          begin
                             if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '02') or
                                (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '05') then
                                begin
                                   BUS_CD_M_NFE_INT.Edit;
                                   BUS_CD_M_NFE_INT.FieldByName('ID_ORDEM').AsInteger := 0;
                                   BUS_CD_M_NFE_INT.Post;
                                end;

                             if (BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger = 0) and
                                (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger = 0) then
                                begin
                                   BUS_CD_M_NFE_INT.Delete;
                                end;

                          end;

                       BUS_CD_M_NFE_INT.Next;
                     end;

                   BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger := 0;
                 end;
           end;


        BUS_CD_M_NFE.Post;


        result := 'OK';
        try
          Conn  := BuscarConnBanco;
          Vtran := Conn.BeginTransaction;


          if BUS_CD_M_NFE_INT <> nil then
             if (BUS_CD_M_NFE_INT.ChangeCount > 0) then
                if not (BUS_CD_M_NFE_INT.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar dados de outras notas fiscais.'+#13+
                                BUS_CD_M_NFE_INT.enErro;
                   end;

          if not (BUS_CD_M_NFE.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar dados da nota fiscal.'+#13+
                          BUS_CD_M_NFE.enErro;
             end;

          if FAT_CD_M_PED <> nil then
             if FAT_CD_M_PED.ChangeCount > 0 then
                if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar o pedido de venda.'+#13+
                                FAT_CD_M_PED.enErro;
                   end;

          if OFI_CD_M_ORV <> nil then
             if OFI_CD_M_ORV.ChangeCount > 0 then
                if not (OFI_CD_M_ORV.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar a ordem de servio.'+#13+
                                OFI_CD_M_ORV.enErro;
                   end;

          Conn.CommitFreeAndNil(Vtran);
       finally
          BUS_CD_M_NFE.Free;
          FAT_CD_M_PED_ITE.Free;
          FAT_CD_M_PED.Free;
          BUS_CD_M_NFE_INT.Free;

          Conn.RollbackIncompleteFreeAndNil(Vtran);
       end;
end;

function TSM.enSgqEstatisticaAcr(tipo: integer; Input: OleVariant): OleVariant;
var
   qry:TSqlQuery;
   cdsAcr: TClientDataSet;
   where: string;
begin
  { TODO -oMaxsuel -cCriao : Mtodo criado para atender a tela CSU_FM_M_ACR }
  try
   qry := TSqlQuery.Create(self);
   cdsAcr := TClientDataSet.Create(self);
   cdsAcr.Close;
   cdsAcr.FieldDefs.Clear;
   cdsAcr.FieldDefs.add('codigo',ftInteger);
   cdsAcr.FieldDefs.add('descricao',ftString,80);
   cdsAcr.FieldDefs.add('qtde',ftInteger);
   cdsAcr.CreateDataSet;
   //SM     := TSM.Create(nil);
   qry.SQLConnection := self.conexao;




   qry.Close;
   qry.SQL.Clear;

   where :=  ' where acr.id_empresa = ''' + VarToStr(Input[0]) +''' ' +
             '  and acr.data_atendimento >= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[1])) )  +'''  '+
             '  and acr.data_atendimento <= ''' + FormatDateTime('dd/mm/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';

   case tipo of
      1:
        begin
          // Qtde das reclamaes do perodo'
          qry.SQL.Add('select 1 as codigo, ''a'' as descricao, count(*) qtde from pcp_tb_m_acr acr ' + where);
         // CMServerForm.mm.Lines.Add(qry.SQL.text);
        end;
      2:
        begin
          // Qtde por defeito no perodo
          qry.SQL.Add(' select idt.id_tdf as codigo, tdf.descricao, count(*) qtde from pcp_tb_m_acr_ite_pdt idt  ' +
                      '    left outer join pcp_tb_m_acr acr on (idt.id_acr = acr.id_acr) ' +
                      '    left outer join cad_tb_c_tdf tdf on (tdf.id_tdf = idt.id_tdf) ' +
                      where +
                      ' group by 1,2' +
                      ' order by 1,2');
        end;
      3:
        begin
          qry.SQL.Add(' select 1 as codigo,' + #13#10 +
              ' case cid.uf' + #13#10 +
              '  when ''AC'' then ''Acre''' + #13#10 +
              '  when ''AL'' then ''Alagoas''' + #13#10 +
              '  when ''AP'' then ''Amap''' + #13#10 +
              '  when ''AM'' then ''Amazonas''' + #13#10 +
              '  when ''BA'' then ''Bahia''' + #13#10 +
              '  when ''CE'' then ''Cear''' + #13#10 +
              '  when ''DF'' then ''Distrito Federal''' + #13#10 +
              '  when ''ES'' then ''Esprito Santo''' + #13#10 +
              '  when ''GO'' then ''Gois''' + #13#10 +
              '  when ''MA'' then ''Maranho''' + #13#10 +
              '  when ''MT'' then ''Mato Grosso'' ' + #13#10 +
              '  when ''MS'' then ''Mato Grosso do Sul''' + #13#10 +
              '  when ''MG'' then ''Minas Gerais''' + #13#10 +
              '  when ''PA'' then ''Par''' + #13#10 +
              '  when ''PB'' then ''Paraba''' + #13#10 +
              '  when ''PR'' then ''Paran''' + #13#10 +
              '  when ''PE'' then ''Pernambuco''' + #13#10 +
              '  when ''PI'' then ''Piau'' ' + #13#10 +
              '  when ''RJ'' then ''Rio de Janeiro''' + #13#10 +
              '  when ''RN'' then ''Rio Grande do Norte''' + #13#10 +
              '  when ''RS'' then ''Rio Grande do Sul''' + #13#10 +
              '  when ''RO'' then ''Rondnia''' + #13#10 +
              '  when ''RR'' then ''Roraima''' + #13#10 +
              '  when ''SC'' then ''Santa Catarina''' + #13#10 +
              '  when ''SP'' then ''So Paulo''' + #13#10 +
              '  when ''SE'' then ''Sergipe''' + #13#10 +
              '  when ''TO'' then ''Tocantins''' + #13#10 +
              ' else acr.id_cidade end as descricao, count(*) qtde from pcp_tb_m_acr acr' + #13#10 +
              '   left outer join cad_tb_c_cid cid on (cid.id_cidade = acr.id_cidade)' + #13#10 +
              where +
              ' group by 1,2' + #13#10 +
              ' order by 1,2');
        end;
      4:
        begin
           // Nome dos 03 clientes que mais reclamaram no perodo
          qry.SQL.Add(
              ' select cli.id_cliente as codigo, cli.nome as descricao, count(*) as qtde from pcp_tb_m_acr acr ' +
              '   left outer join cad_tb_c_cli cli on (cli.id_cliente = acr.id_busca_clirep)   ' +
              where +
              ' and acr.tipo_cliente = 0                                                       ' +
              ' group by 1,2                                                                   ' +
              ' order by 3 desc LIMIT 3 ');
        end;
      5:
        begin
          // Qtde de disposio no perodo
          qry.SQL.Add(
             ' select dis.id_dis as codigo, dis.descricao, count(*) as qtde from pcp_tb_m_acr_ite aci ' +
             '    left outer join pcp_tb_m_acr acr on (acr.id_acr = aci.id_acr) ' +
             '    left outer join pcp_tb_c_dis dis on (dis.id_dis = aci.id_dis) ' +
             where +
             ' group by 1,2 ');
        end;
   end;

  qry.Open;
  if not qry.IsEmpty then
     begin
       while not qry.eof do
          begin
            cdsAcr.Insert;
            cdsAcr.FieldByName('codigo').AsInteger := qry.FieldByName('codigo').AsInteger;
            cdsAcr.FieldByName('descricao').AsString := qry.FieldByName('descricao').AsString;
            cdsAcr.FieldByName('qtde').AsInteger := qry.FieldByName('qtde').AsInteger;
            cdsAcr.Post;
            qry.Next;
          end;
       result := cdsAcr.Data;
     end;
  qry.Close;
  cdsAcr.Close;

  finally
     FreeAndNil(qry);
     FreeAndNil(cdsAcr);
     //FreeAndNil(SM);
  end;


end;

function TSM.enSgqExistePistolagem_PcpRomPedIte(IdPedido,
  id_ped_ite: String): Boolean;
var
  qry: TSQLQuery;
  sql: String;
  qtde_conferida: currency;
begin

  // por Maxsuel Victor , 14/03/25
  // Utilizado pela rotina FAT_FM_M_PED ( o mdulo SGQ deve ser igual a true )

  result := false;

  try
    qry := TSqlQuery.Create(self);
    qry.SQLConnection := self.Conexao;

    sql := '';

    qry.Close;
    qry.SQL.Clear;

    sql :=
            ' select qtde_conferida from pcp_tb_m_rom_ped_ite rte ' + #13#10 +
            ' where ' + #13#10 +
            '    id_pedido = ' + IdPedido + #13#10 +
            '    and id_ped_ite = ' + id_ped_ite;
    qry.SQL.Add(sql);
    qry.Open;

    qtde_conferida := 0;

    if not (qry.IsEmpty) then
       begin
          qtde_conferida := qry.FieldByName('qtde_conferida').AsCurrency;
       end;

    qry.Close;

    result := qtde_conferida > 0;
  finally
     if qry <> nil then
        FreeAndNil(qry);
  end;
end;

function TSM.enSgqFatBuscarDescEspPedidos(IdEmpresa,
  pedidos: string): Currency;
var
   BUS_SQ_M_QRY: TSQLDataSet;
   BUS_DP_M_QRY: TDataSetProvider;
begin
   try

     BUS_SQ_M_QRY := TSQLDataSet.Create(nil);
     BUS_SQ_M_QRY.SQLConnection := conexao;
     BUS_SQ_M_QRY.CommandType   := ctQuery;
     BUS_SQ_M_QRY.CommandText   :=
                          ' select coalesce(sum(ped.vlr_desc_especial),0) as vlr_desc_especial_ped ' + #13#10 +
                          ' from fat_tb_m_ped ped ' + #13#10 +
                          ' where ped.id_empresa = ''' + (IdEmpresa) + ''' ' + #13#10 +
                          '   and ped.id_pedido in (' + VarToStr(pedidos) +') ' + #13#10 ;
     result := 0;
     BUS_SQ_M_QRY.Open;

     if not BUS_SQ_M_QRY.IsEmpty then
        begin
          result := BUS_SQ_M_QRY.FieldByName('vlr_desc_especial_ped').AsCurrency;
        end;
     BUS_SQ_M_QRY.close;

     //result :=    BUS_DP_M_QRY.Data;

   finally
     FreeAndNil(BUS_SQ_M_QRY);
  end;
end;

function TSM.enSgqFatJuntarItensDosPedidos(IdEmpresa,pedidos: string): OleVariant;
var
   BUS_SQ_M_QRY: TSQLDataSet;
   BUS_DP_M_QRY: TDataSetProvider;
begin
   try

   BUS_SQ_M_QRY := TSQLDataSet.Create(nil);
   BUS_SQ_M_QRY.SQLConnection := conexao;
   BUS_SQ_M_QRY.CommandType   := ctQuery;
   BUS_SQ_M_QRY.CommandText   :=
                        ' select pid.id_item as cod_ite_producao, ' + #13#10 +
                        '    cast( case                                ' + #13#10 +
                        '        when  coalesce(pid.pcp_obs_item,'''') <> '''' then pid.pcp_obs_item   ' + #13#10 +
                        '    else ite.descricao end as varchar(150)) as item_producao,' + #13#10 +
                        '    0 as codigo, cast( '''' as varchar(80)) as item , ' + #13#10 +
                        '    ite.id_und_venda as und_venda , gru.tipo_item, ' + #13#10 +
                        '    1 as cod_cor, cor.descricao as cor, pid.id_tamanho as cod_tam, ' + #13#10 +
                        '    sum(pid.qtde) as qtde , sum(pid.vlr_liquido) as vlr_liquido, ' + #13#10 +
                        '    sum(pid.vlr_desc_basico) as vlr_desc_basico, sum(pid.vlr_desc_especial) as vlr_desc_especial, ' + #13#10 +
                        '    sum(pid.vlr_bruto) as vlr_bruto, sum(pid.vlr_desconto) as vlr_desconto, ' + #13#10 +
                        '    sum(ped.vlr_liquido) as vlr_liquido_ped, sum(ped.vlr_desc_especial) as vlr_desc_especial_ped ' + #13#10 +
                        ' from fat_tb_m_ped_ite pid ' + #13#10 +
                        '   left outer join fat_tb_m_ped ped on ped.id_pedido = pid.id_pedido  ' + #13#10 +
                        '   left outer join cad_tb_c_ite ite on ite.id_item = pid.id_item ' + #13#10 +
                        '   left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ' + #13#10 +
                        '   left outer join cad_tb_c_cor cor on cor.id_cor = 1 ' + #13#10 +
                        '   left outer join cad_tb_c_tam tam on tam.id_tamanho = 0 ' + #13#10 +
                        ' where ped.id_empresa = ''' + (IdEmpresa) + ''' ' + #13#10 +
                        '   and pid.id_pedido in (' + VarToStr(pedidos) +') ' + #13#10 +
                        ' group by 1,2,3,4,5,6,7,8,9' ;

   BUS_DP_M_QRY := TDataSetProvider.Create(nil);
   BUS_DP_M_QRY.DataSet := BUS_SQ_M_QRY;

   result :=    BUS_DP_M_QRY.Data;

   finally
     FreeAndNil(BUS_SQ_M_QRY);
     FreeAndNil(BUS_DP_M_QRY);
  end;
end;

procedure TSM.enSgqFinBucarDadosCliILC(IdEmpresa,IdCliente: String; var txtPriCompra, txtUltCompra, txtMenorCompra, txtMaiorCompra,  QtdePedidos,
                                       QtdePedidoCancelados,QtdePedidoReprovados, TotalEmCompras,TotalComprasPago,
                                       PedidosDigitados, PedidosEmProducao : String; var cdsOFsPrestCtaAberto,cdsTitPrestAberto,cdsTitAberto,cdsPedQuitados: OleVariant);
var
  BUS_SQ_M_TAB, BUS_SQ_M_TOF, BUS_SQ_M_OFA, BUS_SQ_M_PQT: TSQLDataSet;
  BUS_DP_M_TAB, BUS_DP_M_TOF, BUS_DP_M_OFA, BUS_DP_M_PQT: TDataSetProvider;
  sql: String;
  qry1,qry2: TSQLQuery;
  dtaIni, dtaFim: String;
begin
  { TODO :
     Criado em 19/08/2020,
     Mtodo utilizado pela rotina CSU_FM_C_ILC ( Informaes para liberao do Cliente) }
  try

  txtPriCompra := 'No h compra';
  txtUltCompra := 'No h compra';
  txtMenorCompra := 'No h compra';
  txtMaiorCompra := 'No h compra';
  PedidosDigitados := 'No h';
  PedidosEmProducao := 'No h';
  QtdePedidos  := '0';
  QtdePedidoCancelados := '0';
  QtdePedidoReprovados := '0';
  TotalEmCompras := ' R$ 0,00';

  qry1 := TSqlQuery.Create(self);
  qry1.SQLConnection := self.Conexao;

  qry2 := TSqlQuery.Create(self);
  qry2.SQLConnection := self.Conexao;


  sql := '';


  // Busca 1 compra;
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select ped.*, ors.id_ors, ors.dta_emissao, ors.vlr_liquido as vlr_liquido_of from fat_tb_m_ped ped ' + #13#10 +
             ' left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 3 and ped.situacao_aprovacao = 1  ' +
          '   and ped.dta_pedido in (' + #13#10 +
          '            select min(dta_pedido) from fat_tb_m_ped ' + #13#10 +
          '            where id_empresa = ''' + (IdEmpresa) + ''' and  id_cliente = ''' + (IdCliente) + ''' ' + #13#10 +
          '              and situacao = 3 and situacao_aprovacao = 1 )' +
          ' order by ped.id_pedido limit 1 ';

  qry1.SQL.Add(sql);
  qry1.SQL.text;
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       txtPriCompra := 'Pedido: ' + qry1.FieldByName('id_pedido').AsString + '  -  ' +
              'Data: ' + qry1.FieldByName('dta_pedido').AsString + '  -  ' +
              'O.F: ' + qry1.FieldByName('id_ors').AsString + '  -  ' +
              'Faturado em: ' + qry1.FieldByName('dta_emissao').AsString + '  -  ' +
              'Valor: ' + FormatCurr('###,###,###,##0.00', qry1.FieldByName('vlr_liquido_of').AsCurrency);
     end;
  qry1.close;


  sql := '';
   // Busca ltima compra;
  qry2.Close;
  qry2.SQL.Clear;
  sql :=  ' select ped.*, ors.id_ors, ors.dta_emissao, ors.vlr_liquido as vlr_liquido_of from fat_tb_m_ped ped ' + #13#10 +
             ' left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 3 and ped.situacao_aprovacao = 1  ' +
          '   and ped.dta_pedido in (' + #13#10 +
          '            select max(dta_pedido) from fat_tb_m_ped ' + #13#10 +
          '            where id_empresa = ''' + (IdEmpresa) + ''' and  id_cliente = ''' + (IdCliente) + ''' ' + #13#10 +
          '              and situacao = 3 and situacao_aprovacao = 1 )' +
          ' order by ped.id_pedido desc limit 1 ';

  qry2.SQL.Add(sql);
  qry2.Open;
  if not (qry2.IsEmpty) then
     begin
       txtUltCompra := 'Pedido: ' + qry2.FieldByName('id_pedido').AsString + '  -  ' +
              'Data: ' + qry2.FieldByName('dta_pedido').AsString + '  -  ' +
              'O.F: ' + qry2.FieldByName('id_ors').AsString + '  -  ' +
              'Faturado em: ' + qry2.FieldByName('dta_emissao').AsString + '  -  ' +
              'Valor: ' + FormatCurr('###,###,###,##0.00',  qry2.FieldByName('vlr_liquido_of').AsCurrency);
     end;
  qry2.close;


    // Busca Menor compra;
  qry2.Close;
  qry2.SQL.Clear;
  sql :=  ' select ped.*, ors.id_ors, ors.dta_emissao, ors.vlr_liquido as vlr_liquido_of from fat_tb_m_ped ped ' + #13#10 +
             ' left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 3 and ped.situacao_aprovacao = 1  ' +
          '   and ped.vlr_liquido in (' + #13#10 +
          '            select min(vlr_liquido) from fat_tb_m_ped ' + #13#10 +
          '            where id_empresa = ''' + (IdEmpresa) + ''' and  id_cliente = ''' + (IdCliente) + ''' ' + #13#10 +
          '              and situacao = 3 and situacao_aprovacao = 1 )' +
          ' order by ped.id_pedido desc limit 1 ';

  qry2.SQL.Add(sql);
  qry2.Open;
  if not (qry2.IsEmpty) then
     begin
       txtMenorCompra := 'Pedido: ' + qry2.FieldByName('id_pedido').AsString + '  -  ' +
              'Data: ' + qry2.FieldByName('dta_pedido').AsString + '  -  ' +
              'O.F: ' + qry2.FieldByName('id_ors').AsString + '  -  ' +
              'Faturado em: ' + qry2.FieldByName('dta_emissao').AsString + '  -  ' +
              'Valor: ' + FormatCurr('###,###,###,##0.00',  qry2.FieldByName('vlr_liquido_of').AsCurrency);
     end;
  qry2.close;


    // Busca Maior compra;
  qry2.Close;
  qry2.SQL.Clear;
  sql :=  ' select ped.*, ors.id_ors, ors.dta_emissao, ors.vlr_liquido as vlr_liquido_of from fat_tb_m_ped ped ' + #13#10 +
             ' left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 3 and ped.situacao_aprovacao = 1  ' +
          '   and ped.vlr_liquido in (' + #13#10 +
          '            select max(vlr_liquido) from fat_tb_m_ped ' + #13#10 +
          '            where id_empresa = ''' + (IdEmpresa) + ''' and  id_cliente = ''' + (IdCliente) + ''' ' + #13#10 +
          '              and situacao = 3 and situacao_aprovacao = 1 )' +
          ' order by ped.id_pedido desc limit 1 ';

  qry2.SQL.Add(sql);
  qry2.Open;
  if not (qry2.IsEmpty) then
     begin
       txtMaiorCompra := 'Pedido: ' + qry2.FieldByName('id_pedido').AsString + '  -  ' +
              'Data: ' + qry2.FieldByName('dta_pedido').AsString + '  -  ' +
              'O.F: ' + qry2.FieldByName('id_ors').AsString + '  -  ' +
              'Faturado em: ' + qry2.FieldByName('dta_emissao').AsString + '  -  ' +
              'Valor: ' + FormatCurr('###,###,###,##0.00',  qry2.FieldByName('vlr_liquido_of').AsCurrency);
     end;
  qry2.close;


  sql := '';
   // Qtde de pedidos e valor total de compras
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select count(ped.*) qtde_pedidos, sum(ors.vlr_liquido) vlr_total_compras from fat_tb_m_ped ped ' + #13#10 +
          '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 3 and ped.situacao_aprovacao = 1 ';
  qry1.SQL.Add(sql);
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       QtdePedidos    := qry1.FieldByName('qtde_pedidos').AsString;
       TotalEmCompras := FormatCurr('###,###,###,##0.00', qry1.FieldByName('vlr_total_compras').AsCurrency);
     end;
  qry1.close;

  // Busca total de compras pago;
  qry2.Close;
  qry2.SQL.Clear;
  sql :=
    ' select ped.id_cliente, sum(nnn.vlr_parcela) vlr_total_pago  from fat_tb_m_ped ped' + #13#10 +
    '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido' + #13#10 +
    '   inner join (select rrr.id_ors, coalesce(sum(rcc.vlr_saldo),0) vlr_saldo, coalesce(sum(rcc.vlr_parcela),0) vlr_parcela from fin_tb_m_rec rcc' + #13#10 +
    '                           inner join fat_tb_m_nfe nfe on nfe.id_fiscal = rcc.id_fiscal  ' + #13#10 +
    '                           inner join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors ' + #13#10 +
    '                           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rcc.id_forma_pag  ' + #13#10 +
    '                    where  (fpg.sgq_prestacao_conta = true and rcc.vlr_parcela <> rcc.vlr_saldo) ' +
    '                       or  (fpg.doc_impresso = 4 and rcc.vlr_parcela <> rcc.vlr_saldo) ' +
    '                    group by rrr.id_ors ) nnn on nnn.id_ors = ors.id_ors' + #13#10 +
    ' where ped.situacao = 3 ' + #13#10 +
    '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
    '   and ped.id_cliente = ''' + (IdCliente) + ''' ' +
    '   and ors.dta_emissao >= ''01/01/0001'' '+
    ' group by 1' + #13#10 ;
    //' having ' + #13#10 +
    //'     nnn.vlr_saldo = 0 ';
  qry2.SQL.Add(sql);
  qry2.Open;
  if not (qry2.IsEmpty) then
     begin
       TotalComprasPago := FormatCurr('###,###,###,##0.00', qry2.FieldByName('vlr_total_pago').AsCurrency);
     end;
  qry2.close;

    sql := '';
   // Qtde de pedidos cancelados;
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select count(*) qtde_pedidos from fat_tb_m_ped ped ' + #13#10 +
          '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 4 ';
  qry1.SQL.Add(sql);
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       QtdePedidoCancelados := qry1.FieldByName('qtde_pedidos').AsString;
     end;
  qry1.close;


  sql := '';
   // Qtde de pedidos reprovados;
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select count(*) qtde_pedidos from fat_tb_m_ped ped ' + #13#10 +
          '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido ' +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 1 ';
  qry1.SQL.Add(sql);
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       QtdePedidoReprovados := qry1.FieldByName('qtde_pedidos').AsString;
     end;
  qry1.close;


  sql := '';
  // Pedidos em situao digitigados;
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select id_pedido, vlr_liquido  from fat_tb_m_ped ped ' + #13#10 +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 0 and  ped.situacao_aprovacao in (0,1)  ';
  qry1.SQL.Add(sql);
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       PedidosDigitados := '';
       qry1.First;
       while not qry1.eof do
          begin
            PedidosDigitados := PedidosDigitados +
            qry1.FieldByName('id_pedido').AsString + ' - ' +
               FormatCurr('R$ ###,###,###,##0.00',  qry1.FieldByName('vlr_liquido').AsCurrency) +
               ';  ';
            qry1.Next;
          end;
     end;
  qry1.close;

  sql := '';
  // Pedidos em situao em produo;
  qry1.Close;
  qry1.SQL.Clear;
  sql :=  ' select id_pedido , vlr_liquido from fat_tb_m_ped ped ' + #13#10 +
          ' where ped.id_cliente = ''' + (IdCliente) + ''' ' +
          '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
          '   and ped.situacao = 2 and  ped.situacao_aprovacao in (0,1)  ';
  qry1.SQL.Add(sql);
  qry1.Open;
  if not (qry1.IsEmpty) then
     begin
       PedidosEmProducao := '';
       qry1.First;
       while not qry1.eof do
          begin
            PedidosEmProducao := PedidosEmProducao +
                 qry1.FieldByName('id_pedido').AsString + ' - ' +
                 FormatCurr('R$ ###,###,###,##0.00',  qry1.FieldByName('vlr_liquido').AsCurrency) +
                  ';  ';
            qry1.next;
          end;
     end;
  qry1.close;

  //*** Ttulos em aberto depois de prestado conta e sem ser cheque devolvido ******/

      {situaes do cheque no fin_tb_m_rec
      1 - Em aberto
      2 - Depositado
      3 - Devolvido
      4 - Parcial
      5 - Resgatado
      6 - Compensado}

      BUS_SQ_M_TAB := TSQLDataSet.Create(nil);
      BUS_SQ_M_TAB.SQLConnection := conexao;
      BUS_SQ_M_TAB.CommandType   := ctQuery;
      BUS_SQ_M_TAB.CommandText   :=

                      ' select fpg.descricao, ' +
                      ' cast ( case fpg.doc_impresso ' +
                      '          when 6 then cast(rec.che_cheque as varchar(20)) ' +
                      '        else rec.num_parcela end as varchar(20) ) as num_parcela, ' +
                      ' rec.dta_vencimento, rec.vlr_saldo, ' +
                      ' cast(case situacao_chq ' +
                      '   when 1 then ''Em aberto''   ' +
                      '   when 2 then ''Depositado''  ' +
                      '   when 3 then ''Devolvido''   ' +
                      '   when 4 then ''Parcial''     ' +
                      '   when 5 then ''Resgatado''   ' +
                      '   when 6 then ''Compensado''  ' +
                      '  else ''?????'' end as varchar(20)) situacao_chq, nfe.id_ors ' +
                      ' from fin_tb_m_rec rec' + #13#10 +
                      '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' +
                      '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' +
                      ' where coalesce(fpg.sgq_prestacao_conta,false) = false ' + #13#10 +
                      '   and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
                      '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                      //'   and rec.dta_vencimento >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                      // '   and rec.dta_vencimento <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                      '   and rec.vlr_saldo > 0 ' +
                      '   and coalesce(rec.situacao_chq,0) not in (1,3) ' +
                      ' order by nfe.id_ors desc,  rec.dta_vencimento, rec.num_parcela ';

      BUS_DP_M_TAB := TDataSetProvider.Create(nil);
      BUS_DP_M_TAB.DataSet := BUS_SQ_M_TAB;

      cdsTitAberto := BUS_DP_M_TAB.data;




  //*** Pedido de venda faturado e que a prestao de conta est em aberto ******/
  BUS_SQ_M_OFA := TSQLDataSet.Create(nil);
  BUS_SQ_M_OFA.SQLConnection := conexao;
  BUS_SQ_M_OFA.CommandType   := ctQuery;
  BUS_SQ_M_OFA.CommandText   :=
                  ' select ors.id_ors, ors.dta_emissao, ped.id_pedido, ped.vlr_liquido,nnn.vlr_saldo from fat_tb_m_ped ped' + #13#10 +
                  '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido' + #13#10 +
                  '   left outer join (select rrr.id_ors, coalesce(sum(rcc.vlr_saldo),0) vlr_saldo from fin_tb_m_rec rcc' + #13#10 +
                  '                           inner join fat_tb_m_nfe nfe on nfe.id_fiscal = rcc.id_fiscal  ' + #13#10 +
                  '                           inner join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors ' + #13#10 +
                  '                           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rcc.id_forma_pag  ' + #13#10 +
                  '                    where  fpg.sgq_prestacao_conta = true ' +
                  '                    group by rrr.id_ors ) nnn on nnn.id_ors = ors.id_ors' + #13#10 +
                  ' where ped.situacao = 3 ' + #13#10 +
                  '   and ped.id_empresa = ''' + (IdEmpresa) + ''' ' +
                  '   and ped.id_cliente = ''' + (IdCliente) + ''' ' +
                  '   and ors.dta_emissao >= ''01/01/0001'' '+
                  ' group by 1,2,3,4,5' + #13#10 +
                  ' having ' + #13#10 +
                  '     nnn.vlr_saldo <> 0 ' + #13#10 +
                  ' order by ors.id_ors desc';

  BUS_DP_M_OFA := TDataSetProvider.Create(nil);
  BUS_DP_M_OFA.DataSet := BUS_SQ_M_OFA;

  cdsOFsPrestCtaAberto := BUS_DP_M_OFA.data;




  //*** Ttulos dos Pedido de venda faturado e que a prestado de conta est em aberto ******/
  BUS_SQ_M_TOF := TSQLDataSet.Create(nil);
  BUS_SQ_M_TOF.SQLConnection := conexao;
  BUS_SQ_M_TOF.CommandType   := ctQuery;
  BUS_SQ_M_TOF.CommandText   :=
'      select rec.id_baixa,rrr.id_pedido pedido, fun.nome as representante, rrr.id_ors as of, rrr.dta_emissao , rrr.vlr_liquido vlr_liquido_of, ' + #13#10 +
'             fpg.descricao forma_pagamento, cast ( case fpg.doc_impresso ' + #13#10 +
'             when 6 then cast(rec.che_cheque as varchar(20))' + #13#10 +
'             else rec.num_parcela end as varchar(20) ) as num_parcela, ' + #13#10 +
'             rec.dta_vencimento, rec.vlr_parcela, rec.vlr_saldo, ' + #13#10 +
'             cast(case situacao_chq' + #13#10 +
'                when 1 then ''Em aberto''' + #13#10 +
'                when 2 then ''Depositado''' + #13#10 +
'                when 3 then ''Devolvido''' + #13#10 +
'                when 4 then ''Parcial''' + #13#10 +
'                when 5 then ''Resgatado''' + #13#10 +
'                when 6 then ''Compensado''' + #13#10 +
'             else ''-'' end as varchar(15)) situacao_chq ' + #13#10 +
'      from fin_tb_m_rec rec' + #13#10 +
'           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' + #13#10 +
'           left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' + #13#10 +
'           inner join      pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors                         ' + #13#10 +
'           inner join      fat_tb_m_ped ped on ped.id_pedido = rrr.id_pedido' + #13#10 +
'           left outer join cad_tb_c_fun fun on fun.id_funcionario = ped.id_vendedor' + #13#10 +
'      where coalesce(fpg.sgq_prestacao_conta,false) = true ' + #13#10 +
'            and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'            and rec.id_cliente = ''' + (IdCliente) + ''' ' +
//'            and rec.dta_vencimento >= ''01/01/2020''' + #13#10 +
//'            and rec.dta_vencimento <= ''31/12/2020''' + #13#10 +
'            and rec.id_fiscal in  ' + #13#10 +
'                (' + #13#10 +
'                 select rec.id_fiscal' + #13#10 +
'                 from fin_tb_m_rec rec' + #13#10 +
'                     left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' + #13#10 +
'                     left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' + #13#10 +
'                     inner join      pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors' + #13#10 +
'                 where coalesce(fpg.sgq_prestacao_conta,false) = true ' + #13#10 +
'                   and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'                   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
//'                   and rec.dta_vencimento >= ''01/01/2020''' + #13#10 +
//'                   and rec.dta_vencimento <= ''31/12/2020''' + #13#10 +
'                   and rec.vlr_saldo > 0                                                  ' + #13#10 +
'                 group by 1' + #13#10 +
'                          )                                         ' + #13#10 +
'      order by rrr.id_pedido desc, rec.dta_vencimento, rec.num_parcela';

  BUS_DP_M_TOF := TDataSetProvider.Create(nil);
  BUS_DP_M_TOF.DataSet := BUS_SQ_M_TOF;

  cdsTitPrestAberto := BUS_DP_M_TOF.data;


  //*** Ttulos dos Pedido de venda faturado e que j foi quitado a 1 ano ******/

  dtaIni:=  DateToStr(Date-365);
  dtaFim:=  DateToStr(Date);


  BUS_SQ_M_PQT := TSQLDataSet.Create(nil);
  BUS_SQ_M_PQT.SQLConnection := conexao;
  BUS_SQ_M_PQT.CommandType   := ctQuery;
  BUS_SQ_M_PQT.CommandText   :=
'      select rec.id_baixa, rrr.id_pedido pedido, fun.nome as representante, rrr.id_ors as of, rrr.dta_emissao , rrr.vlr_liquido vlr_liquido_of, ' + #13#10 +
'             fpg.descricao forma_pagamento, cast ( case fpg.doc_impresso ' + #13#10 +
'             when 6 then cast(rec.che_cheque as varchar(20))' + #13#10 +
'             else rec.num_parcela end as varchar(20) ) as num_parcela, ' + #13#10 +
'             rec.dta_vencimento, rec.vlr_parcela, rec.vlr_saldo, ' + #13#10 +
'             cast(case situacao_chq' + #13#10 +
'                when 1 then ''Em aberto''' + #13#10 +
'                when 2 then ''Depositado''' + #13#10 +
'                when 3 then ''Devolvido''' + #13#10 +
'                when 4 then ''Parcial''' + #13#10 +
'                when 5 then ''Resgatado''' + #13#10 +
'                when 6 then ''Compensado''' + #13#10 +
'             else ''-'' end as varchar(15)) situacao_chq ' + #13#10 +
'      from fin_tb_m_rec rec' + #13#10 +
'           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' + #13#10 +
'           left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' + #13#10 +
'           left outer join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors                         ' + #13#10 +
'           left outer join fat_tb_m_ped ped on ped.id_pedido = rrr.id_pedido' + #13#10 +
'           left outer join cad_tb_c_fun fun on fun.id_funcionario = ped.id_vendedor' + #13#10 +
'      where (coalesce(fpg.sgq_prestacao_conta,false) = true ' + #13#10 +
'             and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'             and rec.id_cliente = ''' + (IdCliente) + ''' ' +
'             and nfe.dta_emissao >= ''' + (DtaIni) + ''' ' +
'             and nfe.dta_emissao <= ''' + (DtaFim) + ''' ' +
{'             and rec.id_fiscal not in  ' + #13#10 +
'                (' + #13#10 +
'                 select rec.id_fiscal' + #13#10 +
'                 from fin_tb_m_rec rec' + #13#10 +
'                     left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' + #13#10 +
'                     left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' + #13#10 +
'                     inner join      pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors' + #13#10 +
'                 where coalesce(fpg.sgq_prestacao_conta,false) = true ' + #13#10 +
'                   and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'                   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
'                   and rec.vlr_saldo > 0                                                 ' + #13#10 +
'                 group by 1' + #13#10 +
'                          )                                         ' + #13#10 + }
'            )                                         ' + #13#10 +

'      or ( (coalesce(fpg.sgq_prestacao_conta,false) = false and fpg.doc_impresso = 4)' + #13#10 +
'             and fpg.doc_impresso = 4 ' +
'             and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'             and rec.id_cliente = ''' + (IdCliente) + ''' ' +
'             and rec.dta_vencimento >= ''' + (DtaIni) + ''' ' +
//'             and rec.vlr_saldo > 0 ' +
{'             and rec.id_fiscal in  ' + #13#10 +
'                (' + #13#10 +
'                 select rec.id_fiscal' + #13#10 +
'                 from fin_tb_m_rec rec' + #13#10 +
'                     left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' + #13#10 +
'                     left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' + #13#10 +
'                     left outer join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors' + #13#10 +
'                 where coalesce(fpg.sgq_prestacao_conta,false) = false ' + #13#10 +
'                   and rec.id_empresa = ''' + (IdEmpresa) + ''' ' +
'                   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
'                   and rec.vlr_saldo > 0                                                 ' + #13#10 +
'                 group by 1' + #13#10 +
'                          )                                         ' + #13#10 + }
'            )                                         ' + #13#10 +

'      order by rrr.id_pedido desc, rec.dta_vencimento, rec.num_parcela';

  BUS_DP_M_PQT := TDataSetProvider.Create(nil);
  BUS_DP_M_PQT.DataSet := BUS_SQ_M_PQT;

  cdsPedQuitados := BUS_DP_M_PQT.data;

  finally
    FreeAndNil(BUS_SQ_M_PQT);
    FreeAndNil(BUS_SQ_M_TOF);
    FreeAndNil(BUS_SQ_M_OFA);
    FreeAndNil(BUS_DP_M_TOF);
    FreeAndNil(BUS_DP_M_OFA);
    FreeAndNil(qry1);
    FreeAndNil(qry2);
  end;
end;

procedure TSM.enSgqFinBucarDadosFin(DataIni, DataFim, IdCliente: String;
  var cdsTitPrestAberto, cdsTitAberto, cdsChqDev, cdsTitPag,cdsChqDepositar: OleVariant);
var
  BUS_SQ_M_TAB, BUS_SQ_M_CHD, BUS_SQ_M_BXT, BUS_SQ_M_CHP : TSQLDataSet;
  BUS_DP_M_TAB, BUS_DP_M_CHD, BUS_DP_M_BXT, BUS_DP_M_CHP: TDataSetProvider;
begin
  { TODO -oMaxsuel -cCriao : Mtodo criado em 02/05/2018}

  try

      //*** Ttulos em aberto depois de prestado conta e sem ser cheque devolvido ******/

      {situaes do cheque no fin_tb_m_rec
      1 - Em aberto
      2 - Depositado
      3 - Devolvido
      4 - Parcial
      5 - Resgatado
      6 - Compensado}

      BUS_SQ_M_TAB := TSQLDataSet.Create(nil);
      BUS_SQ_M_TAB.SQLConnection := conexao;
      BUS_SQ_M_TAB.CommandType   := ctQuery;
      BUS_SQ_M_TAB.CommandText   :=

                      ' select fpg.descricao, ' +
                      ' cast ( case fpg.doc_impresso ' +
                      '          when 6 then cast(rec.che_cheque as varchar(20)) ' +
                      '        else rec.num_parcela end as varchar(20) ) as num_parcela, ' +
                      ' rec.dta_vencimento, rec.vlr_saldo, ' +
                      ' case situacao_chq ' +
                      '   when 1 then ''Em aberto''   ' +
                      '   when 2 then ''Depositado''  ' +
                      '   when 3 then ''Devolvido''   ' +
                      '   when 4 then ''Parcial''     ' +
                      '   when 5 then ''Resgatado''   ' +
                      '   when 6 then ''Compensado''  ' +
                      '  else ''?????'' end as situacao_chq, nfe.id_ors ' +
                      ' from fin_tb_m_rec rec' + #13#10 +
                      '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' +
                      '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' +
                      ' where coalesce(fpg.sgq_prestacao_conta,false) = false ' + #13#10 +
                      '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                      '   and rec.dta_vencimento >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                      '   and rec.dta_vencimento <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                      '   and rec.vlr_saldo > 0 ' +
                      '   and coalesce(rec.situacao_chq,0) not in (1,3) ' +
                      ' order by rec.dta_vencimento, rec.num_parcela ';

      BUS_DP_M_TAB := TDataSetProvider.Create(nil);
      BUS_DP_M_TAB.DataSet := BUS_SQ_M_TAB;

      cdsTitAberto := BUS_DP_M_TAB.data;

      //*** Cheques em aberto depois de prestado conta e somente cheque devolvido ******/

      {situaes do cheque no fin_tb_m_rec
      1 - Em aberto
      2 - Depositado
      3 - Devolvido
      4 - Parcial
      5 - Resgatado
      6 - Compensado}

      BUS_SQ_M_CHD := TSQLDataSet.Create(nil);
      BUS_SQ_M_CHD.SQLConnection := conexao;
      BUS_SQ_M_CHD.CommandType   := ctQuery;
      BUS_SQ_M_CHD.CommandText   :=

                      ' select fpg.descricao,rec.che_cheque,rec.dta_vencimento, rec.vlr_saldo ' +
                      ' from fin_tb_m_rec rec' + #13#10 +
                      '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' +
                      ' where coalesce(fpg.sgq_prestacao_conta,false) = false ' + #13#10 +
                      '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                      '   and rec.dta_vencimento >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                      '   and rec.dta_vencimento <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                      '   and rec.vlr_saldo > 0 ' +
                      '   and rec.situacao_chq = 3 ' +
                      ' order by rec.dta_vencimento, rec.num_parcela ';

      BUS_DP_M_CHD := TDataSetProvider.Create(nil);
      BUS_DP_M_CHD.DataSet := BUS_SQ_M_CHD;

      cdsChqDev := BUS_DP_M_CHD.data;

      //*** Ttulos/Cheques com baixas (seja parcial ou total) e menos as substituies ******/

      {situaes do cheque no fin_tb_m_rec
      1 - Em aberto
      2 - Depositado
      3 - Devolvido
      4 - Parcial
      5 - Resgatado
      6 - Compensado}

      BUS_SQ_M_BXT := TSQLDataSet.Create(nil);
      BUS_SQ_M_BXT.SQLConnection := conexao;
      BUS_SQ_M_BXT.CommandType   := ctQuery;
      BUS_SQ_M_BXT.CommandText   :=

                      ' select fpg.descricao, ' +
                      ' cast ( case fpg.doc_impresso ' +
                      '          when 6 then cast(rec.che_cheque as varchar(20)) ' +
                      '        else rec.num_parcela end as varchar(20) ) as num_parcela, ' +
                      ' rpg.dta_pagamento, rpg.vlr_pagamento ' +
                      ' from fin_tb_m_rec_pag rpg' + #13#10 +
                      '   left outer join fin_tb_m_rec rec on rec.id_titulo = rpg.id_titulo ' +
                      '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rpg.id_forma_pag ' +
                      ' where coalesce(rpg.com_substituicao,false) = false ' + #13#10 +
                      '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                      '   and rpg.dta_pagamento >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                      '   and rpg.dta_pagamento <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                      ' order by rpg.dta_pagamento desc, rec.num_parcela ';

      BUS_DP_M_BXT := TDataSetProvider.Create(nil);
      BUS_DP_M_BXT.DataSet := BUS_SQ_M_BXT;

      cdsTitPag := BUS_DP_M_BXT.data;


       //*** Cheques somente em aberto ******/

      {situaes do cheque no fin_tb_m_rec
      1 - Em aberto
      2 - Depositado
      3 - Devolvido
      4 - Parcial
      5 - Resgatado
      6 - Compensado}

      BUS_SQ_M_CHP := TSQLDataSet.Create(nil);
      BUS_SQ_M_CHP.SQLConnection := conexao;
      BUS_SQ_M_CHP.CommandType   := ctQuery;
      BUS_SQ_M_CHP.CommandText   :=

                      ' select fpg.descricao,rec.che_cheque,rec.dta_vencimento, rec.vlr_saldo ' +
                      ' from fin_tb_m_rec rec' + #13#10 +
                      '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' +
                      ' where coalesce(fpg.sgq_prestacao_conta,false) = false ' + #13#10 +
                      '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                      '   and rec.dta_vencimento >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                      '   and rec.dta_vencimento <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                      '   and rec.vlr_saldo > 0 ' +
                      '   and rec.situacao_chq = 1 ' +
                      ' order by rec.dta_vencimento, rec.num_parcela ';

      BUS_DP_M_CHP := TDataSetProvider.Create(nil);
      BUS_DP_M_CHP.DataSet := BUS_SQ_M_CHP;

      cdsChqDepositar := BUS_DP_M_CHP.data;

  finally
     FreeAndNil(BUS_SQ_M_TAB);
     FreeAndNil(BUS_SQ_M_CHD);
     FreeAndNil(BUS_SQ_M_BXT);
     FreeAndNil(BUS_DP_M_TAB);
     FreeAndNil(BUS_DP_M_CHD);
     FreeAndNil(BUS_DP_M_BXT);
     FreeAndNil(BUS_SQ_M_CHP);
  end;


end;

procedure TSM.enSgqFinBucarDadosOFs(DataIni,DataFim,IdCliente: String;
  var cdsOFs,cdsOFsPrestCta,cdsOFsPrestCtaAberto,cdsTitPrestAberto : OleVariant);
var
  qry1,qry2: TSQLQuery;

  BUS_SQ_M_TPC, BUS_SQ_M_OFS, BUS_SQ_M_OFP, BUS_SQ_M_OFA: TSQLDataSet;
  BUS_DP_M_TPC, BUS_DP_M_OFS, BUS_DP_M_OFP, BUS_DP_M_OFA: TDataSetProvider;
begin
  { TODO -oMaxsuel -cCriao : Mtodo criado em 26/04/2018}


  //*** Ttulos a prestar conta ******/
  BUS_SQ_M_TPC := TSQLDataSet.Create(nil);
  BUS_SQ_M_TPC.SQLConnection := conexao;
  BUS_SQ_M_TPC.CommandType   := ctQuery;
  BUS_SQ_M_TPC.CommandText   :=

                  ' select fpg.descricao,rec.num_parcela,rec.dta_vencimento, rec.vlr_saldo, nfe.id_ors from fin_tb_m_rec rec' + #13#10 +
                  '   left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rec.id_forma_pag ' +
                  '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' +
                  ' where ' +
                  '   sgq_prestacao_conta = true ' + #13#10 +
                  '   and rec.id_cliente = ''' + (IdCliente) + ''' ' +
                  '   and rec.dta_emissao >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                  '   and rec.dta_emissao <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                  '   and rec.vlr_saldo > 0 ' +
                  ' order by rec.dta_vencimento, rec.num_parcela ';

  BUS_DP_M_TPC := TDataSetProvider.Create(nil);
  BUS_DP_M_TPC.DataSet := BUS_SQ_M_TPC;

  cdsTitPrestAberto := BUS_DP_M_TPC.data;


  //*** pedido de venda faturado ******/
  BUS_SQ_M_OFS := TSQLDataSet.Create(nil);
  BUS_SQ_M_OFS.SQLConnection := conexao;
  BUS_SQ_M_OFS.CommandType   := ctQuery;
  BUS_SQ_M_OFS.CommandText   :=
                                ' select ors.id_ors, ors.dta_emissao, ped.id_pedido, ped.vlr_liquido from fat_tb_m_ped ped' + #13#10 +
                                '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido   ' + #13#10 +
                                ' where ped.situacao = 3 ' + #13#10 +
                                '   and ped.id_cliente = ''' + (IdCliente) + ''' ' +
                                '   and ors.dta_emissao >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                                '   and ors.dta_emissao <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                                ' order by ors.dta_emissao desc ';
  BUS_DP_M_OFS := TDataSetProvider.Create(nil);
  BUS_DP_M_OFS.DataSet := BUS_SQ_M_OFS;

  cdsOFs := BUS_DP_M_OFS.data;


  //*** pedido de venda faturado e que foi prestado conta ******/
  BUS_SQ_M_OFP := TSQLDataSet.Create(nil);
  BUS_SQ_M_OFP.SQLConnection := conexao;
  BUS_SQ_M_OFP.CommandType   := ctQuery;
  BUS_SQ_M_OFP.CommandText   :=
                  ' select ors.id_ors, ors.dta_emissao, ped.id_pedido, ped.vlr_liquido,nnn.vlr_saldo from fat_tb_m_ped ped' + #13#10 +
                  '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido' + #13#10 +
                  '   left outer join (select rrr.id_ors, coalesce(sum(rcc.vlr_saldo),0) vlr_saldo from fin_tb_m_rec rcc' + #13#10 +
                  '                           inner join fat_tb_m_nfe nfe on nfe.id_fiscal = rcc.id_fiscal  ' + #13#10 +
                  '                           inner join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors' + #13#10 +
                  '                           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rcc.id_forma_pag  ' + #13#10 +
                  '                    where  fpg.sgq_prestacao_conta = true ' +
                  '                    group by rrr.id_ors ) nnn on nnn.id_ors = ors.id_ors' + #13#10 +
                  ' where ped.situacao = 3 ' + #13#10 +
                  '   and ped.id_cliente = ''' + (IdCliente) + ''' ' +
                  '   and ors.dta_emissao >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                  '   and ors.dta_emissao <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                  ' group by 1,2,3,4,5' + #13#10 +
                  ' having ' + #13#10 +
                  '     nnn.vlr_saldo = 0 ' + #13#10 +
                  ' order by ors.id_ors desc';
  BUS_DP_M_OFP := TDataSetProvider.Create(nil);
  BUS_DP_M_OFP.DataSet := BUS_SQ_M_OFP;

  cdsOFsPrestCta := BUS_DP_M_OFP.data;


  //*** pedido de venda faturado e que a prestado de  conta est em aberto ******/
  BUS_SQ_M_OFA := TSQLDataSet.Create(nil);
  BUS_SQ_M_OFA.SQLConnection := conexao;
  BUS_SQ_M_OFA.CommandType   := ctQuery;
  BUS_SQ_M_OFA.CommandText   :=

                  ' select ors.id_ors, ors.dta_emissao, ped.id_pedido, ped.vlr_liquido,nnn.vlr_saldo from fat_tb_m_ped ped' + #13#10 +
                  '   left outer join pcp_tb_m_ors ors on ors.id_pedido = ped.id_pedido' + #13#10 +
                  '   left outer join (select rrr.id_ors, coalesce(sum(rcc.vlr_saldo),0) vlr_saldo from fin_tb_m_rec rcc' + #13#10 +
                  '                           inner join fat_tb_m_nfe nfe on nfe.id_fiscal = rcc.id_fiscal  ' + #13#10 +
                  '                           inner join pcp_tb_m_ors rrr on rrr.id_ors = nfe.id_ors ' + #13#10 +
                  '                           left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = rcc.id_forma_pag  ' + #13#10 +
                  '                    where  fpg.sgq_prestacao_conta = true ' +
                  '                    group by rrr.id_ors ) nnn on nnn.id_ors = ors.id_ors' + #13#10 +
                  ' where ped.situacao = 3 ' + #13#10 +
                  '   and ped.id_cliente = ''' + (IdCliente) + ''' ' +
                  '   and ors.dta_emissao >= '''+FormatDateTime(CFormatoData, StrToDate(DataIni))+''' '+
                  '   and ors.dta_emissao <= '''+FormatDateTime(CFormatoData, StrToDate(DataFim))+''' '+
                  ' group by 1,2,3,4,5' + #13#10 +
                  ' having ' + #13#10 +
                  '     nnn.vlr_saldo <> 0 ' + #13#10 +
                  ' order by ors.id_ors desc';

  BUS_DP_M_OFA := TDataSetProvider.Create(nil);
  BUS_DP_M_OFA.DataSet := BUS_SQ_M_OFA;

  cdsOFsPrestCtaAberto := BUS_DP_M_OFA.data;

end;

procedure TSM.enSgqFinBuscarOprOppComSaida(op_inicial: String;
  var cdsOpsOpp: OleVariant);
var
  BUS_SQ_M_OPR_INT: TSQLDataSet;
  BUS_DP_M_OPR_INT: TDataSetProvider;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 06/12/2018}


  BUS_SQ_M_OPR_INT := TSQLDataSet.Create(nil);
  BUS_SQ_M_OPR_INT.SQLConnection := conexao;
  BUS_SQ_M_OPR_INT.CommandType   := ctQuery;
  BUS_SQ_M_OPR_INT.CommandText   :=

                  '        select opp.id_opr, opp.id_item, ite.descricao , opp.id_cor,' + #13#10 +
                  '             coalesce(pft.qtde_saida,0) as qtde_saida,' + #13#10 +
                  '             sum(opp.qtde_a_produzir) qtde_a_produzir, sum(opp.qtde_produzida) qtde_produzida ' + #13#10 +
                  '        from pcp_tb_m_opr_opp opp' + #13#10 +
                  '          left outer join cad_tb_c_ite ite on ite.id_item = opp.id_item' + #13#10 +
                  '          left outer join cad_tb_c_cor cor on cor.id_cor = opp.id_cor' + #13#10 +
                  '          left outer join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr ' + #13#10 +
                  '          left outer join ' + #13#10 +
                  '             (select pid.id_opr_etq, pid.id_item, pid.id_cor, pid.id_tamanho, count(*) as qtde_saida from pcp_tb_m_rom_ped_icf pid               ' + #13#10 +
                  '              group by 1,2,3,4)  pft on ' + #13#10 +
                  '                                 pft.id_opr_etq = opr.id_opr and' + #13#10 +
                  '                                 pft.id_item    = opp.id_item and' + #13#10 +
                  '                                 pft.id_cor     =  opp.id_cor and' + #13#10 +
                  '                                 pft.id_tamanho = opp.id_tamanho' + #13#10 +
                  '          where ' + #13#10 +
                  '             opr.id_opr >= ''' + (op_inicial) + ''' ' +
                  '          group by 1,2,3,4,5' + #13#10 +
                  '          order by opp.id_opr,opp.id_item';
  BUS_DP_M_OPR_INT := TDataSetProvider.Create(nil);
  BUS_DP_M_OPR_INT.DataSet := BUS_SQ_M_OPR_INT;

  cdsOpsOpp := BUS_DP_M_OPR_INT.data;

end;


function TSM.enSgqPcpBuscarDescRegIte(IdCliente, IdItem: String): currency;
var
  qry,qry2: TSQLQuery;
  sql, id_regiao, id_grupo: String;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 17/10/2017 }

  result := 0;

  id_grupo := '';
  try

  qry2 := TSqlQuery.Create(self);

  qry := TSqlQuery.Create(self);
  qry.SQLConnection := self.Conexao;

  sql := '';

  qry.Close;
  qry.SQL.Clear;

  sql :=
          '        select coalesce(id_regiao,0) as id_regiao ' +
          '         from cad_tb_c_cli  ' + #13#10 +
          '         where ' + #13#10 +
          '            id_cliente = '+ IdCliente + #13#10 ;

  qry.SQL.Add(sql);
  qry.Open;

  if not (qry.IsEmpty) then
     begin
       if qry.FieldByName('id_regiao').AsInteger > 0 then
          begin
            id_regiao := qry.FieldByName('id_regiao').AsString;


            sql := '';

            qry.Close;
            FreeAndNil(qry);
            qry := TSqlQuery.Create(self);
            qry.SQLConnection := self.Conexao;

            qry.SQL.Clear;

            sql :=
                    '        select id_grupo  ' +
                    '         from cad_tb_c_ite  ' + #13#10 +
                    '         where ' + #13#10 +
                    '            id_item = '+ IdItem + #13#10 ;
            qry.SQL.Add(sql);
            qry.Open;

            id_grupo := qry.FieldByName('id_grupo').AsString;


            qry2.SQLConnection := self.Conexao;
            qry2.Close;
            qry2.SQL.Clear;

            sql :=
                   '  select per_desconto ' +
                   '  from pcp_tb_c_reg_ite  ' + #13#10 +
                   '  where ' + #13#10 +
                   '    id_regiao = '+ id_regiao + #13#10 +
                   '    and id_item = '+ IdItem + #13#10;

            qry2.SQL.Add(sql);
            qry2.Open;
            if not (qry2.IsEmpty) then
               begin
                 if qry2.FieldByName('per_desconto').AsCurrency > 0 then
                    begin
                      result := qry2.FieldByName('per_desconto').AsCurrency;
                    end;
                end;

            if result = 0 then
               begin
                 qry2.Close;
                 FreeAndNil(qry2);
                 qry2 := TSqlQuery.Create(self);
                 qry2.SQLConnection := self.Conexao;
                 qry2.SQL.Clear;

                 sql :=
                   '  select per_desconto ' +
                   '  from pcp_tb_c_reg_ite  ' + #13#10 +
                   '  where ' + #13#10 +
                   '    id_regiao = '+ id_regiao + #13#10 +
                   '    and id_grupo = ''' + id_grupo + ''' ' + #13#10;

                 qry2.SQL.Add(sql);
                 qry2.Open;
                 if not (qry2.IsEmpty) then
                    begin
                      if qry2.FieldByName('per_desconto').AsCurrency > 0 then
                         begin
                           result := qry2.FieldByName('per_desconto').AsCurrency;
                         end;
                     end;
               end;
          end;
     end;
  finally
     if qry <> nil then
        FreeAndNil(qry);
     if qry2 <> nil then
        FreeAndNil(qry2);
  end;
end;


function TSM.enSgqPcpBusSaldoPendente(IdEmpresa, IdItem, IdCor,
  IdTamanho: String): currency;
var
  qry: TSQLQuery;
  sql: String;
begin
  {TODO -oMaxsuel -cCriao:
   Mtodo criado em 07/02/2017;
   Buscar o saldo pendente do item}
  try
  qry := TSqlQuery.Create(self);
  qry.SQLConnection := self.Conexao;

  sql := '';

  qry.Close;
  qry.SQL.Clear;

  sql :=
          '        select ped.id_empresa, ipe.id_item, ipe.id_cor, ipe.id_tamanho, coalesce(sum(qtde),0) as ' + #13#10 +
          '           qtde_ped_pendente, 0.0000 as qtde_req_pendente   from fat_tb_m_ped_ite ipe ' + #13#10 +
          '            left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido) ' + #13#10 +
          '         where ' + #13#10 +
          '           ped.situacao in (2)' + #13#10 +
          //'           and ped.situacao_aprovacao = 1 ' + #13#10 +
          '           and ped.situacao_aprovacao <> 2 ' + #13#10 +
          '           and ped.id_empresa = '  + IdEmpresa + #13#10 +
          '           and ipe.id_item     = '  + IdItem + #13#10 +
          '           and ipe.id_cor      = '  + IdCor + #13#10 +
          '           and ipe.id_tamanho  = '  + IdTamanho + #13#10 +
          '         group by 1,2,3,4' + #13#10 +
          '         union all' + #13#10 +
          '        select opr.id_empresa, irq.id_item, irq.id_cor, irq.id_tamanho,0.000 as qtde_ped_pendente, ' + #13#10 +
          '                coalesce(sum(irq.qtde),0) - coalesce(sum(irq.qtde_atendida),0) as qtde_req_pendente ' + #13#10 +
          '         from pcp_tb_m_opr_req_ite irq  ' + #13#10 +
          '            left outer join pcp_tb_m_opr_req req on (req.id_opr = irq.id_opr and ' + #13#10 +
          '                                                     req.id_opr_req = irq.id_opr_req)' + #13#10 +
          '            left outer join pcp_tb_m_opr opr on (opr.id_opr  = req.id_opr) ' + #13#10 +
          '         where ' + #13#10 +
          '            opr.situacao in (0,1)' + #13#10 +
          '            and opr.id_empresa = '  + IdEmpresa + #13#10 +
          '            and irq.id_item    = '  + IdItem + #13#10 +
          '            and irq.id_cor      = '  + IdCor + #13#10 +
          '            and irq.id_tamanho  = '  + IdTamanho + #13#10 +
          '         group by 1,2,3,4 ';
  qry.SQL.Add(sql);
  qry.Open;

  result := 0;
  if not qry.IsEmpty then
     begin
       result :=  qry.FieldByName('qtde_ped_pendente').AsCurrency +
                  qry.FieldByName('qtde_req_pendente').AsCurrency;
     end;
  qry.close;

  finally
     FreeAndNil(qry);
  end;

end;

procedure TSM.enSgqPcpGerarEtq(IdEmpresa, IdOpr: Integer; PCP_CD_M_ETQ, cdsItensOpr: TClientDataSet);
var
  CodEtq,QtdeRegsEtq: Integer;
  CodOprEtq,QtdeRegsOprEtq: Integer;
  Seq, SeqEtq, SeqEtqCoj : Integer;
  BUS_CD_C_ITE_COJ: TClientDataSet;
  itens_sel: String;
  QtdTotCoj: integer;
begin
  {TODO -oMaxsuel -cCriao:
   Mtodo criado em 06/08/2016;
   Tem a funo de gerar as Etiquetas da Ordem de Produo}

        BUS_CD_C_ITE_COJ := TClientDataSet.Create(nil);
        BUS_CD_C_ITE_COJ.SetProvider(BUS_DP_C_ITE_COJ);

        PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
        PCP_CD_M_ETQ.Data :=
          PCP_CD_M_ETQ.DataRequest(VarArrayOf([0,'']));

        try
         cdsItensOpr.Filtered := true;
         cdsItensOpr.Filter   := 'saldo_a_produzir > 0 ';

         if not cdsItensOpr.IsEmpty then
            begin
               cdsItensOpr.First;
               while not cdsItensOpr.eof do
                  begin
                    QtdeRegsOprEtq :=  QtdeRegsOprEtq +
                                       cdsItensOpr.FieldByName('saldo_a_produzir').AsInteger;

                    if itens_sel <> '' then
                       begin
                        itens_sel :=
                        itens_sel + ',' +''''+ cdsItensOpr.FieldByName('ID_ITEM').AsString+'''';
                       end;
                    if itens_sel = '' then
                       begin
                         itens_sel :=
                         itens_sel +'''' + cdsItensOpr.FieldByName('ID_ITEM').AsString+'''';
                       end;
                    cdsItensOpr.Next;
                  end;

               QtdTotCoj := 0;
               // Busca os itens conjugados para poder produzir as etiquetas tb.
               BUS_CD_C_ITE_COJ.SetProvider(BUS_DP_C_ITE_COJ);
               BUS_CD_C_ITE_COJ.Data :=
                    BUS_CD_C_ITE_COJ.DataRequest(VarArrayOf([1,itens_sel]));

               cdsItensOpr.First;
               while not cdsItensOpr.eof do
                  begin
                    BUS_CD_C_ITE_COJ.Filtered := true;
                    BUS_CD_C_ITE_COJ.Filter   := ' id_item = ' + cdsItensOpr.FieldByName('id_item').AsString;

                    if not (BUS_CD_C_ITE_COJ.IsEmpty) then
                       begin
                          while not BUS_CD_C_ITE_COJ.eof do
                             begin
                               QtdeRegsOprEtq :=  QtdeRegsOprEtq +
                                       (BUS_CD_C_ITE_COJ.FieldByName('qtde').AsInteger *
                                        cdsItensOpr.FieldByName('saldo_a_produzir').AsInteger);

                               QtdTotCoj := QtdTotCoj + 1;

                               BUS_CD_C_ITE_COJ.Next;
                             end;
                       end;
                    BUS_CD_C_ITE_COJ.Filtered := false;

                    cdsItensOpr.Next;
                  end;
               // --------------------------------------------------------------


               cdsItensOpr.First;

               QtdeRegsEtq     := cdsItensOpr.RecordCount + QtdTotCoj;
               CodEtq          := enChaveNItens('SEQ_OPR_ETQ',QtdeRegsEtq);

               CodOprEtq       := enChaveNItens('OPR_TB_M_ETQ',QtdeRegsOprEtq);

               cdsItensOpr.First;
               while not cdsItensOpr.eof do
                  begin
                    seq := 0;
                    while seq < cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency do
                       begin
                          Inc(seq);

                          PCP_CD_M_ETQ.Insert;
                          PCP_CD_M_ETQ.FieldByName('id_empresa').AsInteger        := IdEmpresa;
                          PCP_CD_M_ETQ.FieldByName('id_opr').AsInteger            := IdOpr;
                          PCP_CD_M_ETQ.FieldByName('id_opr_origem').AsInteger     := IdOpr;
                          PCP_CD_M_ETQ.FieldByName('id_etq').AsInteger            := CodOprEtq;
                          PCP_CD_M_ETQ.FieldByName('id_item').AsInteger           := cdsItensOpr.FieldByName('id_item').AsInteger;
                          PCP_CD_M_ETQ.FieldByName('id_cor').AsInteger            := cdsItensOpr.FieldByName('id_cor').AsInteger;
                          PCP_CD_M_ETQ.FieldByName('id_tamanho').AsInteger        := cdsItensOpr.FieldByName('id_tamanho').AsInteger;


                          PCP_CD_M_ETQ.FieldByName('sequencia').AsInteger         := seq;
                          PCP_CD_M_ETQ.FieldByName('cod_barra').AsString          := IntToStr(CodEtq) + StrZero(seq,3,0);

                          PCP_CD_M_ETQ.FieldByName('dta_criacao').AsDateTime      := date;
                          PCP_CD_M_ETQ.FieldByName('hor_criacao').AsDateTime      := time;

                          PCP_CD_M_ETQ.FieldByName('impressa').AsBoolean          := false;

                          PCP_CD_M_ETQ.FieldByName('pcp_obs_item').AsString       := cdsItensOpr.FieldByName('pcp_obs_item').AsString;

                          inc(CodOprEtq);
                          PCP_CD_M_ETQ.Post;
                      end;



                    // Ir criar as etiquetas do itens conjugados do produto
                    BUS_CD_C_ITE_COJ.Filtered := true;
                    BUS_CD_C_ITE_COJ.Filter   := ' id_item = ' + PCP_CD_M_ETQ.FieldByName('id_item').AsString;
                    if not (BUS_CD_C_ITE_COJ.IsEmpty) then
                       begin
                          //inc(CodOprEtq);
                          inc(CodEtq);
                          while not BUS_CD_C_ITE_COJ.eof do
                             begin
                                SeqEtqCoj := 0;
                                while SeqEtqCoj < (BUS_CD_C_ITE_COJ.FieldByName('qtde').AsCurrency *
                                                   cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency) do
                                   begin
                                      Inc(SeqEtqCoj);

                                      PCP_CD_M_ETQ.Insert;
                                      PCP_CD_M_ETQ.FieldByName('id_empresa').AsInteger        := IdEmpresa;
                                      PCP_CD_M_ETQ.FieldByName('id_opr').AsInteger            := IdOpr;
                                      PCP_CD_M_ETQ.FieldByName('id_opr_origem').AsInteger     := IdOpr;
                                      PCP_CD_M_ETQ.FieldByName('id_etq').AsInteger            := CodOprEtq;
                                      PCP_CD_M_ETQ.FieldByName('id_item').AsInteger           := BUS_CD_C_ITE_COJ.FieldByName('id_item_conjugado').AsInteger;
                                      PCP_CD_M_ETQ.FieldByName('id_cor').AsInteger            := BUS_CD_C_ITE_COJ.FieldByName('id_cor').AsInteger;
                                      PCP_CD_M_ETQ.FieldByName('id_tamanho').AsInteger        := BUS_CD_C_ITE_COJ.FieldByName('id_tamanho').AsInteger;


                                      PCP_CD_M_ETQ.FieldByName('sequencia').AsInteger         := SeqEtqCoj;
                                      PCP_CD_M_ETQ.FieldByName('cod_barra').AsString          := IntToStr(CodEtq) + StrZero(SeqEtqCoj,3,0);

                                      PCP_CD_M_ETQ.FieldByName('dta_criacao').AsDateTime      := date;
                                      PCP_CD_M_ETQ.FieldByName('hor_criacao').AsDateTime      := time;

                                      PCP_CD_M_ETQ.FieldByName('impressa').AsBoolean          := false;
                                      inc(CodOprEtq);
                                      PCP_CD_M_ETQ.Post;
                                  end;
                                BUS_CD_C_ITE_COJ.Next;
                             end;
                       end;

                    inc(CodEtq);
                    cdsItensOpr.Next;
                  end;
            end;
        finally
           FreeAndNil(BUS_CD_C_ITE_COJ);
           cdsItensOpr.Filtered := false;
        end;
end;



function TSM.enSgqPcpGerarOppEtq(IdEmpresa, IdOpr: Integer;
    ItensOpp: OleVariant): String;
var
  CodEtq,QtdeRegsEtq: Integer;
  CodOprEtq,QtdeRegsOprEtq: Integer;
  Seq, SeqEtq: Integer;
  cdsItensOpp,PCP_CD_M_ETQ: TClientDataSet;

begin

        try
           PCP_CD_M_ETQ := TClientDataSet.Create(nil);
           PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
           PCP_CD_M_ETQ.Data :=
               PCP_CD_M_ETQ.DataRequest(VarArrayOf([0,'']));


           cdsItensOpp := TClientDataSet.Create(nil);
           cdsItensOpp.Data := ItensOpp;

           cdsItensOpp.Filtered := true;
           cdsItensOpp.Filter   := ' int_novoreg = ''S'' ';

           cdsItensOpp.First;
           while not cdsItensOpp.eof do
              begin
                QtdeRegsOprEtq :=  QtdeRegsOprEtq +
                                   cdsItensOpp.FieldByName('qtde_a_produzir').AsInteger;
                cdsItensOpp.Next;
              end;
           cdsItensOpp.First;

           QtdeRegsEtq     := cdsItensOpp.RecordCount;
           CodEtq          := enChaveNItens('SEQ_OPR_ETQ',QtdeRegsEtq);

           CodOprEtq       := enChaveNItens('OPR_TB_M_ETQ',QtdeRegsOprEtq);

           cdsItensOpp.First;
           while not cdsItensOpp.eof do
              begin
                seq := 0;
                while seq < cdsItensOpp.FieldByName('qtde_a_produzir').AsCurrency do
                   begin
                      Inc(seq);

                      PCP_CD_M_ETQ.Insert;
                      PCP_CD_M_ETQ.FieldByName('id_empresa').AsInteger        := IdEmpresa;
                      PCP_CD_M_ETQ.FieldByName('id_opr').AsInteger            := IdOpr;
                      PCP_CD_M_ETQ.FieldByName('id_opr_origem').AsInteger     := IdOpr;
                      PCP_CD_M_ETQ.FieldByName('id_etq').AsInteger            := CodOprEtq;
                      PCP_CD_M_ETQ.FieldByName('id_item').AsInteger           := cdsItensOpp.FieldByName('id_item').AsInteger;
                      PCP_CD_M_ETQ.FieldByName('id_cor').AsInteger            := cdsItensOpp.FieldByName('id_cor').AsInteger;
                      PCP_CD_M_ETQ.FieldByName('id_tamanho').AsInteger        := cdsItensOpp.FieldByName('id_tamanho').AsInteger;


                      PCP_CD_M_ETQ.FieldByName('sequencia').AsInteger         := seq;
                      PCP_CD_M_ETQ.FieldByName('cod_barra').AsString          := IntToStr(CodEtq) + StrZero(seq,3,0);

                      PCP_CD_M_ETQ.FieldByName('dta_criacao').AsDateTime      := date;
                      PCP_CD_M_ETQ.FieldByName('hor_criacao').AsDateTime      := time;

                      PCP_CD_M_ETQ.FieldByName('impressa').AsBoolean          := false;

                      PCP_CD_M_ETQ.FieldByName('pcp_obs_item').AsString       := cdsItensOpp.FieldByName('pcp_desc_item_person').AsString;

                      inc(CodOprEtq);
                      PCP_CD_M_ETQ.Post;
                  end;

                 inc(CodEtq);
                 cdsItensOpp.Next;
              end;

            try
              if PCP_CD_M_ETQ <> nil then
                 if PCP_CD_M_ETQ.ChangeCount > 0 then
                    if PCP_CD_M_ETQ.ApplyUpdates(0) = 0 then
                       begin
                         result := 'OK';
                       end;
            except
               on e: exception do
                  begin
                     raise Exception.Create('Erro ao tentar criar a etiqueta: ' + #13 + e.Message);
                  end;
            end;

        finally
           // cdsItensOpr.Filtered := false;
           FreeAndNil(cdsItensOpp);
           FreeAndNil(PCP_CD_M_ETQ);
        end;

end;

procedure TSM.enSgqPcpGerarOps(IdEmpresa, IdOpr,IdTpp: Integer;
  PCP_CD_M_OPR_OPS, cdsItensOpr,BUS_CD_M_OPR_OPP_INT: TClientDataSet);
var
  PCP_CD_C_TPP, PCP_CD_C_FPI: TClientDataSet;
  PCP_CD_C_TPP_SET,PCP_CD_C_FPI_FTI: TDataSet;
  seq: integer;
  Qtde: Currency;
begin
  {TODO -oMaxsuel -cCriao:
   Mtodo criado em 06/08/2016;
   Tem a funo de gerar a Ordem de Produo para cada Setor}

   PCP_CD_C_TPP  := TClientDataSet.Create(nil);
   PCP_CD_C_TPP.SetProvider(PCP_DP_C_TPP);
   PCP_CD_C_TPP.Data :=
          PCP_CD_C_TPP.DataRequest(VarArrayOf([0,IdTpp]));
   PCP_CD_C_TPP_SET := TClientDataSet.Create(nil);
   PCP_CD_C_TPP_SET.DataSetField  := TDataSetField(PCP_CD_C_TPP.FieldByName('PCP_SQ_C_TPP_SET'));

   try

   if not PCP_CD_C_TPP_SET.IsEmpty  then
      begin
         cdsItensOpr.First;
         seq := 0;
         while not cdsItensOpr.eof do
            begin
              if cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency > 0 then
                 begin
                    try
                      PCP_CD_C_FPI            := TClientDataSet.Create(nil);
                      PCP_CD_C_FPI.SetProvider(PCP_DP_C_FPI);
                      PCP_CD_C_FPI.Data :=
                          PCP_CD_C_FPI.DataRequest(VarArrayOf([1,cdsItensOpr.FieldByName('id_item').AsString]));

                      PCP_CD_C_FPI_FTI := TClientDataSet.Create(nil);
                      PCP_CD_C_FPI_FTI.DataSetField  := TDataSetField(PCP_CD_C_FPI.FieldByName('PCP_SQ_C_FPI_FTI'));

                      PCP_CD_C_FPI_FTI.Filtered := true;
                      PCP_CD_C_FPI_FTI.Filter   := ' tipo_acao = 2 '; // A Executar

                      while not PCP_CD_C_FPI_FTI.Eof do
                         begin
                           if PCP_CD_C_TPP_SET.Locate('id_setor',PCP_CD_C_FPI_FTI.FieldByName('id_setor').AsInteger,[]) then
                              begin
                                 if PCP_CD_C_TPP_SET.FieldByName('executa_servico').AsBoolean then
                                    begin
                                       Inc(seq);

                                       Qtde := PCP_CD_C_FPI_FTI.FieldByName('qtde').AsCurrency * cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency;

                                       PCP_CD_M_OPR_OPS.Insert;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_opr').AsInteger             := IdOpr;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_opr_ops').AsInteger         := seq;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_setor').AsInteger           := PCP_CD_C_FPI_FTI.FieldByName('id_setor').AsInteger;

                                       PCP_CD_M_OPR_OPS.FieldByName('id_item_acabado').AsInteger    := cdsItensOpr.FieldByName('id_item').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_cor_acabado').AsInteger     := cdsItensOpr.FieldByName('id_cor').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_tamanho_acabado').AsInteger := cdsItensOpr.FieldByName('id_tamanho').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('qtde_acabado').AsCurrency      := cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency;

                                       PCP_CD_M_OPR_OPS.FieldByName('id_item').AsInteger           := PCP_CD_C_FPI_FTI.FieldByName('id_item').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_cor').AsInteger            := PCP_CD_C_FPI_FTI.FieldByName('id_cor').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('id_tamanho').AsInteger        := PCP_CD_C_FPI_FTI.FieldByName('id_tamanho').AsInteger;
                                       PCP_CD_M_OPR_OPS.FieldByName('qtde').AsCurrency             := Qtde;
                                       PCP_CD_M_OPR_OPS.FieldByName('obs_producao').AsString       := '';
                                       if BUS_CD_M_OPR_OPP_INT.Locate('id_item;id_cor;id_tamanho',
                                                               VarArrayOf([PCP_CD_M_OPR_OPS.FieldByName('id_item_acabado').AsCurrency,
                                                                           PCP_CD_M_OPR_OPS.FieldByName('id_cor_acabado').AsCurrency,
                                                                           PCP_CD_M_OPR_OPS.FieldByName('id_tamanho_acabado').AsCurrency]) , []) then
                                          begin
                                            PCP_CD_M_OPR_OPS.FieldByName('obs_producao').AsString       :=
                                                BUS_CD_M_OPR_OPP_INT.FieldByName('obs_producao').AsString;
                                          end;
                                       //PCP_CD_M_OPR_REQ_ITE.FieldByName('id_busca_item').AsString  := PCP_CD_C_FPI_FTI.FieldByName('id_busca_item').AsString;
                                       PCP_CD_M_OPR_OPS.Post;
                                    end;
                              end;
                           PCP_CD_C_FPI_FTI.Next;
                         end;
                    finally
                       FreeAndNil(PCP_CD_C_FPI);
                       FreeAndNil(PCP_CD_C_FPI_FTI);
                    end;
                 end;
              cdsItensOpr.Next;
            end;
      end;
   finally
      FreeAndNil(PCP_CD_C_TPP);
      FreeAndNil(PCP_CD_C_TPP_SET);
   end;
end;

procedure TSM.enSgqPcpGerarReq(IdEmpresa,IdOpr,IdResp: Integer; IdAlmoxarifado: String; PCP_CD_M_OPR_REQ, cdsItensOpr: TClientDataSet; PCP_CD_M_OPR_REQ_ITE: TDataSet);
var
  BUS_CD_M_LOT_EST, PCP_CD_C_FPI: TClientDataSet;
  PCP_CD_C_FPI_FTI: TDataSet;
  Seq: integer;
  SldQtde,Qtde: Currency;
  QtdeRegCont,QtdeRegLotEst: Integer;
  num_lote: String;
begin
   {TODO -oMaxsuel -cCriao:
    Mtodo criado em 01/08/2016;
    Tem a funo de gerar a requisio da O.P.}


   // Criando a requisio
   PCP_CD_M_OPR_REQ.Insert;
   PCP_CD_M_OPR_REQ.FieldByName('id_opr').AsInteger          := IdOpr;
   PCP_CD_M_OPR_REQ.FieldByName('id_opr_req').AsInteger      := enValorChave('PCP_TB_M_OPR_REQ');
   PCP_CD_M_OPR_REQ.FieldByName('dta_emissao').AsDateTime    := Date;
   PCP_CD_M_OPR_REQ.FieldByName('id_responsavel').AsInteger  := IdResp;

   seq := 0;

   cdsItensOpr.First;
   while not cdsItensOpr.eof do
      begin
        if cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency > 0 then
           begin
              try
                PCP_CD_C_FPI            := TClientDataSet.Create(nil);
                PCP_CD_C_FPI.SetProvider(PCP_DP_C_FPI);
                PCP_CD_C_FPI.Data :=
                    PCP_CD_C_FPI.DataRequest(VarArrayOf([3,cdsItensOpr.FieldByName('id_item').AsString,
                                                           cdsItensOpr.FieldByName('id_cor').AsString,
                                                           cdsItensOpr.FieldByName('id_tamanho').AsString]));
                PCP_CD_C_FPI_FTI := TClientDataSet.Create(nil);
                PCP_CD_C_FPI_FTI.DataSetField  := TDataSetField(PCP_CD_C_FPI.FieldByName('PCP_SQ_C_FPI_FTI'));

                PCP_CD_C_FPI_FTI.Filtered := true;
                PCP_CD_C_FPI_FTI.Filter   := ' tipo_acao = 1 ';

                while not PCP_CD_C_FPI_FTI.Eof do
                   begin
                     BUS_CD_M_LOT_EST := TClientDataSet.Create(nil);
                     BUS_CD_M_LOT_EST.Close;
                     BUS_CD_M_LOT_EST.SetProvider(BUS_DP_M_LOT_EST);
                     BUS_CD_M_LOT_EST.Data :=
                          BUS_CD_M_LOT_EST.DataRequest(VarArrayOf([0,
                                            IdAlmoxarifado,
                                            PCP_CD_C_FPI_FTI.FieldByName('id_item').AsCurrency,
                                            PCP_CD_C_FPI_FTI.FieldByName('id_cor').AsCurrency,
                                            PCP_CD_C_FPI_FTI.FieldByName('id_tamanho').AsCurrency]));

                     QtdeRegLotEst :=  BUS_CD_M_LOT_EST.RecordCount;
                     QtdeRegCont       :=  0;

                     SldQtde := PCP_CD_C_FPI_FTI.FieldByName('qtde').AsCurrency * cdsItensOpr.FieldByName('saldo_a_produzir').AsCurrency;
                     Qtde := 0;

                     while SldQtde > 0 do
                        begin
                           inc(QtdeRegCont);
                           if (QtdeRegLotEst > 0) and (QtdeRegCont <= QtdeRegLotEst) then
                              begin
                                 if SldQtde <= BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency then
                                    begin
                                      if SldQtde = BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency then
                                         Qtde := BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency;
                                      if SldQtde < BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency then
                                         Qtde := SldQtde;
                                      SldQtde := 0;
                                    end
                                 else
                                    begin
                                      SldQtde := SldQtde - BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency;
                                      Qtde := BUS_CD_M_LOT_EST.FieldByName('qtde_disp').AsCurrency;
                                    end;
                                 num_lote := BUS_CD_M_LOT_EST.FieldByName('num_lote').AsString;
                              end
                           else
                              begin
                                Qtde := SldQtde;
                                num_lote := '';
                                SldQtde := 0;
                              end;

                           PCP_CD_M_OPR_REQ_ITE.Insert;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_opr').AsInteger := IdOpr;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_opr_req').AsInteger :=
                               PCP_CD_M_OPR_REQ.FieldByName('id_opr_req').AsInteger;

                           Inc(seq);

                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_opr_req_ite').AsInteger  := Seq;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_item').AsInteger         := PCP_CD_C_FPI_FTI.FieldByName('id_item').AsInteger;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_cor').AsInteger          := PCP_CD_C_FPI_FTI.FieldByName('id_cor').AsInteger;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_tamanho').AsInteger      := PCP_CD_C_FPI_FTI.FieldByName('id_tamanho').AsInteger;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_busca_item').AsString    := PCP_CD_C_FPI_FTI.FieldByName('id_busca_item').AsString;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('id_setor').AsInteger        := PCP_CD_C_FPI_FTI.FieldByName('id_setor').AsInteger;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger        := 1;

                           PCP_CD_M_OPR_REQ_ITE.FieldByName('qtde').AsCurrency           := Qtde;

                           PCP_CD_M_OPR_REQ_ITE.FieldByName('num_lote').AsString            := num_lote;
                           PCP_CD_M_OPR_REQ_ITE.FieldByName('gerado_automatico').AsBoolean  := true;

                           PCP_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency  := 0;
                           PCP_CD_M_OPR_REQ_ITE.Post;

                           BUS_CD_M_LOT_EST.Next;
                        end;
                     PCP_CD_C_FPI_FTI.Next;

                     FreeAndNil(BUS_CD_M_LOT_EST);
                   end;
              finally
                 FreeAndNil(PCP_CD_C_FPI);
                 FreeAndNil(PCP_CD_C_FPI_FTI);
                 FreeAndNil(BUS_CD_M_LOT_EST);
              end;
           end;
        cdsItensOpr.Next;
      end;
end;

function TSM.enSgqPcpImportarPed(tbItensSel: TDataSet; IdEmpresa,IdOpr,IdResp,AlmSel,PedSel,ItensSel,CorSel,TamSel: String; PreparaGeracaoBloco: integer): OleVariant;
var
  BUS_CD_M_PED_INT, BUS_CD_M_PED_ITT_INT, BUS_CD_M_OPR_PED_INT,
  BUS_CD_M_OPR_OPP_INT,EST_CD_M_FES_ALM,cdsItensSel,
  PCP_CD_M_OPR,PCP_CD_M_OPR_REQ, PCP_CD_M_OPR_OPS,
  PCP_CD_M_ETQ, BUS_CD_C_PAR_CTR: TClientDataSet;

  BUS_CD_M_OPR_OPP_SOP_INT, PCP_CD_M_OPR_REQ_ITE: TDataSet;

  qryPed,qryOpr,qryOpp,qryBus:TSqlQuery;
  Saldo_Fisico,QtdePendente,Sld_Disponivel,Sld_Disp_Opr, Sld_X,SaldoProduzir,
  qtd_atender_opr_ext, QtdeUtil, QtdeUtilizar : Currency;
  CubagemAproduzir: Currency;
  mens_Erro: String;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
  UltIdOppOpp: Integer;

  ObsProducao: String;
  Item_SobMedida:String;

  calc_saldo_a_produzir: Boolean;

  cdsTempItens: TClientDataSet;

begin
 { TODO -oMaxsuel -cCriao :
   Mtodo criado em 24/06/2016
   Tem a funo de calcular o saldo a produzir dos produtos }

  try
    calc_saldo_a_produzir := false;

    BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
    BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
    BUS_CD_C_PAR_CTR.Close;
    BUS_CD_C_PAR_CTR.Data :=
       BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([IdEmpresa]));

    calc_saldo_a_produzir := BUS_CD_C_PAR_CTR.FieldByName('sgq_calc_sld_produzir_opr').AsBoolean;

    Item_SobMedida := BUS_CD_C_PAR_CTR.FieldByName('pcp_id_item_sob_medida').AsString;


    cdsItensSel      := TClientDataSet.Create(nil);
    cdsTempItens     := TClientDataSet.Create(nil);

    EST_CD_M_FES_ALM := TClientDataSet.Create(nil);
    EST_CD_M_FES_ALM.SetProvider(EST_DP_M_FES_ALM);

    BUS_CD_M_PED_INT     := TClientDataSet.Create(nil);

    PCP_CD_M_OPR         := TClientDataSet.Create(nil);
    BUS_CD_M_OPR_PED_INT := TClientDataSet.Create(nil);


    qryPed := TSqlQuery.Create(self);
    qryOpr := TSqlQuery.Create(self);
    qryOpp := TSqlQuery.Create(self);
    qryBus := TSqlQuery.Create(self);
    //SM     := TSM.Create(nil);
    qryPed.SQLConnection   := self.conexao;
    qryOpr.SQLConnection   := self.conexao;
    qryOpp.SQLConnection   := self.conexao;
    qryBus.SQLConnection := self.conexao;


    with cdsItensSel, FieldDefs do
      begin
        Close;
        Clear;
        // Aereo
        Add('id_opr', ftInteger);
        Add('id_almoxarifado', ftInteger);
        Add('id_item', ftInteger);
        Add('id_cor', ftInteger);
        Add('id_tamanho', ftInteger);
        Add('qtde', ftCurrency);
        Add('pcp_obs_item', ftString,150);
        Add('saldo_fisico_momento', ftCurrency); // Saldo fisico no momento do clculo.
        Add('saldo_pendente', ftCurrency);       // Saldo pendente.
        Add('saldo_disponivel', ftCurrency);  { Ficar guardado o saldo disponvel do estoque
                                               no momento do calculo a produzir do produto }
        Add('saldo_disponivel_outras_opr', ftCurrency); // Saldo disponivel nas outras ops
        Add('saldo_a_produzir', ftCurrency);
        CreateDataSet;
      end;

      with cdsTempItens, FieldDefs do
          begin
            Close;
            Clear;

            Add('id_item', ftInteger);
            Add('id_cor', ftInteger);
            Add('id_tamanho', ftInteger);
            Add('qtde', ftCurrency);

            CreateDataSet;
          end;

     tbItensSel.First;
     while not tbItensSel.eof do
        begin
           cdsItensSel.Insert;

           cdsItensSel.FieldByName('id_opr').AsInteger := StrToInt(IdOpr);
           cdsItensSel.FieldByName('id_almoxarifado').AsInteger := tbItensSel.FieldByName('id_almoxarifado').AsInteger;
           cdsItensSel.FieldByName('id_item').AsInteger := tbItensSel.FieldByName('id_item').AsInteger;
           cdsItensSel.FieldByName('id_cor').AsInteger := tbItensSel.FieldByName('id_cor').AsInteger;
           cdsItensSel.FieldByName('id_tamanho').AsInteger := tbItensSel.FieldByName('id_tamanho').AsInteger;
           cdsItensSel.FieldByName('qtde').AsCurrency := tbItensSel.FieldByName('qtde').AsCurrency;
           cdsItensSel.FieldByName('pcp_obs_item').AsString := tbItensSel.FieldByName('pcp_obs_item').AsString;
           cdsItensSel.FieldByName('saldo_fisico_momento').AsCurrency        := 0;
           cdsItensSel.FieldByName('saldo_pendente').AsCurrency              := 0;
           cdsItensSel.FieldByName('saldo_disponivel_outras_opr').AsCurrency := 0;
           cdsItensSel.FieldByName('saldo_disponivel').AsCurrency := 0;
           cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency := 0;
           cdsItensSel.Post;

           if not ( cdsTempItens.Locate('id_item;id_cor;id_tamanho',varArrayof([cdsItensSel.FieldByName('id_item').AsInteger,
                                                                          cdsItensSel.FieldByName('id_cor').AsInteger,
                                                                          cdsItensSel.FieldByName('id_tamanho').AsInteger
                                                                          ]),[]) ) then
              begin
                cdsTempItens.Insert;
                cdsTempItens.FieldByName('id_item').AsInteger :=  cdsItensSel.FieldByName('id_item').AsInteger;
                cdsTempItens.FieldByName('id_cor').AsInteger :=   cdsItensSel.FieldByName('id_cor').AsInteger;
                cdsTempItens.FieldByName('qtde').AsCurrency :=    cdsItensSel.FieldByName('qtde').AsCurrency;
                cdsTempItens.post;
              end
           else
              begin
                cdsTempItens.Edit;
                cdsTempItens.FieldByName('qtde').AsCurrency := cdsTempItens.FieldByName('qtde').AsCurrency +
                                                               cdsItensSel.FieldByName('qtde').AsCurrency;
                cdsTempItens.post;
              end;
           tbItensSel.Next;
        end;




    EST_CD_M_FES_ALM.Close;
    EST_CD_M_FES_ALM.Data :=
        EST_CD_M_FES_ALM.DataRequest(VarArrayOf([6, IdEmpresa, ItensSel,CorSel,TamSel,AlmSel]));


    qryBus.Close;
    qryBus.SQL.Clear;
    qryBus.SQL.Add(
            ' select ite.id_item, ite.cubagem, ite.sgq_personalizado ' +
            ' from cad_tb_c_ite ite           ' +
            ' where ite.id_item in (' + VarToStr(ItensSel) +') ');
    qryBus.Open;

    mens_Erro := '';
    CubagemAproduzir := 0;


    BUS_CD_M_OPR_OPP_INT := TClientDataSet.Create(nil);
    BUS_CD_M_OPR_OPP_INT.SetProvider(BUS_DP_M_OPR_OPP_INT);
    BUS_CD_M_OPR_OPP_INT.Close;
    BUS_CD_M_OPR_OPP_INT.Data :=
    BUS_CD_M_OPR_OPP_INT.DataRequest(VarArrayOf([1,
         IdEmpresa,
         cdsItensSel.FieldByName('id_opr').AsInteger,
         ItensSel,
         CorSel,
         TamSel]));
    BUS_CD_M_OPR_OPP_SOP_INT := TClientDataSet.Create(nil);
    BUS_CD_M_OPR_OPP_SOP_INT.DataSetField := TDataSetField(BUS_CD_M_OPR_OPP_INT.FieldByName('BUS_SQ_M_OPR_OPP_SOP_INT'));



    cdsItensSel.First;
    while not cdsItensSel.eof do
       begin
          Saldo_Fisico        := 0;
          Sld_Disponivel      := 0;
          SaldoProduzir       := 0;
          Sld_Disp_Opr        := 0;
          qtd_atender_opr_ext := 0;
          QtdeUtil            := 0;
          QtdeUtilizar        := 0;
          QtdePendente        := 0;

          // If inserido por Maxsuel Victor, em 01/09/2017 para atender a necessidade de Allison
          // para que a produo dos itens seja calculado se o mesmo for parametrizado igual a TRUE;
          if calc_saldo_a_produzir then
             begin
                if EST_CD_M_FES_ALM.Locate('id_empresa;id_almoxarifado;id_item;id_cor;id_tamanho',
                                           VarArrayOf([IdEmpresa,
                                                       cdsItensSel.FieldByName('id_almoxarifado').AsInteger,
                                                       cdsItensSel.FieldByName('id_item').AsInteger,
                                                       cdsItensSel.FieldByName('id_cor').AsInteger,
                                                       cdsItensSel.FieldByName('id_tamanho').AsInteger]),
                                           []) then
                   begin
                     Saldo_Fisico := EST_CD_M_FES_ALM.FieldByName('saldo_fisico').AsCurrency;
                   end;
                // Busca a qtde de itens pendentes nos pedidos de venda
                qryPed.Close;
                qryPed.SQL.Clear;
                qryPed.SQL.Add(
                        ' select ped.id_almoxarifado,ipd.id_item,ipd.id_cor,ipd.id_tamanho, ' +
                        '         coalesce(sum(ipd.qtde),0) as qtde                          ' +
                        ' from fat_tb_m_ped_ite ipd                                         ' +
                        '     left outer join fat_tb_m_ped ped on (ped.id_pedido = ipd.id_pedido) ' +
                        ' where ped.id_empresa = ''' + vartostr(IdEmpresa) +'''  '+
                        '       and ipd.id_item    = ' + cdsItensSel.FieldByName('id_item').AsString +
                        '       and ipd.id_cor     = ' + cdsItensSel.FieldByName('id_cor').AsString +
                        '       and ipd.id_tamanho = ' + cdsItensSel.FieldByName('id_tamanho').AsString +
                        '       and ped.id_almoxarifado in (' + vartostr(AlmSel) +') ' +
                        '       and ped.situacao in (2) ' +
                        //'       and ped.situacao_aprovacao = 1 ' +
                        '       and ped.situacao_aprovacao <> 2 ' +
                        '  group by 1,2,3,4' );
                qryPed.Open;
                if not qryPed.IsEmpty then
                   begin
                     QtdePendente := qryPed.FieldByName('qtde').AsCurrency;
                   end;
                qryPed.Close;

                // Comentado por Maxsuel Victor, pois est gerando problema para Allison devido est inconsistente
                   // e Allison no est utilizando esta rotina de Saldo disponvel nas O.P
                        // Busca o saldo disponvel nas OPR
                        {qryOpr.Close;
                        qryOpr.SQL.Clear;
                        qryOpr.SQL.Add(
                                ' select opp.id_item,opp.id_cor,opp.id_tamanho,                      ' +
                                '         coalesce(sum(opp.saldo_disponivel),0) as saldo_disponivel  ' +
                                ' from pcp_tb_m_opr_opp opp                                          ' +
                                '      left outer join pcp_tb_m_opr opr on (opr.id_opr = opp.id_opr) ' +
                                ' where opr.id_empresa     = ''' + vartostr(IdEmpresa)  +'''  '+
                                '       and opp.saldo_disponivel > 0 ' +
                                '       and opp.id_item    = ' + cdsItensSel.FieldByName('id_item').AsString +
                                '       and opp.id_cor     = ' + cdsItensSel.FieldByName('id_cor').AsString +
                                '       and opp.id_tamanho = ' + cdsItensSel.FieldByName('id_tamanho').AsString +
                                '       and opr.situacao in (0,1) ' +
                                '  group by 1,2,3' );
                        qryOpr.Open;
                        if not qryOpr.IsEmpty then
                           begin
                             Sld_Disp_Opr := qryOpr.FieldByName('saldo_disponivel').AsCurrency;
                           end;
                        qryOpr.Close;}


                if cdsTempItens.Locate('id_item;id_cor;id_tamanho',varArrayof([cdsItensSel.FieldByName('id_item').AsInteger,
                                                                               cdsItensSel.FieldByName('id_cor').AsInteger,
                                                                               cdsItensSel.FieldByName('id_tamanho').AsInteger]),[]) then
                   begin
                     QtdePendente := QtdePendente + cdsTempItens.FieldByName('qtde').AsCurrency;
                   end;

                Sld_Disponivel := Saldo_Fisico - QtdePendente;

                // 24-04-2018 por Maxsuel Victor, todo item 404 e personalizado no precisa verificar mais o saldo disponivel
                // suas qtdes devero ser sempre produzidas.

                if qryBus.Locate('id_item',cdsItensSel.FieldByName('id_item').AsString,[]) then
                    begin
                      if (qryBus.FieldByName('id_item').AsString = Item_SobMedida) or
                         (qryBus.FieldByName('sgq_personalizado').AsBoolean) then
                          begin
                            Sld_Disponivel := -1 * cdsItensSel.FieldByName('qtde').AsCurrency;
                          end;
                    end;


                Sld_X := Sld_Disponivel + cdsItensSel.FieldByName('qtde').AsCurrency;


                BUS_CD_M_OPR_OPP_INT.Filtered := true;
                BUS_CD_M_OPR_OPP_INT.Filter :=
                                               ' id_item    = ''' + VarToStr(cdsItensSel.FieldByName('id_item').AsInteger) +''' ' +
                                               ' and id_cor     = ''' + VarToStr(cdsItensSel.FieldByName('id_cor').AsInteger) +''' ' +
                                               ' and id_tamanho = ''' + VarToStr(cdsItensSel.FieldByName('id_tamanho').AsInteger) +''' ' ;

                // Ir saber qual qtde ter que produzir e ir atualizar as OPR, que cederam quantidade
                // disponivel para esta OPR, que chamou este mtodo.
                // Clculo 1
                if Sld_X > cdsItensSel.FieldByName('qtde').AsCurrency then
                   begin
                     SaldoProduzir := 0;
                   end;

                // Clculo 2
                if Sld_X = 0 then
                   begin
                     {if Sld_Disp_Opr >= cdsItensSel.FieldByName('qtde').AsCurrency then
                        begin
                          SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency;

                          // Atualiza as OPR que ir ceder qtde para esta OPR
                          QtdeUtil      := cdsItensSel.FieldByName('qtde').AsCurrency;   // QTDE. NA OPR
                          while not BUS_CD_M_OPR_OPP_INT.eof do
                               begin
                                 BUS_CD_M_OPR_OPP_INT.Edit;
                                 if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                     begin
                                        QtdeUtilizar :=  QtdeUtil;
                                        QtdeUtil     := 0;
                                     end
                                 else
                                     if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                        begin
                                          QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                          QtdeUtil := QtdeUtil -
                                                      BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                        end;

                                 BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                     BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                         QtdeUtilizar;

                                 BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                     BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                        ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                          BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                                 BUS_CD_M_OPR_OPP_SOP_INT.Insert;
                                 // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                 BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                        dmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');
                                 BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                        cdsItensSel.FieldByName('id_opr').AsCurrency;
                                 BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                                 BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                                 BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                                 BUS_CD_M_OPR_OPP_SOP_INT.Post;

                                 BUS_CD_M_OPR_OPP_INT.Last;

                                 BUS_CD_M_OPR_OPP_INT.Next;
                               end;

                          {QTD_ATENDER_OPR_EXT =
                                      QTD_ATENDER_OPR_EXT + QTDE. NA OPR;
                          SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                 QTD_ATENDER_OPR +
                                                                 QTD_ATENDER_OPR_EXT)
                          Observao: O QTD_ATENDER_OPR_EXT e
                          SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                          lembrando que pode ratear, pois pode ser N O.P.Rs.}
                        //end;

                    {if (Sld_Disp_Opr > 0) and (Sld_Disp_Opr < cdsItensSel.FieldByName('qtde').AsCurrency) then
                        begin
                          SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency -
                                           Sld_Disp_Opr;   //  QTDE. NA POR - Saldo Disp. Das O.P.R;



                          // Atualiza as OPR que ir ceder qtde para esta OPR
                          QtdeUtil      :=  Sld_Disp_Opr;
                          while not BUS_CD_M_OPR_OPP_INT.eof do
                             begin
                               BUS_CD_M_OPR_OPP_INT.Edit;
                               if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                   begin
                                      QtdeUtilizar :=  QtdeUtil;
                                      QtdeUtil     := 0;
                                   end
                               else
                                   if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                      begin
                                        QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                        QtdeUtil := QtdeUtil -
                                                    BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                      end;

                               BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                   BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                       QtdeUtilizar;

                               BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                   BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                      ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                        BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                               BUS_CD_M_OPR_OPP_SOP_INT.Insert;
                               // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                               BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                        dmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');
                               BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                      cdsItensSel.FieldByName('id_opr').AsCurrency;
                               BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                               BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                               BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                               BUS_CD_M_OPR_OPP_SOP_INT.Post;

                               BUS_CD_M_OPR_OPP_INT.Last;

                               BUS_CD_M_OPR_OPP_INT.Next;
                             end;

                          {QTD_ATENDER_OPR_EXT =
                                        QTD_ATENDER_OPR_EXT + Saldo Disp. Das
                                                                                                           O.P.R;

                          SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                   QTD_ATENDER_OPR +
                                                                   QTD_ATENDER_OPR_EXT)
                          Observao: O QTD_ATENDER_OPR_EXT e
                          SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                          lembrando que pode ratear, pois pode ser N O.P.Rs.}
                        //end;

                    if (Sld_Disp_Opr = 0) then
                        begin
                          SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency;
                        end;
                   end;


                // Clculo 3
                if SLD_X < cdsItensSel.FieldByName('qtde').AsCurrency then
                   begin
                     if SLD_X > 0 then
                        begin
                          {if Sld_Disp_Opr >= (cdsItensSel.FieldByName('qtde').AsCurrency - SLD_X) then
                             begin
                                SaldoProduzir := 0;

                                // Atualiza as OPR que ir ceder qtde para esta OPR
                                QtdeUtil      :=  Sld_Disp_Opr;
                                while not BUS_CD_M_OPR_OPP_INT.eof do
                                   begin
                                     BUS_CD_M_OPR_OPP_INT.Edit;
                                     if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                         begin
                                            QtdeUtilizar :=  QtdeUtil;
                                            QtdeUtil     := 0;
                                         end
                                     else
                                         if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                            begin
                                              QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                              QtdeUtil := QtdeUtil -
                                                          BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                            end;

                                     BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                         BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                             QtdeUtilizar;

                                     BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                         BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                            ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                              BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                                     BUS_CD_M_OPR_OPP_SOP_INT.Insert;
                                     // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                        dmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                            cdsItensSel.FieldByName('id_opr').AsCurrency;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                                     BUS_CD_M_OPR_OPP_SOP_INT.Post;

                                     BUS_CD_M_OPR_OPP_INT.Last;

                                     BUS_CD_M_OPR_OPP_INT.Next;
                                   end;

                                {QTD_ATENDER_OPR_EXT =
                                              QTD_ATENDER_OPR_EXT + (QTDE. NA OPR  SLD_X);
                                 SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                               QTD_ATENDER_OPR +
                                                                               QTD_ATENDER_OPR_EXT)
                                Observao: O QTD_ATENDER_OPR_EXT e
                                SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                                lembrando que pode ratear, pois pode ser N O.P.Rs.}
                             //end;
                          {if (Sld_Disp_Opr > 0) and (Sld_Disp_Opr < (cdsItensSel.FieldByName('qtde').AsCurrency - SLD_X)) then
                              begin
                                  SaldoProduzir :=  (cdsItensSel.FieldByName('qtde').AsCurrency - SLD_X) - Sld_Disp_Opr;

                                  // Atualiza as OPR que ir ceder qtde para esta OPR
                                  QtdeUtil      :=  Sld_Disp_Opr;
                                  while not BUS_CD_M_OPR_OPP_INT.eof do
                                     begin
                                       BUS_CD_M_OPR_OPP_INT.Edit;
                                       if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                           begin
                                              QtdeUtilizar :=  QtdeUtil;
                                              QtdeUtil     := 0;
                                           end
                                       else
                                           if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                              begin
                                                QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                                QtdeUtil := QtdeUtil -
                                                            BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                              end;

                                       BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                           BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                               QtdeUtilizar;

                                       BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                           BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                              ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                                BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                                       BUS_CD_M_OPR_OPP_SOP_INT.Insert;
                                       // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                           dmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                              cdsItensSel.FieldByName('id_opr').AsCurrency;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                                       BUS_CD_M_OPR_OPP_SOP_INT.Post;

                                       BUS_CD_M_OPR_OPP_INT.Last;

                                       BUS_CD_M_OPR_OPP_INT.Next;
                                     end;



                                  {QTD_ATENDER_OPR_EXT =
                                                QTD_ATENDER_OPR_EXT + Saldo Disp. Das
                                                                                                                O.P.R;
                                  SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                           QTD_ATENDER_OPR +
                                                                           QTD_ATENDER_OPR_EXT)
                                  Observao: O QTD_ATENDER_OPR_EXT e
                                  SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                                  lembrando que pode ratear, pois pode ser N O.P.Rs.}
                              //end;

                          if (Sld_Disp_Opr = 0) then
                              begin
                                 SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency - SLD_X
                              end;
                        end;

                     if SLD_X < 0 then
                        begin
                           {if Sld_Disp_Opr >= cdsItensSel.FieldByName('qtde').AsCurrency then
                              begin
                                SaldoProduzir := 0;

                                // Atualiza as OPR que ir ceder qtde para esta OPR
                                QtdeUtil      :=  cdsItensSel.FieldByName('qtde').AsCurrency;
                                while not BUS_CD_M_OPR_OPP_INT.eof do
                                   begin
                                     BUS_CD_M_OPR_OPP_INT.Edit;
                                     if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                         begin
                                            QtdeUtilizar :=  QtdeUtil;
                                            QtdeUtil     := 0;
                                         end
                                     else
                                         if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                            begin
                                              QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                              QtdeUtil := QtdeUtil -
                                                          BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                            end;

                                     BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                         BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                             QtdeUtilizar;

                                     BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                         BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                            ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                              BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                                     BUS_CD_M_OPR_OPP_SOP_INT.Insert;

                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                        dmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');

                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                            cdsItensSel.FieldByName('id_opr').AsCurrency;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                                     BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                                     BUS_CD_M_OPR_OPP_SOP_INT.Post;

                                     BUS_CD_M_OPR_OPP_INT.Last;

                                     BUS_CD_M_OPR_OPP_INT.Next;
                                   end;


                                {  QTD_ATENDER_OPR_EXT =
                                                QTD_ATENDER_OPR_EXT + QTDE.
                                                                           NA OPR;
                                  SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                           QTD_ATENDER_OPR +
                                                                           QTD_ATENDER_OPR_EXT)
                                  Observao: O QTD_ATENDER_OPR_EXT e
                                  SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                                  lembrando que pode ratear, pois pode ser N O.P.Rs.}
                              //end;

                           {if (Sld_Disp_Opr > 0) and (Sld_Disp_Opr < cdsItensSel.FieldByName('qtde').AsCurrency) then
                              begin
                                  SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency -
                                                  Sld_Disp_Opr;


                                  // Atualiza as OPR que ir ceder qtde para esta OPR
                                  QtdeUtil      :=  Sld_Disp_Opr;
                                  while not BUS_CD_M_OPR_OPP_INT.eof do
                                     begin
                                       BUS_CD_M_OPR_OPP_INT.Edit;
                                       if (QtdeUtil > 0) and (QtdeUtil <= BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                           begin
                                              QtdeUtilizar :=  QtdeUtil;
                                              QtdeUtil     := 0;
                                           end
                                       else
                                           if (QtdeUtil > 0) and (QtdeUtil > BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency) then
                                              begin
                                                QtdeUtilizar := BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency;
                                                QtdeUtil := QtdeUtil -
                                                            BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency
                                              end;

                                       BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency :=
                                           BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency +
                                               QtdeUtilizar;

                                       BUS_CD_M_OPR_OPP_INT.FieldByName('SALDO_DISPONIVEL').AsCurrency :=
                                           BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_A_PRODUZIR').AsCurrency -
                                              ( BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR').AsCurrency +
                                                BUS_CD_M_OPR_OPP_INT.FieldByName('QTDE_ATENDER_OPR_EXT').AsCurrency);



                                       BUS_CD_M_OPR_OPP_SOP_INT.Insert;
                                       // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_SOP').AsInteger :=
                                           DmApoio.enBusValorChave('PCP_TB_M_OPR_OPP_SOP');
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('ID_OPR_EXT').AsCurrency :=
                                              cdsItensSel.FieldByName('id_opr').AsCurrency;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('dta_utilizado').AsDateTime := Date;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('hor_utilizado').AsDateTime := Time;
                                       BUS_CD_M_OPR_OPP_SOP_INT.FieldByName('qtd_utilizado').AsCurrency := QtdeUtilizar;
                                       BUS_CD_M_OPR_OPP_SOP_INT.Post;

                                       BUS_CD_M_OPR_OPP_INT.Last;

                                       BUS_CD_M_OPR_OPP_INT.Next;
                                     end;
                                 {QTD_ATENDER_OPR_EXT =
                                                QTD_ATENDER_OPR_EXT + Saldo Disp. Das
                                                                                                                O.P.R;
                                 SALDO_DISPONIVEL =  QTDE_A_PRODUZIR  (
                                                                           QTD_ATENDER_OPR +
                                                                           QTD_ATENDER_OPR_EXT)
                                 Observao: O QTD_ATENDER_OPR_EXT e
                                 SALDO_DISPONIVEL, das O.P.R deve ser atualizada,
                                 lembrando que pode ratear, pois pode ser N O.P.Rs.}
                              //end;

                           if (Sld_Disp_Opr = 0) then
                               begin
                                 SaldoProduzir := cdsItensSel.FieldByName('qtde').AsCurrency;
                               end;
                        end;
                   end;
             end;
          cdsItensSel.Edit;

          if calc_saldo_a_produzir then
             begin
                cdsItensSel.FieldByName('saldo_fisico_momento').AsCurrency        := saldo_fisico;
                cdsItensSel.FieldByName('saldo_pendente').AsCurrency              := QtdePendente;
                cdsItensSel.FieldByName('saldo_disponivel_outras_opr').AsCurrency := Sld_Disp_Opr;

                cdsItensSel.FieldByName('saldo_disponivel').AsCurrency := Sld_Disponivel;
                cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency := SaldoProduzir;

                if SaldoProduzir > 0 then
                   begin
                     if qryBus.Locate('id_item',cdsItensSel.FieldByName('id_item').AsString,[]) then
                        begin
                          CubagemAproduzir := CubagemAproduzir +
                                              (qryBus.FieldByName('cubagem').AsCurrency  *
                                               cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency);
                        end;
                   end;
             end
          else
             begin
                cdsItensSel.FieldByName('saldo_disponivel').AsCurrency :=   0;
                cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency :=
                            cdsItensSel.FieldByName('qtde').AsCurrency;


                if qryBus.Locate('id_item',cdsItensSel.FieldByName('id_item').AsString,[]) then
                   begin
                      CubagemAproduzir := CubagemAproduzir +
                                          (qryBus.FieldByName('cubagem').AsCurrency  *
                                           cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency);
                   end;
             end;

          BUS_CD_M_OPR_OPP_INT.Filtered := false;
          cdsItensSel.Post;
          cdsItensSel.Next;
       end;

    qryOpp.Close;
    qryOpp.SQL.Clear;
    qryOpp.SQL.Add(
            ' select coalesce(max(opp.id_opr_opp),0) id_opr_opp from pcp_tb_m_opr_opp opp ' +
            ' where opp.id_opr = ''' + vartostr(IdOpr)+ ''' ' );
    qryOpp.Open;
    if not qryOpp.IsEmpty then
       begin
         UltIdOppOpp := qryOpp.FieldByName('id_opr_opp').AsInteger;
       end;
    qryOpp.Close;

    // Ir inserir os itens com as quantidades de saldo a produzir que foi calculado
    cdsItensSel.First;
    while not cdsItensSel.Eof do
       begin
         inc(UltIdOppOpp);

         BUS_CD_M_OPR_OPP_INT.Insert;
         BUS_CD_M_OPR_OPP_INT.FieldByName('id_opr').AsInteger      :=
                              cdsItensSel.FieldByName('id_opr').AsInteger;
         BUS_CD_M_OPR_OPP_INT.FieldByName('id_opr_opp').AsInteger  := UltIdOppOpp;
         BUS_CD_M_OPR_OPP_INT.FieldByName('id_item').AsInteger     :=
                              cdsItensSel.FieldByName('id_item').AsInteger;
         BUS_CD_M_OPR_OPP_INT.FieldByName('id_cor').AsInteger      :=
                              cdsItensSel.FieldByName('id_cor').AsInteger;
         BUS_CD_M_OPR_OPP_INT.FieldByName('id_tamanho').AsInteger  :=
                              cdsItensSel.FieldByName('id_tamanho').AsInteger;
         BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_a_produzir_orig').AsCurrency :=
                              cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency;
         BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_a_produzir').AsCurrency      :=
                              cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency;
         BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_produzida').AsCurrency        := 0;
         BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_atender_opr').AsCurrency      :=
                              cdsItensSel.FieldByName('saldo_a_produzir').AsCurrency;
         BUS_CD_M_OPR_OPP_INT.FieldByName('gerado_aut').AsBoolean := true;
         BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_atender_opr_ext').AsCurrency  := 0;
         BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel').AsCurrency      := 0;
         BUS_CD_M_OPR_OPP_INT.FieldByName('reg_alt').AsBoolean := false;
         BUS_CD_M_OPR_OPP_INT.FieldByName('pcp_desc_item_person').AsString :=
                    cdsItensSel.FieldByName('pcp_obs_item').AsString;

         BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_fisico_momento').AsCurrency :=
            cdsItensSel.FieldByName('saldo_fisico_momento').AsCurrency;

         BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_pendente').AsCurrency :=
            cdsItensSel.FieldByName('saldo_pendente').AsCurrency;

         BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disponivel_est').AsCurrency :=
            cdsItensSel.FieldByName('saldo_disponivel').AsCurrency;

         BUS_CD_M_OPR_OPP_INT.FieldByName('saldo_disp_outras_opr').AsCurrency :=
            cdsItensSel.FieldByName('saldo_disponivel_outras_opr').AsCurrency;

         if (trim(BUS_CD_M_OPR_OPP_INT.FieldByName('pcp_desc_item_person').AsString) <> '') or
            (BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_a_produzir').AsCurrency = 0) or
            (PreparaGeracaoBloco = 0) then
             BUS_CD_M_OPR_OPP_INT.FieldByName('bloco_gerado').AsInteger := 0
         else
             BUS_CD_M_OPR_OPP_INT.FieldByName('bloco_gerado').AsInteger := 1;


         BUS_CD_M_OPR_OPP_INT.FieldByName('criado_em').AsDateTime   := Date;
         BUS_CD_M_OPR_OPP_INT.FieldByName('hora_criado').AsDateTime := Time;

         BUS_CD_M_OPR_OPP_INT.Post;
         cdsItensSel.Next;
       end;

    BUS_CD_M_OPR_PED_INT.SetProvider(BUS_DP_M_OPR_PED_INT);
    BUS_CD_M_OPR_PED_INT.Close;
    BUS_CD_M_OPR_PED_INT.Data :=
        BUS_CD_M_OPR_PED_INT.DataRequest(VarArrayOf([0, IdOpr]));

    // Atualiza os pedidos de venda informando o cdigo da Ordem de Produo e pega a obs
    // da produo dos pedidos




    ObsProducao := '';

    BUS_CD_M_PED_INT.SetProvider(BUS_DP_M_PED_INT);
    BUS_CD_M_PED_INT.Close;
    BUS_CD_M_PED_INT.Data :=
        BUS_CD_M_PED_INT.DataRequest(VarArrayOf([0, IdEmpresa, PedSel]));

    // Itens dos pedidos
    BUS_CD_M_PED_ITT_INT := TClientDataSet.Create(nil);
    BUS_CD_M_PED_ITT_INT.DataSetField := TDataSetField(BUS_CD_M_PED_INT.FieldByName('BUS_SQ_M_PED_ITT_INT'));

    BUS_CD_M_PED_INT.First;
    while not BUS_CD_M_PED_INT.eof do
       begin
         if trim(BUS_CD_M_PED_INT.FieldByName('pcp_obs').AsString) <> '' then
            ObsProducao := ObsProducao + BUS_CD_M_PED_INT.FieldByName('pcp_obs').AsString + ' / ';

         BUS_CD_M_PED_INT.Edit;
         BUS_CD_M_PED_INT.FieldByName('pcp_id_opr').AsString := IdOpr;
         BUS_CD_M_PED_INT.FieldByName('situacao').AsInteger := 2;
         BUS_CD_M_PED_INT.Post;

         BUS_CD_M_OPR_PED_INT.Insert;
         BUS_CD_M_OPR_PED_INT.FieldByName('id_opr').AsString    := IdOpr;
         BUS_CD_M_OPR_PED_INT.FieldByName('id_pedido').AsInteger :=
                      BUS_CD_M_PED_INT.FieldByName('id_pedido').AsInteger;
         BUS_CD_M_OPR_PED_INT.FieldByName('remanejado').AsBoolean := false;
         BUS_CD_M_OPR_PED_INT.FieldByName('origem_insercao').AsInteger := 0; // Importado pela O.P
         BUS_CD_M_OPR_PED_INT.FieldByName('id_responsavel').AsString   := IdResp;
         BUS_CD_M_OPR_PED_INT.FieldByName('dta_importacao').AsDateTime := Date;
         BUS_CD_M_OPR_PED_INT.FieldByName('hor_importacao').AsDateTime := Time;

         BUS_CD_M_OPR_PED_INT.Post;

         // 24-04-2018 por Maxsuel victor
            // No ser mais preciso o cdigo abaixo pois o item 404 ou personalizado , ser criado no opr_opp
            // de acordo com seu item , cor , tamanho e pcp_obs_item

         // Itens do pedido de venda
         {BUS_CD_M_PED_ITT_INT.First;
         while not BUS_CD_M_PED_ITT_INT.eof do
            begin
              if BUS_CD_M_PED_ITT_INT.FieldByName('id_item').AsString = Item_SobMedida then
                 begin
                   if BUS_CD_M_OPR_OPP_INT.Locate('id_item;id_cor;id_tamanho',
                                            VarArrayOf([BUS_CD_M_PED_ITT_INT.FieldByName('id_item').AsString,
                                                        BUS_CD_M_PED_ITT_INT.FieldByName('id_cor').AsString,
                                                        BUS_CD_M_PED_ITT_INT.FieldByName('id_tamanho').AsString]),[]) then
                      begin
                        BUS_CD_M_OPR_OPP_INT.Edit;
                        BUS_CD_M_OPR_OPP_INT.FieldByName('obs_producao').AsString :=
                            BUS_CD_M_OPR_OPP_INT.FieldByName('obs_producao').AsString +
                               trim(BUS_CD_M_PED_ITT_INT.FieldByName('pcp_obs_item').AsString) + '  /  ';
                        BUS_CD_M_OPR_OPP_INT.Post;
                      end;
                 end;
              BUS_CD_M_PED_ITT_INT.Next;
            end;
          }
         BUS_CD_M_PED_INT.Next;
       end;

    // Busca todos os itens da O.P que precisa ser produzido.
    qryBus.Close;
    qryBus.SQL.Clear;
    qryBus.SQL.Add(
            ' select coalesce(sum(ite.cubagem * opp.qtde_a_produzir),0) as tot_cubagem_a_prod ' +
            ' from pcp_tb_m_opr_opp opp ' +
            '   left outer join cad_tb_c_ite ite on (ite.id_item = opp.id_item) ' +
            ' where opp.id_opr = ''' + vartostr(IdOpr)+ ''' ' +
            '   and qtde_a_produzir > 0 ') ;
    qryBus.Open;
    if not qryBus.IsEmpty then
       begin
         CubagemAproduzir := CubagemAproduzir + qryBus.FieldByName('tot_cubagem_a_prod').AsCurrency;
       end;
    qryBus.Close;


    // Atualiza a cubagem a produzir da O.P
    PCP_CD_M_OPR.SetProvider(PCP_DP_M_OPR);
    PCP_CD_M_OPR.Close;
    PCP_CD_M_OPR.Data :=
        PCP_CD_M_OPR.DataRequest(VarArrayOf([0, IdEmpresa,IdOpr]));
    if not PCP_CD_M_OPR.IsEmpty then
       begin
         PCP_CD_M_OPR.Edit;
         if trim(PCP_CD_M_OPR.FieldByName('obs_producao').AsString) = '' then
            begin
              if trim(ObsProducao) <> '' then
                 PCP_CD_M_OPR.FieldByName('obs_producao').AsString   := ObsProducao
            end
         else
            if trim(ObsProducao) <> '' then
               PCP_CD_M_OPR.FieldByName('obs_producao').AsString   :=
                  PCP_CD_M_OPR.FieldByName('obs_producao').AsString + ObsProducao;

         PCP_CD_M_OPR.FieldByName('cub_produzir').AsCurrency :=
              CubagemAproduzir;
         PCP_CD_M_OPR.Post;
       end;

    // Gera a requisio de Material.
    PCP_CD_M_OPR_REQ     := TClientDataSet.Create(nil);
    PCP_CD_M_OPR_REQ.SetProvider(PCP_DP_M_OPR_REQ);
    PCP_CD_M_OPR_REQ.Close;
    PCP_CD_M_OPR_REQ.Data :=
       PCP_CD_M_OPR_REQ.DataRequest(VarArrayOf([0,'']));

    PCP_CD_M_OPR_REQ_ITE := TClientDataSet.Create(nil);
    PCP_CD_M_OPR_REQ_ITE.DataSetField  := TDataSetField(PCP_CD_M_OPR_REQ.FieldByName('PCP_SQ_M_OPR_REQ_ITE'));

    enSgqPcpGerarReq(StrToInt(IdEmpresa),StrToInt(IdOpr),StrToInt(IdResp),AlmSel,PCP_CD_M_OPR_REQ,cdsItensSel,PCP_CD_M_OPR_REQ_ITE);

    // Gera as Ordem de Produo dos Setores
    PCP_CD_M_OPR_OPS := TClientDataSet.Create(nil);
    PCP_CD_M_OPR_OPS.DataSetField  := TDataSetField(PCP_CD_M_OPR.FieldByName('PCP_SQ_M_OPR_OPS'));

    enSgqPcpGerarOps(StrToInt(IdEmpresa),StrToInt(IdOpr),PCP_CD_M_OPR.FieldByName('id_tpp').AsInteger,
                     PCP_CD_M_OPR_OPS,cdsItensSel,BUS_CD_M_OPR_OPP_INT);

    // Gera as Etiquetas
    PCP_CD_M_ETQ := TClientDataSet.Create(nil);
    enSgqPcpGerarEtq(StrToInt(IdEmpresa),StrToInt(IdOpr),PCP_CD_M_ETQ,cdsItensSel);


    result := cdsItensSel.Data;
    try
        Conn  := BuscarConnBanco;
        Vtran := Conn.BeginTransaction;

        try
          if BUS_CD_M_PED_INT <> nil then
             if BUS_CD_M_PED_INT.ChangeCount > 0 then
                if not (BUS_CD_M_PED_INT.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar atualizar o pedido de venda.';
                     abort;
                   end;

          if BUS_CD_M_OPR_PED_INT <> nil then
             if BUS_CD_M_OPR_PED_INT.ChangeCount > 0 then
                if not (BUS_CD_M_OPR_PED_INT.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar inserir o pedido de venda na Ordem de Produo.';
                     abort;
                   end;

          if BUS_CD_M_OPR_OPP_INT <> nil then
             if BUS_CD_M_OPR_OPP_INT.ChangeCount > 0 then
                if not (BUS_CD_M_OPR_OPP_INT.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar atualizar o saldo disponvel nas OPRs.';
                     abort;
                   end;

          if PCP_CD_M_OPR <> nil then
             if PCP_CD_M_OPR.ChangeCount > 0 then
                if not (PCP_CD_M_OPR.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar atualizar a cubagem a produzir.';
                     abort;
                   end;


          if PCP_CD_M_OPR_REQ <> nil then
             if PCP_CD_M_OPR_REQ.ChangeCount > 0 then
                if not (PCP_CD_M_OPR_REQ.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar gerar a requisio da O.P.';
                     abort;
                   end;


          if PCP_CD_M_ETQ <> nil then
             if PCP_CD_M_ETQ.ChangeCount > 0 then
                if not (PCP_CD_M_ETQ.ApplyUpdates(0) = 0) then
                   begin
                     mens_Erro := 'Erro ao tentar gerar as etiquetas da O.P.';
                     abort;
                   end;

        except
           on e: exception do
              begin
                 raise Exception.Create(mens_Erro + #13 + e.Message);
              end;
        end;

      if mens_Erro = '' then
         Conn.CommitFreeAndNil(Vtran);
    finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
    end;

  finally
     FreeAndNil(BUS_CD_C_PAR_CTR);
     FreeAndNil(qryPed);
     FreeAndNil(qryOpr);
     FreeAndNil(qryBus);
     FreeAndNil(cdsItensSel);
     FreeAndNil(cdsTempItens);
     FreeAndNil(BUS_CD_M_OPR_OPP_INT);
     FreeAndNil(EST_CD_M_FES_ALM);
     FreeAndNil(BUS_CD_M_OPR_OPP_SOP_INT);
     FreeAndNil(BUS_CD_M_PED_ITT_INT);
     FreeAndNil(BUS_CD_M_PED_INT);
     FreeAndNil(PCP_CD_M_OPR_OPS);
  end;

end;



function TSM.enSgqPcpVerifEtqRomPed(IdEmpresa, IdPedido,
  CodBarra: String): string;
begin
  {TODO -oMaxsuel -cIncluso :
   Mtodo criado em 11/12/2016
   Este mtodo tem a funo de verificar se a etiqueta j foi usada em outra conferncia.}
   result := PCP_RN_M_ROM.enSgqPcpVerifEtqRomPed(IdEmpresa,IdPedido,CodBarra,BuscarConnBanco);

end;

function TSM.enSgqVefPedRom(id_pedido: String): Integer;
begin
  {TODO -oMaxsuel -cIncluso :
   Mtodo criado em 23/02/2016
   Este mtodo tem a funo de verificar se o pedido de venda esta com romaneiro.}
   result := PCP_RN_M_ROM.enSgqVefPedRom(id_pedido,BuscarConnBanco);
end;

procedure TSM.AtualizarIQM(Sender: TObject; DataSet: TCustomClientDataSet);
var
  FAT_CD_M_IQM: TClientdataset;
begin

  if (dataset.UpdateStatus in [usInserted,usDeleted]) then
     begin
        if DataSet.FieldByName('ID_IQM').AsInteger > 0 then
           begin
             try
               FAT_CD_M_IQM := TClientDataSet.Create(self);
               FAT_CD_M_IQM.SetProvider(FAT_DP_M_IQM);

               FAT_CD_M_IQM.Close;
               FAT_CD_M_IQM.Data :=
                     FAT_CD_M_IQM.DataRequest(
                         VarArrayOf([0,dataset.FieldByName('id_iqm').AsInteger]));

               if (dataset.UpdateStatus in [usInserted]) then
                   begin
                     if not FAT_CD_M_IQM.IsEmpty then
                        begin
                          FAT_CD_M_IQM.Edit;
                          FAT_CD_M_IQM.FieldByName('SITUACAO').AsInteger := 1;
                          FAT_CD_M_IQM.Post;
                        end;
                   end;
               if (dataset.UpdateStatus in [usDeleted]) then
                   begin
                     if not FAT_CD_M_IQM.IsEmpty then
                        begin
                          FAT_CD_M_IQM.Edit;
                          FAT_CD_M_IQM.FieldByName('SITUACAO').AsInteger := 0;
                          FAT_CD_M_IQM.Post;
                        end;
                   end;
               if not (FAT_CD_M_IQM.ApplyUpdates(0) = 0) then
                  begin
                    abort;
                  end;
             finally
                FAT_CD_M_IQM.Free;
             end;
           end;
     end;
end;

function TSM.BuscarConnBanco: TSQLConnection;
var
  MySession: TDSSession;
  Conn: TSQLConnection;
  Id: String;
begin
  { MySession := TDSSessionManager.GetThreadSession;
  Id:= VarToStr(MySession.Id);
  if MySession.HasData('Conn') then
     begin
       Conn := MySession.GetObject(Id) as TSQLConnection;
       showmessage(conn.DriverName);
       result := Conn;
     end;  }
   if Connections.ContainsKey(TDSSessionManager.GetThreadSession.Id) then
      Result := Connections[TDSSessionManager.GetThreadSession.Id]

end;

function TSM.BUS_DP_M_FEA_SLDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_FEA_SLD.Close;
   BUS_SQ_M_FEA_SLD.CommandText := '';
   if VarToStr(Input[1])<>'' then
    begin
     if VarToStr(Input[2])='' then
        begin
           BUS_SQ_M_FEA_SLD.CommandText :=
             ' select       '+
             ' (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea  '+
             '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
             '      where fea.id_empresa  = sss.id_empresa and  '+
             '            fea.id_almoxarifado = sss.id_almoxarifado and '+
             '            fea.id_item     = sss.id_item    and  '+
             '            fea.id_cor      = sss.id_cor     and  '+
             '            fea.id_tamanho  = sss.id_tamanho and  '+
             '            tme.tipo_movimento = 0                '+
             '           ),0) -    '+

             ' coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea '+
             '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
             '      where fea.id_empresa = sss.id_empresa and '+
             '            fea.id_almoxarifado = sss.id_almoxarifado and '+
             '            fea.id_item    = sss.id_item    and '+
             '            fea.id_cor     = sss.id_cor     and '+
             '            fea.id_tamanho  = sss.id_tamanho and '+
             '            tme.tipo_movimento = 1),0) ) as saldo_fisico  '+

             '       from est_tb_m_fes_alm sss  '+
             '         where sss.id_empresa = '''+VarToStr(Input[0])+''' and sss.id_almoxarifado = '''+VarToStr(Input[1])+ ''' '+
             '                and sss.id_item = '''+VarToStr(Input[3])+''' ' +
             '                and sss.id_cor = '''+VarToStr(Input[4])+''' and sss.id_tamanho = '''+VarToStr(Input[5])+''' ';
        end
      else
        begin
            BUS_SQ_M_FEA_SLD.CommandText :=
             ' select       '+
             ' (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea  '+
             '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
             '      where fea.id_empresa  = sss.id_empresa and  '+
             '            fea.id_almoxarifado = sss.id_almoxarifado and '+
             '            fea.num_lote = sss.num_lote and '+
             '            fea.id_item     = sss.id_item    and  '+
             '            fea.id_cor      = sss.id_cor     and  '+
             '            fea.id_tamanho  = sss.id_tamanho and  '+
             '            tme.tipo_movimento = 0                '+
             '           ),0) -    '+

             ' coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea '+
             '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
             '      where fea.id_empresa = sss.id_empresa and '+
             '            fea.id_almoxarifado = sss.id_almoxarifado and '+
             '            fea.num_lote = sss.num_lote and '+
             '            fea.id_item    = sss.id_item    and '+
             '            fea.id_cor     = sss.id_cor     and '+
             '            fea.id_tamanho  = sss.id_tamanho and '+
             '            tme.tipo_movimento = 1),0) ) as saldo_fisico  '+

             '       from est_tb_m_lot sss  '+
             '         where sss.id_empresa = '''+VarToStr(Input[0])+''' and sss.id_almoxarifado = '''+VarToStr(Input[1])+ ''' '+
             '                and sss.num_lote = '''+VarToStr(Input[2])+''' sss.id_item = '''+VarToStr(Input[3])+''' ' +
             '                and sss.id_cor = '''+VarToStr(Input[4])+''' and sss.id_tamanho = '''+VarToStr(Input[5])+''' ';
        end;
    end
  else
    begin
       BUS_SQ_M_FEA_SLD.CommandText :=
         ' select       '+
         ' (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea  '+
         '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
         '      where fea.id_empresa  = sss.id_empresa and  '+
         '            fea.id_item     = sss.id_item    and  '+
         '            fea.id_cor      = sss.id_cor     and  '+
         '            fea.id_tamanho  = sss.id_tamanho and  '+
         '            tme.tipo_movimento = 0                '+
         '           ),0) -    '+

         ' coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea '+
         '         left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
         '      where fea.id_empresa = sss.id_empresa and '+
         '            fea.id_item    = sss.id_item    and '+
         '            fea.id_cor     = sss.id_cor     and '+
         '            fea.id_tamanho  = sss.id_tamanho and '+
         '            tme.tipo_movimento = 1),0) ) as saldo_fisico  '+

         '       from est_tb_m_fes sss  '+
         '         where sss.id_empresa = '''+VarToStr(Input[0])+'''  and sss.id_item = '''+VarToStr(Input[3])+''' ' +
         '                and sss.id_cor = '''+VarToStr(Input[4])+''' and sss.id_tamanho = '''+VarToStr(Input[5])+''' ';
    end;

    Result := BUS_DP_M_FEA_SLD.Data;

end;

function TSM.BUS_DP_BR_CUPOM_DETALHEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusBrCupomDet:string;
begin
    enSqlBusBrCupomDet :=
             ' SELECT BCD.* FROM BR_CUPOM_DETALHE BCD '+
             ' WHERE BCD.N_CUPOM ='''+ VarToStr(Input[0])+''' ';


   BUS_SQ_BR_CUPOM_DETALHE.Close;

   BUS_SQ_BR_CUPOM_DETALHE.CommandText := '';
   BUS_SQ_BR_CUPOM_DETALHE.CommandText := enSqlBusBrCupomDet;

   Result := BUS_DP_BR_CUPOM_DETALHE.Data;
end;

function TSM.BUS_DP_BR_PREVENDADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusBrPreVenda: String;
begin


   { TODO -oMaxsuel -cCriao :
      Criado por Maxsuel Victor em 09-03-2015

      // Busca as formas de pagamento do cupom fiscal em questo
         agrupando por cdigo de forma de pagemento da ECF }


   // input[0] - Cdigo da pr-venda

   enSqlBusBrPreVenda :=
                    ' Select BCP.COD_FORMA_PAG, BCP.QTD_PARCELA, coalesce(SUM(VALOR),0) VALOR FROM BR_CUPOM_PAGAMENTO BCP ' +
                    ' left outer join BR_CUPOM_MESTRE BCM on ' +
                    '  (BCM.N_CUPOM = BCP.N_CUPOM AND        ' +
                    '   BCM.SERIAL_IMPRESSORA = BCP.SERIAL_IMPRESSORA) ' +
                    ' left outer join  BR_PREVENDA BPR on ' +
                    '  (BCM.N_CUPOM           = BPR.N_CUPOM AND ' +
                    '   BCM.SERIAL_IMPRESSORA = BPR.SERIAL)  '     +
                    ' WHERE BPR.NUMPREVENDA = ''' + VarToStr(Input[0]) +''' ' +
                    ' GROUP BY BCP.COD_FORMA_PAG, BCP.QTD_PARCELA ' +
                    ' ORDER BY BCP.COD_FORMA_PAG, BCP.QTD_PARCELA ';

   BUS_SQ_BR_PREVENDA.Close;

   BUS_SQ_BR_PREVENDA.CommandText := '';
   BUS_SQ_BR_PREVENDA.CommandText := enSqlBusBrPreVenda;

   Result := BUS_DP_BR_PREVENDA.Data;
end;

function TSM.BUS_DP_BR_PREVENDA_DETALHEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusBrPreVendaDet:string;
begin
    enSqlBusBrPreVendaDet :=
             ' SELECT BCD.* FROM BR_PREVENDA_DETALHE BCD '+
             ' WHERE BCD.NUMPREVENDA ='''+ VarToStr(Input[0])+''' ';


   BUS_SQ_BR_PREVENDA_DETALHE.Close;

   BUS_SQ_BR_PREVENDA_DETALHE.CommandText := '';
   BUS_SQ_BR_PREVENDA_DETALHE.CommandText := enSqlBusBrPreVendaDet;

   Result := BUS_DP_BR_PREVENDA_DETALHE.Data;
end;

function TSM.BUS_DP_CSU_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlIte: String;
  begin
    Result :=
        'SELECT ITE.*,NCM.DESCRICAO AS INT_NOMENCM, GRU.CTC_EPI INT_CTC_EPI, '+
        '   GRU.DESCRICAO INT_DESC_GRUPO, '+
        '   GRU.TIPO_ITEM INT_TIPO_ITEM, '+
        '   GRU.ORIGEM_MERCADORIA INT_ORIGEM, '+
        '   GRU.ID_TRIBUTO INT_TRIBUTO, '+
        '   GRU.MVA INT_MVA, FON.DESCRICAO AS INT_NOMEFOR, '+
        '   GRU.ID_FTE_ETQ AS INT_FTEETQ, ' +
        '   GRU.UTILIZA_LOTE AS INT_LOTE_GRU '+
        'FROM CAD_TB_C_ITE ITE '+
        'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
        'LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
        'LEFT OUTER JOIN CAD_TB_C_NCM NCM ON NCM.ID_NCM = ITE.ID_NCM ';
  end;
var
  tam: integer;
  form_chamou: string;
  vendedor_int_ext: string;
  txt: String;
begin
   BUS_SQ_CSU_ITE.Close;

   form_chamou := '';

   if copy(input[1],1,12) = 'CTC_FM_M_CEP' then
      begin
        form_chamou :=  copy(input[1],1,12);
        tam := Length(input[1]);
        input[1] := copy(input[1],13,tam);
      end;

   // if inserido em 11/09/2023, por Maxsuel Victor
   if copy(input[1],1,12) = 'FAT_FM_M_PED' then
      begin
        form_chamou :=  copy(input[1],1,12);
        vendedor_int_ext := copy(input[1],14,1);
        tam := Length(input[1]);
        input[1] := copy(input[1],15,tam);
        txt := input[1];
      end;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_CSU_ITE.CommandText := enSqlIte + ' WHERE 1=2 '
        else
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_ITEM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_CSU_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.COD_BARRA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             Format('WHERE upper(ITE.COD_FABRICA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' LEFT OUTER JOIN CAD_TB_C_ITE_LOC LOC ON LOC.ID_EMPRESA='''+VarToStr(Input[4])+''' AND LOC.ID_ITEM=ITE.ID_ITEM '+
             ' WHERE LOC.LOCA_RUA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        BUS_SQ_CSU_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.APLICACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 6 then
      begin
        BUS_SQ_CSU_ITE.CommandText := enSqlIte +
          Format('WHERE upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 7 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_GRUPO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 8 then
      begin
        BUS_SQ_CSU_ITE.CommandText := enSqlIte +
          Format('WHERE upper(GRU.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 9 then
      begin
        BUS_SQ_CSU_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.REFERENCIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 10 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_NCM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 11 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ATIVO = true and ITE.DESTINO_RECLAMADO in (''1'',''2'') ';
      end
   else if Input[0] = 12 then
      begin
           BUS_SQ_CSU_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_FORNECEDOR= ''' + VarToStr(Input[1]) +''' ';
      end;

   // if inserido em 11/09/2023, por Maxsuel Victor
   if form_chamou = 'FAT_FM_M_PED' then
      begin
         if vendedor_int_ext = '1' then // vendedor externo
            begin
              BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
                 ' AND coalesce(ITE.sgq_personalizado,false) = false ';
            end;
      end;


   BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText + ' AND ITE.ATIVO=TRUE ';

   if Input[2] <> '' then
      begin
           BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
              ' AND GRU.TIPO_ITEM = ''' + VarToStr(Input[2]) +''' ';
      end;

   if form_chamou = 'CTC_FM_M_CEP' then
      begin
        BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
                                      ' AND GRU.CTC_EPI = TRUE ';
      end;

   if Input[3] = 0 then
      begin
        BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
           ' ORDER BY ITE.ID_GRUPO, ITE.ID_ITEM ';
      end;
   if Input[3] = 1 then
      begin
        BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
           ' ORDER BY INT_DESC_GRUPO, ITE.ID_ITEM ';
      end;
   if Input[3] = 2 then
      begin
        BUS_SQ_CSU_ITE.CommandText := BUS_SQ_CSU_ITE.CommandText +
           ' ORDER BY ITE.DESCRICAO ';
      end;


  // GerarSqlTxt(BUS_SQ_CSU_ITE);
   Result := BUS_DP_CSU_ITE.Data;
end;

function TSM.BUS_DP_C_ANVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  BUS_SQ_C_ANV.Close;

  BUS_SQ_C_ANV.CommandText :=
    ' SELECT * FROM cad_tb_c_cli '+
    ' WHERE (EXTRACT(MONTH FROM dta_nascimento) = '''+VarToStr(Input[0])+''') ';

  Result := BUS_DP_C_ANV.Data;
end;

function TSM.BUS_DP_C_CLI_EMLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_C_CLI_EML.Close;
   BUS_SQ_C_CLI_EML.CommandText :=
           ' SELECT EMAIL FROM CAD_TB_C_CLI_EML '+
           ' WHERE ID_CLIENTE = '''+VarToStr(Input[0])+''' ';
   Result := BUS_DP_C_CLI_EML.Data;
end;

function TSM.BUS_DP_C_CLI_EST_MPADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  mes:Integer;
  enSqlMpa:String;
begin

   enSqlMpa :=
      ' select '+
      ' NFE.ID_EMPRESA, '+
      ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
      ' NFE.ID_TIPO_MOV_ESTOQUE, '+
      ' TME.DESCRICAO AS INT_NOMETME, '+
      ' Extract(year from NFE.DTA_EMISSAO ) as ano, '+
      ' SUM(COALESCE(NFE.VLR_LIQUIDO,0))  as valor ';

   for mes := 1 to 12 do
       enSqlMpa :=enSqlMpa +
         '  ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))  '+
         '   when '+IntToStr(mes)+' then NFE.VLR_LIQUIDO              '+
         '  end),0) as mes_'+FormatFloat('00',mes)+'                  ';


   enSqlMpa :=enSqlMpa +
       ' FROM FAT_TB_M_NFE_ITE NIT                               '+
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
       ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
       ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE ';


   BUS_SQ_C_CLI_EST_MPA.Close;
   BUS_SQ_C_CLI_EST_MPA.CommandText := enSqlMpa;

   BUS_SQ_C_CLI_EST_MPA.CommandText := BUS_SQ_C_CLI_EST_MPA.CommandText +
     '  WHERE nfe.id_emitente='''+VarToStr(Input[0])+''' AND                 '+
     '  NFE.TIPO_NF IN (''R'',''S'') and  nfe.status=1 and                   '+
     '  nfe.faturada=true and  nfe.nfe_cod_sit not in (''02'',''04'',''05'') '+
     ' group by 1,2,3,4,5                                                    '+
     ' ORDER BY  NFE.ID_EMPRESA,INT_NOMETME, ANO DESC ';


    Result := BUS_DP_C_CLI_EST_MPA.Data;
    BUS_SQ_C_CLI_EST_MPA.Close;
end;

function TSM.BUS_DP_C_CLI_EST_SRHDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlSrh: String;
  begin
    Result :=
     ' select '+
     ' NFE.ID_EMPRESA, '+
     ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
     ' Extract(year from NFE.DTA_EMISSAO ) as ano, '+
     ' SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) as valor '+
     ' FROM FAT_TB_M_NFE_ITE NIT                             '+
     ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
     ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
     ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO ';
  end;
VAR
  DataSistema:TDateTime;
  anoIni,anoFinal:String;
begin
   BUS_SQ_C_CLI_EST_SRH.Close;
   BUS_SQ_C_CLI_EST_SRH.CommandText := enSqlSrh;

   DataSistema := enDataServer;
   anoFinal := FormatDateTime('yyyy',DataSistema);
   anoIni   := FormatDateTime('yyyy',IncYear(DataSistema,-3));

   BUS_SQ_C_CLI_EST_SRH.CommandText := BUS_SQ_C_CLI_EST_SRH.CommandText +
     '  WHERE nfe.id_emitente='''+VarToStr(Input[0])+''' and '+
     '  Extract(year from NFE.DTA_EMISSAO ) >='''+anoIni +''' and '+
     '  Extract(year from NFE.DTA_EMISSAO ) <='''+anoFinal +''' and '+
     '  CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND '+
     '        NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
     ' group by 1,2,3 '+
     ' order by  NFE.ID_EMPRESA,ano DESC ';

    Result := BUS_DP_C_CLI_EST_SRH.Data;
    BUS_SQ_C_CLI_EST_SRH.Close;
end;

function TSM.BUS_DP_C_CLI_EST_VNPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
 enSqlVnp:String;
 DataSistema,DataFinal,DataInicial:TDateTime;
 BUS_CD_C_PAR:TClientDataSet;
 i,indexEmp:integer;
begin

   BUS_CD_C_PAR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR.SetProvider(CAD_DP_C_PAR);
   BUS_CD_C_PAR.Close;
   BUS_CD_C_PAR.Data :=
           BUS_CD_C_PAR.DataRequest(VarArrayOf([1,'%']));
   BUS_SQ_C_CLI_EST_VNP.Close;

   DataSistema := enDataServer;
  indexEmp :=0;
   enSqlVnp := '';
   while not BUS_CD_C_PAR.eof do
     begin

       enSqlVnp :=   enSqlVnp +
         ' (select '+
         ' NFE.ID_EMPRESA, '+
         ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
         ' COALESCE(NIT.ID_ITEM,0) AS INT_COD_ITE, '+
         ' CAST (CASE '+
         '     WHEN ITE.DESCRICAO IS NULL THEN ''INDEFINIDO'' '+
         '     ELSE ITE.DESCRICAO END AS VARCHAR(50)) AS INT_NOMEITE, '+
         ' SUM(COALESCE(NIT.QTDE-NIT.QTDE_DEVOLVIDA,0)) as valor ';
         for I := 1 to 12 do
           begin
             DataFinal := StrToDate(UltimoDiaDoMes(IncMonth(DataSistema,-6+i))+'/'+FormatDateTime('mm',IncMonth(DataSistema,-6+i))+'/'+FormatDateTime('yyyy',IncMonth(DataSistema,-6+i)));
             DataInicial := StrToDate('01'+'/'+  FormatDateTime('mm',IncMonth(DataSistema,-6+i))+'/'+FormatDateTime('yyyy',IncMonth(DataSistema,-6+i)) );
             enSqlVnp :=  enSqlVnp +
              ' ,COALESCE(sum(case '+
              ' when NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy', DataInicial) +''' '+
              ' and NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy', DataFinal)+''' ' +
              ' then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
              '   end),0) as mes_'+IntToStr(i);
           end;



        enSqlVnp :=  enSqlVnp +
         ' FROM FAT_TB_M_NFE_ITE NIT '+
         ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL     '+
         ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM     '+
         ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA   '+
         ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE  '+
         ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO           '+
         '  WHERE  PAR.ID_EMPRESA = '''+BUS_CD_C_PAR.FieldByName('ID_EMPRESA').AsString +''' AND '+
         ' NFE.id_emitente='''+VarToStr(Input[0])+''' and '+
         ' NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy', StrToDate('01'+'/'+
                                                            FormatDateTime('mm',IncMonth(DataSistema,-5))+'/'+
                                                            FormatDateTime('yyyy',IncMonth(DataSistema,-5)) ))+''' and ' +
         ' NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy',StrToDate(UltimoDiaDoMes(DataSistema)+'/'+
                                                            FormatDateTime('mm',DataSistema)+'/'+
                                                            FormatDateTime('yyyy',DataSistema))) +''' and '+
         ' CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
         ' NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
         ' group by 1,2,3,4 limit 10 )';

         if indexEmp < (BUS_CD_C_PAR.RecordCount-1)  then
           begin
              enSqlVnp :=  enSqlVnp + ' union all ';
           end;
          inc(indexEmp);
          BUS_CD_C_PAR.Next;
     end;
    enSqlVnp :=  enSqlVnp + ' ORDER BY ID_EMPRESA, valor desc,INT_NOMEITE ';
    BUS_CD_C_PAR.Close;
    BUS_SQ_C_CLI_EST_VNP.CommandText :=  enSqlVnp;

//    CMServerForm.mm.Lines.Add(BUS_SQ_C_ITE_EST_VCM.CommandText);

    Result := BUS_DP_C_CLI_EST_VNP.Data;
    BUS_SQ_C_CLI_EST_VNP.Close;
end;

function TSM.BUS_DP_C_CLI_PRDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPrd: String;
  begin
    Result :=
      ' SELECT PRD.* FROM CAD_TB_C_CLI_PRD PRD ';
  end;
begin
   { TODO -oLuan : Criado em 17/09/2016
     //Utilizado pelo pedido de venda para calculo dos vencimentos dos titulos
   }
   BUS_SQ_C_CLI_PRD.Close;

   if Input[0] = 0 then
      begin
         BUS_SQ_C_CLI_PRD.CommandText := enSqlPrd +
             'WHERE PRD.id_cliente=''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_C_CLI_PRD.Data;

   BUS_SQ_C_CLI_PRD.Close;
end;

function TSM.BUS_DP_C_CLI_PRODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPro: String;
  begin
    Result :=
      ' SELECT PRO.* FROM CAD_TB_C_CLI_PRO PRO ';
  end;
begin
   { TODO -oLuan : Criado em 10/11/2016
     //Utilizado pelo pedido de venda para selecao de propriedade do cliente
   }
   BUS_SQ_C_CLI_PRO.Close;

   if Input[0] = 0 then
      begin
         BUS_SQ_C_CLI_PRO.CommandText := enSqlPro +
             'WHERE PRO.id_cliente=''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_C_CLI_PRO.Data;

   BUS_SQ_C_CLI_PRO.Close;
end;

function TSM.BUS_DP_C_CLI_VEIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_C_CLI_VEI.Close;
   BUS_SQ_C_CLI_VEI.CommandText :=
          ' select cvi.*,cli.nome as int_nomecli, '+
          ' cli.tel_fixo as int_telfix, cli.tel_movel as int_telmovel, '+
          ' vei.id_placa as int_placa                                  '+
          ' from cad_tb_c_cli_vei cvi                                  '+
          ' left outer join cad_tb_c_cli cli on cli.id_cliente=cvi.id_cliente '+
          ' left outer join cad_tb_c_vei vei on vei.id_veiculo=cvi.id_veiculo ';

   if Input[0] = 0 then
     begin
       BUS_SQ_C_CLI_VEI.CommandText :=
              BUS_SQ_C_CLI_VEI.CommandText +
           ' WHERE UPPER(VEI.ID_PLACA) = '''+UPPERCASE(VarToStr(Input[1]))+''' ';
     end;
   Result := BUS_DP_C_CLI_VEI.Data;
end;

function TSM.BUS_DP_C_CSU_ITE_PRFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { Este Data Provider  utlizado por telas de pesquisa de itens (PSQ_FM_X_ITE e CSU_FM_C_ITE)

   }

   BUS_SQ_C_CSU_ITE_PRF.Close;
   BUS_SQ_C_CSU_ITE_PRF.CommandText := '';

   if Input[0] = 0 then
      begin
        BUS_SQ_C_CSU_ITE_PRF.CommandText :=

        ' select  ite.id_item, pec.descricao, '+
        ' (ite.preco_avista / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) AVista, '+
        ' (ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P30, '+
        ' ((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P60, '+
        ' (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P90, '+
        ' ((((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P120 '+
        ' from cad_tb_c_ite ite  '+
        ' left outer join cad_tb_c_pec pec on 1=1 '+
        ' left outer join cad_tb_c_fam fam on fam.id_familia = ite.id_familia '+
        '  where ite.preco_avista>0 ';





        if VarToStr(Input[1]) = '' then
          BEGIN
            BUS_SQ_C_CSU_ITE_PRF.CommandText := BUS_SQ_C_CSU_ITE_PRF.CommandText +
                 ' AND 1=2 ';
          END
        ELSE
          BEGIN
            BUS_SQ_C_CSU_ITE_PRF.CommandText := BUS_SQ_C_CSU_ITE_PRF.CommandText +
                 ' and id_item = ''' + VarToStr(Input[1]) +''' ';
          END;
      end;
    Result := BUS_DP_C_CSU_ITE_PRF.Data;
end;

function TSM.BUS_DP_C_CSU_MTVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlMtv:String;
  mes:Integer;
begin

   enSqlMtv :=
     ' select mtv.ano,          '+#13+#10+
     '   mtv.id_grupo_prod,     '+#13+#10+
     '  grp.descricao as int_nomegrp, '+#13+#10+
     '  (select coalesce(sum(mtm1.qtde_total),0)  from cad_tb_c_mtv mtv1 '+#13+#10+
     '  left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv                      '+#13+#10+
     '  where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod  ) as prev_qtde_total,  '+#13+#10+

     '  (select coalesce(sum(mtm1.valor_total),0) from cad_tb_c_mtv mtv1 '+ #13+#10+
     '  left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv                     '+ #13+#10+
     '  where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod ) as prev_valor_total  '+#13+#10;



  for mes := 1 to 12 do
     enSqlMtv := enSqlMtv +
       ' ,(select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1                                       '+#13+#10+
       ' left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv                                              '+#13+#10+
       ' where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod) as prev_qtde_mes_'+FormatFloat('00',mes)+'   '+#13+#10+

       ' ,(select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+'*mtm1.valor_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1   '+#13+#10+
       '  left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv                                             '+#13+#10+
       ' where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod) as prev_valor_mes_'+FormatFloat('00',mes)+'  '+#13+#10;

    enSqlMtv := enSqlMtv + ', coalesce(sum(nfi.qtde-nfi.qtde_devolvida),0) as real_qtde_total                          '+#13+#10+
                           ' ,coalesce((SUM(COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0))-                '+#13+#10+
                           ' SUM((COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida))  ),0) as real_valor_total  '+#13+#10;



  for mes := 1 to 12 do
     enSqlMtv := enSqlMtv +
      ' ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+#13+#10+
      '   when '+IntToStr(mes)+' then nfi.QTDE-nfi.QTDE_DEVOLVIDA          '+#13+#10+
      ' end),0) as real_qtde_mes_'+FormatFloat('00',mes)+'       '+#13+#10+

      ' ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))  '+#13+#10+
      '   when '+IntToStr(mes)+' then                                      '+ #13+#10+
      '          (COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0)- '+ #13+#10+
      '         (COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida)  ) '+ #13+#10+
      ' end),0) as real_valor_mes_'+FormatFloat('00',mes)+' '+#13+#10;



  enSqlMtv := enSqlMtv +
       ' ,case                                                                                  '+#13+#10+
       '     when                                                                              '+#13+#10+
       '              (select coalesce(sum(mtm1.qtde_total),0) from cad_tb_c_mtv mtv1           '+#13+#10+
       '              left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv         '+#13+#10+
       '              where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod)>0 then  '+#13+#10+

       '              (coalesce(sum(nfi.qtde-nfi.qtde_devolvida),0)/                            '+#13+#10+
       '              (select coalesce(sum(mtm1.qtde_total),0) from cad_tb_c_mtv mtv1           '+#13+#10+
       '              left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv         '+#13+#10+
       '              where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod))*100    '+#13+#10+
       '       end as per_qtde_total                                                         '+ #13+#10+


       ' ,case                                                                                    '+#13+#10+
       '     when                                                                                '+#13+#10+
       '              (select   coalesce(sum(mtm1.valor_total),0) from cad_tb_c_mtv mtv1          '+#13+#10+
       '             left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv            '+#13+#10+
       '             where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod)>0 then     '+ #13+#10+

       '              (coalesce((SUM(COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0))-          '+#13+#10+
       '               SUM((COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida))  ),0) / '+ #13+#10+

       '               (select   coalesce(sum(mtm1.valor_total),0) from cad_tb_c_mtv mtv1                  '+#13+#10+
       '             left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv                     '+ #13+#10+
       '             where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod))*100                '+#13+#10+
       '       end as per_valor_total     '+#13+#10;





  for mes := 1 to 12 do
     enSqlMtv := enSqlMtv +
        ' ,case                                                                           '+#13+#10+
        '      when                                                                       '+ #13+#10+
        '  (select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1         '+#13+#10+
        '        left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv         '+ #13+#10+
        '        where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod)>0 then  '+ #13+#10+

        '       (COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))                   '+#13+#10+
        '         when '+IntToStr(mes)+' then nfi.QTDE-nfi.QTDE_DEVOLVIDA                 '+#13+#10+
        '        end),0)/                                                                 '+#13+#10+
        '       (select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1    '+ #13+#10+
        '        left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv         '+ #13+#10+
        '        where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod))*100    '+ #13+#10+
        ' end as per_qtde_mes_'+FormatFloat('00',mes)+'  '+                                   #13+#10+

        ' ,case                                                                            '+#13+#10+
        '      when                                                                        '+ #13+#10+
        '       (select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+'*mtm1.valor_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1  '+#13+#10+
        '         left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv             '+#13+#10+
        '        where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod)>0 then       '+#13+#10+

        '       (COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))                        '+#13+#10+
        '        when '+IntToStr(mes)+' then                                                   '+ #13+#10+
        '            (COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0)-              '+#13+#10+
        '            (COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida)  )  '+ #13+#10+
        '            end),0)/                                                                  '+#13+#10+
        '         (select sum(mtm1.qtde_mes_'+FormatFloat('00',mes)+'*mtm1.valor_mes_'+FormatFloat('00',mes)+') from cad_tb_c_mtv mtv1  '+#13+#10+
        '         left outer join cad_tb_c_mtv_mes mtm1 on mtm1.id_mtv=mtv1.id_mtv             '+#13+#10+
        '        where mtv1.ano=mtv.ano and mtv1.id_grupo_prod=mtv.id_grupo_prod))*100         '+#13+#10+
        ' end as per_valor_mes_'+FormatFloat('00',mes)+'     '+#13+#10;



   enSqlMtv := enSqlMtv +
      ' from cad_tb_c_mtv mtv                                                          '+#13+#10+
      ' left outer join cad_tb_c_mtv_mes mtm on mtm.id_mtv=mtv.id_mtv                  '+#13+#10+
      ' left outer join cad_tb_c_grp grp on grp.id_codigo=mtv.id_grupo_prod            '+#13+#10+
      ' left outer join cad_tb_c_ite ite on ite.id_grupo_prod=mtv.id_grupo_prod        '+#13+#10+
      ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON  CFO.ID_CLASSE IN (''SP10'',''SP70'')      '+ #13+#10+
      ' left outer join fat_tb_m_nfe nfe on nfe.id_vendedor=mtv.id_vendedor            '+ #13+#10+
      '                  and extract(year from nfe.dta_emissao)=mtv.ano                '+#13+#10+

      '                  and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND         '+ #13+#10+
      '              NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S''      '+#13+#10+
      '                 AND NFE.ID_CFO=CFO.ID_CFO                                      '+#13+#10+
      ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal and nfi.id_item=ite.id_item '+#13+#10;



   BUS_SQ_C_CSU_MTV.Close;
   BUS_SQ_C_CSU_MTV.CommandText := enSqlMtv;

   BUS_SQ_C_CSU_MTV.CommandText := BUS_SQ_C_CSU_MTV.CommandText +
         ' where MTV.ano='''+VarToStr(Input[0])+''' ';

   if VarToStr(Input[1])<>'' then
      BUS_SQ_C_CSU_MTV.CommandText := BUS_SQ_C_CSU_MTV.CommandText +
          ' and mtv.id_grupo_prod in ('+VarToStr(Input[1])+ ') ';

   {if VarToStr(Input[2])<>'' then
      BUS_SQ_C_CSU_MTV.CommandText := BUS_SQ_C_CSU_MTV.CommandText +
          ' and mtv.id_vendedor in ('+VarToStr(Input[2])+ ') '; }

   BUS_SQ_C_CSU_MTV.CommandText := BUS_SQ_C_CSU_MTV.CommandText +
          ' group by 1,2,3 ';


   Result := BUS_DP_C_CSU_MTV.Data;

end;


function TSM.BUS_DP_C_CSU_MTV_HSTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlMthst:String;
begin

   enSqlMthst :=


   ' select                                                 '+
   ' '+VarToStr(Input[2])+' as ano,                         '+
   ' fun.id_funcionario,                                    '+
   ' ite.id_item,                                           '+
   ' ite.descricao as int_nomeite,                          '+

   ' coalesce(sum(nfi.QTDE-nfi.QTDE_DEVOLVIDA),0) as total, '+


   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 1 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_01,                                   '+


   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 2 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_02,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 3 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_03,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 4 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_04,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '     when 5 then nfi.QTDE-nfi.QTDE_DEVOLVIDA             '+
   '    end),0) as mes_05,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 6 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_06,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 7 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_07,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 8 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_08,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 9 then nfi.QTDE-nfi.QTDE_DEVOLVIDA            '+
   '    end),0) as mes_09,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 10 then nfi.QTDE-nfi.QTDE_DEVOLVIDA           '+
   '    end),0) as mes_10,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 11 then nfi.QTDE-nfi.QTDE_DEVOLVIDA           '+
   '    end),0) as mes_11,                                   '+

   ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
   '      when 12 then nfi.QTDE-nfi.QTDE_DEVOLVIDA           '+
   '    end),0) as mes_12                                    '+

   ' from cad_tb_c_fun fun                                    '+
   ' left outer join cad_tb_c_ite ite on ite.id_grupo_prod='''+VarToStr(Input[3])+'''                     '+
   ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON  CFO.ID_CLASSE IN (''SP10'',''SP70'')                            '+
   ' left outer join fat_tb_m_nfe nfe on nfe.id_vendedor=FUN.id_funcionario                               '+
   '                    and extract(year from nfe.dta_emissao)='''+VarToStr(Input[2])+'''                 '+
   '                    and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND                             '+
   '              NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' AND NFE.ID_CFO=CFO.ID_CFO  '+
   ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal and nfi.id_item=ite.id_item      ';




   BUS_SQ_C_CSU_MTV_HST.Close;
   BUS_SQ_C_CSU_MTV_HST.CommandText :=  enSqlMthst;

   BUS_SQ_C_CSU_MTV_HST.CommandText := BUS_SQ_C_CSU_MTV_HST.CommandText +
         ' where FUN.id_funcionario='''+VarToStr(Input[1])+''' '+
         ' group by 1,2,3,4 ';

   Result := BUS_DP_C_CSU_MTV_HST.Data;
end;

function TSM.BUS_DP_C_CSU_MTV_VNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlMtvnd:String;
  mes:Integer;
begin

   enSqlMtvnd :=

  ' select mtv.ano,                                          '+
  '      mtv.id_grupo_prod,                                  '+
  '      mtv.id_vendedor,                                    '+
  '      fun.nome as int_nomevnd,                            '+
  '  mtm.qtde_total as prev_qtde_total,                      '+
  '  mtm.valor_total as prev_valor_total                     ';




  for mes := 1 to 12 do
     enSqlMtvnd := enSqlMtvnd +
      '      ,mtm.qtde_mes_'+FormatFloat('00',mes)+'  as prev_qtde_mes_'+FormatFloat('00',mes)+'  ';

  for mes := 1 to 12 do
     enSqlMtvnd := enSqlMtvnd +
      '      ,mtm.qtde_mes_'+FormatFloat('00',mes)+'*mtm.valor_mes_'+FormatFloat('00',mes)+'  as prev_valor_mes_'+FormatFloat('00',mes)+'  ';


  enSqlMtvnd := enSqlMtvnd +
      '      ,coalesce(sum(nfi.qtde-nfi.qtde_devolvida),0) as real_qtde_total  '+
      '      ,coalesce((SUM(COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0))-    '+
      '             SUM((COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida))  ),0) as real_valor_total  ';


   for mes := 1 to 12 do
     enSqlMtvnd := enSqlMtvnd +
      '      ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))    '+
      '         when '+IntToStr(mes)+' then nfi.QTDE-nfi.QTDE_DEVOLVIDA  '+
      '       end),0) as real_qtde_mes_'+FormatFloat('00',mes)+'         '+

      '     ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))     '+
      '       when '+IntToStr(mes)+' then                                '+
      '              (COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0)-  '+
      '             (COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida)  ) '+
      '     end),0) as real_valor_mes_'+FormatFloat('00',mes)+'         ';

    enSqlMtvnd := enSqlMtvnd +
    ' ,case                                                             '+
    '  when coalesce(mtm.qtde_total,0)>0 then                           '+
    ' (coalesce(sum(nfi.qtde-nfi.qtde_devolvida),0)/mtm.qtde_total)*100 '+
    ' end as per_qtde_total                                             '+
    ' ,case                                                             '+
    '  when coalesce(mtm.valor_total,0)>0 then                          '+
    ' (coalesce((SUM(COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0))-  '+
    '         SUM((COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida))  ),0)/mtm.valor_total)*100  '+
    ' end as per_valor_total        ';

   for mes := 1 to 12 do
     enSqlMtvnd := enSqlMtvnd +
       ' ,case                                                                '+
       '     when coalesce(mtm.qtde_mes_'+FormatFloat('00',mes)+',0)>0  then     '+
       '         (COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))     '+
       '          when '+IntToStr(mes)+' then nfi.QTDE-nfi.QTDE_DEVOLVIDA    '+
       '         end),0) / mtm.qtde_mes_'+FormatFloat('00',mes)+')*100       '+
       '    end as per_qtde_mes_'+FormatFloat('00',mes)+'                    '+

       ' ,case                                                               '+
       '     when coalesce(mtm.qtde_mes_'+FormatFloat('00',mes)+'*mtm.valor_mes_'+FormatFloat('00',mes)+',0)>0   '+
       '      then                                                                                               '+
       '       (COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))                                           '+
       '         when '+IntToStr(mes)+' then                                                                     '+
       '            (COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0)-                                 '+
       '            (COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida)  )                     '+
       '         end),0) /  (mtm.qtde_mes_'+FormatFloat('00',mes)+'*mtm.valor_mes_'+FormatFloat('00',mes)+'))*100   '+
       '     end as per_valor_mes_'+FormatFloat('00',mes)+'   ';

  enSqlMtvnd := enSqlMtvnd +
      ' from cad_tb_c_mtv mtv                                                          '+
      ' left outer join cad_tb_c_mtv_mes mtm on mtm.id_mtv=mtv.id_mtv                  '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=mtv.id_vendedor            '+
      ' left outer join cad_tb_c_ite ite on ite.id_grupo_prod=mtv.id_grupo_prod        '+
      ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON  CFO.ID_CLASSE IN (''SP10'',''SP70'')      '+

      ' left outer join fat_tb_m_nfe nfe on nfe.id_vendedor=mtv.id_vendedor            '+
      '                  and extract(year from nfe.dta_emissao)=mtv.ano                '+

      '                  and NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND         '+
      '              NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S''      '+
      '                 AND NFE.ID_CFO=CFO.ID_CFO                                      '+
      ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal and nfi.id_item=ite.id_item ';



   BUS_SQ_C_CSU_MTV_VND.Close;
   BUS_SQ_C_CSU_MTV_VND.CommandText := enSqlMtvnd;

   BUS_SQ_C_CSU_MTV_VND.CommandText := BUS_SQ_C_CSU_MTV_VND.CommandText +
         ' where MTV.ano='''+VarToStr(Input[0])+''' '+
         ' and mtv.id_grupo_prod='''+VarToStr(Input[1])+ ''' ';

   {if VarToStr(Input[2])<>'' then
      BUS_SQ_C_CSU_MTV_VND.CommandText := BUS_SQ_C_CSU_MTV_VND.CommandText +
          ' and mtv.id_vendedor in ('+VarToStr(Input[2])+ ') '; }

   BUS_SQ_C_CSU_MTV_VND.CommandText := BUS_SQ_C_CSU_MTV_VND.CommandText +
          ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30 ';

   Result := BUS_DP_C_CSU_MTV_VND.Data;
end;

function TSM.BUS_DP_C_CTCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_C_CTC.Close;
   BUS_SQ_C_CTC.CommandText :=
     'SELECT ctc.* '+
     'FROM CAD_TB_C_CTC CTC ';


   if Input[0] = 0 then
      begin
        BUS_SQ_C_CTC.CommandText :='';
        BUS_SQ_C_CTC.CommandText :=
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC '+
           '  WHERE CTC.TIPO='''+'1'+''' '+
           'UNION ALL '+
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC '+
           '  WHERE CTC.ID_CONTA in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_C_CTC.CommandText :='';
        BUS_SQ_C_CTC.CommandText :=
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC '+
           '  WHERE CTC.TIPO=''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 2 then
      begin
        BUS_SQ_C_CTC.CommandText :='';
        BUS_SQ_C_CTC.CommandText :=
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC ' +
           '  WHERE CTC.TIPO=''0''  ' +
           '    AND CTC.ID_CONTA IN ' +
           '        ( SELECT ID_CONTA FROM FIN_TB_M_CXA CXA ' +
           '          WHERE CXA.STATUS =  0 AND     ' +
           '                CXA.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  '+
           '                CXA.ID_FUNCIONARIO <> ''' + VarToStr(Input[2]) + ''') ';
      end;

   if Input[0] = 3 then
      begin
        BUS_SQ_C_CTC.CommandText :='';
        BUS_SQ_C_CTC.CommandText :=
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC   ' +
           '  WHERE CTC.TIPO = ''0''  ' +
           '    AND NOT EXISTS ' +
           '        ( SELECT ID_CONTA FROM FIN_TB_M_CXA CXA  ' +
           '          WHERE CXA.STATUS =  0 AND              ' +
           '                CXA.ID_CONTA = CTC.ID_CONTA AND  ' +
           '                CXA.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ) ';
      end;
    //Utiliza pelo Movimento de Cheques para que apos gravao do registro
    //seja apresentada descrio da conta corrente
   if Input[0] = 4 then
      begin
         BUS_SQ_C_CTC.CommandText :='';
         BUS_SQ_C_CTC.CommandText :=
         ' SELECT ctc.* '+
         ' FROM CAD_TB_C_CTC CTC '+
         Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 5 then
      begin
        BUS_SQ_C_CTC.CommandText :='';
        BUS_SQ_C_CTC.CommandText :=
           'SELECT ctc.* '+
           '  FROM CAD_TB_C_CTC CTC   ' +
           '  WHERE CTC.TIPO = ''0''  ' +
           '    AND CTC.ID_CONTA = ''' + VarToStr(Input[1]) + '''  ' +
           '    AND NOT EXISTS ' +
           '        ( SELECT ID_CONTA FROM FIN_TB_M_CXA CXA  ' +
           '          WHERE CXA.STATUS =  0 AND              ' +
           '                CXA.ID_CONTA = CTC.ID_CONTA AND  ' +
           '                CXA.ID_EMPRESA = ''' + VarToStr(Input[2]) + ''' ) ';
      end;

   Result := BUS_DP_C_CTC.Data;
end;

function TSM.BUS_DP_C_ECF_FPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEcfFpg: String;
  begin
    Result := ' SELECT ECP.*, FPG.DOC_IMPRESSO FROM CAD_TB_C_ECF_FPG ECP ' +
              '   LEFT OUTER JOIN CAD_TB_C_FPG FPG on FPG.ID_FORMA_PAG = ECP.ID_FORMA_PAG ';
  end;
begin
   BUS_SQ_C_ECF_FPG.Close;
   BUS_SQ_C_ECF_FPG.CommandText := enSqlEcfFpg;
   if input[0] = 0 then
      begin
        BUS_SQ_C_ECF_FPG.CommandText := BUS_SQ_C_ECF_FPG.CommandText +
           ' WHERE ECF_SERIAL_IMPRESSORA = '''+VarToStr(Input[1])+''' ';
      end;
   if input[0] = 1 then
      begin
        BUS_SQ_C_ECF_FPG.CommandText := BUS_SQ_C_ECF_FPG.CommandText +
           ' WHERE ECF_SERIAL_IMPRESSORA = '''+VarToStr(Input[1])+''' ' +
           '   AND ID_FORMA_PAG = '''+VarToStr(Input[2])+''' ';
      end;
   result := BUS_DP_C_ECF_FPG.Data;
end;

function TSM.BUS_DP_C_FUN_CRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { TODO -oMaxsuel -ccriao : Mtodo criado por Maxsuel Victor em 28/10/2014 }

   BUS_SQ_C_FUN_CRG.Close;
   BUS_SQ_C_FUN_CRG.CommandText :=
      ' SELECT FRG.ID_CARGO, ' +
      '    CRG.DESCRICAO AS INT_NOMECRG,CRG.TIPO AS INT_TIPO FROM CAD_TB_C_FUN_CRG FRG ' +
      ' LEFT OUTER JOIN PCP_TB_C_CRG CRG on ' +
      '    (CRG.ID_CARGO = FRG.ID_CARGO) ' +
      ' WHERE FRG.ID_FUNCIONARIO = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_C_FUN_CRG.Data;
end;


function TSM.BUS_DP_C_ITE_CATDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIteCat: String;
  begin
    Result :=
       ' select cat.descricao as int_nomecat,cit.* from cad_tb_c_ite_cat cit '+
       'left outer join ofi_tb_c_cat cat on cat.id_cat=cit.id_cat ' ;
  end;
begin

   BUS_SQ_C_ITE_CAT.Close;
   BUS_SQ_C_ITE_CAT.CommandText := enSqlIteCat;

   if Input[0] = 0 then
      begin
        BUS_SQ_C_ITE_CAT.CommandText := BUS_SQ_C_ITE_CAT.CommandText +
         ' where cit.id_item = ''' + VarToStr(Input[1]) +''' and cit.id_cat IN ('+ VarToStr(Input[2])+') ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_C_ITE_CAT.CommandText := BUS_SQ_C_ITE_CAT.CommandText +
         ' where cit.id_item = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_C_ITE_CAT.Data;
   BUS_SQ_C_ITE_CAT.Close;
end;


function TSM.BUS_DP_C_ITE_COJDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIteCoj: String;
  begin
    Result :=
       ' select coj.*, ' +
       '  ite.descricao as int_nomeite,            ' +
       '    ITE.ID_UND_VENDA  as int_undvendaconj,       ' +
       '    GRU.TIPO_ITEM  as int_tipo_item,       ' +
       '    cor.descricao as int_nomecor,            ' +
       '    tam.descricao as int_nometam             ' +
       ' from cad_tb_c_ite_coj coj                   ' +
       '    left outer join cad_tb_c_ite ite on ite.id_item = coj.id_item_conjugado ' +
       '    left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ' +
       '    left outer join cad_tb_c_cor cor on cor.id_cor = coj.id_cor         ' +
       '    left outer join cad_tb_c_tam tam on tam.id_tamanho = coj.id_tamanho ' ;
  end;
begin

   BUS_SQ_C_ITE_COJ.Close;
   BUS_SQ_C_ITE_COJ.CommandText := enSqlIteCoj;

   if Input[0] = 0 then
      begin
        BUS_SQ_C_ITE_COJ.CommandText := BUS_SQ_C_ITE_COJ.CommandText +
         ' where coj.id_item = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_C_ITE_COJ.CommandText := BUS_SQ_C_ITE_COJ.CommandText +
         ' where coj.id_item in (' + VarToStr(Input[1]) +') ';
      end;

    if Input[0] = 2 then
      begin
        BUS_SQ_C_ITE_COJ.CommandText := BUS_SQ_C_ITE_COJ.CommandText +
         ' where coj.id_item = ''' + VarToStr(Input[1]) +''' ' +
         ' and   coj.id_cor = ''' + VarToStr(Input[2]) +''' ' +
         ' and   coj.id_tamanho = ''' + VarToStr(Input[3]) +''' ';
      end;
   if Input[0] = 3 then
      begin
        BUS_SQ_C_ITE_COJ.CommandText := BUS_SQ_C_ITE_COJ.CommandText +
         ' where coj.id_item in (' + VarToStr(Input[1]) +') ' +
          ' and  coj.id_cor in (' + VarToStr(Input[2]) +') ' +
         ' and   coj.id_tamanho in (' + VarToStr(Input[3]) +') ' ;
      end;

   if Input[0] = 4 then
      begin
        BUS_SQ_C_ITE_COJ.CommandText := BUS_SQ_C_ITE_COJ.CommandText +
         ' where coj.id_item in (' + VarToStr(Input[1]) +') and '+
         '  gru.tipo_item <> ''09''  ';
      end;

   Result := BUS_DP_C_ITE_COJ.Data;
   BUS_SQ_C_ITE_COJ.Close;
end;

function TSM.BUS_DP_C_ITE_COMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIteCom: String;
  begin
    Result :=
    ' select com.*,ite.preco_avista as int_prc_avista,ite.preco_aprazo as int_prc_aprazo '+
    ' from cad_tb_c_ite_com com                                            '+
    ' left outer join cad_tb_c_ite ite on ite.id_item=com.id_materia_prima ';
  end;
begin
   BUS_SQ_C_ITE_COM.Close;
   BUS_SQ_C_ITE_COM.CommandText := enSqlIteCom;

   if Input[0] = 0 then
      begin
        BUS_SQ_C_ITE_COM.CommandText := BUS_SQ_C_ITE_COM.CommandText +
          '  WHERE com.id_item = '''+ VarToStr(Input[1])+'''';
      end;

   Result := BUS_DP_C_ITE_COM.Data;
   BUS_SQ_C_ITE_COM.Close;
end;

function TSM.BUS_DP_C_ITE_CULDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIteCul: String;
  begin
    Result :=
       ' select * from cad_tb_c_ite_cul ' ;
  end;
begin

   BUS_SQ_C_ITE_CUL.Close;
   BUS_SQ_C_ITE_CUL.CommandText := enSqlIteCul;

   if Input[0] = 0 then
      begin
        BUS_SQ_C_ITE_CUL.CommandText := BUS_SQ_C_ITE_CUL.CommandText +
         ' where id_item = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_C_ITE_CUL.Data;
   BUS_SQ_C_ITE_CUL.Close;
end;

function TSM.BUS_DP_C_ITE_EST_MCVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlMcv:String;
  DataSistema:TDateTime;
begin
   DataSistema := enDataServer;



   enSqlMcv :=

    ' select  '+
    ' NFE.ID_EMPRESA, '+
    ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
    ' COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
    ' end),0) as ano_anterior,                                                           '+

    ' COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' '+
    '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',IncYear(DataSistema,-1)) +''' '+
    '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
    ' end),0) as mes_ano_anterior,    '+

    ' COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',DataSistema)+''' '+
    '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',DataSistema) +''' '+
    '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
    ' end),0) as mes_atual,    '+



    ' case '+
    '   when  '+

         ' COALESCE(sum( case               '+
         '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' '+
         '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',IncYear(DataSistema,-1)) +''' '+
         '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
         ' end),0) >0 then '+


    ' ((COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',DataSistema)+''' '+
    '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',DataSistema) +''' '+
    '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
    ' end),0) -                              '+
    ' COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' '+
    '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',IncYear(DataSistema,-1)) +''' '+
    '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
    ' end),0) ) /                            '+

    ' COALESCE(sum( case               '+
    '  when EXTRACT (YEAR FROM NFE.DTA_EMISSAO)='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' '+
    '       AND EXTRACT (MONTH FROM NFE.DTA_EMISSAO)='''+FormatDateTime('mm',IncYear(DataSistema,-1)) +''' '+
    '       then NIT.QTDE-NIT.QTDE_DEVOLVIDA   '+
    ' end),0) )*100                            '+
    ' end as percentual                                                       '+

    ' FROM FAT_TB_M_NFE_ITE NIT                                               '+
    ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL         '+
    ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA       '+
    ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO               '+

    ' WHERE  NIT.ID_ITEM ='''+VarToStr(Input[0])+''' AND '+
    ' EXTRACT(YEAR FROM NFE.DTA_EMISSAO) >='''+FormatDateTime('yyyy',IncYear(DataSistema,-1))+''' AND '+
    ' EXTRACT(YEAR FROM NFE.DTA_EMISSAO) <='''+FormatDateTime('yyyy',DataSistema)+''' AND '+
    ' CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
    ' NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
    ' group by 1,2  '+
    ' ORDER  BY  NFE.ID_EMPRESA ';

   BUS_SQ_C_ITE_EST_MCV.Close;
   BUS_SQ_C_ITE_EST_MCV.CommandText := enSqlMcv;

   //CMServerForm.mm.Lines.Add(BUS_SQ_C_ITE_EST_MCV.CommandText);

   Result := BUS_DP_C_ITE_EST_MCV.Data;
end;

function TSM.BUS_DP_C_ITE_EST_MPADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlMpa: String;
  begin
    Result :=
      ' select '+
      ' NFE.ID_EMPRESA, '+
      ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+

      ' NFE.ID_TIPO_MOV_ESTOQUE, '+
      ' TME.DESCRICAO AS INT_NOMETME, '+
      ' Extract(year from NFE.DTA_EMISSAO ) as ano, '+

      ' SUM(COALESCE(NIT.QTDE-NIT.QTDE_DEVOLVIDA,0)) as valor, '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 1 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_01,                                      '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 2 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_02,                                      '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 3 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_03,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 4 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_04,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 5 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_05,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 6 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_06,                                    '+


      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 7 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_07,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 8 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_08,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 9 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_09,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 10 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_10,                                    '+

      ' COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 11 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_11,                                    '+

      ' coalesce(sum(case extract(month from (NFE.DTA_EMISSAO)) '+
      '   when 12 then NIT.QTDE-NIT.QTDE_DEVOLVIDA               '+
      ' end),0) as mes_12                                     '+


      ' FROM FAT_TB_M_NFE_ITE NIT                               '+
      ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
      ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
      ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
      ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO ';
  end;
begin
   BUS_SQ_C_ITE_EST_MPA.Close;
   BUS_SQ_C_ITE_EST_MPA.CommandText := enSqlMpa;

   BUS_SQ_C_ITE_EST_MPA.CommandText := BUS_SQ_C_ITE_EST_MPA.CommandText +
     '  WHERE nit.id_item='''+VarToStr(Input[0])+''' AND '+
     '  NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND  '+
     '        NFE.FATURADA = true '+
     ' group by 1,2,3,4,5         '+
     ' ORDER BY  NFE.ID_EMPRESA,INT_NOMETME, ANO DESC ';

   //CMServerForm.mm.Lines.Add(BUS_SQ_C_ITE_EST_MPA.CommandText);

    Result := BUS_DP_C_ITE_EST_MPA.Data;
end;

function TSM.BUS_DP_C_ITE_EST_PFCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPfc: String;
  begin
    Result :=
    ' select '+
    ' FES.ID_EMPRESA, '+
    ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
    ' FES.SALDO_FISICO, '+
    ' COALESCE(FES.SALDO_FISICO*FES.VLR_CUSTO_MEDIO,0) as valor '+
    ' FROM EST_TB_M_FES FES '+
    ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=FES.ID_EMPRESA ';
  end;
begin
   BUS_SQ_C_ITE_EST_PFC.Close;
   BUS_SQ_C_ITE_EST_PFC.CommandText := enSqlPfc;

   BUS_SQ_C_ITE_EST_PFC.CommandText := BUS_SQ_C_ITE_EST_PFC.CommandText +
     ' WHERE fes.id_item='''+VarToStr(Input[0])+''' '+
     ' order by fes.ID_EMPRESA ';

    Result := BUS_DP_C_ITE_EST_PFC.Data;
end;

function TSM.BUS_DP_C_ITE_EST_SRHDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlSrh: String;
  begin
    Result :=
     ' select '+
     ' NFE.ID_EMPRESA, '+
     ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
     ' Extract(year from NFE.DTA_EMISSAO ) as ano, '+
     ' SUM(COALESCE(NIT.QTDE-NIT.QTDE_DEVOLVIDA,0)) as valor '+
     ' FROM FAT_TB_M_NFE_ITE NIT                             '+
     ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
     ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
     ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO ';
  end;
VAR
  DataSistema:TDateTime;
  anoIni,anoFinal:String;
begin
   BUS_SQ_C_ITE_EST_SRH.Close;
   BUS_SQ_C_ITE_EST_SRH.CommandText := enSqlSrh;

   DataSistema := enDataServer;
   anoFinal := FormatDateTime('yyyy',DataSistema);
   anoIni   := FormatDateTime('yyyy',IncYear(DataSistema,-3));

   BUS_SQ_C_ITE_EST_SRH.CommandText := BUS_SQ_C_ITE_EST_SRH.CommandText +
     '  WHERE nit.id_item='''+VarToStr(Input[0])+''' and '+
     '  Extract(year from NFE.DTA_EMISSAO ) >='''+anoIni +''' and '+
     '  Extract(year from NFE.DTA_EMISSAO ) <='''+anoFinal +''' and '+
     '  CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND '+
     '        NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
     ' group by 1,2,3 '+
     ' order by  NFE.ID_EMPRESA,ano DESC ';

    Result := BUS_DP_C_ITE_EST_SRH.Data;
end;

function TSM.BUS_DP_C_ITE_EST_VCMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
 enSqlVcm:String;
 DataSistema,DataFinal,DataInicial,DataFin,DataIni:TDateTime;
 BUS_CD_C_PAR:TClientDataSet;
 i,indexEmp:integer;
begin

   BUS_CD_C_PAR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR.SetProvider(CAD_DP_C_PAR);
   BUS_CD_C_PAR.Close;
   BUS_CD_C_PAR.Data :=
           BUS_CD_C_PAR.DataRequest(VarArrayOf([1,'%']));
   BUS_SQ_C_ITE_EST_VCM.Close;

  // DataSistema := enDataServer;

  DataIni := StrTodate(VarToStr(Input[1]));
  DataFin := StrTodate(VarToStr(Input[2]));

  indexEmp :=0;
  enSqlVcm := '';
   while not BUS_CD_C_PAR.eof do
     begin

       enSqlVcm :=  enSqlVcm +
         ' (select '+
         ' NFE.ID_EMPRESA, '+
         ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
         ' COALESCE(NFE.ID_EMITENTE,0) AS INT_COD_CLI, '+
         ' CAST (CASE '+
         '     WHEN CLI.NOME IS NULL THEN ''INDEFINIDO'' '+
         '     ELSE CLI.NOME END AS VARCHAR(50)) AS INT_NOMECLI, '+
         ' SUM(COALESCE(NIT.QTDE-NIT.QTDE_DEVOLVIDA,0)) as valor ';







         for I := 0 to 12 do
           begin

            if (i = 0) then
               begin
                 DataInicial :=  DataIni;
               end
            else
               begin
                 DataInicial := StrTodate('01'+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i)));
               end;

            if FormatDateTime('mm/yyyy',IncMonth(DataIni,i)) = FormatDateTime('mm/yyyy',DataFin) then
              begin
                DataFinal := DataFin;
              end
            else
              begin
                DataFinal := StrToDate(UltimoDiaDoMes(IncMonth(DataIni,i))+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i)));
              end;


           if  StrTodate('01'+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i))) <=
               StrTodate('01'+'/'+FormatDateTime('mm',DataFin)+'/'+FormatDateTime('yyyy',DataFin) ) then
              begin
                 enSqlVcm := enSqlVcm +
                  ' ,COALESCE(sum(case '+
                  ' when NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy', DataInicial) +''' '+
                  ' and NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy', DataFinal)+''' ' +
                  ' then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
                  '   end),0) as mes_'+IntToStr(i+1);
              end
            else
              begin
                 enSqlVcm := enSqlVcm +
                  ' ,cast(0 as float) as mes_'+IntToStr(i+1);
              end;
           end;



       enSqlVcm := enSqlVcm +
         ' FROM FAT_TB_M_NFE_ITE NIT '+
         ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL     '+
         ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA   '+
         ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE  '+
         ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO           '+
         '  WHERE  PAR.ID_EMPRESA = '''+BUS_CD_C_PAR.FieldByName('ID_EMPRESA').AsString +''' AND '+
         ' nit.id_item='''+VarToStr(Input[0])+''' and '+
         ' NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy',DataIni )+''' and ' +
         ' NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy',DataFin ) +''' and '+
         ' CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
         ' NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
         ' group by 1,2,3,4 limit 10 )';

         if indexEmp < (BUS_CD_C_PAR.RecordCount-1)  then
           begin
             enSqlVcm := enSqlVcm + ' union all ';
           end;
          inc(indexEmp);
          BUS_CD_C_PAR.Next;
     end;
    enSqlVcm := enSqlVcm + ' ORDER BY ID_EMPRESA, valor desc,INT_NOMECLI ';
    BUS_CD_C_PAR.Close;
    BUS_SQ_C_ITE_EST_VCM.CommandText := enSqlVcm;

//    CMServerForm.mm.Lines.Add(BUS_SQ_C_ITE_EST_VCM.CommandText);

    Result := BUS_DP_C_ITE_EST_VCM.Data;
end;

function TSM.BUS_DP_C_ITE_EST_VVMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
 enSqlVvm:String;
 DataFinal,DataInicial,DataFin,DataIni:TDateTime;
 BUS_CD_C_PAR:TClientDataSet;
 i,indexEmp:integer;
begin

   BUS_CD_C_PAR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR.SetProvider(CAD_DP_C_PAR);
   BUS_CD_C_PAR.Close;
   BUS_CD_C_PAR.Data :=
           BUS_CD_C_PAR.DataRequest(VarArrayOf([1,'%']));
   BUS_SQ_C_ITE_EST_VVM.Close;

 // DataSistema := enDataServer;
  DataIni := StrToDate(VarToStr(Input[1]));
  DataFin := StrToDate(VarToStr(Input[2]));


  indexEmp :=0;
  enSqlVvm := '';
   while not BUS_CD_C_PAR.eof do
     begin

       enSqlVvm :=  enSqlVvm +
         ' (select '+
         ' NFE.ID_EMPRESA, '+
         ' PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
         ' COALESCE(NFE.ID_VENDEDOR,0) AS INT_COD_VND, '+
         ' CAST( COALESCE(FUN.NOME,''INDEFINIDO'') AS VARCHAR(100)) AS INT_NOMEVND, '+
         ' SUM(COALESCE(NIT.QTDE-NIT.QTDE_DEVOLVIDA,0)) as valor ';





         for I := 0 to 12 do
           begin

            if (i = 0) then
               begin
                 DataInicial :=  DataIni;
               end
            else
               begin
                 DataInicial := StrTodate('01'+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i)));
               end;

            if FormatDateTime('mm/yyyy',IncMonth(DataIni,i)) = FormatDateTime('mm/yyyy',DataFin) then
              begin
                DataFinal := DataFin;
              end
            else
              begin
                DataFinal := StrToDate(UltimoDiaDoMes(IncMonth(DataIni,i))+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i)));
              end;


            if  StrTodate('01'+'/'+FormatDateTime('mm',IncMonth(DataIni,i))+'/'+FormatDateTime('yyyy',IncMonth(DataIni,i))) <=
               StrTodate('01'+'/'+FormatDateTime('mm',DataFin)+'/'+FormatDateTime('yyyy',DataFin) ) then
              begin
                 enSqlVvm := enSqlVvm +
                  ' ,COALESCE(sum(case '+
                  ' when NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy', DataInicial) +''' '+
                  ' and NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy', DataFinal)+''' ' +
                  ' then NIT.QTDE-NIT.QTDE_DEVOLVIDA '+
                  '   end),0) as mes_'+IntToStr(i+1);
              end
            else
              begin
                 enSqlVvm := enSqlVvm +
                  ' ,cast(0 as float) as mes_'+IntToStr(i+1);
              end;
           end;



       enSqlVvm := enSqlVvm +
         ' FROM FAT_TB_M_NFE_ITE NIT '+
         ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL     '+
         ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA   '+
         ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=NFE.ID_VENDEDOR  '+
         ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO           '+
         '  WHERE  PAR.ID_EMPRESA = '''+BUS_CD_C_PAR.FieldByName('ID_EMPRESA').AsString +''' AND '+
         ' nit.id_item='''+VarToStr(Input[0])+''' and '+
         ' NFE.DTA_EMISSAO>='''+FormatDateTime('dd/mm/yyyy',DataIni )+''' and ' +
         ' NFE.DTA_EMISSAO<='''+FormatDateTime('dd/mm/yyyy',DataFin ) +''' and '+
         ' CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
         ' NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
         ' group by 1,2,3,4 limit 10 )';

         if indexEmp < (BUS_CD_C_PAR.RecordCount-1)  then
           begin
             enSqlVvm := enSqlVvm + ' union all ';
           end;
          inc(indexEmp);
          BUS_CD_C_PAR.Next;
     end;
    enSqlVvm := enSqlVvm + ' ORDER BY ID_EMPRESA, valor desc,INT_NOMEVND ';
    BUS_CD_C_PAR.Close;
    BUS_SQ_C_ITE_EST_VVM.CommandText := enSqlVvm;

    Result := BUS_DP_C_ITE_EST_VVM.Data;
end;

function TSM.BUS_DP_C_ITE_LOCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_C_ITE_LOC.Close;

   BUS_SQ_C_ITE_LOC.CommandText :=
       ' SELECT LOC.loca_rua  '+
       ' FROM cad_tb_c_ite_loc loc '+
       ' WHERE LOC.ID_EMPRESA = ''' + VarToStr(Input[0]) +''' '+
       ' GROUP BY LOC.loca_rua ';


   Result := BUS_DP_C_ITE_LOC.Data;
end;

function TSM.BUS_DP_C_ITE_LOC_2DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlIteLoc2: String;
  begin
     result :=  ' SELECT *  '+
                ' FROM cad_tb_c_ite_loc loc ';

  end;
begin

  BUS_SQ_C_ITE_LOC_2.close;
  BUS_SQ_C_ITE_LOC_2.CommandText := enSqlIteLoc2;

  if VarToStr(Input[0]) = '0' then
      begin
        BUS_SQ_C_ITE_LOC_2.CommandText := BUS_SQ_C_ITE_LOC_2.CommandText +
             ' WHERE LOC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             '   and LOC.id_item    = ''' + VarToStr(Input[2]) +''' '
             ;
      end;

  Result := BUS_DP_C_ITE_LOC_2.Data;

  BUS_SQ_C_ITE_LOC_2.Close;
end;

function TSM.BUS_DP_C_ITE_PRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlItePrc: String;
  begin
    Result :=
     ' SELECT PRC.*,PEC.DESCRICAO AS INT_DESC_PEC FROM CAD_TB_C_ITE_PRC PRC '+
     '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=PRC.ID_PERFIL_CLI ';
  end;
begin
   BUS_SQ_C_ITE_PRC.Close;
   BUS_SQ_C_ITE_PRC.CommandText := '';
   BUS_SQ_C_ITE_PRC.CommandText := enSqlItePrc +
     ' WHERE prc.id_item = ''' + VarToStr(Input[0]) +''' ';


   if VarToStr(Input[1]) <>'' then
    BUS_SQ_C_ITE_PRC.CommandText := BUS_SQ_C_ITE_PRC.CommandText +
          ' and prc.id_perfil_cli = ''' + VarToStr(Input[1]) +''' ';

   BUS_SQ_C_ITE_PRC.CommandText := BUS_SQ_C_ITE_PRC.CommandText +
      ' and prc.id_empresa = '''+VarToStr(Input[2])+''' ';


   Result := BUS_DP_C_ITE_PRC.Data;
end;

function TSM.BUS_DP_C_ITE_PREDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlItePre: String;
  begin
    Result :=
        'SELECT * from CAD_TB_C_ITE_PRE ';
  end;
begin
   BUS_SQ_C_ITE_PRE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_C_ITE_PRE.CommandText := enSqlItePre + ' WHERE 1=2 '
        else
           BUS_SQ_C_ITE_PRE.CommandText := enSqlItePre +
             ' WHERE ID_ITEM= ''' + VarToStr(Input[1]) +''' AND ID_PERFIL_CLI= ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := BUS_DP_C_ITE_PRE.Data;

end;

function TSM.BUS_DP_C_ITE_XMLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlIteXml: String;
  begin
    Result :=
        'SELECT * FROM CAD_TB_C_ITE_XML ';
  end;
begin
   BUS_SQ_C_ITE_XML.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_C_ITE_XML.CommandText := enSqlIteXml + ' WHERE 1=2 '
        else
           BUS_SQ_C_ITE_XML.CommandText := enSqlIteXml +
             ' WHERE ID_EMITENTE = ''' + VarToStr(Input[1]) +''' ' +
             '   AND ID_FABRICA = ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := BUS_DP_C_ITE_XML.Data;

end;

function TSM.BUS_DP_C_LME_DOCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusLmeDoc: String;
  begin
     Result :=
            ' SELECT LME_D.CODIGO '+
            ' FROM PCP_TB_C_LME_DOC LME_D ';

  end;

begin
    BUS_SQ_C_LME_DOC.Close;
    if Input[0] = 0 then
       begin
         BUS_SQ_C_LME_DOC.CommandText := enSqlBusLmeDoc +
            ' WHERE LME_D.ID_LME    = ''' + VarToStr(Input[1]) + ''' AND ' +
            '       LME_D.ID_LME_D <> ''' + VarToStr(Input[2]) + ''' AND ' +
            '       LME_D.CODIGO    = ''' + VarToStr(Input[3]) + '''';
       end;

    result := BUS_DP_C_LME_DOC.Data;
end;

function TSM.BUS_DP_C_LME_DOC_DPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusLmeDocDpg: String;
  begin
    Result :=
      'SELECT LME_DP.NOME_FORMULARIO, LME_D.CODIGO, LME_D.REVISAO '+
      ' FROM PCP_TB_C_LME_DPG LME_DP '+
      '      left outer join PCP_TB_C_LME_DOC LME_D on '+
      ' (LME_D.ID_LME   = LME_DP.ID_LME AND ' +
      '  LME_D.ID_LME_D = LME_DP.ID_LME_D)  ';
  end;

begin
    BUS_SQ_C_LME_DOC_DPG.Close;

    if Input[0] = 0 then
       begin
         BUS_SQ_C_LME_DOC_DPG.CommandText := enSqlBusLmeDocDpg +
            ' WHERE LME_DP.ID_LME = ''' + VarToStr(Input[1]) + ''' AND ' +
            '       LME_DP.NOME_FORMULARIO = ''' + VarToStr(Input[2]) + ''' ';
       end;
    result := BUS_DP_C_LME_DOC_DPG.Data;

end;

function TSM.BUS_DP_C_PAR_CPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlParCpg: String;
  begin
    Result :=
        ' SELECT PPG.*, CPG.DESCRICAO AS INT_NOMECPG FROM CAD_TB_C_PAR_CPG PPG ' +
        '  left outer join CAD_TB_C_CPG CPG ON (CPG.ID_CONDICAO_PAG = PPG.ID_CONDICAO_PAG)';
  end;
begin
   BUS_SQ_C_PAR_CPG.Close;

   BUS_SQ_C_PAR_CPG.CommandText := enSqlParCpg + ' WHERE 1 = 1 ';

   if Input[0] = 0 then
      begin
        if input[2] <> '' then
           begin
             BUS_SQ_C_PAR_CPG.CommandText := BUS_SQ_C_PAR_CPG.CommandText +
                ' AND PPG.ID_EMPRESA = '''+VarToStr(Input[1])+''' '+
                ' AND PPG.SEQUENCIA <= ''' + VarToStr(Input[2]) +''' ';
           end;
      end;

   BUS_SQ_C_PAR_CPG.CommandText := BUS_SQ_C_PAR_CPG.CommandText + ' ORDER BY SEQUENCIA ';

   Result := BUS_DP_C_PAR_CPG.Data;
end;

function TSM.BUS_DP_C_PAR_CPG_INFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlParCpgInf: String;
  begin
    Result := ' select ppg.id_empresa, ppg.id_condicao_pag, cpg.descricao as int_nomecpg, ppg.sequencia, ccc.per_reajuste ' +
              ' from cad_tb_c_par_cpg ppg                                                        ' +
              '   left outer join cad_tb_c_cpg cpg on (cpg.id_condicao_pag = ppg.id_condicao_pag) ' +
              '   left outer join cad_tb_c_par_cpg ccc on ( ppg.id_empresa = ccc.id_empresa and ' +
              '                                            ppg.sequencia >= ccc.sequencia) ';

  end;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 12/11/2015 }

   BUS_SQ_C_PAR_CPG_INF.Close;
   BUS_SQ_C_PAR_CPG_INF.CommandText := enSqlParCpgInf +
      ' where ppg.id_empresa = ''' + VarToStr(Input[0])  +''' ' +
      '   and cpg.tipo_pagamento in (0,1) ' +
      ' order by ppg.sequencia ' ;
   Result := BUS_DP_C_PAR_CPG_INF.Data;
   BUS_SQ_C_PAR_CPG_INF.close;
end;

function TSM.BUS_DP_C_PAR_CTRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlParCtr: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PAR_CTR  ';
  end;
begin
   BUS_SQ_C_PAR_CTR.Close;
   BUS_SQ_C_PAR_CTR.CommandText := enSqlParCtr +
      ' WHERE ID_EMPRESA = ''' + VarToStr(Input[0])  +''' ';

   Result := BUS_DP_C_PAR_CTR.Data;
end;

function TSM.BUS_DP_C_PAR_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlParNfe: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PAR_NFE  ';
  end;
begin
   BUS_SQ_C_PAR_NFE.Close;
   BUS_SQ_C_PAR_NFE.CommandText := enSqlParNfe +
      ' WHERE ID_EMPRESA = ''' + VarToStr(Input[0])  +''' ';

   Result := BUS_DP_C_PAR_NFE.Data;
end;

function TSM.BUS_DP_C_PAR_SERDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlParSer: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PAR_SER  ';
  end;
begin
   BUS_SQ_C_PAR_SER.Close;
   BUS_SQ_C_PAR_SER.CommandText := enSqlParSer +
      ' WHERE ID_EMPRESA = ''' + VarToStr(Input[0]) +''' AND NFE_SERIE = ''' + VarToStr(Input[1]) +''' ';

   Result := BUS_DP_C_PAR_SER.Data;
end;

function TSM.BUS_DP_C_PCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPct: String;
  begin
    Result :=
      ' with pst as (select * from cad_tb_c_pct pct where pct.tipo=1) '+
      ' SELECT PCT.*, '+
      ' CAST (CASE PCT.TIPO '+
      '            WHEN 0 THEN ''Analtico'' '+
      '            WHEN 1 THEN ''Sinttico'' '+
      '         END AS VARCHAR(10)) AS INT_TIPO, '+

      ' CAST (CASE PCT.TIPO_DESP '+
      '            WHEN 0 THEN ''Despesas'' '+
      '            WHEN 1 THEN ''Receitas'' '+
      '            WHEN 2 THEN ''Sem Fluxo'' '+
      '            WHEN 3 THEN ''Tributos'' '+
      '            WHEN 4 THEN ''Resultado'' '+
      '         END AS VARCHAR(10)) AS INT_TIPO_DESP, '+

      ' pst.id_plano as int_codpct_snt, '+
      ' pst.descricao as int_descpct_snt  from cad_tb_c_pct pct '+
      ' LEFT OUTER JOIN PST ON PST.ID_PLANO=substring(PCT.ID_PLANO from 1 for 6)||''000'' ';

  end;
begin
   { TODO -oLuan : Criado em 08/03/2016 }
   //Esse select  utilizado pelo PBX(Baixa de Contas a Pagar) para listar os plnos de contas
   //com seu respectivo registro sintetico
   BUS_SQ_C_PCT.Close;

   if Input[0] = 90 then
      begin
         BUS_SQ_C_PCT.CommandText := enSqlPct +
             'WHERE (PCT.TIPO_DESP not in (' + VarToStr(Input[1]) +')) and PCT.tipo=0 ';
      end;

   Result := BUS_DP_C_PCT.Data;

   BUS_SQ_C_PCT.Close;
end;

function TSM.BUS_DP_C_PES_MODDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPes: String;
  begin
    Result :=
      ' Select mod.*, pes.descricao as int_perfilseg '+
      ' from cad_tb_c_pes_mod mod '+
      ' left outer join cad_tb_c_pes pes on pes.id_perfil_seg=mod.id_perfil_seg ';
  end;
begin
  BUS_SQ_C_PES_MOD.Close;
  BUS_SQ_C_PES_MOD.CommandText := enSqlPes +
     ' WHERE mod.id_perfil_seg = ''' + VarToStr(Input[0]) +''' '+
     ' AND mod.ativo = ''T''  '+
     ' order by mod.menu, mod.modulo, mod.descricao ';
   //CMServerForm.mm.Lines.Add(BUS_SQ_C_PES_MOD.CommandText);
   Result := BUS_DP_C_PES_MOD.Data;
end;

function TSM.BUS_DP_C_REPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRep: String;
  begin
    Result :=
      'select * from cad_tb_c_for_rep rep ';
  end;
begin
   BUS_SQ_C_REP.Close;
   BUS_SQ_C_REP.CommandText := enSqlRep +
     ' WHERE rep.id_fornecedor = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_C_REP.Data;
end;

function TSM.BUS_DP_M_BRD_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinBrdTit: String;
  begin
    Result :=
       ' SELECT BTI.* , frn.fantasia as int_nomefor                                   ' +
       '       FROM FIN_TB_M_BRD_TIT BTI                                              ' +
       '   left outer join fin_tb_m_brd  brd on brd.id_brd   = bti.id_brd             ' +
       '   left outer join fin_tb_m_pag pag on pag.id_titulo = bti.id_titulo          ' +
       '   left outer join cad_tb_c_for frn on frn.id_fornecedor = pag.id_fornecedor  ' +
       ' WHERE 1 = 1 ' ;
  end;
begin

   BUS_SQ_M_BRD_TIT_INT.Close;
   BUS_SQ_M_BRD_TIT_INT.CommandText := enSqlFinBrdTit;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_BRD_TIT_INT.CommandText := BUS_SQ_M_BRD_TIT_INT.CommandText +
         ' and bti.id_brd = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_BRD_TIT_INT.CommandText := BUS_SQ_M_BRD_TIT_INT.CommandText +
         ' and brd.id_brd <> ''' + VarToStr(Input[1]) +''' ' +
         ' and bti.id_titulo = ''' + VarToStr(Input[2]) +''' ' +
         ' and brd.baixado = false and brd.cancelado = false ';
      end;

   if Input[0] = 2 then
      begin
        BUS_SQ_M_BRD_TIT_INT.CommandText := BUS_SQ_M_BRD_TIT_INT.CommandText +
         ' and bti.id_titulo = ''' + VarToStr(Input[1]) +''' ' +
         ' and brd.baixado = false and brd.cancelado = false ';
      end;

   Result := BUS_DP_M_BRD_TIT_INT.Data;
   BUS_SQ_M_BRD_TIT_INT.Close;

end;

function TSM.BUS_DP_M_CBX_TITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCbxTiT: String;
  begin
    Result := ' SELECT CBT.* '+
              ' FROM FIN_TB_M_CBX_TIT CBT ';

  end;
begin
   BUS_SQ_M_CBX_TIT.Close;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_NFE_TIT_MAQ.CommandText := enSqlCbxTit +
            ' WHERE CBT.ID_CBX  = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_M_NFE_TIT_MAQ.Data;

   BUS_SQ_M_NFE_TIT_MAQ.Close;
end;

function TSM.BUS_DP_M_CME_MEQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusCmeMeq: String;
  begin
    Result :=
      'select CMQ.*, '+
      '  SEC.DESCRICAO AS INT_NOMESET, '+
      '   case '+
      '      when CMQ.TIPO_CONTROLE = 0 then '''+'Planejado'+''' '+
      '      when CMQ.TIPO_CONTROLE = 1 then '''+'Executado'+''' '+
      '   end as INT_TIPOCON, '+
      '   case '+
      '      when CMQ.TIPO_MANUTENCAO = 0 then '''+'Mecnica'+''' '+
      '      when CMQ.TIPO_MANUTENCAO = 1 then '''+'Eltrica/Eletnica'+''' '+
      '      when CMQ.TIPO_MANUTENCAO = 2 then '''+'Hidrulica'+''' '+
      '      when CMQ.TIPO_MANUTENCAO = 3 then '''+'Pneumtica'+''' '+
      '      when CMQ.TIPO_MANUTENCAO = 4 then '''+'Total'+''' '+
      '   end as INT_TIPOMAN, '+
      '   case '+
      '      when CMQ.FREQUENCIA = 0 then '''+'Diria'+'''  '+
      '      when CMQ.FREQUENCIA = 0 then '''+'Semanal'+''' '+
      '      when CMQ.FREQUENCIA = 0 then '''+'Mensal'+''' '+
      '      when CMQ.FREQUENCIA = 0 then '''+'Trimestral'+''' '+
      '      when CMQ.FREQUENCIA = 0 then '''+'Semestral'+''' '+
      '   end as INT_FREQUEN, '+
      '   case '+
      '      when CMQ.NRO_SEMANA = 1 then '''+'1'+''' '+
      '      when CMQ.NRO_SEMANA = 2 then '''+'2'+''' '+
      '      when CMQ.NRO_SEMANA = 3 then '''+'3'+''' '+
      '      when CMQ.NRO_SEMANA = 4 then '''+'4'+''' '+
      '      when CMQ.NRO_SEMANA = 5 then '''+'5'+''' '+
      '   end as INT_NUMESEM, '+
      '   case '+
      '      when CMQ.MES = 1 then '''+'Janeiro'+''' '+
      '      when CMQ.MES = 2 then '''+'Fevereiro'+''' '+
      '      when CMQ.MES = 3 then '''+'Maro'+'''  '+
      '      when CMQ.MES = 4 then '''+'Abril'+'''  '+
      '      when CMQ.MES = 5 then '''+'Maio'+''' '+
      '      when CMQ.MES = 5 then '''+'Junho'+''' '+
      '      when CMQ.MES = 5 then '''+'Julho'+''' '+
      '      when CMQ.MES = 5 then '''+'Agosto'+''' '+
      '      when CMQ.MES = 5 then '''+'Setembro'+''' '+
      '      when CMQ.MES = 5 then '''+'Outubro'+''' '+
      '      when CMQ.MES = 5 then '''+'Novembro'+'''  '+
      '      when CMQ.MES = 5 then '''+'Dezembro'+''' '+
      '   end as INT_NOMEMES '+
      'from PCP_TB_M_CME_MEQ CMQ '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=CMQ.ID_SETOR ';

  end;
begin
   BUS_SQ_M_CME_MEQ.Close;
   if Input[0] = 0 then
      begin
           BUS_SQ_M_CME_MEQ.CommandText := enSqlBusCmeMeq +
           ' WHERE CMQ.id_meq =       ''' + VarToStr(Input[1]) +''' and '+
           '       CMQ.cme_meq = ''' + VarToStr(Input[2]) +''' and '+
           '       CMQ.realizado     = ''' + VarToStr(Input[3]) +''' ';
      end;


   Result := BUS_DP_M_CME_MEQ.Data;

end;

function TSM.BUS_DP_M_COBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinCob: String;
  begin
    Result :=
      'SELECT COB.*, '+
      '  FUN.NOME AS INT_NOMEFUN, '+
      '  CLI.NOME AS INT_NOMECLI, '+
      '  CLI.TEL_FIXO AS INT_TELFIX, '+
      '  CLI.TEL_MOVEL AS INT_TELMOV, '+
      '  CLI.EMAIL AS INT_EMAIL '+
      'FROM '+
      '  FIN_TB_M_COB COB '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=COB.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=COB.ID_CLIENTE ';
  end;
begin
   BUS_SQ_M_COB.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_COB.CommandText := enSqlFinCob + ' WHERE 1=2 '
        else
           BUS_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.ID_CONTROLE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end

   else if Input[0] = 2 then
      begin
        BUS_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.DTA_COBRANCA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        BUS_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format('  upper(COB.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
    else if Input[0] = 4 then
      begin
        BUS_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.DTA_ACORDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
    else if Input[0] = 5 then
      begin
        BUS_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_M_COB.Data;

   BUS_SQ_M_COB.Close;

end;

function TSM.BUS_DP_M_COB_TIT_TITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinCob: String;
  begin
    Result :=
     ' select cob.*, '+
     ' CAST (CASE COB.tipo_contato '+
     '             WHEN 0 THEN ''Telefone'' '+
     '             WHEN 1 THEN ''Cobrador'' '+
     '             WHEN 2 THEN ''Advogado'' '+
     '             WHEN 3 THEN ''E-mail''   '+
     '             WHEN 4 THEN ''Carta de cobrana'' '+
     '             END AS VARCHAR(15)) AS INT_TIPOCONTATO, '+
     ' cit.id_titulo,cit.dias_atraso,cli.nome as int_nomecli,cli.tel_fixo as int_telfixo,cli.tel_movel as int_telmovel, '+
     ' fun.nome as int_nomefun from fin_tb_m_cob COB '+
     ' LEFT OUTER JOIN fin_tb_m_cob_tit cit ON cit.id_controle=cob.id_controle '+
     ' LEFT OUTER JOIN cad_tb_c_cli cli ON cli.id_cliente=cob.id_cliente '+
     ' LEFT OUTER JOIN cad_tb_c_fun fun ON fun.id_funcionario=cob.id_funcionario '+
     ' where 1=1 ';

  end;
begin
   { TODO -olLuan : Criado em 22/02/2016 }

   BUS_SQ_M_COB_TIT_TIT.Close;
    //Este filtro  utilizado pela tela CSU_FM_M_COB para trazer cobrandas somente do titulo selecionado
    //na tela CSU_FM_C_CLI_FIN

   if Input[0] = 0 then
      begin
       BUS_SQ_M_COB_TIT_TIT.CommandText := enSqlFinCob +
        // ' AND COB.ID_EMPRESA = ''' + VarToStr(Input[1])+''' ' +
         ' AND CIT.ID_TITULO = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_M_COB_TIT_TIT.Data;

   BUS_SQ_M_COB_TIT_TIT.Close;
end;

function TSM.BUS_DP_M_CON_CTA_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 27/07/2015}

   BUS_SQ_M_CON_CTA_INT.Close;
   BUS_SQ_M_CON_CTA_INT.CommandText :=
         ' SELECT * FROM FIN_TB_M_CON_CXB_DET ' +
         ' WHERE MOV_GERADO = false ' +
         '   AND ID_CONCILIACAO = ''' + VarToStr(Input[0]) +''' ';

   //GerarSqlTxt(FAT_SQ_M_IQM_ITE_INT);
   Result := BUS_DP_M_CON_CTA_INT.Data;
   BUS_SQ_M_CON_CTA_INT.Close;
end;

function TSM.BUS_DP_M_CON_GER_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 27/07/2015}

   BUS_SQ_M_CON_GER_INT.Close;
   BUS_SQ_M_CON_GER_INT.CommandText :=
         ' SELECT * FROM FIN_TB_M_CON_CXB_DET ' +
         ' WHERE MOV_GERADO = TRUE ' +
         '   AND ID_CONCILIACAO = ''' + VarToStr(Input[0]) +''' ';


   Result := BUS_DP_M_CON_GER_INT.Data;
   BUS_SQ_M_CON_GER_INT.Close;
end;

function TSM.BUS_DP_M_CSU_CMP_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCsuCmpIte: String;
  begin
    Result :=
     '     SELECT CMP.ID_EMPRESA,PAR.EMP_RAZAO AS INT_NOMEEMP,CMP.STATUS,CMP.OBSERVACAO,CMP.ID_PEDIDO,CMP.DTA_PEDIDO,CMP.DTA_ENTREGA,    '+
     '     CMP.ID_FORNECEDOR, FRN.DESCRICAO AS INT_NOMEFOR,CMI.QTDE,CMI.QTDE_BAIXADA,  ' +
     '     CMI.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE   '+
     '     FROM CMP_TB_M_PED_ITE CMI        ' +
     '        LEFT OUTER JOIN CMP_TB_M_PED CMP ON (CMP.ID_PEDIDO  = CMI.ID_PEDIDO) ' +
     '        LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=CMI.ID_ITEM          ' +
     '        LEFT OUTER JOIN CAD_TB_C_FOR FRN ON (FRN.ID_FORNECEDOR = CMP.ID_FORNECEDOR) '+
     '        LEFT OUTER JOIN CAD_TB_C_PAR PAR ON (PAR.ID_EMPRESA = CMP.ID_EMPRESA) ';
  end;

begin


   BUS_SQ_M_CSU_CMP_ITE.Close;

   BUS_SQ_M_CSU_CMP_ITE.CommandText := enSqlCsuCmpIte + ' WHERE CMI.QTDE>CMI.QTDE_BAIXADA ';
   if Input[0] <> '' then
      begin
        BUS_SQ_M_CSU_CMP_ITE.CommandText := BUS_SQ_M_CSU_CMP_ITE.CommandText +
           ' AND CMP.ID_EMPRESA in (' + VarToStr(Input[0]) +')';
      end;
   if Input[1] <> '' then
      begin
        BUS_SQ_M_CSU_CMP_ITE.CommandText := BUS_SQ_M_CSU_CMP_ITE.CommandText +
           ' AND CMP.STATUS in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        BUS_SQ_M_CSU_CMP_ITE.CommandText := BUS_SQ_M_CSU_CMP_ITE.CommandText +
           ' AND CMI.ID_ITEM in (' + VarToStr(Input[2]) +')';
      end;

   BUS_SQ_M_CSU_CMP_ITE.CommandText := BUS_SQ_M_CSU_CMP_ITE.CommandText +
           ' ORDER BY CMP.ID_EMPRESA,CMP.DTA_PEDIDO DESC, CMP.ID_PEDIDO DESC ';



   Result := BUS_DP_M_CSU_CMP_ITE.Data;
end;

function TSM.BUS_DP_M_CSU_DRE_CMDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
    BUS_SQ_M_CSU_DRE_CMD.Close;

    BUS_SQ_M_CSU_DRE_CMD.CommandText :=

   {' select '+

    '          extract(year from nfe.dta_emissao) as ano, '+
    '          extract(month from nfe.dta_emissao) as mes, '+
    '         cast( ''Custo Mercadorias'' as varchar(30)) as descricao, '+
    '          cast(sum(coalesce(nit.vlr_custo,0)) as numeric(18,2)) valor, '+

    '          (select  '+
    '             cast(sum(coalesce(nif.vlr_custo,0)) as numeric(18,2)) vlr_custo_mercadoria '+
    '           from fat_tb_m_nfe_ite nif '+
    '             left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
    '             left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
    '             left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
    '           where nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
    '             nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa ='''+VarToStr(Input[0])+''' and '+
    '            extract(year from nff.dta_emissao) = '''+VarToStr(Input[1])+''' '+
    '          ) as total_ano '+


    '       from fat_tb_m_nfe_ite nit '+
    '         left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
    '         left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
    '         left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
    '       where nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
    '             nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa ='''+VarToStr(Input[0])+''' and '+
    '             extract(year from nfe.dta_emissao) = '''+VarToStr(Input[1])+''' '+
    '       group by 1,2 '+
    '       order by 1,2 '; }



    ' select '+

    '          extract(year from nfe.dta_emissao) as ano, '+
    '          extract(month from nfe.dta_emissao) as mes, '+
    '         cast( ''Custo Mercadorias (Custo na NF)'' as varchar(50)) as descricao, '+
    '          cast(sum(coalesce(nit.vlr_custo*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) as numeric(18,2)) valor, '+

    '          (select  '+
    '             cast(sum(coalesce(nif.vlr_custo*(NIF.QTDE-NIF.QTDE_DEVOLVIDA),0)) as numeric(18,2)) vlr_custo_mercadoria '+
    '           from fat_tb_m_nfe_ite nif '+
    '             LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIF.ID_ITEM '+
    '             LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
    '             left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
    '             left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
    '             left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
    '           where nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
    '                    CFO.ID_CLASSE IN (''SP10'',''SP70'') AND GRU.TIPO_ITEM <> ''09'' AND (NIF.QTDE-NIF.QTDE_DEVOLVIDA)>0 AND '+
    '             nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa ='''+VarToStr(Input[0])+''' and '+
    '            extract(year from nff.dta_emissao) = '''+VarToStr(Input[1])+''' '+
    '          ) as total_ano '+


    '       from fat_tb_m_nfe_ite nit '+
    '             LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
    '             LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
    '         left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
    '         left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
    '         left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
    '       where nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
    '               CFO.ID_CLASSE IN (''SP10'',''SP70'') AND GRU.TIPO_ITEM <> ''09'' AND (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND '+
    '             nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa ='''+VarToStr(Input[0])+''' and '+
    '             extract(year from nfe.dta_emissao) = '''+VarToStr(Input[1])+''' '+
    '       group by 1,2 '+
    '       order by 1,2 ';


   Result := BUS_DP_M_CSU_DRE_CMD.Data;
   BUS_SQ_M_CSU_DRE_CMD.close;
end;

function TSM.BUS_DP_M_CSU_DRE_DPODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_CSU_DRE_DPO.Close;

    BUS_SQ_M_CSU_DRE_DPO.CommandText :=

       '   select '+
       '       pct.id_plano, '+
       '	pct.descricao as int_nomepct, '+
       '       extract(year from pgt.dta_pagamento) as ano, '+
       '       extract(month from pgt.dta_pagamento) as mes, '+
       '       sum(pgt.vlr_pagamento) as valor, '+
       '       (select '+
       '          sum(pgt.vlr_pagamento) as vlr_pagamento_ano '+
       '        from fin_tb_m_pag_pag pgt '+
       '          left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
       '          left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
       '        where '+
       '          pag.id_empresa =''' +VarToStr(Input[0])+''' '+
       '          and extract(year from pgt.dta_pagamento) = '''+VarToStr(Input[1])+''' '+
       '          and coalesce(com_substituicao,false) = false '+
       '          and pct.estr_dre = 1 '+
       '          and pct.tipo_desp = 0 '+
       '       ) as total_ano '+

       '    from fin_tb_m_pag_pag pgt '+
       '          left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
       '          left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
       '        where '+
       '          pag.id_empresa ='''+VarToStr(Input[0])+''' '+
       '          and extract(year from pgt.dta_pagamento) ='''+VarToStr(Input[1])+''' '+
       '          and coalesce(com_substituicao,false) = false '+
       '          and pct.estr_dre = 1 '+
       '          and pct.tipo_desp = 0 '+
       '    group by 1,2,3,4 '+
       '    order by 1,2,3,4 ';


   Result := BUS_DP_M_CSU_DRE_DPO.Data;
   BUS_SQ_M_CSU_DRE_DPO.close;
end;

function TSM.BUS_DP_M_CSU_DRE_DVNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
VAR
  sql:string;
  i:integer;
begin
    BUS_SQ_M_CSU_DRE_DVN.Close;

    BUS_SQ_M_CSU_DRE_DVN.CommandText := '';
    sql := '';
    for I := 0 to 6 do
      begin
        sql := sql +
        ' select '+

        '      extract(year from nfe.dta_emissao) as ano, '+
        '      extract(month from nfe.dta_emissao) as mes, ';

        sql := sql +' '''+IntToStr(i) +''' AS cod, ';

        case i of
           0:sql := sql +' cast(''PIS'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.pis_valor,0)) as numeric(18,2))  as valor, ';

           1:sql := sql +' cast(''COF'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.cof_valor,0)) as numeric(18,2))  as valor, ';

           2:sql := sql +' cast(''ICMS'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.icm_n_valor,0)) as numeric(18,2))  as valor, ';

           3:sql := sql +' cast(''IPI'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.ipi_valor,0)) as numeric(18,2))  as valor, ';

           4:sql := sql +' cast(''ISS'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.iss_valor,0)) as numeric(18,2))  as valor, ';

           5:sql := sql +' cast(''IR/CS'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.dre_perc_ircs*nit.vlr_liquido,0)/100) as numeric(18,2))  as valor, ';

           6:sql := sql +' cast(''Outros'' AS VARCHAR(10)) AS descricao, '+
                         ' cast(sum(coalesce(nit.dre_perc_out_ded_ven*nit.vlr_liquido,0)/100) as numeric(18,2))  as valor, ';
        end;

        sql := sql +
        '      (select  '+
        '         cast(sum(coalesce(nif.pis_valor,0))+sum(coalesce(nif.cof_valor,0))+sum(coalesce(nif.ipi_valor,0))+ '+
        '                      sum(coalesce(nif.icm_n_valor,0))+sum(coalesce(nif.icm_n_valor,0))+sum(coalesce(nif.iss_valor,0)) '+
        '                       +sum(coalesce(nif.dre_perc_out_ded_ven*nif.vlr_liquido,0)/100) +sum(coalesce(nif.dre_perc_ircs*nif.vlr_liquido,0)/100)  as numeric(18,2)) vlr_liquido_ano '+
        '       from fat_tb_m_nfe_ite nif  '+
        '         left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
        '         left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
        '         left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
        '       where cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and  '+
        '         nff.faturada = true and nff.tipo_nf = ''S'' and  nff.id_empresa ='''+VarToStr(Input[0])+''' and  '+
        '         extract(year from nff.dta_emissao) = '''+VarToStr(Input[1])+'''  '+
        '      ) as total_ano '+

        '   from fat_tb_m_nfe_ite nit '+
        '     left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
        '     left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo  '+
        '     left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
        '   where cfo.id_classe in (''SP10'',''SP70'') and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
        '         nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa =''' +VarToStr(Input[0])+''' and '+
        '         extract(year from nfe.dta_emissao) = '''+VarToStr(Input[1])+''' '+
        '   group by 1,2 ';

        if i<6 then
          begin
              sql := sql +' union all ';
          end
        else
          begin
              sql := sql +' order by cod,mes ';
          end;
     end;
   BUS_SQ_M_CSU_DRE_DVN.CommandText := sql;

   Result := BUS_DP_M_CSU_DRE_DVN.Data;
   BUS_SQ_M_CSU_DRE_DVN.close;
end;

function TSM.BUS_DP_M_CSU_DRE_RNODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
     BUS_SQ_M_CSU_DRE_RNO.Close;

    BUS_SQ_M_CSU_DRE_RNO.CommandText :=

     ' select  '+
     '         pct.id_plano, '+
     '	pct.descricao as int_nomepct, '+
     '         extract(year from rgt.dta_pagamento) as ano, '+
     '         extract(month from rgt.dta_pagamento) as mes,  '+
     '         sum(rgt.vlr_pagamento) as valor, '+
     '         (select  '+
     '            sum(rgt.vlr_pagamento) as vlr_pagamento_ano '+
     '          from fin_tb_m_rec_pag rgt '+
     '            left outer join fin_tb_m_rec rec on rec.id_titulo = rgt.id_titulo '+
     '            left outer join cad_tb_c_pct pct on pct.id_plano = rgt.id_plano '+
     '          where '+
     '            rec.id_empresa ='''+ VarToStr(Input[0])+''' '+
     '            and extract(year from rgt.dta_pagamento) ='''+ VarToStr(Input[1])+''' '+
     '            and coalesce(com_substituicao,false) = false '+
     '            and pct.estr_dre = 2 '+
     '            and pct.tipo_desp = 1 '+
     '         ) as total_ano  '+

     '      from fin_tb_m_rec_pag rgt '+
     '            left outer join fin_tb_m_rec rec on rec.id_titulo = rgt.id_titulo '+
     '            left outer join cad_tb_c_pct pct on pct.id_plano = rgt.id_plano '+
     '          where '+
     '            rec.id_empresa ='''+ VarToStr(Input[0])+''' '+
     '            and extract(year from rgt.dta_pagamento) ='''+ VarToStr(Input[1])+''' '+
     '            and coalesce(com_substituicao,false) = false '+
     '            and pct.estr_dre = 2 '+
     '            and pct.tipo_desp = 1 '+
     '      group by 1,2,3,4 '+
     '      order by 1,2,3,4 ';


   Result := BUS_DP_M_CSU_DRE_RNO.Data;
   BUS_SQ_M_CSU_DRE_RNO.close;
end;

function TSM.BUS_DP_M_CSU_DRE_RVNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
    BUS_SQ_M_CSU_DRE_RVN.Close;

    BUS_SQ_M_CSU_DRE_RVN.CommandText :=

         ' select '+

          '    extract(year from nfe.dta_emissao) as ano, '+
          '    extract(month from nfe.dta_emissao) as mes, '+
          '    cast(''Receitas de Vendas''  as varchar(20) ) as descricao, '+
          '    cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-sum(coalesce(nit.vlr_desconto,0)) as numeric(18,2)) valor, '+

          '    (select '+
          '       cast(sum(coalesce(nif.vlr_unitario*(nif.qtde-nif.qtde_devolvida),0))-sum(coalesce(nif.vlr_desconto,0)) as numeric(18,2)) vlr_liquido_ano '+
          '     from fat_tb_m_nfe_ite nif '+
          '       left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
          '       left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
          '       left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
          '     where cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
          '       nff.faturada = true and nff.tipo_nf = ''S'' and  nff.id_empresa = '''+VarToStr(Input[0])+''' and  '+
          '       extract(year from nff.dta_emissao) = '''+VarToStr(Input[1]) +''' '+
          '    ) as total_ano '+

          ' from fat_tb_m_nfe_ite nit '+
          '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
          '   left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
          '   left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
          ' where cfo.id_classe in (''SP10'',''SP70'') and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
          '       nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa = '''+VarToStr(Input[0])+''' and  '+
          '       extract(year from nfe.dta_emissao) = '''+VarToStr(Input[1])+''' '+
          ' group by 1,2 '+
          ' order by 1,2 ';


   Result := BUS_DP_M_CSU_DRE_RVN.Data;
   BUS_SQ_M_CSU_DRE_RVN.close;
end;

function TSM.BUS_DP_M_CSU_GER_PDEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

   { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio de Despesas }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_PDE.Close;
  BUS_SQ_M_CSU_GER_PDE.CommandText :=

          ' select ' + #13#10 +
          '       pag.id_empresa,' + #13#10 +
          '       par.emp_fantasia,' + #13#10 +
          '       extract(year from pbt.dta_pagamento) as ano,' + #13#10 +
          '       ptt.id_plano,' + #13#10 +
          '       ptt.descricao,' + #13#10 +
          '       ' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '       where' + #13#10 +
          '          prc.id_empresa = pag.id_empresa and' + #13#10 +
          '				   extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' ' + #13#10 +
          '          and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '          and pbb.id_plano = ptt.id_plano       ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '       ),0) as ano_anterior,' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '       where ' + #13#10 +
          '           prc.id_empresa = pag.id_empresa and ' + #13#10 +
          '					  extract(year from pbb.dta_pagamento) = 2016 ' + #13#10 +
          '           and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '           and pbb.id_plano = ptt.id_plano ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '        ),0) as ano_atual,' + #13#10 +
          '       round(((coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '       where ' + #13#10 +
          '           prc.id_empresa = pag.id_empresa and' + #13#10 +
          '					  extract(year from pbb.dta_pagamento) = 2016 ' + #13#10 +
          '           and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '           and pbb.id_plano = ptt.id_plano  ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '      ),0) - ' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '       where ' + #13#10 +
          '           prc.id_empresa = pag.id_empresa and' + #13#10 +
          '				    extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' ' + #13#10 +
          '           and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '           and pbb.id_plano = ptt.id_plano ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '        ),0) ) * 100) ' + #13#10 +
          '		' + #13#10 +
          '			 / ' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '       where ' + #13#10 +
          '          prc.id_empresa = pag.id_empresa and' + #13#10 +
          '					 extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[1]) + ''' ' + #13#10 +
          '          and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '          and pbb.id_plano = ptt.id_plano ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '        ),0),2) as perc_ano_anterior,' + #13#10 +
          '       round((coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '       where ' + #13#10 +
          '					prc.id_empresa = pag.id_empresa and' + #13#10 +
          '          extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[1]) +'''  ' + #13#10 +
          '          and coalesce(pbb.com_substituicao,false) = false ' + #13#10 +
          '          and pbb.id_plano = ptt.id_plano ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
          '         ' + #13#10 +
          '        ),0) * 100) / ' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '       where ' + #13#10 +
          '          prc.id_empresa = pag.id_empresa ' + #13#10 +
          '          and coalesce(pbb.com_substituicao,false) = false ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +


          '				and  extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
          '        ),0),2) as perc_ano_atual,' + #13#10 +
          '       coalesce( (select ' + #13#10 +
          '          sum(coalesce(pbb.vlr_pagamento,0))' + #13#10 +
          '			 from fin_tb_m_pag_pag pbb' + #13#10 +
          '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = pbb.id_forma_pag)' + #13#10 +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pbb.id_plano)    ' + #13#10 +
          '			     left outer join fin_tb_m_pag prc on (prc.id_titulo = pbb.id_titulo)' + #13#10 +
          '       where ' + #13#10 +
          '          prc.id_empresa = pag.id_empresa ' + #13#10 +
          '          and coalesce(pbb.com_substituicao,false) = false ' + #13#10;

          if Input[3] = 1 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 0 ' + #13#10;
             end;
          if Input[3] = 2 then
             begin
               BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +
                     ' and  pct.tipo_desp = 5 ' + #13#10;
             end;

          BUS_SQ_M_CSU_GER_PDE.CommandText :=
                   BUS_SQ_M_CSU_GER_PDE.CommandText +

          '				 and extract(year from pbb.dta_pagamento) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
          '        ),0) as total_geral,' + #13#10 +
          '  ' + #13#10 +
          '       COALESCE( sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 1 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_jan,' + #13#10 +
          '       ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 2 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_fev,' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 3 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_mar,' + #13#10 +
          '       ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 4 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_abr,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 5 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_mai,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 6 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_jun,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 7 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_jul,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 8 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_ago,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 9 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_set,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 10 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_out,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 11 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_nov,              ' + #13#10 +
          '       COALESCE(sum( case extract(month from pbt.dta_pagamento) ' + #13#10 +
          '          when 12 then pbt.vlr_pagamento ' + #13#10 +
          '       end),0) as mes_dez              ' + #13#10 +
          '       ' + #13#10 +
          ' from fin_tb_m_pag_pag pbt' + #13#10 +
          '   left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = pbt.id_forma_pag)' + #13#10 +
          '   left outer join cad_tb_c_pct ptt on (ptt.id_plano = pbt.id_plano) ' + #13#10 +
          '   left outer join fin_tb_m_pag pag on (pag.id_titulo = pbt.id_titulo)' + #13#10 +
          '   left outer join cad_tb_c_par par on (par.id_empresa = pag.id_empresa)' + #13#10 +
          'where ' + #13#10 +
          '   pag.id_empresa in (' + VarToStr(Input[0]) +')  and ' + #13#10 +
          '   extract(year from pbt.dta_pagamento) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
          '   and coalesce(pbt.com_substituicao,false) = false ' + #13#10 +
          '      ' + #13#10;

  if Input[3] = 1 then
     begin
       BUS_SQ_M_CSU_GER_PDE.CommandText :=
           BUS_SQ_M_CSU_GER_PDE.CommandText +
             ' and  ptt.tipo_desp = 0 ' + #13#10;
     end;
  if Input[3] = 2 then
     begin
       BUS_SQ_M_CSU_GER_PDE.CommandText :=
           BUS_SQ_M_CSU_GER_PDE.CommandText +
             ' and  ptt.tipo_desp = 5 ' + #13#10;
     end;

  BUS_SQ_M_CSU_GER_PDE.CommandText :=
              BUS_SQ_M_CSU_GER_PDE.CommandText +
          ' group by 1,2,3,4,5' + #13#10 +
          ' order by 1,2,3,4,5';

  result := BUS_DP_M_CSU_GER_PDE.Data;
  BUS_SQ_M_CSU_GER_PDE.Close;
end;

function TSM.BUS_DP_M_CSU_GER_PFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio Atual Financeira Estoque }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }

  BUS_SQ_M_CSU_GER_PFE.Close;
  BUS_SQ_M_CSU_GER_PFE.CommandText :=

    ' select emp.id_empresa, emp.emp_fantasia,' + #13#10 +
    '        cast(  substr(ite.id_grupo,1,4)||''.000'' as varchar(8)) id_grupo,  ' + #13#10 +
    '       (select descricao from cad_tb_c_gru ggg where ggg.id_grupo = substr(ite.id_grupo,1,4)||''.000'') as descricao,' + #13#10 +
    '       cast(sum(coalesce(fes.saldo_fisico,0) * coalesce(fes.vlr_custo_medio,0)) as numeric(18,2)) as total_custo_medio' + #13#10 +
    ' from est_tb_m_fes fes    ' + #13#10 +
    '   left outer join cad_tb_c_par emp on (emp.id_empresa = fes.id_empresa)' + #13#10 +
    '   left outer join cad_tb_c_ite ite on (ite.id_item   = fes.id_item)' + #13#10 +
    ' where emp.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
    '   and coalesce(fes.saldo_fisico,0) <> 0 '  + #13#10 +
    ' group by 1,2,3,4 ' + #13#10 +
    ' order by 1,2,5 desc';

  result := BUS_DP_M_CSU_GER_PFE.Data;
  BUS_SQ_M_CSU_GER_PFE.Close;
end;

function TSM.BUS_DP_M_CSU_GER_PFFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
 { TODO -oMaxsuel -cCriao :
    Criado em 25/07/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio Atual Financeira Estoque por fornecedor }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }

  BUS_SQ_M_CSU_GER_PFF.Close;
  BUS_SQ_M_CSU_GER_PFF.CommandText :=

    ' select emp.id_empresa, emp.emp_fantasia,' + #13#10 +
    '     ite.id_fornecedor, frn.fantasia,' + #13#10 +
    '       cast(sum(coalesce(fes.saldo_fisico,0) * coalesce(fes.vlr_custo_medio,0)) as numeric(18,2)) as total_custo_medio' + #13#10 +
    ' from est_tb_m_fes fes    ' + #13#10 +
    '   left outer join cad_tb_c_par emp on (emp.id_empresa = fes.id_empresa)' + #13#10 +
    '   left outer join cad_tb_c_ite ite on (ite.id_item   = fes.id_item) ' + #13#10 +
    '   left outer join cad_tb_c_for frn on (frn.id_fornecedor = ite.id_fornecedor) ' + #13#10 +
    ' where emp.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
    '   and coalesce(fes.saldo_fisico,0) <> 0 '  + #13#10 +
    ' group by 1,2,3,4 ' + #13#10 +
    ' order by 1,2,5 desc ';

  result := BUS_DP_M_CSU_GER_PFF.Data;
  BUS_SQ_M_CSU_GER_PFF.Close;
end;

function TSM.BUS_DP_M_CSU_GER_PFTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 22/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio de Faturamento }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_PFT.Close;
  BUS_SQ_M_CSU_GER_PFT.CommandText :=

      '    select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     cast(substr(gru.id_grupo,1,4)||''.000''    as varchar(8)) id_grupo,' + #13#10 +
      '     cast((select descricao from cad_tb_c_gru ggg where ggg.id_grupo = substr(gru.id_grupo,1,4)||''.000'') as varchar(30)) descricao, ' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      '  left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +')' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'union ALL' + #13#10 +
      'select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     cast(substr(gru.id_grupo,1,4)||''.000''    as varchar(8)) id_grupo,' + #13#10 +
      '     cast((select descricao from cad_tb_c_gru ggg where ggg.id_grupo = substr(gru.id_grupo,1,4)||''.000'') as varchar(30)) descricao, ' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,     ' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      '  left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[2]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'order by 1,2,3,4,5,6';

  Result := BUS_DP_M_CSU_GER_PFT.Data;

  BUS_SQ_M_CSU_GER_PFT.Close;
end;


function TSM.BUS_DP_M_CSU_GER_PFT_EMPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao :
    Criado em 28/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio de Faturamento - Por Empresa }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_PFT_EMP.Close;
  BUS_SQ_M_CSU_GER_PFT_EMP.CommandText :=

      ' select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_emp,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_emp_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      '  left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
      'group by 1,2,3	' + #13#10 +
      'union ALL' + #13#10 +
      'select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_emp,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_emp_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      '  left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[2]) +'''' + #13#10 +
      'group by 1,2,3' + #13#10 +
      'order by 1,2,3' ;

  Result := BUS_DP_M_CSU_GER_PFT_EMP.Data;

  BUS_SQ_M_CSU_GER_PFT_EMP.Close;
end;

function TSM.BUS_DP_M_CSU_GER_PGFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   mes1,mes2,mes3,mes4,mes5,mes6: Integer;
begin
 { TODO -oMaxsuel -cCriao :
    Criado em 25/08/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Pagamentos Futuros }

  {
     Passar parmetros:
					- Input[0] - Empresa
          - Input[1] - Ms inicial
  }

 mes1 := strtoint(input[1]);
  mes2 := Mes1 + 1;
  if mes2 = 13 then
     mes2 :=  1;
  mes3 := Mes2 + 1;
  if mes3 = 13 then
     mes3 :=  1;
  mes4 := Mes3 + 1;
  if mes4 = 13 then
     mes4 :=  1;
  mes5 := Mes4 + 1;
  if mes5 = 13 then
     mes5 :=  1;
  mes6 := Mes5 + 1;
  if mes6 = 13 then
     mes6 :=  1;


  BUS_SQ_M_CSU_GER_PGF.Close;
  BUS_SQ_M_CSU_GER_PGF.CommandText :=
          ' select ''A'' as tipo_reg, pag.id_empresa, par.emp_fantasia, pag.id_forma_pag, cast(fpg.descricao as varchar(30)) as int_nomefpg,   ' +
          ' (select coalesce(sum(ppa.vlr_saldo),0)' + #13#10 +
          '        ' + #13#10 +
          ' from fin_tb_m_pag ppa' + #13#10 +
          '  left outer join cad_tb_c_par prr on ppa.id_empresa   = prr.id_empresa' + #13#10 +
          '  left outer join cad_tb_c_fpg fgg on ppa.id_forma_pag = fgg.id_forma_pag' + #13#10 +
          ' where  ' + #13#10 +
          '    ppa.id_forma_pag = pag.id_forma_pag and' + #13#10 +
          '    ppa.id_empresa = pag.id_empresa and' + #13#10 +
          '    ppa.dta_vencimento < current_date and' + #13#10 +
          '    ppa.vlr_saldo > 0' + #13#10 +
          ' ) as vlr_saldo_vencido, ' + #13#10 +
          ' (select coalesce(sum(ppa.vlr_saldo),0)' + #13#10 +
          '        ' + #13#10 +
          ' from fin_tb_m_pag ppa' + #13#10 +
          '  left outer join cad_tb_c_par prr on ppa.id_empresa   = prr.id_empresa' + #13#10 +
          '  left outer join cad_tb_c_fpg fgg on ppa.id_forma_pag = fgg.id_forma_pag' + #13#10 +
          ' where  ' + #13#10 +
          '    ppa.id_forma_pag = pag.id_forma_pag and' + #13#10 +
          '    ppa.id_empresa = pag.id_empresa  and' + #13#10 +
          '    ppa.vlr_saldo > 0 and ' + #13#10 +
          '    ppa.dta_vencimento = current_date ' +
          ' ) as vlr_saldo_hoje,' + #13#10 +
          '        ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes1) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '      as "Primeiro_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes2) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Segundo_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes3) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Tereceiro_mes",' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes4) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Quarto_mes" ,          ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes5) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Quinto_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes6) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Sexto_mes" ' + #13#10 +
          '        from fin_tb_m_pag pag' + #13#10 +
          '   left outer join cad_tb_c_par par on pag.id_empresa   = par.id_empresa' + #13#10 +
          '   left outer join cad_tb_c_fpg fpg on pag.id_forma_pag = fpg.id_forma_pag' + #13#10 +
          ' where pag.vlr_saldo > 0' + #13#10 +
          '      and pag.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
          //'	    	and extract(year from pag.dta_vencimento) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
          //'       and pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
          //'       and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
          ' group by 1,2,3,4,5' + #13#10 +

          ' UNION ALL ' + #13#10 +
          ' select ''C'' as tipo_reg, par.id_empresa, par.emp_fantasia, 0 as id_forma_pag, cast(''-'' as varchar(30)) as int_nomefpg,' + #13#10 +
          '       0 vlr_saldo_vencido, 0 as vlr_saldo_hoje, 0 as Primeiro_mes, 0 as Segundo_mes,' + #13#10 +
          '       0 as Tereceiro_mes, 0 as Quarto_mes, 0 as Quinto_mes, 0 as Sexto_mes from  cad_tb_c_par par   ' +
          ' where par.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
          '   and exists (select * from fin_tb_m_pag pag where pag.vlr_saldo > 0 and pag.id_empresa = par.id_empresa )' +
          //'       and pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
          //'       and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''') '+

          ' UNION ALL' + #13#10 +
          ' select ''B'' as tipo_reg, pag.id_empresa, par.emp_fantasia, 0 as id_forma_pag, cast(''Total'' as varchar(30)) as int_nomefpg,     ' + #13#10 +
          '       (select coalesce(sum(ppa.vlr_saldo),0)' + #13#10 +
          '            from fin_tb_m_pag ppa' + #13#10 +
          '              left outer join cad_tb_c_par prr on ppa.id_empresa   = prr.id_empresa' + #13#10 +
          '              left outer join cad_tb_c_fpg fgg on ppa.id_forma_pag = fgg.id_forma_pag' + #13#10 +
          '            where                ' + #13#10 +
          '                ppa.id_empresa = pag.id_empresa and' + #13#10 +
          '                ppa.dta_vencimento < current_date and' + #13#10 +
          '                ppa.vlr_saldo > 0' + #13#10 +
          '            ) as vlr_saldo_vencido,' + #13#10 +
          '            (select coalesce(sum(ppa.vlr_saldo),0)' + #13#10 +
          '            from fin_tb_m_pag ppa' + #13#10 +
          '              left outer join cad_tb_c_par prr on ppa.id_empresa   = prr.id_empresa' + #13#10 +
          '              left outer join cad_tb_c_fpg fgg on ppa.id_forma_pag = fgg.id_forma_pag' + #13#10 +
          '            where                ' + #13#10 +
          '                ppa.id_empresa = pag.id_empresa  and' + #13#10 +
          '                ppa.vlr_saldo > 0 and ' + #13#10 +
          '                ppa.dta_vencimento = current_date ' +
          '               ) as vlr_saldo_hoje,' + #13#10 +
          '        ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes1) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '      as "Primeiro_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes2) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Segundo_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes3) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Tereceiro_mes",' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes4) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Quarto_mes" ,          ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes5) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Quinto_mes",' + #13#10 +
          '       ' + #13#10 +
          '     coalesce(sum(' + #13#10 +
          '       case ' + #13#10 +
          '         when  (pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +
                       ''' and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +
                       ''' ) and (extract(month from (pag.dta_vencimento))  = ' + inttostr(mes6) + ') then pag.vlr_saldo' + #13#10 +
          '       end' + #13#10 +
          '      ),0) ' + #13#10 +
          '     as "Sexto_mes" ' + #13#10 +
          '        from fin_tb_m_pag pag' + #13#10 +
          '   left outer join cad_tb_c_par par on pag.id_empresa   = par.id_empresa' + #13#10 +
          '   left outer join cad_tb_c_fpg fpg on pag.id_forma_pag = fpg.id_forma_pag' + #13#10 +
          ' where pag.vlr_saldo > 0' + #13#10 +
          '       and pag.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
          //'	    	and extract(year from pag.dta_vencimento) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
          //'       and pag.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
          //'       and pag.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+


          ' group by 1,2,3,4,5' + #13#10 +

          ' order by 2,3,1,5';

  result := BUS_DP_M_CSU_GER_PGF.Data;
  BUS_SQ_M_CSU_GER_PGF.Close;
end;


function TSM.BUS_DP_M_CSU_GER_PPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio do Contas a Pagar }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }

  BUS_SQ_M_CSU_GER_PPG.Close;
  BUS_SQ_M_CSU_GER_PPG.CommandText :=
          '  select ' + #13#10 +
          '    pag.id_empresa,' + #13#10 +
          '    emp.emp_fantasia,' + #13#10 +
          '    sum(coalesce( case  ' + #13#10 +
          '      when pag.dta_vencimento < CURRENT_DATE then pag.vlr_saldo         ' + #13#10 +
          '    end,0)) as vlr_saldo_vencido,' + #13#10 +
          '    sum(coalesce( case  ' + #13#10 +
          '      when pag.dta_vencimento > CURRENT_DATE then pag.vlr_saldo         ' + #13#10 +
          '    end,0)) as vlr_saldo_a_venc,' + #13#10 +
          '    sum(coalesce( case  ' + #13#10 +
          '      when pag.dta_vencimento = CURRENT_DATE then pag.vlr_saldo         ' + #13#10 +
          '    end,0)) as vlr_saldo_venc_hoje,' + #13#10 +
          '    sum(coalesce(pag.vlr_saldo,0)) as total_em_aberto,' + #13#10 +
          '    sum(coalesce( case   ' + #13#10 +
          '      when (pag.dta_vencimento > CURRENT_DATE) AND' + #13#10 +
          '           ((pag.dta_vencimento - CURRENT_DATE) > 0 AND' + #13#10 +
          '            (pag.dta_vencimento - CURRENT_DATE) <= 30)' + #13#10 +
          '            then pag.vlr_saldo         ' + #13#10 +
          '    end,0)) as vlr_saldo_prox_30D,' + #13#10 +
          '  ' + #13#10 +
          '    coalesce((select sum(COALESCE(vlr_pagamento,0)) vlr_pago from fin_tb_m_pag_pag pbt' + #13#10 +
          '      left outer join fin_tb_m_pag pag on (pag.id_titulo    = pbt.id_titulo)' + #13#10 +
          '      left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = pbt.id_forma_pag)' + #13#10 +
          '    where       ' + #13#10 +
          '       coalesce(pbt.com_substituicao,''false'') = ''false'' ' + #13#10 +
          '    ),0) as vlr_pago_hoje,' + #13#10 +
          '    round(((sum(coalesce(case  ' + #13#10 +
          '         when pag.dta_vencimento < CURRENT_DATE then pag.vlr_saldo         ' + #13#10 +
          '     end,0)) * 100)' + #13#10 +
          '     / ' + #13#10 +
          '     sum(coalesce(pag.vlr_saldo,0))),2) as perc_inadimplente    ' + #13#10 +
          'from fin_tb_m_pag pag' + #13#10 +
          '  left outer join cad_tb_c_par emp on (emp.id_empresa = pag.id_empresa)' + #13#10 +
          'where pag.vlr_saldo > 0 ' + #13#10 +
          '  and pag.id_empresa in (' + VarToStr(Input[0]) +')' +
          'group by 1,2 ';
  result := BUS_DP_M_CSU_GER_PPG.Data;
  BUS_SQ_M_CSU_GER_PPG.Close;
end;

function TSM.BUS_DP_M_CSU_GER_PRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio do Contas a Receber }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }
  BUS_SQ_M_CSU_GER_PRC.Close;
  BUS_SQ_M_CSU_GER_PRC.CommandText :=

          ' select ' + #13#10 +
          '   rec.id_empresa,' + #13#10 +
          '   emp.emp_fantasia,' + #13#10 +
          '   sum(coalesce( case  ' + #13#10 +
          '      when rec.dta_vencimento < CURRENT_DATE then rec.vlr_saldo         ' + #13#10 +
          '   end,0)) as vlr_saldo_vencido,' + #13#10 +
          '   sum(coalesce( case  ' + #13#10 +
          '      when rec.dta_vencimento > CURRENT_DATE then rec.vlr_saldo         ' + #13#10 +
          '   end,0)) as vlr_saldo_a_venc,' + #13#10 +
          '   sum(coalesce( case  ' + #13#10 +
          '      when rec.dta_vencimento = CURRENT_DATE then rec.vlr_saldo         ' + #13#10 +
          '   end,0)) as vlr_saldo_venc_hoje,' + #13#10 +
          '   sum(coalesce(rec.vlr_saldo,0)) as total_em_aberto,' + #13#10 +
          '   sum(coalesce( case   ' + #13#10 +
          '      when (rec.dta_vencimento > CURRENT_DATE) AND' + #13#10 +
          '           ((rec.dta_vencimento - CURRENT_DATE) > 0 AND' + #13#10 +
          '            (rec.dta_vencimento - CURRENT_DATE) <= 30)' + #13#10 +
          '            then rec.vlr_saldo         ' + #13#10 +
          '   end,0)) as vlr_saldo_prox_30D,' + #13#10 +
          '  ' + #13#10 +
          '   coalesce((select sum(COALESCE(vlr_pagamento,0)) vlr_recebido from fin_tb_m_rec_pag pbt' + #13#10 +
          '      left outer join fin_tb_m_rec rcc on (rcc.id_titulo    = pbt.id_titulo)' + #13#10 +
          '      left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = pbt.id_forma_pag)' + #13#10 +
          '   where ' + #13#10 +
          '      (rcc.id_empresa = rec.id_empresa and' + #13#10 +
          '       fpg.doc_impresso <> ''6'' and' + #13#10 +
          '       coalesce(pbt.com_substituicao,''false'') = ''false'' and ' + #13#10 +
          '       pbt.dta_pagamento = CURRENT_DATE' + #13#10 +
          '      ) or' + #13#10 +
          '      (fpg.doc_impresso = ''6'' and' + #13#10 +
          '       rcc.situacao_chq = 2   and' + #13#10 +
          '       coalesce(pbt.com_substituicao,''false'') = ''false'' and' + #13#10 +
          '       pbt.dta_pagamento = CURRENT_DATE)' + #13#10 +
          '    ),0) as vlr_recebido_hoje,' + #13#10 +
          '    round(((sum(coalesce(case  ' + #13#10 +
          '         when rec.dta_vencimento < CURRENT_DATE then rec.vlr_saldo         ' + #13#10 +
          '     end,0)) * 100)' + #13#10 +
          '     / ' + #13#10 +
          '     sum(coalesce(rec.vlr_saldo,0))),2) as perc_inadimplente    ' + #13#10 +
          ' from fin_tb_m_rec rec' + #13#10 +
          '   left outer join cad_tb_c_par emp on (emp.id_empresa = rec.id_empresa)' + #13#10 +
          ' where rec.vlr_saldo > 0 ' + #13#10 +
          '  and rec.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
          ' group by 1,2';

  result := BUS_DP_M_CSU_GER_PRC.Data;
  BUS_SQ_M_CSU_GER_PRC.Close;

end;

function TSM.BUS_DP_M_CSU_GER_PREDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio de Recebimento }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_PRE.Close;
  BUS_SQ_M_CSU_GER_PRE.CommandText :=
            '      select ' + #13#10 +
            '        rec.id_empresa,' + #13#10 +
            '        par.emp_fantasia,' + #13#10 +
            '        extract(year from rbt.dta_pagamento) as ano,' + #13#10 +
            '        rbt.id_forma_pag,' + #13#10 +
            '        fpg.descricao,' + #13#10 +
            '        ' + #13#10 +
            '        coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '      where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2    and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)       ' + #13#10 +
            '       ),0) as ano_anterior,' + #13#10 +
            '       coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '        ),0) as ano_atual,' + #13#10 +
            '       round(((coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '        ),0) - ' + #13#10 +
            '       coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[2]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '        ),0) ) * 100) ' + #13#10 +
            '		' + #13#10 +
            '			 / ' + #13#10 +
            '       coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '        ),0),2) as perc_ano_anterior,' + #13#10 +
            '       round((coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag) or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''' and fpp.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '         ' + #13#10 +
            '        ),0) * 100) / ' + #13#10 +
            '       coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''') or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''')' + #13#10 +
            '        ),0),2) as perc_ano_atual,' + #13#10 +
            '       coalesce( (select ' + #13#10 +
            '          sum(coalesce(rbb.vlr_pagamento,0))' + #13#10 +
            '			 from fin_tb_m_rec_pag rbb' + #13#10 +
            '					 left outer join cad_tb_c_fpg fpp on (fpp.id_forma_pag = rbb.id_forma_pag)' + #13#10 +
            '			     left outer join fin_tb_m_rec rrc on (rrc.id_titulo = rbb.id_titulo)' + #13#10 +
            '       where ' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso <> ''6'' and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''') or' + #13#10 +
            '					(rrc.id_empresa = rec.id_empresa and' + #13#10 +
            '           fpp.doc_impresso = ''6''  and' + #13#10 +
            '					 rrc.situacao_chq = 2         and' + #13#10 +
            '					 coalesce(rbb.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '					 and extract(year from rbb.dta_pagamento) = ''' + VarToStr(Input[1]) +''')' + #13#10 +
            '        ),0) as total_geral,' + #13#10 +
            '  ' + #13#10 +
            '       COALESCE( sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 1 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_jan,' + #13#10 +
            '       ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 2 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_fev,' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 3 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_mar,' + #13#10 +
            '       ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 4 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_abr,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 5 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_mai,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 6 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_jun,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 7 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_jul,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 8 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_ago,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 9 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_set,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 10 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_out,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 11 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_nov,              ' + #13#10 +
            '       COALESCE(sum( case extract(month from rbt.dta_pagamento) ' + #13#10 +
            '          when 12 then rbt.vlr_pagamento ' + #13#10 +
            '       end),0) as mes_dez              ' + #13#10 +
            '       ' + #13#10 +
            ' from fin_tb_m_rec_pag rbt' + #13#10 +
            '   left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rbt.id_forma_pag)' + #13#10 +
            '   left outer join fin_tb_m_rec rec on (rec.id_titulo = rbt.id_titulo)' + #13#10 +
            '   left outer join cad_tb_c_par par on (par.id_empresa = rec.id_empresa)' + #13#10 +
            'where ' + #13#10 +
            '      (rec.id_empresa in (' + VarToStr(Input[0]) +')  and' + #13#10 +
            '       fpg.doc_impresso <> ''6'' and' + #13#10 +
            '       coalesce(rbt.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '       and extract(year from rbt.dta_pagamento) = ''' + VarToStr(Input[1]) +''') or' + #13#10 +
            '      (rec.id_empresa in (' + VarToStr(Input[0]) +')  and' + #13#10 +
            '       fpg.doc_impresso = ''6''  and' + #13#10 +
            '       rec.situacao_chq = 2         and' + #13#10 +
            '       coalesce(rbt.com_substituicao,''false'') = ''false''  ' + #13#10 +
            '       and extract(year from rbt.dta_pagamento) = ''' + VarToStr(Input[1]) +''')' + #13#10 +
            'group by 1,2,3,4,5' + #13#10 +
            'order by 1,2,3,4,5';

  Result := BUS_DP_M_CSU_GER_PRE.Data;
  BUS_SQ_M_CSU_GER_PRE.Close;
end;

function TSM.BUS_DP_M_CSU_GER_RFODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 19/08/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Rentabilidade do 10 maiores fornecedores }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_RFO.Close;
  BUS_SQ_M_CSU_GER_RFO.CommandText :=

      '    select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     ite.id_fornecedor, frn.descricao, ' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      ' left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_for frn on frn.id_fornecedor = ite.id_fornecedor            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +')' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'union ALL' + #13#10 +
      'select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     ite.id_fornecedor, frn.descricao, ' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,     ' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      ' left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_for frn on frn.id_fornecedor = ite.id_fornecedor            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[2]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'order by 1,2,3,4,5,6 ';

  Result := BUS_DP_M_CSU_GER_RFO.Data;

  BUS_SQ_M_CSU_GER_RFO.Close;
end;

function TSM.BUS_DP_M_CSU_GER_RVEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 19/08/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Rentabilidade dos Vendedores }

  {
     Passar parmetros:
					- Input[0] - Empresa
					- Input[1] - Ano atual
					- Input[2] - Ano anterior
  }

  BUS_SQ_M_CSU_GER_RVE.Close;
  BUS_SQ_M_CSU_GER_RVE.CommandText :=

      '    select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     COALESCE( nff.id_vendedor, 0) as id_vendedor ,  COALESCE( fun.nome, ''????'') as descricao,' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      ' left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_fun fun on fun.id_funcionario = nff.id_vendedor           ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +')' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[1]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'union ALL' + #13#10 +
      'select ' + #13#10 +
      '     par.id_empresa,' + #13#10 +
      '     par.emp_fantasia,' + #13#10 +
      '     COALESCE( nff.id_vendedor, 0) as id_vendedor ,  COALESCE( fun.nome, ''????'') as descricao,' + #13#10 +
      '     extract(month from nff.dta_emissao) as mes,     ' + #13#10 +
      '     extract(year from nff.dta_emissao)  as ano,     ' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-' + #13#10 +
      '					sum( (coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)  ) as numeric(18,2)) as total_mes,' + #13#10 +
      '     cast(sum(coalesce(nit.vlr_custo*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as total_mes_custo' + #13#10 +
      'from fat_tb_m_nfe_ite nit  ' + #13#10 +
      '	left outer join fat_tb_m_nfe nff on nff.id_fiscal=nit.id_fiscal            ' + #13#10 +
      ' left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item  ' + #13#10 +
      '	left outer join cad_tb_c_par par on par.id_empresa=nff.id_empresa' + #13#10 +
      '	left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo ' + #13#10 +
      '	left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag            ' + #13#10 +
      '	left outer join cad_tb_c_fun fun on fun.id_funcionario = nff.id_vendedor            ' + #13#10 +
      'where' + #13#10 +
      '    cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and ' + #13#10 +
      '		nff.faturada = true and nff.tipo_nf = ''S'' and   ' + #13#10 +
      '    nff.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
      '		and extract(year from nff.dta_emissao) = ''' + VarToStr(Input[2]) +'''' + #13#10 +
      'group by 1,2,3,4,5,6	' + #13#10 +
      'order by 1,2,3,4,5,6 ';

  Result := BUS_DP_M_CSU_GER_RVE.Data;

  BUS_SQ_M_CSU_GER_RVE.Close;
end;

function TSM.BUS_DP_M_CSU_GER_ORVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
VAR
  mes:Integer;
begin

  BUS_SQ_M_CSU_GER_ORV.Close;
  BUS_SQ_M_CSU_GER_ORV.CommandText :=
       ' select                                                   '+
       ' par.id_empresa,                                          '+
       ' par.emp_fantasia as int_nomemp,                          '+
       ' extract(year from nfe.dta_emissao) as ano,               '+
       ' count(extract(year from nfe.dta_emissao)) as qtde_total, '+
       ' coalesce(sum(nfe.vlr_liquido),0) as valor_total          ';


    for mes := 1 to 12 do
      BUS_SQ_M_CSU_GER_ORV.CommandText := BUS_SQ_M_CSU_GER_ORV.CommandText +
        ' ,COALESCE(count(case extract(month from (NFE.DTA_EMISSAO))  '+
        '   when '+IntToStr(mes)+' then                               '+
        '   extract(year from nfe.dta_emissao)                        '+
        ' end),0) as qtde_mes_'+FormatFloat('00',mes)+'               '+

        ' ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))    '+
        '         when '+IntToStr(mes)+' then                         '+
        '            nfe.vlr_liquido                                  '+
        '       end),0) as valor_mes_'+FormatFloat('00',mes)+'        ';


    BUS_SQ_M_CSU_GER_ORV.CommandText := BUS_SQ_M_CSU_GER_ORV.CommandText +
        ' from fat_tb_m_nfe nfe                                              '+
        ' left outer join cad_tb_c_par par on PAR.id_empresa=NFE.ID_EMPRESA  '+
        ' left outer join ofi_tb_m_orv orv on orv.id_ordem=nfe.id_ordem      '+
        ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO          '+
        ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo  '+
        ' left outer join cad_tb_c_mve mve on mve.id_mve=vei.id_mve          '+
        ' left outer join cad_tb_c_mar mar on mar.id_mar=mve.id_mar          '+

        ' WHERE nfe.id_ordem >0 and                                          '+
        '  CFO.ID_CLASSE IN (''SP10'',''SP70'') AND                          '+
        '  NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND                 '+
        '  NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' AND  '+

       // ' extract(year from nfe.dta_emissao)='+VarToStr(Input[1])+' AND          '+
        ' PAR.ID_EMPRESA IN('+VarToStr(Input[0])+')  '+
        ' group by 1,2,3 '+
        ' order by id_empresa,ano desc,valor_total desc,qtde_total desc ';



  result := BUS_DP_M_CSU_GER_ORV.Data;
  BUS_SQ_M_CSU_GER_ORV.Close;
end;

function TSM.BUS_DP_M_CSU_GER_ORV_MARDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
VAR
  mes:Integer;
begin

  BUS_SQ_M_CSU_GER_ORV_MAR.Close;
  BUS_SQ_M_CSU_GER_ORV_MAR.CommandText :=
       ' select                                                   '+
       ' par.id_empresa,                                          '+
       ' par.emp_fantasia as int_nomemp,                          '+
       ' extract(year from nfe.dta_emissao) as ano,               '+
       ' mar.id_mar,                                              '+
       ' CAST (CASE                                               '+
       '  WHEN MAR.DESCRICAO IS NULL THEN '' INDEFINIDO''          '+
       ' ELSE MAR.DESCRICAO END AS VARCHAR(60)) AS INT_NOMEMAR,   '+
       ' count(extract(year from nfe.dta_emissao)) as qtde_total, '+
       ' coalesce(sum(nfe.vlr_liquido),0) as valor_total          ';


    for mes := 1 to 12 do
      BUS_SQ_M_CSU_GER_ORV_MAR.CommandText := BUS_SQ_M_CSU_GER_ORV_MAR.CommandText +
        ' ,COALESCE(count(case extract(month from (NFE.DTA_EMISSAO))  '+
        '   when '+IntToStr(mes)+' then                               '+
        '   extract(year from nfe.dta_emissao)                        '+
        ' end),0) as qtde_mes_'+FormatFloat('00',mes)+'               '+

        ' ,COALESCE(sum(case extract(month from (NFE.DTA_EMISSAO))    '+
        '         when '+IntToStr(mes)+' then                         '+
        '            nfe.vlr_liquido                                  '+
        '       end),0) as valor_mes_'+FormatFloat('00',mes)+'        ';


    BUS_SQ_M_CSU_GER_ORV_MAR.CommandText := BUS_SQ_M_CSU_GER_ORV_MAR.CommandText +
        ' from fat_tb_m_nfe nfe                                              '+
        ' left outer join cad_tb_c_par par on PAR.id_empresa=NFE.ID_EMPRESA  '+
        ' left outer join ofi_tb_m_orv orv on orv.id_ordem=nfe.id_ordem      '+
        ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO          '+
        ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo  '+
        ' left outer join cad_tb_c_mve mve on mve.id_mve=vei.id_mve          '+
        ' left outer join cad_tb_c_mar mar on mar.id_mar=mve.id_mar          '+

        ' WHERE nfe.id_ordem >0 and                                          '+
        '  CFO.ID_CLASSE IN (''SP10'',''SP70'') AND                          '+
        '  NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND                 '+
        '  NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' AND  '+

        ' extract(year from nfe.dta_emissao)='''+VarToStr(Input[1])+''' AND      '+
        ' PAR.ID_EMPRESA ='''+VarToStr(Input[0])+'''  '+
        ' group by 1,2,3,4,5 '+
        ' order by INT_NOMEMAR,valor_total desc,qtde_total desc ';



  result := BUS_DP_M_CSU_GER_ORV_MAR.Data;
  BUS_SQ_M_CSU_GER_ORV_MAR.Close;
end;

function TSM.BUS_DP_M_CSU_GER_XCBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio Fluxo de Caixa - Saldo dos Caixas e Bancos }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }

  BUS_SQ_M_CSU_GER_XCB.Close;
  BUS_SQ_M_CSU_GER_XCB.CommandText :=

    ' select cta.id_empresa,par.emp_fantasia, cta.id_conta,ctc.descricao,ctc.tipo,' + #13#10 +
    '    coalesce( sum(case tif.natureza' + #13#10 +
    '        when 1 then cta.vlr_lancamento' + #13#10 +
    '    end),0) -' + #13#10 +
    '    coalesce( sum(case tif.natureza' + #13#10 +
    '        when 0 then cta.vlr_lancamento' + #13#10 +
    '    end),0) as saldo,' + #13#10 +
    '    coalesce( sum(case ' + #13#10 +
    '        when (ctc.tipo = 0) and (tif.natureza = 1) then cta.vlr_lancamento' + #13#10 +
    '        when (ctc.tipo = 1) and (tif.natureza = 1  and cta.conciliado = true) then cta.vlr_lancamento' + #13#10 +
    '    end),0) -' + #13#10 +
    '    coalesce( sum(case ' + #13#10 +
    '        when (ctc.tipo = 0) and (tif.natureza = 0) then cta.vlr_lancamento' + #13#10 +
    '        when (ctc.tipo = 1)  and (tif.natureza = 0 and cta.conciliado = true) then cta.vlr_lancamento' + #13#10 +
    '    end),0) as saldo_disponivel' + #13#10 +
    ' from fin_tb_m_cta cta' + #13#10 +
    '   left outer join cad_tb_c_ctc ctc on (cta.id_conta = ctc.id_conta)' + #13#10 +
    '   left outer join cad_tb_c_par par on (par.id_empresa = cta.id_empresa)' + #13#10 +
    '   left outer join cad_tb_c_tif tif on (tif.id_tipo_financeiro = cta.id_tipo_financeiro)' + #13#10 +
    ' where cta.id_empresa in (' + VarToStr(Input[0]) +')' + #13#10 +
    ' group by 1,2,3,4,5' + #13#10 +
    ' order by par.emp_fantasia,ctc.descricao' ;

    result :=  BUS_DP_M_CSU_GER_XCB.Data;
    BUS_SQ_M_CSU_GER_XCB.Close;

end;

function TSM.BUS_DP_M_CSU_GER_XPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  dia,mes,ano: word;
  UltDia: String;
  Dias: array [1..16] of string;
  i: integer;
  Data,DataIni, DataFin: TDate;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio Fluxo de Caixa - A pagar }

  {
     Passar parmetros:
					- Input[0] - Empresa
  }


  Data := now;

  DataIni := now;
  DataFin := now+15;

  for i := 1 to 16 do
     begin
       DecodeDate(Data,ano,mes,dia);
       Dias[i] := inttostr(dia);
       Data    := Data + 1;
     end;

  BUS_SQ_M_CSU_GER_XPG.Close;
  BUS_SQ_M_CSU_GER_XPG.CommandText :=


    ' select emp.id_empresa,emp.emp_fantasia, PAG.id_forma_pag, ' + #13#10 +
    '       fpg.descricao,' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[1]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "01",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[2]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "02",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[3]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "03",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[4]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "04",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[5]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "05",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[6]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "06",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[7]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "07",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[8]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "08",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[9]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "09",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[10]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "10",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[11]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "11",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[12]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "12",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[13]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "13",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[14]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "14",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[15]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "15",' + #13#10 +
    '   coalesce( sum(case extract(day from PAG.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[16]) +''' then PAG.vlr_saldo' + #13#10 +
    '   end),0) as "16"' + #13#10 +
    ' from fin_tb_m_PAG PAG' + #13#10 +
    '     left outer join cad_tb_c_par emp on (emp.id_empresa   = PAG.id_empresa)' + #13#10 +
    '     left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = PAG.id_forma_pag) ' + #13#10 +
    ' where PAG.id_empresa in (' + VarToStr(Input[0]) +') ' + #13#10 +
    '  and PAG.vlr_saldo > 0' + #13#10 +
    ' group by 1,2,3,4' + #13#10 +
    ' order by 1,2,3,4';

    result := BUS_DP_M_CSU_GER_XPG.Data;

    BUS_SQ_M_CSU_GER_XPG.Close;
end;

function TSM.BUS_DP_M_CSU_GER_XRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  dia,mes,ano: word;
  UltDia: String;
  Dias: array [1..16] of string;
  i: integer;
  Data,DataIni, DataFin: TDate;
begin


 { TODO -oMaxsuel -cCriao :
    Criado em 25/06/2016
    Este select  para atender a statstica: Acompanhamento Gerencial
    Select: Posio Fluxo de Caixa - A Receber }

  {
     Passar parmetros:
					- Input[0] - Empresa

  }

  Data := now;

  DataIni := now;
  DataFin := now+15;

  for i := 1 to 16 do
     begin
       DecodeDate(Data,ano,mes,dia);
       Dias[i] := inttostr(dia);
       Data    := Data + 1;
     end;

  BUS_SQ_M_CSU_GER_XRC.Close;
  BUS_SQ_M_CSU_GER_XRC.CommandText :=

    ' select emp.id_empresa,emp.emp_fantasia, rec.id_forma_pag, ' + #13#10 +
    '       fpg.descricao,' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[1]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "01",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[2]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "02",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[3]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "03",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[4]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "04",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[5]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "05",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[6]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "06",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[7]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "07",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[8]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "08",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[9]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "09",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[10]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "10",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[11]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "11",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[12]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "12",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[13]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "13",' + #13#10 +
    '   ' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[14]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "14",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[15]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "15",' + #13#10 +
    '   coalesce( sum(case extract(day from rec.dta_vencimento)' + #13#10 +
    '     when ''' + VarToStr(Dias[16]) +''' then rec.vlr_saldo' + #13#10 +
    '   end),0) as "16"' + #13#10 +
    'from fin_tb_m_rec rec' + #13#10 +
    '     left outer join cad_tb_c_par emp on (emp.id_empresa   = rec.id_empresa)' + #13#10 +
    '     left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rec.id_forma_pag) ' + #13#10 +
    'where rec.id_empresa in (' + VarToStr(Input[0]) +') '                 + #13#10 +
    ' and  rec.dta_vencimento >= '''+FormatDateTime(CFormatoData, DataIni) + ''' '  +
    ' and  rec.dta_vencimento <= '''+FormatDateTime(CFormatoData, DataFin) + ''' '  +
    ' and  rec.vlr_saldo > 0' + #13#10 +
    'group by 1,2,3,4 ' + #13#10 +
    'order by 1,2,3,4 ' ;

  //CMServerForm.mm.Lines.Add(BUS_SQ_M_CSU_GER_XRC.CommandText);

  result := BUS_DP_M_CSU_GER_XRC.Data;

  BUS_SQ_M_CSU_GER_XRC.Close;
end;

function TSM.BUS_DP_M_CSU_GRV_FVNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_CSU_GRV_FVN.Close;
   BUS_SQ_M_CSU_GRV_FVN.CommandText :=
     ' select                 '+
     '     NFE.ID_EMPRESA,    '+
     '     PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
     '     COALESCE(NFE.ID_VENDEDOR,0) AS INT_COD_VND,  '+
     '     CAST( COALESCE(FUN.NOME,''INDEFINIDO'') AS VARCHAR(100)) AS INT_NOMEVND, '+


     '     COALESCE(sum(case NFE.DTA_EMISSAO    '+
     '      when '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' then              '+
     '           (COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) '+
     '     end),0) AS  VLR_BRUTO_DIA,           '+


     '    COALESCE(sum(case NFE.DTA_EMISSAO     '+
     '      when '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' then              '+
     '           (COALESCE((case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida),0)) '+
     '     end),0) AS  VLR_DESCONTO_DIA,  '+


     '    COALESCE(sum(case NFE.DTA_EMISSAO '+
     '      when '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' then          '+
     '           COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)  - (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida) '+
     '     end),0) AS  VLR_LIQUIDO_DIA, '+



     '     SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO_MSL, '+
     '     SUM(COALESCE((case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida),0)) AS VLR_DESCONTO_MSL, '+
     '     SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO_MSL  '+


     '  FROM FAT_TB_M_NFE_ITE NIT  '+
     '           LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL   '+
     '           LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA   '+
     '           LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=NFE.ID_VENDEDOR  '+
     '           LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO         '+
     '            WHERE  PAR.ID_EMPRESA = '''+ VarToStr(Input[0])+''' AND          '+

     '           NFE.DTA_EMISSAO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+''' and   '+
     '           NFE.DTA_EMISSAO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' and   '+
     '           CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND  '+
     '           NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' '+
     '           group by 1,2,3,4               ';


   Result := BUS_DP_M_CSU_GRV_FVN.Data;
   BUS_SQ_M_CSU_GRV_FVN.Close;
end;

function TSM.BUS_DP_M_CSU_GRV_NCLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_CSU_GRV_NCL.Close;
   BUS_SQ_M_CSU_GRV_NCL.CommandText :=

     ' select               '+
     '     NFE.ID_EMPRESA,  '+
     '     PAR.EMP_FANTASIA AS INT_NOMEEMP, '+
     '     COALESCE(count(case NFE.DTA_EMISSAO '+
     '      when '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+'''  then  '+
     '           NFE.ID_EMITENTE    '+
     '     end),0) AS  NUM_CLIENTE_DIA, '+
     '     COUNT(NFE.ID_EMITENTE)  AS NUM_CLIENTE_MSL  '+

     ' FROM FAT_TB_M_NFE NFE   '+
     '     LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA  '+
     '     LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
     '     LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO              '+
     '      WHERE  PAR.ID_EMPRESA = '''+VarToStr(Input[0])+''' AND                '+

     '     NFE.DTA_EMISSAO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+'''  and    '+
     '     NFE.DTA_EMISSAO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+'''  and    '+
     '     CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
     '     NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S''     '+
     '     group by 1,2        ';


   Result := BUS_DP_M_CSU_GRV_NCL.Data;
   BUS_SQ_M_CSU_GRV_NCL.Close;
end;

function TSM.BUS_DP_M_CSU_NFE_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCsuNfeIte: String;
  begin
    Result :=
     '     SELECT NFE.ID_EMPRESA, NFE.TIPO_NF, NFE.ID_EMITENTE, NFE.DTA_EMISSAO, NFE.NUMERO, NFE.SERIE,NFE.MODELO, NFI.*,ITE.DESCRICAO AS INT_NOMEITE, ITE.ID_UND_VENDA AS INT_UND_VENDA, ' +
     '     cast( case '+
     '        when nfe.tipo_nf in (''E'',''D'',''F'') then frn.descricao  '+
     '        when nfe.tipo_nf in (''S'',''R'') then cli.nome  '+
     '     end as varchar(50) ) as INT_NOMEEMI  '+
     '     FROM FAT_TB_M_NFE_ITE NFI        ' +
     '        LEFT OUTER JOIN FAT_TB_M_NFE NFE ON (NFE.ID_FISCAL  = NFI.ID_FISCAL) ' +
     '        LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NFI.ID_ITEM          ' +
     '        LEFT OUTER JOIN CAD_TB_C_CLI CLI ON (CLI.ID_CLIENTE = NFE.ID_EMITENTE) ' +
     '        LEFT OUTER JOIN CAD_TB_C_FOR FRN ON (FRN.ID_FORNECEDOR = NFE.ID_EMITENTE) ';
  end;

begin

   //  TIPO_NF      =  E - Nota de entrada  S - Nota de sada  -
   //                  D - Dev. de Fornecedor  R - Dev. de cliente   F - Frete

   BUS_SQ_M_CSU_NFE_ITE.Close;

   BUS_SQ_M_CSU_NFE_ITE.CommandText := enSqlCsuNfeIte + ' WHERE 1 = 1 ';
   if Input[0] <> '' then
      begin
        BUS_SQ_M_CSU_NFE_ITE.CommandText := BUS_SQ_M_CSU_NFE_ITE.CommandText +
           ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +')';
      end;
   if Input[1] <> '' then
      begin
        BUS_SQ_M_CSU_NFE_ITE.CommandText := BUS_SQ_M_CSU_NFE_ITE.CommandText +
           ' AND NFE.TIPO_NF in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        BUS_SQ_M_CSU_NFE_ITE.CommandText := BUS_SQ_M_CSU_NFE_ITE.CommandText +
           ' AND NFI.ID_ITEM in (' + VarToStr(Input[2]) +')';
      end;

   BUS_SQ_M_CSU_NFE_ITE.CommandText := BUS_SQ_M_CSU_NFE_ITE.CommandText +
           ' ORDER BY DTA_EMISSAO DESC, ID_FISCAL DESC ';

   //GerarSqlTxt(BUS_SQ_M_CSU_NFE_ITE);

   Result := BUS_DP_M_CSU_NFE_ITE.Data;
end;

function TSM.BUS_DP_M_CSU_OPR_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlCsuOprPed: String;
  begin
    Result :=
              ' select false as int_selecao, rpe.id_opr, opr.dta_emissao as int_dtaemissaoopr, rpe.id_pedido, ped.id_cliente,ped.vlr_liquido, ped.obs, ped.pcp_obs, ' + #13#10 +
              '             cli.nome as int_nomecli, ' + #13#10 +
              '             tme.descricao as int_nometme,' + #13#10 +
              '             fun.nome as int_nomeven, ' + #13#10 +
              '             cpg.descricao int_nomecpg, ' + #13#10 +
              '            ate.nome as int_nomeate,' + #13#10 +
              '             res.nome as int_nomeres, cid.uf int_nomeest, cli.doc_cnpj_cpf as int_cpfcnpj,' + #13#10 +
              '             cli.pessoa as int_pessoacli,' + #13#10 +
              '            cli.id_perfil_cli as int_id_perfil,' + #13#10 +
              ' cast( case ped.situacao_aprovacao ' + #13#10 +
              '        when 0 then ''em espera''' + #13#10 +
              '         when 1 then ''aprovado''' + #13#10 +
              '         when 2 then ''reprovado''' + #13#10 +
              '       end as varchar(20) ) as int_sitaprov, ' + #13#10 +
              ' cast( case ped.situacao ' + #13#10 +
              '        when 0 then ''em aberto''' + #13#10 +
              '         when 1 then ''reprovado''' + #13#10 +
              '         when 2 then ''em produo''' + #13#10 +
              '         when 3 then ''faturado''' + #13#10 +
              '         when 4 then ''cancelado''' + #13#10 +
              '       end as varchar(20) ) as int_sitped, ped.cubagem as int_cubagem' + #13#10 +
              ' from pcp_tb_m_opr_ped rpe' + #13#10 +
              ' left outer join pcp_tb_m_opr opr on opr.id_opr = rpe.id_opr' + #13#10 +
              ' left outer join fat_tb_m_ped ped on ped.id_pedido = rpe.id_pedido' + #13#10 +
              ' left outer join cad_tb_c_cli cli on cli.id_cliente = ped.id_cliente' + #13#10 +
              ' left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque = ped.id_tipo_mov_estoque' + #13#10 +
              ' left outer join cad_tb_c_fun fun on fun.id_funcionario=ped.id_vendedor' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=ped.id_condicao_pag' + #13#10 +
              ' left outer join cad_tb_c_fun ate on ate.id_funcionario=ped.id_atendente' + #13#10 +
              ' left outer join cad_tb_c_fun res on res.id_funcionario=ped.id_responsavel' + #13#10 +
              ' left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade ' + #13#10 ;

end;
begin
   { TODO -oMaxsuel -cCriao : Criado em 14/09/2015 }

   // Ir visualizar os pedidos de venda da OPR.
   BUS_SQ_M_CSU_OPR_PED.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_CSU_OPR_PED.CommandText := enSqlCsuOprPed + ' WHERE 1 = 2 '
        else
           BUS_SQ_M_CSU_OPR_PED.CommandText := enSqlCsuOprPed +
               ' where rpe.id_opr in (' + VarToStr(Input[1]) +')  ';
      end;
   if Input[0] = 1 then
      begin
         BUS_SQ_M_CSU_OPR_PED.CommandText := enSqlCsuOprPed +
             ' where rpe.id_opr <> ''' + VarToStr(Input[1]) +''' ' +
             '   and rpe.id_pedido = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[0] = 2 then
      begin
         BUS_SQ_M_CSU_OPR_PED.CommandText := enSqlCsuOprPed +
             ' where rpe.remanejado = false and ' +
             '   and opr.situacao in (0,1)';
      end;
   if Input[0] = 3 then
      begin
         BUS_SQ_M_CSU_OPR_PED.CommandText := enSqlCsuOprPed +
             ' where rpe.id_opr = ''' + VarToStr(Input[1]) +''' ';
      end;


   Result := BUS_DP_M_CSU_OPR_PED.Data;
   BUS_SQ_M_CSU_OPR_PED.close;
end;

function TSM.BUS_DP_M_CSU_ORV_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCsuOrvIte: String;
  begin
    Result :=
       ' SELECT ORV.ID_EMPRESA,PAR.EMP_RAZAO AS INT_NOMEEMP,ORV.STATUS,ORV.OBS_PROBLEMA, '+
       ' ORV.OBS_RECLAMACAO,ORV.ID_ORDEM,ORV.DTA_EMISSAO,ORV.DTA_ENTREGA,                '+
       '   ORV.ID_CLIENTE, CLI.NOME AS INT_NOMECLI,                                      '+
       '   ORI.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE,ORI.QTDE                            '+
       '   FROM OFI_TB_M_ORV_ITE ORI                                                     '+
       '      LEFT OUTER JOIN OFI_TB_M_ORV ORV ON (ORV.ID_ORDEM  = ORI.ID_ORDEM)         '+
       '      LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=ORI.ID_ITEM                '+
       '      LEFT OUTER JOIN CAD_TB_C_CLI CLI ON (CLI.ID_CLIENTE = ORV.ID_CLIENTE)      '+
       '      LEFT OUTER JOIN CAD_TB_C_PAR PAR ON (PAR.ID_EMPRESA = ORV.ID_EMPRESA)      '+
       ' WHERE 1=1 ';

  end;

begin
   BUS_SQ_M_CSU_ORV_ITE.Close;

   BUS_SQ_M_CSU_ORV_ITE.CommandText := enSqlCsuOrvIte;
   if Input[0] <> '' then
      begin
        BUS_SQ_M_CSU_ORV_ITE.CommandText := BUS_SQ_M_CSU_ORV_ITE.CommandText +
           ' AND ORV.ID_EMPRESA in (' + VarToStr(Input[0]) +')';
      end;
   if Input[1] <> '' then
      begin
        BUS_SQ_M_CSU_ORV_ITE.CommandText := BUS_SQ_M_CSU_ORV_ITE.CommandText +
           ' AND ORV.STATUS in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        BUS_SQ_M_CSU_ORV_ITE.CommandText := BUS_SQ_M_CSU_ORV_ITE.CommandText +
           ' AND ORI.ID_ITEM in (' + VarToStr(Input[2]) +')';
      end;

   BUS_SQ_M_CSU_ORV_ITE.CommandText := BUS_SQ_M_CSU_ORV_ITE.CommandText +
           ' ORDER BY ORV.ID_EMPRESA,ORV.DTA_EMISSAO DESC, ORV.ID_ORDEM DESC ';

   Result := BUS_DP_M_CSU_ORV_ITE.Data;
end;

function TSM.BUS_DP_M_CSU_PEQ_CMDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   BUS_SQ_M_CSU_PEQ_CMD.Close;

    BUS_SQ_M_CSU_PEQ_CMD.CommandText :=

     '  select  '+

     '         extract(year from nfe.dta_emissao) as ano, '+
     '         extract(month from nfe.dta_emissao) as mes, '+
     '         cast(sum(coalesce(nit.vlr_custo,0)) as numeric(18,2)) vlr_custo_mercadoria, '+
     '         cast( ''Custo da Mercadoria'' as varchar(30)) as descricao,                   '+
     '         (select  '+
     '            cast(sum(coalesce(nif.vlr_custo,0)) as numeric(18,2)) vlr_custo_mercadoria '+
     '          from fat_tb_m_nfe_ite nif '+
     '            left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
     '            left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo  '+
     '            left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
     '          where nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
     '            nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa = '''+ VarToStr(Input[0]) +''' and '+
     '            extract(year from nff.dta_emissao) = '''+VarToStr(Input[1])+''' '+
     '         ) as total_ano, '+

     '         case '+
     '           when (select '+
     '                 cast(sum(coalesce(nif.vlr_custo,0)) as numeric(18,2)) as vlr_custo_mercadoria_ano '+
     '         from fat_tb_m_nfe_ite nif '+
     '                       left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
     '                       left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
     '                       left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
     '               where nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
     '                                       nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa = '''+ VarToStr(Input[0])+''' and '+
     '                       extract(year from nff.dta_emissao) = '''+VarToStr(Input[1]) +''' '+
     '               ) = 0 then 0 '+
     '         else '+

     '          round( ( cast(sum(coalesce(nit.vlr_custo,0)) as numeric(18,2)) / '+

     '         (select '+
     '            cast(sum(coalesce(nif.vlr_custo,0)) as numeric(18,2)) as vlr_custo_mercadoria_ano '+
     '          from fat_tb_m_nfe_ite nif '+
     '            left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
     '            left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
     '            left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
     '          where nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
     '            nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa ='''+VarToStr(Input[0])+''' and '+
     '            extract(year from nff.dta_emissao) ='''+VarToStr(Input[1])+''' '+
     '         ) ) * 100,2) end as perc '+

     '      from fat_tb_m_nfe_ite nit '+
     '        left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
     '        left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
     '        left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
     '      where nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
     '            nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa ='''+VarToStr(Input[0])+''' and '+
     '            extract(year from nfe.dta_emissao) ='''+ VarToStr(Input[1]) +''' '+
     '      group by 1,2 '+
     '      order by 1,2 ';



   Result := BUS_DP_M_CSU_PEQ_CMD.Data;
   BUS_SQ_M_CSU_PEQ_CMD.close;

end;

function TSM.BUS_DP_M_CSU_PEQ_DPFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
    BUS_SQ_M_CSU_PEQ_DPF.Close;

    BUS_SQ_M_CSU_PEQ_DPF.CommandText :=

            ' select '+
            '  pct.id_plano,pct.descricao as int_nomepct, '+
            '  extract(year from pgt.dta_pagamento) as ano, '+
            '  extract(month from pgt.dta_pagamento) as mes, '+
            '  sum(pgt.vlr_pagamento) as vlr_pagamento_mes, '+
            '  (select '+
            '     sum(pgt.vlr_pagamento) as vlr_pagamento_ano '+
            '   from fin_tb_m_pag_pag pgt '+
            '     left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
            '     left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
            '   where '+
            '     pag.id_empresa ='''+ VarToStr(Input[0])+''' '+
            '     and extract(year from pgt.dta_pagamento) ='''+ VarToStr(Input[1])+''' '+
            '     and coalesce(com_substituicao,false) = false '+
            '     and pct.tipo_mov = 0 and pct.tipo_desp = 0 '+
            '  ) as total_ano, '+

            '  round( ( sum(pgt.vlr_pagamento)  / '+

            '   (select '+
            '     sum(pgt.vlr_pagamento) as vlr_pagamento_ano '+
            '   from fin_tb_m_pag_pag pgt '+
            '     left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
            '     left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
            '   where '+
            '     pag.id_empresa ='''+ VarToStr(Input[0])+''' '+
            '     and extract(year from pgt.dta_pagamento) ='''+ VarToStr(Input[1])+''' '+
            '     and coalesce(com_substituicao,false) = false '+
            '     and pct.tipo_mov = 0 and pct.tipo_desp = 0 '+
            '   ) ) * 100,2) as perc '+

            ' from fin_tb_m_pag_pag pgt '+
            '     left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
            '     left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
            '   where '+
            '     pag.id_empresa ='''+ VarToStr(Input[0])+''' '+
            '     and extract(year from pgt.dta_pagamento) ='''+ VarToStr(Input[1])+''' '+
            '     and coalesce(com_substituicao,false) = false '+
            '     and pct.tipo_mov = 0 and pct.tipo_desp = 0 '+
            ' group by 1,2,3,4 '+
            ' order by 1,2,3,4 ';


   Result := BUS_DP_M_CSU_PEQ_DPF.Data;
   BUS_SQ_M_CSU_PEQ_DPF.close;

end;

function TSM.BUS_DP_M_CSU_PEQ_DPVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
    BUS_SQ_M_CSU_PEQ_DPV.Close;

    BUS_SQ_M_CSU_PEQ_DPV.CommandText :=

   ' select '+
   '           pct.id_plano,pct.descricao as int_nomepct, '+
   '           extract(year from pgt.dta_pagamento) as ano, '+
   '           extract(month from pgt.dta_pagamento) as mes, '+
   '           sum(pgt.vlr_pagamento) AS vlr_pagamento_mes, '+
   '           (select '+
   '              sum(pgt.vlr_pagamento) as vlr_pagamento_ano '+
   '            from fin_tb_m_pag_pag pgt '+
   '              left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
   '              left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
   '            where '+
   '              pag.id_empresa ='''+  VarToStr(Input[0])+''' '+
   '              and extract(year from pgt.dta_pagamento) = '''+VarToStr(Input[1])+''' '+
   '              and coalesce(com_substituicao,false) = false '+
   '              and pct.tipo_mov = 1 and pct.tipo_desp = 0 '+
   '           ) as total_ano, '+

   '           round( ( sum(pgt.vlr_pagamento)  / '+

   '            (select '+
   '              sum(pgt.vlr_pagamento) as vlr_pagamento_ano '+
   '            from fin_tb_m_pag_pag pgt '+
   '              left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
   '              left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
   '            where '+
   '              pag.id_empresa ='''+  VarToStr(Input[0])+''' '+
   '              and extract(year from pgt.dta_pagamento) = '''+VarToStr(Input[1])+''' '+
   '              and coalesce(com_substituicao,false) = false '+
   '              and pct.tipo_mov = 1 and pct.tipo_desp = 0 '+
   '            ) ) * 100,2) as perc '+

   '        from fin_tb_m_pag_pag pgt '+
   '              left outer join fin_tb_m_pag pag on pag.id_titulo = pgt.id_titulo '+
   '              left outer join cad_tb_c_pct pct on pct.id_plano = pgt.id_plano '+
   '            where '+
   '              pag.id_empresa ='''+  VarToStr(Input[0])+''' '+
   '              and extract(year from pgt.dta_pagamento) = '''+VarToStr(Input[1])+''' '+
   '              and coalesce(com_substituicao,false) = false '+
   '              and pct.tipo_mov = 1 and pct.tipo_desp = 0 '+
   '        group by 1,2,3,4 '+
   '        order by 1,2,3,4 ';





   Result := BUS_DP_M_CSU_PEQ_DPV.Data;
   BUS_SQ_M_CSU_PEQ_DPV.close;

end;

function TSM.BUS_DP_M_CSU_PEQ_TVPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   { TODO -oMaxsuel -cCriao : Criado em 04/07/2016 }

   BUS_SQ_M_CSU_PEQ_TVP.Close;

    BUS_SQ_M_CSU_PEQ_TVP.CommandText :=

      '  select '+

      '        extract(year from nfe.dta_emissao) as ano, '+
      '        extract(month from nfe.dta_emissao) as mes, '+

      '         cast( case cpg.tipo_pagamento '+
      '                when 0 then ''Vendas a Vista'' '+
      '                when 1 then ''Vendas a Prazo'' '+
      '                else ''?????????''             '+
      '              end as varchar(15)) as tipo_venda, '+


      '        cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2))  as vlr_bruto, '+
      '        cast(sum(coalesce(nit.vlr_desconto,0)) as numeric(18,2) ) as vlr_desconto, '+
      '        cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-sum(coalesce(nit.vlr_desconto,0)) as numeric(18,2)) vlr_liquido, '+

      '        (select  '+
      '           cast(sum(coalesce(nif.vlr_unitario*(nif.qtde-nif.qtde_devolvida),0))-sum(coalesce(nif.vlr_desconto,0)) as numeric(18,2)) vlr_liquido_ano '+
      '         from fat_tb_m_nfe_ite nif '+
      '           left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
      '           left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
      '           left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
      '         where cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
      '           nff.faturada = true and nff.tipo_nf = ''S''  and nff.id_empresa = '''+ VarToStr(Input[0]) +''' and '+
      '           extract(year from nff.dta_emissao) = '''+ VarToStr(Input[1]) +''' '+
      '        ) as total_ano, '+


      '        round( ( cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0))-sum(coalesce(nit.vlr_desconto,0)) as numeric(18,2)) / '+

      '        (select  '+
      '           cast(sum(coalesce(nif.vlr_unitario*(nif.qtde-nif.qtde_devolvida),0))-sum(coalesce(nif.vlr_desconto,0)) as numeric(18,2)) vlr_liquido_ano  '+
      '         from fat_tb_m_nfe_ite nif '+
      '           left outer join fat_tb_m_nfe nff on nff.id_fiscal=nif.id_fiscal '+
      '           left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nff.id_cfo '+
      '           left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nff.id_condicao_pag '+
      '         where cfo.id_classe in (''SP10'',''SP70'') and nff.nfe_cod_sit not in (''02'',''04'',''05'') and nff.status = 1 and '+
      '           nff.faturada = true and nff.tipo_nf = ''S'' and nff.id_empresa ='''+ VarToStr(Input[0])+ ''' and '+
      '           extract(year from nff.dta_emissao) = '''+ VarToStr(Input[1]) +''' '+
      '        ) ) * 100,2) as perc '+

      '     from fat_tb_m_nfe_ite nit '+
      '       left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
      '       left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
      '       left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag '+
      '     where cfo.id_classe in (''SP10'',''SP70'') and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and '+
      '           nfe.faturada = true and nfe.tipo_nf = ''S'' and nfe.id_empresa =''' + VarToStr(Input[0])+ ''' and '+
      '           extract(year from nfe.dta_emissao) =  '''+ VarToStr(Input[1]) +''' '+
      '     group by 1,2,3 '+
      '     order by tipo_venda,mes,ano ';




   Result := BUS_DP_M_CSU_PEQ_TVP.Data;
   BUS_SQ_M_CSU_PEQ_TVP.close;

end;

function TSM.BUS_DP_M_CTADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlBusCta: String;
  begin
    Result :=
      'select false as int_selecao, MCT.* , PCT.DESCRICAO AS INT_NOMEPCT, '+
      ' case mct.origem                                     ' +
      '      when ''0''  then  ''Manual''                   ' +
      '      when ''1''  then  ''Baixa de Conta a Receber'' ' +
      '      when ''2''  then  ''Baixa de Contas a Pagar''  ' +
      '      when ''3''  then  ''Devoluo de vendas''      ' +
      '      when ''4''  then  ''Conciliao bancria''     ' +
      '      when ''5''  then  ''Nota Fiscal de Sada''     ' +
      '      when ''6''  then  ''Nota de Crdito''          ' +
      '      when ''7''  then  ''Abertura de caixa''        ' +
      '      when ''8''  then  ''Controle de Caixa''        ' +
      '      when ''9''  then  ''Movimentao de cheque''   ' +
      '      when ''10''  then  ''Conciliao bancria''   ' +
      '    end  as int_origem,       ' +
      ' case mct.deb_cre             ' +
      ' when ''0'' then ''Dbito''   ' +
      ' when ''1'' then ''Crdito''  ' +
      ' end as int_debcre,           ' +
      ' TIF.DESCRICAO AS INT_NOMETIF, CTC.CEDENTE_NOM AS INT_NOMECTC '+
      'from FIN_TB_M_CTA MCT '+
      'LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO=MCT.ID_PLANO '+
      'LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO=MCT.ID_TIPO_FINANCEIRO '+
      'LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA=MCT.ID_CONTA ';
end;
begin
   { TODO -oMaxsuel -cCriao : Criado em 01/08/2015 }

   BUS_SQ_M_CTA.Close;
   if Input[0] = 100 then
      begin
         BUS_SQ_M_CTA.CommandText := enSqlBusCta +
             ' WHERE MCT.ID_CONTROLE in (' + VarToStr(Input[1]) +')  ';
      end;
   Result := BUS_DP_M_CTA.Data;
   BUS_SQ_M_CTA.close;
end;

function TSM.bus_dp_m_ctc_tprDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusTpr: String;
  begin
    Result := ' select * from ctc_tb_c_tpr_ite  ';
  end;
begin
   bus_sq_m_ctc_tpr.Close;
   if Input[0] = 0 then
      begin
        bus_sq_m_ctc_tpr.CommandText := enSqlBusTpr +
             ' WHERE id_tpr = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        bus_sq_m_ctc_tpr.CommandText := enSqlBusTpr +
          ' WHERE id_tpr = ''' + VarToStr(Input[1]) +''' ' +
          '   AND id_item = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := bus_dp_m_ctc_tpr.Data;

   bus_sq_m_ctc_tpr.Close;
end;

function TSM.BUS_DP_M_CTE_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCteIte: String;
  begin
    Result :=
        ' SELECT CIT.* FROM EST_TB_M_CTE_ITE CIT ';
  end;
begin
   BUS_SQ_M_CTE_ITE_INT.Close;
   BUS_SQ_M_CTE_ITE_INT.CommandText := enSqlCteIte +
     ' WHERE CIT.ID_CONTROLE = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_CTE_ITE_INT.Data;
   BUS_SQ_M_CTE_ITE_INT.Close;
end;

function TSM.BUS_DP_M_CTE_RES_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCteIte: String;
  begin
    Result :=
        '  SELECT CTE.ID_CONTROLE, CTE.ID_EMPRESA, CTE.DTA_MOVIMENTO, CIT.ID_ITEM,CIT.ID_COR, ' +
        '         CIT.ID_TAMANHO, MAX(VLR_CUSTO) AS VLR_CUSTO,                                ' +
        '     cast( COALESCE(  SUM (CASE CIT.TIPO_DIFERENCA                                   ' +
        '            WHEN 1 THEN DIFERENCA                                                    ' +
        '      END),0)  as double precision) AS TOTAL_SAIDA,                                     ' +
        '                                                                                     ' +
        '     cast( COALESCE(SUM (CASE CIT.TIPO_DIFERENCA                                     ' +
        '            WHEN 2 THEN DIFERENCA                                                    ' +
        '      END),0)  as double precision)  AS TOTAL_ENTRADA                                   ' +
        '  FROM EST_TB_M_CTE_ITE CIT                                                          ' +
        '     left outer join EST_TB_M_CTE CTE on (CIT.ID_CONTROLE = CTE.ID_CONTROLE) ';
  end;
begin
   BUS_SQ_M_CTE_RES_ITE_INT.Close;
   BUS_SQ_M_CTE_RES_ITE_INT.CommandText := enSqlCteIte +
     ' WHERE CIT.ID_CONTROLE = ''' + VarToStr(Input[0]) +''' '+
     ' GROUP BY 1,2,3,4,5,6';
   Result := BUS_DP_M_CTE_RES_ITE_INT.Data;
   BUS_SQ_M_CTE_RES_ITE_INT.Close;
end;

function TSM.BUS_DP_M_CXA_CARDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlBusCxaResCAR: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 08/07/2015
    mtodo utilizado pela tela de Fechamento de Caixa }

  enSqlBusCxaResCAR :=
            'select cast(''NF'' as varchar(3)) as tipo, car.*, maq.descricao as int_nomemaq, fpg.descricao as int_formapag, ' + #13#10 +
            '       nfe.numero' + #13#10 +
            'from fin_tb_m_rec car ' + #13#10 +
            '	left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = car.id_forma_pag)' + #13#10 +
            '  left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = car.id_fiscal)' + #13#10 +
            '  left outer join cad_tb_c_mct maq on (maq.id_maquineta = car.car_id_maquineta) ' + #13#10 +
            'where ' + #13#10 +
            '  car.id_empresa  = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '  fpg.doc_impresso = 3 and ' + #13#10 +
            '  car.id_fiscal   > 0 and' + #13#10 +
            '  nfe.id_abertura = ''' + VarToStr(Input[1]) +''' ' + #13#10 +
            'union ALL' + #13#10 +
            'select cast(''BXA'' as varchar(3)) as TIPO, car.*, maq.descricao as int_nomemaq, fpg.descricao as int_formapag,' + #13#10 +
            '       rbx.id_baixa as numero' + #13#10 +
            'from fin_tb_m_rec car' + #13#10 +
            '  left outer join fin_tb_m_rbx rbx on (rbx.id_baixa = car.id_baixa)' + #13#10 +
            '  left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rbx.id_forma_pag)' + #13#10 +
            '  left outer join cad_tb_c_mct maq on (maq.id_maquineta = car.car_id_maquineta) ' + #13#10 +
            'where' + #13#10 +
            '  car.id_empresa  = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '  rbx.id_abertura = ''' + VarToStr(Input[1]) +''' and ' + #13#10 +
            '  fpg.doc_impresso = 3 and ' + #13#10 +
            '  car.id_baixa    > 0' + #13#10 +
            ' union ALL' + #13#10 +
            ' select cast( ''CRE'' as varchar(3)) as TIPO, car.*, maq.descricao as int_nomemaq, fpg.descricao as int_formapag,' + #13#10 +
            '       rcr.id_credito as numero' + #13#10 +
            ' from fin_tb_m_rec car' + #13#10 +
            '  left outer join fin_tb_m_rcr   rcr on (rcr.id_credito = car.id_credito)' + #13#10 +
            '  left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rcr.id_forma_pag)' + #13#10 +
            '  left outer join cad_tb_c_mct maq on (maq.id_maquineta = car.car_id_maquineta) ' + #13#10 +
            ' where' + #13#10 +
            '  1 = 2 and' + #13#10 +
            '  car.id_empresa  = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '  rcr.id_abertura = ''' + VarToStr(Input[1]) +''' and ' + #13#10 +
            '  car.id_credito    > 0 '  + #13#10 +
            ' order by numero ';
   BUS_SQ_M_CXA_CAR.Close;
   BUS_SQ_M_CXA_CAR.CommandText := enSqlBusCxaResCAR;

   Result := BUS_DP_M_CXA_CAR.Data;
   BUS_SQ_M_CXA_CAR.Close;
end;

function TSM.BUS_DP_M_CXA_DET_CNFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlBusCxaResCNF: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 08/07/2015
    mtodo utilizado pela tela de Fechamento de Caixa }

  enSqlBusCxaResCNF :=
            ' with det_nf_cartao' + #13#10 +
            ' as' + #13#10 +
            ' (' + #13#10 +
            '	select nfe.id_fiscal, nfe.numero, nfe.id_empresa, fnt.id_maquineta, fnt.id_forma_pag, fpg.descricao,' + #13#10 +
            '         sum(fnt.vlr_titulo) as vlr_total, count(*) as tot_parcelas' + #13#10 +
            '	from fat_tb_m_nfe_tit fnt' + #13#10 +
            '    left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal    = fnt.id_fiscal)' + #13#10 +
            '    left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = fnt.id_forma_pag)' + #13#10 +
            '  where   ' + #13#10 +
            '     nfe.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '     nfe.tipo_nf = ''S'' AND' + #13#10 +
            '     nfe.status  = 1   AND ' + #13#10 +
            '     nfe.numero  > 0   and ' + #13#10 +
            '     nfe.nfe_cod_sit not in (''02'',''04'',''05'') and ' + #13#10 +
            '     fpg.doc_impresso = 3 AND' + #13#10 +
            '     nfe.id_abertura = ''' + VarToStr(Input[1]) +''' ' + #13#10 +
            '  group by nfe.id_fiscal, nfe.numero, nfe.id_empresa, fnt.id_maquineta, fnt.id_forma_pag, fpg.descricao' + #13#10 +
            ' )' + #13#10 +
            ' select dnc.*, maq.descricao as int_nomemaq, cast( coalesce(''De'' || CAST(tap.qtde_parc_ini as char) || ''at'' ||' + #13#10 +
            '                               CAST(tap.qtde_parc_fin as char),''SEM FAIXA'') as varchar(15)) as Faixa,' + #13#10 +
            '       COALESCE(tap.taxa,0) as taxa, tap.dias_acres_vencto' + #13#10 +
            ' from det_nf_cartao dnc ' + #13#10 +
            '		left outer join cad_tb_c_fpg_tap tap on (                     '   + #13#10 +
            '                                             tap.id_empresa    = dnc.id_empresa   and ' + #13#10 +
            '                                             tap.id_maquineta  = dnc.id_maquineta and ' + #13#10 +
            '                                             tap.id_forma_pag  = dnc.id_forma_pag AND ' + #13#10 +
            '                                             tap.qtde_parc_ini <= dnc.tot_parcelas AND ' + #13#10 +
            '                                             tap.qtde_parc_fin >= dnc.tot_parcelas)' + #13#10 +
            '   left outer join cad_tb_c_mct maq on ' +
            '      (maq.id_maquineta = dnc.id_maquineta ) ' +
            ' order by dnc.id_fiscal, maq.descricao, dnc.id_forma_pag ';
   BUS_SQ_M_CXA_DET_CNF.Close;
   BUS_SQ_M_CXA_DET_CNF.CommandText := enSqlBusCxaResCNF;

   Result := BUS_DP_M_CXA_DET_CNF.Data;
   BUS_SQ_M_CXA_DET_CNF.Close;
end;

function TSM.BUS_DP_M_CXA_DET_CRBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlBusCxaResCRB: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 08/07/2015
    mtodo utilizado pela tela de Fechamento de Caixa }

  enSqlBusCxaResCRB :=
            ' with det_bxa_cartao' + #13#10 +
            ' as' + #13#10 +
            ' (' + #13#10 +
            '	select rbx.id_baixa, rbx.id_empresa, rbx.id_maquineta, rbx.id_forma_pag, fpg.descricao,' + #13#10 +
            '         sum(rbx.vlr_baixa) as vlr_total, count(*) as tot_parcelas' + #13#10 +
            '	from fin_tb_m_rbx rbx    ' + #13#10 +
            '    left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rbx.id_forma_pag)' + #13#10 +
            '  where   ' + #13#10 +
            '     rbx.id_empresa   = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '     rbx.id_abertura  = ''' + VarToStr(Input[1]) +''' and ' + #13#10 +
            '     fpg.doc_impresso = 3  ' + #13#10 +
            '  group by rbx.id_baixa, rbx.id_empresa, rbx.id_maquineta, rbx.id_forma_pag, fpg.descricao' + #13#10 +
            ' )' + #13#10 +
            ' select dbc.*, maq.descricao as int_nomemaq, cast( coalesce(''De'' || CAST(tap.qtde_parc_ini as char) || ''at'' ||' + #13#10 +
            '                               CAST(tap.qtde_parc_fin as char),''SEM FAIXA'') as varchar(15)) as Faixa,' + #13#10 +
            '       COALESCE(tap.taxa,0) as taxa, tap.dias_acres_vencto' + #13#10 +
            ' from det_bxa_cartao dbc' + #13#10 +
            '		left outer join cad_tb_c_fpg_tap tap on ( tap.id_empresa     = dbc.id_empresa   and ' + #13#10 +
            '                                             tap.id_maquineta   = dbc.id_maquineta and ' + #13#10 +
            '                                             tap.id_forma_pag   = dbc.id_forma_pag AND ' + #13#10 +
            '                                             tap.qtde_parc_ini <= dbc.tot_parcelas AND ' + #13#10 +
            '                                             tap.qtde_parc_fin >= dbc.tot_parcelas )   ' + #13#10 +
            '   left outer join cad_tb_c_mct maq on (maq.id_maquineta = dbc.id_maquineta) '           + #13#10 +
            ' order by dbc.id_baixa, maq.descricao, dbc.id_forma_pag ';

   BUS_SQ_M_CXA_DET_CRB.Close;
   BUS_SQ_M_CXA_DET_CRB.CommandText := enSqlBusCxaResCRB;

   Result := BUS_DP_M_CXA_DET_CRB.Data;
   BUS_SQ_M_CXA_DET_CRB.Close;
end;

function TSM.BUS_DP_M_CXA_DET_CRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlBusCxaResCRC: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 08/09/2015
    mtodo utilizado pela tela de Fechamento de Caixa }

  enSqlBusCxaResCRC :=
                        'with det_nota_rcr_cartao' + #13#10 +
                        'as' + #13#10 +
                        '(' + #13#10 +
                        '    select rcr.id_credito,rcr.id_empresa, rcr.id_maquineta,rcr.id_forma_pag, fpg.descricao,' + #13#10 +
                        '         sum(rcr.vlr_credito) as vlr_total, count(*) as tot_parcelas' + #13#10 +
                        '	from fin_tb_m_rcr rcr    ' + #13#10 +
                        '    left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rcr.id_forma_pag)' + #13#10 +
                        '  where   ' + #13#10 +
                        '     rcr.id_empresa   = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
                        '     rcr.id_abertura  = ''' + VarToStr(Input[1]) +''' and ' + #13#10 +
                        '     fpg.doc_impresso = 3  ' + #13#10 +
                        '  group by rcr.id_credito,rcr.id_empresa, rcr.id_maquineta, rcr.id_forma_pag, fpg.descricao' + #13#10 +
                        ')' + #13#10 +
                        'select dbc.*, maq.descricao as int_nomemaq, cast( coalesce(''De'' || CAST(tap.qtde_parc_ini as char) || ''at'' ||' + #13#10 +
                        '                               CAST(tap.qtde_parc_fin as char),''SEM FAIXA'') as varchar(15)) as Faixa,' + #13#10 +
                        '       COALESCE(tap.taxa,0) as taxa, tap.dias_acres_vencto' + #13#10 +
                        'from det_nota_rcr_cartao dbc' + #13#10 +
                        '      left outer join cad_tb_c_fpg_tap tap on ' + #13#10 +
                        '                                            ( tap.id_empresa       =  dbc.id_empresa    AND' + #13#10 +
                        '                                              tap.id_maquineta    =  dbc.id_maquineta AND  ' + #13#10 +
                        '                                              tap.id_forma_pag   =  dbc.id_forma_pag AND' + #13#10 +
                        '                                              tap.qtde_parc_ini <=  dbc.tot_parcelas   AND ' + #13#10 +
                        '                                              tap.qtde_parc_fin >= dbc.tot_parcelas)' + #13#10 +
                        '      left outer join cad_tb_c_mct maq on (maq.id_maquineta= dbc.id_maquineta)' + #13#10 +
                        'where 1 = 2' + #13#10 +
                        'order by dbc.id_credito, maq.descricao, dbc.id_forma_pag';


   BUS_SQ_M_CXA_DET_CRC.Close;
   BUS_SQ_M_CXA_DET_CRC.CommandText := enSqlBusCxaResCRC;

   Result := BUS_DP_M_CXA_DET_CRC.Data;
   BUS_SQ_M_CXA_DET_CRC.Close;
end;

function TSM.BUS_DP_M_CXA_RES_CARDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlBusCxaResCar: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 08/07/2015
    mtodo utilizado pela tela de Fechamento de Caixa }

  enSqlBusCxaResCar :=
            ' with tb_temp_cartoes' + #13#10 +
            ' as(' + #13#10 +
            '     select nfe.id_empresa, fnt.id_maquineta, fnt.id_forma_pag,fpg.descricao, sum(fnt.vlr_titulo) as vlr_total,' + #13#10 +
            '            cast('''' as varchar(20)) as num_lote     ' + #13#10 +
            '     from fat_tb_m_nfe_tit fnt' + #13#10 +
            '       left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal    = fnt.id_fiscal)' + #13#10 +
            '       left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = fnt.id_forma_pag)' + #13#10 +
            '     where' + #13#10 +
            '         nfe.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
            '         nfe.tipo_nf = ''S'' AND' + #13#10 +
            '         nfe.status  = 1   AND ' + #13#10 +
            '         nfe.numero  > 0   and' + #13#10 +
            '         nfe.nfe_cod_sit not in (''02'',''04'',''05'') and ' + #13#10 +
            '         fpg.doc_impresso = 3 AND' + #13#10 +
            '         nfe.id_abertura = ''' + VarToStr(Input[1]) +'''  '+ #13#10 +
            '     group by nfe.id_empresa, fnt.id_maquineta, fnt.id_forma_pag, fpg.descricao' + #13#10 +
            '   ' + #13#10 +
            '     UNION ALL' + #13#10 +
            ' ' + #13#10 +
            '    ' + #13#10 +
            '     select rbx.id_empresa, rbx.id_maquineta, rbx.id_forma_pag, fpg.descricao,  sum(rbx.vlr_baixa) as vlr_total,' + #13#10 +
            '            cast('''' as varchar(20)) as num_lote         ' + #13#10 +
            '     from fin_tb_m_rbx rbx    ' + #13#10 +
            '         left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rbx.id_forma_pag)' + #13#10 +
            '     where  ' + #13#10 +
            '         rbx.id_empresa   = ''' + VarToStr(Input[0]) + ''' and ' + #13#10 +
            '         rbx.id_abertura  = ''' + VarToStr(Input[1]) + ''' and ' + #13#10 +
            '         fpg.doc_impresso = 3 ' + #13#10 +
            '     group by rbx.id_empresa, rbx.id_maquineta, rbx.id_forma_pag, fpg.descricao' + #13#10 +

            '   UNION ALL' + #13#10 +
            '     select rcr.id_empresa, rcr.id_maquineta,' + #13#10 +
            '                rcr.id_forma_pag, fpg.descricao, sum(rcr.vlr_credito) as vlr_total,' + #13#10 +
            '           cast('''' as varchar(20)) as num_lote     ' + #13#10 +
            '     from fin_tb_m_rcr rcr    ' + #13#10 +
            '         left outer join cad_tb_c_fpg fpg on (fpg.id_forma_pag = rcr.id_forma_pag)' + #13#10 +
            '     where  ' + #13#10 +
            '         rcr.id_empresa  = 1 AND' + #13#10 +
            '         rcr.id_abertura = 0 and' + #13#10 +
            '         fpg.doc_impresso = 3  ' + #13#10 +
            '     group by   rcr.id_empresa, rcr.id_maquineta, rcr.id_forma_pag, fpg.descricao'  + #13#10 +
            ' )' + #13#10 +
            ' select car.id_empresa, car.id_maquineta, maq.descricao as int_nomemaq, '    + #13#10 +
            ' car.id_forma_pag, car.descricao, car.num_lote, sum(vlr_total) as vlr_total' + #13#10 +
            '  from tb_temp_cartoes car' + #13#10            +
            '   left outer join cad_tb_c_mct maq on        ' +
            '        (maq.id_maquineta = car.id_maquineta) ' +
            ' group by car.id_empresa, car.id_maquineta, maq.descricao, car.id_forma_pag, car.descricao, car.num_lote';

   BUS_SQ_M_CXA_RES_CAR.Close;
   BUS_SQ_M_CXA_RES_CAR.CommandText := enSqlBusCxaResCar;

   Result := BUS_DP_M_CXA_RES_CAR.Data;
   BUS_SQ_M_CXA_RES_CAR.Close;
end;

function TSM.BUS_DP_M_DCT_TITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlDctTit: String;
  begin
    Result :=
     ' select DIT.* '+
     ' FROM FIN_TB_M_DCT_TIT DIT                            '+
     ' LEFT OUTER JOIN FIN_TB_M_DCT DCT ON DCT.ID_DCT=DIT.ID_DCT ';
  end;
begin
   BUS_SQ_M_DCT_TIT.Close;
   BUS_SQ_M_DCT_TIT.CommandText := enSqlDctTit;


   BUS_SQ_M_DCT_TIT.CommandText := BUS_SQ_M_DCT_TIT.CommandText +
     '  WHERE dct.tipo_operacao = 0 and '+
     '  DCT.id_empresa='''+VarToStr(Input[0])+''' and '+
     '  DCT.id_dct='''+VarToStr(Input[1])+''' and '+
     '  DIT.id_titulo='''+VarToStr(Input[2])+''' ';

    Result := BUS_DP_M_DCT_TIT.Data;
    BUS_SQ_M_DCT_TIT.Close;
end;

function TSM.BUS_DP_M_EPP_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEppIte: String;
  begin
    Result :=
        ' SELECT PIT.*, GRU.TIPO_ITEM AS INT_TIPO_ITEM  ' +
        ' FROM PCP_TB_M_EPP_ITE PIT                     ' +
        '    LEFT OUTER JOIN CAD_TB_C_ITE  ITE ON ITE.ID_ITEM = PIT.ID_ITEM ' +
        '    LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO';

  end;
begin
   BUS_SQ_M_EPP_ITE_INT.Close;
   BUS_SQ_M_EPP_ITE_INT.CommandText := enSqlEppIte +
     ' WHERE PIT.ID_EPP = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_EPP_ITE_INT.Data;
   BUS_SQ_M_EPP_ITE_INT.Close;
end;

function TSM.BUS_DP_M_EST_ALM_PENDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlQtdIteAlmPend: String;
  begin
    Result :=
          'select ped.id_almoxarifado, alm.descricao as int_nomealm,' + #13#10 +
          '       pid.id_item , ite.descricao, ite.id_und_venda,pid.id_cor, cor.descricao as int_nomecor,' + #13#10 +
          '       pid.id_tamanho, tam.descricao as int_nometam, eta.saldo_fisico,coalesce(ccc.resta_produzir,0) resta_produzir, ' + #13#10 +
          '       sum(COALESCE(qtde,0)) as qtde_pend, ' + #13#10 +
          '       (eta.saldo_fisico - sum(COALESCE(qtde,0))) as saldo_disponivel ' + #13#10 +
          'from fat_tb_m_ped_ite pid' + #13#10 +
          '   left outer join fat_tb_m_ped ped on ped.id_pedido = pid.id_pedido' + #13#10 +
          '   left outer join cad_tb_c_alm alm on ped.id_almoxarifado = alm.id_almoxarifado' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item = pid.id_item ' + #13#10 +
          '   left outer join cad_tb_c_cor cor on cor.id_cor = pid.id_cor' + #13#10 +
          '   left outer join cad_tb_c_tam tam on tam.id_tamanho = pid.id_tamanho' + #13#10 +
          '   left outer join est_tb_m_fes_alm eta on eta.id_almoxarifado = ped.id_almoxarifado and' + #13#10 +
          '                                           eta.id_item = pid.id_item AND ' + #13#10 +
          '                                           eta.id_cor = pid.id_cor AND ' + #13#10 +
          '                                           eta.id_tamanho = pid.id_tamanho' + #13#10 +
          ' left outer join (select ppp.id_empresa, ppp.id_almoxarifado, opp.id_item, opp.id_cor, opp.id_tamanho, sum(qtde_a_produzir - qtde_produzida) as resta_produzir' + #13#10 +
          '                              from pcp_tb_m_opr_opp opp ' + #13#10 +
          '                                 left outer join pcp_tb_m_opr ppp on ppp.id_opr = opp.id_opr' + #13#10 +
          '                              where ppp.id_empresa = ''' + VarToStr(Input[1]) +''' ' + #13#10 +
          '                                and opp.qtde_a_produzir > 0 and opp.qtde_a_produzir <> opp.qtde_produzida' + #13#10 +
          '                              group by 1,2,3,4,5)' + #13#10 +
          '                              ccc on ccc.id_empresa = ped.id_empresa and ' + #13#10 +
          '                                     ccc.id_almoxarifado = eta.id_almoxarifado and ' + #13#10 +
          '                                     ccc.id_item = eta.id_item and ' + #13#10 +
          '                                     ccc.id_cor = eta.id_cor and ' + #13#10 +
          '                                     ccc.id_tamanho = eta.id_tamanho';
  end;
begin
   BUS_SQ_M_EST_ALM_PEN.Close;
   BUS_SQ_M_EST_ALM_PEN.CommandText := enSqlQtdIteAlmPend;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_EST_ALM_PEN.CommandText := BUS_SQ_M_EST_ALM_PEN.CommandText +
        //   ' where ped.situacao = 2 and ped.situacao_aprovacao = 1 ' +
           ' where ped.situacao = 2 and ped.situacao_aprovacao <> 2 ' +
           '   and ped.id_empresa = ''' + VarToStr(Input[1]) +''' ';

      end;
   BUS_SQ_M_EST_ALM_PEN.CommandText := BUS_SQ_M_EST_ALM_PEN.CommandText +
      ' group by 1,2,3,4,5,6,7,8,9,10,11' +
      ' order by 2,3,6 ' ;
   Result := BUS_DP_M_EST_ALM_PEN.Data;
   BUS_SQ_M_EST_ALM_PEN.Close;
end;


function TSM.BUS_DP_M_EST_SLD_ANTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql: String;
begin

  { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 23/10/2014 }

   // input[0]  - Empresa
   // input[1]  - Tipo de Estoque
   // input[2]  - Data base
   // input[3]  - Itens
   // input[4]  - Aloxarifados
   // input[5]  - Cor
   // input[6]  - Tamanho


   BUS_SQ_M_EST_SLD_ANT.Close;
   BUS_SQ_M_EST_SLD_ANT.CommandText :=
       ' select par.id_empresa, par.emp_razao as int_nomeraz, ' +
       '        par.emp_fantasia as int_nomefan,              ' +
       '        ite.id_item, ite.descricao as int_nomeite, COALESCE(cor.id_cor,0) AS id_cor,         ' +
       '        COALESCE(cor.descricao,'''') as int_nomecor, COALESCE(tam.id_tamanho,0) as id_tamanho, ' +
       '        COALESCE(tam.descricao,'''') as int_nometam,                                           ' +
			 '        COALESCE(alm.id_almoxarifado,0) AS id_almoxarifado , COALESCE(alm.descricao,'''') as int_nomealm, ' +
       '        ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';
       if Input[1] <> '' then
          begin
            BUS_SQ_M_EST_SLD_ANT.CommandText :=
              BUS_SQ_M_EST_SLD_ANT.CommandText +
              ' fea.id_tipo_mov_estoque in (' + VarToStr(Input[1]) +') and ';
          end;
       BUS_SQ_M_EST_SLD_ANT.CommandText :=
             BUS_SQ_M_EST_SLD_ANT.CommandText +
       '           tme.tipo_movimento = 0    and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and                       ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) -        ' +
       '                                                               ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';
       if Input[1] <> '' then
          begin
            BUS_SQ_M_EST_SLD_ANT.CommandText :=
              BUS_SQ_M_EST_SLD_ANT.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[1]) +') and ';
          end;
       BUS_SQ_M_EST_SLD_ANT.CommandText :=
             BUS_SQ_M_EST_SLD_ANT.CommandText +
       '           tme.tipo_movimento = 1    and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and   ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as saldo_anterior ' +
       '    '  +
       ' from cad_tb_c_par par ' ;

      if Input[3] = '' then
         begin
            BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_ite ite on (ite.id_item > 0 ) ';
         end
      else
         begin
           BUS_SQ_M_EST_SLD_ANT.CommandText  := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_ite ite on (ite.id_item in ('+VarToStr(Input[3])+')) ';
         end;

      if Input[4] = '' then
         begin
            BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_alm alm on (COALESCE(alm.id_almoxarifado,0) > 0 ) ';
         end
      else
         begin
           BUS_SQ_M_EST_SLD_ANT.CommandText  := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_alm alm on (COALESCE(alm.id_almoxarifado,0) in ('+VarToStr(Input[4])+')) ';
         end;

      if Input[5] = '' then
         begin
            BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor > 0 ) ';
         end
      else
         begin
           BUS_SQ_M_EST_SLD_ANT.CommandText  := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor in ('+VarToStr(Input[5])+')) ';
         end;

      if Input[6] = '' then
         begin
            BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho > 0 ) ';
         end
      else
         begin
            BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho in ('+ VarToStr(Input[6])+')) ';
         end;

   // input[0]  - Empresa
   // input[1]  - Tipo de Estoque
   // input[2]  - Data base
   // input[3]  - Itens
   // input[4]  - Aloxarifados
   // input[5]  - Cores
   // input[6]  - Tamanhos

   BUS_SQ_M_EST_SLD_ANT.CommandText := BUS_SQ_M_EST_SLD_ANT.CommandText + ' where 1 = 1 ';

   if Input[0] <> '' then
      begin
        BUS_SQ_M_EST_SLD_ANT.CommandText :=
          BUS_SQ_M_EST_SLD_ANT.CommandText +
          ' and par.id_empresa in (' + VarToStr(Input[0]) +') ';
      end;

   //GerarSqlTxt(BUS_SQ_M_EST_SLD_ANT);

   Result := BUS_DP_M_EST_SLD_ANT.Data;
end;

function TSM.BUS_DP_M_ETQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlOprEtq: String;
  begin
    Result :=
     ' select false as int_selecao, etq.*, ' +
     '  cast( case                                '+
     '          when  coalesce(etq.pcp_obs_item,'''') <> '''' then etq.pcp_obs_item   ' +
     '      else ite.descricao end as varchar(150)) as int_nomeite,  ' +
     ' ite.id_und_venda as int_und_venda, ite.cod_barra as int_cod_barra_gtin, '+
     '        cor.descricao as int_nomecor,tam.descricao as int_nometam, ' +
     '  ite.ETIQ_MEDIDAS as int_medidaite, ite.ETIQ_ESPUMA1 as int_etiq_espuma1ite,                                     ' +
     '  ite.ETIQ_ESPUMA2 as int_etiq_espuma2ite, ite.ETIQ_ESPUMA3 as int_etiq_espuma3ite,                               ' +
     '  ite.ETIQ_ESPUMA4 as int_etiq_espuma4ite, ite.ETIQ_ESPUMA5 as int_etiq_espuma5ite,                               ' +
     '  ite.ETIQ_ESPUMA6 as int_etiq_espuma6ite,  ite.etiq_marca as int_etiq_marca, ite.ETIQ_MADEIRA as int_etiq_madeiraite,                               ' +
     '  ite.ETIQ_REVESTIMENTO1 as int_etiq_revestimento1ite,ite.ETIQ_REVESTIMENTO2 as int_etiq_revestimento2ite,        ' +
     '  ite.ETIQ_REVESTIMENTO3 as int_etiq_revestimento3ite,                                                            ' +
     '  ite.ETIQ_REVESTIMENTO4 as int_etiq_revestimento4ite,ite.ETIQ_REVESTIMENTO5 as int_etiq_revestimento5ite,        ' +
     '  ite.ETIQ_REVESTIMENTO6 as int_etiq_revestimento6ite, ite.ETIQ_RECOMENDACOES_1 as int_etiq_recomendacoes1ite,    ' +
     '  ite.ETIQ_RECOMENDACOES_2 as int_etiq_recomendacoes2ite, ' +
     '  cue.descricao as int_nomecue, cle.descricao as int_nomecle, ' +
     '  gru.nome_selo_etq as int_nomeseloetq, gru.id_fte_etq AS int_fteetq, GRU.imprime_selo_etq AS int_impselo,  ' +
     '  GRU.imprime_msq_etq AS int_impmsgetq,ite.etiq_modelo as int_etiq_modelo, ett.MODELO_ETQ as int_modeloftq_etq,  ' +
     '  gru.imp_etq_simples as int_impetqsimples, cast(gru.path_etq_simples as varchar(100)) as int_pathetqsimples, ' +
     '  cast( case  ett.MODELO_ETQ                                         ' +
     '      when 1 then  ''Etiquetas - Colcho padro'' ' +
     '      when 2 then  ''Etiquetas - Colcho baby''   ' +
     '      when 3 then  ''Etiquetas - Colcho bordado''    ' +
     '      when 4 then  ''Etiquetas - Colcho colchonete'' ' +
     '      when 5 then  ''Etiquetas - Bobina'' ' +
     '      when 6 then  ''Etiquetas - Travesseiro'' ' +
     '      when 7 then  ''Etiquetas - Suave Encosto'' ' +
     '      when 8 then  ''Etiquetas - Base Box'' ' +
     '   end as varchar(50)) as int_nome_layout_etq,        ' +
     ' ett.cod_int_etq, ett.cod_int_etq_rev, ett.descricao,ett.etq_tecnica,    ' +
     ' ett.especificacoes, ett.texto_livre1, ett.texto_livre2, ett.id_fte_etq, ' +
     ' ett.modelo_etq, fte.*, ' +
     'cast( case ' +
     '    when  coalesce(etq.pcp_obs_item,'''') <> '''' then etq.pcp_obs_item ' +
     'else ite.descricao end as varchar(150)) as int_nomeite_pers, opr.num_lote as int_num_lote_opr,  ' +
     ' frn.nome as int_nome_func_reimp,  ' +
     '   cast( case ite.etiq_tipo_produto' + #13#10 +
     '       when 0 then ''COLCHO DE ESPUMA''' + #13#10 +
     '       when 1 then ''COLCHO BOX CONJUGADO''' + #13#10 +
     '       when 2 then ''COLCHO AUXILIAR''' + #13#10 +
     '       when 3 then ''COLCHO MISTO''' + #13#10 +
     '   else ''?????'' end  as varchar(50) ) as int_etiq_tipo_produto, ' +

     ' case ' + #13#10 +
     '    when dta_impressa is not null   then current_date - dta_impressa' + #13#10 +
     ' else' + #13#10 +
     '    0 end as qtde_dias' +

     ' from pcp_tb_m_etq etq '+
     ' left outer join cad_tb_c_ite ite on ite.id_item=etq.id_item '+
     ' left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo '+
     ' left outer join cad_tb_c_cor cor on cor.id_cor=etq.id_cor   '+
     ' left outer join cad_tb_c_tam tam on tam.id_tamanho=etq.id_tamanho '+
     ' left outer join pcp_tb_c_cle cle on cle.id_cle = ite.ETIQ_CLASSIFICACAO_PRO '+
     ' left outer join pcp_tb_c_cue cue on cue.id_cue = ite.etiq_id_cue ' +
     ' left outer join pcp_tb_m_opr opr on opr.id_opr = etq.id_opr   ' +
     ' left outer join cad_tb_c_fun frn on frn.id_funcionario =  etq.id_func_reimpressa ' +
     ' inner join pcp_tb_c_fte_etq ett on ett.id_fte_etq = gru.id_fte_etq ' +
     ' inner join pcp_tb_c_fte fte     on fte.id_fte  = ett.id_fte ';

  end;
var
  sqlUnion: String;
begin

   BUS_SQ_M_ETQ.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_ETQ.CommandText := enSqlOprEtq + ' WHERE 1 = 2 '
        else
           BUS_SQ_M_ETQ.CommandText := enSqlOprEtq +
              ' WHERE etq.cod_barra = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           BUS_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' ';

           if Input[2] = 'N' then
              begin
                 if Input[3] <> '' then
                    begin
                      BUS_SQ_M_ETQ.CommandText := enSqlOprEtq + '  and   etq.id_item   = '''+VarToStr(Input[3])+''' ';
                    end;

                 if Input[4] <> '' then
                    begin
                      BUS_SQ_M_ETQ.CommandText := enSqlOprEtq + '  and   etq.id_cor   = '''+VarToStr(Input[4])+''' ';
                    end;
              end;


           if Input[5] <> '0' then
              begin
               // 0-Todas as situaes
               // 1-Etiquetas em produo(apenas gerada)
               // 2-Etiquetas com entrada
               // 3-Etiquetas com sada
               if Input[5] = '1' then
                  BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = false and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[5] = '2' then
                  BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = true and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[5] = '3' then
                  BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_entrada_est is not null  and etq.dta_saida is null ' ;

               if Input[5] = '4' then
                  BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is not null ' ;

               if Input[5] = '5' then
                  BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is null ' ;
              end;

           BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +
               ' order by etq.dta_criacao , etq.cod_barra ' ;
      end;



   if (Input[0] = 1) then
      begin
        if Input[5] = '0' then
           BUS_SQ_M_ETQ.CommandText := BUS_SQ_M_ETQ.CommandText +  ' order by etq.dta_criacao , etq.cod_barra   ';
      end;

   //CMServerForm.mm.Lines.Clear;
   //CMServerForm.mm.Lines.Add(PCP_SQ_M_ETQ.CommandText);

   Result := BUS_DP_M_ETQ.Data;

end;

function TSM.BUS_DP_M_FAT_NFE_CUSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatNfeCustoMed: String;
  begin
    Result :=

    // Este metdo tem a funo de buscar o custo mdio atual do item aps a
    // excluso da nota fiscal de entrada.

    'select id_item,       ' +
    '   COALESCE( (select (sum(inf.vlr_custo) * sum(inf.qtde)) as custo_nfe_ite  '+
    '     from fat_tb_m_nfe_ite inf                                     '+
    '            left outer join fat_tb_m_nfe nfe on                    '+
    '                 (nfe.id_fiscal = inf.id_fiscal)                   '+
    '     where nfe.id_empresa =  ''' + VarToStr(Input[0]) +'''         '+
    '     and   nfe.id_fiscal  <> ''' + VarToStr(Input[1]) +'''         '+
    '     and   nfe.tipo_nf    =  ''E'' ' +
    '     and   inf.id_item    =  ite.id_item ' +
    '     and   inf.id_cor     in ('  + VarToStr(Input[3]) +')'          +
    '     and   inf.id_tamanho in ('  + VarToStr(Input[4]) +')) - '      +
    '            (select COALESCE((sum(inf.vlr_custo) * sum(inf.qtde)),0)  as custo_nfe_ite_dev_for ' +
    '             from fat_tb_m_nfe_ite inf ' +
    '                    left outer join fat_tb_m_nfe nfe on  ' +
    '                         (nfe.id_fiscal = inf.id_fiscal) ' +
    '            where nfe.id_empresa  = ''' + VarToStr(Input[0]) +'''    '+
    '            and   nfe.tipo_nf     = ''D''                            '+
    '            and   inf.id_item     = ite.id_item                      '+
    '             and   inf.id_cor     in (' + VarToStr(Input[3]) +')'     +
    '             and   inf.id_tamanho in (' + VarToStr(Input[4]) +')) * ' +
    '  ' +
    '  ' +
    '    (select  sum(inf.qtde) as qtde_nfe_ite ' +
    '     from fat_tb_m_nfe_ite inf             ' +
    '            left outer join fat_tb_m_nfe nfe on  ' +
    '                 (nfe.id_fiscal = inf.id_fiscal) ' +
    '    where nfe.id_empresa  =  ''' + VarToStr(Input[0]) + '''    '+
    '     and   nfe.id_fiscal  <> ''' + VarToStr(Input[1]) + '''    '+
    '     and   nfe.tipo_nf    =  ''E'' '                            +
    '     and   inf.id_item    =  ite.id_item                       '+
    '     and   inf.id_cor     in ('  + VarToStr(Input[3]) + ')'     +
    '     and   inf.id_tamanho in ('  + VarToStr(Input[4]) + ')) - ' +
    '              (select  COALESCE(sum(inf.qtde),0) as qtde_nfe_ite_dev_for '  +
    '               from fat_tb_m_nfe_ite inf ' +
    '                      left outer join fat_tb_m_nfe nfe on   ' +
    '                           (nfe.id_fiscal = inf.id_fiscal)  ' +
    '              where nfe.id_empresa    = ''' + VarToStr(Input[0]) +'''   '+
    '               and   nfe.tipo_nf      = ''D''                           '+
    '               and   inf.id_item      = ite.id_item                     '+
    '               and   inf.id_cor       in (' + VarToStr(Input[3]) + ')'   +
    '               and   inf.id_tamanho   in (' + VarToStr(Input[4]) + '))'  +
    '     /   ' +
    '         ' +
    '   ((select  sum(inf.qtde) as qtde_nfe_ite ' +
    '     from fat_tb_m_nfe_ite inf             ' +
    '            left outer join fat_tb_m_nfe nfe on  ' +
    '                 (nfe.id_fiscal = inf.id_fiscal) ' +
    '    where nfe.id_empresa  =  ''' + VarToStr(Input[0])  +'''   '+
    '     and   nfe.id_fiscal  <> ''' + VarToStr(Input[1]) + '''   '+
    '     and   nfe.tipo_nf    =  ''E''                            '+
    '     and   inf.id_item    =  ite.id_item                      '+
    '     and   inf.id_cor     in ('  + VarToStr(Input[3]) + ')'    +
    '     and   inf.id_tamanho in ('  + VarToStr(Input[4]) + ')) - '+
    '              (select  COALESCE(sum(inf.qtde),0) as qtde_nfe_ite_dev_for ' +
    '               from fat_tb_m_nfe_ite inf                     '+
    '                      left outer join fat_tb_m_nfe nfe on    '+
    '                           (nfe.id_fiscal = inf.id_fiscal)   '+
    '              where nfe.id_empresa  =  ''' + VarToStr(Input[0]) +'''  ' +
    '               and   nfe.tipo_nf    =  ''D''                          ' +
    '               and   inf.id_item    =  ite.id_item                    ' +
    '               and   inf.id_cor     in ('  + VarToStr(Input[3]) + ')'   +
    '               and   inf.id_tamanho in ('  + VarToStr(Input[4]) + '))),0) AS VLR_CUSTO_MEDIO' +
    ' '   +
    ' from cad_tb_c_ite ite ';
  end;

begin
  { input[0] - id_empresa
    input[1] - id_fiscal
    input[2] - in id_item
    input[3] - in id_cor
    input[4] - in id_tamanho
   }

   BUS_SQ_M_FAT_NFE_CUS.Close;

   if Trim(VarToStr(Input[2])) = '' then
      BUS_SQ_M_FAT_NFE_CUS.CommandText := enSqlFatNfeCustoMed + ' WHERE 1=2 '
   else
      BUS_SQ_M_FAT_NFE_CUS.CommandText := enSqlFatNfeCustoMed +
        ' WHERE ite.id_item in (' + VarToStr(Input[2]) +')';

   Result := BUS_DP_M_FAT_NFE_CUS.Data;
end;

function TSM.BUS_DP_M_FAT_PCA_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPca: String;
  begin
   Result :=
    ' select ped.id_pedido,pca.* from fat_tb_m_pca_ped ped '+
    ' left outer join fat_tb_m_pca pca on pca.id_carregamento=ped.id_carregamento '+
    ' where 1=1 ';
  end;
begin
   { TODO -oLuan : Criado em 07/04/2016 }
   BUS_SQ_M_FAT_PCA_PED.Close;
   if Input[0] = 0 then
      begin
       BUS_SQ_M_FAT_PCA_PED.CommandText := enSqlPca +
         ' AND PED.ID_PEDIDO = ''' + VarToStr(Input[1]) + ''' ';
      end;

   if Input[0] = 1 then
      begin
       BUS_SQ_M_FAT_PCA_PED.CommandText := enSqlPca +
         ' AND PED.ID_CARREGAMENTO <> ''' + VarToStr(Input[1]) + ''' '+
         ' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) + ''' ';
      end;

   Result := BUS_DP_M_FAT_PCA_PED.Data;
end;

function TSM.BUS_DP_M_FEA_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFeaIte: String;
  begin
    Result := ' SELECT * FROM EST_TB_M_FEA  ';
  end;
begin
   BUS_SQ_M_FEA_ITE.Close;
   BUS_SQ_M_FEA_ITE.CommandText := enSqlFeaIte + ' WHERE 1 = 1 ';

   if Input[0] <> '' then
      begin
           BUS_SQ_M_FEA_ITE.CommandText := BUS_SQ_M_FEA_ITE.CommandText +
             ' AND ID_EMPRESA in (' + VarToStr(Input[0]) +')';
      end;

   if Input[1] <> ''  then
      begin
        BUS_SQ_M_FEA_ITE.CommandText := BUS_SQ_M_FEA_ITE.CommandText +
             ' AND ID_ITEM in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> ''  then
      begin
        BUS_SQ_M_FEA_ITE.CommandText := BUS_SQ_M_FEA_ITE.CommandText +
             ' AND ID_ALMOXARIFADO in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> ''  then
      begin
        BUS_SQ_M_FEA_ITE.CommandText := BUS_SQ_M_FEA_ITE.CommandText +
             ' AND ID_COR in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> ''  then
      begin
        BUS_SQ_M_FEA_ITE.CommandText := BUS_SQ_M_FEA_ITE.CommandText +
             ' AND ID_TAMANHO in (' + VarToStr(Input[4]) +')';
      end;

   // CMServerForm.mm.Lines.Add(EST_SQ_M_FEA.CommandText);
   Result := BUS_DP_M_FEA_ITE.Data;
   BUS_SQ_M_FEA_ITE.Close;
end;

function TSM.BUS_DP_M_FES_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFesInt: String;
  begin
    Result :=
      'SELECT FES.* , '+
      ' PAR.EMP_RAZAO AS INT_NOMEEMP, '+
      ' PAR.EMP_FANTASIA AS INT_NOMEFAN, '+
      ' COR.DESCRICAO AS INT_NOMECOR, '+
      ' TAM.DESCRICAO AS INT_NOMETAM '+
      'FROM EST_TB_M_FES FES '+
      'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=FES.ID_EMPRESA '+
      'LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=FES.ID_COR '+
      'LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=FES.ID_TAMANHO ';
  end;
begin
   BUS_SQ_M_FES_INT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_COR = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_TAMANHO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_COR     = ''' + VarToStr(Input[3]) +''' AND '+
             '       FES.ID_TAMANHO = ''' + VarToStr(Input[4]) +''' ';
      end

   else if Input[0] = 4 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_COR in (' + VarToStr(Input[3]) +') ';
      end
   else if Input[0] = 5 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_TAMANHO in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 6 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_COR in (' + VarToStr(Input[3]) +') AND '+
             '       FES.ID_TAMANHO in (' + VarToStr(Input[4]) +') ';
      end

   else if Input[0] = 7 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') ';
      end
   else if Input[0] = 8 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.DATA_ULT_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND '+
             '       FES.DATA_ULT_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +'''  ';
      end
   else if Input[0] = 90 then
      begin
           BUS_SQ_M_FES_INT.CommandText := enSqlFesInt +
             ' WHERE FES.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end;

   // Order by
   if Input[0] = 90 then
      begin
           BUS_SQ_M_FES_INT.CommandText := BUS_SQ_M_FES_INT.CommandText +
             ' ORDER BY FES.ID_EMPRESA ';
      end;

   Result := BUS_DP_M_FES_INT.Data;

   BUS_SQ_M_FES_INT.Close;
end;

function TSM.BUS_DP_M_FOR_SLD_TITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlForSldTit: String;
  begin
    Result := ' SELECT COALESCE(SUM(PAG.VLR_SALDO),0) AS VLR_SALDO_TIT FROM fin_tb_m_pag PAG  ';
  end;
begin
   BUS_SQ_M_FOR_SLD_TIT.Close;
   BUS_SQ_M_FOR_SLD_TIT.CommandText := enSqlForSldTit + ' WHERE PAG.VLR_SALDO > 0 ';

   if Input[0] <> '' then
      begin
           BUS_SQ_M_FOR_SLD_TIT.CommandText := BUS_SQ_M_FOR_SLD_TIT.CommandText +
             ' AND ID_EMPRESA in (' + VarToStr(Input[0]) +')';
      end;

   if Input[1] <> ''  then
      begin
        BUS_SQ_M_FOR_SLD_TIT.CommandText := BUS_SQ_M_FOR_SLD_TIT.CommandText +
             ' AND ID_FORNECEDOR in (' + VarToStr(Input[1]) +')';
      end;

   Result := BUS_DP_M_FOR_SLD_TIT.Data;
end;

function TSM.BUS_DP_M_FTE_ETQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFteEtq: String;
  begin
    Result :=
       ' SELECT etq.cod_int_etq, etq.cod_int_etq_rev, etq.descricao,etq.etq_tecnica, ' +
       '    etq.especificacoes, etq.texto_livre1, etq.texto_livre2, etq.id_fte_etq, ' +
       '    etq.modelo_etq, fte.* '                  +
       ' FROM pcp_tb_c_fte_etq etq ' +
       '     left outer join pcp_tb_c_fte fte on fte.id_fte=etq.id_fte ';
  end;
begin
   BUS_SQ_M_FTE_ETQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_FTE_ETQ.CommandText := enSqlFteEtq + ' WHERE 1=2 '
        else
           BUS_SQ_M_FTE_ETQ.CommandText := enSqlFteEtq +
               ' WHERE ETQ.id_fte_etq = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_M_FTE_ETQ.CommandText := enSqlFteEtq +
           ' WHERE ETQ.ETQ_TECNICA =  ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := BUS_DP_M_FTE_ETQ.Data;
end;

function TSM.BUS_DP_C_FUN_MECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusFunMec: String;
  begin
    Result :=
             'select fun.id_funcionario, fun.nome    ' +
             ' from cad_tb_c_fun_crg crg             ' +
             '    left outer join cad_tb_c_fun fun on  ' +
             '       (fun.id_funcionario = crg.id_funcionario) ' +
             '    left outer join pcp_tb_c_crg pcg on ' +
             '       (crg.id_cargo = pcg.id_cargo) ';
  end;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 06/08/2015 }
   BUS_SQ_C_FUN_MEC.Close;
   BUS_SQ_C_FUN_MEC.CommandText := enSqlBusFunMec +
         ' where pcg.tipo = 3 ' +
         '   and fun.ativo = true ' +
         ' order by fun.nome';
   Result := BUS_DP_C_FUN_MEC.Data;
   BUS_SQ_C_FUN_MEC.Close;
end;

function TSM.BUS_DP_C_FUN_CRG_GERDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusFunCrgGer: String;
  begin
    Result :=
             'select fun.id_funcionario, fun.nome    ' +
             ' from cad_tb_c_fun_crg crg             ' +
             '    left outer join cad_tb_c_fun fun on  ' +
             '       (fun.id_funcionario = crg.id_funcionario) ' +
             '    left outer join pcp_tb_c_crg pcg on ' +
             '       (crg.id_cargo = pcg.id_cargo) ';
  end;
begin
   { TODO -oLuan -cCriao : Mtodo criado em 03/05/2016 }
   BUS_SQ_C_FUN_CRG_GER.Close;
   BUS_SQ_C_FUN_CRG_GER.CommandText := enSqlBusFunCrgGer +
         ' where pcg.tipo in ('+ VarToStr(Input[0])+') ';
   if Input[1]<>'' then
      begin
         BUS_SQ_C_FUN_CRG_GER.CommandText :=  BUS_SQ_C_FUN_CRG_GER.CommandText +
          ' and fun.ativo = '''+ VarToStr(Input[1])+''' ';
      end;

   BUS_SQ_C_FUN_CRG_GER.CommandText :=  BUS_SQ_C_FUN_CRG_GER.CommandText +
         ' order by fun.nome';
   Result := BUS_DP_C_FUN_CRG_GER.Data;
   BUS_SQ_C_FUN_CRG_GER.Close;
end;

function TSM.BUS_DP_M_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNfe: String;
  begin
    Result := ' SELECT NFE.* FROM FAT_TB_M_NFE NFE ';
  end;
begin
   BUS_SQ_M_NFE.Close;
   BUS_SQ_M_NFE.CommandText := enSqlNfe +
                                       ' WHERE ID_EMPRESA  = ''' + VarToStr(Input[0]) +''' AND '+
                                       '       ID_FISCAL  <> ''' + VarToStr(Input[1]) +''' AND '+
                                //       '       DTA_EMISSAO = ''' + VarToStr(Input[2]) +''' AND '+   Retirado a pedido de Sangia e Max, pois verificaram que na tem necessidade, em 14/05/2014 as 08:40
                                       '       ID_EMITENTE = ''' + VarToStr(Input[2]) +''' AND '+
                                       '       SERIE       = ''' + VarToStr(Input[3]) +''' AND '+
                                       '       MODELO      = ''' + VarToStr(Input[4]) +''' AND '+
                                       '       NUMERO      = ''' + VarToStr(Input[5]) +''' ';
   Result := BUS_DP_M_NFE.Data;
end;

function TSM.BUS_DP_M_NFE_DEV_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNfeDevInt: String;
  begin
    Result := ' SELECT NFD.* '+
              ' FROM FAT_TB_M_NFE_DEV NFD ';
  end;
begin

   BUS_SQ_M_NFE_DEV_INT.Close;
   if input[0] = 0 then
      begin
        BUS_SQ_M_NFE_DEV_INT.CommandText := enSqlNfeDevInt +
           ' WHERE NFD.ID_FISCAL = ''' + VarToStr(Input[1]) + ''' ';
      end;

   Result := BUS_DP_M_NFE_DEV_INT.Data;
end;

function TSM.BUS_DP_M_NFE_DEV_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNfeDevIteInt: String;
  begin
    Result := ' SELECT NDI.* '+
              ' FROM FAT_TB_M_NFE_DEV_ITE NDI ';
  end;
begin
   BUS_SQ_M_NFE_DEV_ITE_INT.Close;

   if input[0] = 0 then
      begin
        BUS_SQ_M_NFE_DEV_ITE_INT.CommandText := enSqlNfeDevIteInt +
           ' WHERE NDI.ID_FISCAL = ''' + VarToStr(Input[1]) + ''' ';
      end;

   if input[0] = 1 then
      begin
        BUS_SQ_M_NFE_DEV_ITE_INT.CommandText := enSqlNfeDevIteInt +
           ' WHERE NDI.ID_FISCAL = ''' + VarToStr(Input[1]) + ''' ' +
           ' AND   NDI.ID_FISCAL_DEV = ''' + VarToStr(Input[2]) + ''' ';
      end;


   Result := BUS_DP_M_NFE_DEV_ITE_INT.Data;
end;

function TSM.BUS_DP_M_NFE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatNfeInt: String;
  begin
    Result :=
      'SELECT NFE.* FROM FAT_TB_M_NFE NFE ';
  end;
begin
   BUS_SQ_M_NFE_INT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt +
             ' WHERE  NFE.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 90 then
      begin
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt +
             ' WHERE  NFE.ID_ORDEM = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 91 then
      begin
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt +
             ' WHERE NFE.ID_SEQ_FAT_GAR>0 AND NFE.ID_ORDEM_GAR = ''' + VarToStr(Input[1]) +''' '+
             '  ORDER BY NFE.ID_SEQ_FAT_GAR DESC  LIMIT 1 ';
      end;

   if Input[0] = 92 then
      begin
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt +
             ' WHERE  NFE.ID_ORDEM_GAR = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 93 then
      begin
           BUS_SQ_M_NFE_INT.CommandText := enSqlFatNfeInt +
             ' WHERE  NFE.ID_PEDIDO_VENDA = ''' + VarToStr(Input[1]) +''' ';
      end;



   Result := BUS_DP_M_NFE_INT.Data;
   BUS_SQ_M_NFE_INT.Close;
end;

function TSM.BUS_DP_M_NFE_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNfeIte: String;
  begin
    Result := ' SELECT NFI.*,ITE.DESCRICAO AS INT_NOMEITE, ITE.ID_UND_VENDA AS INT_UND_VENDA '+
              ' FROM FAT_TB_M_NFE_ITE NFI '+
              ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON (NFE.ID_FISCAL  = NFI.ID_FISCAL) '+
              ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NFI.ID_ITEM ';

  end;
begin
   BUS_SQ_M_NFE_ITE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_NFE_ITE.CommandText := enSqlNfeIte + ' WHERE 1=2 '
        else
           BUS_SQ_M_NFE_ITE.CommandText := enSqlNfeIte +
           ' WHERE NFI.ID_FISCAL =       ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_M_NFE_ITE.CommandText := enSqlNfeIte +
           ' WHERE NFI.ID_ITEM =       ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := BUS_DP_M_NFE_ITE.Data;
end;

function TSM.BUS_DP_M_NFE_NFFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNfeNff: String;
  begin
    Result := ' SELECT NFF.*, NFE.IND_FRETE '+
              ' FROM FAT_TB_M_NFE_NFF NFF '+
              ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON (NFE.ID_FISCAL  = NFF.ID_FISCAL) ';
  end;
begin
   BUS_SQ_M_NFE_NFF.Close;
   BUS_SQ_M_NFE_NFF.CommandText := enSqlNfeNff +
      ' WHERE NFE.ID_EMPRESA  = ''' + VarToStr(Input[0]) +''' AND '+
      '       NFF.NOTA_FRETE  = ''' + VarToStr(Input[1]) +''' AND '+
      '       NFE.IND_FRETE   = ''' + VarToStr(Input[2]) +''' AND '+
      '       NFF.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';

   Result := BUS_DP_M_NFE_NFF.Data;

end;

function TSM.BUS_DP_M_NFE_TIT_GRPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusNfeTitGrp: String;
begin

  { TODO -oMaxsuel -cCriao :
      Criado por Maxsuel Victor em 09-03-2015

      // Busca as formas de pagamento da NF agrupando por cdigo de forma de pagemento da ECF
  }


  // input[0] - ECF
  // input[1] - Fiscal

  enSqlBusNfeTitGrp :=
                    'SELECT FPG.ID_FORMA_PAG_ECF,                                    ' +
                    '             FPG.ID_FORMA_PAG,                                  ' +
                    '             COALESCE(SUM(VLR_TITULO),0) as VLR_TITULO,         ' +
                    '             COALESCE(COUNT(FPG.ID_FORMA_PAG),0) as QTDE_TITULO '+
                    ' FROM FAT_TB_M_NFE_TIT NFT                                      ' +
                    '                                                                ' +
                    '       left outer join FAT_TB_M_NFE NFE on                      ' +
                    '                      (NFE.ID_FISCAL = NFT.ID_FISCAL)           ' +
                    '                                                                ' +
                    '       left outer join CAD_TB_C_ECF_FPG FPG on                  ' +
                    '                      (FPG.ECF_SERIAL_IMPRESSORA = ''' + VarToStr(Input[0]) + ''' '+
                    '                       AND FPG.ID_FORMA_PAG = NFT.ID_FORMA_PAG) ' +
                    '                                                 ' +
                    ' WHERE NFT.ID_FISCAL = ''' + VarToStr(Input[1]) + ''' '+
                    ' GROUP BY FPG.ID_FORMA_PAG_ECF, FPG.ID_FORMA_PAG ' +
                    ' ORDER BY FPG.ID_FORMA_PAG_ECF, FPG.ID_FORMA_PAG ';

   BUS_SQ_M_NFE_TIT_GRP.Close;

   BUS_SQ_M_NFE_TIT_GRP.CommandText := '';
   BUS_SQ_M_NFE_TIT_GRP.CommandText := enSqlBusNfeTitGrp;

   Result := BUS_DP_M_NFE_TIT_GRP.Data;
end;

function TSM.BUS_DP_M_NFE_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNfeTitInt: String;
  begin
    Result := ' SELECT NFT.*, fpg.descricao as int_nomefpg '+
              ' FROM FAT_TB_M_NFE_TIT NFT              ' +
              '  left outer join CAD_TB_C_FPG fpg on   ' +
              '  (fpg.id_forma_pag = nft.id_forma_pag) ';
  end;
begin
   BUS_SQ_M_NFE_TIT_INT.Close;

   BUS_SQ_M_NFE_TIT_INT.CommandText := enSqlNfeTitInt +
       ' WHERE NFT.ID_FISCAL =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_NFE_TIT_INT.Data;
end;

function TSM.BUS_DP_M_NFE_TIT_MAQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNfeTitMaq: String;
  begin
    Result := ' SELECT NFT.id_fiscal,NFE.numero, coalesce(id_maquineta,0) as id_maquineta, fpg.descricao as int_nomefpg '+
              ' FROM FAT_TB_M_NFE_TIT NFT              ' +
              '    left outer join CAD_TB_C_FPG fpg on   ' +
              '        (fpg.id_forma_pag = nft.id_forma_pag) ' +
              '    left outer join FAT_TB_M_NFE NFE on (NFE.ID_FISCAL = NFT.ID_FISCAL)  ';

  end;
begin
   BUS_SQ_M_NFE_TIT_MAQ.Close;

   if Input[0] = '0' then
      begin
        BUS_SQ_M_NFE_TIT_MAQ.CommandText := enSqlNfeTitMaq +
            ' WHERE NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) +''' ' +
            '   AND NFE.ID_ABERTURA =  ''' + VarToStr(Input[2]) +''' ' +
            '   AND NFE.NFE_COD_SIT = ''00'' AND NFE.STATUS = 1 ' +
            '   AND NFE.TIPO_NF = ''S'' AND FPG.DOC_IMPRESSO = 3 ' +
            '   AND coalesce(id_maquineta,0) = 0 ' +
            ' GROUP BY 1,2,3,4 ';
      end;

   Result := BUS_DP_M_NFE_TIT_MAQ.Data;

   BUS_SQ_M_NFE_TIT_MAQ.Close;
end;

function TSM.BUS_DP_M_NFI_RAADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusNfiRaa: String;
  begin
    Result :=
        'SELECT nfe.numero, nfe.serie, nfe.modelo, nfe.dta_emissao, '+
        '       nfe.dta_documento as dta_entrada, nfi.qtde, nfi.num_lote, ite.cod_fabrica, '+
        '       nfi.id_sequencia, nfi.id_item, ite.descricao as int_nomeite, nfi.id_cor, '+
        '       nfi.id_tamanho, cor.descricao as int_nomecor, tam.descricao as int_nometam, '+
        '       nfe.id_emitente, foc.descricao as int_nomefor, ITE.id_grupo, gru.descricao as int_nomegru '+
        'FROM fat_tb_m_nfe_ite nfi '+
        'LEFT OUTER JOIN fat_tb_m_nfe nfe ON nfe.id_fiscal=nfi.id_fiscal '+
        'LEFT OUTER JOIN cad_tb_c_ite ite on ite.id_item=nfi.id_item '+
        'LEFT OUTER JOIN cad_tb_c_cor cor on cor.id_cor=nfi.id_cor '+
        'LEFT OUTER JOIN cad_tb_c_for foc on foc.id_fornecedor=nfe.id_emitente '+
        'LEFT OUTER JOIN cad_tb_c_tam tam on tam.id_tamanho=nfi.id_tamanho '+
        'LEFT OUTER JOIN cad_tb_c_gru gru on gru.id_grupo=substr(ite.id_grupo,1,4)||'''+'.000'+''' ';
  end;
begin
   BUS_SQ_M_NFI_RAA.Close;
   if Input[0] = 0 then
      begin
        BUS_SQ_M_NFI_RAA.CommandText := enSqlBusNfiRaa +
           ' WHERE nfe.tipo_nf='''+'E'+''' and nfi.para_analise_raa=1 and '+
           '       nfe.id_empresa = ''' + VarToStr(Input[1]) +''' and '+
           '       nfe.numero     = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_M_NFI_RAA.CommandText := enSqlBusNfiRaa +
           ' WHERE nfe.tipo_nf='''+'E'+''' and nfi.para_analise_raa=1 and '+
           '       nfe.id_empresa = ''' + VarToStr(Input[1]) +''' and '+
           '       nfi.id_item    = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[0] = 2 then
      begin
        BUS_SQ_M_NFI_RAA.CommandText := enSqlBusNfiRaa +
           ' WHERE nfe.tipo_nf='''+'E'+''' and nfi.para_analise_raa=1 and '+
           '       nfe.id_empresa = ''' + VarToStr(Input[1]) +''' and '+
           '       ite.cod_fabrica= ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := BUS_DP_M_NFI_RAA.Data;

end;

function TSM.BUS_DP_M_OCVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusOfiOcv: String;
  begin
    Result :=
      ' select ocv.*, cli.nome as int_nomecli from ofi_tb_m_ocv ocv ' +
      ' left outer join cad_tb_c_cli cli on      ' +
      '    (cli.doc_cnpj_cpf = ocv.doc_cnpj_cpf) ';
  end;
begin

   BUS_SQ_M_OCV.Close;

   BUS_SQ_M_OCV.CommandText := enSqlBusOfiOcv;

   if Input[0]=0 then
     begin
         BUS_SQ_M_OCV.CommandText :=  BUS_SQ_M_OCV.CommandText +
          ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   OCV.DOC_CNPJ_CPF = ''' + VarToStr(Input[2]) +''' and ' +
          '   OCV.PLACA = ''' + VarToStr(Input[3]) +''' and ' +
          '   OCV.STATUS = 0 and CLI.ATIVO = TRUE ' ;
     end;

   if Input[0]=1 then
     begin
         BUS_SQ_M_OCV.CommandText :=  BUS_SQ_M_OCV.CommandText +
          ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   OCV.DOC_CNPJ_CPF = ''' + VarToStr(Input[2]) +''' and ' +
          '   OCV.CHASSI = ''' + VarToStr(Input[3]) +''' and ' +
          '   OCV.STATUS = 0 and CLI.ATIVO = TRUE ' ;
     end;


   Result := BUS_DP_M_OCV.Data;
   BUS_SQ_M_OCV.Close;
end;

function TSM.BUS_DP_M_OPB_OBLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusOpbObl: String;
  begin
    Result :=
      ' select opb.dta_emissao, ' + #13#10 +
      '        opb.id_responsavel,' + #13#10 +
      '        fun.nome as int_nomeres,' + #13#10 +
      '        obl.*, ite.descricao as int_nomeite, ' + #13#10 +
      '        cor.descricao as int_nomecor,   tam.descricao as int_nometam, ' + #13#10 +
      '        op_espumacao_impressa, op_impressa_por, op_impressa_em, ' +
      '  cast( '''' as varchar(15)) num_lote, ' + #13#10 +
      '        fnn.nome as int_nome_imp, ite.cubagem_esp_1 as int_cubagem_esp1 ' +
      ' from pcp_tb_m_opb_obl obl ' + #13#10 +
      '   left outer join pcp_tb_m_opb opb on opb.id_opb = obl.id_opb' + #13#10 +
      '   left outer join cad_tb_c_fun fun on fun.id_funcionario = opb.id_responsavel' + #13#10 +
      '   left outer join cad_tb_c_fun fnn on fnn.id_funcionario = obl.op_impressa_por ' +
      '   left outer join cad_tb_c_ite ite on ite.id_item = obl.id_item ' + #13#10 +
      '   left outer join cad_tb_c_cor cor on cor.id_cor = obl.id_cor' + #13#10 +
      '   left outer join cad_tb_c_tam tam on tam.id_tamanho = obl.id_tamanho' + #13#10;

  end;
begin
   { TODO -olMaxsuel : Criado em 03/11/2020 }

   BUS_SQ_M_OPB_OBL.Close;

   if Input[0] = 0 then
      begin
       BUS_SQ_M_OPB_OBL.CommandText := enSqlBusOpbObl +
         ' where opb.id_empresa = ''' + VarToStr(Input[1])+''' ' +
         '   and opb.id_opr = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := BUS_DP_M_OPB_OBL.Data;

end;


function TSM.BUS_DP_M_OPB_OBL_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOpbObl: String;
  begin
    Result :=
        ' select obl.* ,' + #13#10 +
        '   ite.descricao as int_nomeite, ' + #13#10 +
        '   cor.descricao as int_nomecor,' + #13#10 +
        '   tam.descricao as int_nometam, ' + #13#10 +
        '   cast( '''' as varchar(15)) num_lote ' + #13#10 +
        ' from pcp_tb_m_opb_obl obl ' + #13#10 +
        '   left outer join cad_tb_c_ite  ite on ite.id_item = obl.id_item ' + #13#10 +
        '   left outer join cad_tb_c_cor cor on cor.id_cor = obl.id_cor' + #13#10 +
        '   left outer join cad_tb_c_tam tam on tam.id_tamanho = obl.id_tamanho ';
  end;
begin
   BUS_SQ_M_OPB_OBL_INT.Close;
   BUS_SQ_M_OPB_OBL_INT.CommandText := enSqlOpbObl +
     ' WHERE OBL.ID_OPB = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_OPB_OBL_INT.Data;
end;

function TSM.BUS_DP_M_OPR_ETQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlOprOpp: String;
begin
  { TODO -oMaxsuel -cCriao : Criado em 09/08/2016 }

   enSqlOprOpp :=

               ' select false as int_selecao,                ' +
               '    opp.id_item, opp.id_cor, opp.id_tamanho, ' +
              // '    ite.descricao as int_nomeite,            ' +
               '  cast( case                                '+
               '          when  coalesce(opp.pcp_desc_item_person,'''') <> '''' then opp.pcp_desc_item_person   ' +
               '      else ite.descricao end as varchar(150)) as int_nomeite,               ' +
               '    ITE.ID_UND_VENDA  as int_undvenda,       ' +
               '    cor.descricao as int_nomecor,            ' +
               '    tam.descricao as int_nometam, opp.pcp_desc_item_person            ' +
               '                                             ' +
               ' from PCP_TB_M_OPR_OPP OPP                   ' +
               '    left outer join cad_tb_c_ite ite on ite.id_item = opp.id_item       ' +
               '    left outer join cad_tb_c_cor cor on cor.id_cor = opp.id_cor         ' +
               '    left outer join cad_tb_c_tam tam on tam.id_tamanho = opp.id_tamanho ' +
               '    left outer join cad_tb_c_fun fun on fun.id_funcionario = opp.id_resp_alt ' +
               ' where 1 = 1 ' ;
    if Input[0] = 0 then
       begin
         enSqlOprOpp := enSqlOprOpp +
                    ' and opp.id_opr = ''' + VarToStr(Input[1]) +''' ';

       end;

    enSqlOprOpp := enSqlOprOpp +
               ' UNION ALL' + #13#10 +
               '     select false as int_selecao,                ' + #13#10 +
               '                  coj.id_item_conjugado, coj.id_cor, coj.id_tamanho, ' + #13#10 +
               '                 cast( ite.descricao  as varchar(150)) as int_nomeite,            ' + #13#10 +
               '                  ITE.ID_UND_VENDA  as int_undvenda,       ' + #13#10 +
               '                  cor.descricao as int_nomecor,            ' + #13#10 +
               '                  tam.descricao as int_nometam,             ' + #13#10 +
               '                  cast( '''' as varchar(150) ) as pcp_desc_item_person              ' + #13#10 +
               '               from CAD_TB_C_ITE_COJ COJ                    ' + #13#10 +
               '                  left outer join cad_tb_c_ite ite on ite.id_item = coj.id_item_conjugado  ' + #13#10 +
               '                   left outer join cad_tb_c_cor cor on cor.id_cor = coj.id_cor         ' + #13#10 +
               '                  left outer join cad_tb_c_tam tam on tam.id_tamanho = coj.id_tamanho ' + #13#10 +
               '                 ' + #13#10 +
               '     where 1 = 1 ' + #13#10 ;

    if Input[0] = 0 then
       begin
         enSqlOprOpp := enSqlOprOpp +
               '       and   coj.id_item in ' + #13#10 +
               '           (' + #13#10 +
               '              select opp.id_item             ' + #13#10 +
               '               from PCP_TB_M_OPR_OPP OPP                   ' + #13#10 +
               '                where opp.id_opr = ''' + VarToStr(Input[1]) +''' ' +
               '           )' ;
       end;

   BUS_SQ_M_OPR_ETQ.Close;

   if Input[0] = 0 then
      begin
         BUS_SQ_M_OPR_ETQ.CommandText := enSqlOprOpp;
      end;

   BUS_SQ_M_OPR_ETQ.CommandText := BUS_SQ_M_OPR_ETQ.CommandText  +
                                   ' group by 1,2,3,4,5,6,7,8,9 ';

   Result := BUS_DP_M_OPR_ETQ.Data;

   BUS_SQ_M_OPR_ETQ.close;
end;

function TSM.BUS_DP_M_OPR_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOprInt: String;
  begin
    Result :=
      ' select opr.*, fuc.nome as int_nomeres, tpp.descricao as int_nometpp, '+
      ' alm.descricao as int_nomealm, str.descricao as int_nomestr ' +
      'from PCP_TB_M_OPR opr '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=opr.id_responsavel '+
      ' left outer join pcp_tb_c_tpp tpp on tpp.id_tpp=opr.id_tpp ' +
      ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = opr.id_almoxarifado) ' +
      ' left outer join cad_tb_c_set str on (str.id_setor = opr.id_setor) '  ;
  end;
begin
   BUS_SQ_M_OPR_INT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt + ' WHERE 1=2 '
        else
           BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
              ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              '   and OPR.id_opr = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and OPR.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and  opr.id_tpp = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
          ' where OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
          Format(' and upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and OPR.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             '   and OPR.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
           ' where opr.id_opr in (select opp.id_opr from pcp_tb_m_opr_ped ipp ' +
           '                        left outer join pcp_tb_m_opr opp on (opp.id_opr = ipp.id_opr) ' +
           '                       where  opp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           '                         and  ipp.id_tpp     = ''' + VarToStr(Input[2]) +''' )';
      end
   else if Input[0] = 6 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
            ' WHERE OPR.id_opr = ''' + VarToStr(Input[1]) +''' ';
      end

 else if Input[0] = 7 then
      begin
        BUS_SQ_M_OPR_INT.CommandText := enSqlPcpOprInt +
          ' where OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
          Format(' and upper(opr.num_lote) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := BUS_DP_M_OPR_INT.Data;
end;

function TSM.BUS_DP_M_OPR_ITE_SCBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOprIteScb: String;
  begin
    Result :=
        '       select ttt.id_item, ttt.descricao, ttt.cubagem1, ttt.cubagem2, ttt.cubagem3,cubagem_resvestimento_1,' + #13#10 +
        '           cubagem_resvestimento_2 from ' + #13#10 +
        '           (select opp.id_item, ite.descricao, ite.id_grupo, opp.id_cor, opp.id_tamanho, ' + #13#10 +
        '                 gru.id_item_bloco_espuma,' + #13#10 +
        '                 gru.id_item_bloco_espuma_2,' + #13#10 +
        '                 gru.id_item_bloco_espuma_3,' + #13#10 +
        '                 gru.id_item_bloco_espuma_revest_1,' + #13#10 +
        '                 gru.id_item_bloco_espuma_revest_1,' + #13#10 +
        '          ' + #13#10 +
        '          			 cast( case ' + #13#10 +
        '                    when (coalesce(gru.id_item_bloco_espuma) <> 0) and ' + #13#10 +
        '                         (coalesce(ite.cubagem_esp_1,0) = 0) then ''Precisa preencher''' + #13#10 +
        '                 else' + #13#10 +
        '                    cast(ite.cubagem_esp_1 as varchar(20)) end as varchar(20) ) as cubagem1,' + #13#10 +
        '                 cast(case ' + #13#10 +
        '                    when (coalesce(gru.id_item_bloco_espuma_2) <> 0) and ' + #13#10 +
        '                         (coalesce(ite.cubagem_esp_2,0) = 0) then ''Precisa preencher''' + #13#10 +
        '                 else' + #13#10 +
        '                    cast(ite.cubagem_esp_2 as varchar(20)) end as varchar(20) ) as cubagem2,                 ' + #13#10 +
        '                 cast( case ' + #13#10 +
        '                    when (coalesce(gru.id_item_bloco_espuma_3) <> 0) and ' + #13#10 +
        '                         (coalesce(ite.cubagem_esp_3,0) = 0) then ''Precisa preencher''' + #13#10 +
        '                 else' + #13#10 +
        '                    cast(ite.cubagem_esp_3 as varchar(20)) end as varchar(20) ) as cubagem3,' + #13#10 +
        '                 cast( case ' + #13#10 +
        '                    when (coalesce(gru.id_item_bloco_espuma_revest_1) <> 0) and ' + #13#10 +
        '                         (coalesce(ite.cubagem_esp_revest_1,0) = 0) then ''Precisa preencher''' + #13#10 +
        '                 else' + #13#10 +
        '                    cast(ite.cubagem_esp_revest_1 as varchar(20)) end as varchar(20) ) as cubagem_resvestimento_1,' + #13#10 +
        '                 cast( case ' + #13#10 +
        '                    when (coalesce(gru.id_item_bloco_espuma_revest_2) <> 0) and ' + #13#10 +
        '                         (coalesce(ite.cubagem_esp_revest_2,0) = 0) then ''Precisa preencher''' + #13#10 +
        '                 else' + #13#10 +
        '                    cast(ite.cubagem_esp_revest_2 as varchar(20)) end as varchar(20) ) as cubagem_resvestimento_2' + #13#10 +
        '          				' + #13#10 +
        '           from pcp_tb_m_opr_opp opp   ' + #13#10 +
        '             inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr' + #13#10 +
        '             left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item' + #13#10 +
        '             left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo' + #13#10 +
        '           where   ' + #13#10 +
        '             opr.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
        '             coalesce(ite.sgq_personalizado, false) = false' + #13#10 +
        '             and gru.sgq_calc_bloco_produzir = true' + #13#10 +
        '             and opp.id_opr = ''' + VarToStr(Input[1]) +'''  ' + #13#10 +        '             and opp.bloco_gerado = 1' + #13#10 +
        '          ' + #13#10 +
        '           order by 1,2' + #13#10 +
        '      ) ttt ' + #13#10 +
        '       where ttt.cubagem1 = ''Precisa preencher''' + #13#10 +
        '       or ttt.cubagem2 = ''Precisa preencher''' + #13#10 +
        '       or ttt.cubagem3 = ''Precisa preencher''' + #13#10 +
        '       or ttt.cubagem_resvestimento_1 = ''Precisa preencher''' + #13#10 +
        '       or ttt.cubagem_resvestimento_2 = ''Precisa preencher''' + #13#10 +
        '       group by 1,2,3,4,5,6,7' + #13#10 +
        '       order by 2' ;


    {


      ' select ttt.id_item, ttt.descricao, ttt.cubagem1, ttt.cubagem2, ttt.cubagem3 from ' + #13#10 +
          ' (select opp.id_item, ite.descricao, ite.id_grupo, opp.id_cor, opp.id_tamanho, ' + #13#10 +
          '       gru.id_item_bloco_espuma,' + #13#10 +
          '       gru.id_item_bloco_espuma_2,' + #13#10 +
          '       gru.id_item_bloco_espuma_3,' + #13#10 +
          '	' + #13#10 +
          '			 cast( case ' + #13#10 +
          '          when (coalesce(gru.id_item_bloco_espuma) <> 0) and ' + #13#10 +
          '               (coalesce(ite.cubagem_esp_1,0) = 0) then ''Precisa preencher''' + #13#10 +
          '       else' + #13#10 +
          '          cast(ite.cubagem_esp_1 as varchar(20)) end as varchar(20) ) as cubagem1,' + #13#10 +
          '       cast(case ' + #13#10 +
          '          when (coalesce(gru.id_item_bloco_espuma_2) <> 0) and ' + #13#10 +
          '               (coalesce(ite.cubagem_esp_2,0) = 0) then ''Precisa preencher''' + #13#10 +
          '       else' + #13#10 +
          '          cast(ite.cubagem_esp_2 as varchar(20)) end as varchar(20) ) as cubagem2,' + #13#10 +
          '       ' + #13#10 +
          '       cast( case ' + #13#10 +
          '          when (coalesce(gru.id_item_bloco_espuma_3) <> 0) and ' + #13#10 +
          '               (coalesce(ite.cubagem_esp_3,0) = 0) then ''Precisa preencher''' + #13#10 +
          '       else' + #13#10 +
          '          cast(ite.cubagem_esp_3 as varchar(20)) end as varchar(20) ) as cubagem3' + #13#10 +
          '				' + #13#10 +
          ' from pcp_tb_m_opr_opp opp    ' + #13#10 +
          '   inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item' + #13#10 +
          '   left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          ' where   ' + #13#10 +
          '   opr.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
          '   coalesce(ite.sgq_personalizado, false) = false' + #13#10 +
          '   and gru.sgq_calc_bloco_produzir = true' + #13#10 +
          '   and opp.id_opr = ''' + VarToStr(Input[1]) +'''  ' + #13#10 +
          '   and opp.bloco_gerado = 1' + #13#10 +
          //'   --and opp.qtde_a_produzir > 0   ' + #13#10 +
          ' order by 1,2' + #13#10 +
      ') ttt ' + #13#10 +
      ' where ttt.cubagem1 = ''Precisa preencher''' + #13#10 +
      ' or ttt.cubagem2 = ''Precisa preencher''' + #13#10 +
      ' or ttt.cubagem3 = ''Precisa preencher''' + #13#10 +
      ' group by 1,2,3,4,5' + #13#10 +
      ' order by 2';         }
  end;
begin
   BUS_SQ_M_OPR_ITE_SCB.Close;

   BUS_SQ_M_OPR_ITE_SCB.CommandText := enSqlPcpOprIteScb;

   Result := BUS_DP_M_OPR_ITE_SCB.Data;
end;

function TSM.BUS_DP_M_OPR_GER_OPBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOprGerOpb: String;
  begin
    Result :=

          ' select *,    ' + #13#10 +
          '    case ' + #13#10 +
          '       when cubagem_da_op >= saldo_fisico then cubagem_da_op - saldo_fisico' + #13#10 +
          '    else' + #13#10 +
          '       0 end as qtde_a_produzir,' + #13#10 +
          '    case ' + #13#10 +
          '       when cubagem_da_op >= saldo_fisico then saldo_fisico' + #13#10 +
          '    else' + #13#10 +
          '       cubagem_da_op end as qtde_a_abater_no_sld' + #13#10 +
          '  ' + #13#10 +

          '    ' + #13#10 +
          ' from' + #13#10 +
          '(' + #13#10 +
          'with tbtemp as  ( ' + #13#10 +
          '    select        ttt.id_item_bloco_espuma,   pp1.descricao as Bloco,       ' + #13#10 +
          '        case       when coalesce(iti.cubagem_esp_1,0) > 0           then (iti.cubagem_esp_1 * ttt.qtde)      ' + #13#10 +
          '        else       0 end as cubagem_produzir_op,' + #13#10 +
          '        coalesce(fes.saldo_fisico,0) as saldo_fisico' + #13#10 +
          '    from cad_tb_c_ite iti   ' + #13#10 +
          '       inner join   ( select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho,       ' + #13#10 +
          '                          gru.id_item_bloco_espuma,       gru.id_item_bloco_espuma_2,       gru.id_item_bloco_espuma_3,      ' + #13#10 +
          '                          sum(opp.qtde_a_produzir) as qtde from pcp_tb_m_opr_opp opp     ' + #13#10 +
          '                      inner join pcp_tb_m_opr opr      on opr.id_opr = opp.id_opr   ' + #13#10 +
          '                      left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item  ' + #13#10 +
          '                      left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          '                      where ' + #13#10 +
          '                         opr.id_empresa = ''' + VarToStr(Input[0]) +''' and    coalesce(ite.sgq_personalizado, false) = false ' + #13#10 +
          '                         and gru.sgq_calc_bloco_produzir = true   and opp.id_opr = ''' + VarToStr(Input[1]) +'''     ' + #13#10 +
          '                         and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0 ' + #13#10 +
          '                      group by  1,2,3,4,5,6,7 order by 1,2 ) ttt on ttt.id_item = iti.id_item   ' + #13#10 +
          '    left outer join cad_tb_c_ite pp1 on pp1.id_item = ttt.id_item_bloco_espuma   ' + #13#10 +
          '    left outer join est_tb_m_fes fes on fes.id_item = pp1.id_item and fes.id_cor = ''' + VarToStr(Input[2]) +'''    ' + #13#10 +
          'union all ' + #13#10 +
          '    select  ttt.id_item_bloco_espuma_2 as id_item_bloco_espuma,  ' + #13#10 +
          '            pp2.descricao as Bloco,     ' + #13#10 +
          '        case       ' + #13#10 +
          '           when coalesce(iti.cubagem_esp_2,0) > 0 then ' + #13#10 +
          '              (iti.cubagem_esp_2 * ttt.qtde)      ' + #13#10 +
          '           else 0 end as cubagem_produzir_op,' + #13#10 +
          '        coalesce(fes.saldo_fisico,0) as saldo_fisico       ' + #13#10 +
          '    from cad_tb_c_ite iti   ' + #13#10 +
          '    inner join ( select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho,        ' + #13#10 +
          '                    gru.id_item_bloco_espuma,       gru.id_item_bloco_espuma_2,      ' + #13#10 +
          '                    gru.id_item_bloco_espuma_3,       ' + #13#10 +
          '                    sum(opp.qtde_a_produzir) as qtde ' + #13#10 +
          '                 from pcp_tb_m_opr_opp opp     ' + #13#10 +
          '                     inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr   ' + #13#10 +
          '                     left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item   ' + #13#10 +
          '                     left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo   ' + #13#10 +
          '                 where    opr.id_empresa = ''' + VarToStr(Input[0]) +''' and    coalesce(ite.sgq_personalizado, false) = false  ' + #13#10 +
          '                   and gru.sgq_calc_bloco_produzir = true   and opp.id_opr = ''' + VarToStr(Input[1]) +'''  ' + #13#10 +
          '                    and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0  ' + #13#10 +
          '                 group by 1,2,3,4,5,6,7 order by 1,2 ) ttt on ttt.id_item = iti.id_item ' + #13#10 +
          '  ' + #13#10 +
          '     left outer join cad_tb_c_ite pp2 on pp2.id_item = ttt.id_item_bloco_espuma_2 ' + #13#10 +
          '     left outer join est_tb_m_fes fes on fes.id_item = pp2.id_item and fes.id_cor = ''' + VarToStr(Input[2]) +'''' + #13#10 +
          '  ' + #13#10 +
          ' ' + #13#10 +
          'union all' + #13#10 +
          ' select  ttt.id_item_bloco_espuma_3 as id_item_bloco_espuma,   pp3.descricao as Bloco,     ' + #13#10 +
          '    case      ' + #13#10 +
          '       when coalesce(iti.cubagem_esp_3,0) > 0  then (iti.cubagem_esp_3 * ttt.qtde)      ' + #13#10 +
          '     else 0 end as cubagem_produzir_op,' + #13#10 +
          '     coalesce(fes.saldo_fisico,0) as saldo_fisico    ' + #13#10 +
          ' from cad_tb_c_ite iti   ' + #13#10 +
          '      inner join ( select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho,        ' + #13#10 +
          '                        gru.id_item_bloco_espuma,       gru.id_item_bloco_espuma_2, ' + #13#10 +
          '                   gru.id_item_bloco_espuma_3,  sum(opp.qtde_a_produzir) as qtde ' + #13#10 +
          '                     from pcp_tb_m_opr_opp opp   ' + #13#10 +
          '                    inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr       ' + #13#10 +
          '                    left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item   ' + #13#10 +
          '                    left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          '                   where    opr.id_empresa = ''' + VarToStr(Input[0]) +''' and    coalesce(ite.sgq_personalizado, false) = false  ' + #13#10 +
          '                     and gru.sgq_calc_bloco_produzir = true   and opp.id_opr = ''' + VarToStr(Input[1]) +'''    ' + #13#10 +
          '                     and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0 ' + #13#10 +
          '                   group by 1,2,3,4,5,6,7 order by 1,2 ) ttt on ttt.id_item = iti.id_item     ' + #13#10 +
          '      left outer join cad_tb_c_ite pp3 on pp3.id_item = ttt.id_item_bloco_espuma_3' + #13#10 +
          '      left outer join est_tb_m_fes fes on fes.id_item = pp3.id_item and fes.id_cor = ''' + VarToStr(Input[2]) +''' ) ' + #13#10 +
          ' ' + #13#10 +
          '  select id_item_bloco_espuma, ite.cubagem_esp_1, bloco, saldo_fisico, sum(mmm.cubagem_produzir_op) cubagem_da_op from tbTemp mmm     ' + #13#10 +
          '     left outer join cad_tb_c_ite ite on ite.id_item = mmm.id_item_bloco_espuma ' + #13#10 +
          '   where bloco is not null group by 1,2,3,4' + #13#10 +
          ') ppp'


    {  'with tbtemp as  (' + #13#10 +
          ' select  ' + #13#10 +
          '   ' + #13#10 +
          '   ttt.id_item_bloco_espuma,' + #13#10 +
          '   pp1.descricao as Bloco,  ' + #13#10 +
          '   ' + #13#10 +
          '   case ' + #13#10 +
          '      when coalesce(iti.cubagem_esp_1,0) > 0 ' + #13#10 +
          '          then (iti.cubagem_esp_1 * ttt.qtde)    ' + #13#10 +
          '   else ' + #13#10 +
          '      0 end as cubagem' + #13#10 +
          '   ' + #13#10 +
          '  ' + #13#10 +
          ' from cad_tb_c_ite iti' + #13#10 +
          '   inner join (' + #13#10 +
          ' select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho, ' + #13#10 +
          '       gru.id_item_bloco_espuma,' + #13#10 +
          '       gru.id_item_bloco_espuma_2,' + #13#10 +
          '       gru.id_item_bloco_espuma_3,' + #13#10 +
          '       sum(opp.qtde_a_produzir) as qtde' + #13#10 +
          ' from pcp_tb_m_opr_opp opp    ' + #13#10 +
          '   inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item' + #13#10 +
          '   left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          ' where   ' + #13#10 +
          '   opr.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
          '   coalesce(ite.sgq_personalizado, false) = false' + #13#10 +
          '   and gru.sgq_calc_bloco_produzir = true' + #13#10 +
          '   and opp.id_opr = ''' + VarToStr(Input[1]) +'''  ' + #13#10 +
          '   and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0 ' +
          ' group by 1,2,3,4,5,6,7' + #13#10 +
          ' order by 1,2' + #13#10 +
          ' ) ttt on ttt.id_item = iti.id_item' + #13#10 +
          '   left outer join cad_tb_c_ite pp1 on pp1.id_item = ttt.id_item_bloco_espuma' + #13#10 +
          '   left outer join cad_tb_c_ite pp2 on pp2.id_item = ttt.id_item_bloco_espuma_2' + #13#10 +
          '   left outer join cad_tb_c_ite pp3 on pp3.id_item = ttt.id_item_bloco_espuma_3' + #13#10 +
          '   union all' + #13#10 +
          ' select     ' + #13#10 +
          '   ttt.id_item_bloco_espuma_2 as id_item_bloco_espuma,' + #13#10 +
          '   pp2.descricao as Bloco,   ' + #13#10 +
          '   case ' + #13#10 +
          '      when coalesce(iti.cubagem_esp_2,0) > 0 ' + #13#10 +
          '          then (iti.cubagem_esp_2 * ttt.qtde)   ' + #13#10 +
          '   else 0 end as cubagem' + #13#10 +
          '   ' + #13#10 +
          '   ' + #13#10 +
          ' from cad_tb_c_ite iti' + #13#10 +
          '   inner join (' + #13#10 +
          ' select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho, ' + #13#10 +
          '       gru.id_item_bloco_espuma,' + #13#10 +
          '       gru.id_item_bloco_espuma_2,' + #13#10 +
          '       gru.id_item_bloco_espuma_3,' + #13#10 +
          '       sum(opp.qtde_a_produzir) as qtde' + #13#10 +
          ' from pcp_tb_m_opr_opp opp    ' + #13#10 +
          '   inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item' + #13#10 +
          '   left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          ' where ' + #13#10 +
          '   opr.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
          '   coalesce(ite.sgq_personalizado, false) = false' + #13#10 +
          '   and gru.sgq_calc_bloco_produzir = true' + #13#10 +
          '   and opp.id_opr = ''' + VarToStr(Input[1]) +''' ' + #13#10 +
          '   and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0 ' +
          ' group by 1,2,3,4,5,6,7' + #13#10 +
          ' order by 1,2' + #13#10 +
          ' ) ttt on ttt.id_item = iti.id_item' + #13#10 +
          ' left outer join cad_tb_c_ite pp1 on pp1.id_item = ttt.id_item_bloco_espuma' + #13#10 +
          ' left outer join cad_tb_c_ite pp2 on pp2.id_item = ttt.id_item_bloco_espuma_2' + #13#10 +
          ' left outer join cad_tb_c_ite pp3 on pp3.id_item = ttt.id_item_bloco_espuma_3' + #13#10 +
          ' union all' + #13#10 +
          ' select     ' + #13#10 +
          '   ttt.id_item_bloco_espuma_3 as id_item_bloco_espuma,' + #13#10 +
          '   pp3.descricao as Bloco,   ' + #13#10 +
          '   case ' + #13#10 +
          '      when coalesce(iti.cubagem_esp_3,0) > 0 ' + #13#10 +
          '          then (iti.cubagem_esp_3 * ttt.qtde)   ' + #13#10 +
          '   else 0 end as cubagem' + #13#10 +
          '   ' + #13#10 +
          '   ' + #13#10 +
          ' from cad_tb_c_ite iti' + #13#10 +
          '   inner join (' + #13#10 +
          ' select opp.id_item, ite.id_grupo, opp.id_cor, opp.id_tamanho, ' + #13#10 +
          '       gru.id_item_bloco_espuma,' + #13#10 +
          '       gru.id_item_bloco_espuma_2,' + #13#10 +
          '       gru.id_item_bloco_espuma_3,' + #13#10 +
          '       sum(opp.qtde_a_produzir) as qtde' + #13#10 +
          ' from pcp_tb_m_opr_opp opp' + #13#10 +
          '   inner join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr    ' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item   = opp.id_item' + #13#10 +
          '   left outer join cad_tb_c_gru gru on gru.id_grupo  = ite.id_grupo  ' + #13#10 +
          ' where ' + #13#10 +
          '   opr.id_empresa = ''' + VarToStr(Input[0]) +''' and ' + #13#10 +
          '   coalesce(ite.sgq_personalizado, false) = false' + #13#10 +
          '   and gru.sgq_calc_bloco_produzir = true' + #13#10 +
          '   and opp.id_opr = ''' + VarToStr(Input[1]) +''' ' + #13#10 +
          '   and opp.bloco_gerado = 1 and opp.qtde_a_produzir > 0 ' +
          ' group by 1,2,3,4,5,6,7' + #13#10 +
          ' order by 1,2' + #13#10 +
          ' ) ttt on ttt.id_item = iti.id_item' + #13#10 +
          '  left outer join cad_tb_c_ite pp1 on pp1.id_item = ttt.id_item_bloco_espuma'   + #13#10 +
          '  left outer join cad_tb_c_ite pp2 on pp2.id_item = ttt.id_item_bloco_espuma_2' + #13#10 +
          '  left outer join cad_tb_c_ite pp3 on pp3.id_item = ttt.id_item_bloco_espuma_3' + #13#10 +
          ' ) ' +
      ' select id_item_bloco_espuma, bloco, sum(mmm.cubagem) cubagem_a_produzir from tbTemp mmm ' + #13#10 +
      '    left outer join cad_tb_c_ite ite on ite.id_item = mmm.id_item_bloco_espuma' + #13#10   +
      ' where bloco is not null' + #13#10 +
      ' group by 1,2 '; }
  end;
begin
   BUS_SQ_M_OPR_GER_OPB.Close;

   BUS_SQ_M_OPR_GER_OPB.CommandText := enSqlPcpOprGerOpb;

   Result := BUS_DP_M_OPR_GER_OPB.Data;
end;

function TSM.BUS_DP_M_OPR_OPP_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao :
   Criado em 30/06/2016
   Este mtodo tem a funo de buscar os saldos dos itens que fica
   nas OPR em aberta ou iniciada }

   BUS_SQ_M_OPR_OPP_INT.Close;

   BUS_SQ_M_OPR_OPP_INT.CommandText :=
          ' select ' + #13#10 +
          '   cast(''N'' as char(1))  as  int_novoreg,  opp.*,' + #13#10 +
          '   opr.id_empresa,' + #13#10 +
          ' cast( case ' +
          '    when  coalesce(opp.pcp_desc_item_person,'''') <> '''' then opp.pcp_desc_item_person ' +
          ' else ite.descricao end as varchar(150)) as int_nomeite,  ' +
          '   ite.id_und_venda as int_undvenda, ' + #13#10 +
          '   cor.descricao    as int_nomecor,' + #13#10 +
          '   tam.descricao    as int_nometam,' + #13#10 +
          '   opp.saldo_disponivel,   fun.nome as int_nomeres_man ' + #13#10 +
          ' from pcp_tb_m_opr_opp opp' + #13#10 +
          '     left outer join pcp_tb_m_opr opr on (opr.id_opr = opp.id_opr)' + #13#10 +
          '     left outer join cad_tb_c_ite ite on ite.id_item      = opp.id_item' + #13#10 +
          '     left outer join cad_tb_c_cor cor on cor.id_cor     = opp.id_cor' + #13#10 +
          '     left outer join cad_tb_c_tam tam on tam.id_tamanho = opp.id_tamanho ' + #13#10 +
          '     left outer join cad_tb_c_fun fun on fun.id_funcionario = opp.id_resp_man ' + #13#10 +
          ' where 1 = 1' ;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              ' and opp.saldo_disponivel > 0 ' +
              ' and opp.id_item in (' + VarToStr(Input[2]) +') ' +
              ' and opp.id_cor  in (' + VarToStr(Input[3]) +') ' +
              ' and opp.id_tamanho in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              ' and opr.id_opr <>     ''' + VarToStr(Input[2]) +''' ' +
              ' and opp.saldo_disponivel > 0 ' +
              ' and opp.id_item in (' + VarToStr(Input[3]) +') ' +
              ' and opp.id_cor  in (' + VarToStr(Input[4]) +') ' +
              ' and opp.id_tamanho in (' + VarToStr(Input[5]) +') ';
      end;

   if Input[0] = 2 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              ' and opr.id_opr <>     ''' + VarToStr(Input[2]) +''' ' +
              ' and opp.saldo_disponivel > 0 ' +
              ' and opp.id_item in (' + VarToStr(Input[2]) +') ' +
              ' and opp.id_cor  in (' + VarToStr(Input[3]) +') ' +
              ' and opp.id_tamanho in (' + VarToStr(Input[4]) +') ';
      end;

    if Input[0] = 3 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              ' and opr.id_opr in (' + VarToStr(Input[2]) +') ' +
              ' and opp.qtde_a_produzir > 0 ' +
              ' and opp.qtde_a_produzir <> opp.qtde_produzida ';
      end;

     if Input[0] = 4 then
        begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
                ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                ' and opr.id_opr = ''' + VarToStr(Input[2]) +''' ' +
                ' and opp.id_item = ''' + VarToStr(Input[3]) +''' ' +
                ' and opp.id_cor = ''' + VarToStr(Input[4]) +''' ' +
                ' and opp.id_tamanho = ''' + VarToStr(Input[5]) +''' ' +
                ' and opp.qtde_a_produzir > 0 ';
        end;

     if Input[0] = 5 then
        begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
                ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                ' and opr.id_opr = ''' + VarToStr(Input[2]) +''' ' +
                ' and opp.gerado_aut = false ';
        end;

     if Input[0] = 6 then
        begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
                ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                ' and opr.id_opr >= ''' + VarToStr(Input[2]) +''' ';
        end;

     if Input[0] = 7 then
        begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
                ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                ' and opp.qtde_a_produzir > 0 ' +
                ' and opp.qtde_a_produzir <> opp.qtde_produzida ';
        end;

     if Input[0] = 8 then
        begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
                ' and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                ' and opr.id_opr = ''' + VarToStr(Input[2]) +''' ' +
                ' and opp.bloco_gerado = 1 ';
                // ' and opp.qtde_a_produzir > 0 ' +
                // ' and opp.qtde_produzida = 0 ';
        end;


   if Input[0] = 0 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' order by ite.descricao,cor.descricao,tam.descricao,opr.dta_emissao,opr.id_opr,opp.saldo_disponivel ' ;
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' order by opr.dta_emissao,opr.id_opr,opp.saldo_disponivel ' ;
      end;

    if Input[0] = 6 then
       begin
          BUS_SQ_M_OPR_OPP_INT.CommandText := BUS_SQ_M_OPR_OPP_INT.CommandText  +
              ' order by opr.id_opr,ite.descricao,cor.descricao,tam.descricao ' ;
       end;

   Result := BUS_DP_M_OPR_OPP_INT.Data;

   BUS_SQ_M_OPR_OPP_INT.Close;
end;

function TSM.BUS_DP_M_OPR_OPP_SOPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlOprOppSop: String;
begin
  { TODO -oMaxsuel -cCriao : Criado em 21/07/2016 }

   enSqlOprOppSop :=  ' select sop.*,                                   ' +
                      '    opx.dta_emissao as int_opx_dtaemissao        ' +
                      ' from pcp_tb_m_opr_opp_sop sop                   ' +
                      '    left outer join pcp_tb_m_opr opx on          ' +
                      '                   (opx.id_opr = sop.id_opr_ext) ' ;

   BUS_SQ_M_OPR_OPP_SOP.Close;

   if Input[0] = 0 then
      begin
         BUS_SQ_M_OPR_OPP_SOP.CommandText := enSqlOprOppSop +
               ' where sop.id_opr = ''' + VarToStr(Input[1]) +''' ' +
               '   and sop.id_opr_opp = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := BUS_DP_M_OPR_OPP_SOP.Data;

   BUS_SQ_M_OPR_OPP_SOP.close;
end;

function TSM.BUS_DP_M_OPR_PED_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlOprPed: String;
begin
  { TODO -oMaxsuel -cCriao : Criado em 15/07/2016 }

   enSqlOprPed := 'select * from pcp_tb_m_opr_ped opd ';

   BUS_SQ_M_OPR_PED_INT.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_OPR_PED_INT.CommandText := enSqlOprPed + ' WHERE 1 = 2 '
        else
           BUS_SQ_M_OPR_PED_INT.CommandText := enSqlOprPed +
               ' where opd.id_opr = ''' + VarToStr(Input[1]) +''' ';
      end;

    if Input[0] = 1 then
      begin
         BUS_SQ_M_OPR_PED_INT.CommandText := enSqlOprPed +
               ' where opd.id_opr = ''' + VarToStr(Input[1]) +''' ' +
               '   and opd.id_pedido = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := BUS_DP_M_OPR_PED_INT.Data;

   BUS_SQ_M_OPR_PED_INT.close;
end;

function TSM.BUS_DP_M_OPR_QTD_ITE_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlQtdItePed: String;
  begin
    Result :=
            ' select ped.id_pedido, ped.dta_pedido,fun.nome as int_nomefun ,cubagem, sum(coalesce(qtde,0)) as qtde_total' + #13#10 +
            ' from  fat_tb_m_ped_ite pid' + #13#10 +
            '   left outer join fat_tb_m_ped ped on ped.id_pedido = pid.id_pedido' + #13#10 +
            '   left outer join pcp_tb_m_opr  opr on opr.id_opr = ped.pcp_id_opr' + #13#10 +
            '   left outer join cad_tb_c_fun fun on fun.id_funcionario = ped.id_vendedor' ;
  end;
begin

   BUS_SQ_M_OPR_QTD_ITE_PED.Close;
   BUS_SQ_M_OPR_QTD_ITE_PED.CommandText := enSqlQtdItePed;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_OPR_QTD_ITE_PED.CommandText := BUS_SQ_M_OPR_QTD_ITE_PED.CommandText +
           //' where ped.situacao = 2 and ped.situacao_aprovacao = 1 ' +
           ' where ped.situacao = 2 and ped.situacao_aprovacao <> 2 ' +
           '   and opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           '   and opr.id_opr = ''' +  VarToStr(Input[2]) + ''' ' ;

      end;
   BUS_SQ_M_OPR_QTD_ITE_PED.CommandText := BUS_SQ_M_OPR_QTD_ITE_PED.CommandText +
      ' group by 1,2,3,4' +
      ' order by 2,1 ' ;
   Result := BUS_DP_M_OPR_QTD_ITE_PED.Data;
   BUS_SQ_M_OPR_QTD_ITE_PED.Close;
end;

function TSM.BUS_DP_M_OPR_QTD_TOT_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlQtdTotIte: String;
  begin
    Result :=
            'select pid.id_item, ite.descricao as int_nomeite, ite.id_und_venda, pid.id_cor, cor.descricao as int_nomecor,' + #13#10 +
            '       pid.id_tamanho, tam.descricao as int_nometam, sum(coalesce(qtde,0)) as qtde_total' + #13#10 +
            'from  fat_tb_m_ped_ite pid' + #13#10 +
            '   left outer join fat_tb_m_ped ped on ped.id_pedido = pid.id_pedido' + #13#10 +
            '   left outer join pcp_tb_m_opr  opr on opr.id_opr = ped.pcp_id_opr ' + #13#10 +
            '   left outer join cad_tb_c_ite ite on ite.id_item = pid.id_item' + #13#10 +
            '   left outer join cad_tb_c_cor cor on cor.id_cor = pid.id_cor ' + #13#10 +
            '   left outer join cad_tb_c_tam tam on tam.id_tamanho = pid.id_tamanho' + #13#10 ;
  end;
begin

   BUS_SQ_M_OPR_QTD_TOT_ITE.Close;
   BUS_SQ_M_OPR_QTD_TOT_ITE.CommandText := enSqlQtdTotIte;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_OPR_QTD_TOT_ITE.CommandText := BUS_SQ_M_OPR_QTD_TOT_ITE.CommandText +
          //' where ped.situacao = 2 and ped.situacao_aprovacao = 1 ' +
          ' where ped.situacao = 2 and ped.situacao_aprovacao <> 2 ' +
          '    and  opr.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           '   and opr.id_opr = ''' +  VarToStr(Input[2]) + ''' ' ;

      end;
   BUS_SQ_M_OPR_QTD_TOT_ITE.CommandText := BUS_SQ_M_OPR_QTD_TOT_ITE.CommandText +
      ' group by 1,2,3,4,5,6,7 ' +
      ' order by 1,5';
   Result := BUS_DP_M_OPR_QTD_TOT_ITE.Data;
   BUS_SQ_M_OPR_QTD_TOT_ITE.Close;
end;

function TSM.BUS_DP_M_OPR_REQ_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

   BUS_SQ_M_OPR_REQ_ITE.Close;

   BUS_SQ_M_OPR_REQ_ITE.CommandText :=

              ' select rqi.* ,' + #13#10 +
              '   ite.descricao as int_nomeite,' + #13#10 +
              '   cor.descricao as int_nomecor,' + #13#10 +
              '   tam.descricao as int_nometam,' + #13#10 +
              '   fun.nome as int_nomefuncanc,' + #13#10 +
              '   ite.id_und_venda as int_undvenda,' + #13#10 +
              '   str.descricao as int_nomestr,  (qtde - qtde_atendida) as int_saldo, 0.0000 as int_conferido  ' + #13#10 +
              ' from pcp_tb_m_opr_req_ite rqi' + #13#10 +
              '   left outer join pcp_tb_m_opr_req req on (req.id_opr_req = rqi.id_opr_req)' + #13#10 +
              '   left outer join cad_tb_c_ite ite on (ite.id_item = rqi.id_item)' + #13#10 +
              '   left outer join cad_tb_c_cor cor on (cor.id_cor = rqi.id_cor)' + #13#10 +
              '   left outer join cad_tb_c_tam tam on (tam.id_tamanho = rqi.id_tamanho)' + #13#10 +
              '   left outer join cad_tb_c_fun fun on (fun.id_funcionario = rqi.id_funcionario_canc)' + #13#10 +
              '   left outer join cad_tb_c_set str on (str.id_setor = rqi.id_setor)' + #13#10 +
              ' where 1 = 1 ' + #13#10 ;

             { '   rqi.qtde <> rqi.qtde_atendida' + #13#10 +
              ' order by  str.descricao, ite.descricao, cor.descricao,tam.descricao,' + #13#10 +
              '          rqi.num_lote';  }



   if Input[0] = 0 then
      begin
        BUS_SQ_M_OPR_REQ_ITE.CommandText := BUS_SQ_M_OPR_REQ_ITE.CommandText +
          '   and rqi.id_opr = ''' + VarToStr(Input[1]) +''' ' +
          '   and rqi.qtde <> rqi.qtde_atendida ' ;
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_OPR_REQ_ITE.CommandText := BUS_SQ_M_OPR_REQ_ITE.CommandText +
          '   and rqi.id_opr_req = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 2 then
      begin
        BUS_SQ_M_OPR_REQ_ITE.CommandText := BUS_SQ_M_OPR_REQ_ITE.CommandText +
          '   and rqi.id_opr     = ''' +  VarToStr(Input[1]) + ''' ' +
          '   and rqi.id_opr_req = ''' +  VarToStr(Input[2]) + ''' ' ;
      end;


   Result := BUS_DP_M_OPR_REQ_ITE.Data;

   BUS_SQ_M_OPR_REQ_ITE.Close;

end;

procedure TSM.BUS_DP_M_PAGBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
   FIN_RN_M_PAG.FIN_BUR_M_PAG(Sender, SourceDS, DeltaDS, UpdateKind, Applied,self);
end;

function TSM.BUS_DP_M_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPag: String;
  begin
    Result :=
        ' SELECT false as int_selecao, pag.*, CCU.descricao AS INT_NOMECUSTO,'+
        '  FON.DESCRICAO AS INT_NOMEFOR, FPG.DESCRICAO AS INT_NOMEFPG, LTO.DESCRICAO AS INT_NOMELTO, '+
        '  PCT.DESCRICAO AS INT_NOMEPCT, coalesce(NFE.NUMERO,0) AS INT_NUMERONF, PAR.EMP_FANTASIA AS INT_FANTASIA, '+

        ' cast(case                                           '+
        '     when (PAG.DTA_VENCIMENTO < CURRENT_DATE ) and   '+
        '       (PAG.vlr_saldo>0) then ''1-Vencido''          '+
        '     when (CURRENT_DATE = PAG.DTA_VENCIMENTO) and    '+
        '       (PAG.vlr_saldo>0) then ''2-Vence hoje''       '+
        '     when  (PAG.DTA_VENCIMENTO > CURRENT_DATE ) and  '+
        '        (PAG.vlr_saldo>0) then ''3-A Vencer''        '+
        '     when  (PAG.vlr_saldo = 0) then ''4-Quitado''    '+
        '  ELSE ''5-???''                                     '+
        ' end as varchar(30)) as int_situacao_titulo          '+

        ' FROM FIN_TB_M_PAG PAG '+
        '  LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
        '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
        '  LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO '+
        '  LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = PAG.ID_PLANO ' +
        '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL = PAG.ID_FISCAL  ' +
        '  LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA = PAG.ID_EMPRESA  '+
        '  LEFT OUTER JOIN CAD_TB_C_CCU CCU ON CCU.ID_CCUSTO = PAG.ID_CCUSTO  ' ;
  end;
begin

   BUS_SQ_M_PAG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_PAG.CommandText := enSqlPag + ' WHERE 1=2 '
        else
           BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.ID_TITULO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
          Format('WHERE upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.DTA_ORIGINAL = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.DTA_VENCIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.ID_PLANO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
          Format('WHERE upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 7 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
          Format('WHERE upper(LTO.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 8 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
          Format('WHERE upper(PAG.HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 90 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_ORIGINAL<>PAG.VLR_SALDO AND  PAG.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 92 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';
        if Input[2] <> '' then
          BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
             '   AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[2]) +''' ' ;

        if VarToStr(Input[3])<>'' then
            BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                  ' AND PAG.ID_TITULO not in ('+VarToStr(Input[3])+' )';

      end
   else if Input[0] = 93 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '  +
             '   AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[2]) + ''' ' ;
      end
   else if Input[0] = 94 then
      begin
        // No  pra repassar a EMPRESA aqui.

        if input[2] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := enSqlPag +
                 ' WHERE  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[1]) + '''  ' +
                 '   AND EXISTS (SELECT ID_FISCAL FROM FAT_TB_M_NFE NFE ' +
                 '               WHERE NFE.ID_FISCAL = PAG.ID_FISCAL  ' +
                 '                 AND NFE.NUMERO = ' + input[2]+')' ;
           end
        else
           begin
             BUS_SQ_M_PAG.CommandText := enSqlPag +
                 ' WHERE  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[1]) + ''' ' ;
           end;
      end
   else if Input[0] = 95 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '  +
             '   AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[2]) + ''' ' +
             '   AND  PAG.ID_TITULO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 96 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' ;

        if VarToStr(Input[2]) <> '' then
           BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
              ' AND PAG.ID_TITULO NOT IN (' + VarToStr(Input[2])+ ') ';

      end
   else if Input[0] = 97 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '  AND  PAG.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
        if input[3] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                                         ' AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';
           end;
      end
   else if Input[0] = 98 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') '+
             Format(' and upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
        if input[3] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                                         ' AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';
           end;

      end
   else if Input[0] = 99 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   and  PAG.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        if input[3] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                                         ' AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';
           end;

      end
   else if Input[0] = 100 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') '+
             '   AND  PAG.DTA_VENCIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        if input[3] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                                         ' AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';
           end;
      end
   else if Input[0] = 101 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') '+
             Format(' and upper(PAG.NUM_PARCELA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
        if input[3] <> '' then
           begin
             BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                                         ' AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[2]) +''' ';
           end;
      end
   else if Input[0] = 102 then
      begin
        BUS_SQ_M_PAG.CommandText := enSqlPag +
             ' WHERE  PAG.VLR_SALDO>0 AND  PAG.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';
        if Input[2] <> '' then
          BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
             '   AND  PAG.ID_FORNECEDOR = ''' + VarToStr(Input[2]) +''' ';
        if Input[3] <> '' then
          BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
             '   AND  PAG.VLR_SALDO = '''+ VarToStr(Input[3])+''' ';

        if VarToStr(Input[4])<>'' then
            BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                  ' AND PAG.ID_TITULO not in ('+VarToStr(Input[4])+' )';
      end;




   BUS_SQ_M_PAG.CommandText := BUS_SQ_M_PAG.CommandText +
                               ' ORDER BY INT_SITUACAO_TITULO,PAG.DTA_VENCIMENTO DESC, PAG.VLR_SALDO ';
   Result := BUS_DP_M_PAG.Data;
end;

function TSM.BUS_DP_M_PAG_DIADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusPagDia: String;
  begin
    Result :=
             '  select ppg.id_baixa, ppg.dta_pagamento, ppg.id_forma_pag, fpg.descricao int_nomefpg, ' +
             '     pag.id_fornecedor, fon.descricao int_nomefor, cxa.id_conta,   ' +
             '     COALESCE(ppg.vlr_desconto,0) as vlr_desconto,   ' +
             '     COALESCE(ppg.vlr_juros,0) as vlr_juros,         ' +
             '     COALESCE(ppg.vlr_multa,0) as vlr_multa,         ' +
             '     COALESCE(ppg.vlr_pagamento,0) as vlr_pagamento, ' +
             '     COALESCE(pag.vlr_saldo,0) as vlr_saldo          ' +
             '  from fin_tb_m_pag_pag ppg                          ' +
             '     left outer join fin_tb_m_pag pag on pag.id_titulo     = ppg.id_titulo     ' +
             '     left outer join fin_tb_m_cxa cxa on cxa.id_abertura   = ppg.id_abertura   ' +
             '     left outer join cad_tb_c_for fon on fon.id_fornecedor = pag.id_fornecedor ' +
             '     left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag  = ppg.id_forma_pag  ' ;
  end;
begin
   BUS_SQ_M_PAG_DIA.Close;
   if input[0] = 0 then
      begin
         BUS_SQ_M_PAG_DIA.CommandText := enSqlBusPagDia + ' WHERE 1 = 2';
      end
   else
      begin
         BUS_SQ_M_PAG_DIA.CommandText := enSqlBusPagDia +
                                         ' WHERE PAG.ID_EMPRESA =  ''' + Input[1] +''' ' +
                                         '   AND PPG.DTA_PAGAMENTO = ''' +
                                             FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2]))) + '''  ' +
                                         '   AND PPG.ID_ABERTURA = ''' + VarToStr(Input[3]) +''' ';
      end;


   Result := BUS_DP_M_PAG_DIA.Data;

   BUS_SQ_M_PAG_DIA.Close;
end;

function TSM.BUS_DP_M_PCADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPca: String;
  begin
    Result :=
     ' select pca.*, '+
     '    fun.nome as int_nomeres '+
     ' from fat_tb_m_pca pca '+
     ' left outer join cad_tb_c_fun fun on fun.id_funcionario=pca.id_responsavel ';
  end;
begin
   { TODO -oLuan : Criado em 22/03/2016 }
   BUS_SQ_M_PCA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_PCA.CommandText := enSqlPca + ' WHERE 1=2 '
        else
           BUS_SQ_M_PCA.CommandText := enSqlPca +
             ' WHERE PCA.ID_CARREGAMENTO = ''' + VarToStr(Input[1]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_PCA.CommandText := enSqlPca +
           Format('where upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_M_PCA.CommandText := enSqlPca +
           ' WHERE PCA.DTA_CARREGAMENTO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ';
      end
   else if Input[0] = 3 then
      begin
        BUS_SQ_M_PCA.CommandText := enSqlPca +
          ' WHERE exists (select id_pedido from fat_tb_m_pca_ped where ID_CARREGAMENTO = pca.ID_CARREGAMENTO and id_pedido =  ''' + VarToStr(Input[1]) +''' ) ';
      end
   else
      if Input[0] = 4 then
         begin
            BUS_SQ_M_PCA.CommandText := enSqlPca +
                 ' WHERE PCA.seq_carreg_anual = ''' + VarToStr(Input[1]) + ''' '  +
                 '   AND extract(year from PCA.DTA_CARREGAMENTO) = ''' + VarToStr(Input[2]) + ''' ';
         end
   else if Input[0] = 90 then
      begin
        BUS_SQ_M_PCA.CommandText := enSqlPca +' WHERE 1=1 AND PCA.STATUS = ''0'' ';
        if (Input[1] <> '') then
          begin
           BUS_SQ_M_PCA.CommandText := BUS_SQ_M_PCA.CommandText +
           ' AND PCA.DTA_CARREGAMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' '+
           ' AND PCA.DTA_CARREGAMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
          end;
        if (Input[3] <> '') then
          begin
            BUS_SQ_M_PCA.CommandText := BUS_SQ_M_PCA.CommandText +
            ' AND PCA.ID_CARREGAMENTO = ''' + VarToStr(Input[3]) + ''' ';
          end;
      end;

   Result := BUS_DP_M_PCA.Data;

end;

function TSM.BUS_DP_M_PCA_PED_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPedIte: String;
  begin
   Result :=
    ' select pit.*,ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda from fat_tb_m_ped_ite pit '+
    ' left outer join cad_tb_c_ite ite on ite.id_item=pit.id_item '+
    ' where 1=1 ';
  end;
begin
   { TODO -oLuan : Criado em 07/11/2017 }
   BUS_SQ_M_PCA_PED_ITE.Close;
   if Input[0] = 0 then
      begin
       BUS_SQ_M_PCA_PED_ITE.CommandText := enSqlPedIte +
         ' AND PIT.ID_PEDIDO = ''' + VarToStr(Input[1]) + ''' '+
         ' ORDER BY INT_NOMEITE ';
      end;
   Result := BUS_DP_M_PCA_PED_ITE.Data;
end;

function TSM.BUS_DP_M_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatPed: String;
  begin
    Result :=
        'SELECT false as int_selecao, PED.*, CLI.NOME AS INT_NOMECLI, TME.DESCRICAO AS INT_NOMETME, '+
        '       FUN.NOME AS INT_NOMEFUN, CPG.DESCRICAO AS INT_NOMECPG, '+
        '       ATE.NOME AS INT_NOMEATE, RES.NOME AS INT_NOMERES,FNC.NOME AS INT_NOME_RCN, '+
        '       CID.NOME AS INT_NOMECID, '+
        '       CID.UF AS INT_NOMEEST, CLI.doc_cnpj_cpf AS INT_CPFCNPJ, CLI.pessoa as int_pessoacli, '+
        '       FPI.NOME AS INT_NOMEPRI_IMPRES,  FSI.NOME AS INT_NOMESEG_IMPRES, ' +
        '       FTI.NOME AS INT_NOMETER_IMPRES,                                  ' +
        '       CLI.ID_PERFIL_CLI AS INT_ID_PERFIL, '+
        '       ORS.ID_ORS, '+
        ' cast( case ped.situacao_aprovacao ' +
        '   when 0 then ''Em espera'' '+
        '   when 1 then ''Aprovado'' ' +
        '   when 2 then ''Reprovado'' ' +
        ' end as varchar(20) ) as int_sitaprov, ' +
        ' cast( case ped.situacao     ' +
        '   when 0 then ''Em aberto'' ' +
        '   when 1 then ''Reprovado'' ' +
        '   when 2 then ''Em produo'' ' +
        '   when 3 then ''Faturado''  ' +
        '   when 4 then ''Cancelado'' ' +
        ' end as varchar(20) ) as int_sitped, ' +
        ' cast( case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''' + #13#10 +
        '           when (ped.situacao = 1) then ''Reprovado''' + #13#10 +
        '           when (ped.situacao = 2) then ''Em produo''' + #13#10 +
        '           when (ped.situacao = 3) then ''Faturado''' + #13#10 +
        '           when (ped.situacao = 4) then ''Cancelado''' + #13#10 +
        '         end as varchar(20) ) as int_sitped2, ' +
        ' cli.doc_ie_identidade as int_ie_rg_cli, reg.descricao as int_nomereg, OPR.NUM_LOTE as int_num_lote_opr ' +
        ' FROM FAT_TB_M_PED PED '+
        ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = PED.ID_CLIENTE '+
        ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE = PED.ID_TIPO_MOV_ESTOQUE '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=PED.ID_VENDEDOR '+
        ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=PED.ID_CONDICAO_PAG '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=PED.ID_ATENDENTE '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN RES ON RES.ID_FUNCIONARIO=PED.ID_RESPONSAVEL '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN FNC ON FNC.ID_FUNCIONARIO=PED.ID_RESP_CONF '+

        'LEFT OUTER JOIN CAD_TB_C_FUN FPI ON FPI.ID_FUNCIONARIO=PED.id_func_pri_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FSI ON FSI.ID_FUNCIONARIO=PED.id_func_seg_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FTI ON FTI.ID_FUNCIONARIO=PED.id_func_ter_impressao ' +

        ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
        ' LEFT OUTER JOIN PCP_TB_M_ORS ORS ON ORS.ID_PEDIDO=PED.ID_PEDIDO ' +
        ' LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO = CLI.ID_REGIAO ' +
        ' LEFT OUTER JOIN PCP_TB_M_OPR OPR ON OPR.ID_OPR = PED.PCP_ID_OPR ';

  end;
 var
   CondicaoOrder:string;
begin
   CondicaoOrder := '';
   BUS_SQ_M_PED.Close;


   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_PED.CommandText := enSqlFatPed + ' WHERE 1 = 2 '
        else
           BUS_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ';

      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_PED.CommandText := enSqlFatPed +
            ' WHERE PED.ID_EMPRESA =  ''' + VarToStr(Input[1]) + ''' ' +
            '   AND PED.SITUACAO = 2 AND PED.SITUACAO_APROVACAO <> 2 ' +
            ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ' ;
      end;

   if Input[0] = 2 then
      begin
        BUS_SQ_M_PED.CommandText := enSqlFatPed +
            ' WHERE PED.ID_EMPRESA  =  ''' + VarToStr(Input[1]) + ''' ' +
            '   AND OPR.NUM_LOTE  =  ''' + VarToStr(Input[2]) +  ''' ' +
            '   AND PED.SITUACAO    = 2 AND PED.SITUACAO_APROVACAO <> 2 ' +
            ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ' ;
      end;

   if Input[0] = 3 then
      begin
        BUS_SQ_M_PED.CommandText := enSqlFatPed +
            ' WHERE PED.ID_EMPRESA =  ''' + VarToStr(Input[1]) +  ''' ' +
            '   AND PED.SITUACAO = 0 AND PED.SITUACAO_APROVACAO = 1 ' +
            ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ' ;
      end;

   if Input[0] = 4 then
      begin
        BUS_SQ_M_PED.CommandText := enSqlFatPed +
            ' WHERE PED.ID_EMPRESA =  ''' + VarToStr(Input[1]) +  ''' ' +
            '   AND PED.SITUACAO_APROVACAO <> 2 ' +
            '   AND PED.ID_PEDIDO IN (SELECT PID.ID_PEDIDO FROM FAT_TB_M_PED_ITE PID ' + #13#10 +
            '                            left outer join fat_tb_m_ped ppp on ppp.id_pedido = pid.id_pedido ' +
            '                         where  ppp.pcp_id_opr =  ''' + VarToStr(Input[2]) +  ''' ' +
            '                           and  pid.id_item  = ''' + VarToStr(Input[3]) +  ''' ' +
            '                           and  pid.id_cor  = ''' + VarToStr(Input[4]) +  ''' ' +
            '                           and  pid.id_tamanho  = ''' + VarToStr(Input[5]) +  ''' ' +
            '                         group by 1 ) ' +
            ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ' ;
      end;

   if Input[0] = 5 then
      begin
        BUS_SQ_M_PED.CommandText := enSqlFatPed +
            ' WHERE PED.ID_EMPRESA =  ''' + VarToStr(Input[1]) +  ''' ' +
            '   AND PED.SITUACAO = 2  AND PED.SITUACAO_APROVACAO <> 2 ' +
            '   AND PED.ID_PEDIDO IN (SELECT PID.ID_PEDIDO FROM FAT_TB_M_PED_ITE PID ' + #13#10 +
            '                            left outer join fat_tb_m_ped ppp on ppp.id_pedido = pid.id_pedido ' +
            '                         where  pid.id_item  = ''' + VarToStr(Input[2]) +  ''' ' +
            '                           and  pid.id_cor  = ''' + VarToStr(Input[3]) +  ''' ' +
            '                           and  pid.id_tamanho  = ''' + VarToStr(Input[4]) +  ''' ' +
            '                         group by 1 ) ' +
            ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ' ;
      end;

   Result := BUS_DP_M_PED.Data;

   BUS_SQ_M_PED.Close;
end;

function TSM.BUS_DP_M_PED_GERDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatPedGer: String;
  begin
    Result :=
        'SELECT false as int_selecao, PED.*, CLI.NOME AS INT_NOMECLI, TME.DESCRICAO AS INT_NOMETME, '+
        '       FUN.NOME AS INT_NOMEFUN, CPG.DESCRICAO AS INT_NOMECPG, '+
        '       ATE.NOME AS INT_NOMEATE, RES.NOME AS INT_NOMERES,FNC.NOME AS INT_NOME_RCN, '+
        '       FNL.NOME AS INT_NOMELIB, CID.NOME AS INT_NOMECID, '+
        '       CID.UF AS INT_NOMEEST, CLI.doc_cnpj_cpf AS INT_CPFCNPJ, CLI.pessoa as int_pessoacli, '+
        '       CLI.ID_PERFIL_CLI AS INT_ID_PERFIL, '+
        '       FPI.NOME AS INT_NOMEPRI_IMPRES,  FSI.NOME AS INT_NOMESEG_IMPRES, ' +
        '       FTI.NOME AS INT_NOMETER_IMPRES,                                  ' +
        '       ORS.ID_ORS, '+
        ' cast( case ped.situacao_aprovacao ' +
        '   when 0 then ''Em espera'' '+
        '   when 1 then ''Aprovado'' ' +
        '   when 2 then ''Reprovado'' ' +
        ' end as varchar(20) ) as int_sitaprov, ' +
        ' cast( case ped.situacao     ' +
        '   when 0 then ''Em aberto'' ' +
        '   when 1 then ''Reprovado'' ' +
        '   when 2 then ''Em produo'' ' +
        '   when 3 then ''Faturado''  ' +
        '   when 4 then ''Cancelado'' ' +
        ' end as varchar(20) ) as int_sitped, ' +
        ' cast( case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''' + #13#10 +
        '           when (ped.situacao = 1) then ''Reprovado''' + #13#10 +
        '           when (ped.situacao = 2) then ''Em produo''' + #13#10 +
        '           when (ped.situacao = 3) then ''Faturado''' + #13#10 +
        '           when (ped.situacao = 4) then ''Cancelado''' + #13#10 +
        '         end as varchar(20) ) as int_sitped2, ' +

        '  case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then 1 '+ #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then 2 '+ #13#10 +
        '           when (ped.situacao = 2) then 3 '+ #13#10 +
        '           when (ped.situacao = 3) then 4 ' + #13#10 +
        '           when (ped.situacao = 4) then 5 '+ #13#10 +
        '           when (ped.situacao = 1) then 6 ' + #13#10 +
        '         end  as int_sitOrd, ' +

        ' cli.doc_ie_identidade as int_ie_rg_cli, reg.descricao as int_nomereg,  ' +
        ' fun.tel_movel as  int_telmovel_ven, fun.tel_fixo as int_telfixo_ven, ' +
        ' mta.nome as int_nomemta,  '+
 //       '       (lpad(CAST(EXTRACT(HOUR FROM PED.HOR_PEDIDO) as varchar(2)),2,'''+'0'+''')||'''+':'+'''|| '+
 //       '       lpad(CAST(EXTRACT(MINUTE FROM PED.HOR_PEDIDO) as varchar(2)),2,'''+'0'+''')) AS INT_HORA '+
        ' OPR.num_lote as int_numloteopr ' +
        'FROM FAT_TB_M_PED PED '+
        'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = PED.ID_CLIENTE '+
        'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE = PED.ID_TIPO_MOV_ESTOQUE '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=PED.ID_VENDEDOR '+
        'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=PED.ID_CONDICAO_PAG '+
        'LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=PED.ID_ATENDENTE '+
        'LEFT OUTER JOIN CAD_TB_C_FUN RES ON RES.ID_FUNCIONARIO=PED.ID_RESPONSAVEL '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FNC ON FNC.ID_FUNCIONARIO=PED.ID_RESP_CONF '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FNL ON FNL.ID_FUNCIONARIO=PED.ID_USUARIO_LIB '+

        'LEFT OUTER JOIN CAD_TB_C_FUN FPI ON FPI.ID_FUNCIONARIO=PED.id_func_pri_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FSI ON FSI.ID_FUNCIONARIO=PED.id_func_seg_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FTI ON FTI.ID_FUNCIONARIO=PED.id_func_ter_impressao ' +

        'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
        'LEFT OUTER JOIN PCP_TB_M_ORS ORS ON ORS.ID_PEDIDO=PED.ID_PEDIDO ' +
        'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO = CLI.ID_REGIAO ' +
        'LEFT OUTER JOIN PCP_TB_M_OPR OPR ON ' +
        '           (OPR.ID_EMPRESA = PED.ID_EMPRESA AND OPR.ID_OPR = PED.PCP_ID_OPR) '+
        'LEFT OUTER JOIN PCP_TB_C_MTA MTA ON  MTA.ID_MOTORISTA = PED.ID_MOTORISTA ';



  end;
 var
   CondicaoOrder:string;
begin
   CondicaoOrder := '';
   BUS_SQ_M_PED_GER.Close;

    case Input[0] of
       0: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       1: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       2: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';//' ORDER BY PED.SITUACAO_APROVACAO ';
       3: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       4: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       5: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       6: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       7: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
      11: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
    end;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_PED_GER.CommandText := enSqlFatPedGer + ' WHERE 1 = 2 '
        else
           BUS_SQ_M_PED_GER.CommandText := enSqlFatPedGer +
             ' WHERE PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ' +
              CondicaoOrder;
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_M_PED_GER.CommandText := enSqlFatPedGer +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                         CondicaoOrder;
      end;

   Result := BUS_DP_M_PED_GER.Data;
end;

function TSM.BUS_DP_M_PED_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  BUS_SQ_M_PED_INT.Close;
  BUS_SQ_M_PED_INT.CommandText := ' select * from fat_tb_m_ped ped ';
  if Input[0] = 0 then
     begin
       BUS_SQ_M_PED_INT.CommandText :=  BUS_SQ_M_PED_INT.CommandText +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND PED.ID_PEDIDO in ('+ VarToStr(Input[2]) + ') ';
     end;

  //CMServerForm.mm.Lines.Add(FAT_SQ_M_PED.CommandText);

   Result := BUS_DP_M_PED_INT.Data;

   BUS_SQ_M_PED_INT.Close;
end;

function TSM.BUS_DP_M_PED_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPedIteInt: String;
  begin
    Result := ' SELECT PIT.* , ' +
              '   COR.DESCRICAO AS INT_NOMECOR, ' +
              '   TAM.DESCRICAO AS INT_NOMETAM, GRU.TIPO_ITEM  AS  INT_TIPO_ITEM   ' +
              ' FROM FAT_TB_M_PED_ITE PIT ' +
              '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM = PIT.ID_ITEM ' +
              '  left outer join CAD_TB_C_GRU GRU on GRU.ID_GRUPO = ITE.ID_GRUPO ' +
              ' LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = PIT.ID_COR ' +
              ' LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO = PIT.ID_TAMANHO ';


  end;
begin
   BUS_SQ_M_PED_ITE_INT.Close;

   BUS_SQ_M_PED_ITE_INT.CommandText := enSqlPedIteInt +
       ' WHERE PIT.ID_PEDIDO =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_PED_ITE_INT.Data;
end;

function TSM.BUS_DP_M_PED_NIPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlPedNotas: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 02/07/2015
    Select utilizado pela impresso do pedido de compra }

  enSqlPedNotas :=
            '		select ' + #13#10 +
            '				nfe.numero as int_numero, ' + #13#10 +
            '				nfe.dta_emissao as int_emissaonfe    ' + #13#10 +
            '		from cmp_tb_m_ped_nfe pfe' + #13#10 +
            '				left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = pfe.id_fiscal)' + #13#10 +
            '   where pfe.id_pedido =       ''' + VarToStr(Input[0]) +''' ' +
            ' union all' + #13#10 +
            '   select iqm.numero_nf as int_numero,' + #13#10 +
            '           iqm.dta_emissao_nf as int_emissaonfe' + #13#10 +
            '   from cmp_tb_m_ped_iqm pqm' + #13#10 +
            '        left outer join fat_tb_m_iqm iqm on (iqm.id_iqm = pqm.id_iqm)' +
            '   where pqm.id_pedido =       ''' + VarToStr(Input[0]) +''' ';

   BUS_SQ_M_PED_NIP.Close;
   BUS_SQ_M_PED_NIP.CommandText := enSqlPedNotas;

   Result := BUS_DP_M_PED_NIP.Data;
   BUS_SQ_M_PED_NIP.Close;
end;

function TSM.BUS_DP_M_PED_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPedTitInt: String;
  begin
    Result := ' SELECT PTI.*  FROM FAT_TB_M_PED_TIT PTI ';
  end;
begin
   BUS_SQ_M_PED_TIT_INT.Close;

   BUS_SQ_M_PED_TIT_INT.CommandText := enSqlPedTitInt +
       ' WHERE PTI.ID_PEDIDO =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_PED_TIT_INT.Data;
end;

function TSM.BUS_DP_M_PED_TIT_SER_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPedTitInt: String;
  begin
    Result := ' SELECT PTI.*  FROM FAT_TB_M_PED_TIT_SER PTI ';
  end;
begin
   BUS_SQ_M_PED_TIT_INT.Close;

   BUS_SQ_M_PED_TIT_INT.CommandText := enSqlPedTitInt +
       ' WHERE PTI.ID_PEDIDO =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_PED_TIT_INT.Data;
end;

function TSM.BUS_DP_M_PNMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   sql: String;
   Data: TDate;
   i: integer;
begin

   { TODO -oMaxsuel -cCriao : Mtodo criado em 10/10/2015 }

   sql := '';
   BUS_SQ_M_PNM.Close;
   BUS_SQ_M_PNM.CommandText :=
              ' select orv.id_empresa ' + #13#10;

   Data := StrToDate(input[1]);

   for i := 0 to 14 do
       begin
         sql := sql + ' , coalesce(sum(case ' + #13#10   +
                '            when orv.dta_fechamento = ''' + FormatDateTime(CFormatoData, Data+i) + ''' then (orv.vlr_total) end ) / ' + #13#10 +
                '  count(case ' + #13#10 +
                '            when orv.dta_fechamento = ''' + FormatDateTime(CFormatoData, Data+i) +
                '''  then 0 end),0) as Dia' + inttostr(i+1) + ' ' + #13#10;
       end;

   BUS_SQ_M_PNM.CommandText := BUS_SQ_M_PNM.CommandText +
             sql + ' from ofi_tb_m_orv orv ' +
                   ' where orv.id_empresa = ''' + VarToStr(Input[0]) +''' ' + #13#10 +
                   '  and orv.status = 3 ' + #13#10;

   BUS_SQ_M_PNM.CommandText :=  BUS_SQ_M_PNM.CommandText +
          ' group by orv.id_empresa ' + #13#10 +
          ' order by orv.id_empresa ';
   Result := BUS_DP_M_PNM.Data;
   BUS_SQ_M_PNM.Close;
end;

function TSM.BUS_DP_M_PNODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusOfiPno: String;
  begin
    Result :=
              'select ' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '      and status_painel = 0' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguar_serv,' + #13#10 +
              '  ' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '      and status_painel = 1' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_prox_serv,' + #13#10 +
              '  ' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '      and status_painel = 2' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_em_serv,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '      and status_painel = 3' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_pre_inspec,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '     and status_painel = 4' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguard_lavagem,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 5' + #13#10 +
              '      and status in (0,1)      ' + #13#10 +
              '  ) as qtde_insp_final,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 6' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguard_aprov,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 7' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguard_peca,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 8' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguard_serv,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 9' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_pre_entrega,' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 10' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_aguard_entrega, ' + #13#10 +
              '  ' + #13#10 +
              '  ( select count(*) from ofi_tb_m_orv orv' + #13#10 +
              '    where orv.id_empresa = par.id_empresa' + #13#10 +
              '    and status_painel = 11' + #13#10 +
              '    and status in (0,1)      ' + #13#10 +
              '  ) as qtde_entregue ' + #13#10 +
              'from cad_tb_c_par par ' + #13#10 ;
  end;
begin
   BUS_SQ_M_PNO.Close;
   BUS_SQ_M_PNO.CommandText := enSqlBusOfiPno +
             ' WHERE par.id_empresa = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_PNO.Data;
   BUS_SQ_M_PNO.Close;
end;

function TSM.BUS_DP_M_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatPos: String;
  begin
    Result := ' SELECT POV.* '+
              ' FROM FAT_TB_M_POS POV '+
              ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=POV.ID_CLIENTE ';
  end;
begin
   BUS_SQ_M_POS.Close;
   if Input[0] = 0 then
      begin
        BUS_SQ_M_POS.CommandText := enSqlFatPos +
           ' WHERE POV.ID_POSVENDA =       ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        BUS_SQ_M_POS.CommandText := enSqlFatPos +
          Format('WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := BUS_DP_M_POS.Data;

end;

function TSM.BUS_DP_M_POS_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

begin
   Result := fat_rn_m_pos.bus_dr_m_pos_ite(Sender, Input, BUS_SQ_M_POS_ITE, BUS_DP_M_POS_ITE);
end;

function TSM.BUS_DP_M_POS_STADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql: String;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 01/10/2015 }

   sql :=

         ' and pos.dta_posvenda >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND '+
         '       pos.dta_posvenda <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        sql := sql +
             ' and pos.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        sql := sql +
             ' and orv.id_cliente in (' + VarToStr(Input[3]) +')';
      end;

   BUS_SQ_M_POS_STA.Close;
   BUS_SQ_M_POS_STA.CommandText :=

      ' select ' + #13#10 +
      '      ''Satisfeito'' as situacao,    ' + #13#10 +
      '      count(*) as qtde_clientes    ' + #13#10 +
      '      ' + #13#10 +
      ' from ofi_tb_m_pos pos ' + #13#10 +
      '   left outer join ofi_tb_m_orv orv on (orv.id_ordem = pos.id_ordem) ' +
      ' where situacao = 0' + #13#10 + sql +
      ' UNION all' + #13#10 +
      ' select ' + #13#10 +
      '       ''Insatisfeito'' as situacao,    ' + #13#10 +
      '      count(*) as qtde_clientes    ' + #13#10 +
      '      ' + #13#10 +
      ' from ofi_tb_m_pos pos ' + #13#10 +
      '   left outer join ofi_tb_m_orv orv on (orv.id_ordem = pos.id_ordem) ' +
      ' where situacao = 1' + #13#10 +  sql +
      ' UNION all' + #13#10 +
      ' select ' + #13#10 +
      '      ''No encontrado'' as situacao,    ' + #13#10 +
      '      count(*) as qtde_clientes    ' + #13#10 +
      '      ' + #13#10 +
      ' from ofi_tb_m_pos pos ' + #13#10 +
      '   left outer join ofi_tb_m_orv orv on (orv.id_ordem = pos.id_ordem) ' +
      ' where situacao = 2 ' +  sql;

   Result := BUS_DP_M_POS_STA.Data;

   BUS_SQ_M_POS_STA.Close;

end;

function TSM.BUS_DP_M_PRODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusPro: String;
  begin
    Result := ' select CAST(replace(formulario,''MN'',''FM'') as VARCHAR(12)) as formulario, menu,descricao,modulo '+
      'from cad_tb_c_pes_mod ';
  end;
begin
  BUS_SQ_M_PRO.Close;
   if Input[0] = 0 then
      begin
        BUS_SQ_M_PRO.CommandText := enSqlBusPro +
          Format(' WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_PRO.CommandText := enSqlBusPro +
          Format(' WHERE upper(MENU) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_M_PRO.CommandText := enSqlBusPro +
          Format(' WHERE upper(FORMULARIO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   BUS_SQ_M_PRO.CommandText := BUS_SQ_M_PRO.CommandText +
   ' GROUP BY 1,2,3,4 '+
   ' ORDER BY MENU,DESCRICAO';

   //CMServerForm.mm.Lines.Add(BUS_SQ_M_PRO.CommandText);

   Result := BUS_DP_M_PRO.Data;
   BUS_SQ_M_PRO.Close;
end;

function TSM.BUS_DP_M_RAADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusRaa: String;
  begin
    Result := ' SELECT ID_RAA, NRO_RAA FROM PCP_TB_M_RAA  ';
  end;
begin
   BUS_SQ_M_RAA.Close;
   BUS_SQ_M_RAA.CommandText := enSqlBusRaa +

'WHERE ID_EMPRESA = ''' + VarToStr(Input[0]) +''' AND '+
'      ID_RAA    <> ''' + VarToStr(Input[1]) +''' AND '+
'      NRO_RAA    = ''' + VarToStr(Input[2]) +'''  ';

   Result := BUS_DP_M_RAA.Data;
end;

function TSM.BUS_DP_M_RBX_TITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRtt: String;
  begin
    Result :=
    ' select max(rit.dta_novo_venc) as int_ult_dta_venc from fin_tb_m_rbx_tit rit ';

  end;
begin
   { TODO -oLuan : Criado em 24/09/2016
     //Utilizado quando houver exclucao da baixa atualizar a data do vencimento
     //do titulo com a data mais recente que houve em outras baixas
   }
   BUS_SQ_M_RBX_TIT.Close;

   if Input[0] = 0 then
      begin
         BUS_SQ_M_RBX_TIT.CommandText := enSqlRtt +
             ' where  '+
             ' rit.id_titulo=''' + VarToStr(Input[2]) +''' and id_baixa<>'''  + VarToStr(Input[1]) +''' ';
      end;

   Result := BUS_DP_M_RBX_TIT.Data;

end;

function TSM.BUS_DP_M_RECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlBusRec: String;
  begin
    Result :=
      ' SELECT false as int_selecao, REC.*, '+
      '  CLI.NOME AS INT_NOMECLI, '+
      '  FPG.DESCRICAO AS INT_NOMEFPG, '+
      '  FPG.DOC_IMPRESSO AS INT_DOCIMPRESSO, FPG.SGQ_PRESTACAO_CONTA AS int_fpg_sgq_presta_conta, '+
      '  LTO.DESCRICAO AS INT_NOMELTO, '+
      '  PCT.DESCRICAO AS INT_NOMEPCT, '+
      '  CTC.DESCRICAO AS INT_NOMECTCBOL, '+
      '  PAR.EMP_FANTASIA AS INT_NOMEEMP, NFE.NUMERO AS INT_NUMERONF, NFE.ID_PEDIDO_VENDA AS INT_NUMPEDVENDA, ' +
      '  NFE.ID_ORDEM AS INT_NUMORDEM, NFE.ID_ORS AS INT_ID_ORS, '+
      '  cast( case rec.origem ' +
      '    when 0 then ''Manual'' ' +
      '    when 1 then ''Baixa do contas a receber'' ' +
      '    when 2 then ''Nota fiscal de Sada'' ' +
      '    when 3 then ''Movimentao de cheque'' '+
      '    when 4 then ''Controle de Crdito do Cliente'' '+
      '  else ''?????'' end as varchar(40)) int_descorigem, ' +
      //' (CURRENT_DATE -  rec.dta_vencimento) as INT_ATRASO, '+

     { ' case '+
      ' when rec.vlr_saldo<=0 then 0 '+
      ' else (CURRENT_DATE - rec.dta_vencimento) end  as INT_ATRASO, '+ }

     { ' CASE '+
      ' when rec.vlr_saldo<=0 then '+
      '  case                      '+
      '          when pag.dta_pagamento <= rec.dta_vencimento then 0 '+
      '          when pag.dta_pagamento > rec.dta_vencimento then pag.dta_pagamento - rec.dta_vencimento '+
      '        end '+
      ' else (CURRENT_DATE - rec.dta_vencimento) end  as INT_ATRASO, '+ }


      ' COALESCE( '+
      ' (case  '+
      ' when rec.vlr_saldo<=0 then '+
      '  case  '+
      '          when pag.dta_pagamento <= rec.dta_vencimento then 0 '+
      '          when pag.dta_pagamento > rec.dta_vencimento then pag.dta_pagamento - rec.dta_vencimento '+
      '        end '+
      ' else  '+
      '      case '+
      '          when CURRENT_DATE <= rec.dta_vencimento then 0 '+
      '          when CURRENT_DATE > rec.dta_vencimento then CURRENT_DATE - rec.dta_vencimento '+
      '        end  '+
      '   end),0)  as INT_ATRASO, '+



      ' CASE '+
      '     WHEN (CURRENT_DATE -  rec.dta_vencimento)<=0 THEN rec.vlr_saldo '+
      '     WHEN (CURRENT_DATE -  rec.dta_vencimento)>0  THEN '+
      '          rec.vlr_saldo+((rec.vlr_saldo*(CTR.tax_juros_mensal/30)/100)* '+
      '          (CURRENT_DATE -  rec.dta_vencimento)) '+
      ' END as INT_VLR_CORRIGIDO, '+
      ' CASE '+
      '     WHEN (CURRENT_DATE -  rec.dta_vencimento)<=0 THEN 0 '+
      '     WHEN (CURRENT_DATE -  rec.dta_vencimento)>0  THEN '+
      '          ((rec.vlr_saldo*(CTR.tax_juros_mensal/30)/100)* '+
      '          (CURRENT_DATE -  rec.dta_vencimento)) '+
      ' END as INT_VLR_JUROS,  '+
      ' cast(case                                           '+
      '     when (rec.DTA_VENCIMENTO < CURRENT_DATE ) and   '+
      '       (REC.vlr_saldo>0) then ''1-Vencido''          '+
      '     when (CURRENT_DATE = REC.DTA_VENCIMENTO) and    '+
      '       (REC.vlr_saldo>0) then ''2-Vence hoje''       '+
      '     when  (REC.DTA_VENCIMENTO > CURRENT_DATE ) and  '+
      '        (REC.vlr_saldo>0) then ''3-A Vencer''        '+
      '     when  (REC.vlr_saldo = 0) then ''4-Quitado''    '+
      '  ELSE ''5-???''                                     '+
      ' end as varchar(30)) as int_situacao_titulo          '+


      ' FROM FIN_TB_M_REC REC ' +
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = REC.ID_CLIENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
      ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
      ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO ' +
      ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA = REC.ID_EMPRESA ' +
      ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA = REC.ID_EMPRESA '+
      ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL = REC.ID_FISCAL ' +
      ' LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA = REC.BOL_ID_CONTA '+
      ' left outer join                                                     '+
            ' (select ppp.id_titulo, max(dta_pagamento) as dta_pagamento  '+
            '     from fin_tb_m_rec_pag ppp  '+
            '  group by 1) pag on (pag.id_titulo = rec.id_titulo) ';
  end;
begin

   BUS_SQ_M_REC.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_REC.CommandText := enSqlBusRec + ' WHERE 1=2 '
        else
           BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format('WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and  REC.DTA_ORIGINAL = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and  REC.DTA_VENCIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.ID_PLANO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format(' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and  upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 7 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format(' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and upper(LTO.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 8 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.CHE_CHEQUE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 9 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format('WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and upper(REC.CHE_EMITENTE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 10 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format('WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and upper(REC.HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 11 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
          Format('WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and (REC.DTA_VENCIMENTO<CURRENT_DATE) AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 12 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
             '   AND REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             '   AND REC.ID_EMPRESA = ''' + VarToStr(Input[3]) +''' ' +
             '   AND REC.SITUACAO_CHQ in (' + VarToStr(Input[4]) +') ';
        if Input[5] <> ''  then
           begin
              BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
                   ' AND REC.ID_CLIENTE = ''' + VarToStr(Input[5]) +''' ';
           end;
      end
   else if Input[0] = 13 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ' +
             '   AND REC.CHE_CHEQUE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND REC.CHE_CONTA = ''' + VarToStr(Input[3]) +''' ' +
             '   AND REC.CHE_BANCO = ''' + VarToStr(Input[4]) +''' ' +
             '   AND REC.CHE_AGENCIA = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 90 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.VLR_SALDO > 0 AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 91 then  // Utilizado pela Cobrana
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.ID_TITULO in (' + VarToStr(Input[2]) +' ) ' ;
      end
   else if Input[0] = 92 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' ;
      end
   else if Input[0] = 93 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '  +
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) + ''' ' ;
      end
   else if Input[0] = 94 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_CLIENTE = ''' + VarToStr(Input[1]) + ''' ' ;
      end
   else if Input[0] = 95 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND  FPG.DOC_IMPRESSO = ''' + VarToStr(Input[2]) +''' ' ;
      end
   else if Input[0] = 96 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.VLR_SALDO > 0  AND coalesce(BOL_NOSSO_NUMERO,'''') <> '' AND ' +
             '      REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and REC.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 97 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO = 1 ';
      end
   else if Input[0] = 98 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO = 4 ';
      end
   else if Input[0] = 99 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ';
      end
   else if Input[0] = 100 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' '  +
            '   AND REC.BOL_ID_CONTA = ''' + VarToStr(Input[2]) + ''' '  +
            '   and REC.DTA_EMISSAO = ''' + VarToStr(Input[3]) + ''' '  +
            '   and REC.VLR_SALDO > 0 ';
      end
   else if Input[0] = 101 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO = 2 ';
      end
   else if Input[0] = 102 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+''' '+
            ' AND REC.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) )+''' '+
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[4]) +''' '+
            ' AND REC.VLR_SALDO>0 ';
      end
    else if Input[0] = 103 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.DTA_VENCIMENTO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+''' '+
            ' AND REC.DTA_VENCIMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) )+''' '+
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[4]) +''' '+
            ' AND REC.VLR_SALDO>0 ';
      end
    else if Input[0] = 104 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.CAR_N_LOTE = '''+VarToStr(Input[2])+''' '+
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[3]) +''' '+
            ' AND REC.VLR_SALDO>0 ';
      end
    else if Input[0] = 105 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' '  +
            '   AND REC.BOL_NOSSO_NUMERO = ''' + VarToStr(Input[2]) + ''' ' +
            '   AND REC.BOL_BANCO = ''' + VarToStr(Input[3]) + ''' ';
      end
    else if Input[0] = 106 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO > 0 AND  REC.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 107 then  // Utilizado pela Cobrana , Mov. de cheque
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_TITULO in (' + VarToStr(Input[1]) +' ) ' ;
      end
    else if Input[0] = 108 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 109 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE '  +
            '   REC.BOL_NOSSO_NUMERO = ''' + VarToStr(Input[1]) + ''' ' +
            '   AND REC.BOL_BANCO = ''' + VarToStr(Input[2]) + ''' ';
      end
    else if Input[0] = 110 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '  +
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) + ''' '+
             '   AND  (REC.VLR_SALDO > 0)  AND (REC.DTA_VENCIMENTO<CURRENT_DATE) ';
      end
    else if Input[0] = 111 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ' +
             '   AND  REC.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';


      end
    else if Input[0] = 112 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ' +
             '   AND  REC.DTA_VENCIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';
      end

    else if Input[0] = 113 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             '   AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ' +
             Format(' and upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[4]))]);
      end

    else if Input[0] = 114 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             ' AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ' +
             '   AND  NFE.NUMERO = '''+ VarToStr(Input[4])+''' ';
      end

   else if Input[0] = 115 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.VLR_SALDO>0 AND  REC.ID_EMPRESA in (' + VarToStr(Input[1]) +') ' +
             ' AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND  FPG.DOC_IMPRESSO in (' + VarToStr(Input[3]) +') ' +
             '   AND  REC.VLR_SALDO = '''+ VarToStr(Input[4])+''' ';
      end
   else if Input[0] = 116 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.VLR_SALDO = '''+VarToStr(Input[2])+''' '+
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[3]) +''' '+
            ' AND REC.VLR_SALDO>0 ';
      end
    else if Input[0] = 117 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_CREDITO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 118 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '  +
             '   AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) + ''' ' +
             '   AND  REC.ID_TITULO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 119 then
      begin
         BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.VLR_SALDO = REC.VLR_PARCELA AND REC.VLR_SALDO > 0 '+
            ' AND ((REC.DCT_ID_DESC IS NULL) OR (REC.DCT_ID_DESC = 0)) '+
            ' AND REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[6]) +''' ';

         if  VarToStr(Input[2]) = '0' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

         if  VarToStr(Input[2]) = '1' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

         if  VarToStr(Input[2]) = '2' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.dct_dta_descontado >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.dct_dta_descontado <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';


         if  VarToStr(Input[5]) <> '' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.ID_CLIENTE = '''+VarToStr(Input[5])+''' ';

         if  VarToStr(Input[7]) <> '' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.ID_LOCAL_TITULO = '''+VarToStr(Input[7])+''' ';
      end
   else if Input[0] = 120 then
      begin
         BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.VLR_SALDO = REC.VLR_PARCELA AND REC.VLR_SALDO > 0 '+
            ' AND REC.DCT_ID_DESC >0 '+
            ' AND REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' AND REC.ID_FORMA_PAG = ''' + VarToStr(Input[6]) +''' ';

         if  VarToStr(Input[2]) = '0' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

         if  VarToStr(Input[2]) = '1' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

         if  VarToStr(Input[2]) = '2' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.dct_dta_descontado >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             ' AND  REC.dct_dta_descontado <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';


         if  VarToStr(Input[5]) <> '' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.ID_CLIENTE = '''+VarToStr(Input[5])+''' ';

         if  VarToStr(Input[7]) <> '' then
          BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' AND REC.DCT_ID_LOCAL_TITULO = '''+VarToStr(Input[7])+''' ';
      end
   else if Input[0] = 121 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO IN (6) ';
      end

   else if Input[0] = 122 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   and REC.CHE_CHEQUE = ''' + VarToStr(Input[2]) + ''' ' +
             '   and REC.ID_CLIENTE = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 123 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and (LTO.EM_PROTESTO = TRUE OR ' +
             '    LTO.EM_SPC = TRUE ) AND REC.VLR_SALDO = 0 AND  REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
      end

    else if Input[0] = 124 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE  REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and (LTO.EM_PROTESTO = TRUE OR ' +
             '    LTO.EM_SPC = TRUE ) AND REC.VLR_SALDO = 0 ';
      end

   else if Input[0] = 125 then
      begin
        BUS_SQ_M_REC.CommandText := enSqlBusRec +
             ' WHERE REC.VLR_SALDO  > 0  ' +
             '   and (     (  FPG.DOC_IMPRESSO = 4  and coalesce(BOL_NOSSO_NUMERO,'''')  = '''' )    ' +
             '          or (  FPG.DOC_IMPRESSO = 4  and coalesce(BOL_NOSSO_NUMERO,'''') <> '''' ' +
             '                and coalesce(bol_remessa_env,false) = false )  ) ' +
             '    and    REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '    and    REC.DTA_EMISSAO >= ''12/06/2019'' ' +
             '    and    REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

   if Input[0] = 94 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY int_situacao_titulo,REC.DTA_VENCIMENTO DESC ' ;
      end;
   if Input[0] = 99 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY REC.DTA_VENCIMENTO DESC ' ;
      end;

    ///Input[0]= 102,103 e 104 so utlizados pela tela baixa de carto de credito
    if Input[0] = 102 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY extract(month from rec.dta_vencimento),extract(year from rec.dta_vencimento),extract(day from rec.dta_vencimento) ' ;
      end;
    if Input[0] = 103 then
      begin
       BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY extract(month from rec.dta_vencimento),extract(year from rec.dta_vencimento),extract(day from rec.dta_vencimento) ' ;
      end;
    if Input[0] = 104 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY extract(month from rec.dta_vencimento),extract(year from rec.dta_vencimento),extract(day from rec.dta_vencimento) ' ;
      end;
    if Input[0] = 110 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY rec.dta_vencimento ' ;
      end;

    if Input[0] = 122 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY rec.dta_vencimento ' ;
      end;
    if Input[0] = 123 then
      begin
        BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
                 ' ORDER BY rec.dta_vencimento ' ;
      end;

    if Input[0] = 124 then
       begin
         BUS_SQ_M_REC.CommandText := BUS_SQ_M_REC.CommandText +
             ' ORDER BY rec.dta_vencimento LIMIT 1 ' ;
       end;
   //GerarSqlTxt(BUS_SQ_M_REC);
   Result := BUS_DP_M_REC.Data;
   BUS_SQ_M_REC.Close;
end;

function TSM.BUS_DP_M_REC_DIADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusRecDia: String;
  begin
    Result :=
           ' select rpg.id_baixa, rpg.dta_pagamento, rpg.id_forma_pag, fpg.descricao int_nomefpg, ' +
           '  rec.id_cliente, cli.nome int_nomecli,cxa.id_conta,                                   ' +
           '  COALESCE(rpg.vlr_desconto,0) as vlr_desconto,                                       ' +
           '  COALESCE(rpg.vlr_juros,0) as vlr_juros,                                             ' +
           '  COALESCE(rpg.vlr_pagamento,0) as vlr_pagamento,                                     ' +
           '  COALESCE(rec.vlr_saldo,0) as vlr_saldo                                              ' +
           ' from fin_tb_m_rec_pag rpg                                                            ' +
           '  left outer join fin_tb_m_rec rec on rec.id_titulo=rpg.id_titulo                     ' +
           '  left outer join fin_tb_m_cxa cxa on cxa.id_abertura=rpg.id_abertura                       ' +
           '  left outer join cad_tb_c_cli cli on cli.id_cliente=rec.id_cliente                   ' +
           '  left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=rpg.id_forma_pag               ';
  end;
begin
   BUS_SQ_M_REC_DIA.Close;
   if input[0] = 0 then
      begin
         BUS_SQ_M_REC_DIA.CommandText := enSqlBusRecDia + ' WHERE 1 = 2 ';
      end
   else
      begin
         BUS_SQ_M_REC_DIA.CommandText := enSqlBusRecDia +
                                   ' WHERE rec.ID_EMPRESA =  ''' + Input[1] +''' ' +
                                   '   AND RPG.DTA_PAGAMENTO = ''' +
                                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2]))) + '''  ' +
                                   '   AND RPG.ID_ABERTURA = ''' + VarToStr(Input[3]) +''' ';
      end;


   Result := BUS_DP_M_REC_DIA.Data;
   BUS_SQ_M_REC_DIA.Close;
end;


function TSM.BUS_DP_M_REC_HCH_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinRecHchInt: String;
  begin
    Result := ' select * from fin_tb_m_rec_hch hch';
  end;
begin

   BUS_SQ_M_REC_HCH_INT.Close;
   if Input[0] = 0  then
      begin
        BUS_SQ_M_REC_HCH_INT.CommandText := enSqlFinRecHchInt +
             ' WHERE HCH.ID_TITULO in (' + VarToStr(Input[1]) + ') ';
      end;

   if Input[0] = 1  then
      begin
        BUS_SQ_M_REC_HCH_INT.CommandText := enSqlFinRecHchInt +
             ' WHERE HCH.ID_MCH = ''' + VarToStr(Input[1]) + ''' ';
      end;

   Result := BUS_DP_M_REC_HCH_INT.Data;
   BUS_SQ_M_REC_HCH_INT.close;
end;

function TSM.BUS_DP_M_REC_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRec: String;
  begin
    Result :=
        '  SELECT * from fin_tb_m_rec rec ';
  end;
begin
   BUS_SQ_M_REC_INT.Close;
   BUS_SQ_M_REC_INT.CommandText := enSqlRec;
   if Input[0]=0 then
     begin
       BUS_SQ_M_REC_INT.CommandText := BUS_SQ_M_REC_INT.CommandText +
       ' WHERE REC.ID_MCH = ''' + VarToStr(Input[1]) +''' ';
     end;
   Result := BUS_DP_M_REC_INT.Data;
   BUS_SQ_M_REC_INT.Close;
end;

function TSM.BUS_DP_M_ROM_ICFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlBusRomIcf: String;
  begin
    Result :=
          ' select false as int_selecao, icf.* , ' + #13#10 +
          '   cast( case                              ' + #13#10 +
          '                         when  coalesce(etq.pcp_obs_item,'''') <> '''' then etq.pcp_obs_item' + #13#10 +
          '            else ite.descricao end as varchar(150)) as int_nomeite,' + #13#10 +
          '   ite.id_und_venda as int_undvenda,' + #13#10 +
          '   cor.descricao as int_nomecor,' + #13#10 +
          '   tam.descricao as int_nometam, ped.situacao ' + #13#10 +
          ' from pcp_tb_m_rom_icf icf' + #13#10 +
          '    left outer join pcp_tb_m_rom rom on rom.id_rom = icf.id_rom' + #13#10 +
          '    left outer join cad_tb_c_ite ite on ite.id_item = icf.id_item' + #13#10 +
          '    left outer join cad_tb_c_cor cor on cor.id_cor = icf.id_cor' + #13#10 +
          '    left outer join cad_tb_c_tam tam on tam.id_tamanho = icf.id_tamanho ' + #13#10 +
          '    left outer join pcp_tb_m_etq etq on etq.cod_barra = icf.cod_barra ' + #13#10 +
          '    left outer join fat_tb_m_ped ped on ped.id_pedido = icf.id_pedido ' + #13#10;

  end;
begin
   BUS_SQ_M_ROM_ICF.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_M_ROM_ICF.CommandText := enSqlBusRomIcf + ' WHERE 1=2 '
        else
           BUS_SQ_M_ROM_ICF.CommandText := enSqlBusRomIcf +
             ' WHERE rom.id_empresa = ''' + VarToStr(Input[1]) + ''' and rom.id_rom = ''' +
                    VarToStr(Input[2]) + ''' and ped.situacao = 2 and coalesce(icf.id_pedido,0) <> 0 ' +
                    ' and coalesce(icf.id_pedido,0) <> ''' + VarToStr(Input[3]) + ''' and icf.id_item in (' + VarToStr(Input[4]) +') ' ;
      end;

   BUS_SQ_M_ROM_ICF.CommandText :=   BUS_SQ_M_ROM_ICF.CommandText +
          ' order by  ite.descricao, icf.cod_barra ' ;

   Result := BUS_DP_M_ROM_ICF.Data;

end;

function TSM.BUS_DP_M_ROM_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusRomPed: String;
  begin
    Result :=
         ' select  rte.id_pedido, sum(rte.qtde) '+
         ' from pcp_tb_m_rom_ped_ite rte ';
  end;
begin
   BUS_SQ_M_ROM_PED.Close;
   BUS_SQ_M_ROM_PED.CommandText := enSqlBusRomPed +
       ' WHERE rte.id_rom = ''' + VarToStr(Input[0]) +'''  ' +
       ' GROUP BY rte.id_pedido ' +
       ' ORDER BY rte.id_pedido ';
   Result := BUS_DP_M_ROM_PED.Data;
   BUS_SQ_M_ROM_PED.Close;
end;

function TSM.BUS_DP_M_ROM_PED_ICFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRomPedIcf: String;
  begin
    Result :=
        ' with itens_rom_ped_icf' + #13#10 +
        ' as' + #13#10 +
        ' (' + #13#10 +
        '  select icf.id_rom, icf.id_pedido, icf.id_item,icf.id_cor,icf.id_tamanho, GRU.TIPO_ITEM AS INT_TIPO_ITEM, count(*) as qtde from pcp_tb_m_rom_ped_icf icf    ' + #13#10 +
        '    LEFT OUTER JOIN CAD_TB_C_ITE  ITE ON ITE.ID_ITEM = icf.ID_ITEM  ' +
        '    LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO ' +
        '  group by 1,2,3,4,5,6' + #13#10 +
        ' )' + #13#10 +
        ' select icr.*,  round(tmp.vlr_liquido / icr.qtde,4) as vlr_unitario, tmp.vlr_liquido, ' +
        '    ite.descricao as int_nomeite, cor.descricao as int_nomecor,            ' +
        '    tam.descricao as int_nometam             ' +
        ' from itens_rom_ped_icf icr' + #13#10 +
        '   left outer join ( select pic.id_pedido,pic.id_item, sum(pic.vlr_liquido)  - sum(pic.vlr_desc_especial)  as vlr_liquido from fat_tb_m_ped_ite pic' + #13#10 +
        '                     group by 1,2 ) ' + #13#10 +
        '                      tmp' + #13#10 +
        '                     on (tmp.id_pedido  = icr.id_pedido and ' + #13#10 +
        '                         tmp.id_item = icr.id_item) ' +
        '    left outer join cad_tb_c_ite ite on ite.id_item = icr.id_item       ' +
        '    left outer join cad_tb_c_cor cor on cor.id_cor = icr.id_cor         ' +
        '    left outer join cad_tb_c_tam tam on tam.id_tamanho = icr.id_tamanho ';

  end;
begin

   BUS_SQ_M_ROM_PED_ICF.Close;
   BUS_SQ_M_ROM_PED_ICF.CommandText := enSqlRomPedIcf;

   if Input[0] = 0 then
      begin
        BUS_SQ_M_ROM_PED_ICF.CommandText := BUS_SQ_M_ROM_PED_ICF.CommandText +
         ' where  icr.id_rom = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_ROM_PED_ICF.CommandText := BUS_SQ_M_ROM_PED_ICF.CommandText +
         ' where  icr.id_rom = ''' + VarToStr(Input[1]) +''' ' +
         '   and  icr.id_pedido = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := BUS_DP_M_ROM_PED_ICF.Data;
   BUS_SQ_M_ROM_PED_ICF.Close;
end;

function TSM.BUS_DP_M_ROM_REGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBusRomReg: String;
  begin
    Result :=
         ' select cli.id_regiao, reg.descricao as int_nomereg, ' +
         ' count(rpd.id_pedido) as qtde_ped                    ' +
         ' from pcp_tb_m_rom_ped rpd                           ' +
         '    left outer join fat_tb_m_ped ped on              ' +
         '        (ped.id_pedido = rpd.id_pedido)              ' +
         '    left outer join cad_tb_c_cli cli on              ' +
         '        (cli.id_cliente = ped.id_cliente)            ' +
         '    left outer join pcp_tb_c_reg reg on              ' +
         '        (reg.id_regiao = cli.id_regiao)              ';
  end;
begin
   BUS_SQ_M_ROM_REG.Close;
   BUS_SQ_M_ROM_REG.CommandText := enSqlBusRomReg +
       ' WHERE RPD.id_rom = ''' + VarToStr(Input[0]) +'''  ' +
       ' GROUP BY cli.id_regiao, reg.descricao ' +
       ' ORDER BY cli.id_regiao, reg.descricao ';
   Result := BUS_DP_M_ROM_REG.Data;
   BUS_SQ_M_ROM_REG.Close;
end;

function TSM.BUS_DP_M_SLD_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlBusSldMesAntItem: String;
begin
  enSqlBusSldMesAntItem :=
       '   select' + #13#10 +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ' +
       '           tme.tipo_movimento = 0    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and                       ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) ) -        ' +
       '                                                               ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ' +
       '           tme.tipo_movimento = 1    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
       '           ) as saldo_anterior, ' +
          '   (select COALESCE(sum(fea.qtde),0)' + #13#10 +
          '		from est_tb_m_fea fea' + #13#10 +
          '				 left outer join cad_tb_c_tme tme on' + #13#10 +
          '										(tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque)				 ' + #13#10 +
          '		where fea.id_item = ite.id_item  and' + #13#10 +
          '          fea.id_empresa = par.id_empresa and' + #13#10 +
          '          tme.tipo_movimento = 0     and  /* entrada */			  								' + #13#10 +
          '					 tme.esto_movimenta = true  and' + #13#10 +
          '          fea."data" >= ''' +
                     FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                     ''' and ' +
          '          fea."data" <= ''' +
                     FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                     ''' and ' +
          '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
          '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
          '          ) as qtde_entradas,' + #13#10 +
          '  (select COALESCE(sum(fea.qtde),0)' + #13#10 +
          '		from est_tb_m_fea fea' + #13#10 +
          '				 left outer join cad_tb_c_tme tme on' + #13#10 +
          '										(tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque)				 ' + #13#10 +
          '		where fea.id_item = ite.id_item  and' + #13#10 +
          '          fea.id_empresa = par.id_empresa and' + #13#10 +
          '          tme.tipo_movimento = 1     and  /* saidas */			  								' + #13#10 +
          '					tme.esto_movimenta = true  and' + #13#10 +
          '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
          '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
           '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
           '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
          '          ) as qtde_saidas,' + #13#10 +

           '    (select COALESCE(sum(fea.qtde),0)                          ' +
           '     from est_tb_m_fea fea                                     ' +
           '          left outer join cad_tb_c_tme tme on                  ' +
           '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
           '     where fea.id_empresa = par.id_empresa and                 ' +
           '           fea.id_item = ite.id_item and                       ' +
           '           tme.tipo_movimento = 0    and                       ' +
           '           tme.esto_movimenta = true and                       ' +
           '           fea."data" < ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                       ''' and ' +
           '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and                       ' +
           '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) ) -        ' +
           '                                                               ' +
           '    (select COALESCE(sum(fea.qtde),0)                          ' +
           '     from est_tb_m_fea fea                                     ' +
           '          left outer join cad_tb_c_tme tme on                  ' +
           '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
           '     where fea.id_empresa = par.id_empresa and                 ' +
           '           fea.id_item = ite.id_item and                       ' +
           '           tme.tipo_movimento = 1    and                       ' +
           '           tme.esto_movimenta = true and                       ' +
           '           fea."data" < ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                       ''' and ' +
           '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
           '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
           '           ) + ' +

          '   (select COALESCE(sum(fea.qtde),0)' + #13#10 +
          '		from est_tb_m_fea fea' + #13#10 +
          '				 left outer join cad_tb_c_tme tme on' + #13#10 +
          '										(tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque)				 ' + #13#10 +
          '		where fea.id_item = ite.id_item  and' + #13#10 +
          '          fea.id_empresa = par.id_empresa and' + #13#10 +
          '          tme.tipo_movimento = 0     and  /* entrada */			  								' + #13#10 +
          '					 tme.esto_movimenta = true  and' + #13#10 +
          '          fea."data" >= ''' +
                     FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                     ''' and ' +
          '          fea."data" <= ''' +
                     FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                     ''' and ' +
          '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
          '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
          '          ) -' + #13#10 +
          '  (select COALESCE(sum(fea.qtde),0)' + #13#10 +
          '		from est_tb_m_fea fea' + #13#10 +
          '				 left outer join cad_tb_c_tme tme on' + #13#10 +
          '										(tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque)				 ' + #13#10 +
          '		where fea.id_item = ite.id_item  and' + #13#10 +
          '          fea.id_empresa = par.id_empresa and' + #13#10 +
          '          tme.tipo_movimento = 1     and  /* saidas */			  								' + #13#10 +
          '					tme.esto_movimenta = true  and' + #13#10 +
          '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
          '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
           '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
           '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0)    ' +
          '          ) as saldo,' + #13#10 +

          ' (select COALESCE(fes.vlr_custo_medio,0) ' + #13#10 +
          '                               from est_tb_m_fes fes                                     ' + #13#10 +
          '                                  where fes.id_empresa = par.id_empresa and                 ' + #13#10 +
          '                 fes.id_item = ite.id_item  and                      ' + #13#10 +
          '                 COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                     ' + #13#10 +
          '                 COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_medio,  ' + #13#10 +
          '       ' + #13#10 +
          '  (select COALESCE(fes.vlr_custo_ult_compra,0) ' + #13#10 +
          '            from est_tb_m_fes fes                                     ' + #13#10 +
          '            where fes.id_empresa = par.id_empresa and                 ' + #13#10 +
          '                  fes.id_item = ite.id_item  and                      ' + #13#10 +
          '                  COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' + #13#10 +
          '                  COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_ult_compra ' + #13#10 +
          ' from cad_tb_c_ite ite' + #13#10 +
          '   left outer join cad_tb_c_cor cor on (cor.id_cor > 0)' + #13#10 +
          '   left outer join cad_tb_c_tam tam on (tam.id_tamanho > 0)' + #13#10 +
          '   left outer join cad_tb_c_par par on (par.id_empresa > 0)' + #13#10 +
          'where 1 = 1 ';
   enSqlBusSldMesAntItem := enSqlBusSldMesAntItem +
       ' and par.id_empresa = ''' + VarToStr(Input[0]) +''' ' +
       ' and ite.id_item = ''' + VarToStr(Input[3]) +''' ' +
       ' and COALESCE(cor.id_cor,0) = ''' + VarToStr(Input[4]) +''' ' +
       ' and COALESCE(tam.id_tamanho,0) = ''' + VarToStr(Input[5]) +''' ';

   BUS_SQ_M_SLD_ITE.Close;
   BUS_SQ_M_SLD_ITE.CommandText := enSqlBusSldMesAntItem;

   result := BUS_DP_M_SLD_ITE.Data;
   BUS_SQ_M_SLD_ITE.Close;


end;

function TSM.BUS_DP_M_TER_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

var
  enSqlBusTerNfe: String;
begin
    enSqlBusTerNfe :=
            ' select ' + #13#10 +
            '     ite.ret_emb_capacidade,' + #13#10 +
            '       ite.ret_emb_lavaveis,        ' + #13#10 +
            '       ite.ret_emb_nao_lavavel,' + #13#10 +
            '       coalesce( sum(' + #13#10 +
            '            case ite.ret_emb_lavaveis' + #13#10 +
            '            when 0 then nfi.qtde       ' + #13#10 +
            '       end),0) as qtde_plasticos,' + #13#10 +
            '       ' + #13#10 +
            '       coalesce(sum(' + #13#10 +
            '            case ite.ret_emb_lavaveis' + #13#10 +
            '            when 1 then nfi.qtde       ' + #13#10 +
            '       end),0) as qtde_metal,' + #13#10 +
            '       ' + #13#10 +
            '       coalesce(sum(  ' + #13#10 +
            '            case ite.ret_emb_lavaveis' + #13#10 +
            '            when 2 then nfi.qtde       ' + #13#10 +
            '       end),0) as qtde_vidro,' + #13#10 +
            '              ' + #13#10 +
            '       coalesce(sum(' + #13#10 +
            '       case ite.ret_emb_nao_lavavel' + #13#10 +
            '         when 0 then nfi.qtde' + #13#10 +
            '       end),0) as qtde_contaminada,' + #13#10 +
            '       ' + #13#10 +
            '       coalesce(sum(case ite.ret_emb_nao_lavavel' + #13#10 +
            '         when 1 then nfi.qtde' + #13#10 +
            '       end),0) as qtde_nao_contaminada' + #13#10 +
            '       ' + #13#10 +
            '       ' + #13#10 +
            ' from fat_tb_m_nfe_ite nfi' + #13#10 +
            '      left outer join fat_tb_m_nfe nfe  on ' + #13#10 +
            '         (nfe.id_fiscal = nfi.id_fiscal)      ' + #13#10 +
            '      left outer join cad_tb_c_ite ite  on' + #13#10 +
            '         (ite.id_item = nfi.id_item)' + #13#10;

   BUS_SQ_M_TER_NFE.Close;
   BUS_SQ_M_TER_NFE.CommandText := enSqlBusTerNfe +
            ' where nfe.id_fiscal = ''' + VarToStr(Input[0]) +''' '  + #13#10 +
            '   and ite.ret_emb_capacidade <> '''' ' + #13#10 +
            ' group by ite.ret_emb_capacidade,' + #13#10 +
            '         ite.ret_emb_nao_lavavel,' + #13#10 +
            '         ite.ret_emb_lavaveis' + #13#10 +
            ' order by ite.ret_emb_capacidade,' + #13#10 +
            '         ite.ret_emb_nao_lavavel,' + #13#10 +
            '         ite.ret_emb_lavaveis';
   result := BUS_DP_M_TER_NFE.Data;
   BUS_SQ_M_TER_NFE.Close;
end;

function TSM.BUS_DP_M_ULT_NFE_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlUltNfeIte: String;
  begin
    Result :=
        ' SELECT nfe.id_fiscal, ' +
        '  nfe.numero, nfe.serie, NFE.sub_serie, nfe.modelo, ' +
        '  nfe.dta_emissao, nfe.dta_documento, nfe.id_emitente, frn.fantasia, ' +
        '  nfi.qtde, nfi.vlr_unitario, nfi.vlr_desconto, nfi.vlr_liquido, ' +
        '  nfi.ipi_valor, cor.descricao as int_nomecor, tam.descricao as int_nometam ' +
        ' FROM fat_tb_m_nfe_ite nfi ' +
        '  left outer join fat_tb_m_nfe NFE on (NFE.ID_FISCAL = nfi.ID_FISCAL)       ' +
        '  left outer join cad_tb_c_for frn on (FRN.ID_FORNECEDOR = NFE.ID_EMITENTE) ' +
        '  left outer join cad_tb_c_cor cor on (NFI.ID_COR = COR.ID_COR)             ' +
        '  left outer join cad_tb_c_tam tam on (NFI.ID_TAMANHO = TAM.ID_TAMANHO)     ' ;

  end;
begin
   { TODO -oMaxsuel Victor -cCriao : Mtodo criado por Maxsuel Victor - em 08/01/2015 }

   BUS_SQ_M_ULT_NFE_ITE.Close;

   BUS_SQ_M_ULT_NFE_ITE.CommandText := enSqlUltNfeIte + ' WHERE nfe.tipo_nf = ''E'' ';

   if Input[0] <> 0 then
      begin
         BUS_SQ_M_ULT_NFE_ITE.CommandText :=  BUS_SQ_M_ULT_NFE_ITE.CommandText +
             ' AND NFE.ID_EMPRESA = ''' + VarToStr(Input[0]) +''' ';
      end;

   BUS_SQ_M_ULT_NFE_ITE.CommandText :=  BUS_SQ_M_ULT_NFE_ITE.CommandText +
       ' AND NFI.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';

   if Input[2] <> '' then
      begin
        BUS_SQ_M_ULT_NFE_ITE.CommandText :=  BUS_SQ_M_ULT_NFE_ITE.CommandText +
             ' AND NFI.ID_COR = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[3] <> '' then
      begin
        BUS_SQ_M_ULT_NFE_ITE.CommandText :=  BUS_SQ_M_ULT_NFE_ITE.CommandText +
             ' AND NFI.ID_TAMANHO = ''' + VarToStr(Input[3]) +''' ';
      end;

   BUS_SQ_M_ULT_NFE_ITE.CommandText :=    BUS_SQ_M_ULT_NFE_ITE.CommandText +
      ' ORDER BY nfe.dta_emissao desc, nfe.id_fiscal desc LIMIT 10 ';

   Result := BUS_DP_M_ULT_NFE_ITE.Data;
end;


function TSM.BUS_DP_R_CHQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelChq: String;
  begin
    Result :=
     ' SELECT REC.*, '+
     '  CASE  '+
     '   WHEN REC.situacao_chq=1 THEN ''Em Aberto'' '+
     '   WHEN REC.situacao_chq=2 THEN ''Depositado'' '+
     '   WHEN REC.situacao_chq=3 THEN ''Devolvido'' '+
     '   WHEN REC.situacao_chq=4 THEN ''Parcial'' '+
     '   WHEN REC.situacao_chq=5 THEN ''Resgatado'' '+
     '   WHEN REC.situacao_chq=6 THEN ''Compensado'' '+
     '         END as int_descsit, '+
     ' PAR.emp_fantasia as int_nomeemp,CLI.nome as int_nomecli,FUN.nome as int_nomevend FROM FIN_TB_M_REC REC '+
     ' left outer join CAD_TB_C_FPG FPG on (FPG.id_forma_pag = REC.id_forma_pag) '+
     ' left outer join CAD_TB_C_PAR PAR on (PAR.id_empresa = REC.id_empresa) '+
     ' left outer join CAD_TB_C_CLI CLI on (CLI.id_cliente = REC.id_cliente) '+
     ' left outer join CAD_TB_C_FUN FUN on (FUN.id_funcionario = REC.id_vendedor) '+

     ' WHERE FPG.DOC_IMPRESSO = 6 ';
  end;
begin

   BUS_SQ_R_CHQ.CommandText := enSqlRelChq;

   if (Input[0] = '0') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.dta_emissao between  '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+ ''''+
           ' and '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])))+'''';
      end;
   if (Input[0] = '1') then
    begin
         BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
         ' and REC.dta_vencimento between  '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+ ''''+
         ' and '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])))+'''';
    end;

   if (Input[3] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.id_empresa in ('+Input[3]+') ';
      end;

   if (Input[4] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.id_cliente in ('+Input[4]+') ';
      end;

   if (Input[5] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.situacao_chq in ('+Input[5]+') ';
      end;

   if (Input[6] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.id_local_titulo in ('+Input[6]+')' ;
      end;
   if (Input[7] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.id_plano in ('+Input[7]+')' ;
      end;

   if (Input[8] <> '') then
      begin
           BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText +
           ' and REC.id_vendedor in ('+Input[8]+') ';
      end;

     BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText + ' order by REC.id_empresa,REC.situacao_chq ';

   if (Input[9] = '0') then
      begin
        BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText + ' ,REC.dta_emissao ';
      end;
   if (Input[9] = '1') then
      begin
        BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText + ' ,REC.dta_vencimento ';
      end;
   if (Input[9] = '2') then
      begin
        BUS_SQ_R_CHQ.CommandText := BUS_SQ_R_CHQ.CommandText + ' ,CLI.nome ';
      end;

   Result := BUS_DP_R_CHQ.Data;

   BUS_SQ_R_CHQ.Close;
end;

function TSM.BUS_DP_R_CTE_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCteReceb: String;
  begin
    Result :=
      ' select cite.*,ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda, '+
      ' loc.loca_rua as int_rua,loc.loca_prateleira as int_prateleira,loc.loca_escaninho as int_escaninho,  '+
      ' gru.id_grupo as int_codgrupo, '+
      ' gru.descricao as int_nomegru,cor.descricao as int_nomecor, '+
      ' tam.descricao as int_nometam,cte.id_almoxarifado,alm.descricao as int_nomealm,cte.id_empresa, '+
      ' par.emp_fantasia as int_nomemp,cte.dta_contagem,cte.obs, '+
      ' cte.dta_movimento,cte.localizacao, '+
      ' cte.per_inicial,cte.per_final '+
      ' from est_tb_m_cte_ite cite  '+
      ' left outer join est_tb_m_cte cte on cte.id_controle = cite.id_controle  '+
      ' left outer join cad_tb_c_par par on par.id_empresa = cte.id_empresa '+
      ' left outer join cad_tb_c_alm alm on alm.id_almoxarifado = cte.id_almoxarifado '+
      ' left outer join cad_tb_c_ite ite on ite.id_item = cite.id_item '+
      ' left outer join cad_tb_c_ite_loc loc on loc.id_empresa = par.id_empresa and loc.id_item=ite.id_item  '+
      ' left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo '+
      ' left outer join cad_tb_c_cor cor on cor.id_cor = cite.id_cor '+
      ' left outer join cad_tb_c_tam tam on tam.id_tamanho = cite.id_tamanho '+
      ' where 1=1';
  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin
   { TODO -oLuan : Criado no dia 18/11/2015 }
   BUS_SQ_R_CTE_ITE.CommandText := enSqlRelCteReceb;

   if ((Input[3] = '') and (Input[0] <> '  /  /    ') and (Input[1] <> '  /  /    ')) then
      begin
        if (Input[12] = 0) then
             begin
               BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
               ' and cte.dta_contagem between  '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])))+ ''''+
               ' and '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+'''';
             end;
         if (Input[12] = 1) then
             begin
               BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
               ' and cte.dta_movimento between  '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])))+ ''''+
               ' and '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+'''';
             end;
      end;

   if (Input[2] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cte.id_empresa in ('+Input[2]+') ';
      end;

   if (Input[3] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cte.id_controle = '''+Input[3]+'''';
      end;

   if (Input[4] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cte.id_almoxarifado in ('+Input[4]+') ';
      end;


   if (Input[5] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cite.id_cor in ('+Input[5]+')' ;
      end
   else
      begin
            BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cite.id_cor > 0 ' ;
      end;

   if (Input[6] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cite.id_tamanho in ('+Input[6]+')' ;
      end
   else
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cite.id_tamanho > 0 ' ;
      end;

   if (Input[7] <> '') then
      begin
          // BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
          // ' and ite.id_grupo in ('+Input[7]+') ';


           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[7]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' OR ';
              end;

           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' ) ';

      end;

   if (Input[8] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and loc.loca_rua in ('+Input[8]+') ';
      end;

   if (Input[10] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and gru.tipo_item in ('+Input[10]+') ';
      end;

   if (Input[11] = 1) then
      begin
        BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cte.status = 1 ';
      end;

    if (Input[9] <> '') then
       begin
         if (Input[9] = '0') then
            begin
              BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' order by cite.id_controle,cite.id_item';
            end;
         if (Input[9] = '1') then
            begin
              BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' order by cite.id_controle,ite.descricao';
            end;
         if (Input[9] = '2') then
            begin
              BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' order by cite.id_controle,cite.num_lote';
            end;
         if (Input[9] = '3') then
            begin
              BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' order by cite.id_controle,ite.cod_fabrica';
            end;
       end;



   Result := BUS_DP_R_CTE_ITE.Data;

   BUS_SQ_R_CTE_ITE.Close;
end;

function TSM.BUS_DP_R_CTE_ITE_NCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCteIteNCT: String;
  begin
    Result :=
       ' select ite.id_item,fes.vlr_custo_medio,fes.vlr_custo_ult_compra,fes.saldo_fisico, '+
       ' fes.id_cor,fes.id_tamanho,ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda, '+
       ' gru.id_grupo as int_codgrupo, par.id_empresa,                                               '+
       ' gru.descricao as int_nomegru,cor.descricao as int_nomecor,                  '+
       ' tam.descricao as int_nometam,                                               '+
       ' par.emp_fantasia as int_nomemp,                                              '+
       ' loc.loca_rua as int_rua,                                                    '+
       ' loc.loca_prateleira as int_prateleira,                                      '+
       ' loc.loca_escaninho as int_escaninho                                         '+
       ' from cad_tb_c_ite ite                                                       '+
       ' left outer join est_tb_m_fes fes on fes.id_item = ite.id_item               '+
       ' left outer join cad_tb_c_par par on par.id_empresa = fes.id_empresa         '+
       ' left outer join cad_tb_c_ite_loc loc on loc.id_empresa = par.id_empresa and loc.id_item=ite.id_item  '+
       ' left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo             '+
       ' left outer join cad_tb_c_cor cor on cor.id_cor = fes.id_cor                 '+
       ' left outer join cad_tb_c_tam tam on tam.id_tamanho = fes.id_tamanho         ';
  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
  tipo_saldo:String;
begin
   { TODO -oLuan : Criado no dia 14/11/2016 }
   BUS_SQ_R_CTE_ITE_NCT.CommandText := enSqlRelCteIteNCT + ' where not exists ( '+
      ' select fes.id_item '+
      ' from est_tb_m_fes fes '+
      ' where fes.id_item=ite.id_item ';

   if ((Input[0] <> '  /  /    ') and (Input[1] <> '  /  /    ')) then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and (fes.data_ult_inventario between  '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])))+ ''''+
           ' and '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+''')';
      end;

   if (Input[2] <> '') then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_empresa in ('+Input[2]+') ';
      end;

   {if (Input[3] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and cte.id_controle = '''+Input[3]+'''';
      end;

   if (Input[4] <> '') then
      begin
           BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
           ' and cte.id_almoxarifado in ('+Input[4]+') ';
      end;}


   if (Input[5] <> '') then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_cor in ('+Input[5]+')' ;
      end
   else
      begin
            BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_cor > 0 ' ;
      end;

   if (Input[6] <> '') then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_tamanho in ('+Input[6]+')' ;
      end
   else
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_tamanho > 0 ' ;
      end;

   if (Input[7] <> '') then
      begin
          // BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText +
          // ' and ite.id_grupo in ('+Input[7]+') ';


           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[7]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' OR ';
              end;

           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' ) ';

      end;

   if (Input[8] <> '') then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and loc.loca_rua in ('+Input[8]+') ';
      end;




    BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' ) and ite.ativo = true ';


    if (Input[2] <> '') then
      begin
           BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
           ' and fes.id_empresa in ('+Input[2]+') ';
      end;

    if Input[9] <> '' then
      begin
          BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[9])) do
            begin
              tipo_saldo := copy(VarToStr(Input[9]),i,1);
               if tipo_saldo='0' then
                 begin
                  BUS_SQ_R_CTE_ITE_NCT.CommandText :=  BUS_SQ_R_CTE_ITE_NCT.CommandText +
                          '  fes.saldo_fisico >0 ';
                 end;
                if tipo_saldo='1' then
                 begin
                  BUS_SQ_R_CTE_ITE_NCT.CommandText :=  BUS_SQ_R_CTE_ITE_NCT.CommandText +
                           '  fes.saldo_fisico <0 ';
                 end;
                if tipo_saldo='2' then
                 begin
                   BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +
                            '  fes.saldo_fisico =0 ';
                 end;

                if i<Length(VarToStr(Input[9])) then
                   begin
                      BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText +' or ';
                   end;
            end;
            BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' ) ';
      end;


    if (Input[10] <> '') then
       begin
         if (Input[10] = '0') then
            begin
              BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' order by fes.id_item';
            end;
         if (Input[10] = '1') then
            begin
              BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' order by ite.descricao';
            end;
         {if (Input[9] = '2') then
            begin
              BUS_SQ_R_CTE_ITE.CommandText := BUS_SQ_R_CTE_ITE.CommandText + ' order by cite.num_lote';
            end;}
         if (Input[10] = '3') then
            begin
              BUS_SQ_R_CTE_ITE_NCT.CommandText := BUS_SQ_R_CTE_ITE_NCT.CommandText + ' order by ite.cod_fabrica';
            end;
       end;

   Result := BUS_DP_R_CTE_ITE_NCT.Data;

   BUS_SQ_R_CTE_ITE_NCT.Close;
end;

function TSM.BUS_DP_R_OCQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiOcq: String;
  begin
    Result :=
      'SELECT OCQ.*, '+
      '       CLI.NOME AS INT_NOMECLI, '+
      '       FUC.NOME AS INT_NOMEFUC, '+
      '       ANA.NOME AS INT_NOMEANA, '+
      '       CPG.DESCRICAO AS INT_NOMECPG, '+
      '       EQP.DESCRICAO AS INT_NOMEEQP '+
      'FROM OFI_TB_M_OCQ OCQ '+
      'LEFT OUTER JOIN CAD_TB_C_EQP EQP ON EQP.ID_EQUIPAMENTO=OCQ.ID_EQUIPAMENTO '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCQ.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=OCQ.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=OCQ.ID_ANALISTA '+
      'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCQ.ID_CONDICAO_PAG ';
  end;
begin
   BUS_SQ_R_OCQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_R_OCQ.CommandText := enSqlRelOfiOcq + ' WHERE 1=2 '
        else
           BUS_SQ_R_OCQ.CommandText := enSqlRelOfiOcq +
             ' WHERE OCQ.ID_ORCAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := BUS_DP_R_OCQ.Data;

   BUS_SQ_R_OCQ.Close;
end;

function TSM.BUS_DP_R_OCVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelOfiOcv: String;
  begin
    Result :=
      'SELECT OCV.*, '+
      '       CLI.NOME AS INT_NOMECLI, '+
      '       FUC.NOME AS INT_NOMEFUC, '+
      '       ANA.NOME AS INT_NOMEANA, '+
      '       CPG.DESCRICAO AS INT_NOMECPG, '+
      '       VEI.DESCRICAO AS INT_NOMEVEI '+
      'FROM OFI_TB_M_OCV OCV '+
      'LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_PLACA=OCV.PLACA '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCV.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=OCV.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=OCV.ID_ANALISTA '+
      'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCV.ID_CONDICAO_PAG ';
  end;
begin
   BUS_SQ_R_OCV.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_R_OCV.CommandText := enSqlRelOfiOcv + ' WHERE 1=2 '
        else
           BUS_SQ_R_OCV.CommandText := enSqlRelOfiOcv +
             ' WHERE OCV.ID_ORCAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := BUS_DP_R_OCV.Data;

   BUS_SQ_R_OCV.Close;
end;

function TSM.BUS_DP_R_ORC_ITE_MEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  var
  arq:TextFile;
  sql:string;
function enSqlMedicao: String;
  begin
    Result :=  ' SELECT 	orc.id_obra, med.grupo, med.dta_medicao, med.id_med, '+
		           ' obr.descricao as int_nomeobra, '+
               ' orc.id_empresa as int_codemp, '+
               ' par.id_empresa as int_nomeemp, '+
		           ' eoc.descricao as int_nomestrutura, '+
		           ' ite.descricao as int_nomegrupo, '+
               ' ite.und as int_und, '+
		           ' fun.nome, '+
		           ' med.qtde '+
               ' FROM ctc_tb_m_orc_ite_med med '+
               ' LEFT OUTER JOIN ctc_tb_m_orc orc ON orc.id_orc = med.id_orc '+
               ' LEFT OUTER JOIN ctc_tb_m_orc_ite ite ON ite.grupo = med.grupo '+
               ' LEFT OUTER JOIN cad_tb_c_par par ON par.id_empresa = orc.id_empresa '+
               ' LEFT OUTER JOIN ctc_tb_c_obr obr ON obr.id_obra = orc.id_obra '+
               ' LEFT OUTER JOIN  ctc_tb_c_eoc eoc ON eoc.id_estrutura = orc.id_estrutura '+
               ' LEFT OUTER JOIN cad_tb_c_fun fun ON fun.id_funcionario = med.id_responsavel ';
  end;
  { TODO -oLuan : Criado no dia 12/11/2015 }
  begin
    // AssignFile(arq,'C:Users\ST\Desktop\sql.txt');
     BUS_SQ_R_ORC_ITE_MED.Close;

     if Input[0] = 0 then
      begin
         BUS_SQ_R_ORC_ITE_MED.Commandtext := enSqlMedicao +
         ' where orc.id_obra = ''' + VarToStr(Input[1]) + ''' ';
      end
    else
    begin
       if Input[0] = 1 then
         begin
            BUS_SQ_R_ORC_ITE_MED.Commandtext := enSqlMedicao +
               ' where med.grupo = ''' + VarToStr(Input[1]) + ''' ';
         end
       else
         begin
             if Input[0] = 2 then
               begin
                    BUS_SQ_R_ORC_ITE_MED.Commandtext := enSqlMedicao +
                      ' where med.dta_medicao < ''' + FormatDateTime('mm/dd/yyyy', strToDate( VarToStr(Input[1])) )  +''' '+
                      ' and  med.dta_medicao > ''' + FormatDateTime('mm/dd/yyyy', strToDate( VarToStr(Input[2])) )  +''' ';
               end;
         end;
    end;
     if (Input[3] <> '') then
      begin
         BUS_SQ_R_ORC_ITE_MED.Commandtext := enSqlMedicao +
         ' and orc.id_empresa = ''' + VarToStr(Input[3]) + ''' ';
      end;

    BUS_SQ_R_ORC_ITE_MED.Commandtext :=  BUS_SQ_R_ORC_ITE_MED.Commandtext + ' ORDER BY   med.grupo ';
    //Rewrite(arq);
    //sql := BUS_SQ_R_ORC_ITE_MED.Commandtext;
   // Write(arq,sql);
   // CloseFile(arq);
    Result :=  BUS_DP_R_ORC_ITE_MED.Data;
    BUS_SQ_R_ORC_ITE_MED.Close;
end;

function TSM.BUS_DP_M_ORC_PLCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOrcPlc: String;
  begin
    Result :=
      ' select orc.id_empresa,orc.ano,plc.*,par.emp_fantasia as int_empfantasia,pct.descricao as int_descpct, '+
      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=1),0) AS real_jan, '+

      '   (100 - (plc.prev_jan*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=1)) as per_jan, '+

      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=2),0) AS real_fev, '+

      '    (100 - (plc.prev_fev*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=2)) as per_fev, '+

      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=3),0) AS real_mar, '+

      '   (100 - (plc.prev_mar*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=3)) as per_mar, '+

      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=4),0) AS real_abr, '+

      '   (100 - (plc.prev_abr*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=4)) as per_abr, '+

      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=5),0) AS real_mai, '+

      '   (100 - (plc.prev_mai*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=5)) as per_mai, '+

      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=6),0) AS real_jun, '+

      '   (100 - (plc.prev_jun*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=6)) as per_jun, '+

      ' COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=7),0) AS real_jul, '+

      '    (100 - (plc.prev_jul*100)/ '+
      '   (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=7)) as per_jul, '+

      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=8),0) AS real_ago, '+

      '    (100 - (plc.prev_ago*100)/ '+
      '    (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=8)) as per_ago, '+

      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=9),0) AS real_set, '+

      '    (100 - (plc.prev_set*100)/ '+
      '    (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=9)) as per_set, '+


      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=10),0) AS real_out, '+

      '    (100 - (plc.prev_out*100)/ '+
      '    (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=10)) as per_out, '+

      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=11),0) AS real_nov, '+

      '     (100 - (plc.prev_nov*100)/ '+
      '    (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=11)) as per_nov, '+

      '  COALESCE((select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '     left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=12),0) AS real_dez, '+

      '     (100 - (plc.prev_dez*100)/ '+
      '    (select sum(coalesce(ppg.vlr_pagamento,0)) from fin_tb_m_pag_pag ppg '+
      '    left outer join fin_tb_m_pag pag on pag.id_titulo=ppg.id_titulo '+
      '     where ppg.com_substituicao=false and pag.id_empresa = orc.id_empresa and '+
      '     extract(YEAR from ppg.dta_pagamento) = orc.ano '+
      '     and ppg.id_plano = plc.id_plc and extract(MONTH from ppg.dta_pagamento)=12)) as per_dez '+

      '     from fin_tb_m_orc_plc plc '+
      '     left outer join fin_tb_m_orc orc on orc.id_orc = plc.id_orc '+
      '     left outer join cad_tb_c_pct pct on pct.id_plano = plc.id_plc '+
      '     left outer join cad_tb_c_par par on par.id_empresa = orc.id_empresa ';
  end;
begin
    BUS_SQ_M_ORC_PLC.CommandText := enSqlOrcPlc;

    if (Input[0] <> '') then
      begin
        BUS_SQ_M_ORC_PLC.CommandText := BUS_SQ_M_ORC_PLC.CommandText +
             ' WHERE  orc.id_empresa in ('+VarToStr(Input[0])+') '+
             ' and orc.ano = '''+VarToStr(Input[1])+''''+
             ' and plc.id_plc in ('+VarToStr(Input[2])+') ';
      end
    else
      begin
        BUS_SQ_M_ORC_PLC.CommandText := BUS_SQ_M_ORC_PLC.CommandText +
             ' WHERE 1=2';
      end;

    Result := BUS_DP_M_ORC_PLC.Data;

    BUS_SQ_M_ORC_PLC.Close;
end;

function TSM.BUS_DP_R_ORVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiOrv: String;
  begin
    Result :=
        '  SELECT ORV.*,                                        '+
        '     CLI.NOME AS INT_NOMECLI,                          '+
        '     CLI.TEL_FIXO AS INT_TELFIX,                       '+
        '     CLI.TEL_MOVEL AS INT_TELMOV,                      '+
        '     CLI.DOC_CNPJ_CPF AS INT_CNPJCPFCLI,               '+
        '     CLI.ENDERECO AS INT_ENDERECOCLI, CLI.BAIRRO AS INT_BAIRROCLI, ' +
        '     CLI.CEP AS INT_CEPCLI, CID.NOME AS INT_NOMECID, CID.UF AS INT_UFCID, CLI.NUMERO AS INT_NUMEROCLI, ' +
        '     case                                              '+
        '       when VEI.COMBUSTIVEL = 0 then ''Gasolina''      '+
        '       when VEI.COMBUSTIVEL = 1 then ''Alcool''        '+
        '       when VEI.COMBUSTIVEL = 2 then ''Diesel''        '+
        '       when VEI.COMBUSTIVEL = 3 then ''Gas Natural''   '+
        '       when VEI.COMBUSTIVEL = 4 then ''Eletrico''      '+
        '       when VEI.COMBUSTIVEL = 5 then ''Flex''          '+
        '     end as INT_NOMECOM,                               '+
        '     VEI.ID_PLACA AS INT_PLACA, VEI.DESCRICAO AS INT_NOMEVEI, '+
        '     VEI.CHASSI AS INT_CHASSIVEI, VEI.ANO_MODELO AS INT_ANOMODELO, ' +
        '     VEI.ANO_FABRICACAO AS INT_ANOFABRIC, VEI.MOTOR AS INT_MOTORVEI, ' +
        '     MVE.DESCRICAO AS INT_MODELOMVE, COR.DESCRICAO AS INT_NOMECOR,  ' +
        '     TIO.DESCRICAO AS INT_NOMETIO,                      ' +
        '     CPG.DESCRICAO AS int_nomecpg, ANA.NOME AS INT_NOMEANA,  ' +
        '     eqp.descricao as int_nomeeqp, eqp.modelo as int_modeloeqp, ' +
        '     eqp.serial as int_serialeqp, eqp.garantia as int_garantiaeqp, ' +
        '     meq.descricao as int_nomemeq,meq.nro_serie as int_seriemeq, '+
        '     mde.descricao as int_modelomeq,                             '+
        '     meq.tipo as int_tipomeq,meq.id_placa as int_placa_meq,      '+
        '     meq.ano_modelo as int_anomodelo_meq,meq.ano_fabricacao as int_anofab_meq, '+
        '     crm.descricao as int_nomecor_meq,meq.chassi as int_chassi_meq,             '+
        '     meq.tipo_mei as int_tipomei,                                               '+
        '     ate.nome as int_nomeate '+
        '  FROM OFI_TB_M_ORV ORV                                ' +
        '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE            ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA       ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=ORV.ID_ATENDENTE       '+
        '  LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO            ' +
        '  left outer join cad_tb_c_eqp eqp on                                          ' +
        '       eqp.id_equipamento = orv.id_equipamento                                 ' +
        '  LEFT OUTER JOIN CAD_TB_C_MVE MVE ON MVE.ID_MVE=VEI.ID_MVE                    ' +
        '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG        ' +
        '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG  ' +
        '  LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS ' +
        '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE ' +
        '  LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = VEI.ID_COR '+
        '  LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ '+
        '  LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE = MEQ.ID_MDE '+
        '  LEFT OUTER JOIN CAD_TB_C_COR CRM ON CRM.ID_COR = MEQ.ID_COR ';
  end;
begin
   BUS_SQ_R_ORV.Close;
   BUS_SQ_R_ORV.CommandText := enSqlRelOfiOrv +
             ' WHERE ORV.ID_ORDEM in (' + VarToStr(Input[0]) +') ';
   Result := BUS_DP_R_ORV.Data;
   BUS_SQ_R_ORV.Close;
end;

function TSM.BUS_DP_M_ORS_ICO_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOrsIcoInt: String;
  begin
    Result := ' SELECT ICO.* , ' +
              '   COR.DESCRICAO AS INT_NOMECOR, ' +
              '   TAM.DESCRICAO AS INT_NOMETAM, GRU.TIPO_ITEM  AS  INT_TIPO_ITEM   ' +
              ' FROM PCP_TB_M_ORS_ICO ICO ' +
              '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM = ICO.ID_ITEM ' +
              '  left outer join CAD_TB_C_GRU GRU on GRU.ID_GRUPO = ITE.ID_GRUPO ' +
              '  LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = ICO.ID_COR ' +
              '  LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO = ICO.ID_TAMANHO ';


  end;
begin
   BUS_SQ_M_ORS_ICO_INT.Close;

   BUS_SQ_M_ORS_ICO_INT.CommandText := enSqlOrsIcoInt +
       ' WHERE ICO.ID_ORS =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_ORS_ICO_INT.Data;

   BUS_SQ_M_ORS_ICO_INT.Close;
end;

function TSM.BUS_DP_M_ORS_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOrsIteInt: String;
  begin
    Result := ' SELECT OIT.* , ' +
              '   COR.DESCRICAO AS INT_NOMECOR, ' +
              '   TAM.DESCRICAO AS INT_NOMETAM, GRU.TIPO_ITEM  AS  INT_TIPO_ITEM   ' +
              ' FROM PCP_TB_M_ORS_ITE OIT ' +
              '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM = OIT.ID_ITEM ' +
              '  left outer join CAD_TB_C_GRU GRU on GRU.ID_GRUPO = ITE.ID_GRUPO ' +
              ' LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = OIT.ID_COR ' +
              ' LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO = OIT.ID_TAMANHO ';


  end;
begin
   BUS_SQ_M_ORS_ITE_INT.Close;

   BUS_SQ_M_ORS_ITE_INT.CommandText := enSqlOrsIteInt +
       ' WHERE OIT.ID_ORS =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_ORS_ITE_INT.Data;

   BUS_SQ_M_ORS_ITE_INT.Close;
end;

function TSM.BUS_DP_M_ORS_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOrsTitInt: String;
  begin
    Result := ' SELECT OTI.*  FROM PCP_TB_M_ORS_TIT OTI ';
  end;
begin
   BUS_SQ_M_ORS_TIT_INT.Close;

   BUS_SQ_M_ORS_TIT_INT.CommandText := enSqlOrsTitInt +
       ' WHERE OTI.ID_ORS =       ''' + VarToStr(Input[0]) +''' ';

   Result := BUS_DP_M_ORS_TIT_INT.Data;
end;

function TSM.BUS_DP_M_ORVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiOrv: String;
  begin
    Result :=
        '  SELECT ORV.*,                  '+
        '     CLI.doc_cnpj_cpf AS INT_CPFCNPJ,                  '+
        '     CLI.pessoa as int_pessoacli,                         '+
        '     CLI.NOME AS INT_NOMECLI,                          '+
        '     CLI.TEL_FIXO AS INT_TELFIX,                       '+
        '     CLI.TEL_MOVEL AS INT_TELMOV,                      '+
        '     case                                              '+
        '       when VEI.COMBUSTIVEL = 0 then ''Gasolina''      '+
        '       when VEI.COMBUSTIVEL = 1 then ''Alcool''        '+
        '       when VEI.COMBUSTIVEL = 2 then ''Diesel''        '+
        '       when VEI.COMBUSTIVEL = 3 then ''Gas Natural''   '+
        '       when VEI.COMBUSTIVEL = 4 then ''Eletrico''      '+
        '       when VEI.COMBUSTIVEL = 5 then ''Flex''          '+
        '     end as INT_NOMECOM,                               '+
        '     VEI.ID_PLACA AS INT_PLACA, VEI.DESCRICAO AS INT_NOMEVEI, '+
        '     TIO.DESCRICAO AS INT_NOMETIO, TIO.TIPO AS INT_TIPO_OS, CID.UF AS INT_UFCLI,     ' +
        '     VEI.ID_MVE, MVE.DESCRICAO AS INT_NOMEMVE,  ' +
        '     cast( case status_painel                           '+
        '        when  0  then ''Aguardando incio do servio''  '+
        '        when  1  then ''Prximas Ordens de Servios''   '+
        '        when  2  then ''Em Servio''      '+
        '        when  3  then ''Pr-Inspeo''      '+
        '        when  4  then ''Aguardando Lavagem''      '+
        '        when  5  then ''Inspeo Final''      '+
        '        when  6  then ''Aguardando Aprovao''      '+
        '        when  7  then ''Aguardando Peas''      '+
        '        when  8  then ''Aguardando Servio''      '+
        '        when  9  then ''Aguardando Pr-Entrega''      '+
        '        when  10 then ''Aguardando Entrega''      '+
        '        when  11 then ''Entregue''      '+
        '     end  as varchar(30)) as int_statuspainel, ' +
        '     eqp.descricao as int_nomeeqp ' +
        '  FROM OFI_TB_M_ORV ORV                                '+
        '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE            ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA       ' +
        '  LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO            ' +
        '  LEFT OUTER JOIN CAD_TB_C_MVE MVE ON MVE.ID_MVE=VEI.ID_MVE               ' +
        '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG        ' +
        '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG  ' +
        '  LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS     ' +
        '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE       ' +
        '  LEFT OUTER JOIN CAD_TB_C_EQP EQP ON EQP.ID_EQUIPAMENTO = ORV.ID_EQUIPAMENTO' ;
  end;
begin
   BUS_SQ_M_ORV.Close;

   if Input[0]=0 then
      BEGIN
        BUS_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_ORDEM IN (' + VarToStr(Input[1]) +') ';
      END;

   Result := BUS_DP_M_ORV.Data;
   BUS_SQ_M_ORV.Close;

end;

function TSM.BUS_DP_M_ORV_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiOrvIte: String;
  begin
    Result :=
              'SELECT ORI.*,                                                         '+
              '         ITE.DESCRICAO        AS INT_NOMEITE,                         '+
              '         COR.DESCRICAO AS INT_NOMECOR,                                '+
              '         TAM.DESCRICAO AS INT_NOMETAM,                                '+
              '         GRU.TIPO_ITEM AS INT_TIPO_ITEM,                              '+
              '         FRN.ID_FORNECEDOR AS INT_CODFOR,                             '+
              '         FRN.DESCRICAO AS INT_NOMEFOR                                 '+
              '                                                                      '+
              '  FROM OFI_TB_M_ORV_ITE ORI                                           '+
              '  LEFT OUTER JOIN CAD_TB_C_ITE    ITE ON  ITE.ID_ITEM=ORI.ID_ITEM     '+
              '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO     '+
              '  LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = ORI.ID_COR         '+
              '  LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO = ORI.ID_TAMANHO '+
              '  LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR = ITE.ID_FORNECEDOR ';


  end;
begin
   BUS_SQ_M_ORV_ITE_INT.Close;
   BUS_SQ_M_ORV_ITE_INT.CommandText := enSqlRelOfiOrvIte +
             ' WHERE ORI.ID_ORDEM = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_ORV_ITE_INT.Data;
   BUS_SQ_M_ORV_ITE_INT.Close;
end;

function TSM.BUS_DP_M_ORV_PRO_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiRqv: String;
  begin
    Result :=
              ' SELECT ORI.*, ITE.DESCRICAO AS INT_NOMEITE, ' +
              '  COR.DESCRICAO AS INT_NOMECOR, ' +
              '  TAM.DESCRICAO AS INT_NOMETAM, ' +
              '  GRU.TIPO_ITEM  AS INT_TIPO_ITEM ' +
              '                                            ' +
              ' FROM OFI_TB_M_ORV_ITE ORI                  ' +
              '   LEFT OUTER JOIN CAD_TB_C_ITE    ITE ON  ITE.ID_ITEM=ORI.ID_ITEM ' +
              '   LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO ' +
              '   LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = ORI.ID_COR ' +
              '   LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO = ORI.ID_TAMANHO ';

  end;
begin
   BUS_SQ_M_ORV_PRO_INT.Close;
   BUS_SQ_M_ORV_PRO_INT.CommandText := enSqlRelOfiRqv +
             ' WHERE ORI.ID_ORDEM = ''' + VarToStr(Input[0]) +''' ';
            // '   AND GRU.TIPO_ITEM <> ''09'' ';
   Result := BUS_DP_M_ORV_PRO_INT.Data;
   BUS_SQ_M_ORV_PRO_INT.Close;
end;

function TSM.BUS_DP_M_ORV_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiOrvTit: String;
  begin
    Result :=
              ' SELECT ORT.*,                                                           '+
              '         FPG.DESCRICAO AS INT_NOMEFPG                                    '+
              '  FROM OFI_TB_M_ORV_TIT ORT                                              '+
              '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORT.ID_FORMA_PAG  ';
  end;
begin
   BUS_SQ_M_ORV_TIT_INT.Close;
   BUS_SQ_M_ORV_TIT_INT.CommandText := enSqlRelOfiOrvTit +
             ' WHERE ORT.ID_ORDEM = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_ORV_TIT_INT.Data;
   BUS_SQ_M_ORV_TIT_INT.Close;
end;

function TSM.BUS_DP_M_ORV_TIT_SER_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiOrvTitSer: String;
  begin
    Result :=
              ' SELECT ORT.*,                                                           '+
              '         FPG.DESCRICAO AS INT_NOMEFPG                                    '+
              '  FROM OFI_TB_M_ORV_TIT_SER ORT                                              '+
              '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORT.ID_FORMA_PAG  ';
  end;
begin
   BUS_SQ_M_ORV_TIT_SER_INT.Close;
   BUS_SQ_M_ORV_TIT_SER_INT.CommandText := enSqlRelOfiOrvTitSer +
             ' WHERE ORT.ID_ORDEM = ''' + VarToStr(Input[0]) +''' ';
   Result := BUS_DP_M_ORV_TIT_SER_INT.Data;
   BUS_SQ_M_ORV_TIT_SER_INT.Close;
end;

function TSM.BUS_DP_R_ROM_VLCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRomVlc: String;
  begin
    Result :=
      ' select rom.*, mta.nome,' + #13#10 +
      '          ( select sum(ped.vlr_liquido) from pcp_tb_m_rom_ped rpd ' + #13#10 +
      '                left outer join fat_tb_m_ped ped on ped.id_pedido = rpd.id_pedido' + #13#10 +
      '            where rpd.id_rom = rom.id_rom ) as vlr_carga' + #13#10 +
      ' from pcp_tb_m_rom rom ' + #13#10 +
      '    left outer join pcp_tb_c_mta mta on mta.id_motorista = rom.id_motorista   ' + #13#10 ;

  end;
begin
   { TODO -oMaxsuel Victor : Criado em 13/11/2019 }
   BUS_SQ_R_ROM_VLC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           BUS_SQ_R_ROM_VLC.CommandText := enSqlRomVlc + ' WHERE 1=2 '
        else
           BUS_SQ_R_ROM_VLC.CommandText := enSqlRomVlc +
             ' WHERE ROM.ID_EMPRESA  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND ROM.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
             '   AND ROM.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             '   AND ROM.ID_MOTORISTA  = ''' + VarToStr(Input[4]) +''' ';

      end;

   BUS_SQ_R_ROM_VLC.CommandText := BUS_SQ_R_ROM_VLC.CommandText + ' order by rom.dta_emissao, rom.id_rom ';

   Result := BUS_DP_R_ROM_VLC.Data;

end;

function TSM.BUS_DP_R_RQVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiRqv: String;
  begin
    Result :=
         ' select false as int_selecao, req.id_ordem,req.id_requisicao,req.dta_requisicao,    ' +
         '   cli.nome as int_nomecli, '  +
         '   vei.descricao as int_nomevei, vei.id_placa as int_placavei,         ' +
         '   vei.chassi as int_chassi,  vei.ano_fabricacao as int_fabricadovei,  ' +
         '   mve.descricao as int_modelomve, ' +
         '   cor.descricao as int_nomecor,   ' +
         '   eqp.descricao as int_nomeeqp   ' +
         '         ' +
         '   from  ' +
         '       ( select rit.id_ordem, rit.id_requisicao, ' +
         '          rit.dta_requisicao from ofi_tb_m_orv_ite rit ' +
         '      left outer join cad_tb_c_ite ite on ite.id_item = rit.id_item '+
         '      left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo '+
         '        where                              ' +
         '           rit.id_ordem       = ''' + VarToStr(Input[0]) + ''' ' +
         '       and  rit.cancelada = false and gru.tipo_item<>''09'' ) as req   ' +
         '                                            ' +
         '   left outer join ofi_tb_m_orv orv on      ' +
         '       (orv.id_ordem = req.id_ordem)        ' +
         '   left outer join cad_tb_c_vei vei on      ' +
         '        (vei.id_veiculo = orv.id_veiculo)   ' +
         '    left outer join cad_tb_c_mve mve on     ' +
         '        (vei.id_mve = mve.id_mve)           ' +
         '    left outer join cad_tb_c_cor cor on     ' +
         '        (cor.id_cor = vei.id_cor)           ' +
         '    left outer join cad_tb_c_cli  cli on    ' +
         '        (cli.id_cliente = orv.id_cliente)   ' +
         '    left outer join cad_tb_c_eqp eqp on     ' +
         '        (eqp.id_equipamento = orv.id_equipamento) ' ;
  end;
begin
   BUS_SQ_R_RQV.Close;
   BUS_SQ_R_RQV.CommandText := enSqlRelOfiRqv +
             ' WHERE REQ.ID_ORDEM = ''' + VarToStr(Input[0]) +''' ' +
             ' group by 1,2,3,4,5,6,7,8,9,10,11,12';
   Result := BUS_DP_R_RQV.Data;
   BUS_SQ_R_RQV.Close;
end;

function TSM.BUS_DP_C_TRI_REGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTriReg: String;
  begin
    Result := ' select * from CAD_TB_C_TRI_REG ';
  end;
begin
   BUS_SQ_C_TRI_REG.Close;
   if VarToStr(Input[2])<>'' then
      begin
        BUS_SQ_C_TRI_REG.CommandText := enSqlTriReg +
           ' WHERE ID_TRIBUTO =       ''' + VarToStr(Input[0]) +''' AND '+
           '       ID_TIPO_MOV_ESTOQUE =  ''' + VarToStr(Input[1]) +''' AND '+
           '       UF = ''' + VarToStr(Input[2]) +''' and '+
           '       ID_EMPRESA = ''' + VarToStr(Input[3]) +''' ';

      end
   else
      begin
        BUS_SQ_C_TRI_REG.CommandText := enSqlTriReg +
           ' WHERE ID_TRIBUTO =       ''' + VarToStr(Input[0]) +''' AND '+
           '       ID_TIPO_MOV_ESTOQUE =  ''' + VarToStr(Input[1]) +''' AND '+
           '       ID_EMPRESA = ''' + VarToStr(Input[3]) +''' ';

      end;
   Result := BUS_DP_C_TRI_REG.Data;
end;

function TSM.BUS_DP_C_VIT_CONDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlVisCon: String;
  begin
    Result :=
        ' select par.emp_fantasia,  cli.nome as nome_cli , ven.nome, vei.descricao as nome_carro, vit.*, kmt.km_inicial, kmt.km_final  ' +
        ' from cad_tb_c_vit vit '+
        '  left outer join cad_tb_c_vit_kmt kmt on (kmt.id_visita    = vit.id_visita)      '+
        '  left outer join cad_tb_c_cli cli     on (cli.id_cliente   = vit.id_cliente)   '+
        '  left outer join cad_tb_c_vei vei     on (vei.id_veiculo   = vit.id_veiculo)     '+
        '  left outer join cad_tb_c_fun ven     on (ven.id_funcionario  = vit.id_vendedor) '+
        '  left outer join cad_tb_c_par par     on (par.id_empresa = vit.id_empresa) ' +
        ' where 1 = 1 ';
  end;
begin
   BUS_SQ_C_VIT_CON.Close;
   BUS_SQ_C_VIT_CON.CommandText := enSqlVisCon;
   if Input[0] = 0 then
      begin
        BUS_SQ_C_VIT_CON.CommandText := BUS_SQ_C_VIT_CON.CommandText +
            '  and extract(year from vit.dta_visita) = ''' + VarToStr(Input[1]) +''' ' +
            '  and vit.semana >= ''' + VarToStr(Input[2]) + '''  and vit.semana <= ''' + VarToStr(Input[3]) +''' ' +
            '  and vit.id_vendedor = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        BUS_SQ_C_VIT_CON.CommandText := BUS_SQ_C_VIT_CON.CommandText +
           ' and vit.dta_visita >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
           ' and vit.dta_visita <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
           ' and vit.id_vendedor = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        BUS_SQ_C_VIT_CON.CommandText := BUS_SQ_C_VIT_CON.CommandText + ' and 1 = 2 ';
      end;

   BUS_SQ_C_VIT_CON.CommandText := BUS_SQ_C_VIT_CON.CommandText +
            ' order by vit.dta_visita, vit.hor_ini ';

   Result := BUS_DP_C_VIT_CON.Data;

   BUS_SQ_C_VIT_CON.close;
end;

function TSM.CAD_DP_C_CCRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCcr: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CCR  ';
  end;
begin
   CAD_SQ_C_CCR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CCR.CommandText := enSqlCcr + ' WHERE 1=2 '
        else
           CAD_SQ_C_CCR.CommandText := enSqlCcr +
             ' WHERE ID_CCR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CCR.CommandText := enSqlCcr +
          Format(' WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
    else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CCR.CommandText := enSqlCcr + ' WHERE 1=2 '
        else
           CAD_SQ_C_CCR.CommandText := enSqlCcr +
             ' WHERE CNPJ = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := CAD_DP_C_CCR.Data;
end;

function TSM.CAD_DP_C_CCUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCcu: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CCU  ';
  end;
begin
   CAD_SQ_C_CCU.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CCU.CommandText := enSqlCcu + ' WHERE 1=2 '
        else
           CAD_SQ_C_CCU.CommandText := enSqlCcu +
             ' WHERE ID_CCUSTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CCU.CommandText := enSqlCcu +
          Format(' WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   CAD_SQ_C_CCU.CommandText := CAD_SQ_C_CCU.CommandText + ' ORDER BY ID_CCUSTO ';

   Result := CAD_DP_C_CCU.Data;

end;

function TSM.CAD_DP_C_CFODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCfo: String;
  begin
    Result :=
      ' SELECT CFO.* , NAT.DESCRICAO AS INT_NOMENAT '+
      ' FROM CAD_TB_C_CFO CFO '+
      '   LEFT OUTER JOIN CAD_TB_C_NAT NAT ON NAT.ID_CLASSE=CFO.ID_CLASSE ';
  end;
begin
   CAD_SQ_C_CFO.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CFO.CommandText := enSqlCfo + ' WHERE 1=2 '
        else
           CAD_SQ_C_CFO.CommandText := enSqlCfo +
             ' WHERE CFO.ID_CFO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CFO.CommandText := enSqlCfo +
          Format(' WHERE upper(CFO.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           CAD_SQ_C_CFO.CommandText := enSqlCfo +
             ' WHERE CFO.ID_CLASSE in (' + VarToStr(Input[1]) +') ';
     end

   else if Input[0] = 3 then
      begin
           CAD_SQ_C_CFO.CommandText := enSqlCfo +
               Format(' WHERE upper(CFO.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                      ' AND CFO.ID_CLASSE in (' + VarToStr(Input[2]) +') ';
     end;

   CAD_SQ_C_CFO.CommandText := CAD_SQ_C_CFO.CommandText + ' Order By CFO.ID_CFO ';

   Result := CAD_DP_C_CFO.Data;
   CAD_SQ_C_CFO.Close;
end;

function TSM.CAD_DP_C_CIDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCid: String;
  begin
    Result :=
       ' SELECT CID.*,PAI.DESCRICAO AS INT_NOMEPAI '+
       '   FROM CAD_TB_C_CID CID '+
       '   LEFT OUTER JOIN CAD_TB_C_PAI PAI ON (PAI.ID_PAIS=CID.COD_PAIS) ';
  end;
begin
   CAD_SQ_C_CID.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CID.CommandText := enSqlCid + ' WHERE 1=2 '
        else
           CAD_SQ_C_CID.CommandText := enSqlCid +
             ' WHERE ID_CIDADE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CID.CommandText := enSqlCid +
          ' WHERE upper(unaccent(nome)) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';

//          Format('WHERE upper(NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_CID.CommandText := enSqlCid +
          'WHERE upper(UF) = upper(''' + VarToStr(Input[1]) +''') ';
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_CID.CommandText := enSqlCid +
          'WHERE CEP = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_CID.CommandText := enSqlCid +
          'WHERE upper(UF) in (' + VarToStr(Input[1]) +') ';
      end;

   Result := CAD_DP_C_CID.Data;
end;

function TSM.CAD_DP_C_CINDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCin: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CIN  ';
  end;
begin
   CAD_SQ_C_CIN.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CIN.CommandText := enSqlCin + ' WHERE 1=2 '
        else
           CAD_SQ_C_CIN.CommandText := enSqlCin +
             ' WHERE id_cli_informa = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CIN.CommandText := enSqlCin +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_CIN.Data;
end;

function TSM.CAD_DP_C_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCli: String;
  begin
    Result := ' SELECT false as int_selecao, CLI.*, CID.UF INT_UF, CID.NOME AS INT_NOMECID, '+
              '     CDD.UF INT_AVAL_UF,  CDD.NOME AS INT_AVAL_NOMECID, ' +
              '  cast( CASE SITUACAO ' +
              '    WHEN 0 THEN ''Normal'' ' +
              '    WHEN 1 THEN ''Especial'' ' +
              '    WHEN 2 THEN ''Crdito encerrado'' ' +
              '  END AS VARCHAR(30) ) AS int_situacao, ' +
              '  cast( CASE CLI.SEXO ' +
              '    WHEN 0 THEN ''Feminino'' ' +
              '    WHEN 1 THEN ''Masculino'' ' +
              '  END AS VARCHAR(10) ) AS int_sexo, ' +

              '    cast( CASE CLI.PESSOA '+
              '    WHEN 0 THEN ''Fsica''  '+
              '    WHEN 1 THEN ''Jurdica''  '+
              '  END AS VARCHAR(10) ) AS int_pessoa, '+

              '    REG.DESCRICAO AS INT_NOMEREG, ' +
              '    REG.unifica_desc_reg AS INT_UNIF_DESC_REG, ' +
              '    REG.DESC_PERC AS INT_REG_DESC_PERC, '+
              ' PAI.DESCRICAO AS INT_NOMEPAI, '+
              ' FUN.NOME AS INT_NOMERESP, '+
              ' FUN2.NOME AS INT_NOMEVND, '+
              '  PEC.DESCRICAO AS INT_NOMEPEC '+

              ' FROM CAD_TB_C_CLI CLI ' +
              ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE ' +
              ' LEFT OUTER JOIN CAD_TB_C_CID CDD ON CDD.ID_CIDADE=CLI.AVAL_ID_CIDADE ' +
              ' LEFT OUTER JOIN PCP_TB_C_REG REG ON  ' +
              '      (REG.ID_REGIAO = CLI.ID_REGIAO) '+
              ' LEFT OUTER JOIN CAD_TB_C_PAI PAI ON (PAI.ID_PAIS = CLI.COD_PAIS) '+
              ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON (FUN.ID_FUNCIONARIO=CLI.ID_RESPONSAVEL) '+
              ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON (PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI) '+
              ' LEFT OUTER JOIN CAD_TB_C_FUN FUN2 ON (FUN2.ID_FUNCIONARIO=CLI.ID_VENDEDOR) ';

  end;
begin

   { Cdigo
    Nome
    CNPJ/CPF
    IE
    Cidade
    Apelido }


   CAD_SQ_C_CLI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CLI.CommandText := enSqlCli + ' WHERE 1=2 '
        else
           CAD_SQ_C_CLI.CommandText := enSqlCli +
             ' WHERE CLI.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          Format('WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+
          ' ORDER BY CLI.NOME ';
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.doc_cnpj_cpf = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.DOC_IE_IDENTIDADE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          Format('WHERE upper(CID.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+
           ' ORDER BY CLI.NOME ';
      end
   else if Input[0] = 5 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          Format('WHERE upper(cli.apelido) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 6 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.ID_ROTA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 7 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.ATIVO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 80 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          ' WHERE CLI.ID_CLIENTE <> ''' + VarToStr(Input[1]) +''' ' +
          '   AND CLI.doc_cnpj_cpf = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 81 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          ' WHERE CLI.ID_ROTA = ''' + VarToStr(Input[1]) +''' ' +
          '   AND CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 82 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          ' WHERE CLI.ID_CLIENTE in (' + VarToStr(Input[1]) +')';
      end
   else if Input[0] = 83 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          ' WHERE CLI.ID_VENDEDOR = ''' + VarToStr(Input[1]) +''' ' +
          '   AND CLI.ATIVO = TRUE ' +
          ' ORDER BY CLI.NOME ';
      end
   else if Input[0] = 84 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          ' WHERE CLI.doc_cnpj_cpf in (' + VarToStr(Input[1]) +') ' +
          '  and CLI.ATIVO = true '+
          ' ORDER BY CLI.NOME ';
      end
   else if Input[0] = 85 then
      begin
          if Trim(VarToStr(Input[1])) = '' then
             CAD_SQ_C_CLI.CommandText := enSqlCli + ' WHERE 1=2 '
          else
             CAD_SQ_C_CLI.CommandText := enSqlCli +
               ' WHERE CLI.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ' +
               '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 86 then
       begin
          CAD_SQ_C_CLI.CommandText := enSqlCli +
              Format('WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                     '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ' +
                     ' ORDER BY CLI.NOME ';
       end

   else if Input[0] = 87 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.doc_cnpj_cpf = ''' + VarToStr(Input[1]) +''' ' +
          '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 88 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          'WHERE CLI.DOC_IE_IDENTIDADE = ''' + VarToStr(Input[1]) +''' ' +
          '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 89 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          Format('WHERE upper(CID.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+
          '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ' +
           ' ORDER BY CLI.NOME ';
      end
   else if Input[0] = 90 then
      begin
        CAD_SQ_C_CLI.CommandText := enSqlCli +
          Format('WHERE upper(cli.apelido) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
          '   and CLI.ID_VENDEDOR = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := CAD_DP_C_CLI.Data;
   CAD_SQ_C_CLI.Close;

end;

procedure TSM.CAD_DP_C_CLIGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_CLIUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
 { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_CLI_EXT_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlCliExtIte: String;
begin

    { TODO -oMaxsuel -cCriao :
     Criado em 16/08/2016
     Mtodo utilizado pela Extrato de Cliente. }

   enSqlCliExtIte :=
          {
          ' select' + #13#10 +
          '    nfe.id_empresa, par.emp_fantasia,tme.descricao as int_nometme,' + #13#10 +
          '     nfe.numero, nfe.dta_emissao,nfe.id_tipo_mov_estoque, nit.id_item, ite.descricao as int_nomeite, ite.id_und_venda as int_undvenda, ' + #13#10 +
          '     nit.id_cor, cor.descricao as int_nomecor, nit.id_tamanho, tam.descricao as int_nometam, ' + #13#10 +
          '     ite.id_grupo, gru.descricao as int_nomegru,' + #13#10 +
          '     nit.qtde, nit.qtde_devolvida,' + #13#10 +
          '     (nit.qtde-nit.qtde_devolvida) as int_qtde_liq, nit.vlr_unitario,    ' + #13#10 +
          '     cast(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida) as numeric(18,2)) as vlr_bruto, ' + #13#10 +
          '     cast((coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida) as numeric(18,2) ) as vlr_desconto,' + #13#10 +
          '      ' + #13#10 +
          '     cast(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0) - ' + #13#10 +
          '     ((coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)) as numeric(18,2)) vlr_liquido    ' + #13#10 +
          ' from fat_tb_m_nfe_ite nit ' + #13#10 +
          '             left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal            ' + #13#10 +
          '             left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa' + #13#10 +
          '             left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo ' + #13#10 +
          '             left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag            ' + #13#10 +
          '             left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item' + #13#10 +
          '             left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo' + #13#10 +
          '             left outer join cad_tb_c_cor cor on cor.id_cor = nit.id_cor' + #13#10 +
          '             left outer join cad_tb_c_tam tam on tam.id_tamanho = nit.id_tamanho   ' + #13#10 +
          '             left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque ' +
          ' where nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and ' + #13#10 +
          '      nfe.faturada = true and nfe.tipo_nf = ''S'' ' + #13#10; }

         ' select  '+
         '    nfe.id_tipo_mov_estoque,tme.descricao as int_nometme, nit.id_item, ite.descricao as int_nomeite, ite.id_und_venda as int_undvenda, '+
         '    nit.id_cor, cor.descricao as int_nomecor, nit.id_tamanho, tam.descricao as int_nometam, '+
         '    ite.id_grupo, gru.descricao as int_nomegru, ' +
         '    SUM(COALESCE(nit.qtde,0)) AS qtde, '+
         '    sum(COALESCE(nit.qtde_devolvida,0)) as qtde_devolvida, '+
         '    sum(COALESCE(nit.qtde-nit.qtde_devolvida,0)) as int_qtde_liq, '+

         '    cast(sum(COALESCE(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0)) as numeric(18,2)) as vlr_bruto, '+
         '    cast(sum((coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida)) as numeric(18,2) ) as vlr_desconto, '+

         '    cast(sum(coalesce(nit.vlr_unitario*(nit.qtde-nit.qtde_devolvida),0) -  '+
         '    ((coalesce(nit.vlr_desconto,0)/ nit.qtde) * (nit.qtde-nit.qtde_devolvida))) as numeric(18,2)) vlr_liquido   '+
         '  from fat_tb_m_nfe_ite nit  '+
         '              left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal  '+
         '              left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa  '+
         '              left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo    '+
         '              left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag  '+
         '              left outer join cad_tb_c_ite ite on ite.id_item = nit.id_item   '+
         '              left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo  '+
         '              left outer join cad_tb_c_cor cor on cor.id_cor = nit.id_cor  '+
         '              left outer join cad_tb_c_tam tam on tam.id_tamanho = nit.id_tamanho '+
         '             left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque  '+
         ' where nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1 and ' + #13#10 +
         '      nfe.faturada = true and nfe.tipo_nf = ''S'' ' + #13#10;

   CAD_SQ_C_CLI_EXT_ITE.Close;

   CAD_SQ_C_CLI_EXT_ITE.CommandText := enSqlCliExtIte +
             '   and nfe.ID_EMPRESA  in  (' + VarToStr(Input[0]) +')'  +
             '   and nfe.ID_EMITENTE  = ''' + VarToStr(Input[1]) +''' '+
             '   AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
             '   AND NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             '   GROUP BY 1,2,3,4,5,6,7,8,9,10,11 '+
             '   ORDER BY int_nometme, int_nomeite, int_nomecor,int_nometam ';
            // '   order by int_nometme, nfe.id_empresa, nfe.dta_emissao, nfe.numero, ite.descricao ';
   Result := CAD_DP_C_CLI_EXT_ITE.Data;
   CAD_SQ_C_CLI_EXT_ITE.Close;

end;

function TSM.CAD_DP_C_CNEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCne: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CNE  ';
  end;
begin
   CAD_SQ_C_CNE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CNE.CommandText := enSqlCne + ' WHERE 1=2 '
        else
           CAD_SQ_C_CNE.CommandText := enSqlCne +
             ' WHERE ID_CNAE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CNE.CommandText := enSqlCne +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   CAD_SQ_C_CNE.CommandText := CAD_SQ_C_CNE.CommandText + ' ORDER BY ID_CNAE ';
   Result := CAD_DP_C_CNE.Data;
   CAD_SQ_C_CNE.Close;
end;

procedure TSM.CAD_DP_C_CNEUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  dspUpdateData(Sender, DataSet);

end;

function TSM.CAD_DP_C_CORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCor: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_COR ';
  end;
begin
   CAD_SQ_C_COR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_COR.CommandText := enSqlCor + ' WHERE 1=2 '
        else
           CAD_SQ_C_COR.CommandText := enSqlCor +
             ' WHERE ID_COR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_COR.CommandText := enSqlCor +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if input[0] = 2 then
      begin
        CAD_SQ_C_COR.CommandText := enSqlCor +
             ' WHERE ID_COR IN (SELECT CRG.ID_COR FROM CAD_TB_C_GRU_COR CRG ' +
             '                      WHERE  CRG.ID_GRUPO = ''' + VarToStr(Input[1]) +''' )';

        Result := CAD_DP_C_COR.Data;
        if CAD_SQ_C_COR.RecordCount = 0 then
           begin
             CAD_SQ_C_COR.Close;
             CAD_SQ_C_COR.CommandText := enSqlCor + ' ORDER BY DESCRICAO';
             Result := CAD_DP_C_COR.Data;
           end;
      end;

   if (Input[0] = 0) or (Input[0] = 1) then
      Result := CAD_DP_C_COR.Data;

   CAD_SQ_C_COR.Close;
end;

function TSM.CAD_DP_C_CPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCpg: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CPG CPG  ';
  end;
var
   BUS_CD_C_PAR_CTR: TClientDataSet;
   BUS_CD_C_PAR_MOD: TDataSet;
begin

   CAD_SQ_C_CPG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CPG.CommandText := enSqlCpg + ' WHERE 1=1 '
        else
           CAD_SQ_C_CPG.CommandText := enSqlCpg +
             ' WHERE CPG.ID_CONDICAO_PAG= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CPG.CommandText := enSqlCpg +
          Format('WHERE upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_CPG.CommandText := enSqlCpg +
             ' WHERE CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO IN (1,2) AND ' +
             Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        // Buscar dados do parmetros de controle
        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
        BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
           BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([VarToStr(Input[1])]));

        BUS_CD_C_PAR_MOD := TDataSetField(BUS_CD_C_PAR_CTR.FieldByName('BUS_SQ_C_PAR_MOD')).NestedDataSet;

        if BUS_CD_C_PAR_MOD.FieldByName('SGQ').AsBoolean then
           begin
              CAD_SQ_C_CPG.CommandText := enSqlCpg +
                   ' WHERE CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO IN (0,1,2)  ' +
                   ' AND EXISTS (SELECT * FROM CAD_TB_C_PAR_CPG PPG          ' +
                   '             WHERE PPG.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
                   '               AND PPG.ID_CONDICAO_PAG = CPG.ID_CONDICAO_PAG) ';
           end
        else
           begin
              CAD_SQ_C_CPG.CommandText := enSqlCpg +
                   ' WHERE CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO IN (0,1)  ';
           end;
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_CPG.CommandText := enSqlCpg +
             ' WHERE CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO in (' + VarToStr(Input[1]) +') ';
      end

   else if Input[0] = 5 then
      begin
        // Buscar dados do parmetros de controle
        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
        BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
           BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([VarToStr(Input[1])]));

        BUS_CD_C_PAR_MOD := TDataSetField(BUS_CD_C_PAR_CTR.FieldByName('BUS_SQ_C_PAR_MOD')).NestedDataSet;

        if BUS_CD_C_PAR_MOD.FieldByName('SGQ').AsBoolean then
           begin
              CAD_SQ_C_CPG.CommandText := enSqlCpg +
                   ' WHERE (CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO IN (0,1,2)  ' +
                   ' AND EXISTS (SELECT * FROM CAD_TB_C_PAR_CPG PPG          ' +
                   '             WHERE PPG.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
                   '               AND PPG.ID_CONDICAO_PAG = CPG.ID_CONDICAO_PAG) )' +
                   ' AND NOT EXISTS (SELECT * FROM CAD_TB_C_FUN_CPN CPN          ' +
                   '                 WHERE CPN.ID_FUNCIONARIO = ''' + VarToStr(Input[2]) +''' ' +
                   '                 AND CPN.ID_CONDICAO_PAG = CPG.ID_CONDICAO_PAG  ) ';
           end
        else
           begin
              CAD_SQ_C_CPG.CommandText := enSqlCpg +
                   ' WHERE CPG.ATIVO = TRUE AND CPG.TIPO_PAGAMENTO IN (0,1)  ';
           end;
      end;


   CAD_SQ_C_CPG.CommandText := CAD_SQ_C_CPG.CommandText + ' ORDER BY CPG.DESCRICAO ';


   Result := CAD_DP_C_CPG.Data;
end;

function TSM.CAD_DP_C_CTCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtc: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CTC  ';
  end;
begin
   CAD_SQ_C_CTC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CTC.CommandText := enSqlCtc + ' WHERE 1=2 '
        else
           CAD_SQ_C_CTC.CommandText := enSqlCtc +
             ' WHERE ID_CONTA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
       if Trim(VarToStr(Input[1])) = '' then
          CAD_SQ_C_CTC.CommandText := enSqlCtc + ' WHERE 1=2 '
       else
          CAD_SQ_C_CTC.CommandText := enSqlCtc +
             ' WHERE BANCO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_CTC.CommandText := enSqlCtc +
          Format(' WHERE upper(AGENCIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_CTC.CommandText := enSqlCtc +
          'WHERE TIPO =''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_CTC.CommandText := enSqlCtc +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
        CAD_SQ_C_CTC.CommandText := enSqlCtc +
          ' WHERE TIPO = ''' + VarToStr(Input[1]) +''' ' +
          '   AND ID_CONTA <> ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := CAD_DP_C_CTC.Data;

   CAD_SQ_C_CTC.Close;
end;

procedure TSM.CAD_DP_C_CTCGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_CTCUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_CULDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCul: String;
  begin
    Result := ' SELECT CUL.* FROM CAD_TB_C_CUL CUL  ';
  end;
begin
   CAD_SQ_C_CUL.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_CUL.CommandText := enSqlCul + ' WHERE 1=2 '
        else
           CAD_SQ_C_CUL.CommandText := enSqlCul +
             ' WHERE CUL.ID_CULTURA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_CUL.CommandText := enSqlCul +
          Format(' WHERE upper(CUL.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_CUL.CommandText := enSqlCul +
            ' WHERE CUL.ID_CULTURA IN ('+VarToStr(Input[1])+') ';
      end;

   Result := CAD_DP_C_CUL.Data;

   CAD_SQ_C_CUL.Close;
end;

function TSM.CAD_DP_C_ECFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlEcf: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_ECF ecf ';
  end;
begin
   CAD_SQ_C_ECF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_ECF.CommandText := enSqlEcf + ' WHERE 1=2 '
        else
           CAD_SQ_C_ECF.CommandText := enSqlEcf +
             ' WHERE ecf.ECF_SERIAL_IMPRESSORA= ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        CAD_SQ_C_ECF.CommandText := enSqlEcf +
          Format('WHERE upper(ecf.ECF_SERIAL_IMPRESSORA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 2 then
      begin
        CAD_SQ_C_ECF.CommandText := enSqlEcf +
          Format('WHERE upper(ecf.ecf_marca_impressora) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 3 then
      begin
        CAD_SQ_C_ECF.CommandText := enSqlEcf +
          Format('WHERE upper(ecf.ecf_modelo_impressora) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 4 then
      begin
        CAD_SQ_C_ECF.CommandText := enSqlEcf +
            ' WHERE ECF.ID_EMPRESA = '''+VarToStr(Input[1])+''' '+
            ' AND NOT EXISTS ' +
            '       ( SELECT ecf_serial_impressora FROM FIN_TB_M_CXA CXA ' +
            '         WHERE CXA.STATUS =  0 AND                          ' +
            '               CXA.ecf_serial_impressora = ecf.ecf_serial_impressora AND  ' +
            '               CXA.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ) ';
      end;

   Result := CAD_DP_C_ECF.Data;
end;

function TSM.CAD_DP_C_EQPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEqp: String;
  begin
    Result := ' SELECT EQP.* FROM CAD_TB_C_EQP EQP  ';
  end;
begin
   CAD_SQ_C_EQP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_EQP.CommandText := enSqlEqp + ' WHERE 1=2 '
        else
           CAD_SQ_C_EQP.CommandText := enSqlEqp +
             ' WHERE EQP.ID_EQUIPAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_EQP.CommandText := enSqlEqp +
          Format(' WHERE upper(EQP.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_EQP.CommandText := enSqlEqp +
          Format(' WHERE upper(EQP.SERIAL) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_EQP.CommandText := enSqlEqp +
            Format(' WHERE upper(EQP.MODELO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_EQP.Data;

   CAD_SQ_C_EQP.Close;
end;

procedure TSM.CAD_DP_C_FAMBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
  {if UpdateKind = ukInsert then
     begin
       if SourceDS = CAD_SQ_C_FAM then
          begin
            DeltaDS.fieldByName('ID_FAMILIA').newValue:= enValorChave('CAD_TB_C_FAM');
          end;
     end;  }
end;

function TSM.CAD_DP_C_FAMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFam: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_FAM ';
  end;
begin
   CAD_SQ_C_FAM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_FAM.CommandText := enSqlFam + ' WHERE 1=2 '
        else
           CAD_SQ_C_FAM.CommandText := enSqlFam +
             ' WHERE ID_FAMILIA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_FAM.CommandText := enSqlFam +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [Uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_FAM.Data;

end;

function TSM.CAD_DP_C_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFor: String;
  begin
    Result :=
      ' SELECT FN.*, CID.UF INT_UF, CID.NOME AS INT_NOMECID,PAI.DESCRICAO AS INT_NOMEPAIS, '+
      '   pct.descricao as int_nomepct ' +
      ' FROM CAD_TB_C_FOR FN  '+
      '   LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=FN.ID_CIDADE '+
      '   LEFT OUTER JOIN CAD_TB_C_PAI PAI ON PAI.ID_PAIS=FN.COD_PAIS ' +
      '   left outer join cad_tb_c_pct pct on pct.id_plano = fn.id_plano ';


  end;
begin
   CAD_SQ_C_FOR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_FOR.CommandText := enSqlFor + ' WHERE 1=2 '
        else
           CAD_SQ_C_FOR.CommandText := enSqlFor +
             ' WHERE FN.ID_FORNECEDOR= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          Format('WHERE upper(FN.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+
          ' ORDER BY FN.DESCRICAO ';
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          'WHERE FN.DOC_CNPJ = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          'WHERE FN.DOC_IE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          Format('WHERE upper(FN.FANTASIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          'WHERE FN.transportadora = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          Format('WHERE FN.ativo = true and upper(FN.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+
          ' ORDER BY FN.DESCRICAO ';
      end
   else if Input[0] = 7 then
      begin
        CAD_SQ_C_FOR.CommandText := enSqlFor +
          Format('WHERE FN.ativo = true and upper(FN.FANTASIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_FOR.Data;
   CAD_SQ_C_FOR.Close;
end;

procedure TSM.CAD_DP_C_FORGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_FORUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_FPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFpg: String;
  begin
    Result := ' SELECT FPG.*, TIF.NATUREZA AS INT_NATUREZATIF ' +
              ' FROM CAD_TB_C_FPG FPG                   ' +
              '    left outer join CAD_TB_C_TIF TIF on  ' +
              ' (TIF.ID_TIPO_FINANCEIRO = FPG.ID_TIPO_FINANCEIRO) ';
  end;

begin
   CAD_SQ_C_FPG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_FPG.CommandText := enSqlFpg + ' WHERE 1=1 '
        else
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.ID_FORMA_PAG= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_FPG.CommandText := enSqlFpg +
          Format('WHERE upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.TIPO_PAGAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then // Filtro utilizado pela tela de NFe de entrada
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.DOC_IMPRESSO in (1,2,4) ';
      end
   else if Input[0] = 4 then //
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.DOC_IMPRESSO in ('+ VarToStr(Input[1]) + ') ';
      end
   else if Input[0] = 5 then // Consulta para atender o setor de vendas
      begin
         if Input[1] = 0 then
            begin
              CAD_SQ_C_FPG.CommandText := enSqlFpg +
                   ' WHERE FPG.ID_FORMA_PAG= ''' + VarToStr(Input[2]) +''' ';
            end
         else
            if Input[1] = 1 then
               begin
                 CAD_SQ_C_FPG.CommandText := enSqlFpg +
                   Format(' WHERE upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
               end;

        if Input[3] <> '' then
            begin
              CAD_SQ_C_FPG.CommandText := CAD_SQ_C_FPG.CommandText +
                  ' AND FPG.TIPO_PAGAMENTO in (' + VarToStr(Input[3]) +')';
            end;
        // Este input 4 foi reativado no dia 11/07/2019
        if Input[4] <> '' then //Filtragem para forma de pagamento da hierarquia
            begin
              CAD_SQ_C_FPG.CommandText := CAD_SQ_C_FPG.CommandText +
                  ' AND FPG.ID_FORMA_PAG in (' + VarToStr(Input[4]) +')';
            end;
      end
    else if Input[0] = 6 then
        begin
          CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.TIPO_PAGAMENTO in ('+VarToStr(Input[1]) +') '+
             ' AND FPG.DOC_IMPRESSO in ('+VarToStr(Input[2])+') AND GERA_CAIXA_BANCO=TRUE ';
        end
    else if Input[0] = 7 then //
        begin
          CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.DOC_IMPRESSO not in ('+ VarToStr(Input[1]) + ') ';
        end
    else if Input[0] = 8 then
        begin
          CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.TIPO_PAGAMENTO in ('+VarToStr(Input[1]) +') '+
             ' AND FPG.DOC_IMPRESSO in ('+VarToStr(Input[2])+') ';
        end
    else if Input[0] = 9 then
        begin
          CAD_SQ_C_FPG.CommandText := enSqlFpg;
          if Input[1] <> '' then
            begin
              CAD_SQ_C_FPG.CommandText := CAD_SQ_C_FPG.CommandText +
                 ' WHERE FPG.ID_FORMA_PAG not in ('+VarToStr(Input[1]) +') ';
            end;
        end
    else if Input[0] = 10 then
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.TIPO_PAGAMENTO = ''' + VarToStr(Input[1]) +''' ';
           if Input[2] <> '' then
             begin
                CAD_SQ_C_FPG.CommandText :=  CAD_SQ_C_FPG.CommandText +
                  '    AND FPG.ID_FORMA_PAG in (' + VarToStr(Input[2]) +')' ;
             end;
      end
    else if Input[0] = 11 then //
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE FPG.DOC_IMPRESSO in ('+ VarToStr(Input[1]) + ') ';
           if Input[2] <> '' then
             begin
                CAD_SQ_C_FPG.CommandText :=  CAD_SQ_C_FPG.CommandText +
                  '    AND FPG.ID_FORMA_PAG in (' + VarToStr(Input[2]) +')' ;
             end;
      end
    else if Input[0] = 12 then
      begin
        CAD_SQ_C_FPG.CommandText := enSqlFpg +
           ' WHERE FPG.TIPO_PAGAMENTO in ('+VarToStr(Input[1]) +') '+
           ' AND FPG.DOC_IMPRESSO in ('+VarToStr(Input[2])+') ';
        if Input[3] <> '' then
           begin
              CAD_SQ_C_FPG.CommandText := CAD_SQ_C_FPG.CommandText +
                '    AND FPG.ID_FORMA_PAG in (' + VarToStr(Input[3]) +')' ;
           end;
      end
    else if Input[0] = 13 then
      begin
           CAD_SQ_C_FPG.CommandText := enSqlFpg +
             ' WHERE  FPG.gera_caixa_banco = true  '+
             ' AND FPG.TIPO_PAGAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end;
    //  end;

   CAD_SQ_C_FPG.CommandText := CAD_SQ_C_FPG.CommandText + ' ORDER BY FPG.DESCRICAO ';

   Result := CAD_DP_C_FPG.Data;
   CAD_SQ_C_FPG.Close;
end;

procedure TSM.CAD_DP_C_FPGGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_FPGUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_FUNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFun: String;
  begin
    Result :=
      'SELECT FUC.* , CID.NOME AS INT_NOMECID '+
      'FROM CAD_TB_C_FUN FUC '+
      'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=FUC.ID_CIDADE ';
  end;
begin
   CAD_SQ_C_FUN.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_FUN.CommandText := enSqlFun + ' WHERE 1=2 '
        else
           CAD_SQ_C_FUN.CommandText := enSqlFun +
             ' WHERE FUC.ID_FUNCIONARIO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          'WHERE FUC.DOC_CPF = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          'WHERE FUC.DOC_IDENTIDADE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          'WHERE FUC.LOGIN = ''' + VarToStr(Input[1]) +''' And SENHA=''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          'WHERE upper(FUC.LOGIN) = ''' + uppercase(VarToStr(Input[1])) +''' AND FUC.ID_FUNCIONARIO <> ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 7 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
          ' WHERE FUC.LOGIN = '''+VarToStr(Input[1])+''' ';
      end
   else if Input[0] = 8 then
      begin
         if Input[1] = 0 then
            begin
              if Trim(VarToStr(Input[1])) = '' then
                 CAD_SQ_C_FUN.CommandText := enSqlFun + ' WHERE 1=2 '
              else
                 CAD_SQ_C_FUN.CommandText := enSqlFun +
                   ' WHERE ATIVO = TRUE AND FUC.ID_FUNCIONARIO= ''' + VarToStr(Input[2]) +''' ';
            end
         else if Input[1] = 1 then
            begin
              CAD_SQ_C_FUN.CommandText := enSqlFun +
                ' WHERE ATIVO = TRUE ' +
                Format(' AND upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
            end
         else if Input[1] = 2 then
            begin
              CAD_SQ_C_FUN.CommandText := enSqlFun +
                'WHERE ATIVO = TRUE AND FUC.DOC_CPF = ''' + VarToStr(Input[2]) +''' ';
            end
         else if Input[1] = 3 then
            begin
              CAD_SQ_C_FUN.CommandText := enSqlFun +
                'WHERE ATIVO = TRUE AND FUC.DOC_IDENTIDADE = ''' + VarToStr(Input[2]) +''' ';
            end
      end
   else if Input[0] = 9 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
               ' WHERE ATIVO = TRUE ' +
               Format(' AND upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 10 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
             ' where fuc.ativo=true and exists (select * from cad_tb_c_fun_crg fcg '+
             ' left outer join pcp_tb_c_crg crg on crg.id_cargo=fcg.id_cargo '+
             ' where crg.tipo in ('+ VarToStr(Input[1])+') and fcg.id_funcionario=fuc.id_funcionario) ';

      end
   else if Input[0] = 11 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
             ' where fuc.ativo=true and exists (select * from cad_tb_c_fun_crg fcg '+
             '   left outer join pcp_tb_c_crg crg on crg.id_cargo=fcg.id_cargo '+
             '   left outer join cad_tb_c_set stt on stt.id_setor = crg.id_setor ' +
             ' where stt.tipo =8 and fcg.id_funcionario=fuc.id_funcionario) ';
      end

   else if Input[0] = 12 then
      begin
        CAD_SQ_C_FUN.CommandText := enSqlFun +
             ' where fuc.ativo=true and fuc.id_funcionario = ''' + VarToStr(Input[1]) +''' and ' +
             '       exists (select * from cad_tb_c_fun_crg fcg ' +
             '   left outer join pcp_tb_c_crg crg on crg.id_cargo=fcg.id_cargo '+
             '   left outer join cad_tb_c_set stt on stt.id_setor = crg.id_setor ' +
             ' where stt.tipo =8 and fcg.id_funcionario=fuc.id_funcionario) ';
      end;

   CAD_SQ_C_FUN.CommandText := CAD_SQ_C_FUN.CommandText +
                               ' order by fuc.nome' ;

   Result := CAD_DP_C_FUN.Data;
end;

procedure TSM.CAD_DP_C_FUNGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 21/03/2019 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_FUNUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 21/03/2019 }
  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_GRPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlGrp: String;
  begin
    Result := ' SELECT GRP.* FROM CAD_TB_C_GRP GRP  ';
  end;
begin
   CAD_SQ_C_GRP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_GRP.CommandText := enSqlGrp + ' WHERE 1=2 '
        else
           CAD_SQ_C_GRP.CommandText := enSqlGrp +
             ' WHERE GRP.ID_CODIGO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_GRP.CommandText := enSqlGrp +
          Format(' WHERE upper(GRP.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_GRP.Data;

   CAD_SQ_C_GRP.Close;
end;

function TSM.CAD_DP_C_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlGru: String;
  begin
    Result :=
      ' SELECT GRU.* ,cast(null as bytea) as foto_temp, TRI.DESCRICAO AS INT_NOMETRI,' +
      '   ETQ.DESCRICAO AS INT_NOMEETQ,  ite.descricao as int_nomeite_espuma, '+
      '   itt.descricao as int_nomeite_espuma_2, ' +
      '   itr.descricao as int_nomeite_espuma_3,  ' +
      '   itp.descricao as int_nomeite_espuma_revest_1, ' +
      '   its.descricao as int_nomeite_espuma_revest_2  ' +
      ' FROM CAD_TB_C_GRU GRU '+
      '  LEFT OUTER JOIN CAD_TB_C_TRI TRI ON TRI.ID_TRIBUTO=GRU.ID_TRIBUTO ' +
      '  left outer join cad_tb_c_ite ite on ite.id_item = gru.id_item_bloco_espuma ' +
      '  left outer join cad_tb_c_ite itt on itt.id_item = gru.id_item_bloco_espuma_2 ' +
      '  left outer join cad_tb_c_ite itr on itr.id_item = gru.id_item_bloco_espuma_3 ' +
      '  left outer join cad_tb_c_ite itp on itp.id_item = gru.id_item_bloco_espuma_revest_1 ' +
      '  left outer join cad_tb_c_ite its on its.id_item = gru.id_item_bloco_espuma_revest_2 ' +
      '  LEFT OUTER JOIN PCP_TB_C_FTE_ETQ ETQ ON ETQ.ID_FTE_ETQ = GRU.ID_FTE_ETQ ';
  end;
begin
   CAD_SQ_C_GRU.Close;
   if Input[0] = 0 then
      begin
           CAD_SQ_C_GRU.CommandText := enSqlGru +
             ' WHERE GRU.ID_GRUPO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_GRU.CommandText := enSqlGru +
          Format('WHERE upper(GRU.DESCRICAO) LIKE ''%s%%'' ', [uppercase(Input[1])]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_GRU.CommandText := enSqlGru +
             ' WHERE GRU.TIPO= '''+VarToStr(Input[1])+''' ';
      end
   else;

   if Input[0] = 90 then
      begin
        CAD_SQ_C_GRU.CommandText := enSqlGru +
             ' WHERE GRU.TIPO = '''+VarToStr(Input[1])+''' '+
             ' AND GRU.NIVEL = ''3'' ';
      end
  else if Input[0] = 91 then
    begin
      CAD_SQ_C_GRU.CommandText := enSqlGru;
      if (copy(VarToStr(Input[1]),2,7)='') or (copy(VarToStr(Input[1]),2,7)='.00.000') then
        begin
            CAD_SQ_C_GRU.CommandText := CAD_SQ_C_GRU.CommandText  +
              ' WHERE (GRU.id_grupo > '''+copy(VarToStr(Input[1]),1,1)+'.00.000'' and '+
              '  GRU.id_grupo <='''+copy(VarToStr(Input[1]),1,1)+'.99.999'' ) ';
        end
      else if (copy(VarToStr(Input[1]),5,4)='') or (copy(VarToStr(Input[1]),5,4)='.000') then
        begin
             CAD_SQ_C_GRU.CommandText :=  CAD_SQ_C_GRU.CommandText  +
              ' WHERE (GRU.id_grupo > '''+copy(VarToStr(Input[1]),1,4)+'.000'' and '+
              '  GRU.id_grupo <='''+copy(VarToStr(Input[1]),1,4)+'.999'' ) ';
        end
      else
        begin
            CAD_SQ_C_GRU.CommandText := CAD_SQ_C_GRU.CommandText  + ' WHERE 1=2 ';
        end;
    end
  else if Input[0] = 92 then
    begin
       CAD_SQ_C_GRU.CommandText := enSqlGru +
             ' WHERE GRU.TIPO = '''+VarToStr(Input[1])+''' '+
             ' AND GRU.TIPO_ITEM = ''09'' '+
             ' AND GRU.NIVEL = ''3'' ';
    end
  else if Input[0] = 93 then
    begin
       CAD_SQ_C_GRU.CommandText := enSqlGru +
             ' WHERE GRU.TIPO = '''+VarToStr(Input[1])+''' '+
             ' AND GRU.TIPO_ITEM <> ''09'' '+
             ' AND GRU.NIVEL = ''3'' ';
    end;


    CAD_SQ_C_GRU.CommandText := CAD_SQ_C_GRU.CommandText +
     'Order By ID_GRUPO';

   Result := CAD_DP_C_GRU.Data;
   CAD_SQ_C_GRU.Close;
end;

procedure TSM.CAD_DP_C_GRUUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
    B: TBitmap;
    Png: TPngImage;
    fotoAlterado:Boolean;
    ms: TMemoryStream;
    nomeFoto:String;
begin
    ms := TMemoryStream.Create;
    B := TBitmap.Create;
    Png := TPngImage.Create;
    fotoAlterado := false;


   if DataSet.UpdateStatus in [usInserted] then
     begin
         nomeFoto := DataSet.FieldByName('mob_nome_foto').AsString;
         if DataSet.FieldByName('foto_temp').AsString<>'' then
              begin
                TBLOBField(DataSet.FieldByName('foto_temp')).SaveToStream(ms);
                fotoAlterado := true;
              end;
     end;


   if DataSet.UpdateStatus in [usUnmodified] then
     begin
       DataSet.Next;
       if DataSet.UpdateStatus in [usModified] then
          begin
            if DataSet.FieldByName('foto_temp').AsString<>'' then
              begin
                TBLOBField(DataSet.FieldByName('foto_temp')).SaveToStream(ms);
                fotoAlterado := true;
              end;
            if DataSet.FieldByName('mob_nome_foto').AsString<>'' then
              begin
               nomeFoto := DataSet.FieldByName('mob_nome_foto').AsString;
              end;

            DataSet.Prior;
          end
       else
          DataSet.Prior;
     end;



  try
   if  fotoAlterado then
    begin
      ms.Position := 0;
      B.LoadFromStream(ms);
      Png.Assign(B);
      if not DirectoryExists(xDiretorioImagem+'CAD_TB_C_GRU') then
       begin
         ForceDirectories(xDiretorioImagem+'CAD_TB_C_GRU');
       end;

      Png.SaveToFile(xDiretorioImagem+'CAD_TB_C_GRU\'+nomeFoto);
    end;
  finally
     B.Free;
     Png.Free;
     ms.Free;
  end;
end;

function TSM.CAD_DP_C_HFGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlHfg: String;
  begin
    Result :=
      ' select hfg.*,fpg.descricao as int_nomefpg '+
      ' from cad_tb_c_hfg hfg '+
      ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=hfg.id_forma_pag ';
  end;
begin
   CAD_SQ_C_HFG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_HFG.CommandText := enSqlHfg + ' WHERE 1=2 '
        else
           CAD_SQ_C_HFG.CommandText := enSqlHfg +
             ' WHERE HFG.ID_CONTROLE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_HFG.CommandText := enSqlHfg +
           ' WHERE 1=1 ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
          CAD_SQ_C_HFG.CommandText := enSqlHfg + ' WHERE 1=2 '
        else
          CAD_SQ_C_HFG.CommandText :=
            ' with nvl as (select nivel  from cad_tb_c_hfg where '+
            '    id_controle='''+VarToStr(Input[1])+''') '+
             enSqlHfg +
            ' LEFT OUTER JOIN NVL ON hfg.nivel>=NVL.NIVEL '+
            ' where nvl.nivel is not null ';
      end;
   CAD_SQ_C_HFG.CommandText := CAD_SQ_C_HFG.CommandText + ' order by nivel ';
   Result := CAD_DP_C_HFG.Data;

end;

function TSM.CAD_DP_C_INFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlInf: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_INF  ';
  end;
begin
   CAD_SQ_C_INF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_INF.CommandText := enSqlInf + ' WHERE 1=2 '
        else
           CAD_SQ_C_INF.CommandText := enSqlInf +
             ' WHERE ID_INF= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_INF.CommandText := enSqlInf +
          Format(' WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_INF.CommandText := enSqlInf +
                 ' where id_inf in (' + VarToStr(Input[1]) +') ';
      end;
   Result := CAD_DP_C_INF.Data;
end;

function TSM.CAD_DP_C_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlIte: String;
  begin
    Result :=
        'SELECT ITE.*,cast(null as bytea) as foto_temp,NCM.DESCRICAO AS INT_NOMENCM, NCM.PER_IMPOSTO AS INT_PERIMPOSTONCM, '+
        '   GRU.CTC_EPI INT_CTC_EPI, GRU.DESCRICAO INT_DESC_GRUPO, '+
        '   GRU.TIPO_ITEM INT_TIPO_ITEM, '+
        '   GRU.SER_TERCEIRO AS INT_SERTERCEIRO, ' +
        '   GRU.ORIGEM_MERCADORIA INT_ORIGEM, '+
        '   GRU.ID_TRIBUTO INT_TRIBUTO, '+
        '   GRU.MVA INT_MVA, FON.DESCRICAO AS INT_NOMEFOR, '+
        '   GRU.ID_FTE_ETQ AS INT_FTEETQ, ' +
        '   GRU.imprime_selo_etq AS INT_IMPSELO, ' +
        '   GRU.ctc_epi As INT_CTCEPI, '+
        '   GRU.id_st_pis_entrada as int_pis_entrada,   GRU.id_st_pis_saida as int_pis_saida, ' +
        '   GRU.id_st_cof_entrada as int_cof_entrada, ' +
        '   GRU.id_st_cof_saida as int_cof_saida, ' +
        '   GRU.id_st_ipi_entrada as int_ipi_entrada, ' +
        '   GRU.id_st_ipi_saida as int_ipi_saida, ' +
        '   GRU.imprime_msq_etq AS int_impmsgetq, '+
        '   GRU.msg_etq1 as int_msg_etq1, '+
        '   GRU.msg_etq2 as int_msg_etq2, '+
        '   GRU.msg_etq3 as int_msg_etq3, '+
        '   GRU.msg_etq4 as int_msg_etq4, '+
        '   GRU.msg_etq5 as int_msg_etq5, '+
        '   GRU.msg_etq6 as int_msg_etq6, '+
        '   GRU.msg_etq7 as int_msg_etq7, '+
        '   GRU.dre_perc_ircs as int_dre_perc_ircs, '+
        '   GRU.dre_perc_out_ded_ven as int_dre_perc_out_ded_ven, '+
        '   GRU.ctr_lot_entr as int_ctr_lot_entr,    GRU.sgq_verif_cod_barra_ped AS int_verif_cod_barra_ped, '+
        '   GRP.descricao as int_nomegrp, '+
        '   gru.imp_etq_simples as int_impetqsimples, cast(gru.path_etq_simples as varchar(100)) as int_pathetqsimples, ' +
        '   gru.utiliza_lote as int_lote_gru,gru.ali_interna_icms as int_ali_interna_icms, ncm.cest as int_cest, '+
        '   gru.tipo_produto as int_tipo_produto, '+
        '   UND.INF_TEMPO_ITE_COJ AS INT_INF_TEMPO_ITE_COJ,  '+
        '   mar.descricao as int_nomemar,    gru.sgq_bloco_espuma as int_sgqblocoespuma,  ' +
        '   gru.sgq_calc_bloco_produzir as int_sgqcalcbloco,  '+
        '   cast( case ite.etiq_tipo_produto' + #13#10 +
        '       when 0 then ''COLCHO DE ESPUMA''' + #13#10 +
        '       when 1 then ''COLCHO BOX CONJUGADO''' + #13#10 +
        '       when 2 then ''COLCHO AUXILIAR''' + #13#10 +
        '       when 3 then ''COLCHO MISTO''' + #13#10 +
        '   else ''?????'' end  as varchar(50) ) as int_etiq_tipo_produto, ' +
        '    itt.descricao as int_nome_item_caixa_itt ' +
        ' FROM CAD_TB_C_ITE ITE '+
        '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
        '  LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
        '  LEFT OUTER JOIN CAD_TB_C_NCM NCM ON NCM.ID_NCM = ITE.ID_NCM '+
        ' LEFT OUTER JOIN CAD_TB_C_GRP GRP ON GRP.ID_CODIGO = ITE.ID_GRUPO_PROD '+
        ' LEFT OUTER JOIN CAD_TB_C_UND UND ON UND.ID_UNIDADE = ITE.ID_UND_VENDA '+
        ' LEFT OUTER JOIN CAD_TB_C_MAR MAR ON MAR.ID_MAR = ITE.ID_MARCA ' +
        ' LEFT OUTER JOIN CAD_TB_C_ITE ITT ON ITT.ID_ITEM = ITE.ID_ITEM_CAIXA ' ;
  end;
begin
   CAD_SQ_C_ITE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_ITE.CommandText := enSqlIte + ' WHERE 1=2 '
        else
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_ITEM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.COD_BARRA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
               ' WHERE ITE.COD_FABRICA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' LEFT OUTER JOIN CAD_TB_C_ITE_LOC LOC ON LOC.ID_EMPRESA='''+VarToStr(Input[3])+''' AND LOC.ID_ITEM=ITE.ID_ITEM '+
             ' WHERE LOC.LOCA_RUA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.APLICACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 6 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 7 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_GRUPO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 8 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(GRU.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 9 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.REFERENCIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 10 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_NCM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 11 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ATIVO = true and ITE.DESTINO_RECLAMADO in (''1'',''2'') ';
      end
   else if Input[0] = 12 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_FORNECEDOR= ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 90 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_ITEM <> ''' + VarToStr(Input[1]) +''' '+
             ' AND ITE.COD_BARRA = ''' +VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 91 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ATIVO = TRUE ';
      end
   else if Input[0] = 92 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ATIVO = TRUE '+
             ' AND ITE.ID_GRUPO IN (' + VarToStr(Input[1]) +') ';
      end
   else if Input[0] = 93 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ATIVO = TRUE '+
             ' AND ITE.ID_FAMILIA IN (' + VarToStr(Input[1]) +') ';
      end
   else if Input[0] = 94 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE GRU.CTC_EPI = TRUE '+
             ' AND ITE.ID_ITEM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 95 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE GRU.CTC_EPI = TRUE '+
              Format('AND upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end

   else if Input[0] = 96 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ite.ativo = true '+
             ' and coalesce(GRU.sgq_bloco_espuma,false) = true ';
      end
   else if Input[0] = 100 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_ITE.CommandText := enSqlIte + ' WHERE 1=2 '
        else
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_ITEM= ''' + VarToStr(Input[1]) +''' ';
      end;

    ///Utilizado pela Consulta de itens(CSU_FM_C_ITE)
   if Input[0] = 101 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 102 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.COD_BARRA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 103 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
           Format('WHERE upper(ITE.COD_FABRICA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 104 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' LEFT OUTER JOIN CAD_TB_C_ITE_LOC LOC ON LOC.ID_EMPRESA='''+VarToStr(Input[3])+''' AND LOC.ID_ITEM=ITE.ID_ITEM '+
             ' WHERE LOC.LOCA_RUA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 105 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.APLICACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 106 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 107 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_GRUPO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 108 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(GRU.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 109 then
      begin
        CAD_SQ_C_ITE.CommandText := enSqlIte +
          Format('WHERE upper(ITE.REFERENCIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 110 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
             ' WHERE ITE.ID_NCM= ''' + VarToStr(Input[1]) +''' ';
      end;

   if (Input[0] >=100) AND (Input[0]<=110) then
      begin
         if VarToStr(Input[2])='0' then
           CAD_SQ_C_ITE.CommandText := CAD_SQ_C_ITE.CommandText +
             ' and exists (select id_item from est_tb_m_fes fes '+
             ' where fes.id_item=ite.id_item and fes.saldo_fisico>0) ';
      end;

   if Input[0] = 111 then
      begin
        if Input[1] = '0' then
           begin
              CAD_SQ_C_ITE.CommandText := enSqlIte +
                 ' WHERE ITE.ATIVO = TRUE ';
           end;

        if Input[1] = '1' then
           begin
              CAD_SQ_C_ITE.CommandText := enSqlIte;
           end;
      end
   else if Input[0] = 112 then
      begin
        if Input[2] = '0' then
           begin
             CAD_SQ_C_ITE.CommandText := enSqlIte +
                ' WHERE ITE.ATIVO = TRUE '+
                ' AND ITE.ID_GRUPO IN (' + VarToStr(Input[1]) +') ';
           end;
        if Input[2] = '1' then
           begin
             CAD_SQ_C_ITE.CommandText := enSqlIte +
                ' WHERE ITE.ID_GRUPO IN (' + VarToStr(Input[1]) +') ';
           end;
      end
   else if Input[0] = 113 then
      begin
       if Input[2] = '0' then
          begin
             CAD_SQ_C_ITE.CommandText := enSqlIte +
               ' WHERE ITE.ATIVO = TRUE '+
               ' AND ITE.ID_FAMILIA IN (' + VarToStr(Input[1]) +') ';
          end;

       if Input[2] = '1' then
          begin
             CAD_SQ_C_ITE.CommandText := enSqlIte +
               ' WHERE ITE.ID_FAMILIA IN (' + VarToStr(Input[1]) +') ';
          end;
      end
   ///////////FIM/////////////////////////////////////////////////

   else if Input[0] = 114 then
      begin
           CAD_SQ_C_ITE.CommandText := enSqlIte +
               ' WHERE ITE.cod_item_prod = ''' + VarToStr(Input[1]) +''' ';
      end;


   // Ordenao

  if strtoint(Input[0]) in [1,2,3,4,5,6,7,8,9,10,11,12] then
     begin
        CAD_SQ_C_ITE.CommandText := CAD_SQ_C_ITE.CommandText + ' order by ite.id_grupo,ite.ativo desc,ite.descricao ';
     end;


   Result := CAD_DP_C_ITE.Data;
   CAD_SQ_C_ITE.Close;
end;

procedure TSM.CAD_DP_C_ITEGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 21/03/2019 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_ITEUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
    B: TBitmap;
    Png: TPngImage;
    fotoAlterado:Boolean;
    ms: TMemoryStream;
    nomeFoto:String;
begin



    ms := TMemoryStream.Create;
    B := TBitmap.Create;
    Png := TPngImage.Create;
    fotoAlterado := false;


   if DataSet.UpdateStatus in [usInserted] then
     begin
         nomeFoto := DataSet.FieldByName('mob_nome_foto').AsString;
         if DataSet.FieldByName('foto_temp').AsString<>'' then
              begin
                TBLOBField(DataSet.FieldByName('foto_temp')).SaveToStream(ms);
                fotoAlterado := true;
              end;
     end;


   if DataSet.UpdateStatus in [usUnmodified] then
     begin
       DataSet.Next;
       if DataSet.UpdateStatus in [usModified] then
          begin
            if DataSet.FieldByName('foto_temp').AsString<>'' then
              begin
                TBLOBField(DataSet.FieldByName('foto_temp')).SaveToStream(ms);
                fotoAlterado := true;
              end;
            if DataSet.FieldByName('mob_nome_foto').AsString<>'' then
              begin
               nomeFoto := DataSet.FieldByName('mob_nome_foto').AsString;
              end;

            DataSet.Prior;
          end
       else
          DataSet.Prior;
     end;



  try
   if  fotoAlterado then
    begin
      ms.Position := 0;
      B.LoadFromStream(ms);
      Png.Assign(B);
      if not DirectoryExists(xDiretorioImagem+'CAD_TB_C_ITE') then
       begin
         ForceDirectories(xDiretorioImagem+'CAD_TB_C_ITE');
       end;
      Png.SaveToFile(xDiretorioImagem+'CAD_TB_C_ITE\'+nomeFoto);
      //B.SaveToFile(xDiretorioImagem+'CAD_TB_C_ITE\'+nomeFoto);
    end;
  finally
     B.Free;
     Png.Free;
     ms.Free;
  end;

   { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 20/06/2018 }
  enAudGravar(Sender,DataSet);

end;

function TSM.CAD_DP_C_LTODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlLto: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_LTO  ';
  end;
begin
   CAD_SQ_C_LTO.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_LTO.CommandText := enSqlLto + ' WHERE 1=2 '
        else
           CAD_SQ_C_LTO.CommandText := enSqlLto +
             ' WHERE ID_LOCAL_TITULO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_LTO.CommandText := enSqlLto +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_LTO.Data;
end;

function TSM.CAD_DP_C_MARDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlMar: String;
  begin
    Result := ' SELECT MAR.* FROM CAD_TB_C_MAR MAR  ';
  end;
begin
   CAD_SQ_C_MAR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_MAR.CommandText := enSqlMar + ' WHERE 1=2 '
        else
           CAD_SQ_C_MAR.CommandText := enSqlMar +
             ' WHERE MAR.ID_MAR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_MAR.CommandText := enSqlMar +
          Format(' WHERE upper(MAR.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_MAR.Data;

   CAD_SQ_C_MAR.Close;
end;

function TSM.CAD_DP_C_MCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFam: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_MCT ';
  end;
begin
   CAD_SQ_C_MCT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_MCT.CommandText := enSqlFam + ' WHERE 1=2 '
        else
           CAD_SQ_C_MCT.CommandText := enSqlFam +
             ' WHERE ID_MAQUINETA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_MCT.CommandText := enSqlFam +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [Uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_MCT.Data;
   CAD_SQ_C_MCT.Close;
end;



function TSM.CAD_DP_C_MTVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlMtv: String;
  begin
    Result := ' select mtv.*, grp.descricao as int_nomegrp,fun.nome as int_nomefun '+
              ' from CAD_TB_C_MTV mtv                                              '+
              ' left outer join cad_tb_c_grp grp on grp.id_codigo = mtv.id_grupo_prod '+
              ' left outer join cad_tb_c_fun fun on fun.id_funcionario = mtv.id_vendedor ';
  end;
begin
   CAD_SQ_C_MTV.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_MTV.CommandText := enSqlMtv + ' WHERE 1=2 '
        else
           CAD_SQ_C_MTV.CommandText := enSqlMtv +
             ' WHERE MTV.ID_MTV= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_MTV.CommandText := enSqlMtv +
          Format('WHERE upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end

   else if Input[0] = 2 then
      begin
        CAD_SQ_C_MTV.CommandText := enSqlMtv +
            ' WHERE MTV.ANO= ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 3 then
      begin
        CAD_SQ_C_MTV.CommandText := enSqlMtv +
              Format('WHERE upper(int_nomegrp) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
    else if Input[0] = 90 then
      begin
        CAD_SQ_C_MTV.CommandText := enSqlMtv +
           ' WHERE MTV.ID_MTV<> ''' + VarToStr(Input[1]) +''' '+
           ' AND MTV.ID_VENDEDOR='''+ VarToStr(Input[2]) +''' '+
           ' AND MTV.ANO='''+ VarToStr(Input[3]) +''' '+
           ' AND MTV.ID_GRUPO_PROD='''+ VarToStr(Input[4]) +''' ';
      end;

   Result := CAD_DP_C_MTV.Data;

   CAD_SQ_C_MTV.close;

end;

function TSM.CAD_DP_C_MVEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlMve: String;
  begin
    Result := ' select mve.*, mar.descricao as int_nomemar,           ' +
              ' cat.descricao as int_nomecat   from CAD_TB_C_MVE mve  ' +
              ' left outer join cad_tb_c_mar mar on mar.id_mar = mve.id_mar ' +
              ' left outer join ofi_tb_c_cat cat on cat.id_cat = mve.id_cat ';
  end;
begin
   CAD_SQ_C_MVE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_MVE.CommandText := enSqlMve + ' WHERE 1=2 '
        else
           CAD_SQ_C_MVE.CommandText := enSqlMve +
             ' WHERE MVE.ID_MVE= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_MVE.CommandText := enSqlMve +
          Format('WHERE upper(MVE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end

   else if Input[0] = 2 then
      begin
        CAD_SQ_C_MVE.CommandText := enSqlMve +
          Format('WHERE upper(MAR.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end

   else if Input[0] = 3 then
      begin
        CAD_SQ_C_MVE.CommandText := enSqlMve +
             ' WHERE MVE.ID_CAT= ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 4 then
      begin
        CAD_SQ_C_MVE.CommandText := enSqlMve +
          Format('WHERE upper(CAT.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_MVE.Data;

   CAD_SQ_C_MVE.close;
end;


function TSM.CAD_DP_C_NATDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNat: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_NAT  ';
  end;
begin
   CAD_SQ_C_NAT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_NAT.CommandText := enSqlNat + ' WHERE 1=2 '
        else
           CAD_SQ_C_NAT.CommandText := enSqlNat +
               Format('WHERE upper(ID_CLASSE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_NAT.CommandText := enSqlNat +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_NAT.Data;
end;

function TSM.CAD_DP_C_NCMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNcm: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_NCM  ';
  end;
begin
   CAD_SQ_C_NCM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_NCM.CommandText := enSqlNcm + ' WHERE 1=2 '
        else
           CAD_SQ_C_NCM.CommandText := enSqlNcm +
             ' WHERE ID_NCM= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_NCM.CommandText := enSqlNcm +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_NCM.Data;

end;

function TSM.CAD_DP_C_NTRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCadNtr: String;
  begin
  Result :=
      'select ntr.* '+
      ' from cad_tb_c_ntr ntr ';
  end;
begin
  CAD_SQ_C_NTR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_NTR.CommandText := enSqlCadNtr + ' WHERE 1=2 '
        else
          CAD_SQ_C_NTR.CommandText := enSqlCadNtr +
            ' WHERE ntr.codigo = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        CAD_SQ_C_NTR.CommandText := enSqlCadNtr +
          Format(' WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;


   Result := CAD_DP_C_NTR.Data;
   CAD_SQ_C_NTR.Close;
end;

function TSM.CAD_DP_C_PAIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlPai: String;
  begin
    Result := ' SELECT PAI.* FROM CAD_TB_C_PAI pai  ';
  end;
begin
   CAD_SQ_C_PAI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PAI.CommandText := enSqlPai + ' WHERE 1=2 '
        else
           CAD_SQ_C_PAI.CommandText := enSqlPai +
             ' WHERE PAI.ID_PAIS = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PAI.CommandText := enSqlPai +
          Format(' WHERE upper(PAI.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_PAI.Data;
end;

function TSM.CAD_DP_C_PARDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPar: String;
  begin
    Result :=
    'select PAR.*, CID.UF AS INT_UF, '+
    '          RAM.REGIME_TRIBUTARIO AS INT_REG_TRIBUTARIO, '+
    '          CID.NOME AS INT_NOMECID, '+
    '          RAM.ID_CNAE AS INT_ID_CNAE '+
    'from CAD_TB_C_PAR PAR '+
    'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=PAR.ID_CIDADE '+
    'LEFT OUTER JOIN CAD_TB_C_RAM RAM ON RAM.ID_RAMO = PAR.ID_RAMO ';
  end;
begin
    CAD_SQ_C_PAR.Close;
   if Input[0] = 0 then
      begin
           CAD_SQ_C_PAR.CommandText := enSqlPar +
             ' WHERE PAR.ID_EMPRESA= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PAR.CommandText := enSqlPar +
          Format('WHERE upper(PAR.EMP_RAZAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_PAR.CommandText := enSqlPar +
          Format('WHERE upper(PAR.EMP_FANTASIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_PAR.Data;
end;

procedure TSM.CAD_DP_C_PARGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_PARUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  DataSetCtr:TDataSet;

  BUS_SQ_C_PAR_CTR: TSQLDataSet;
  BUS_CD_C_PAR_CTR: TClientDataSet;
  BUS_DP_C_PAR_CTR: TDataSetProvider;
  precoFilial:Boolean;
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }



  DataSetCtr    := TDataSetField(Dataset.FieldByName('CAD_SQ_C_PAR_CTR')).NestedDataSet;

  precoFilial :=  DataSetCtr.FieldByName('preco_por_filial').AsBoolean;
  if (DataSetCtr.UpdateStatus in [usUnmodified]) then
   begin
     DataSetCtr.Next;
     if DataSetCtr.FieldByName('preco_por_filial').AsString <> '' then
       begin
         precoFilial :=  DataSetCtr.FieldByName('preco_por_filial').AsBoolean;
       end;
   end;


   BUS_SQ_C_PAR_CTR := TSQLDataSet.Create(nil);
   BUS_SQ_C_PAR_CTR.SQLConnection := conexao;
   BUS_SQ_C_PAR_CTR.CommandType   := ctQuery;
   BUS_SQ_C_PAR_CTR.CommandText   := ' SELECT * FROM CAD_TB_C_PAR_CTR WHERE ID_EMPRESA <> ' +
                                      dataset.FieldByName('ID_EMPRESA').AsString;

   BUS_DP_C_PAR_CTR := TDataSetProvider.Create(nil);
   BUS_DP_C_PAR_CTR.DataSet := BUS_SQ_C_PAR_CTR;

   BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
   BUS_CD_C_PAR_CTR.Open;



   BUS_CD_C_PAR_CTR.First;
   while not BUS_CD_C_PAR_CTR.EOF do
     begin
       BUS_CD_C_PAR_CTR.Edit;
       BUS_CD_C_PAR_CTR.FieldByName('preco_por_filial').AsBoolean := precoFilial;
       BUS_CD_C_PAR_CTR.Post;
       BUS_CD_C_PAR_CTR.Next;
     end;


   if BUS_CD_C_PAR_CTR <> nil then
      if BUS_CD_C_PAR_CTR.ChangeCount > 0 then
         if not (BUS_CD_C_PAR_CTR.ApplyUpdates(0) = 0) then
            raise Exception.Create('Erro ao tentar atualizar parametros das empresas.');



  enAudGravar(Sender,DataSet);
end;

function TSM.CAD_DP_C_PCCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCadPcc: String;
  begin
  Result :=
      'select pcc.* '+
      ' from CAD_TB_C_PCC PCC ';
  end;
begin
  CAD_SQ_C_PCC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PCC.CommandText := enSqlCadPcc + ' WHERE 1=2 '
        else
          CAD_SQ_C_PCC.CommandText := enSqlCadPcc +
            ' WHERE PCC.cod_cta = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        CAD_SQ_C_PCC.CommandText := enSqlCadPcc +
          Format(' WHERE upper(NOME_CTA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;


   Result := CAD_DP_C_PCC.Data;
   CAD_SQ_C_PCC.Close;
end;

function TSM.CAD_DP_C_PCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPct: String;
  begin
    Result :=  ' SELECT PCT.*, '+
                    ' CAST (CASE PCT.TIPO ' +
                    '    WHEN 0 THEN ''Analtico'' ' +
                    '    WHEN 1 THEN ''Sinttico'' ' +
                    ' END AS VARCHAR(10)) AS INT_TIPO, ' +

                    ' CAST (CASE PCT.TIPO_DESP ' +
                    '    WHEN 0 THEN ''Despesas''  ' +
                    '    WHEN 1 THEN ''Receitas''  ' +
                    '    WHEN 2 THEN ''Sem Fluxo'' ' +
                    '    WHEN 3 THEN ''Tributos''  ' +
                    '    WHEN 4 THEN ''Resultado'' ' +
                    ' END AS VARCHAR(10)) AS INT_TIPO_DESP ' +
      ' FROM CAD_TB_C_PCT PCT ';
  end;
begin
   CAD_SQ_C_PCT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PCT.CommandText := enSqlPct + ' WHERE 1=2 '
        else
           CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE ID_PLANO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 90 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
             'WHERE (TIPO_DESP not in (' + VarToStr(Input[1]) +')) and tipo=0 ';
      end
   else if Input[0] = 91 then
      begin
           CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE TIPO= ''' + VarToStr(Input[1]) +''' ';  //0-ANALITICA, 1-SINTETICA
      end
   else if Input[0] = 92 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE (TIPO_DESP in (' + VarToStr(Input[1]) +')) and tipo=0 ';
      end
   else if Input[0] = 93 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE ' + Format(' upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
             ' and TIPO_DESP in (' + VarToStr(Input[2]) +') and tipo=0 ';
      end
   else if Input[0] = 94 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE ' + Format(' upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
             ' and TIPO_DESP not in (' + VarToStr(Input[2]) +') and tipo=0 ';
      end
    else if Input[0] = 95 then
      begin
        CAD_SQ_C_PCT.CommandText := enSqlPct +
             ' WHERE ' + Format(' upper(ID_PLANO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   CAD_SQ_C_PCT.CommandText := CAD_SQ_C_PCT.CommandText  +
     'Order By ID_PLANO';



   Result := CAD_DP_C_PCT.Data;

   CAD_SQ_C_PCT.Close;
end;

function TSM.CAD_DP_C_PECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPec: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PEC  ';
  end;
begin
   CAD_SQ_C_PEC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PEC.CommandText := enSqlPec + ' WHERE 1=2 '
        else
           CAD_SQ_C_PEC.CommandText := enSqlPec +
             ' WHERE ID_PERFIL_CLI= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PEC.CommandText := enSqlPec +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 90 then
      begin
        CAD_SQ_C_PEC.CommandText := enSqlPec +
          ' WHERE ID_PERFIL_CLI IN (' + VarToStr(Input[1]) +') ';
      end;
   Result := CAD_DP_C_PEC.Data;
end;

procedure TSM.CAD_DP_C_PESBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin

if DeltaDS.FindField('chave') <> nil then
   if UpdateKind = ukInsert then
      begin
        DeltaDS.FieldByName('chave').NewValue :=
          enMD5(DeltaDS.FieldByName('formulario').NewValue+
                DeltaDS.FieldByName('modulo').NewValue+'mof');
      end;
end;

function TSM.CAD_DP_C_PESDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPes: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PES  ';
  end;
begin
   CAD_SQ_C_PES.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PES.CommandText := enSqlPes + ' WHERE 1=2 '
        else
           CAD_SQ_C_PES.CommandText := enSqlPes +
             ' WHERE ID_PERFIL_SEG = ''' + VarToStr(Input[1]) +''' ' +
             ' order by ID_PERFIL_SEG ' ;
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PES.CommandText := enSqlPes +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
           ' order by DESCRICAO ' ;
      end;
   Result := CAD_DP_C_PES.Data;
end;

function TSM.CAD_DP_C_PRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCadPrg: String;
  begin
    Result :=
    'select prg.*,                              ' +
    '    case modulo                            ' +
    '      when ''0'' then  ''BCO-Banco/Caixa'' ' +
    '      when ''1'' then  ''CAD-Cadastros''   ' +
    '      when ''2'' then  ''CMP-Compras'' '     +
    '      when ''3'' then  ''CSU-Consultas'' '   +
    '      when ''4'' then  ''EST-Estoque'' '     +
    '      when ''5'' then  ''FAT-Faturamento'' ' +
    '      when ''6'' then  ''OFI-Oficina'' '     +
    '      when ''7'' then  ''PAG-Contas a Pagar'' '   +
    '      when ''8'' then  ''REC-Contas a Receber'' ' +
    '      when ''9'' then  ''SEG-Segurana'' ' +
    '      when ''10'' then ''SGQ-Gesto de Qualidade'' ' +
    '      when ''11'' then ''TAB-Tabelas'' ' +
    '    else ''????'' end as int_modulo, '   +
    '   case tipo                  ' +
    '    when 0 then ''Formulrio''    ' +
    '    when 1 then ''Relatrio''     ' +
    '   else ''?????'' end as int_tipo ' +
    ' from CAD_TB_C_PRG PRG ';

  end;
begin
   CAD_SQ_C_PRG.Close;

   CAD_SQ_C_PRG.CommandText := enSqlCadPrg + ' where 1 = 1 ';

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText + ' and 1=2 '
        else
           CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText +
             ' and PRG.ID_PRG = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText +
          Format(' and upper(PRG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText +
          Format(' and upper(PRG.NOME_PROGRAMA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText +
          ' and upper(PRG.NOME_PROGRAMA) = ''' + VarToStr(Input[1]) +''' ';;
      end;

   if Input[2] <> '' then
      begin
        CAD_SQ_C_PRG.CommandText := CAD_SQ_C_PRG.CommandText +
                 ' and prg.tipo = ''' + VarToStr(Input[2]) +''' ';
      end;
   Result := CAD_DP_C_PRG.Data;
end;

function TSM.CAD_DP_C_RAMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRam: String;
  begin
    Result :=
      'SELECT RAM.*, CNE.DESCRICAO AS INT_NOMECNE '+
      'FROM CAD_TB_C_RAM RAM '+
      'LEFT OUTER JOIN CAD_TB_C_CNE CNE ON CNE.ID_CNAE=RAM.ID_CNAE ';

  end;
begin
   CAD_SQ_C_RAM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_RAM.CommandText := enSqlRam + ' WHERE 1=2 '
        else
           CAD_SQ_C_RAM.CommandText := enSqlRam +
             ' WHERE RAM.ID_RAMO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_RAM.CommandText := enSqlRam +
          Format('WHERE upper(RAM.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;


   Result := CAD_DP_C_RAM.Data;
end;

function TSM.CAD_DP_C_RVDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRvd: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_RVD   ';
  end;
begin
   CAD_SQ_C_RVD.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_RVD.CommandText := enSqlRvd + ' WHERE 1=2 '
        else
           CAD_SQ_C_RVD.CommandText := enSqlRvd +
             ' WHERE ID_RVD = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_RVD.CommandText := enSqlRvd +
          Format(' WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_RVD.Data;

   CAD_SQ_C_RVD.Close;
end;

function TSM.CAD_DP_C_SEQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlSet: String;
  begin
    Result := ' select * from cad_tb_c_seq seq ';
  end;
begin
   CAD_SQ_C_SEQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_SEQ.CommandText := enSqlSet + ' WHERE 1=2 '
        else
           CAD_SQ_C_SEQ.CommandText := enSqlSet +
             ' WHERE SEQ.ID_TABELA= ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 1 then
      begin
        CAD_SQ_C_SEQ.CommandText := enSqlSet +
            ' WHERE SEQ.ID_TABELA in (' + VarToStr(Input[1]) +') ';
      end;

   Result := CAD_DP_C_SEQ.Data;

   CAD_SQ_C_SEQ.Close;
end;

function TSM.CAD_DP_C_SETDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlSet: String;
  begin
    Result :=

      ' select STR.*, '+
      ' CAST (CASE STR.TIPO '+
      '            WHEN 0 THEN ''Laminao'' '+
      '            WHEN 1 THEN ''Bordadeira''  '+
      '            WHEN 2 THEN ''Colagem''     '+
      '            WHEN 3 THEN ''Costura''     '+
      '            WHEN 4 THEN ''Alfinetagem'' '+
      '            WHEN 5 THEN ''Outros''      '+
      '        ELSE ''?????'' END AS VARCHAR(15)) AS INT_TIPO_DESC '+
      ' from CAD_TB_C_SET STR ';
  end;
begin
   CAD_SQ_C_SET.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_SET.CommandText := enSqlSet + ' WHERE 1=2 '
        else
           CAD_SQ_C_SET.CommandText := enSqlSet +
             ' WHERE STR.ID_SETOR= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_SET.CommandText := enSqlSet +
          Format('WHERE upper(STR.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_SET.Data;
end;

function TSM.CAD_DP_C_TAMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTam: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_TAM  ';
  end;
begin
   CAD_SQ_C_TAM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TAM.CommandText := enSqlTam + ' WHERE 1=2 '
        else
           CAD_SQ_C_TAM.CommandText := enSqlTam +
             ' WHERE ID_TAMANHO= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_TAM.CommandText := enSqlTam +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [Uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_TAM.Data;
end;


function TSM.CAD_DP_C_TDFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTdf: String;
  begin
    Result :=  'select * from CAD_TB_C_TDF ';
  end;
begin

   CAD_SQ_C_TDF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TDF.CommandText := enSqlTdf + ' WHERE 1=2 '
        else
           CAD_SQ_C_TDF.CommandText := enSqlTdf +
             ' WHERE ID_TDF = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_TDF.CommandText := enSqlTdf +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;



   Result := CAD_DP_C_TDF.Data;


end;

function TSM.CAD_DP_C_TIFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTif: String;
  begin
    Result := ' SELECT TIF.*, ' +
              ' CAST (CASE TIF.NATUREZA ' +
              '    WHEN 0 THEN ''Dbito''  ' +
              '    WHEN 1 THEN ''Crdito'' ' +
              ' ELSE ''?????'' END AS VARCHAR(15)) AS INT_NATUREZA, ' +

              '  CAST (CASE TIF.PRESTACAO_CONTA                             '+
              '    WHEN false THEN ''No''                                  '+
              '   WHEN true THEN ''Sim''                                    '+
              '    ELSE ''?????'' END AS VARCHAR(4)) AS INT_PRESTACAO_CONTA, '+

              ' CAST (CASE TIF.GERA_DEB_CRE                            '+
              '    WHEN false THEN ''No''                             '+
              '   WHEN true THEN ''Sim''                               '+
              '    ELSE ''?????'' END AS VARCHAR(4)) AS INT_DEB_CRE    '+

              ' FROM CAD_TB_C_TIF TIF ';
  end;
begin
   CAD_SQ_C_TIF.Close;
   CAD_SQ_C_TIF.CommandText := enSqlTif;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText + ' WHERE 1=2 '
        else
           CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText +
             ' WHERE TIF.ID_TIPO_FINANCEIRO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText +
          Format(' WHERE upper(TIF.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        if Input[1] <> '' then
           begin
              CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText +
                 ' WHERE TIF.NATUREZA IN (' + VarToStr(input[1]) + ')' ;
           end;
     end
   else if Input[0] = 90 then
      begin
           CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText +
             ' WHERE TIF.NATUREZA = ''' + VarToStr(Input[1]) +''' ';
      end;
   CAD_SQ_C_TIF.CommandText := CAD_SQ_C_TIF.CommandText + ' order by TIF.descricao ';
   Result := CAD_DP_C_TIF.Data;
end;

function TSM.OFI_DP_C_CATDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiCat: String;
  begin
    Result := ' SELECT * FROM OFI_TB_C_CAT  ';
  end;
begin
   OFI_SQ_C_CAT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_C_CAT.CommandText := enSqlOfiCat + ' WHERE 1=2 '
        else
           OFI_SQ_C_CAT.CommandText := enSqlOfiCat +
             ' WHERE ID_CAT = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_C_CAT.CommandText := enSqlOfiCat +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := OFI_DP_C_CAT.Data;

   OFI_SQ_C_CAT.Close;
end;

function TSM.OFI_DP_C_TIODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlOfiTio: String;
  begin
    Result := ' SELECT * FROM OFI_TB_C_TIO  ';
  end;
begin
   OFI_SQ_C_TIO.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_C_TIO.CommandText := enSqlOfiTio + ' WHERE 1=2 '
        else
           OFI_SQ_C_TIO.CommandText := enSqlOfiTio +
             ' WHERE ID_TIPO_OS = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_C_TIO.CommandText := enSqlOfiTio +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := OFI_DP_C_TIO.Data;
end;

function TSM.CAD_DP_C_TMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTme: String;
  begin
    Result :=
        'SELECT TME.*, '+
        '    Nif.descricao AS INT_NOMEIPF, '+
        '    NiJ.descricao AS INT_NOMEIPJ, '+
        '    Nef.descricao AS INT_NOMEEPF, '+
        '    Nej.descricao AS INT_NOMEEPJ '+
        'FROM CAD_TB_C_TME TME '+
        'LEFT OUTER JOIN CAD_TB_C_CFO CIF ON CIF.id_cfo = tme.cfo_interno_pf '+
        'LEFT OUTER JOIN CAD_TB_C_CFO CIJ ON CIJ.id_cfo = tme.cfo_interno_pj '+
        'LEFT OUTER JOIN CAD_TB_C_CFO CEF ON CEF.id_cfo = tme.cfo_externo_pf '+
        'LEFT OUTER JOIN CAD_TB_C_CFO CEJ ON CEJ.id_cfo = tme.cfo_externo_pj '+
        'LEFT OUTER JOIN CAD_TB_C_NAT NIF ON NIF.ID_CLASSE = CIF.ID_CLASSE '+
        'LEFT OUTER JOIN CAD_TB_C_NAT NIJ ON NIJ.ID_CLASSE = CIJ.ID_CLASSE '+
        'LEFT OUTER JOIN CAD_TB_C_NAT NEF ON NEF.ID_CLASSE = CEF.ID_CLASSE '+
        'LEFT OUTER JOIN CAD_TB_C_NAT NEJ ON NEJ.ID_CLASSE = CEJ.ID_CLASSE ';
  end;
begin
   CAD_SQ_C_TME.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TME.CommandText := enSqlTme + ' WHERE 1=1 '
        else
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+''' AND TME.ID_TIPO_MOV_ESTOQUE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_TME.CommandText := enSqlTme +
          Format('WHERE TME.ATIVO='''+'TRUE'+''' AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+''' AND TME.TIPO_MOVIMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+''' AND TME.TIPO_MOVIMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+''' AND TME.INDICADOR = 0 AND ' +
             '       TME.TIPO_MOVIMENTO = ''' + VarToStr(Input[1]) +''' ' ;
      end
   else if Input[0] = 5 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+'''  AND TME.INDICADOR in (0,1) AND ' +
             '   TME.ESTO_MOVIMENTA= ''TRUE''  AND TME.TIPO_MOVIMENTO in (0,1) ' ;
      end
   else if Input[0] = 6 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+''' AND TME.INDICADOR = 1 AND ' +
             '       TME.TIPO_MOVIMENTO in (' + VarToStr(Input[1]) +') ' ;
      end
    else if Input[0] = 7 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+'''  AND TME.INDICADOR = 0 AND ' +
             '   TME.ESTO_MOVIMENTA= ''FALSE''  AND TME.TIPO_MOVIMENTO = 1' ;
      end
    else if Input[0] = 8 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+'''  AND TME.INDICADOR IN (0,2) AND ' +
             '  TME.TIPO_MOVIMENTO = ''' + VarToStr(Input[1]) +''' ' ;
      end
    else if Input[0] = 9 then
      begin
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ATIVO='''+'TRUE'+'''  AND TME.INDICADOR in (0,1,2) AND ' +
             '   TME.ESTO_MOVIMENTA= ''TRUE''  AND TME.TIPO_MOVIMENTO in (0,1) ' ;
      end;

   if Input[0] = 90 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TME.CommandText := enSqlTme + ' WHERE 1=1 '
        else
           CAD_SQ_C_TME.CommandText := enSqlTme +
             ' WHERE TME.ID_TIPO_MOV_ESTOQUE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        CAD_SQ_C_TME.CommandText := enSqlTme +
          Format('WHERE upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_TME.Data;
   CAD_SQ_C_TME.Close;
end;

function TSM.CAD_DP_C_TRIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTri: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_TRI  ';
  end;
begin
   CAD_SQ_C_TRI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_TRI.CommandText := enSqlTri + ' WHERE 1=2 '
        else
           CAD_SQ_C_TRI.CommandText := enSqlTri +
             ' WHERE ID_TRIBUTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_TRI.CommandText := enSqlTri +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_TRI.Data;
end;

function TSM.CAD_DP_C_UNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlUnd: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_UND  ';
  end;
begin
   CAD_SQ_C_UND.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_UND.CommandText := enSqlUnd + ' WHERE 1=2 '
        else
           CAD_SQ_C_UND.CommandText := enSqlUnd +
             ' WHERE ID_UNIDADE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_UND.CommandText := enSqlUnd +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CAD_DP_C_UND.Data;
end;

function TSM.CAD_DP_C_VEIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCadVei: String;
  begin
    Result :=
      'select vei.*, cli.nome as int_nomecli,'+
      '          mve.descricao as int_nomemve, '+
      '          cor.descricao as int_nomecor, cat.id_cat as int_id_cat, cat.descricao as int_nomecat, '+
      ' case ' +
      '  when VEI.COMBUSTIVEL = 0 then ''Gasolina'' ' +
      '  when VEI.COMBUSTIVEL = 1 then ''Alcool''   ' +
      '  when VEI.COMBUSTIVEL = 2 then ''Diesel''   ' +
      '  when VEI.COMBUSTIVEL = 3 then ''Gas Natural'' ' +
      '  when VEI.COMBUSTIVEL = 4 then ''Eletrico''    ' +
      '  when VEI.COMBUSTIVEL = 5 then ''Flex''        ' +
      ' end as int_nomecom ' +
      ' from CAD_TB_C_VEI vei '+
      '   left outer join cad_tb_c_mve mve on mve.id_mve=vei.id_mve '+
      '   left outer join cad_tb_c_cor cor on cor.id_cor=vei.id_cor ' +
      '   left outer join ofi_tb_c_cat cat on cat.id_cat=mve.id_cat '+
      '   left outer join cad_tb_c_cli cli on cli.id_cliente=vei.id_cliente ';
  end;
begin
   CAD_SQ_C_VEI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_VEI.CommandText := enSqlCadVei + ' WHERE 1=2 '
        else
           CAD_SQ_C_VEI.CommandText := enSqlCadVei +
             ' WHERE vei.id_veiculo = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
          Format('WHERE upper(VEI.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
             ' WHERE VEI.DTA_AQUISICAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
           Format('WHERE upper(vei.id_placa) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
          Format('WHERE upper(VEI.chassi) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
           CAD_SQ_C_VEI.CommandText := enSqlCadVei +
             ' WHERE vei.id_mve = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
          Format('WHERE upper(MVE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 7 then
      begin
        CAD_SQ_C_VEI.CommandText := enSqlCadVei +
          Format('WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := CAD_DP_C_VEI.Data;
   CAD_SQ_C_VEI.Close;

end;

function TSM.CAD_DP_C_VISDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCadVis: String;
  begin
  Result :=
      'select vis.*, '+
      ' fun.nome as int_vendedor '+
      ' from PRO_TB_M_VIS vis '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=vis.id_vendedor ';
  end;
begin
  CAD_SQ_C_VIS.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_VIS.CommandText := enSqlCadVis + ' WHERE 1=2 '
        else
          CAD_SQ_C_VIS.CommandText := enSqlCadVis +
            ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            ' and VIS.ID_VIS = ''' + VarToStr(Input[2]) +''' ' +
            ' AND VIS.ID_VENDEDOR = ''' + VarToStr(Input[3]) +''' ';
      end

   else if Input[0] = 1 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
             ' and   VIS.ANO = ''' + VarToStr(Input[2]) +''' ' +
             ' and   VIS.ID_VENDEDOR = ''' + VarToStr(Input[3]) +''' ';
      end


   else if Input[0] = 2 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
             ' and VIS.SEMANA = ''' + VarToStr(Input[2]) +''' ' +
             ' and VIS.ID_VENDEDOR = ''' + VarToStr(Input[3]) +''' ';
      end

   else if Input[0] = 3 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadViS +
         ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
          Format('and upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) ;

      end
    else if Input[0] = 4 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.FECHADA = false and VIS.ID_VENDEDOR = ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 5 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
             ' and   VIS.ANO = ''' + VarToStr(Input[2]) +''' ' +
             ' and   VIS.SEMANA = ''' + VarToStr(Input[3]) +''' ' +
             ' and   VIS.ID_VENDEDOR = ''' + VarToStr(Input[4]) +''' ';
      end
    else if Input[0] = 6 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
             ' and   VIS.FECHADA = false ';
      end
    else if Input[0] = 7 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_VIS = ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 8 then
      begin
        CAD_SQ_C_VIS.CommandText := enSqlCadVis +
             ' WHERE VIS.ID_VIS in ' +
             '  ( select vvv.id_vis from cad_tb_c_cli cli ' +
             '     left outer join pro_tb_m_vis_cli vcl on vcl.doc_cnpj_cpf = cli.doc_cnpj_cpf ' +
             '     left outer join pro_tb_m_vis vvv     on vvv.id_vis = vcl.id_vis ' +
             '    where vvv.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
                   Format('and upper(cli.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
             '  ) ';
        {qry := TSqlQuery.Create(self);
        qry.SQLConnection := self.Conexao;
        qry.SQLConnection}
      end;

   Result := CAD_DP_C_VIS.Data;
   CAD_SQ_C_VIS.Close;
end;

function TSM.CAD_DP_C_VITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCadVit: String;
  begin
  Result :=
      'select vit.*, '+
      ' fun.nome as int_vendedor, '+
      ' cli.nome as int_cliente, '+
      ' vei.id_placa as placa '+
      ' from CAD_TB_C_VIT vit '+
      '   left outer join cad_tb_c_fun fun on fun.id_funcionario=vit.id_vendedor '+
      '   left outer join cad_tb_c_cli cli on cli.id_cliente=vit.id_cliente ' +
      '   left outer join cad_tb_c_vei vei on vei.id_veiculo=vit.id_veiculo ';
  end;
begin
   CAD_SQ_C_VIT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_VIT.CommandText := enSqlCadVit + ' WHERE 1=2 '
        else
          CAD_SQ_C_VIT.CommandText := enSqlCadVit + ' WHERE VIT.ID_VISITA = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 1 then
      begin
        CAD_SQ_C_VIT.CommandText := enSqlCadVit +
             ' WHERE VIT.DTA_VISITA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        CAD_SQ_C_VIT.CommandText := enSqlCadVit +
           Format('WHERE upper(cli.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        CAD_SQ_C_VIT.CommandText := enSqlCadVit +
          Format('WHERE upper(vei.id_placa) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        CAD_SQ_C_VIT.CommandText := enSqlCadVit +
          Format('WHERE upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[2] <> '' then
      BEGIN
        CAD_SQ_C_VIT.CommandText := CAD_SQ_C_VIT.CommandText + 'AND VIT.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
      END;

   Result := CAD_DP_C_VIT.Data;
   CAD_SQ_C_VIT.Close;
end;

function TSM.CMP_DP_M_COTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCmpCot: String;
  begin
    Result :=
      'select cot.*, fuc.nome as int_nomeres '+
      'from CMP_TB_M_COT cot '+
      'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=cot.id_funcionario ';
  end;

begin
   CMP_SQ_M_COT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CMP_SQ_M_COT.CommandText := enSqlCmpCot + ' WHERE 1=2 '
        else
           CMP_SQ_M_COT.CommandText := enSqlCmpCot +
             ' WHERE COT.ID_COTACAO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CMP_SQ_M_COT.CommandText := enSqlCmpCot +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CMP_SQ_M_COT.CommandText := enSqlCmpCot +
             ' WHERE COT.DTA_COTACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;

   Result := CMP_DP_M_COT.Data;
end;

function TSM.CMP_DP_M_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCmpPed: String;
  begin
    Result :=
      ' SELECT PED.*,  '+
      '   FOC.descricao AS INT_NOMEFOR, '+
      '   FUC.nome AS INT_NOMEFUN, '+
      ' cast (case ped.aprovado ' + #13#10 +
      '     when true then ''Aprovado''' + #13#10 +
      '     when true then ''Reprovado''' + #13#10 +
      '   else ' + #13#10 +
      '     ''Em aberto'' end as varchar(20) ) as int_aprovado' +
      ' FROM CMP_TB_M_PED PED '+
      ' LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.id_fornecedor=PED.id_fornecedor '+
      ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.id_funcionario=PED.id_responsavel ';
  end;
begin
   CMP_SQ_M_PED.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CMP_SQ_M_PED.CommandText := enSqlCmpPed + ' WHERE 1=2 '
        else
           CMP_SQ_M_PED.CommandText := enSqlCmpPed +
             ' WHERE PED.ID_PEDIDO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
          Format('WHERE upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
             ' WHERE PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
          Format('WHERE upper(PED.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
          ' WHERE PED.APROVADO IS NULL ';
      end
   else if Input[0] = 6 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.APROVADO=TRUE ';
      end
   else if Input[0] = 7 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.APROVADO=FALSE ';
      end;
   if Input[0] = 90 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.ID_FORNECEDOR = '''+ VarToStr(Input[1]) +''' AND  PED.STATUS in (0,1) ';
      end;
   if Input[0] = 91 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.ID_COTACAO = '''+ VarToStr(Input[1]) +'''  ';
      end;

   if Input[0] = 92 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.ID_SOLICITACAO = '''+ VarToStr(Input[1]) +'''  ';
      end;
   if Input[0] = 93 then
      begin
        CMP_SQ_M_PED.CommandText := enSqlCmpPed +
           ' WHERE PED.APROVADO = TRUE AND PED.ID_FORNECEDOR = '''+ VarToStr(Input[1]) +''' AND  PED.STATUS in (0,1) ';
      end;


   CMP_SQ_M_PED.CommandText := CMP_SQ_M_PED.CommandText +
           ' ORDER BY PED.DTA_PEDIDO DESC ';

   Result := CMP_DP_M_PED.Data;

end;

function TSM.CMP_DP_M_SOLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCmpSol: String;
  begin
    Result :=
      'SELECT SOL.* , '+
      'FUC.NOME AS INT_NOMEFUN, SEC.DESCRICAO AS INT_NOMESET '+
      'FROM CMP_TB_M_SOL SOL '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=SOL.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=SOL.ID_SETOR ';
  end;
begin
   CMP_SQ_M_SOL.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CMP_SQ_M_SOL.CommandText := enSqlCmpSol + ' WHERE 1=2 '
        else
           CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.ID_SOLICITACAO = ' + VarToStr(Input[1]);
      end
   else if Input[0] = 1 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.ID_FUNCIONARIO = ' + VarToStr(Input[1]);
      end
   else if Input[0] = 2 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.DTA_SOLICITACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 90 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.STATUS = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.id_pedido_imp = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 92 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.id_op = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 93 then
      begin
        CMP_SQ_M_SOL.CommandText := enSqlCmpSol +
             ' WHERE SOL.id_op = ''' + VarToStr(Input[1]) +''' ' +
             '   and SOL.id_opr_req = ''' + VarToStr(Input[2]) +''' ';
      end;

   CMP_SQ_M_SOL.CommandText := CMP_SQ_M_SOL.CommandText +
           ' ORDER BY SOL.DTA_SOLICITACAO, SOL.ID_SOLICITACAO ';
//   CMServerForm.mm.Lines.Add(CMP_SQ_M_SOL.CommandText);
   Result := CMP_DP_M_SOL.Data;
end;

function TSM.CSU_DP_M_AUDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlAud: String;
  begin
    Result :=
      ' SELECT aud.*, fun.nome as int_nomefun, par.emp_fantasia as int_empresa '+
      ' FROM aud_tb_m_aud aud '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=aud.id_usuario '+
      ' left outer join cad_tb_c_par par on par.id_empresa=aud.id_empresa ';

  end;
begin
  CSU_SQ_M_AUD.Close;
  CSU_SQ_M_AUD.CommandText := enSqlAud +
    ' WHERE aud.dta_servidor >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
    '       aud.dta_servidor <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

  if Input[2] <> '' then
    begin
      CSU_SQ_M_AUD.CommandText := CSU_SQ_M_AUD.CommandText +
       ' and aud.id_empresa in (' + VarToStr(Input[2]) +') ';
    end;

  if Input[3] <> '' then
    begin
      CSU_SQ_M_AUD.CommandText := CSU_SQ_M_AUD.CommandText +
       ' and aud.id_usuario in (' + VarToStr(Input[3]) +') ';
    end;

  if Input[4] <> '' then
    begin
      CSU_SQ_M_AUD.CommandText := CSU_SQ_M_AUD.CommandText +
       ' and aud.programa in (' + VarToStr(Input[4]) +') ';
    end;

  if Input[5] <> '' then
    begin
      CSU_SQ_M_AUD.CommandText := CSU_SQ_M_AUD.CommandText +
      Format(' AND upper(CONVERT_from(arq_auditoria,''utf8'')) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[5]))]);
    end;

  CSU_SQ_M_AUD.CommandText := CSU_SQ_M_AUD.CommandText +
    ' ORDER BY id_aud ';

  Result := CSU_DP_M_AUD.Data;
end;

function TSM.CSU_DP_M_PSCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
CSU_SQ_M_PSC.Close;
CSU_SQ_M_PSC.CommandText:=
      ' SELECT ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       ) as TOTAL_CLIENTES  , ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_1 = 1 ) as QTDE_PERGUNTA_1_SIM  , ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_1 = 0 )  as QTDE_PERGUNTA_1_NAO, ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_2 = 1 ) as QTDE_PERGUNTA_2_SIM  , ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_2 = 0 )  as QTDE_PERGUNTA_2_NAO, ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_3 = 0 ) as QTDE_PERGUNTA_3_MENOS_DE_1_ANO  , ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_3 = 1 )  as QTDE_PERGUNTA_3_MAIS_DE_1_ANO, ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_4 = 0 )  as QTDE_PERGUNTA_4_MELHOR, ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_4 = 1 ) as QTDE_PERGUNTA_4_IGUAL  , ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_4 = 2 )  as QTDE_PERGUNTA_4_PIOR, ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_5 = 0 )  as QTDE_PERGUNTA_5_EXCELENTE, ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_5 = 1 )  as QTDE_PERGUNTA_5_BOM, ' +
      '   (SELECT COUNT(*) FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_5 = 2 ) as QTDE_PERGUNTA_5_RAZOAVEL  , ' +
      '   (SELECT COUNT(*)FROM PCP_TB_M_PSC PSC ' +
      '     WHERE  ID_EMPRESA = PAR.ID_EMPRESA ' +
      '       AND  DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
      '       AND  DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
      '       AND  PERGUNTA_5 = 3 )  as QTDE_PERGUNTA_5_RUIM ' +
      ' FROM CAD_TB_C_PAR PAR       ' +
      ' WHERE PAR.ID_EMPRESA = ' + VarToStr(Input[0]);
   Result := CSU_DP_M_PSC.Data;
end;

function TSM.ctc_dp_c_eocDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcEoc: String;
  begin
    Result := ' select * from ctc_tb_c_eoc ';

  end;
begin
   CTC_SQ_C_EOC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_C_EOC.CommandText := enSqlCtcEoc + ' WHERE 1=2 '
        else
           CTC_SQ_C_EOC.CommandText := enSqlCtcEoc +
             ' WHERE ID_ESTRUTURA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_C_EOC.CommandText := enSqlCtcEoc +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CTC_DP_C_EOC.Data;
end;

procedure TSM.ctc_dp_c_epiBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
  if UpdateKind = ukInsert then
     begin
       if SourceDS = CTC_SQ_C_EPI then
          begin
            DeltaDS.fieldByName('ID_EPI').newValue:= enValorChave('CTC_TB_C_EPI');
          end;
     end;
end;

function TSM.ctc_dp_c_epiDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcEpi: String;
  begin
    Result := ' select epi.* , und.descricao as int_nomeund ' +
              ' from ctc_tb_c_epi epi ' +
              ' left outer join cad_tb_c_und und on und.id_unidade=epi.id_unidade ';

  end;
begin
   CTC_SQ_C_EPI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_C_EPI.CommandText := enSqlCtcEpi + ' WHERE 1=2 '
        else
           CTC_SQ_C_EPI.CommandText := enSqlCtcEpi +
             ' WHERE EPI.ID_EPI = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_C_EPI.CommandText := enSqlCtcEpi +
          Format('WHERE upper(epi.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := CTC_DP_C_EPI.Data;

end;

function TSM.ctc_dp_c_obrDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcObr: String;
  begin
    Result := 'select obr.* , cli.nome as int_nomecli, cid.nome as int_nomecid,cid.uf as int_nomeuf '+
              'from ctc_tb_c_obr obr '+
              'left outer join cad_tb_c_cli cli on cli.id_cliente=obr.id_cliente '+
              'left outer join cad_tb_c_cid cid on cid.id_cidade=obr.id_cidade';
  end;
begin
   CTC_SQ_C_OBR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_C_OBR.CommandText := enSqlCtcObr + ' WHERE 1=2 '
        else
           CTC_SQ_C_OBR.CommandText := enSqlCtcObr +
             ' WHERE OBR.ID_OBRA = ''' + VarToStr(Input[1]) +''' ';

        if Trim(VarToStr(Input[2])) <> '' then
           begin
             CTC_SQ_C_OBR.CommandText := CTC_SQ_C_OBR.CommandText+
                ' AND OBR.ATIVO = '''+VarToStr(Input[2])+''' ';
           end;
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_C_OBR.CommandText := enSqlCtcObr +
          ' WHERE upper(OBR.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
         if Trim(VarToStr(Input[2])) <> '' then
           begin
              CTC_SQ_C_OBR.CommandText := CTC_SQ_C_OBR.CommandText+
                 ' AND OBR.ATIVO = '''+VarToStr(Input[2])+''' ';
           end;
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_C_OBR.CommandText := enSqlCtcObr +
          ' WHERE upper(CLI.NOME) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
         if Trim(VarToStr(Input[2])) <> '' then
           begin
             CTC_SQ_C_OBR.CommandText := CTC_SQ_C_OBR.CommandText+
                  ' AND OBR.ATIVO = '''+VarToStr(Input[2])+''' ';
           end;
      end
   else if Input[0] = 3 then
      begin
        CTC_SQ_C_OBR.CommandText := enSqlCtcObr +
          ' WHERE upper(CID.NOME) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
         if Trim(VarToStr(Input[2])) <> '' then
           begin
             CTC_SQ_C_OBR.CommandText := CTC_SQ_C_OBR.CommandText+
                  ' AND OBR.ATIVO = '''+VarToStr(Input[2])+''' ';
           end;
      end;



   Result := CTC_DP_C_OBR.Data;

end;

function TSM.ctc_dp_c_ocoDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCtcOco: String;
  begin
    Result := ' select * from ctc_tb_c_oco ';
  end;
begin
   ctc_sq_c_oco.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           ctc_sq_c_oco.CommandText := enSqlCtcOco + ' WHERE 1=2 '
        else
           ctc_sq_c_oco.CommandText := enSqlCtcOco +
             ' WHERE id_ocorrencia = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        ctc_sq_c_oco.CommandText := enSqlCtcOco +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := ctc_dp_c_oco.Data;
   ctc_sq_c_oco.Close;
end;

procedure TSM.ctc_dp_c_tprBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
  if UpdateKind = ukInsert then
     begin
       if SourceDS = CTC_SQ_C_TPR then
          begin
            DeltaDS.fieldByName('ID_TPR').newValue:= enValorChave('CTC_TB_C_TPR');
          end;
     end;

end;

function TSM.ctc_dp_c_tprDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlTpr: String;
  begin
    Result := ' select * from ctc_tb_c_tpr  ';
  end;
begin
   ctc_sq_c_tpr.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           ctc_sq_c_tpr.CommandText := enSqlTpr + ' WHERE 1=2 '
        else
           ctc_sq_c_tpr.CommandText := enSqlTpr +
             ' WHERE id_tpr = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        ctc_sq_c_tpr.CommandText := enSqlTpr +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := ctc_dp_c_tpr.Data;

end;

function TSM.CTC_DP_M_APGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCtcApg: String;
  begin
    Result :=
       ' select apg.* from ctc_tb_m_apg apg ';
  end;
begin
   CTC_SQ_M_APG.Close;
   CTC_SQ_M_APG.CommandText := '';
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_APG.CommandText := enSqlCtcApg + ' WHERE 1=2 '
        else
           CTC_SQ_M_APG.CommandText := enSqlCtcApg +
             ' WHERE APG.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             ' AND APG.ID_APG = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           CTC_SQ_M_APG.CommandText := enSqlCtcApg +
             ' WHERE APG.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             ' AND APG.DIA = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
           CTC_SQ_M_APG.CommandText := enSqlCtcApg +
             ' WHERE APG.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             Format(' and upper(APG.HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
    else if Input[0] = 3 then
      begin
           CTC_SQ_M_APG.CommandText := enSqlCtcApg +
              ' WHERE APG.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
              '  AND APG.ID_OBRA = '''+ VarToStr(Input[2])+''' ';
      end;

   Result := CTC_DP_M_APG.Data;
end;

function TSM.ctc_dp_m_avfDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcAvf: String;
  begin
    Result := 'select avf.* ,fuc.nome as int_nomeres '+
              'from ctc_tb_m_avf avf '+
              'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=avf.id_responsavel ';
  end;
begin
   ctc_sq_m_Avf.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           ctc_sq_m_Avf.CommandText := enSqlCtcAvf + ' WHERE 1=2 '
        else
           ctc_sq_m_Avf.CommandText := enSqlCtcAvf +
             ' WHERE id_avf = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 1 then
      begin
        ctc_sq_m_Avf.CommandText := enSqlCtcAvf +
             ' WHERE avf.DTA_AVF = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        ctc_sq_m_Avf.CommandText := enSqlCtcAvf +
          ' WHERE upper(fuc.nome) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 3 then
      begin
        ctc_sq_m_Avf.CommandText := enSqlCtcAvf +
          ' WHERE upper(nom_fornecedor) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 4 then
      begin
           ctc_sq_m_Avf.CommandText := enSqlCtcAvf +
             ' WHERE avf.doc_cnpj = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := ctc_dp_m_Avf.Data;

end;

function TSM.ctc_dp_m_bdeDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcBde: String;
  begin
    Result := 'select bde.* , '+
              ' cli.nome as int_nomecli, '+
              ' meq.descricao as int_nomemeq, '+
              ' obr.descricao as int_nomeobr, '+
              '  meq.vlr_hora as int_vlrhora, ' +
              '  meq.vlr_comissao as int_vlrcomissao, ' +
              '  fuc.nome as int_nomeope '+
              'from ctc_tb_m_bde bde '+
              ' left outer join cad_tb_c_cli cli on cli.id_cliente=bde.id_cliente '+
              ' left outer join pcp_tb_c_meq meq on meq.id_meq=bde.id_meq '+
              ' left outer join ctc_tb_c_obr obr on obr.id_obra=bde.id_obra '+
              ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=bde.id_operador ';
  end;
begin
   CTC_SQ_M_BDE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_BDE.CommandText := enSqlCtcBde + ' WHERE 1=2 '
        else
           CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
             ' WHERE BDE.ID_BDE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
          ' WHERE upper(CLI.NOME) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
          ' WHERE upper(MEQ.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 3 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
             ' WHERE BDE.DTA_BDE = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
          ' WHERE upper(OBR.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 5 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
          ' WHERE upper(FUC.NOME) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 6 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
          ' WHERE upper(BDE.OCORRENCIA) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
  else if Input[0] = 7 then
      begin
        CTC_SQ_M_BDE.CommandText := enSqlCtcBde +
             ' WHERE BDE.NRO_BDE = ''' + VarToStr(Input[1]) +''' ';
      end;

  
   Result := CTC_DP_M_BDE.Data;

   CTC_SQ_M_BDE.Close;

end;

function TSM.ctc_dp_m_cepDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcCep: String;
  begin
    Result := 'select cep.* , fuc.nome as int_nomeres '+
              'from ctc_tb_m_cep cep '+
              'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=cep.id_responsavel ';
  end;
begin
   CTC_SQ_M_CEP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_CEP.CommandText := enSqlCtcCep + ' WHERE 1=2 '
        else
           CTC_SQ_M_CEP.CommandText := enSqlCtcCep +
             ' WHERE CEP.ID_CEP = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_M_CEP.CommandText := enSqlCtcCep +
          ' WHERE upper(fuc.nome) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_M_CEP.CommandText := enSqlCtcCep +
             ' WHERE CEP.DATA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;

   Result := CTC_DP_M_CEP.Data;

end;

function TSM.ctc_dp_m_cfeDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcCfe: String;
  begin
    Result := 'select cfe.*, fuc.nome as int_nomeres, fuc.doc_cpf as int_doccpf '+
              'from ctc_tb_m_cfe cfe '+
              'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=cfe.id_funcionario ';
  end;
begin
   CTC_SQ_M_CFE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_CFE.CommandText := enSqlCtcCfe + ' WHERE 1=2 '
        else
           CTC_SQ_M_CFE.CommandText := enSqlCtcCfe +
             ' WHERE CFE.ID_CFE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_M_CFE.CommandText := enSqlCtcCfe +
          ' WHERE upper(fuc.nome) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_M_CFE.CommandText := enSqlCtcCfe +
             ' WHERE CFE.DATA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;

   Result := CTC_DP_M_CFE.Data;
end;

function TSM.ctc_dp_m_facDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcFac: String;
  begin
    Result := ' select fac.*, fuc.nome as int_nomeres '+
              ' from ctc_tb_m_fac fac '+
              ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=fac.pro_id_responsavel ';
  end;
begin
   ctc_sq_m_fac.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           ctc_sq_m_fac.CommandText := enSqlCtcFac + ' WHERE 1=2 '
        else
           ctc_sq_m_fac.CommandText := enSqlCtcFac +
             ' WHERE id_fac = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 2 then
      begin
        ctc_sq_m_fac.CommandText := enSqlCtcFac +
             ' WHERE DTA_ABERTURA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;


   Result := ctc_dp_m_fac.Data;

end;

function TSM.ctc_dp_m_locDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcLoc: String;
  begin
    Result :='select loc.* , obr.descricao as int_nomeobr, '+
             'foc.descricao as int_nomefor, foc.fantasia as int_nomefan, foc.tel_fixo as int_numtel '+
             'from ctc_tb_m_loc loc '+
             'left outer join ctc_tb_c_obr obr on obr.id_obra=loc.id_obra '+
             'left outer join cad_tb_c_for foc on foc.id_fornecedor=loc.id_fornecedor ';
  end;
begin
   CTC_SQ_M_LOC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_LOC.CommandText := enSqlCtcLoc + ' WHERE 1=2 '
        else
           CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
             ' WHERE LOC.ID_LOC = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
          ' WHERE upper(OBR.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
             ' WHERE LOC.DTA_LOCACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
             ' WHERE LOC.NUM_CONTRATO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
             ' WHERE LOC.NUM_DOCUMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        CTC_SQ_M_LOC.CommandText := enSqlCtcLoc +
          ' WHERE upper(foc.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end;

   Result := CTC_DP_M_LOC.Data;

end;

function TSM.ctc_dp_m_ofiDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcOfi: String;
  begin
    Result := 'select ofi.* , foc.descricao as int_nomefor, fuc.nome as int_nomesol, VEI.DESCRICAO AS INT_NOMEVEI '+
              'from ctc_tb_m_ofi ofi '+
              'left outer join cad_tb_c_for foc on foc.id_fornecedor=ofi.id_fornecedor '+
              'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=ofi.id_solicitante '+
              'left outer join cad_tb_c_vei vei on vei.id_veiculo=ofi.id_veiculo ';

  end;
begin
   CTC_SQ_M_OFI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_OFI.CommandText := enSqlCtcOfi + ' WHERE 1=2 '
        else
           CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
             ' WHERE OFI.ID_OFI = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
          ' WHERE upper(foc.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 2 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
          ' WHERE upper(fuc.nome) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 3 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
             ' WHERE OFI.DATA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
          ' WHERE upper(OFI.PROBLEMA) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 5 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
          ' WHERE upper(VEI.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end
   else if Input[0] = 6 then
      begin
        CTC_SQ_M_OFI.CommandText := enSqlCtcOfi +
          ' WHERE upper(VEI.CHASSI) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
      end;


   Result := CTC_DP_M_OFI.Data;

end;

function TSM.ctc_dp_m_orcDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   Result := ctc_rn_m_orc.ctc_dr_m_orc(Sender, Input, ctc_sq_m_orc, ctc_dp_m_orc);
end;

procedure TSM.ctc_dp_m_orcUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
 ctc_rn_m_orc.ctc_ud_m_orc(Sender, DataSet);
end;

function TSM.CTC_DP_M_PMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCtcPme: String;
  begin
    Result := ' Select pme.*, '+
              ' cast(CASE pme.tipo_equip '+
	            ' when ''2'' then vei.descricao '+
	            ' else eqp.descricao '+
              ' end as varchar(60)) as int_equipamento '+
              ' from ctc_tb_m_pme pme '+
              ' left outer join cad_tb_c_vei vei on vei.id_placa=pme.id_equip '+
              ' left outer join pcp_tb_c_meq eqp on cast(eqp.id_meq as char (8))=pme.id_equip ';
  end;
begin
  CTC_SQ_M_PME.Close;
  if Input[0] = 0 then
    begin
      if Trim(VarToStr(Input[1])) = '' then
        CTC_SQ_M_PME.CommandText := enSqlCtcPme + ' WHERE 1=2 '
      else
        CTC_SQ_M_PME.CommandText := enSqlCtcPme +
        ' WHERE PME.ID_PME = ''' + VarToStr(Input[1]) +''' ';
    end
  else if Input[0] = 1 then
    begin
      CTC_SQ_M_PME.CommandText := enSqlCtcPme +
      ' WHERE upper(EQP.DESCRICAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
    end
  else if Input[0] = 2 then
    begin
      CTC_SQ_M_PME.CommandText := enSqlCtcPme +
      ' WHERE upper(PME.MODELO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
    end
  else if Input[0] = 3 then
    begin
      CTC_SQ_M_PME.CommandText := enSqlCtcPme +
      ' WHERE upper(PME.OBSERVACAO) LIKE '''+ uppercase(VarToStr(Input[1]))+'%'+''' ';
    end;

  Result := CTC_DP_M_PME.Data;
end;

function TSM.CTC_DP_M_PRODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCtcPro: String;
  begin
    Result :=
       ' select pro.*,ite.descricao as int_nomeite from ctc_tb_m_pro pro  '+
       '  left outer join cad_tb_c_ite ite on ite.id_item=pro.id_item ';
  end;
begin
   CTC_SQ_M_PRO.Close;
   CTC_SQ_M_PRO.CommandText := '';
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro + ' WHERE 1=2 '
        else
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro +
             ' WHERE PRO.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro +
              Format(' WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro +
             ' WHERE PRO.LOTE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro +
             ' WHERE PRO.DATA = ''' + VarToStr(Input[1]) +''' ';
      end
    else if Input[0] = 4 then
      begin
           CTC_SQ_M_PRO.CommandText := enSqlCtcPro +
              ' WHERE PRO.ID_ITEM = ''' + VarToStr(Input[1]) +''' '+
              '  AND PRO.LOTE = '''+ VarToStr(Input[2])+''' ';
      end;

   Result := CTC_DP_M_PRO.Data;
end;

function TSM.CTC_DP_M_SLMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCtcSlm: String;
  begin
    Result :=
       ' select slm.*,obr.descricao as int_desc_obr, '+
       ' fun.nome as int_nomeresp from ctc_tb_m_slm slm '+
       '  left outer join cad_tb_c_fun fun on (fun.id_funcionario=slm.id_responsavel) '+
       '  left outer join ctc_tb_c_obr obr on (obr.id_obra=slm.id_obra) ';
  end;
begin
   CTC_SQ_M_SLM.Close;
   CTC_SQ_M_SLM.CommandText := '';
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm + ' WHERE 1=2 '
        else
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm +
             ' WHERE SLM.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             ' AND SLM.ID_CONTROLE = '''+ VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 1 then
      begin
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm +
             ' WHERE SLM.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             ' AND SLM.DATA = '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm +
             ' WHERE SLM.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             ' AND SLM.OBRA = '''+ VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 3 then
      begin
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm +
              ' WHERE SLM.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
              Format(' and upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
           CTC_SQ_M_SLM.CommandText := enSqlCtcSlm +
             ' WHERE SLM.ID_EMPRESA = '''+ VarToStr(Input[1])+''' '+
             Format(' and upper(SLM.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

  // CMServerForm.mm.Lines.Add(CTC_SQ_M_SLM.CommandText);
   Result := CTC_DP_M_SLM.Data;
end;

function TSM.ctc_dp_r_bdeDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlBde, CondicaoOrder: String;
begin

  enSqlBDe:='select bde.* , '+
            ' cli.nome as int_nomecli, '+
            ' meq.descricao as int_nomemeq, '+
            ' obr.descricao as int_nomeobr, '+
            ' fuc.nome as int_nomeope '+
            'from ctc_tb_m_bde bde '+
            'left outer join cad_tb_c_cli cli on cli.id_cliente=bde.id_cliente '+
            'left outer join pcp_tb_c_meq meq on meq.id_meq=bde.id_meq  '+
            'left outer join ctc_tb_c_obr obr on obr.id_obra=bde.id_obra '+
            'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=bde.id_operador ';

  ctc_sq_r_bde.Close;
  ctc_sq_r_bde.CommandText :='';


  ctc_sq_r_bde.CommandText := enSqlBDe +
          ' WHERE 1=1 ';


  ctc_sq_r_bde.CommandText := ctc_sq_r_bde.CommandText +
   ' AND bde.dta_bde >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     bde.dta_bde <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';




  if Input[3] <> '' then
      begin
        ctc_sq_r_bde.CommandText := ctc_sq_r_bde.CommandText  +
        ' AND bde.id_obra in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        ctc_sq_r_bde.CommandText := ctc_sq_r_bde.CommandText  +
             ' AND meq.id_meq in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        ctc_sq_r_bde.CommandText := ctc_sq_r_bde.CommandText  +
        ' AND bde.id_operador in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        ctc_sq_r_bde.CommandText := ctc_sq_r_bde.CommandText  +
        ' AND cli.id_cliente in (' + VarToStr(Input[6]) +') ';
      end;

   // Define ordenao dos relatorios

    if Input[0]=0 then
      begin
       CTC_SQ_R_BDE.CommandText := CTC_SQ_R_BDE.CommandText +
       ' ORDER BY int_nomemeq ';
      end
    else if Input[0]=3 then
      begin
        CTC_SQ_R_BDE.CommandText := CTC_SQ_R_BDE.CommandText +
        ' ORDER BY cli.nome,obr.descricao ';
      end
    else
      begin
        CTC_SQ_R_BDE.CommandText := CTC_SQ_R_BDE.CommandText +
        ' ORDER BY int_nomeobr ';
      end;

   //CMServerForm.mm.Lines.Add(CTC_SQ_R_BDE.CommandText);
   Result := ctc_dp_r_bde.Data;
end;

function TSM.CTC_DP_R_COMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

function SqlCtcCom: String;
begin

    Result :=
      ' SELECT OIT.ID_ORC, '+
        ' OIT.GRUPO AS SUBGRUPO, '+
        ' OIT.COD_PRPOPRIO, '+
        ' OIT.descricao, '+
        ' OBR.ID_CLIENTE as INT_CODCLIENTE, '+
        ' OBR.descricao as INT_OBRDESCRICAO, '+
        ' CLI.NOME as INT_NOMECLI, '+
        ' OIT.CLASSE, '+
        ' OIT.VLR_MO, '+
        ' OIT.VLR_MAT,  '+
        ' OIT.PER_LS, '+
        ' OIT.VLR_LS, '+
        ' OIT.PER_BDI, '+
        ' OIT.VLR_BDI, '+
        ' OIT.PER_ADM, '+
        ' OIT.VLR_ADM, '+
        ' OIT.TOTAL_TAXA, '+
        ' OIT.VLR_UNITARIO, '+
        ' OIT.QTDE,  '+
        ' OIT.VLR_TOTAL, '+
        ' SUBSTRING(OIT.GRUPO,1,1) AS GRUPO '+
      ' FROM CTC_TB_M_ORC_ITE OIT '+
      ' LEFT OUTER JOIN CTC_TB_M_ORC ORC ON ORC.ID_ORC=OIT.ID_ORC '+
      ' LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA=ORC.ID_OBRA '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI cli ON CLI.ID_CLIENTE=OBR.ID_CLIENTE ';
end;

begin
    { TODO -oLuan : Criado no dia 27/10/2015 }
    CTC_SQ_R_COM.Close;

   if Input[0] = '0' then
      begin
        CTC_SQ_R_COM.CommandText :=  SqlCtcCom +
                 ' WHERE ORC.ID_OBRA  in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[0] = '1' then
      begin
        CTC_SQ_R_COM.CommandText :=  SqlCtcCom +
                 ' WHERE OIT.ID_ORC  in (' + VarToStr(Input[1]) +') ';
      end;

  CTC_SQ_R_COM.CommandText := CTC_SQ_R_COM.CommandText +
                 ' ORDER BY substring(oit.grupo,1,1),OIT.GRUPO';
  Result := CTC_DP_R_COM.Data;
  CTC_SQ_R_COM.Close;
end;

function TSM.CTC_DP_R_OBRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function SqlObr: String;
begin

    Result :=
      'select * from ctc_tb_c_obr obr ';
end;

begin
    { TODO -oMaxsuel Victor : em 09/10/2017 }
  CTC_SQ_R_OBR.Close;
  CTC_SQ_R_OBR.CommandText :=  SqlObr +
             ' where 1 = 1  ';

  if Input[0] <> '' then
     begin
        CTC_SQ_R_OBR.CommandText :=  CTC_SQ_R_OBR.CommandText +
             ' and obr.id_obra  in (' + VarToStr(Input[0]) +') ';
     end;

  CTC_SQ_R_OBR.CommandText := CTC_SQ_R_OBR.CommandText +
       ' ORDER BY obr.id_obra ';
  Result := CTC_DP_R_OBR.Data;
  CTC_SQ_R_OBR.Close;

end;

function TSM.CTC_DP_R_OBR_CRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function SqlObrCrg: String;
begin

    Result :=
      '  select obr.descricao as int_nomteobr, obg.* , crg.descricao as int_nomecrg  ' +
      '  from CTC_TB_C_OBR_CRG obg                    ' +
      '     left outer join pcp_tb_c_crg crg on crg.id_cargo = obg.id_cargo ' +
      '     left outer join ctc_tb_c_obr obr on obr.id_obra = obg.id_obra ';

end;

begin
    { TODO -oMaxsuel Victor : em 02/10/2017 }
  CTC_SQ_R_OBR_CRG.Close;
  CTC_SQ_R_OBR_CRG.CommandText :=  SqlObrCrg +
     ' where  1 = 1  ';

  if Input[0] <> '' then
     begin
        CTC_SQ_R_OBR_CRG.CommandText :=  CTC_SQ_R_OBR_CRG.CommandText +
             ' and obg.id_obra  in (' + VarToStr(Input[0]) +') ';
     end;

  if Input[1] <> '' then
     begin
       CTC_SQ_R_OBR_CRG.CommandText :=  CTC_SQ_R_OBR_CRG.CommandText +
          ' AND obg.dta_fim_contrato >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
          '     obg.dta_fim_contrato <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
     end;

  CTC_SQ_R_OBR_CRG.CommandText := CTC_SQ_R_OBR_CRG.CommandText +
       ' ORDER BY obg.id_obra ';
  Result := CTC_DP_R_OBR_CRG.Data;
  CTC_SQ_R_OBR_CRG.Close;
end;


function TSM.CTC_DP_R_OBR_EQPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function SqlObrEqp: String;
begin

    Result :=
      ' select obr.descricao as int_nomteobr, obe.*, eqp.descricao as int_nomeeqp from ctc_tb_c_obr_eqp obe ' +
      '  left outer join pcp_tb_c_meq eqp on eqp.id_meq = obe.id_meq ' +
      '  left outer join ctc_tb_c_obr obr on obr.id_obra = obe.id_obra ';


end;

begin
    { TODO -oMaxsuel Victor : em 02/10/2017 }
  CTC_SQ_R_OBR_EQP.Close;
  CTC_SQ_R_OBR_EQP.CommandText :=  SqlObrEqp +
                   ' where 1 = 1 ';

  if Input[0] <> '' then
     begin
        CTC_SQ_R_OBR_EQP.CommandText :=  CTC_SQ_R_OBR_EQP.CommandText +
             ' and obe.id_obra  in (' + VarToStr(Input[0]) +') ';
     end;
  if Input[1] <> '' then
     begin
       CTC_SQ_R_OBR_EQP.CommandText :=  CTC_SQ_R_OBR_EQP.CommandText +
         ' AND obe.dta_fim_contrato >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
          '     obe.dta_fim_contrato <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
     end;

  CTC_SQ_R_OBR_EQP.CommandText := CTC_SQ_R_OBR_EQP.CommandText +
       ' ORDER BY obe.id_obra, obe.id_meq ';
  Result := CTC_DP_R_OBR_EQP.Data;
  CTC_SQ_R_OBR_EQP.Close;
end;

function TSM.CTC_DP_R_OBR_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function SqlObrIte: String;
begin

    Result :=
      ' select obr.descricao as int_nomteobr,  bit.*,   ' +
      '   ite.descricao as int_nomeite, ite.id_und_venda as int_undvenda ' +
      ' from ctc_tb_c_obr_ite bit    ' +
      '   left outer join cad_tb_c_ite ite on ite.id_item = bit.id_item  ' +
      '   left outer join ctc_tb_c_obr obr on obr.id_obra = bit.id_obra ';
end;

begin
    { TODO -oMaxsuel Victor : em 04/10/2017 }
  CTC_SQ_R_OBR_ITE.Close;
  CTC_SQ_R_OBR_ITE.CommandText :=  SqlObrIte +
             ' where 1 = 1  ';

  if Input[0] <> '' then
     begin
        CTC_SQ_R_OBR_ITE.CommandText :=  CTC_SQ_R_OBR_ITE.CommandText +
             ' and obr.id_obra  in (' + VarToStr(Input[0]) +') ';
     end;

  if Input[1] <> '' then
     begin
       CTC_SQ_R_OBR_ITE.CommandText :=  CTC_SQ_R_OBR_ITE.CommandText +
         ' AND bit.dta_fim_contrato >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
          '     bit.dta_fim_contrato <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        
     end;

  CTC_SQ_R_OBR_ITE.CommandText := CTC_SQ_R_OBR_ITE.CommandText +
       ' ORDER BY obr.id_obra, bit.id_item ';
  Result := CTC_DP_R_OBR_ITE.Data;
  CTC_SQ_R_OBR_ITE.Close;
end;

function TSM.CTC_DP_R_ORCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function SqlCtcOrc: String;
begin
    Result :=
      ' SELECT OIT.ID_ORC, '+
        ' OBR.DESCRICAO as DESCRICAO_OBRA, '+
        ' OBR.id_cliente, '+
        ' CLI.nome as int_nomecli, '+
        ' PAR.ID_EMPRESA as int_codemp, '+
        ' PAR.EMP_FANTASIA as int_nomeemp, '+
        ' OIT.GRUPO AS SUBGRUPO,  '+
        ' OIT.COD_PRPOPRIO,  '+
        ' OIT.DESCRICAO,  '+
        ' OIT.CLASSE,  '+
        ' OIT.UND,  '+
        ' OIT.QTDE,  '+
        ' OIT.VLR_UNITARIO,  '+
        ' OIT.VLR_TOTAL, '+
        ' SUBSTRING(OIT.GRUPO,1,1) AS GRUPO '+
      ' FROM CTC_TB_M_ORC_ITE OIT '+
      ' LEFT OUTER JOIN CTC_TB_M_ORC ORC ON ORC.ID_ORC=OIT.ID_ORC '+
      ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=ORC.ID_EMPRESA '+
      ' LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA=ORC.ID_OBRA '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OBR.ID_CLIENTE ';
end;

begin
   { TODO -oLuan : Criado no dia 27/10/2015 }
   CTC_SQ_R_ORC.Close;

   if Input[0] = '0' then
      begin
        CTC_SQ_R_ORC.CommandText :=  SqlCtcOrc +
                 ' WHERE ORC.ID_OBRA  in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[0] = '1' then
      begin
        CTC_SQ_R_ORC.CommandText :=  SqlCtcOrc +
                 ' WHERE OIT.ID_ORC  in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[2] <> '' then
      begin
        CTC_SQ_R_ORC.CommandText :=  SqlCtcOrc +
                 ' and ORC.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
      end;

  CTC_SQ_R_ORC.CommandText := CTC_SQ_R_ORC.CommandText +
                 ' ORDER BY OIT.GRUPO';

   Result := CTC_DP_R_ORC.Data;
   CTC_SQ_R_ORC.Close;
end;

function TSM.CTC_DP_R_SLMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

function SqlCtcSlm: String;
begin

    Result :=
      ' SELECT SLM.*, '+
      '  fun.nome as int_nomeresp, '+
      ' par.emp_razao as int_emprazao '+
      ' from ctc_tb_m_slm slm '+
      ' left outer join cad_tb_c_fun fun on (fun.id_funcionario=slm.id_responsavel) '+
      ' left outer join cad_tb_c_par par on (par.id_empresa=slm.id_empresa) '+
      ' where 1=1';
end;
begin
    { 0 - Index Relatorio

    }
    { TODO -oLuan : Criado no dia 19/05/2016 }


    CTC_SQ_R_SLM.Close;


    CTC_SQ_R_SLM.CommandText :=  SqlCtcSlm +
                 ' AND SLM.DATA>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                 ' AND SLM.DATA<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                 ' AND SLM.ID_OBRA = ''' + VarToStr(Input[2]) +''' ';

   if VarToStr(Input[3]) <> '' then
      begin
        CTC_SQ_R_SLM.CommandText :=  CTC_SQ_R_SLM.CommandText +
                 ' and SLM.ID_EMPRESA  in (' + VarToStr(Input[3]) +') ';
      end;

   if VarToStr(Input[4]) <> '' then
      begin
        CTC_SQ_R_SLM.CommandText :=  CTC_SQ_R_SLM.CommandText +
                 ' and SLM.ID_RESPONSAVEL  in (' + VarToStr(Input[4]) +') ';
      end;

  CTC_SQ_R_SLM.CommandText := CTC_SQ_R_SLM.CommandText +
                 ' ORDER BY SLM.ID_CONTROLE';

  Result := CTC_DP_R_SLM.Data;
  CTC_SQ_R_SLM.Close;

end;

function TSM.enValorChave(NomeSeq: String): Integer;
var
  qry:TSqlQuery;
  qryNova:TSqlQuery;
  qryCons1,qryCons2:TSqlQuery;
  xSeq:Integer;

  ano,mes,dia: word;
begin
  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  //qry.SQLConnection:= SM.conexao;
  qry.SQLConnection:= Self.conexao;

  //qry.SQLConnection := BuscarConnBanco;

  qryNova:=TSqlQuery.Create(self);
  qryNova.SQLConnection:=self.conexao;;

  xSeq:=0;
  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add('Select SEQUENCIA from CAD_TB_C_SEQ where ID_TABELA='''+NomeSeq+''' ');
  qry.Open;

  if not qry.IsEmpty then
     begin

       if (NomeSeq = 'LOT_INT_NFE') then
          begin
            qryCons1:=TSqlQuery.Create(self);
            qryCons1.SQLConnection:=self.conexao;;

            qryCons2:=TSqlQuery.Create(self);
            qryCons2.SQLConnection:=self.conexao;;

            DecodeDate(date,ano,mes,dia);

            qryCons1.Close;
            qryCons1.SQL.Clear;
            qryCons1.SQL.Add(' Select * from fat_tb_m_nfe_ite nfi ' +
                             '   left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) ' +
                             ' where ' +
                             '   coalesce(nfi.num_lote,''0'') <> ''0'' ' +
                             '   AND NFE.DTA_DOCUMENTO >= ''' + FormatDateTime('dd/mm/yyyy', strToDate('01/01/'+inttostr(ano)))  +'''  '+
                             '   AND NFE.DTA_DOCUMENTO <= ''' + FormatDateTime('dd/mm/yyyy', strToDate('31/12/'+inttostr(ano)))  +'''  ');
            qryCons1.Open;

            qryCons2.Close;
            qryCons2.SQL.Clear;
            qryCons2.SQL.Add(' Select * from fat_tb_m_iqm_ite qmi ' +
                             '   left outer join fat_tb_m_iqm iqm  on (iqm.id_iqm = qmi.id_iqm) ' +
                             ' where ' +
                             '   coalesce(qmi.num_lote,''0'') <> ''0'' ' +
                             '   AND iqm.dta_recebimento >= ''' + FormatDateTime('dd/mm/yyyy', strToDate('01/01/'+inttostr(ano)))  +'''  '+
                             '   AND iqm.dta_recebimento <= ''' + FormatDateTime('dd/mm/yyyy', strToDate('31/12/'+inttostr(ano)))  +'''  ');
            qryCons2.Open;

            if (qryCons1.IsEmpty) and (qryCons2.IsEmpty) then
               begin
                 qryNova.Close;
                 qryNova.SQL.Clear;
                 qryNova.SQL.Add('INSERT INTO CAD_TB_C_SEQ (ID_TABELA, SEQUENCIA) VALUES ('''+NomeSeq+''', 1) ');
                 qryNova.ExecSQL;
                 xSeq:=1;
               end
            else
               begin
                 xSeq:=qry.FieldByName('Sequencia').AsInteger;
                 xSeq:=xSeq+1;
                 qry.Close;
                 qry.SQL.Clear;
                 qry.SQL.Add('update CAD_TB_C_SEQ set SEQUENCIA='''+inttostr(xSeq)+''' ');
                 qry.SQL.Add('where ID_TABELA='''+NomeSeq+''' ');
                 qry.ExecSQL;
               end;
          end
       else
          begin
           xSeq:=qry.FieldByName('Sequencia').AsInteger;
           xSeq:=xSeq+1;
           qry.Close;
           qry.SQL.Clear;
           qry.SQL.Add('update CAD_TB_C_SEQ set SEQUENCIA='''+inttostr(xSeq)+''' ');
           qry.SQL.Add('where ID_TABELA='''+NomeSeq+''' ');
           qry.ExecSQL;
          end;
     end
   else
     begin
       qryNova.Close;
       qryNova.SQL.Clear;
       qryNova.SQL.Add('INSERT INTO CAD_TB_C_SEQ (ID_TABELA, SEQUENCIA) VALUES ('''+NomeSeq+''', 1) ');
       qryNova.ExecSQL;
       xSeq:=1;
     end;
  qry.Destroy();
  qryNova.Destroy();
  if qryCons1 <> nil then
     qryCons1.Destroy();
  if qryCons2 <> nil then
     qryCons2.Destroy();
  //FreeAndNil(SM);
  Result := xSeq;
end;




function TSM.enGetImagem(tabela: String;nome:String): TStream;
var
  Imagem: TBitmap;
  jpg : TJPEGImage;
  Png: TPngImage;
  ms:TStream;

begin
   Imagem := TBitmap.Create;
   ms := TMemoryStream.Create;


   Result := ms;

   If not FileExists(xDiretorioImagem+tabela+'\'+nome) then
     begin
       raise Exception.Create('Imagem inexistente.');
       abort;
     end;


   try

     if pos('.jpg',nome)>0 then
        begin
          Jpg := TJpegImage.Create;
          Jpg.LoadFromFile(xDiretorioImagem+tabela+'\'+nome);
          Imagem.Assign(JPG);
        end
     else if pos('.png',nome)>0 then
        begin
           Png := TPngImage.Create;
           Png.LoadFromFile(xDiretorioImagem+tabela+'\'+nome);
           Imagem.Assign(PNG);
        end
     else
        begin
          Imagem.LoadFromFile(xDiretorioImagem+tabela+'\'+nome);
        end;
     Imagem.SaveToStream(ms);

     ms.Position := 0;
     Result := ms;
   finally

   end;
end;




function TSM.EST_DP_M_FEADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFea: String;
  begin
    Result := ' SELECT * FROM EST_TB_M_FEA  ';
  end;
begin
   EST_SQ_M_FEA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_ITEM = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_FISCAL = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_MAL = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_ORDEM IN (' + VarToStr(Input[2]) +') ';
      end
   else if Input[0] = 5 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_MET = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_ORS     = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 7 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_MAL = ''' + VarToStr(Input[2]) +''' AND '+
             '       ID_ALMOXARIFADO = ''' + VarToStr(Input[3])+''' ';
      end
   else if Input[0] = 8 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_EPP = ''' + VarToStr(Input[2]) +'''  ';
      end
   else if Input[0] = 9 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_ORDEM_ASUB = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 10 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FEA.CommandText := enSqlFea + ' WHERE 1=2 '
        else
           EST_SQ_M_FEA.CommandText := enSqlFea +
             ' WHERE ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       ID_OPB = ''' + VarToStr(Input[2]) +''' ';
      end;


          //CMServerForm.mm.Lines.Add(EST_SQ_M_FEA.CommandText);
   Result := EST_DP_M_FEA.Data;

   EST_SQ_M_FEA.Close;

end;

function TSM.EST_DP_M_FESDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFes: String;
  begin
    if Input[0] <> 92 then
       begin
          Result :=
            'SELECT FES.* , '+
            ' PAR.EMP_RAZAO AS INT_NOMEEMP, '+
            ' PAR.EMP_FANTASIA AS INT_NOMEFAN, '+
            ' COR.DESCRICAO AS INT_NOMECOR, '+
            ' TAM.DESCRICAO AS INT_NOMETAM, cast(  fes.saldo_fisico as numeric(18,4) ) as int_sld_disponivel  '+
            'FROM EST_TB_M_FES FES '+
            'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=FES.ID_EMPRESA '+
            'LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=FES.ID_COR '+
            'LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=FES.ID_TAMANHO ';
       end
    else
       begin
         Result :=
            'SELECT FES.* , '+
            ' PAR.EMP_RAZAO AS INT_NOMEEMP, '+
            ' PAR.EMP_FANTASIA AS INT_NOMEFAN, '+
            ' COR.DESCRICAO AS INT_NOMECOR, '+
            ' TAM.DESCRICAO AS INT_NOMETAM, '+
            '     cast(  fes.saldo_fisico -( coalesce(tpe.qtde_ped_pendente,0) + coalesce(tre.qtde_req_pendente,0)) as numeric(18,4) ) as int_sld_disponivel  ' +
            'FROM EST_TB_M_FES FES '+
            'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=FES.ID_EMPRESA '+
            'LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=FES.ID_COR '+
            'LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=FES.ID_TAMANHO '+

              '    left outer join' + #13#10 +
              '        (select ped.id_empresa, ipe.id_item, ipe.id_cor, ipe.id_tamanho, coalesce(sum(qtde),0) as qtde_ped_pendente from fat_tb_m_ped_ite ipe' + #13#10 +
              '            left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido)' + #13#10 +
              '         where ' + #13#10 +
              '           ped.situacao in (2) ' + #13#10 +
              //'           and ped.situacao_aprovacao = 1 ' + #13#10 +
              '           and ped.situacao_aprovacao <> 2 ' + #13#10 +
              '         group by 1,2,3,4) tpe on (tpe.id_empresa = fes.id_empresa and' + #13#10 +
              '                                   tpe.id_item    = fes.id_item    and                                      ' + #13#10 +
              '                                   tpe.id_cor     = fes.id_cor     and' + #13#10 +
              '                                   tpe.id_tamanho = fes.id_tamanho)' + #13#10 +
              '   left outer join' + #13#10 +
              '        (select opr.id_empresa, irq.id_item, irq.id_cor, irq.id_tamanho, ' + #13#10 +
              '                coalesce(sum(irq.qtde),0) - coalesce(sum(irq.qtde_atendida),0) as qtde_req_pendente' + #13#10 +
              '         from pcp_tb_m_opr_req_ite irq' + #13#10 +
              '            left outer join pcp_tb_m_opr_req req on (req.id_opr     = irq.id_opr and ' + #13#10 +
              '                                                     req.id_opr_req = irq.id_opr_req)' + #13#10 +
              '            left outer join pcp_tb_m_opr opr on (opr.id_opr  = req.id_opr)' + #13#10 +
              '         where irq.cancelado <> true and  ' + #13#10 +
              '            opr.situacao in (0,1)           ' + #13#10 +
              '         group by 1,2,3,4) tre on (tre.id_empresa = fes.id_empresa and' + #13#10 +
              '                                   tre.id_item    = fes.id_item    and                                      ' + #13#10 +
              '                                   tre.id_cor     = fes.id_cor     and' + #13#10 +
              '                                   tre.id_tamanho = fes.id_tamanho)       ' + #13#10;
       end;
  end;
begin
   EST_SQ_M_FES.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_COR = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_TAMANHO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FES.ID_COR     = ''' + VarToStr(Input[3]) +''' AND '+
             '       FES.ID_TAMANHO = ''' + VarToStr(Input[4]) +''' ';
      end

   else if Input[0] = 4 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_COR in (' + VarToStr(Input[3]) +') ';
      end
   else if Input[0] = 5 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_TAMANHO in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 6 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FES.ID_COR in (' + VarToStr(Input[3]) +') AND '+
             '       FES.ID_TAMANHO in (' + VarToStr(Input[4]) +') ';
      end

   else if Input[0] = 7 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.ID_ITEM in (' + VarToStr(Input[2]) +') ';
      end
   else if Input[0] = 8 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES.CommandText := enSqlFes + ' WHERE 1=2 '
        else
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FES.DATA_ULT_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND '+
             '       FES.DATA_ULT_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +'''  ';
      end
   else if Input[0] = 90 then
      begin
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 91 then
      begin
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 92 then
      begin
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE FES.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 100 then
      begin
           EST_SQ_M_FES.CommandText := enSqlFes +
             ' WHERE 1=1 ';
      end;

   // Order by
   if Input[0] = 90 then
      begin
           EST_SQ_M_FES.CommandText := EST_SQ_M_FES.CommandText +
             ' ORDER BY FES.ID_EMPRESA ';
      end;

   Result := EST_DP_M_FES.Data;
end;

function TSM.EST_DP_M_FES_ALMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFesAlm: String;
  begin
    Result :=
      'select FAL.*, alm.descricao as int_nomealm, '+
      '  PAR.EMP_RAZAO AS INT_NOMEEMP, '+
      '  PAR.EMP_FANTASIA AS INT_NOMEFAN, '+
      '  COR.DESCRICAO AS INT_NOMECOR, '+
      '  TAM.DESCRICAO AS INT_NOMETAM '+
      'from EST_TB_M_FES_ALM FAL '+
      'left outer join cad_tb_c_alm alm on alm.id_almoxarifado=fal.id_almoxarifado '+
      'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=fal.ID_EMPRESA '+
      'LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=FAL.ID_COR '+
      'LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=FAL.ID_TAMANHO ';
  end;
begin

   EST_SQ_M_FES_ALM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM = ''' + VarToStr(Input[2]) +''' AND '+
             '       FAL.ID_ALMOXARIFADO = ''' + VarToStr(Input[3]) +''' ';

      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM = ''' + VarToStr(Input[2]) +''' AND '+
             '       FAL.ID_COR = ''' + VarToStr(Input[3]) +''' AND '+
             '       FAL.ID_ALMOXARIFADO = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FAL.ID_TAMANHO = ''' + VarToStr(Input[3]) +''' AND '+
             '       FAL.ID_ALMOXARIFADO = ''' + VarToStr(Input[4]) +''' ';

      end
   else if Input[0] = 3 then
      begin
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM    = ''' + VarToStr(Input[2]) +''' AND '+
             '       FAL.ID_COR     = ''' + VarToStr(Input[3]) +''' AND '+
             '       FAL.ID_TAMANHO = ''' + VarToStr(Input[4]) +''' AND '+
             '       FAL.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end

   else if Input[0] = 4 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FAL.ID_COR in (' + VarToStr(Input[3]) +') AND '+
             '       FAL.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 5 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FAL.ID_TAMANHO in (' + VarToStr(Input[3]) +') AND '+
             '       FAL.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 6 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FAL.ID_COR in (' + VarToStr(Input[3]) +') AND '+
             '       FAL.ID_TAMANHO in (' + VarToStr(Input[4]) +') AND '+
             '       FAL.ID_ALMOXARIFADO in (' + VarToStr(Input[5]) +') ';
      end
   else if Input[0] = 7 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND '+
             '       FAL.ID_ITEM in (' + VarToStr(Input[2]) +') AND '+
             '       FAL.ID_ALMOXARIFADO in (' + VarToStr(Input[3]) +') ';

      end
   else if Input[0] = 8 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm + ' WHERE 1=2 '
        else
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.DATA_ULT_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
             '       FAL.DATA_ULT_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +'''  ';
      end

   else if Input[0] = 90 then
      begin
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_ITEM = ''' + VarToStr(Input[1]) +''' '
      end
   else if Input[0] = 91 then
      begin
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE FAL.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 100 then
      begin
           EST_SQ_M_FES_ALM.CommandText := enSqlFesAlm +
             ' WHERE 1=1 ';
      end;

   Result := EST_DP_M_FES_ALM.Data;
end;

function TSM.EST_DP_M_LOTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlEstLot: String;
  begin
    Result :=
        ' select LOT.* , ALM.DESCRICAO AS INT_NOMEALM, '+
        '   COR.DESCRICAO AS INT_NOMECOR, ' +
        '   TAM.DESCRICAO AS INT_NOMETAM  ' +
        ' FROM EST_TB_M_LOT LOT '+
        '   LEFT OUTER JOIN CAD_TB_C_ALM ALM ON ALM.ID_ALMOXARIFADO=LOT.ID_ALMOXARIFADO ' +
        '   LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=LOT.ID_COR ' +
        '   LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=LOT.ID_TAMANHO ';
  end;
begin
   EST_SQ_M_LOT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_LOT.CommandText := enSqlEstLot + ' WHERE 1=2 '
        else
           EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +'''  ';
      end
   else if Input[0] = 1 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 7 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[5]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[6]) +''' ';
      end


   else if Input[0] = 8 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +')  ';
      end
   else if Input[0] = 9 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +')  AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +')  AND '+
             '       LOT.ID_COR          in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 10 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_COR          in (' + VarToStr(Input[4]) +') AND '+
             '       LOT.ID_TAMANHO      in (' + VarToStr(Input[5]) +') ';
      end
   else if Input[0] = 11 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_TAMANHO      in (' + VarToStr(Input[4]) +') ';
      end
   else if Input[0] = 12 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[4]) +''' ';
      end
   else if Input[0] = 13 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_COR          in (' + VarToStr(Input[4]) +') AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 14 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_TAMANHO      in (' + VarToStr(Input[4]) +') AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 15 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        in (' + VarToStr(Input[2]) +') AND '+
             '       LOT.ID_ITEM         in (' + VarToStr(Input[3]) +') AND '+
             '       LOT.ID_COR          in (' + VarToStr(Input[4]) +') AND '+
             '       LOT.ID_TAMANHO      in (' + VarToStr(Input[5]) +') AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[6]) +''' ';
      end
   else if Input[0] = 16 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.NUM_LOTE        = ''' + VarToStr(Input[2]) +''' ';
      end

     else if Input[0] = 17 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +'''  ';
      end
     else if Input[0] = 18 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' ';
      end
     else if Input[0] = 19 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[5]) +''' ';
      end
     else if Input[0] = 20 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[4]) +''' ';
      end
     else if Input[0] = 21 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[4]) +''' ';
      end
     else if Input[0] = 22 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
     else if Input[0] = 23 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 24 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[5]) +''' AND '+
             '       LOT.ID_ALMOXARIFADO = ''' + VarToStr(Input[6]) +''' ';
      end
   else if Input[0] = 25 then
      begin
        EST_SQ_M_LOT.CommandText := enSqlEstLot +
             ' WHERE LOT.ID_EMPRESA      = ''' + VarToStr(Input[1]) +''' AND '+
             '       LOT.ID_ITEM         = ''' + VarToStr(Input[3]) +''' AND '+
             '       LOT.ID_COR          = ''' + VarToStr(Input[4]) +''' AND '+
             '       LOT.ID_TAMANHO      = ''' + VarToStr(Input[5]) +''' AND '+
             '       LOT.QTDE_ATUAL>0 '+
             '  ORDER BY DTA_VENCIMENTO  ';
      end;
   Result := EST_DP_M_LOT.Data;

   EST_SQ_M_LOT.Close;
end;

function TSM.EST_DP_M_MALDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlEstMal: String;
  begin
    Result :=
      'select mal.*, '+
      '   alm.descricao as int_nomealm, amm.descricao as int_nomealm_dest, '+
      '   tme.descricao as int_nometme, '+
      '   tme.indicador as int_indicadortme, '+
      '   sec.descricao as int_nomeset, '+
      '   fuc.nome as int_nomeres, '+
      '   meq.descricao as int_nomeqp '+
      ' from est_tb_m_mal mal '+
      ' left outer join cad_tb_c_alm alm on alm.id_almoxarifado=mal.id_almoxarifado '+
      ' left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=mal.id_tipo_mov_estoque '+
      ' left outer join cad_tb_c_set sec on sec.id_setor=mal.id_setor '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=mal.id_responsavel '+
      ' left outer join cad_tb_c_alm amm on amm.id_almoxarifado=mal.id_almoxarifado_dest '+
      ' left outer join pcp_tb_c_meq meq on meq.id_meq=mal.id_equipamento ';
  end;
begin
   EST_SQ_M_MAL.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_MAL.CommandText := enSqlEstMal + ' WHERE 1=2 '
        else
           EST_SQ_M_MAL.CommandText := enSqlEstMal +
             ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
             '   MAL.ID_MAL = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        EST_SQ_M_MAL.CommandText := enSqlEstMal +
           ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format('upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[2])) = '' then
           EST_SQ_M_MAL.CommandText := enSqlEstMal + ' WHERE 1=2 '
        else
          EST_SQ_M_MAL.CommandText := enSqlEstMal +
           ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           '   MAL.DATA = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else if Input[0] = 3 then
      begin
        EST_SQ_M_MAL.CommandText := enSqlEstMal +
           ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format(' upper(ALM.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        EST_SQ_M_MAL.CommandText := enSqlEstMal +
           ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format(' upper(SEC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 5 then
      begin
        EST_SQ_M_MAL.CommandText := enSqlEstMal +
           ' WHERE MAL.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format(' upper(mal.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := EST_DP_M_MAL.Data;
end;

procedure TSM.EST_DP_M_MALGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  //enAudInserirCampoPacote(Properties);
end;

procedure TSM.EST_DP_M_MALUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_TME, BUS_CD_M_OPR_REQ_ITE: TClientDataSet;
  Ite_DataSet: TDataSet;
  sldVirtualItem,qtde,qtde_ant: Currency;
  num_lote: String;

begin
  try
  // O IF abaixo deve ser retirado quando a rotina EntGravaEst for remanejado para
  // a camada SERVIDOR.

  CAD_CD_C_TME := TClientDataSet.Create(nil);
  CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
  CAD_CD_C_TME.Close;
  CAD_CD_C_TME.Data :=
      CAD_CD_C_TME.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString]));

  if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and // Sada
     (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)   then // Normal
     begin
       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,3,
                                           DataSet.FieldByName('ID_MAL').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MAL_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
     end;

  if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 0) and  // Entrada
     (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 1)  then // Dovoluo
     begin
       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,5,
                                           DataSet.FieldByName('ID_MAL').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MAL_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
     end;

  if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and  // Saida
     (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 2)  then // Transferencia
     begin
       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,13,
                                           DataSet.FieldByName('ID_MAL').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MAL_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
      FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,12,
                                           DataSet.FieldByName('ID_MAL').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MAL_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
     end;


  if DataSet.FieldByName('id_opr_req').AsInteger > 0 then
     begin
       BUS_CD_M_OPR_REQ_ITE := TClientDataSet.Create(nil);
       BUS_CD_M_OPR_REQ_ITE.SetProvider(BUS_DP_M_OPR_REQ_ITE);
       BUS_CD_M_OPR_REQ_ITE.Close;
       BUS_CD_M_OPR_REQ_ITE.Data :=
          BUS_CD_M_OPR_REQ_ITE.DataRequest(VarArrayOf([2,DataSet.FieldByName('ID_OPR').AsString,DataSet.FieldByName('ID_OPR_REQ').AsString]));


       Ite_DataSet := TDataSetField(DataSet.FieldByName('EST_SQ_M_MAL_ITE')).NestedDataSet;

       Ite_DataSet.First;
       while not Ite_DataSet.Eof do
          begin
             qtde :=  Ite_DataSet.FieldByName('qtde').AsCurrency;

             if Ite_DataSet.UpdateStatus in [usInserted] then
                begin
                  BUS_CD_M_OPR_REQ_ITE.Filtered := true;
                  BUS_CD_M_OPR_REQ_ITE.Filter := ' num_lote = ' + Ite_DataSet.FieldByName('num_lote').AsString +
                                                 ' and qtde > 0 ' +
                                                 ' and qtde <> qtde_atendida ' ;

                  if not BUS_CD_M_OPR_REQ_ITE.IsEmpty then
                     begin
                        BUS_CD_M_OPR_REQ_ITE.First;
                        while not BUS_CD_M_OPR_REQ_ITE.eof do
                           begin
                             BUS_CD_M_OPR_REQ_ITE.Edit;

                             sldVirtualItem := BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde').AsCurrency -
                                               BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency;
                             if sldVirtualItem >= qtde then
                                begin
                                  BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                    BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency + qtde;
                                  if sldVirtualItem = qtde then
                                     BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 3
                                  else
                                     BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 2;
                                end
                             else
                                begin
                                  BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                      BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency + sldVirtualItem;
                                  BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 3;
                                  qtde := 0;
                                  BUS_CD_M_OPR_REQ_ITE.last;
                                end;
                             BUS_CD_M_OPR_REQ_ITE.Next;
                           end;
                     end;
                  BUS_CD_M_OPR_REQ_ITE.Filtered := false;
                end;

             if DataSet.UpdateStatus in [usModified] then
                begin
                  num_lote := Ite_DataSet.FieldByName('num_lote').AsString;
                  qtde_ant := Ite_DataSet.FieldByName('qtde').AsCurrency;

                  DataSet.Next;
                  if DataSet.UpdateStatus in [usModified] then
                     begin
                       if Ite_DataSet.FieldByName('qtde').AsCurrency > 0 then    // se houver alterao na qtde
                          begin
                             qtde := Ite_DataSet.FieldByName('qtde').AsCurrency;

                             BUS_CD_M_OPR_REQ_ITE.Filtered := true;
                             BUS_CD_M_OPR_REQ_ITE.Filter   := ' num_lote =   ' + Ite_DataSet.FieldByName('num_lote').AsString +
                                                              ' and qtde_atendida > 0 ';

                             // devolve o saldo
                             if not BUS_CD_M_OPR_REQ_ITE.IsEmpty then
                                begin
                                  BUS_CD_M_OPR_REQ_ITE.First;
                                  while not BUS_CD_M_OPR_REQ_ITE.eof do
                                     begin
                                       sldVirtualItem := BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency;
                                       BUS_CD_M_OPR_REQ_ITE.edit;
                                       if qtde_ant <= sldVirtualItem  then
                                          begin
                                            BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                                BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency - qtde_ant;
                                            qtde_ant := 0;
                                            BUS_CD_M_OPR_REQ_ITE.Last;
                                          end
                                       else
                                          begin
                                            BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                                BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency - sldVirtualItem;
                                            qtde_ant := qtde_ant - sldVirtualItem;
                                          end;

                                       if BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency = 0 then
                                          BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 1
                                       else
                                          BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 2;

                                       BUS_CD_M_OPR_REQ_ITE.Post;
                                     end;
                                end;

                             BUS_CD_M_OPR_REQ_ITE.Filtered := false;
                             BUS_CD_M_OPR_REQ_ITE.Filtered := true;
                             BUS_CD_M_OPR_REQ_ITE.Filter   := ' num_lote = ' + Ite_DataSet.FieldByName('num_lote').AsString +
                                                              ' and qtde > 0 ' +
                                                              ' and qtde <> qtde_atendida ' ;
                             // retira o saldo
                             if not BUS_CD_M_OPR_REQ_ITE.IsEmpty then
                                begin
                                  BUS_CD_M_OPR_REQ_ITE.First;
                                  while not BUS_CD_M_OPR_REQ_ITE.eof do
                                     begin
                                       BUS_CD_M_OPR_REQ_ITE.Edit;
                                       sldVirtualItem := BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde').AsCurrency -
                                                         BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency;
                                       if sldVirtualItem >= qtde then
                                          BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                              BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency + qtde
                                       else
                                          begin
                                            BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                                                BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency + sldVirtualItem;
                                            qtde := 0;
                                            BUS_CD_M_OPR_REQ_ITE.last;
                                          end;

                                       if BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde').AsCurrency =
                                          BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency then
                                             BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 3 // atendido total
                                       else
                                          BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 2; // atendido parcial

                                       BUS_CD_M_OPR_REQ_ITE.Post;
                                       BUS_CD_M_OPR_REQ_ITE.Next;
                                     end;
                                 end;
                          end;
                     end;
                end;

             if DataSet.UpdateStatus in [usDeleted] then
                begin
                  qtde := Ite_DataSet.FieldByName('qtde').AsCurrency;

                  BUS_CD_M_OPR_REQ_ITE.Filtered := true;
                  BUS_CD_M_OPR_REQ_ITE.Filter   := ' num_lote =   ' + Ite_DataSet.FieldByName('num_lote').AsString +
                                                   ' and qtde_atendida > 0 ';
                   // devolve o saldo
                  sldVirtualItem := BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency;

                  BUS_CD_M_OPR_REQ_ITE.edit;
                  if qtde <= sldVirtualItem  then
                      begin
                        BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                            BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency - qtde;
                        qtde := 0;
                        BUS_CD_M_OPR_REQ_ITE.Last;
                      end
                  else
                     begin
                       BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency :=
                           BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency - sldVirtualItem;
                       qtde := qtde - sldVirtualItem;
                     end;

                  if BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency > 0 then
                       BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 2
                  else
                    if BUS_CD_M_OPR_REQ_ITE.FieldByName('qtde_atendida').AsCurrency = 0 then
                       BUS_CD_M_OPR_REQ_ITE.FieldByName('situacao').AsInteger := 1;

                  BUS_CD_M_OPR_REQ_ITE.Post;
                end;
             Ite_DataSet.Next;
          end;

       try
         if BUS_CD_M_OPR_REQ_ITE <> nil then
            if BUS_CD_M_OPR_REQ_ITE.ChangeCount > 0 then
               BUS_CD_M_OPR_REQ_ITE.ApplyUpdates(0);
       except
         on e: exception do
            begin
               raise Exception.Create('Erro: ' + #13 + e.Message);
            end;
       end;
     end;
  finally
    FreeAndNil(CAD_CD_C_TME);
    FreeAndNil(BUS_CD_M_OPR_REQ_ITE);
  end;

  //enAudGravar(sender, dataset);
end;

function TSM.EST_DP_M_METDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlEstMet: String;
  begin
    Result :=
      'select met.*, '+
      '   tme.descricao as int_nometme, '+
      '   fuc.nome as int_nomeres '+
      ' from est_tb_m_met met '+
      ' left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=met.id_tipo_mov_estoque '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=met.id_responsavel ';
  end;
begin
   { TODO -oLuan : Criado em 09/03/2016 }
   EST_SQ_M_MET.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_MET.CommandText := enSqlEstMet + ' WHERE 1=2 '
        else
           EST_SQ_M_MET.CommandText := enSqlEstMet +
             ' WHERE MET.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
             '   MET.ID_MET = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        EST_SQ_M_MET.CommandText := enSqlEstMet +
           ' WHERE MET.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format('upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[2])) = '' then
           EST_SQ_M_MET.CommandText := enSqlEstMet + ' WHERE 1=2 '
        else
          EST_SQ_M_MET.CommandText := enSqlEstMet +
           ' WHERE MET.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           '   MET.DATA = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else if Input[0] = 3 then
      begin
        EST_SQ_M_MET.CommandText := enSqlEstMet +
           ' WHERE MET.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           Format(' upper(met.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := EST_DP_M_MET.Data;
end;

procedure TSM.EST_DP_M_METUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_TME: TClientDataSet;
begin

   { TODO -oLuan : Criado em 09/03/2016 }

  CAD_CD_C_TME := TClientDataSet.Create(nil);
  CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
  CAD_CD_C_TME.Close;
  CAD_CD_C_TME.Data :=
      CAD_CD_C_TME.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString]));

  if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and // Sada
     (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)   then // Normal
     begin
       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,10,
                                           DataSet.FieldByName('ID_MET').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MET_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
     end;

  if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 0) and  // Entrada
     (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)  then //Normal
     begin
       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,11,
                                           DataSet.FieldByName('ID_MET').AsInteger,
                                           DataSet,
                                           BUS_DP_M_MET_ITE_INT,
                                           CAD_DP_C_TME,
                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
     end;
end;

function TSM.EST_DP_R_ABC_QTDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEstRelAbcQtd: String;
  begin
    Result :=
              '   select nfi.id_item, ite.descricao, ite.id_und_venda,fes.vlr_custo_ult_compra as int_vlr_custo_ult_cmp, '+#13#10+
              '   sum(nfi.qtde) as qtde, ' + #13#10 +
              '		  (select sum(nft.qtde) as qtde   ' + #13#10 +
              '		from fat_tb_m_nfe_ite nft' + #13#10 +
              '	    left outer join fat_tb_m_nfe nff on (nff.id_fiscal = nft.id_fiscal)' + #13#10 +
              '     left outer join cad_tb_c_ite itt on (itt.id_item   = nft.id_item)  ' + #13#10 +
              '     left outer join cad_tb_c_gru grr on (grr.id_grupo  = itt.id_grupo)  ' + #13#10 +
              '     left outer join cad_tb_c_cfo cfo on (cfo.id_cfo = nff.id_cfo) ' + #13#10 +
              '		where' + #13#10 +
              '      nff.status = 1 and' + #13#10 +
              '      nff.faturada = true and' + #13#10 +
              '      nff.NFE_COD_SIT not in (''02'',''04'',''05'')' + #13#10 +
              '      and  cfo.id_classe in (''SP10'',''SP70'')' + #13#10 +
              '      and  nff.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
              '      and  nff.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


              if Input[2] <> '' then
                  begin
                    if VarToStr(Input[2])='0'  then
                       Result := Result +
                          ' and grr.tipo_item<>''09'' ';
                  end;


              if Input[3] <> '' then
                 begin
                   Result := Result +
                        ' and nff.id_empresa in (' + VarToStr(Input[3]) +')';
                 end;

              if Input[4] <> '' then
                 begin
                   Result := Result +
                         ' and itt.id_fornecedor in (' + VarToStr(Input[4]) +')';
                 end;

              if Input[5] <> '' then
                 begin
                   Result := Result +
                         ' and itt.id_grupo in (' + VarToStr(Input[5]) +')';
                 end;
              if Input[6] <> '' then
                 begin
                   Result := Result +
                         ' and nff.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +')';
                 end;

     Result := Result +
               '     ) as qtde_total       ' + #13#10 +
               '   ' + #13#10 +
               ' from fat_tb_m_nfe_ite nfi' + #13#10 +
               '  left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
               '  left outer join cad_tb_c_ite ite on (ite.id_item    = nfi.id_item)  ' + #13#10 +
               '  left outer join cad_tb_c_gru gru on (gru.id_grupo  = ite.id_grupo)  ' + #13#10 +
               '  left outer join cad_tb_c_cfo cfo on (cfo.id_cfo = nfe.id_cfo) ' + #13#10 +
               '  left outer join est_tb_m_fes fes on (fes.id_item=ite.id_item) '+#13#10+
               ' where' + #13#10 +
               '   nfe.status = 1 and' + #13#10 +
               '   nfe.faturada = true and' + #13#10 +
               '   nfe.NFE_COD_SIT not in (''02'',''04'',''05'')' + #13#10 +
               '   and  cfo.id_classe in (''SP10'',''SP70'')' + #13#10;
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/10/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Fornecedor
          4 - Grupo
          5 - Tipo de Estoque
   }

   EST_SQ_R_ABC_QTD.Close;

   EST_SQ_R_ABC_QTD.CommandText := enSqlEstRelAbcQtd +
            '   and  nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   and  nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        if VarToStr(Input[2])='0'  then
           EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
              ' and gru.tipo_item<>''09'' ';
      end;


   if Input[3] <> '' then
      begin
        EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
              ' and nfe.id_empresa in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
              ' and ite.id_fornecedor in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[5]) +')';
      end;
   if Input[6] <> '' then
      begin
        EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
               ' and nfe.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +')';
      end;


   EST_SQ_R_ABC_QTD.CommandText := EST_SQ_R_ABC_QTD.CommandText +
       ' group by 1,2,3,4  ' + #13#10 +
       ' order by 5 desc ';

   Result := EST_DP_R_ABC_QTD.Data;

   EST_SQ_R_ABC_QTD.Close;
end;

function TSM.EST_DP_R_ABC_VLRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEstRelAbcVlr: String;
  begin
    Result :=
              '   select nfi.id_item, ite.descricao, ite.id_und_venda,fes.vlr_custo_ult_compra as int_vlr_custo_ult_cmp, '+#13#10+
              '   sum(nfi.vlr_liquido) as vlr_liquido, ' + #13#10 +
              '		  (select sum(nft.vlr_liquido) as vlr_liquido   ' + #13#10 +
              '		from fat_tb_m_nfe_ite nft' + #13#10 +
              '	    left outer join fat_tb_m_nfe nff on (nff.id_fiscal = nft.id_fiscal)' + #13#10 +
              '     left outer join cad_tb_c_ite itt on (itt.id_item   = nft.id_item)  ' + #13#10 +
              '     left outer join cad_tb_c_gru grr on (grr.id_grupo  = itt.id_grupo)  ' + #13#10 +
              '     left outer join cad_tb_c_cfo cfo on (cfo.id_cfo=nff.id_cfo) ' + #13#10 +
              '		where' + #13#10 +
              '      nff.status = 1 and' + #13#10 +
              '      nff.faturada = true and' + #13#10 +
              '      nff.NFE_COD_SIT not in (''02'',''04'',''05'')' + #13#10 +
              '      and  cfo.id_classe in (''SP10'',''SP70'')' + #13#10 +
              '      and  nff.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
              '      and  nff.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

              if Input[2] <> '' then
                  begin
                    if VarToStr(Input[2])='0'  then
                       Result := Result +
                          ' and grr.tipo_item<>''09'' ';
                  end;


              if Input[3] <> '' then
                 begin
                   Result := Result +
                        ' and nff.id_empresa in (' + VarToStr(Input[3]) +')';
                 end;

              if Input[4] <> '' then
                 begin
                   Result := Result +
                         ' and itt.id_fornecedor in (' + VarToStr(Input[4]) +')';
                 end;

              if Input[5] <> '' then
                 begin
                   Result := Result +
                         ' and itt.id_grupo in (' + VarToStr(Input[5]) +')';
                 end;
              if Input[6] <> '' then
                 begin
                   Result := Result +
                         ' and nff.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +')';
                 end;

     Result := Result +
               '     ) as vlr_total       ' + #13#10 +
               '   ' + #13#10 +
               ' from fat_tb_m_nfe_ite nfi' + #13#10 +
               '  left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
               '  left outer join cad_tb_c_ite ite on (ite.id_item    = nfi.id_item)  ' + #13#10 +
               '  left outer join cad_tb_c_gru gru on (gru.id_grupo  = ite.id_grupo)  ' + #13#10 +
               '  left outer join cad_tb_c_cfo cfo on (cfo.id_cfo=nfe.id_cfo) ' + #13#10 +
               '  left outer join est_tb_m_fes fes on (fes.id_item=ite.id_item) '+#13#10+
               ' where' + #13#10 +
               '   nfe.status = 1 and' + #13#10 +
               '   nfe.faturada = true and' + #13#10 +
               '   nfe.NFE_COD_SIT not in (''02'',''04'',''05'')' + #13#10 +
               '   and cfo.id_classe in (''SP10'',''SP70'')' + #13#10;
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/10/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Fornecedor
          4 - Grupo
          5 - Tipo de Estoque
   }

   EST_SQ_R_ABC_VLR.Close;

   EST_SQ_R_ABC_VLR.CommandText := enSqlEstRelAbcVlr +
            '   and  nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   and  nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        if VarToStr(Input[2])='0'  then
           EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
              ' and gru.tipo_item<>''09'' ';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
              ' and nfe.id_empresa in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
              ' and ite.id_fornecedor in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[5]) +')';
      end;
   if Input[6] <> '' then
      begin
        EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
               ' and nfe.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +')';
      end;


   EST_SQ_R_ABC_VLR.CommandText := EST_SQ_R_ABC_VLR.CommandText +
       ' group by 1,2,3,4  ' + #13#10 +
       ' order by 5 desc ';

   Result := EST_DP_R_ABC_VLR.Data;

   EST_SQ_R_ABC_VLR.Close;
end;

function TSM.EST_DP_R_CTEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelEstCte: String;
  var
    sql: String;
  begin

    if input[5] <> '' then
       begin
         sql := ' left outer join est_tb_m_fes_alm sld on ( ' +
                '         sld.id_empresa = par.id_empresa ' +
                '         and sld.id_almoxarifado = COALESCE(alm.id_almoxarifado,0) ' +
                '         and sld.id_item    = ite.id_item             ' +
                '         and sld.id_cor     = COALESCE(cor.id_cor,0)  ' +
       					'         and sld.id_tamanho = COALESCE(tam.id_tamanho,0)) ';
       end
    else begin
           sql := ' left outer join est_tb_m_fes sld on ( ' +
                  '         sld.id_empresa = par.id_empresa ' +
                  '         and sld.id_item = ite.id_item '+
                  '         and sld.id_cor     = COALESCE(cor.id_cor,0)  ' +
         					'         and sld.id_tamanho = COALESCE(tam.id_tamanho,0)) ';
         end;

    Result :=
      ' select ite.id_item,' +
      '   ite.descricao as int_descitem, ite.cod_fabrica, ' +
      '   ite.id_und_venda as int_nomeund, loc.loca_rua, loc.loca_prateleira,      ' +
      '   GR1.id_grupo as int_codgru_n1, '+
      '   GR1.descricao as int_descgru_n1, '+
      '   GR2.id_grupo as int_codgru_n2,  '+
      '   GR2.descricao as int_descgru_n2,  '+
      '   ite.id_grupo, gru.descricao as int_descgru,                              ' +
      '   COALESCE(alm.id_almoxarifado,0), alm.descricao as int_nomealm,           ' +
      '   COALESCE(cor.id_cor,0) as id_cor, cor.descricao as int_nomecor,          ' +
      '   COALESCE(tam.id_tamanho,0) as id_tamanho, tam.descricao as int_nometam , ' +
      '   cor.id_cor, tam.id_tamanho, COALESCE(sld.saldo_fisico,0) as saldo_fisico ' +
      ' from cad_tb_c_ite ite  ' +
      '   left outer join cad_tb_c_par par on par.id_empresa = '''+VarToStr(Input[11])+''' '+
      '   left outer join cad_tb_c_ite_loc loc on loc.id_empresa=par.id_empresa and loc.id_item=ite.id_item '+
      '   left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo '+
      '   LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
      '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+
      '   LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
      '                                          GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4)||''.000'' ';

      if Input[5] = '' then
         begin
            result := result + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado > 0 ) ';
         end
      else
         begin
             result  := result + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado in ('+VarToStr(Input[5])+')) ';
         end;

      if Input[8] = '' then
         begin
            result := result + ' left outer join cad_tb_c_cor cor on (cor.id_cor > 0 ) ';
         end
      else
         begin
           result  := result + ' left outer join cad_tb_c_cor cor on (cor.id_cor in ('+VarToStr(Input[8])+')) ';
         end;

      if Input[9] = '' then
         begin
            result := result + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho > 0 ) ';
         end
      else
         begin
            result := result + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho in ('+ VarToStr(Input[9])+')) ';
         end;
      result := result + sql;
  end;
  VAR
    i:Integer;
    ListaCodGrupo:TStrings;
begin
   // input[0] - 0 - No  1 - Sim Exibir itens com movimento no periodo
      // input[1] - DataIni
      // input[2] - DataFin
   // input[3] - Filtro por grupo
   // input[4] - Filtro por rua
   // input[5] - Almoxarifado
   // input[6] - 1 - Somente saldo > 0
            //   2 - Somente saldo < 0

   // input[7] 0 - Relatrio por Rua.
            // 1 - Relatrio por Grupo.

   // input[8] - Filtro Cores

   // input[9] - Filtro Tamanhos

   // input[12] - Item Ativo/Inativo


   EST_SQ_R_CTE.Close;

   EST_SQ_R_CTE.CommandText := enSqlRelEstCte + ' WHERE 1 = 1 ';

   if input[12]  <> '' then
      begin
        EST_SQ_R_CTE.CommandText :=
            EST_SQ_R_CTE.CommandText +
                ' and ite.ativo in (' + VarToStr(Input[12]) +') ';
      end;


   if Input[0] = 1 then
      begin
        EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText +
               ' and exists ( select fea.id_item from est_tb_m_fea fea ' +
               '              where fea.data between ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  + ''' ' +
               '       AND ''' +  FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  + ''' ' +
               '                and  fea.id_item = ite.id_item ' +
							 '             group by fea.id_item) ';
      end;



   if Input[3] <> '' then
      begin
       { EST_SQ_R_CTE.CommandText :=
          EST_SQ_R_CTE.CommandText +
          ' and ite.id_grupo in (' + VarToStr(Input[3]) +') ';   }


        EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[3]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText + ' OR ';
              end;

           EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText + ' ) ';


      end;

   if Input[4] <> '' then
      begin
        EST_SQ_R_CTE.CommandText :=
          EST_SQ_R_CTE.CommandText +
          ' and loc.loca_rua in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[6] <> '' then
      begin
        if Input[6] = 1 then
           begin
             EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
                                           ' and sld.saldo_fisico > 0 ';
           end;
        if Input[6] = 2 then
           begin
             EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
                                           ' and sld.saldo_fisico < 0 ';
           end;
      end;

   if Input[10] <> '' then
      begin
        EST_SQ_R_CTE.CommandText :=
          EST_SQ_R_CTE.CommandText +
          ' and gru.tipo_item in (' + VarToStr(Input[10]) +') ';
      end;

   if Input[7] = 0 then
      begin
        EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
            ' order by loc.loca_rua, loc.loca_prateleira ';
      end
   else if Input[7] = 1 then
      begin
        EST_SQ_R_CTE.CommandText := EST_SQ_R_CTE.CommandText  +
            ' order by int_codgru_n1,int_codgru_n2,ite.id_grupo ';
      end;
   Result := EST_DP_R_CTE.Data;
end;

function TSM.EST_DP_R_DEZDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

    EST_SQ_R_DEZ.Close;
    EST_SQ_R_DEZ.CommandText :=

     ' SELECT nfe.id_emitente, '+
     '  Fn.descricao, '+
     '  coalesce(sum(nfi.vlr_liquido),0) Compras '+
     '  FROM fat_tb_m_nfe_ite nfi '+
     ' left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal '+
     ' Left Outer Join cad_tb_c_for fn on fn.id_fornecedor=nfe.id_emitente '+
     ' Where nfe.tipo_nf=''E'' and nfe.status=1 '+
     ' and nfe.dta_emissao>='''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])))+''' '+
     ' and nfe.dta_emissao<='''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])))+''' ';


    if Input[3] <> '' then
       begin
         EST_SQ_R_DEZ.CommandText :=  EST_SQ_R_DEZ.CommandText +
                        ' and nfe.id_empresa in ('+ VarToStr(Input[3])+')';
       end;

    EST_SQ_R_DEZ.Close;
    EST_SQ_R_DEZ.CommandText := EST_SQ_R_DEZ.CommandText +
                    ' Group by 1,2 '+
                    ' order by 3 desc '+
                    ' limit 10 ';

   Result := EST_DP_R_DEZ.Data;
   EST_SQ_R_DEZ.Close;
end;

function TSM.BUS_DP_M_EXT_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   // input[0]  -
         //  0 - Sem almoxarifado
         //  1 - Com almoxarifado
   // input[1]  - Empresa
   // input[2]  - Almoxarifados
   // input[3]  - Itens
   // input[4]  - Cor
   // input[5]  - Tamanho

   { valor campo f.origem
    0 - Por Nota fiscal de entrada
    1 - Por Nota fiscal de sada
    2 - Por Ordem de sada
    3 - Por almoxarifado - Sada
    4 - Por inventrio
    5 - Por almoxarifado - Devolucao.
    6- Por Pedido de Venda}

  BUS_SQ_M_EXT_ITE.Close;
  BUS_SQ_M_EXT_ITE.CommandText :=

       '  select f.id_empresa, ' +
       '          f."data",f.id_fea, f.origem,f.int_descorigem, f.documento,  f.id_item, f.id_seq_item,f.id_almoxarifado, f.id_cor, f.id_tamanho, ' +
       '          f.tipo_movimento, f.int_nometme, f.id_fiscal,f.id_pedido,f.id_ordem, f.int_descorigem, f.qtde,                                                ' +
       '          sum(f.qtde) over (partition by f.id_item,f.id_almoxarifado, f.id_cor, f.id_tamanho order by f."data",f.id_fea) as sld_estoque ' +
       '   from  (select                                                                                                         ' +
       '              fea.id_empresa, fea."data", fea.id_fea, fea.origem, fea.documento, fea.id_item, fea.id_seq_item,                                      ' +
       '              fea.id_almoxarifado, fea.id_cor, fea.id_tamanho,                                                           ' +
       '              tme.tipo_movimento,tme.descricao as int_nometme, fea.id_fiscal,fea.id_pedido,fea.id_ordem,                                              ' +
       '              cast (case fea.origem   ' +
       '                     when  0 then ''Por Nota fiscal de entrada'' ' +
       '                     when  1 then ''Por Nota fiscal de sada'' ' +
       '                     when  2 then ''Por Ordem de sada'' ' +
       '                     when  3 then ''Por almoxarifado - Sada'' ' +
       '                     when  4 then ''Por inventrio'' ' +
       '                     when  5 then ''Por almoxarifado - Devolucao'' ' +
       '                     when  6 then ''Por Pedido de Venda'' ' +
       '                     when  7 then ''Por Dev. de NF de Fornecedor'' ' +
       '                     when  8 then ''Por Dev. de NF de Cliente'' ' +
       '                     when  9 then ''Por Ordem de Servio'' '+
       '              end as varchar(30)) as int_descorigem, ' +
       '              case tme.tipo_movimento ' +
       '                 when 0 then fea.qtde ' +
       '                 when 1 then fea.qtde * -1 ' +
       '              end as qtde                  ' +
       '           from est_tb_m_fea fea           ' +
       '   left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque ' +
       '   order by fea."data",fea.id_fea, fea.id_item,fea.id_almoxarifado, fea.id_cor, fea.id_tamanho ) f ' ;


   if Input[0] = 0 then
      begin
        BUS_SQ_M_EXT_ITE.CommandText := BUS_SQ_M_EXT_ITE.CommandText
          + ' where f.id_empresa  = ''' + VarToStr(Input[1]) + ''' AND ' +
            '       f.id_item     = ''' + VarToStr(Input[3]) + ''' AND ' +
            '       f.id_cor      = ''' + VarToStr(Input[4]) + ''' AND ' +
            '       f.id_tamanho  = ''' + VarToStr(Input[5]) + '''  ';
      end;

   if Input[0] = 1 then
      begin
        BUS_SQ_M_EXT_ITE.CommandText := BUS_SQ_M_EXT_ITE.CommandText
          + ' where f.id_empresa       = ''' + VarToStr(Input[1]) + ''' AND ' +
            '       f.id_almoxarifado  = ''' + VarToStr(Input[2]) + ''' AND ' +
            '       f.id_item          = ''' + VarToStr(Input[3]) + ''' AND ' +
            '       f.id_cor           = ''' + VarToStr(Input[4]) + ''' AND ' +
            '       f.id_tamanho       = ''' + VarToStr(Input[5]) + '''  ';
      end;

   BUS_SQ_M_EXT_ITE.CommandText := BUS_SQ_M_EXT_ITE.CommandText +
      ' order by f."data",f.id_fea, f.id_item,f.id_almoxarifado, f.id_cor, f.id_tamanho ' ;
   //GerarSqlTxt(BUS_SQ_M_EXT_ITE);
   Result := BUS_DP_M_EXT_ITE.Data;
   BUS_SQ_M_EXT_ITE.Close;
end;

function TSM.EST_DP_R_FICDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql: String;
begin

  { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 23/10/2014 }

   // input[0]  - Empresa
   // input[1]  - Tipo de Estoque
   // input[2]  - Data inicial
   // input[3]  - Data final
   // input[4]  - Itens
   // input[5]  - Almoxarifados
   // input[6]  - Cor
   // input[7]  - Tamanho


   EST_SQ_R_FIC.Close;
   EST_SQ_R_FIC.CommandText :=
       ' select par.id_empresa, fea.id_fea, ite.id_item, ite.cod_fabrica, ite.cod_barra, ite.descricao as int_nomeite, ite.id_und_compra,ite.preco_sugerido, COALESCE(cor.id_cor,0) AS id_cor, ' +
       ' par.emp_razao as int_nomeraz, par.emp_fantasia as int_nomefan, fea."data", fea.documento, ' +
       ' COALESCE(cor.descricao,'''') as int_nomecor, COALESCE(tam.id_tamanho,0) as id_tamanho,                ' +
       ' COALESCE(tam.descricao,'''') as int_nometam,  fea.num_lote,                                                        ' +
			 ' COALESCE(alm.id_almoxarifado,0) AS id_almoxarifado , COALESCE(alm.descricao,'''') as int_nomealm,     ' +
       ' tme.tipo_movimento, fea.qtde, tme.descricao as int_nometme,                           ' +
       '   ' +
       ' case tme.tipo_movimento  ' +
       '  when 0 then ''Entrada'' ' +
       '   when 1 then ''Sada''  ' +
       '   end as int_tipomov,  ' +
       ' case fea.origem ' +
       '   when 0 then ''Por NF de entrada''   ' +
       '   when 1 then ''Por NF de sada''     ' +
       '   when 2 then ''Por Ordem de sada''  ' +
       '   when 3 then ''Por almox. - Sada''  ' +
       '   when 4 then ''Por inventrio''      ' +
       '   when 5 then ''Por almox. - Dev.''   ' +
       '   when 6 then ''Por Pedido de Venda'' ' +
       '   when 7 then ''Por NF Dev. Fornecedor'' '+
       '   when 8 then ''Por NF Dev. Cliente''    '+
       ' else ''?????'' end as int_origem,      ' +


       ' case                                                                 '+
       '  when fea.origem in (1,8) then (select cid.uf from fat_tb_m_nfe nfe  '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente  '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade     '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                  '+
       '  when fea.origem in (0,7) then (select cid.uf from fat_tb_m_nfe nfe       '+
       '       left outer join cad_tb_c_for frn on frn.id_fornecedor=nfe.id_emitente  '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=frn.id_cidade       '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                    '+
       '  when fea.origem in (6) then (select cid.uf from fat_tb_m_ped ped           '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente     '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade       '+
       '       where ped.id_pedido=fea.id_pedido)                                    '+
       '  when fea.origem in (2) then (select cid.uf from ofi_tb_m_orv orv           '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente     '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade       '+
       '       where orv.id_ordem=fea.id_ordem)                                      '+
       '  end as int_uf,                                                             '+


       ' case                                                                        '+
       '  when fea.origem in (1,8) then (select cid.nome from fat_tb_m_nfe nfe       '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente    '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade       '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                    '+
       '  when fea.origem in (0,7) then (select cid.nome from fat_tb_m_nfe nfe       '+
       '       left outer join cad_tb_c_for frn on frn.id_fornecedor=nfe.id_emitente  '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=frn.id_cidade        '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                     '+
       '  when fea.origem in (6) then (select cid.nome from fat_tb_m_ped ped          '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente      '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade        '+
       '       where ped.id_pedido=fea.id_pedido)                                     '+
       '  when fea.origem in (2) then (select cid.nome from ofi_tb_m_orv orv          '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente      '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade        '+
       '       where orv.id_ordem=fea.id_ordem)                                       '+
       '  end as int_desc_cid,                                                        '+


       '  case                                                                        '+
       '  when fea.origem in (1,8) then (select cid.id_cidade from fat_tb_m_nfe nfe   '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente     '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade        '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                     '+
       '  when fea.origem in (0,7) then (select cid.id_cidade from fat_tb_m_nfe nfe   '+
       '       left outer join cad_tb_c_for frn on frn.id_fornecedor=nfe.id_emitente  '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=frn.id_cidade        '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                     '+
       '  when fea.origem in (6) then (select cid.id_cidade from fat_tb_m_ped ped     '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente      '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade        '+
       '       where ped.id_pedido=fea.id_pedido)                                     '+
       '  when fea.origem in (2) then (select cid.id_cidade from ofi_tb_m_orv orv     '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente      '+
       '       left outer join cad_tb_c_cid cid on cid.id_cidade=cli.id_cidade        '+
       '       where orv.id_ordem=fea.id_ordem)                                       '+
       '  end as int_cod_cid,                                                          '+


       ' case                                                                         '+
       ' when fea.origem in (1,8) then (select cli.nome from fat_tb_m_nfe nfe         '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente     '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                     '+
       ' when fea.origem in (0,7) then (select frn.descricao from fat_tb_m_nfe nfe    '+
       '       left outer join cad_tb_c_for frn on frn.id_fornecedor=nfe.id_emitente  '+
       '       where nfe.id_fiscal=fea.id_fiscal)                                     '+
       ' when fea.origem in (6) then (select cli.nome from fat_tb_m_ped ped           '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente      '+
       '       where ped.id_pedido=fea.id_pedido)                                     '+
       ' when fea.origem in (2) then (select cli.nome from ofi_tb_m_orv orv           '+
       '       left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente      '+
       '       where orv.id_ordem=fea.id_ordem)                                       '+
       ' end as int_nome_emi,                                                          '+

       ' case                                                                         '+
       ' when fea.origem in (1,8) then (select vlr_unitario from fat_tb_m_nfe_ite nfi '+
       '       where nfi.id_fiscal=fea.id_fiscal and nfi.id_sequencia =fea.id_seq_item and nfi.id_item=fea.id_item and nfi.id_cor=fea.id_cor and nfi.id_tamanho=fea.id_tamanho)  '+
       ' when fea.origem in (0,7) then (select vlr_unitario from fat_tb_m_nfe_ite nfi                                                      '+
       '        where nfi.id_fiscal=fea.id_fiscal and nfi.id_sequencia =fea.id_seq_item and nfi.id_item=fea.id_item and nfi.id_cor=fea.id_cor and nfi.id_tamanho=fea.id_tamanho) '+
       ' when fea.origem in (6) then (select vlr_unitario from fat_tb_m_ped_ite pei                                                        '+
       '       where pei.id_pedido=fea.id_pedido and pei.id_sequencia =fea.id_seq_item and pei.id_item=fea.id_item and pei.id_cor=fea.id_cor and pei.id_tamanho=fea.id_tamanho)  '+
       ' when fea.origem in (2) then (select vlr_unitario from ofi_tb_m_orv_ite ori                                                        '+
       '       where ori.id_ordem=fea.id_ordem  and  ori.id_sequencia =fea.id_seq_item and ori.id_item=fea.id_item and ori.id_cor=fea.id_cor and ori.id_tamanho=fea.id_tamanho)   '+
       ' end as int_vlr_unitario, '+
       ' fes.vlr_custo_medio '+

       ' from est_tb_m_fea fea                 ' +
       '     left outer join cad_tb_c_tme tme on                    ' +
       '        (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) '+
       ' left outer join cad_tb_c_par par on (par.id_empresa = fea.id_empresa) ' +
       ' left outer join cad_tb_c_ite ite on (ite.id_item = fea.id_item ) '      +
       ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = fea.id_almoxarifado ) ' +
       ' left outer join cad_tb_c_tam tam on (tam.id_tamanho = fea.id_tamanho ) ' +
       ' left outer join cad_tb_c_cor cor on (cor.id_cor = fea.id_cor ) '+
       ' left outer join  est_tb_m_fes fes on (fes.id_empresa=fea.id_empresa and fes.id_item=fea.id_item and fes.id_cor=fea.id_cor and fes.id_tamanho=fea.id_tamanho ) ';




   EST_SQ_R_FIC.CommandText := EST_SQ_R_FIC.CommandText + ' where 1 = 1 ';

   if Input[0] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and fea.id_empresa in (' + VarToStr(Input[0]) +') ';
      end;

   if Input[1] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and fea.id_tipo_mov_estoque in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[4] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and fea.id_item in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and coalesce(fea.id_almoxarifado,0) in (' + VarToStr(Input[5]) +') ';
      end;

   if Input[6] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and fea.id_cor in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        EST_SQ_R_FIC.CommandText :=
          EST_SQ_R_FIC.CommandText +
          ' and fea.id_tamanho in (' + VarToStr(Input[7]) +') ';
      end;

   EST_SQ_R_FIC.CommandText :=
       EST_SQ_R_FIC.CommandText +
       ' and fea."data" >= ''' +
         FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
         ''' and ' +
       ' fea."data" <= ''' +
         FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )  +
         '''  ';

   EST_SQ_R_FIC.CommandText :=
       EST_SQ_R_FIC.CommandText +
           ' order by fea.id_empresa, fea.id_item, fea.id_almoxarifado , ' +
           '          fea.id_tamanho, fea.id_cor,fea."data", fea.id_fea ';
   //GerarSqlTxt(EST_SQ_R_FIC);
   Result := EST_DP_R_FIC.Data;
   EST_SQ_R_FIC.Close;
end;

function TSM.EST_DP_R_GIRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql:string;
  ListaCodGrupo:TStrings;
  i:Integer;
begin
    { TODO -oLuan : Criado no dia 29/10/2015 }
    //Input[0] - Empresa
    //Input[1] - Grupo
    //Input[2] - Item
    //Input[3] - Cor
    //Input[4] - Tamanho
    //Input[5] - Data Inicial
    //Input[6] - Data Final
   sql :=
      ' select c.id_empresa, par.emp_fantasia,cast(cast(c.id_item as varchar)||cast(c.id_cor as varchar)||cast(c.id_tamanho as varchar) as int) as codigo, c.id_item, '+
      ' ite.descricao as int_nomeite, ite.id_und_venda, c.id_cor, cor.descricao as  int_nomecor, c.id_tamanho, tam.descricao as int_nometam, gru.descricao as int_nomegru, '+

      ' ( select coalesce( sum(inf.qtde - inf.qtde_devolvida),0)/12 from fat_tb_m_nfe_ite as inf '+
      '     left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal=inf.id_fiscal) '+
      '     left outer join cad_tb_c_cfo cfo on (cfo.id_cfo=nfe.id_cfo) '+
      '  where '+
      '    nfe.id_empresa=c.id_empresa and '+
      '    inf.id_item=c.id_item and  '+
      '    inf.id_cor=c.id_cor and  '+
      '    inf.id_tamanho=c.id_tamanho and '+
      '    nfe.status =1 and '+
      '    nfe.NFE_COD_SIT not in (''02'',''04'',''05'') and '+
      '    nfe.faturada = true and '+
      '    cfo.id_classe in (''SP10'',''SP70'') and ' +
      '    nfe.dta_emissao>='''+Input[5]+''' and '+'nfe.dta_emissao<='''+Input[6]+

      ''') as venda_media, '+

      '  cast((COALESCE(sum(c.estoque_medio),0) / 12) as numeric(20,4)) as estoque_medio, '+


      ' cast(( ( ( select coalesce( sum(inf.qtde - inf.qtde_devolvida),0)/12 from fat_tb_m_nfe_ite as inf '+
      '     left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal=inf.id_fiscal) '+
      '     left outer join cad_tb_c_cfo cfo on (cfo.id_cfo=nfe.id_cfo) '+
      '  where '+
      '    nfe.id_empresa=c.id_empresa and '+
      '    inf.id_item=c.id_item and '+
      '    inf.id_cor=c.id_cor and '+
      '    inf.id_tamanho=c.id_tamanho and '+
      '    nfe.status =1 and '+
      '    nfe.NFE_COD_SIT not in (''02'',''04'',''05'') and '+
      '    nfe.faturada = true and '+
      '    cfo.id_classe in (''SP10'',''SP70'') and '+
      '    nfe.dta_emissao>='''+Input[5]+''' and '+'nfe.dta_emissao<='''+Input[6]+
      ''')  / '+

      '   cast((COALESCE(sum(c.estoque_medio),0) / 12) as numeric(20,4)))*12) as numeric(18,2)) as qtde_giro_estoque '+

      ' from '+

      ' (select t.id_empresa,  t.id_item, t.id_cor, t.id_tamanho, extract(month from t."data") as mes, extract(year from t."data") as  ano, '+
      '       coalesce( sum(t.saldo),0) qtde_saldo_resultante, count(*) as qtde_movimentos, COALESCE(sum(t.saldo),0) /  count(*) as estoque_medio '+
      ' from ( '+

      '       select f.id_empresa, f."data",f.id_fea, f.id_item, f.id_seq_item, f.id_cor, f.id_tamanho, f.qtde, '+

      '              COALESCE( (select '+
      '                   sum(case tme.tipo_movimento '+
      '                                when 0 then fic.qtde '+
      '                                when 1 then fic.qtde * -1 '+
      '                       end) '+
      '               from est_tb_m_fea fic '+
      '                  left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque = fic.id_tipo_mov_estoque '+
      '               where '+
      '                  fic.id_empresa = f.id_empresa and '+
      '                  fic.id_item = f.id_item and '+
      '                  fic.id_cor  = f.id_cor and '+
      '                  fic.id_tamanho  =  f.id_tamanho and '+
      '                  fic."data" < '''+Input[5]+
      '''  ),0) +' +
      '              sum(f.qtde) over (partition by f.id_empresa,f.id_item,f.id_cor, f.id_tamanho order by f."data",f.id_fea) as saldo '+
      '                  from '+

      '                      ( select '+
      '                             fea.id_empresa, fea."data", fea.id_fea, fea.origem, fea.documento, fea.id_item, fea.id_seq_item, '+
      '                             fea.id_almoxarifado, fea.id_cor, fea.id_tamanho, '+
      '                             tme.tipo_movimento,tme.descricao as int_nometme, '+
      '                            case tme.tipo_movimento '+
      '                                when 0 then fea.qtde '+
      '                                when 1 then fea.qtde * -1 '+
      '                             end as qtde '+
      '                        from est_tb_m_fea fea '+
      '                            left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque '+
      '                            left outer join cad_tb_c_ite ite on ite.id_item = fea.id_item '+
      '                        where 1=1 ';
      if Input[0]<>'' then
        begin
           sql := sql + ' and fea.id_empresa in ('+Input[0]+') ';
        end;

      if Input[1]<>'' then
        begin
         // sql := sql + ' and ite.id_grupo in ('+Input[1]+') ';
         sql := sql  +
              ' AND ( ';

        ListaCodGrupo := TStringList.Create;
        LIstaCodGrupo.Delimiter:=',';
        LIstaCodGrupo.StrictDelimiter:=True;
        ListaCodGrupo.DelimitedText :=  VarToStr(Input[1]);

        for i := 0 to ListaCodGrupo.Count-1 do
          begin
            if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
              begin
                  sql := sql  +
                    ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                    '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
              end
            else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
              begin
                  sql := sql  +
                    ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                    '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
              end
            else
              begin
                 sql := sql  +
                    ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
              end;

            if i < (ListaCodGrupo.Count-1) then
              sql := sql + ' OR ';
          end;

       sql := sql + ' ) ';


        end;

      if Input[2] <>'' then
        begin
          sql := sql + ' and fea.id_item in ('+Input[2]+') ';
        end;
      if Input[3] <>'' then
        begin
          sql := sql + ' and fea.id_cor in ('+Input[3]+') ';
        end;
      if Input[4] <>'' then
        begin
          sql := sql + ' and fea.id_tamanho in ('+Input[4]+') ';
        end;

      sql := sql +  'and fea."data">='''+Input[5]+''' and '+'fea."data"<='''+Input[6]+
      '''  order by fea."data",fea.id_fea, fea.id_item,fea.id_almoxarifado, fea.id_cor, fea.id_tamanho  '+
      '                       ) f '+

      '        group by 1,2,3,4,5,6,7,8 '+
      '        order by data '+
      '     ) t '+
      '     group by t.id_empresa, t.id_item, t.id_cor, t.id_tamanho, extract(month from t."data"), extract(year from t."data") '+
      '    ) c '+
      ' left outer join cad_tb_c_par par on (par.id_empresa = c.id_empresa) '+
      ' left outer join cad_tb_c_ite ite on (ite.id_item = c.id_item) '+
      ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo) '+
      ' left outer join cad_tb_c_cor cor on (cor.id_cor = c.id_cor) '+
      ' left outer join cad_tb_c_tam tam on (tam.id_tamanho = c.id_tamanho) '+

      ' where 1=1 ';


    sql := sql + ' group by 1,2,3,4,5,6,7,8,9,10,11,12 ';

   EST_SQ_R_GIR.CommandText := sql;
   Result := EST_DP_R_GIR.Data;
   EST_SQ_R_GIR.Close;
end;

function TSM.EST_DP_R_INVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelInv, CondicaoOrder: String;
    ListaCodGrupo:TStrings;
    i:Integer;
begin

    enSqlRelInv := '';

    // input[0]  Relatrios
             //   0 - Geral
             //   1 - Por Grupo
             //   2 - Por Locao
    // Input[1]  Empresa
    // Input[2]  Data base
    // Input[3]  Tipo de saldo
             //  1 - Positivo
             //  2 - Negativo
    // Input[4]  Grupo
    // input[5]  Fornecedor
    // input[7]
             // 0 - Custo Mdio
             // 1 - Custo ltima compra

    CondicaoOrder := '';

    enSqlRelInv :=
         '  SELECT inv.id_empresa, '+
         '           inv.id_item, ite.descricao as int_nomeite, '+
         '           frn.descricao as int_descfor,  '+
         '           frn.id_fornecedor as int_cod_for, '+
         '           GR1.id_grupo as int_codgru_n1, '+
         '           GR1.descricao as int_descgru_n1, '+
         '           GR2.id_grupo as int_codgru_n2,  '+
         '           GR2.descricao as int_descgru_n2,  '+
         '           ite.id_grupo, '+
         '           ncm.descricao as int_ncm, '+
         '           loca_rua,loca_prateleira,loca_escaninho, '+
         '           loca_rua||loca_prateleira||loca_escaninho as locacao, '+
         '           gru.descricao as int_nomegru, '+
         '           ite.id_ncm, ite.id_und_venda, '+
         '           inv.qtde, ';
         if input[7] = 0 then
            begin
              enSqlRelInv := enSqlRelInv + '  INV.custo , (inv.qtde*INV.custo) as vlr_total ';
            end;
         if input[7] = 1 then
            begin
              enSqlRelInv := enSqlRelInv + '  fes.vlr_custo_ult_compra as custo, (inv.qtde*fes.vlr_custo_ult_compra) as vlr_total ';
            end;
         enSqlRelInv := enSqlRelInv +
         '     FROM EST_TB_M_INV INV  '+
         '     left outer join est_tb_m_fes fes on fes.id_empresa = inv.id_empresa and ' +
         '                                         fes.id_item    = inv.id_item and ' +
         '                                         fes.id_cor     = inv.id_cor and ' +
         '                                         fes.id_tamanho = inv.id_tamanho ' +
         '     left outer join cad_tb_c_ite ite on ite.id_item  = INV.id_item '+
         '     left outer join cad_tb_c_ncm ncm on ncm.id_ncm  = ite.id_ncm '+
         '     left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo  '+
         '     left outer join cad_tb_c_for frn on frn.id_fornecedor = ite.id_fornecedor  '+
         '     LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
         '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

         '     LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
         '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' '+
         ' WHERE inv.id_empresa = ''' + VarToStr(Input[1]) +''' '+
         ' and gru.tipo_item <> '''+'07'+''' ';

    if Input[0] = 0 then
       begin
         CondicaoOrder :=  ' ORDER BY INV.ID_EMPRESA, ITE.DESCRICAO ';
       end;

    if Input[0] = 1 then
       begin
        // CondicaoOrder :=  ' ORDER BY INV.ID_EMPRESA, ITE.ID_GRUPO ';
         CondicaoOrder :=  ' ORDER BY INV.ID_EMPRESA, int_codgru_n1,int_codgru_n2,ITE.ID_GRUPO ';
       end;

    if Input[0] = 2 then
       begin
         CondicaoOrder :=  ' ORDER BY INV.ID_EMPRESA, ITE.LOCA_RUA, ITE.LOCA_PRATELEIRA, ITE.LOCA_ESCANINHO ';
       end;
     if Input[0] = 3 then
       begin
         CondicaoOrder :=  ' ORDER BY INV.ID_EMPRESA, INT_DESCFOR ';
       end;


    EST_SQ_R_INV.Close;
    EST_SQ_R_INV.CommandText := '';
    EST_SQ_R_INV.CommandText := enSqlRelInv;

    EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
        ' AND inv.dta_inventario = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) + '''  ';

    if Input[3] <> '' then
       begin
          if Input[3] = 1 then
              begin
                 EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
                     ' AND inv.qtde > 0 ';
              end;
          if Input[3] = 2 then
             begin
                EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
                     ' AND inv.qtde < 0 ';
             end;
       end;

    if Input[4] <> '' then
       begin
          EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[4]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText + ' OR ';
              end;

           EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText + ' ) ';
       end;

    if Input[5] <> '' then
       begin
          EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
              ' AND ite.id_fornecedor in (' + VarToStr(Input[5]) +') ';
       end;

  if Input[6] <> '' then
    begin
      if Input[6] = 1 then
        begin
          EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
            ' AND ite.ativo = true ';
        end;

      if Input[6] = 2 then
        begin
          EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  +
            ' AND ite.ativo = false ';
        end;
    end;

   if CondicaoOrder<>'' then
      begin
        EST_SQ_R_INV.CommandText := EST_SQ_R_INV.CommandText  + CondicaoOrder;
      end;

   Result := EST_DP_R_INV.Data;
   EST_SQ_R_INV.Close;

end;

function TSM.EST_DP_R_ISMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEstRelIsm: String;
  begin
     Result :=
              ' select ' + #13#10 +
              '    ite.id_item,ite.descricao,ite.id_und_venda,ite.preco_avista, ite.preco_aprazo, ' +
              '    ite.id_grupo, gru.descricao as int_nomegru,' + #13#10 +
              '    fes.saldo_fisico,' + #13#10 +
              '    case' + #13#10 +
              '        when 0 = ''' + VarToStr(Input[4]) + ''' then  fes.vlr_custo_medio' + #13#10 +
              '    else ' + #13#10 +
              '        (select max(nii.vlr_custo) from fat_tb_m_nfe_ite nii' + #13#10 +
              '         where nii.id_fiscal in (' + #13#10 +
              '					                      	select max(nfi.id_fiscal) from fat_tb_m_nfe_ite nfi' + #13#10 +
              '																		left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              '																	where nfe.tipo_nf = ''E''' + #13#10;
     if Input[0] <> '' then
        begin
          Result := Result +
               '            and nfe.id_empresa in (' + VarToStr(Input[0]) +')';
        end;
     Result := Result +
               '            and nfi.id_item = ite.id_item )' + #13#10 +
               '          and nii.id_item = ite.id_item)' + #13#10 +
               '    end as vlr_custo,' + #13#10 +

               ' (select (CURRENT_DATE-max(nfe.dta_emissao)) from fat_tb_m_nfe_ite nfi  ' + #13#10 +
               '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal  ' + #13#10 +
               '   left outer join cad_tb_c_cfo cfo on cfo.id_cfo    = nfe.id_cfo  ' + #13#10 +
               ' where cfo.id_classe in (''EA10'') and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and  ' + #13#10 +
               '      nfe.status = 1 and nfe.tipo_nf= ''E'' ' + #13#10;

     if Input[0] <> '' then
        begin
          Result := Result +
               '            and nfe.id_empresa in (' + VarToStr(Input[0]) +') ';
        end;


     Result := Result +
               ' and nfi.id_item = ite.id_item) as dias_sem_compra ' + #13#10 +
               ' from cad_tb_c_ite ite' + #13#10 +
               '    left outer join est_tb_m_fes fes on fes.id_item = ite.id_item   ' +
               '    left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ';
  end;
begin
   { TODO -oMaxsuel : Criado no dia 03/10/2016 }
   {
     input[0] - Empresa
     input[1] - Acima de tantos Dias
     input[2] - Grupo
     input[3] - Familia
     input[4] - Qtde dias

   }
     EST_SQ_R_ISM.Close;

     EST_SQ_R_ISM.CommandText := enSqlEstRelIsm +
          ' where ite.ativo=true and not exists ' + #13#10 +
          '    (select nfi.id_item from fat_tb_m_nfe_ite nfi' + #13#10 +
          '        left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal' + #13#10 +
          '        left outer join cad_tb_c_cfo cfo on cfo.id_cfo    = nfe.id_cfo  ' + #13#10 +
          '     where nfi.id_item = ite.id_item and' + #13#10 +
          '           cfo.id_classe in (''EA10'') and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and ' + #13#10 +
          '           nfe.status = 1 and nfe.tipo_nf= ''E'' ' + #13#10;
                 if Input[0] <> '' then
                    begin
                      EST_SQ_R_ISM.CommandText := EST_SQ_R_ISM.CommandText +
                        ' and nfe.id_empresa in (' + VarToStr(Input[0]) +')';
                    end;

                 EST_SQ_R_ISM.CommandText := EST_SQ_R_ISM.CommandText +
                        ' and  (CURRENT_DATE -  nfe.dta_emissao) < ''' + VarToStr(Input[1]) + '''  ' +
                        '    )' ;

     if Input[2] <> '' then
        begin
          EST_SQ_R_ISM.CommandText := EST_SQ_R_ISM.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[2]) +')';
        end;

     if Input[3] <> '' then
        begin
          EST_SQ_R_ISM.CommandText := EST_SQ_R_ISM.CommandText +
               ' and ite.id_familia in (' + VarToStr(Input[3]) +')';
        end;

   EST_SQ_R_ISM.CommandText := EST_SQ_R_ISM.CommandText +
         ' order by ite.id_grupo, ite.descricao ';

   Result := EST_DP_R_ISM.Data;

   EST_SQ_R_ISM.Close;
end;

function TSM.EST_DP_R_MALDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEstRelMal: String;
  begin
     Result :=
        ' SELECT MIT.*,MAL.ID_EMPRESA,MAL.DATA,MAL.ID_ALMOXARIFADO,MAL.ID_CCUSTO, '+
        ' ITE.DESCRICAO AS INT_NOMEITE,UND.DESCRICAO AS INT_UNDVEN,COR.DESCRICAO AS INT_NOMECOR,TAM.DESCRICAO AS INT_NOMETAM,PAR.EMP_FANTASIA AS INT_EMPFANTASIA, '+
        ' PAR.EMP_RAZAO AS INT_EMPRAZAO,GRU.ID_GRUPO AS INT_CODGRU,GRU.DESCRICAO AS INT_NOMEGRU,CCU.DESCRICAO AS INT_NOMECCUSTO, '+
        ' ALM.DESCRICAO AS INT_NOMEALM, ' +
        ' MAL.ID_EQUIPAMENTO, MEQ.DESCRICAO AS INT_NOMEMEQ  FROM EST_TB_M_MAL_ITE MIT                                     '+
        ' LEFT OUTER JOIN EST_TB_M_MAL MAL ON MAL.ID_MAL=MIT.ID_MAL                                   '+
        ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=MIT.ID_ITEM                                 '+
        ' LEFT OUTER JOIN CAD_TB_C_UND UND ON UND.ID_UNIDADE=ITE.id_und_venda                         '+
        ' LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR=MIT.ID_COR                                   '+
        ' LEFT OUTER JOIN CAD_TB_C_TAM TAM ON TAM.ID_TAMANHO=MIT.ID_TAMANHO                           '+
        ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO                               '+
        ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=MAL.ID_EMPRESA                           '+
        ' LEFT OUTER JOIN CAD_TB_C_CCU CCU ON CCU.ID_CCUSTO=MAL.ID_CCUSTO                             '+
        ' LEFT OUTER JOIN CAD_TB_C_ALM ALM ON ALM.ID_ALMOXARIFADO=MAL.ID_ALMOXARIFADO                 '+
        ' LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = MAL.ID_EQUIPAMENTO   ';
  end;
begin
   { TODO -oLuan : Criado no dia 15/05/2017 }
   {
     input[0] - Cod. Relatorio
     input[1] - Data inicial
     input[2] - Data final
     input[3] - Empresa
     input[4] - Almoxarifado
     input[5] - Tipo de Estoque
     input[6] - Setor
     input[7] - Responsavel
     input[8] - Centro de Custo
     input[9] - Equipamento

   }
     EST_SQ_R_MAL.Close;

     EST_SQ_R_MAL.CommandText := enSqlEstRelMal +
          ' where mal.data >= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+''' and '+
          ' mal.data<= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )+''' ';
     if Input[3] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
            ' and mal.id_empresa in (' + VarToStr(Input[3]) +') ';
        end;

     if Input[4] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_almoxarifado in (' + VarToStr(Input[4]) +') ';
        end;


     if Input[5] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_tipo_mov_estoque in (' + VarToStr(Input[5]) +') ';
        end;

     if Input[6] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_setor in (' + VarToStr(Input[6]) +') ';
        end;

     if Input[7] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_responsavel in (' + VarToStr(Input[7]) +') ';
        end;

     if Input[8] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_ccusto in (' + VarToStr(Input[8]) +') ';
        end;

      if Input[9] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and mal.id_equipamento in (' + VarToStr(Input[9]) +') ';
        end;

      if Input[10] <> '' then
        begin
          EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[10]) +') ';
        end;

   if Input[0] = '0' then
       EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
             ' order by mal.id_empresa,mal.data,int_nomeite ';
   if Input[0] = '1' then
       EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
             ' order by mal.id_empresa,int_nomealm,int_nomegru,mal.data ';
   if Input[0] = '2' then
       EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
             ' order by mal.id_empresa,int_nomealm,int_nomeccusto,mal.data ';
   if Input[0] = '3' then
       EST_SQ_R_MAL.CommandText := EST_SQ_R_MAL.CommandText +
             ' order by mal.id_empresa,mal.id_equipamento,int_nomegru,mal.data ';

   Result := EST_DP_R_MAL.Data;

   EST_SQ_R_MAL.Close;
end;

function TSM.EST_DP_R_MLTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlEstRelMlt: String;
  begin
    Result :=
       '  select par.id_empresa,gru.id_grupo, '+
       '  cast(cast(lot.id_item as varchar)||cast(lot.id_cor as varchar)||cast(lot.id_tamanho as varchar) as int) as codigo, '+
       '  lot.num_lote,par.emp_fantasia as int_empfan,gru.descricao as int_nomegru, '+
       '  lot.id_item,ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda, '+
       '  lot.id_cor,cor.descricao as int_nomecor,lot.id_tamanho,tam.descricao as int_nometam,alm.id_almoxarifado,alm.descricao as int_nomealm, '+
       '  lot.qtde_entrada,lot.qtde_saida,lot.qtde_atual '+
       '  from est_tb_m_lot lot '+
       '  left outer join cad_tb_c_par par on (par.id_empresa = lot.id_empresa) '+
       '  left outer join cad_tb_c_ite ite on (ite.id_item = lot.id_item) '+
       '  left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = lot.id_almoxarifado) '+
       '  left outer join cad_tb_c_cor cor on (cor.id_cor = lot.id_cor) '+
       '  left outer join cad_tb_c_tam tam on (tam.id_tamanho = lot.id_tamanho) '+
       '  left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo) '+
       '  where 1=1 ';
  end;
begin
   { TODO -oLuan : Criado no dia 10/11/2015 }
   EST_SQ_R_MLT.Close;

   EST_SQ_R_MLT.CommandText := enSqlEstRelMlt;


   if Input[1] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
              ' and lot.id_empresa in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
              ' and lot.id_item in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and lot.id_almoxarifado in (' + VarToStr(Input[3]) +')';
      end;
   if Input[4] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[4]) +')';
      end;
   if Input[5] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and lot.id_cor in (' + VarToStr(Input[5]) +')';
      end;
   if Input[6] <> '' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and lot.id_tamanho in (' + VarToStr(Input[6]) +')';
      end;

    if (Input[7] <> '') then
      begin
        if (Input[7] = '1') then
          begin
            EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and lot.qtde_atual<=0 ';
          end;
        if (Input[7] = '2') then
          begin
            EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
               ' and lot.qtde_atual>0 ';
          end;
      end;


   if Input[0] = '1' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
                                ' order by par.id_empresa,lot.num_lote ';
      end;

   if Input[0] = '2' then
      begin
        EST_SQ_R_MLT.CommandText := EST_SQ_R_MLT.CommandText +
                                ' order by 1,2,3,4 ';
      end;

   Result := EST_DP_R_MLT.Data;
   EST_SQ_R_MLT.Close;
end;

function TSM.EST_DP_R_MOVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql: String;
  ListaCodGrupo:TStrings;
  i:Integer;

begin


   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel - 15/10/2014 }


   // input[0] - Tipo do relatrio
      // 1 - Relatrio Geral
      // 2 - Relatrio por Almoxarifado
   // input[1]  - Data inicial
   // input[2]  - Data final
   // input[3]  - Empresa
   // input[4]  - Itens
   // input[5]  - Aloxarifado1
   // input[6]  - Cor
   // input[7]  - Tamanho
   // input[8]  - Tipo de Estoque
   // input[9]  - Grupo de esoque
   // input[10] - Fornecedor
   // input[11] - Classifiao

   EST_SQ_R_MOV.Close;
   EST_SQ_R_MOV.CommandText :=

       ' select ite.id_item, ite.descricao as int_nomeite, cor.id_cor, ' +
       '        cor.descricao as int_nomecor, tam.id_tamanho,          ' +
       '        tam.descricao as int_nometam, ite.id_grupo,            ' +
       '        gru.descricao as int_nomegrp, '+
       '        GR1.id_grupo as int_codgru_n1, '+
       '        GR1.descricao as int_descgru_n1, '+
       '        GR2.id_grupo as int_codgru_n2,  '+
       '        GR2.descricao as int_descgru_n2,  '+
       '        ite.id_und_venda as int_undven , ' +
       '        ite.id_fornecedor, ite.cod_barra, ite.cod_fabrica,     ' +
       '        alm.id_almoxarifado, alm.descricao as int_nomealm , par.id_empresa, ' +
       '        par.emp_razao as int_nomeraz, par.emp_fantasia as int_nomefan,  ' +
       '        ite.loca_rua, ite.loca_prateleira, ite.loca_escaninho,  ' +
       '        cast(ite.loca_rua||ite.loca_prateleira||ite.loca_escaninho as varchar(8)) as int_loc_rua_prat_esc, ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';

       if Input[9] <> '' then
          begin
            EST_SQ_R_MOV.CommandText :=
              EST_SQ_R_MOV.CommandText +
              ' fea.id_tipo_mov_estoque in (' + VarToStr(Input[9]) +') and ';
          end;
       EST_SQ_R_MOV.CommandText :=
             EST_SQ_R_MOV.CommandText +

       '           tme.tipo_movimento = 0    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and                       ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) -        ' +
       '                                                               ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';
       if Input[9] <> '' then
          begin
            EST_SQ_R_MOV.CommandText :=
              EST_SQ_R_MOV.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[9]) +') and ';
          end;
       EST_SQ_R_MOV.CommandText :=
             EST_SQ_R_MOV.CommandText +

       '           tme.tipo_movimento = 1    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and   ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as saldo_anterior, ' +
       '                                                               ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[9] <> '' then
          begin
            EST_SQ_R_MOV.CommandText :=
              EST_SQ_R_MOV.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[9]) +') and ';
          end;
       EST_SQ_R_MOV.CommandText :=
             EST_SQ_R_MOV.CommandText +

       '           tme.tipo_movimento = 0     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_entradas,  ' +
       '                                                               ' +
       '   (select COALESCE(sum(fea.qtde),0)                           ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[9] <> '' then
          begin
            EST_SQ_R_MOV.CommandText :=
              EST_SQ_R_MOV.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[9]) +') and ';
          end;
       EST_SQ_R_MOV.CommandText :=
             EST_SQ_R_MOV.CommandText +
       '           tme.tipo_movimento = 1     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                   ''' and ' +
       '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_saidas, ' +
       '    ' +
       '    (select COALESCE(fes.vlr_custo_medio,0) ' +
       '     from est_tb_m_fes fes                                     ' +
       '     where fes.id_empresa = par.id_empresa and                 ' +
       '           fes.id_item = ite.id_item  and                      ' +
       '           COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_medio,  ' +
       ' ' +
       '    (select COALESCE(fes.vlr_custo_ult_compra,0) ' +
       '     from est_tb_m_fes fes                                     ' +
       '     where fes.id_empresa = par.id_empresa and                 ' +
       '           fes.id_item = ite.id_item  and                      ' +
       '           COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_ult_compra  ' +
       ' ' +
       ' from cad_tb_c_ite ite                                         ' +
       ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)   '+
       ' LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
       '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

       ' LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
       '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' ';


      if Input[3] = '' then
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_par par on (par.id_empresa > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV.CommandText  := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_par par on (par.id_empresa in ('+VarToStr(Input[3])+')) ';
         end;

      if Input[5] = '' then
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV.CommandText  := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado in ('+VarToStr(Input[5])+')) ';
         end;

      if Input[6] = '' then
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV.CommandText  := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor in ('+VarToStr(Input[6])+')) ';
         end;

      if Input[7] = '' then
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho > 0 ) ';
         end
      else
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho in ('+ VarToStr(Input[7])+')) ';
         end;

      if Input[13] <> '' then
         begin
            EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText +
            ' LEFT OUTER JOIN est_tb_m_mal mal ON mal.id_almoxarifado=alm.id_almoxarifado '+
            ' LEFT OUTER JOIN est_tb_m_mal_ite mit ON (mit.id_mal=mal.id_mal '+
            '  and mit.id_item=ite.id_item '+
            '  and mit.id_cor=cor.id_cor '+
            '  and mit.id_tamanho=tam.id_tamanho ) ';
         end;

   // input[1]  - Data inicial
   // input[2]  - Data final
   // input[3]  - Empresa
   // input[4]  - Itens
   // input[5]  - Aloxarifado1
   // input[6]  - Cor
   // input[7]  - Tamanho
   // input[8]  - Tipo do item
   // input[9]  - Tipo de Estoque
   // input[10] - Grupo de esoque
   // input[11] - Fornecedor
   // input[12] - Classifiao

   EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' where 1 = 1 ';

   if Input[13] <> '' then
    begin
      EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' and mal.id_ccusto in ('+VarToStr(Input[13])+') ';
    end;

   EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText +
           ' and exists         ' +
            ' (select fea.id_empresa,fea.id_item,fea.id_almoxarifado,fea.id_cor,fea.id_tamanho           ' +
            '     from est_tb_m_fea fea ' +
            '     left outer join cad_tb_c_tme tme on ' +
            '       (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
            '   where fea.id_empresa = par.id_empresa and ' +
            '         fea.id_item = ite.id_item       and ' +
            '         fea."data" >= ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                       ''' and ' +
            '         fea."data" <= ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                       ''' and ' +
            '         COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
            '         COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
            '         COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0) and ' +
            '         tme.esto_movimenta = true       ' +
            '  group by fea.id_empresa,fea.id_item,fea.id_almoxarifado,fea.id_cor,fea.id_tamanho )  ' ;


   if Input[4] <> '' then
      begin
        EST_SQ_R_MOV.CommandText :=
          EST_SQ_R_MOV.CommandText +
          ' and ite.id_item in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[8] <> '' then
      begin
        EST_SQ_R_MOV.CommandText :=
          EST_SQ_R_MOV.CommandText +
          ' and gru.tipo_item = ''' + VarToStr(Input[8]) +''' ';
      end;

   if Input[9] <> '' then
      begin
         EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText +

            ' and ite.id_item in        ' +
            ' (select id_item           ' +
            '     from est_tb_m_fea fea ' +
            '     left outer join cad_tb_c_tme tme on ' +
            '       (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
            '   where fea.id_empresa = par.id_empresa and ' +
            '         fea.id_item = ite.id_item       and ' +
            '         fea.id_tipo_mov_estoque in (' + VarToStr(Input[9]) +') and '    +
            '         fea."data" >= ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +
                       ''' and ' +
            '         fea."data" <= ''' +
                       FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +
                       ''' and ' +
            '         COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
            '         COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
            '         COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0) and ' +
            '         tme.esto_movimenta = true       ' +
            '  group by id_item )                     ' ;
      end;

   if Input[10] <> '' then
      begin

        EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[10]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' OR ';
              end;

           EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' ) ';
      end;

   if Input[11] <> '' then
      begin
        EST_SQ_R_MOV.CommandText :=
          EST_SQ_R_MOV.CommandText +
              ' and ite.id_fornecedor in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[13] <> '' then
    begin
      EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText + ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,saldo_anterior ';
    end;

   if input[0] = 1 then // - Tipo do relatrio
      begin
         if Input[12] = 0 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, ite.id_item ';
            end
         else if Input[12] = 1 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, ite.descricao ';
            end
         else if Input[12] = 2 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, int_loc_rua_prat_esc ';
            end;
      end;

   if input[0] = 2 then // - Tipo do relatrio
      begin
         if Input[12] = 0 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, alm.id_almoxarifado, ite.id_item ';
            end
         else if Input[12] = 1 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, alm.id_almoxarifado, ite.descricao ';
            end
         else if Input[12] = 2 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, alm.id_almoxarifado, int_loc_rua_prat_esc ';
            end;
      end;

   if input[0] = 3 then // - Tipo do relatrio
      begin
         if Input[12] = 0 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa,int_nomegrp, ite.id_item ';
            end
         else if Input[12] = 1 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, int_nomegrp, ite.descricao ';
            end
         else if Input[12] = 2 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, int_nomegrp, int_loc_rua_prat_esc ';
            end;
      end;

   if input[0] = 5 then // - Tipo do relatrio
      begin
         if Input[12] = 0 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa,int_loc_rua_prat_esc, ite.id_item ';
            end
         else if Input[12] = 1 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, int_loc_rua_prat_esc, ite.descricao ';
            end
         else if Input[12] = 2 then
            begin
              EST_SQ_R_MOV.CommandText := EST_SQ_R_MOV.CommandText  +
                  ' order by par.id_empresa, int_loc_rua_prat_esc, int_loc_rua_prat_esc ';
            end;
      end;

   //CMServerForm.mm.Lines.Add(EST_SQ_R_MOV.CommandText);

   Result := EST_DP_R_MOV.Data;
end;

function TSM.EST_DP_R_MOV_SPRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  sql: String;
  ListaCodGrupo:TStrings;
  i:Integer;
begin

   { TODO -oLuan -cCriao : Mtodo criado por Luan - 22/12/2015 }

    //O Select implementado  semelhante ao do select do EST_DP_R_MOV, COM A DIFERENCA QUE NO FILTRA POR PERIODO E NO TEM SALDO ANTERIOR
   // input[0]  - Empresa
   // input[1]  - Itens
   // input[2]  - Almoxarifado
   // input[3]  - Cor
   // input[4]  - Tamanho
   // input[5]  - Tipo do item
   // input[6]  - Tipo de Estoque
   // input[7]  - Grupo de esoque
   // input[8] - Fornecedor
   // input[9] - Classificao

   EST_SQ_R_MOV_SPR.Close;
   EST_SQ_R_MOV_SPR.CommandText :=

       ' select ite.id_item, ite.descricao as int_nomeite, cor.id_cor, ' +
       '        cor.descricao as int_nomecor, tam.id_tamanho,          ' +
       '        tam.descricao as int_nometam, ite.id_grupo,            ' +
       '        GR1.id_grupo as int_codgru_n1, '+
       '        GR1.descricao as int_descgru_n1, '+
       '        GR2.id_grupo as int_codgru_n2,  '+
       '        GR2.descricao as int_descgru_n2,  '+
       '        gru.descricao as int_nomegrp, ite.id_und_venda as int_undven , ' +
       '        ite.id_fornecedor, ite.cod_barra, ite.cod_fabrica,     ' +
       '        alm.id_almoxarifado, alm.descricao as int_nomealm , par.id_empresa, ' +
       '        par.emp_razao as int_nomeraz, par.emp_fantasia as int_nomefan,  '+
       '        ite.loca_rua, ite.loca_prateleira, ite.loca_escaninho, ' +



       '   (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              ' fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
        EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +
       '           tme.tipo_movimento = 0    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[10])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and                       ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) -        ' +
       '                                                               ' +
       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item and                       ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
       EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +

       '           tme.tipo_movimento = 1    and                       ' +
       '           tme.esto_movimenta = true and                       ' +
       '           fea."data" < ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[10])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and         ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and   ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as saldo_anterior_per, ' +


       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
       EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +

       '           tme.tipo_movimento = 0     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[10])) )  +
                   ''' and ' +
       '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[11])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_entradas_per,  ' +


       '   (select COALESCE(sum(fea.qtde),0)                           ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
       EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +
       '           tme.tipo_movimento = 1     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           fea."data" >= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[10])) )  +
                   ''' and ' +
       '           fea."data" <= ''' +
                   FormatDateTime(CFormatoData, strToDate( VarToStr(Input[11])) )  +
                   ''' and ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_saidas_per, ' +



       '    (select COALESCE(sum(fea.qtde),0)                          ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
       EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +

       '           tme.tipo_movimento = 0     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and                 ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_entradas,  ' +
       '   (select COALESCE(sum(fea.qtde),0)                           ' +
       '     from est_tb_m_fea fea                                     ' +
       '          left outer join cad_tb_c_tme tme on                  ' +
       '                     (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
       '     where fea.id_empresa = par.id_empresa and                 ' +
       '           fea.id_item = ite.id_item  and                      ';
       if Input[6] <> '' then
          begin
            EST_SQ_R_MOV_SPR.CommandText :=
              EST_SQ_R_MOV_SPR.CommandText +
              '  fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and ';
          end;
       EST_SQ_R_MOV_SPR.CommandText :=
             EST_SQ_R_MOV_SPR.CommandText +
       '           tme.tipo_movimento = 1     and                      ' +
       '           tme.esto_movimenta = true  and                      ' +
       '           COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
       '           COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
       '           COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0)) as qtde_saidas, ' +
       '    ' +
       '    (select COALESCE(fes.vlr_custo_medio,0) ' +
       '     from est_tb_m_fes fes                                     ' +
       '     where fes.id_empresa = par.id_empresa and                 ' +
       '           fes.id_item = ite.id_item  and                      ' +
       '           COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_medio,  ' +
       ' ' +
       '    (select COALESCE(fes.vlr_custo_ult_compra,0) ' +
       '     from est_tb_m_fes fes                                     ' +
       '     where fes.id_empresa = par.id_empresa and                 ' +
       '           fes.id_item = ite.id_item  and                      ' +
       '           COALESCE(fes.id_cor,0) = COALESCE(cor.id_cor,0)    and                      ' +
       '           COALESCE(fes.id_tamanho,0) = COALESCE(tam.id_tamanho,0)) as vlr_custo_ult_compra  ' +
       ' ' +
       ' from cad_tb_c_ite ite                                         ' +
       ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)   '+
       ' LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
       '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

       ' LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
       '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' ';


      if Input[0] = '' then
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_par par on (par.id_empresa > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV_SPR.CommandText  := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_par par on (par.id_empresa in ('+VarToStr(Input[0])+')) ';
         end;

      if Input[2] = '' then
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV_SPR.CommandText  := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado in ('+VarToStr(Input[2])+')) ';
         end;

      if Input[3] = '' then
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor > 0 ) ';
         end
      else
         begin
           EST_SQ_R_MOV_SPR.CommandText  := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_cor cor on (cor.id_cor in ('+VarToStr(Input[3])+')) ';
         end;

      if Input[4] = '' then
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho > 0 ) ';
         end
      else
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' left outer join cad_tb_c_tam tam on (tam.id_tamanho in ('+ VarToStr(Input[4])+')) ';
         end;

      if Input[12] <> '' then
         begin
            EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText +
            ' LEFT OUTER JOIN est_tb_m_mal mal ON mal.id_almoxarifado=alm.id_almoxarifado '+
            ' LEFT OUTER JOIN est_tb_m_mal_ite mit ON (mit.id_mal=mal.id_mal '+
            '  and mit.id_item=ite.id_item '+
            '  and mit.id_cor=cor.id_cor '+
            '  and mit.id_tamanho=tam.id_tamanho ) ';
         end;

    // input[0]  - Empresa
   // input[1]  - Itens
   // input[2]  - Aloxarifado1
   // input[3]  - Cor
   // input[4]  - Tamanho
   // input[5]  - Tipo do item
   // input[6]  - Tipo de Estoque
   // input[7]  - Grupo de esoque
   // input[8] - Fornecedor
   // input[9] - Classificao

   EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' where 1 = 1 ';

    if Input[12] <> '' then
    begin
      EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' and mal.id_ccusto in ('+VarToStr(Input[12])+') ';
    end;

   EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText +
           ' and exists         ' +
            ' (select fea.id_empresa,fea.id_item,fea.id_almoxarifado,fea.id_cor,fea.id_tamanho           ' +
            '     from est_tb_m_fea fea ' +
            '     left outer join cad_tb_c_tme tme on ' +
            '       (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
            '   where fea.id_empresa = par.id_empresa and ' +
            '         fea.id_item = ite.id_item       and ' +
            '         COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
            '         COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
            '         COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0) and ' +
            '         tme.esto_movimenta = true       ' +
            '  group by fea.id_empresa,fea.id_item,fea.id_almoxarifado,fea.id_cor,fea.id_tamanho )  ' ;


   if Input[1] <> '' then
      begin
        EST_SQ_R_MOV_SPR.CommandText :=
          EST_SQ_R_MOV_SPR.CommandText +
          ' and ite.id_item in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[5] <> '' then
      begin
        EST_SQ_R_MOV_SPR.CommandText :=
          EST_SQ_R_MOV_SPR.CommandText +
          ' and gru.tipo_item = ''' + VarToStr(Input[5]) +''' ';
      end;

   if Input[6] <> '' then
      begin
         EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText +

            ' and ite.id_item in        ' +
            ' (select id_item           ' +
            '     from est_tb_m_fea fea ' +
            '     left outer join cad_tb_c_tme tme on ' +
            '       (tme.id_tipo_mov_estoque = fea.id_tipo_mov_estoque) ' +
            '   where fea.id_empresa = par.id_empresa and ' +
            '         fea.id_item = ite.id_item       and ' +
            '         fea.id_tipo_mov_estoque in (' + VarToStr(Input[6]) +') and '    +
            '         COALESCE(fea.id_cor,0) = COALESCE(cor.id_cor,0)   and          ' +
            '         COALESCE(fea.id_tamanho,0) = COALESCE(tam.id_tamanho,0) and    ' +
            '         COALESCE(fea.id_almoxarifado,0) = COALESCE(alm.id_almoxarifado,0) and ' +
            '         tme.esto_movimenta = true       ' +
            '  group by id_item )                     ' ;
      end;

   if Input[7] <> '' then
      begin
        EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[7]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' OR ';
              end;

           EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' ) ';

      end;

   if Input[8] <> '' then
      begin
        EST_SQ_R_MOV_SPR.CommandText :=
          EST_SQ_R_MOV_SPR.CommandText +
              ' and ite.id_fornecedor in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[12] <> '' then
    begin
      EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText + ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,saldo_anterior_per ';
    end;


   if Input[9] = 0 then
      begin
        EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
            ' order by par.id_empresa,int_nomegrp, ite.id_item ';
      end
   else if Input[9] = 1 then
      begin
        EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
            ' order by par.id_empresa, int_nomegrp, ite.descricao ';
      end
   else if Input[9] = 2 then
      begin
        EST_SQ_R_MOV_SPR.CommandText := EST_SQ_R_MOV_SPR.CommandText  +
            ' order by par.id_empresa, int_nomegrp, ite.loca_rua, ite.loca_prateleira, ite.loca_escaninho ';
      end;


   //CMServerForm.mm.Lines.Add(EST_SQ_R_MOV_SPR.CommandText);

   Result := EST_DP_R_MOV_SPR.Data;
end;

function TSM.EST_DP_R_PES_ALMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
   function enSqlPesAlm: String;
  begin
    Result :=
      ' select flm.id_empresa,par.emp_razao as int_emprazao, flm.id_item,ite.descricao as int_nomeite, '+
      ' ite.id_und_venda as int_undven,frn.id_fornecedor as int_codfor,frn.descricao as int_descfor, '+
      '  GR1.id_grupo as int_codgru_n1, '+
      '  GR1.descricao as int_descgru_n1, '+
      '  GR2.id_grupo as int_codgru_n2,  '+
      '  GR2.descricao as int_descgru_n2,  '+
      '  gru.id_grupo as int_codgru,gru.descricao as int_nomegru, '+
      ' flm.id_cor, cor.descricao as int_nomecor,flm.id_tamanho,tam.descricao as int_nometam, '+
      '   flm.id_almoxarifado,alm.descricao as int_descalm,flm.saldo_fisico,fes.vlr_custo_medio, '+

      ' (select max(fea.data) from est_tb_m_fea fea '+
      ' where fea.id_item = flm.id_item and fea.id_cor = flm.id_cor and fea.id_tamanho = flm.id_tamanho '+
      '     and fea.id_almoxarifado=flm.id_almoxarifado) as int_dta_ult_mov '+

      ' from est_tb_m_fes_alm flm '+
      ' left outer join est_tb_m_fes fes on ((fes.id_item=flm.id_item) and (fes.id_cor=flm.id_cor) and (fes.id_tamanho=flm.id_tamanho)) '+
      ' left outer join cad_tb_c_ite ite on ite.id_item=flm.id_item  '+
      ' left outer join cad_tb_c_cor cor on cor.id_cor=flm.id_cor  '+
      ' left outer join cad_tb_c_tam tam on tam.id_tamanho=flm.id_tamanho '+
      ' left outer join cad_tb_c_alm alm on alm.id_almoxarifado=flm.id_almoxarifado '+
      ' left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo '+
      ' left outer join cad_tb_c_for frn on frn.id_fornecedor=ite.id_fornecedor '+
      ' left outer join cad_tb_c_par par on par.id_empresa=flm.id_empresa '+
      ' LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
      '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

      ' LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
      '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' '+
      ' where 1=1  AND GRU.TIPO_ITEM<>''09'' ';

  end;
  var
  i:integer;
  tipo_saldo,situacao_item:string;
  ListaCodGrupo:TStrings;
begin
   { TODO -oLuan : Criado no dia 01/07/2016 }
   EST_SQ_R_PES_ALM.Close;

   EST_SQ_R_PES_ALM.CommandText := enSqlPesAlm;


   if Input[1] <> '' then
      begin
        EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
              ' and flm.id_empresa in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
         EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[2]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText  +
                        ' (gru.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' OR ';
              end;

           EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' ) ';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
               ' and frn.id_fornecedor in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
          EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[4])) do
            begin
              tipo_saldo := copy(VarToStr(Input[4]),i,1);
               if tipo_saldo='0' then
                 begin
                 EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                          '  flm.saldo_fisico >0 ';
                 end;
                if tipo_saldo='1' then
                 begin
                 EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                           '  flm.saldo_fisico <0 ';
                 end;
                if tipo_saldo='2' then
                 begin
                 EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                            '  flm.saldo_fisico =0 ';
                 end;

                if i<Length(VarToStr(Input[4])) then
                   begin
                      EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' ) ';
      end;


    if Input[5] <> '' then
      begin
         EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[5])) do
            begin
               situacao_item := copy(VarToStr(Input[5]),i,1);
               if situacao_item='0' then
                 begin
                 EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                          '  ite.ativo = true ';
                 end;
                if situacao_item='1' then
                 begin
                 EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                           ' ite.ativo = false ';
                 end;

                if i<Length(VarToStr(Input[5])) then
                   begin
                      EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText + ' ) ';
      end;

   if Input[6] <> '' then
      begin
        EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
              ' and ite.id_item in (' + VarToStr(Input[6]) +')';
      end;


   EST_SQ_R_PES_ALM.CommandText := EST_SQ_R_PES_ALM.CommandText +
                                ' order by flm.id_empresa,int_codgru_n1,int_codgru_n2,int_codgru,int_descfor,flm.id_almoxarifado,int_nomeite ';


   Result := EST_DP_R_PES_ALM.Data;
   EST_SQ_R_PES_ALM.Close;
end;

function TSM.EST_DP_R_PES_ALM_PNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPesAlmPnd: String;
  begin
    Result :=
      ' select fes.id_empresa, par.emp_fantasia, fsm.id_almoxarifado, alm.descricao as int_nomealm, '+

      '           GR1.id_grupo as int_codgru_n1, '+
      '           GR1.descricao as int_descgru_n1, '+
      '           GR2.id_grupo as int_codgru_n2,  '+
      '           GR2.descricao as int_descgru_n2, '+

      ' ite.id_grupo,gru.descricao as int_nomegru, fes.id_item, ite.descricao as int_nomeite, ite.id_und_venda as int_undven, '+
      '  fes.id_cor, cor.descricao as int_nomecor, fes.id_tamanho, tam.descricao as int_nometam,fes.vlr_custo_medio, '+

      ' frn.id_fornecedor as int_codfor,frn.descricao as int_descfor, '+
      '  (select max(fea.data) from est_tb_m_fea fea '+
      ' where fea.id_item = fsm.id_item and fea.id_cor = fsm.id_cor and fea.id_tamanho = fsm.id_tamanho '+
      '     and fea.id_almoxarifado=fsm.id_almoxarifado) as int_dta_ult_mov, '+

      ' fes.saldo_fisico, coalesce(tpe.qtde_ped_pendente,0) as ped_qtde_pnd, coalesce(tre.qtde_req_pendente,0) as req_qtde_pnd, '+
      ' fes.saldo_fisico -( coalesce(tpe.qtde_ped_pendente,0) + coalesce(tre.qtde_req_pendente,0)) as sld_disponivel '+
      ' from est_tb_m_fes_alm fsm  '+
      ' left outer join est_tb_m_fes fes on (fes.id_empresa = fsm.id_empresa and '+
      '                 fes.id_item    = fsm.id_item    and  '+
      '		       fes.id_cor     = fsm.id_cor     and   '+
      '		       fes.id_tamanho = fsm.id_tamanho)      '+

      ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = fsm.id_almoxarifado) '+

      ' left outer join cad_tb_c_par par on (par.id_empresa = fes.id_empresa) '+
      ' left outer join cad_tb_c_ite ite on (ite.id_item    = fsm.id_item) '+
      ' left outer join cad_tb_c_for frn on (frn.id_fornecedor=ite.id_fornecedor) '+
      ' left outer join cad_tb_c_gru gru on (gru.id_grupo   = ite.id_grupo) '+
      ' left outer join cad_tb_c_cor cor on (cor.id_cor     = fsm.id_cor) '+
      ' left outer join cad_tb_c_tam tam on (tam.id_tamanho = fsm.id_tamanho) '+

      ' LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
      '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

      ' LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
      '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' '+

      ' left outer join '+
      '  (select ped.id_empresa, ped.id_almoxarifado, ipe.id_item, ipe.id_cor, ipe.id_tamanho, '+
      '   coalesce(sum(qtde),0) as qtde_ped_pendente from fat_tb_m_ped_ite ipe '+
      '      left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido) '+
      '   where  '+
      '     ped.situacao in (0,2) '+
     // '     and ped.situacao_aprovacao = 1 '+
      '     and ped.situacao_aprovacao <> 2 '+
      '   group by 1,2,3,4,5) tpe on (tpe.id_empresa = fes.id_empresa and '+
      '                               tpe.id_almoxarifado = fsm.id_almoxarifado and '+
      '                               tpe.id_item    = fsm.id_item    and '+
      '                               tpe.id_cor     = fsm.id_cor     and '+
      '                               tpe.id_tamanho = fsm.id_tamanho) '+

      ' left outer join '+
      '  (select opr.id_empresa, opr.id_almoxarifado, irq.id_item, irq.id_cor, irq.id_tamanho, '+
      '          coalesce(sum(irq.qtde),0) - coalesce(sum(irq.qtde_atendida),0) as qtde_req_pendente '+
      '   from pcp_tb_m_opr_req_ite irq '+
      '      left outer join pcp_tb_m_opr_req req on (req.id_opr     = irq.id_opr and '+
      '                                               req.id_opr_req = irq.id_opr_req) '+
      '      left outer join pcp_tb_m_opr opr     on (opr.id_opr  = req.id_opr) '+
      '   where '+
      '      opr.situacao in (0,1) '+
      '   group by 1,2,3,4,5) tre on (tre.id_empresa  = fes.id_empresa and '+
      '				      tre.id_almoxarifado = fsm.id_almoxarifado and '+
      '                               tre.id_item     = fsm.id_item    and '+
      '                               tre.id_cor      = fsm.id_cor     and '+
      '                               tre.id_tamanho  = fsm.id_tamanho)    '+
      ' where 1=1  AND GRU.TIPO_ITEM<>''09'' ';


  end;
  var
  i:integer;
  tipo_saldo,situacao_item:string;
  ListaCodGrupo:TStrings;
begin
   { TODO -oLuan : Criado no dia 04/08/2016 }
   EST_SQ_R_PES_ALM_PND.Close;

   EST_SQ_R_PES_ALM_PND.CommandText := enSqlPesAlmPnd;


   if Input[1] <> '' then
      begin
        EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
              ' and fsm.id_empresa in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[2]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText  +
                        ' (gru.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' OR ';
              end;

           EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' ) ';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
               ' and frn.id_fornecedor in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
          EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[4])) do
            begin
              tipo_saldo := copy(VarToStr(Input[4]),i,1);
               if tipo_saldo='0' then
                 begin
                 EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                          '  fsm.saldo_fisico >0 ';
                 end;
                if tipo_saldo='1' then
                 begin
                 EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                           '  fsm.saldo_fisico <0 ';
                 end;
                if tipo_saldo='2' then
                 begin
                 EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                            '  fsm.saldo_fisico =0 ';
                 end;

                if i<Length(VarToStr(Input[4])) then
                   begin
                      EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' ) ';
      end;


    if Input[5] <> '' then
      begin
          EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[5])) do
            begin
               situacao_item := copy(VarToStr(Input[5]),i,1);
               if situacao_item='0' then
                 begin
                 EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                          '  ite.ativo = true ';
                 end;
                if situacao_item='1' then
                 begin
                 EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                           ' ite.ativo = false ';
                 end;

                if i<Length(VarToStr(Input[5])) then
                   begin
                      EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText + ' ) ';
      end;

   if Input[6] <> '' then
      begin
        EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
              ' and ite.id_item in (' + VarToStr(Input[6]) +')';
      end;


        EST_SQ_R_PES_ALM_PND.CommandText := EST_SQ_R_PES_ALM_PND.CommandText +
                                ' order by 1,2,3,5,6 ,7,8,9,10 ';


   Result := EST_DP_R_PES_ALM_PND.Data;
   EST_SQ_R_PES_ALM_PND.Close;
end;

function TSM.EST_DP_R_PES_GERDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPesGer: String;
  begin
    Result :=
      ' select fes.id_empresa,par.emp_razao as int_emprazao,fes.id_item,ite.descricao as int_nomeite,ite.id_und_venda as int_undven, '+
      '           GR1.id_grupo as int_codgru_n1, '+
      '           GR1.descricao as int_descgru_n1, '+
      '           GR2.id_grupo as int_codgru_n2,  '+
      '           GR2.descricao as int_descgru_n2,  '+
      '  gru.id_grupo as int_codgru,gru.descricao as int_nomegru, '+
      ' fes.id_cor, cor.descricao as int_nomecor,fes.id_tamanho,tam.descricao as int_nometam, '+
      '   frn.id_fornecedor as int_codfor,frn.descricao as int_descfor,fes.saldo_fisico, '+
      ' coalesce(tpe.qtde_ped_pendente,0) as int_qtde_ped_pendente, ';
    if Input[5] = 0 then
       begin
         Result := result + ' fes.vlr_custo_medio as vlr_custo, ';
       end;

    if Input[5] = 1 then
       begin
         result := result + ' fes.vlr_custo_ult_compra as vlr_custo, ';
       end;

    result := result +
      '   fes.data_ult_movimento ' +
      ' from est_tb_m_fes fes  '+
      '   left outer join cad_tb_c_ite ite on ite.id_item=fes.id_item '+
      '   left outer join cad_tb_c_cor cor on cor.id_cor=fes.id_cor  '+
      '   left outer join cad_tb_c_tam tam on tam.id_tamanho=fes.id_tamanho '+
      '   left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo  '+
      '   left outer join cad_tb_c_for frn on frn.id_fornecedor=ite.id_fornecedor '+
      '   left outer join cad_tb_c_par par on par.id_empresa=fes.id_empresa  '+
      '     LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
      '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

      '     LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
      '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' '+

      '   left outer join '+
      '   (select ped.id_empresa, ipe.id_item, ipe.id_cor, ipe.id_tamanho, coalesce(sum(qtde),0) as qtde_ped_pendente from fat_tb_m_ped_ite ipe '+
      '       left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido) '+
      '    where '+
      '      ped.situacao in (0,2) '+
      '      and ped.situacao_aprovacao in (0,1) '+
      '    group by 1,2,3,4) tpe on (tpe.id_empresa = fes.id_empresa and '+
      '                              tpe.id_item    = fes.id_item    and '+
      '                              tpe.id_cor     = fes.id_cor     and '+
      '                              tpe.id_tamanho = fes.id_tamanho) '+

      ' WHERE 1=1  AND GRU.TIPO_ITEM<>''09'' ';

  end;
  var
  i:integer;
  tipo_saldo,situacao_item:string;
  ListaCodGrupo:TStrings;
begin
   { TODO -oLuan : Criado no dia 01/07/2016 }
   EST_SQ_R_PES_GER.Close;

   EST_SQ_R_PES_GER.CommandText := enSqlPesGer;


   if Input[1] <> '' then
      begin
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
              ' and fes.id_empresa in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[2]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' OR ';
              end;

           EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' ) ';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
               ' and frn.id_fornecedor in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
          EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[4])) do
            begin
              tipo_saldo := copy(VarToStr(Input[4]),i,1);
               if tipo_saldo='0' then
                 begin
                 EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                          '  fes.saldo_fisico >0 ';
                 end;
                if tipo_saldo='1' then
                 begin
                 EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                           '  fes.saldo_fisico <0 ';
                 end;
                if tipo_saldo='2' then
                 begin
                 EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                            '  fes.saldo_fisico =0 ';
                 end;

                if i<Length(VarToStr(Input[4])) then
                   begin
                      EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' ) ';
      end;

    if Input[6] <> '' then
      begin
          EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[6])) do
            begin
               situacao_item := copy(VarToStr(Input[6]),i,1);
               if situacao_item='0' then
                 begin
                 EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                          '  ite.ativo = true ';
                 end;
                if situacao_item='1' then
                 begin
                 EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                           ' ite.ativo = false ';
                 end;

                if i<Length(VarToStr(Input[6])) then
                   begin
                      EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText + ' ) ';
      end;

   if Input[7] <> '' then
      begin
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
              ' and ite.id_item in (' + VarToStr(Input[7]) +')';
      end;

   if  Input[0] = '0' then
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                                ' order by fes.id_empresa,int_codgru_n1,int_codgru_n2,int_codgru,int_descfor,int_nomeite ';
   if  Input[0] = '4' then
        EST_SQ_R_PES_GER.CommandText := EST_SQ_R_PES_GER.CommandText +
                                ' order by fes.id_empresa,int_nomeite ';


   Result := EST_DP_R_PES_GER.Data;
   EST_SQ_R_PES_GER.Close;
end;

function TSM.EST_DP_R_PES_GER_PNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPesGerPnd: String;
  begin
    Result :=
     ' select fes.id_empresa, par.emp_fantasia, '+
     '           GR1.id_grupo as int_codgru_n1, '+
     '           GR1.descricao as int_descgru_n1, '+
     '           GR2.id_grupo as int_codgru_n2,  '+
     '           GR2.descricao as int_descgru_n2,  '+
     ' ite.id_grupo,gru.descricao as int_nomegru, fes.id_item, ite.descricao as int_nomeite,ite.id_und_venda as int_undven, '+
     ' fes.id_cor, cor.descricao as int_nomecor, fes.id_tamanho, tam.descricao as int_nometam,fes.vlr_custo_medio, fes.data_ult_movimento, '+
     ' frn.id_fornecedor as int_codfor,frn.descricao as int_descfor, '+
     '  fes.saldo_fisico, coalesce(tpe.qtde_ped_pendente,0) as ped_qtde_pnd, coalesce(tre.qtde_req_pendente,0) as req_qtde_pnd, '+
     '  fes.saldo_fisico -( coalesce(tpe.qtde_ped_pendente,0) + coalesce(tre.qtde_req_pendente,0)) as sld_disponivel '+
     '  from est_tb_m_fes fes '+
     ' left outer join cad_tb_c_par par on (par.id_empresa = fes.id_empresa) '+
     ' left outer join cad_tb_c_ite ite on (ite.id_item    = fes.id_item) '+
     ' left outer join cad_tb_c_for frn on (frn.id_fornecedor = ite.id_fornecedor) '+
     ' left outer join cad_tb_c_gru gru on (gru.id_grupo   = ite.id_grupo) '+
     ' left outer join cad_tb_c_cor cor on (cor.id_cor     = fes.id_cor) '+
     ' left outer join cad_tb_c_tam tam on (tam.id_tamanho = fes.id_tamanho) '+

     ' LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
     '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

     ' LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
     '                                          GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' '+

     ' left outer join '+
     '   (select ped.id_empresa, ipe.id_item, ipe.id_cor, ipe.id_tamanho, coalesce(sum(qtde),0) as qtde_ped_pendente from fat_tb_m_ped_ite ipe '+
     '       left outer join fat_tb_m_ped ped on (ped.id_pedido = ipe.id_pedido) '+
     '    where '+
     '      ped.situacao in (2) '+
    // '      and ped.situacao_aprovacao = 1 '+
     '      and ped.situacao_aprovacao <> 2 '+
     '    group by 1,2,3,4) tpe on (tpe.id_empresa = fes.id_empresa and '+
     '                              tpe.id_item    = fes.id_item    and '+
     '                              tpe.id_cor     = fes.id_cor     and '+
     '                              tpe.id_tamanho = fes.id_tamanho) '+

     ' left outer join  '+
     '   (select opr.id_empresa, irq.id_item, irq.id_cor, irq.id_tamanho, '+
     '           coalesce(sum(irq.qtde),0) - coalesce(sum(irq.qtde_atendida),0) as qtde_req_pendente '+
     '    from pcp_tb_m_opr_req_ite irq  '+
     '       left outer join pcp_tb_m_opr_req req on (req.id_opr = irq.id_opr and '+
     '                                                req.id_opr_req = irq.id_opr_req) '+
     '       left outer join pcp_tb_m_opr opr on (opr.id_opr  = req.id_opr) '+
     '    where '+
     '       opr.situacao in (0,1) '+
     '    group by 1,2,3,4) tre on (tre.id_empresa = fes.id_empresa and '+
     '                              tre.id_item    = fes.id_item    and '+
     '                              tre.id_cor     = fes.id_cor     and '+
     '                              tre.id_tamanho = fes.id_tamanho) '+
     ' where 1=1   AND GRU.TIPO_ITEM<>''09'' ';

  end;
  var
  i:integer;
  tipo_saldo,situacao_item:string;
  ListaCodGrupo:TStrings;
begin
   { TODO -oLuan : Criado no dia 04/08/2016 }
   EST_SQ_R_PES_GER_PND.Close;

   EST_SQ_R_PES_GER_PND.CommandText := enSqlPesGerPnd;


   if Input[1] <> '' then
      begin
        EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
              ' and fes.id_empresa in (' + VarToStr(Input[1]) +')';
      end;

   if Input[2] <> '' then
      begin

        EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[2]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                       EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                       EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText  +
                        ' (gru.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  gru.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                      EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText  +
                        ' (gru.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                   EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText + ' OR ';
              end;

            EST_SQ_R_PES_GER_PND.CommandText :=  EST_SQ_R_PES_GER_PND.CommandText + ' ) ';
      end;

   if Input[3] <> '' then
      begin
        EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
               ' and frn.id_fornecedor in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
          EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[4])) do
            begin
              tipo_saldo := copy(VarToStr(Input[4]),i,1);
               if tipo_saldo='0' then
                 begin
                 EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                          '  fes.saldo_fisico >0 ';
                 end;
                if tipo_saldo='1' then
                 begin
                 EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                           '  fes.saldo_fisico <0 ';
                 end;
                if tipo_saldo='2' then
                 begin
                 EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                            '  fes.saldo_fisico =0 ';
                 end;

                if i<Length(VarToStr(Input[4])) then
                   begin
                      EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText + ' ) ';
      end;


   if Input[5] <> '' then
      begin
          EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText + ' and (';
         for I := 1 to Length(VarToStr(Input[5])) do
            begin
               situacao_item := copy(VarToStr(Input[5]),i,1);
               if situacao_item='0' then
                 begin
                 EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                          '  ite.ativo = true ';
                 end;
                if situacao_item='1' then
                 begin
                 EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                           ' ite.ativo = false ';
                 end;

                if i<Length(VarToStr(Input[5])) then
                   begin
                      EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +' or ';
                   end;
            end;
            EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText + ' ) ';
      end;

   if Input[6] <> '' then
      begin
        EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
              ' and ite.id_item in (' + VarToStr(Input[6]) +')';
      end;


        EST_SQ_R_PES_GER_PND.CommandText := EST_SQ_R_PES_GER_PND.CommandText +
                                ' order by 1,2,3,6  ,7,8,9,10 ';


   Result := EST_DP_R_PES_GER_PND.Data;
   EST_SQ_R_PES_GER_PND.Close;
end;

function TSM.CAD_DP_R_CNEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelCne: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_CNE  ';
  end;
begin
   CAD_SQ_R_CNE.Close;
   CAD_SQ_R_CNE.CommandText := enSqlRelCne + ' order by id_cne ';

   Result := CAD_DP_R_CNE.Data;

end;

function TSM.CAD_DP_R_CORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadCor: String;
  begin
    Result :=
             'select * from cad_tb_c_cor cor ';
  end;
begin

   CAD_SQ_R_COR.Close;
   CAD_SQ_R_COR.CommandText := enSqlRelCadCor + ' WHERE 1=1 ';

   CAD_SQ_R_COR.CommandText :=
          CAD_SQ_R_COR.CommandText + ' order by cor.descricao ';

   Result := CAD_DP_R_COR.Data;
end;



function TSM.CAD_DP_R_ECF_FPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlRelEcfFpg: String;
begin

  enSqlRelEcfFpg := '';

  enSqlRelEcfFpg :=
        'SELECT  ECF.*,                                    ' +
        '        EPG.ID_FORMA_PAG,                         ' +
        '        FPG.DESCRICAO AS INT_NOMEFPG              ' +
        '                                                  ' +
        '  FROM CAD_TB_C_ECF_FPG   EPG                     ' +
        '     left outer join CAD_TB_C_FPG FPG on          ' +
        '           (FPG.ID_FORMA_PAG =  EPG.ID_FORMA_PAG) ' +
        '     left outer join CAD_TB_C_ECF ECF on          ' +
        '           (ECF.ecf_serial_impressora =           ' +
        '            EPG.ecf_serial_impressora) ' +
        '  WHERE 1 = 1 ';

   CAD_SQ_R_ECF_FPG.Close;
   CAD_SQ_R_ECF_FPG.CommandText := enSqlRelEcfFpg;

   if Input[0] <> '' then
      begin
        CAD_SQ_R_ECF_FPG.CommandText :=
            CAD_SQ_R_ECF_FPG.CommandText +
               ' AND EPG.ecf_serial_impressora in (' + VarToStr(Input[0]) +')';
      end;

   CAD_SQ_R_ECF_FPG.CommandText :=
          CAD_SQ_R_ECF_FPG.CommandText + ' ORDER BY EPG.ECF_SERIAL_IMPRESSORA, INT_NOMEFPG ';

   Result := CAD_DP_R_ECF_FPG.Data;
end;

function TSM.CAD_DP_R_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadFor: String;
  begin
    Result :=
        ' select frn.id_fornecedor, ' +
        '    frn.descricao as raz_soc, frn.fantasia, ' +
        '    frn.tel_fixo, frn.tel_movel,            ' +
        '    frn.doc_cnpj, frn.doc_cpf,              ' +
        '    frn.doc_ie, frn.ativo, frn.transportadora ' +
        ' from cad_tb_c_for frn ';
  end;
begin

   CAD_SQ_R_FOR.Close;
   CAD_SQ_R_FOR.CommandText := enSqlRelCadFor + ' WHERE 1=1 ';

   if Input[0] <> '' then
      begin
        CAD_SQ_R_FOR.CommandText :=
            CAD_SQ_R_FOR.CommandText +
               ' and frn.ativo = ''' + VarToStr(Input[0]) +''' ';
      end;

   if Input[1] <> '' then
      begin
        CAD_SQ_R_FOR.CommandText :=
            CAD_SQ_R_FOR.CommandText +
               ' and frn.transportadora = ''' + VarToStr(Input[1]) +''' ';
      end;

   CAD_SQ_R_FOR.CommandText :=
          CAD_SQ_R_FOR.CommandText + ' order by frn.id_fornecedor ';

   Result := CAD_DP_R_FOR.Data;
end;

function TSM.CAD_DP_R_FPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadFpg: String;
  begin
    Result :=
             ' select fpg.* ,     ' +
             ' case doc_impresso  ' +
             '   when 0 then ''Nenhum'' ' +
             '   when 1 then ''Duplicata'' ' +
             '   when 2 then ''Promissria'' ' +
             '   when 3 then ''Carto'' ' +
             '   when 4 then ''Boleto'' ' +
             '   when 5 then ''Dinheiro'' ' +
             '   when 6 then ''Cheque'' ' +
             '   when 7 then ''Crdito'' ' +
             '   when 8 then ''PIX'' ' +
             ' else ''?????'' end as int_docimpresso,' +
             ' ' +
             ' case tipo_pagamento ' +
             '   when 0 then '' Vista'' ' +
             '   when 1 then ''A prazo'' ' +
             '   when 2 then ''Sem pagamento'' ' +
             ' else ''?????'' end as int_tipopgto ' +
             ' ' +
             ' from cad_tb_c_fpg fpg ';
  end;
begin

   CAD_SQ_R_FPG.Close;
   CAD_SQ_R_FPG.CommandText := enSqlRelCadFpg + ' WHERE 1=1 ';

   CAD_SQ_R_FPG.CommandText :=
          CAD_SQ_R_FPG.CommandText + ' order by fpg.descricao ';

   Result := CAD_DP_R_FPG.Data;
end;

function TSM.CAD_DP_R_FUNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelFun: String;
  begin
    Result :=
      'SELECT FUC.* , CID.NOME AS INT_NOMECID '+
      'FROM CAD_TB_C_FUN FUC '+
      'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=FUC.ID_CIDADE ';
  end;
begin
   CAD_SQ_R_FUN.Close;
   CAD_SQ_R_FUN.CommandText := enSqlRelFun + ' WHERE 1 = 1 ';
   if Input[0] <> '' then
      begin
         CAD_SQ_R_FUN.CommandText := CAD_SQ_R_FUN.CommandText +
             ' and FUC.ATIVO = ''' + VarToStr(Input[0]) +''' ';
      end;
   if Input[1] <> '' then
      begin
        CAD_SQ_R_FUN.CommandText :=
          CAD_SQ_R_FUN.CommandText +
          ' and fuc.id_cidade in (' + VarToStr(Input[1]) +') ';
      end;
   if Input[2] <> '' then
      begin
        CAD_SQ_R_FUN.CommandText :=
          CAD_SQ_R_FUN.CommandText +
          ' and fuc.id_funcionario in ' +
          '       ( select crg.id_funcionario from cad_tb_c_fun_crg crg ' +
          '         where  crg.id_funcionario = fuc.id_funcionario       ' +
          '           and  crg.id_cargo in (' + VarToStr(Input[2]) +'))  ';
      end;

   if Input[3] <> '' then
      begin
        CAD_SQ_R_FUN.CommandText :=
          CAD_SQ_R_FUN.CommandText +
          ' and fuc.id_funcionario in ' +
          '       ( select crf.id_funcionario from cad_tb_c_fun_crg crf ' +
          '            left outer join pcp_tb_c_crg crg on ' +
          '                 (crg.id_cargo = crf.id_cargo)  ' +
          '         where  crf.id_funcionario = fuc.id_funcionario       ' +
          '           and  crg.tipo in (' + VarToStr(Input[3]) +'))  ';
      end;

   CAD_SQ_R_FUN.CommandText :=
          CAD_SQ_R_FUN.CommandText + ' order by fuc.nome ';
   Result := CAD_DP_R_FUN.Data;
end;

function TSM.CAD_DP_R_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadGru: String;
  begin
    Result :=  ' select gru.* ' +
               '  from cad_tb_c_gru gru ' ;
  end;
begin

   // Parmetros
       //  0 - Cdigo do grupo

   CAD_SQ_R_GRU.Close;

   CAD_SQ_R_GRU.Close;
   CAD_SQ_R_GRU.CommandText := enSqlRelCadGru + ' WHERE 1=1 ';
   CAD_SQ_R_GRU.CommandText :=
          CAD_SQ_R_GRU.CommandText + ' order by id_grupo ';

   Result := CAD_DP_R_GRU.Data;
end;

function TSM.CAD_DP_R_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  var
    CAD_CD_C_PEC: TClientDataSet;
    Perf_FazCorrecao: Boolean;
    Perc_Correcao, Perc_Correcao_Aprazo: String;
    Operacao: Integer;
    sql: String;
    Perc_Corr_Prc_Prazo: String;
    enSqlRelIte,camposCat, camposPrecoFilial : String;
    ListaCodGrupo:TStrings;
    i:integer;
begin
   // parametros
   // 0 - ATIVO
   // 1 - GRUPO
   // 2 - FORNECEDOR
   // 3 - NCM
   // 4 - UND VENDA
   // 5 - LOCA_RUA
   // 6 - tipo
   // 7 - Order by
   // 8 - Perfil de preo
   // 9 - Perc_Corr_Prc_Prazo  (Do parmetros)
   // 10 - FAZ_CORR_PRECO_PERFIL  (Do parmetros)


   if Input[7]<>10 then
     begin
      camposCat := ' 0 as int_cod_cat, CAST('''' AS VARCHAR(60)) as int_desc_cat,  ';
     end
   else
     begin
      camposCat := ' cit.id_cat as int_cod_cat, cat.descricao as int_desc_cat,  ';
     end;

   if Input[15]='true' then
     begin
       if  input[16] = 'true' then
         begin
          sql := ' (case when gre.fator_corr_avista>0 then round(PRC.PRECO_AVISTA*cast(gre.fator_corr_avista as numeric(18,4)),2) else PRC.PRECO_AVISTA end) as  prc_avista,  '+
                   ' (case when gre.fator_corr_aprazo>0 then round(PRC.PRECO1*cast(gre.fator_corr_aprazo as numeric(18,4)),2) else PRC.PRECO1 end) as  prc_aprazo,  ';
         end
       else
         begin
          sql := ' PRC.PRECO_AVISTA as prc_avista,PRC.PRECO1 as prc_aprazo,  ';
         end;
     end
   else
     begin
       if  input[16] = 'true' then
         begin
           sql := ' (case when gre.fator_corr_avista>0 then round(ITE.PRECO_AVISTA/cast(gre.fator_corr_avista as numeric(18,4)),2) else ITE.PRECO_AVISTA end) as  prc_avista,  '+
                   ' (case when gre.fator_corr_aprazo>0 then round(ITE.PRECO_APRAZO/cast(gre.fator_corr_aprazo as numeric(18,4)),2) else ITE.PRECO_APRAZO end) as  prc_aprazo,  ';
         end
       else
         begin
           sql := '  ITE.PRECO_AVISTA as prc_avista, ITE.PRECO_APRAZO as prc_aprazo,  ';
         end;
     end;

  // sql := ' ITE.PRECO_AVISTA as prc_avista, ITE.PRECO_APRAZO as prc_aprazo, ';
   if input[8] <> '' then
      begin
         CAD_CD_C_PEC := TClientDataSet.Create(self);
         CAD_CD_C_PEC.SetProvider(CAD_DP_C_PEC);
         CAD_CD_C_PEC.Close;
         CAD_CD_C_PEC.Data :=
              CAD_CD_C_PEC.DataRequest(VarArrayOf([0, input[8]]));
         if not CAD_CD_C_PEC.IsEmpty then
            begin
              Perf_FazCorrecao      := input[10];
              if trim(CAD_CD_C_PEC.FieldByName('PER_CORRECAO').AsString) = '' then
                 Perc_Correcao      := '0'
              else
                 Perc_Correcao         := CAD_CD_C_PEC.FieldByName('PER_CORRECAO').AsString;

              if trim(CAD_CD_C_PEC.FieldByName('PER_CORRECAO_APRAZO').AsString) = '' then
                 Perc_Correcao_Aprazo  := '0'
              else
                 Perc_Correcao_Aprazo  := CAD_CD_C_PEC.FieldByName('PER_CORRECAO_APRAZO').AsString;

              Operacao   := CAD_CD_C_PEC.FieldByName('OPERACAO').AsInteger;

              if Perf_FazCorrecao then
                 begin
                    if StrToFloat(Perc_Correcao) > 0 then
                       begin
                         Perc_Correcao         := StringReplace(Perc_Correcao,'.','',[rfReplaceAll]);
                         Perc_Correcao         := StringReplace(Perc_Correcao,',','.',[rfReplaceAll]);

                         if Operacao = 0 then   // Operao de soma
                            begin
                              sql :=
                                   ' ITE.PRECO_AVISTA + ( (ITE.PRECO_AVISTA * ' + Perc_Correcao + ' ) / 100) AS PRC_AVISTA , ' ;
                            end;

                         if Operacao = 1 then  // Operao de subtrao
                            begin
                              sql :=
                                   ' ITE.PRECO_AVISTA - ( (ITE.PRECO_AVISTA * ' + Perc_Correcao + ') / 100) AS PRC_AVISTA , ' ;
                            end;
                       end
                    else
                       begin
                         sql :=  ' ITE.PRECO_AVISTA AS PRC_AVISTA, ';
                       end;

                    if StrToFloat(Perc_Correcao_Aprazo) > 0 then
                       begin
                         Perc_Correcao_Aprazo         := StringReplace(Perc_Correcao_Aprazo,'.','',[rfReplaceAll]);
                         Perc_Correcao_Aprazo         := StringReplace(Perc_Correcao_Aprazo,',','.',[rfReplaceAll]);

                         if Operacao = 0 then   // Operao de soma
                            begin
                              sql :=  sql +
                                      ' ITE.PRECO_APRAZO + ( (ITE.PRECO_APRAZO * ' + Perc_Correcao + ' ) / 100) AS PRC_APRAZO , '
                            end;

                         if Operacao = 1 then  // Operao de subtrao
                            begin
                              sql := sql +
                                   ' ITE.PRECO_APRAZO - ( (ITE.PRECO_APRAZO * ' + Perc_Correcao + ') / 100) AS PRC_APRAZO , ' ;
                            end;
                       end
                    else
                       begin
                         sql := sql + ' ITE.PRECO_APRAZO AS PRC_APRAZO, ';
                       end;
                 end
               else
                 begin
                   sql :=  ' ITE.PRECO_AVISTA AS PRC_AVISTA, ITE.PRECO_APRAZO AS PRC_APRAZO, ';
                 end;

              // Essa parte foi descontinuado devido implantao da Teresina Agrcola
              // pois o preo a prazo ir funcionar da mesma forma do preo  vista.
              // 03/12/2015

              {Perc_Corr_Prc_Prazo := input[9];

              if StrtoFloat(Perc_Corr_Prc_Prazo) > 0 then
                 begin
                   Perc_Corr_Prc_Prazo         := StringReplace(Perc_Corr_Prc_Prazo,'.','',[rfReplaceAll]);
                   Perc_Corr_Prc_Prazo         := StringReplace(Perc_Corr_Prc_Prazo,',','.',[rfReplaceAll]);

                   sql  := sql + ' ITE.PRECO_APRAZO + ( (ITE.PRECO_APRAZO * ' + Perc_Corr_Prc_Prazo + ') / 100) AS PRC_APRAZO , ' ;
                 end
              else
                 begin
                    sql := sql + ' ITE.PRECO_APRAZO AS PRC_APRAZO, ';
                 end; }
            end;
      end;


  enSqlRelIte :=

      ' select ' + sql + camposCat+' ite.*, '+
      '       loc.loca_rua as int_loca_rua,loc.loca_prateleira as int_loca_prateleira,loc.loca_escaninho as int_loca_escaninho, '+
      '       frn.fantasia as int_nomefan, '+
      '       frn.descricao as int_nomefor, '+
      '       gru.descricao as int_nomegru, '+
      '       gru.tipo_item as int_tipoIte, '+
      '       gru.cores as int_gru_cores, ' +
      '       ncm.descricao as int_nomencm, '+
      '       ncm.cest as int_cest, '+
      '   case '+
      '      when gru.tipo_item = '''+'00'+''' then '''+'Mercadoria para Revenda'+''' '+
      '      when gru.tipo_item = '''+'01'+''' then '''+'Materia prima'+''' '+
      '      when gru.tipo_item = '''+'02'+''' then '''+'Embalagem'+''' '+
      '      when gru.tipo_item = '''+'03'+''' then '''+'Produto em processo'+''' '+
      '      when gru.tipo_item = '''+'04'+''' then '''+'Produto Acabado'+''' '+
      '      when gru.tipo_item = '''+'05'+''' then '''+'Subproduto'+''' '+
      '      when gru.tipo_item = '''+'06'+''' then '''+'Produto Intermediario'+''' '+
      '      when gru.tipo_item = '''+'07'+''' then '''+'Material de Uso e consumo'+''' '+
      '      when gru.tipo_item = '''+'08'+''' then '''+'Ativo Imobilizado'+''' '+
      '      when gru.tipo_item = '''+'09'+''' then '''+'Servios'+''' '+
      '      when gru.tipo_item = '''+'10'+''' then '''+'Outros Insumos'+''' '+
      '      when gru.tipo_item = '''+'99'+''' then '''+'Outros'+''' '+
      '   end as int_nometip, '+
      ' coalesce(fes.saldo_fisico,0) as int_saldo, '+


      '    case '+
      '        when 0 = ''' + VarToStr(Input[13]) + ''' then  fes.vlr_custo_medio'+
      '    else ' +
      '        (select max(nii.vlr_custo) from fat_tb_m_nfe_ite nii' +
      '         where nii.id_fiscal in (' + #13#10 +
      '		   select max(nfi.id_fiscal) from fat_tb_m_nfe_ite nfi' +
      '		   left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' +
      '		   where nfe.tipo_nf = ''E''' ;

   if Input[11] <> '' then
      begin
         enSqlRelIte :=  enSqlRelIte +
             '     and nfe.id_empresa = ' + VarToStr(Input[11]);
      end;

   enSqlRelIte :=  enSqlRelIte +
               '     and nfi.id_item = ite.id_item ) ' +
               '       and nii.id_item = ite.id_item) ' +
               '    end as vlr_custo ' ;

   enSqlRelIte :=  enSqlRelIte +
      ' from cad_tb_c_ite ite '+
      ' left outer join cad_tb_c_ite_loc loc on (loc.id_item=ite.id_item and loc.id_empresa='''+VarToStr(Input[11])+''') '+
      ' left outer join cad_tb_c_for frn on (frn.id_fornecedor = ite.id_fornecedor) '+
      ' left outer join  '+
      '    ( select gru.id_grupo, gru.descricao,gru.tipo_item, ' +
      '      cast(coalesce(string_agg(cor.descricao, '' - '' ),'' Consultar a fbrica'') as varchar(100) ) as cores  from cad_tb_c_gru gru ' +
      '          left outer join cad_tb_c_gru_cor gcr on gcr.id_grupo = gru.id_grupo ' +
			'					 left outer join cad_tb_c_cor cor on cor.id_cor = gcr.id_cor ' +
			'			 group by 1,2,3) gru on gru.id_grupo = ite.id_grupo ' +
      ' left outer join cad_tb_c_ncm ncm on (ncm.id_ncm=ite.id_ncm) ';

   if Input[7]=10 then
     begin
      enSqlRelIte :=  enSqlRelIte +
      ' LEFT OUTER JOIN cad_tb_c_ite_cat cit on cit.id_item=ite.id_item '+
      ' LEFT OUTER JOIN ofi_tb_c_cat cat on cat.id_cat=cit.id_cat       ';
     end;

  if Input[15]='true' then  //preco por filial
     begin
      enSqlRelIte :=  enSqlRelIte +
      ' LEFT OUTER JOIN cad_tb_c_ite_prc prc on prc.id_item=ite.id_item '+
      '                  and prc.id_perfil_cli=0 and prc.id_empresa='+VarToStr(Input[11]);
     end;

   enSqlRelIte :=  enSqlRelIte +
      ' left outer join est_tb_m_fes fes on '+
      '   fes.id_item = ite.id_item and fes.id_empresa= '+VarToStr(Input[11])+
      ' and fes.id_cor=0 and fes.id_tamanho=0 ';


   CAD_SQ_R_ITE.Close;
   CAD_SQ_R_ITE.CommandText := enSqlRelIte + ' WHERE 1=1 ';

   if ((Input[7] = 10) OR (Input[7] = 11))  then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and GRU.TIPO_ITEM=''09'' ';
      end;


   if Input[0]  <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.ativo in (' + VarToStr(Input[0]) +') ';
      end;

  { if Input[1]  <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.id_grupo in (' + VarToStr(Input[1]) +') ';
      end;  }

   if Input[1] <> '' then
      begin
         CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[1]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                       CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText   +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                       CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText   +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                      CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText   +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                   CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText  + ' OR ';
              end;

            CAD_SQ_R_ITE.CommandText  :=  CAD_SQ_R_ITE.CommandText  + ' ) ';
      end;


   if Input[2]  <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.id_fornecedor in (' + VarToStr(Input[2]) +') ';
      end;
   if Input[3] <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.id_ncm in (' + VarToStr(Input[3]) +') ';
      end;
   if Input[4] <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.id_und_venda in (' + VarToStr(Input[4]) +') ';
      end;
   if Input[5] <> '' then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and ite.loca_rua in (' + VarToStr(Input[5]) +') ';
      end;
   if ((Input[7]<>10) AND (Input[7]<>11) AND (Input[6] <> '')) then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' and gru.TIPO_ITEM in ('+VarToStr(Input[6])+') ';
      end;
   if Input[12] <> '' then
      begin
        if VarToStr(Input[12]) = '1' then
           begin
            CAD_SQ_R_ITE.CommandText :=
                   CAD_SQ_R_ITE.CommandText +
                ' and coalesce(fes.saldo_fisico,0) > 0 ';
           end;
        if VarToStr(Input[12]) = '2' then
           begin
            CAD_SQ_R_ITE.CommandText :=
                   CAD_SQ_R_ITE.CommandText +
                ' and coalesce(fes.saldo_fisico,0) < 0 ';
           end;
        if VarToStr(Input[12]) = '3' then
           begin
            CAD_SQ_R_ITE.CommandText :=
                   CAD_SQ_R_ITE.CommandText +
                ' and coalesce(fes.saldo_fisico,0) = 0 ';
           end;
      end;

   if Input[7]=10 then
     begin
        if VarToStr(Input[14]) <> '' then
           begin
            CAD_SQ_R_ITE.CommandText :=
                   CAD_SQ_R_ITE.CommandText +
                ' and cit.id_cat in ('+VarToStr(Input[14])+')';
           end;
     end;

   //Ordenao
   if Input[7] = 0 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_item ';
      end
   else if Input[7] = 1 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_grupo, ite.id_item ';
      end
   else if Input[7] = 2 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_grupo, ite.descricao ';
      end
   else if Input[7] = 3 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_fornecedor, ite.id_item ';
      end
   else if Input[7] = 4 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_fornecedor, ite.descricao  ';
      end
   else if Input[7] = 5 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_ncm, ite.id_item  ';
      end
   else if Input[7] = 6 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.id_ncm, ite.descricao  ';
      end
   else if Input[7] = 7 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by gru.tipo_item, ite.id_item  ';
      end
   else if Input[7] = 8 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by gru.tipo_item, ite.descricao  ';
      end
   else if Input[7] = 9 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by ite.descricao  ';
      end
    else if Input[7] = 10 then
      begin
        CAD_SQ_R_ITE.CommandText :=
          CAD_SQ_R_ITE.CommandText +
          ' order by cit.id_cat  ';
      end;


   //GerarSqlTxt(CAD_SQ_R_ITE);
   Result := CAD_DP_R_ITE.Data;

end;


function TSM.CAD_DP_R_ITE_PRC_FINDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 begin

   CAD_SQ_R_ITE_PRC_FIN.Close;
   CAD_SQ_R_ITE_PRC_FIN.CommandText := '';

   if Input[0] = 0 then
      begin
        CAD_SQ_R_ITE_PRC_FIN.CommandText :=

        ' select  ite.id_item, pec.descricao, '+
        ' (ite.preco_avista / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) AVista, '+
        ' (ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P30, '+
        ' ((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P60, '+
        ' (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P90, '+
        ' ((((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) )+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100))+ '+
        '    (((ite.preco_aprazo / (CASE fam.faz_corr_preco_perfil WHEN true THEN pec.per_correcao ELSE 1 END) ) * '+
        '    (COALESCE(pec.per_correcao_financeiro,0)))/100) P120 '+
        ' from cad_tb_c_ite ite  '+
        ' left outer join cad_tb_c_pec pec on 1=1 '+
        ' left outer join cad_tb_c_fam fam on fam.id_familia = ite.id_familia '+
        '  where 1=1 ';





        if VarToStr(Input[1]) = '' then
          BEGIN
            CAD_SQ_R_ITE_PRC_FIN.CommandText := CAD_SQ_R_ITE_PRC_FIN.CommandText +
                 ' AND 1=2 ';
          END
        ELSE
          BEGIN
            CAD_SQ_R_ITE_PRC_FIN.CommandText := CAD_SQ_R_ITE_PRC_FIN.CommandText +
                 ' and id_item = ''' + VarToStr(Input[1]) +''' ';
          END;

       if Input[2] <> '' then
          begin
             CAD_SQ_R_ITE_PRC_FIN.CommandText := CAD_SQ_R_ITE_PRC_FIN.CommandText +
                       ' and pec.id_perfil_cli = ''' + VarToStr(Input[2]) +''' ';
          end;
      end;
    Result := CAD_DP_R_ITE_PRC_FIN.Data;
end;

function TSM.CAD_DP_R_ITE_PRC_MNLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlItePrcMnl: String;
  begin
    Result :=
     ' SELECT PRC.*,PEC.DESCRICAO AS INT_DESC_PEC FROM CAD_TB_C_ITE_PRC PRC '+
     '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=PRC.ID_PERFIL_CLI '+
     ' where 1=1 ';
  end;
begin
   CAD_SQ_R_ITE_PRC_MNL.Close;
   CAD_SQ_R_ITE_PRC_MNL.CommandText := '';
   CAD_SQ_R_ITE_PRC_MNL.CommandText := enSqlItePrcMnl;

    if VarToStr(Input[1]) = '' then
          BEGIN
            CAD_SQ_R_ITE_PRC_MNL.CommandText := CAD_SQ_R_ITE_PRC_MNL.CommandText +
                 ' AND 1=2 ';
          END
        ELSE
          BEGIN
            CAD_SQ_R_ITE_PRC_MNL.CommandText := CAD_SQ_R_ITE_PRC_MNL.CommandText +
                 ' and prc.id_item = ''' + VarToStr(Input[1]) +''' ';
          END;

       if Input[2] <> '' then
          begin
             CAD_SQ_R_ITE_PRC_MNL.CommandText := CAD_SQ_R_ITE_PRC_MNL.CommandText +
                       ' and pec.id_perfil_cli = ''' + VarToStr(Input[2]) +''' ';
          end;
   Result := CAD_DP_R_ITE_PRC_MNL.Data;
end;

function TSM.CAD_DP_R_PCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelCadPct: String;
  begin
    Result :=
        'select pct.*, ' +
        'case pct.tipo ' +
        'when 0 then ''Analtico'' ' +
        'when 1 then ''Sinttico'' ' +
        'else ''?????'' end as int_tipo, ' +
        '   ' +
        'case pct.tipo_mov         ' +
        'when 0 then ''Fixa''      ' +
        'when 1 then ''Varivel''  ' +
        'else ''?????'' end as int_tipomov, ' +
        ' ' +
        'case pct.tipo_desp ' +
        'when 0 then ''Despesas''  ' +
        'when 1 then ''Receitas''  ' +
        'when 2 then ''Sem fluxo'' ' +
        'when 3 then ''Tributos''  ' +
        'when 4 then ''Resultado'' ' +
        'else ''?????'' end as int_tipodesp ' +

        'from cad_tb_c_pct pct' +
        ' order by id_plano ';
  end;
begin
  CAD_SQ_R_PCT.Close;
  Result := CAD_DP_R_PCT.Data;
end;

function TSM.CAD_DP_R_PESDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPes: String;
  begin
    Result := ' SELECT * FROM CAD_TB_C_PES WHERE 1 = 1  ';
  end;
begin
   CAD_SQ_R_PES.Close;
   CAD_SQ_R_PES.CommandText := enSqlRelPes;

   if Input[0]  <> '' then
      begin
        CAD_SQ_R_PES.CommandText := CAD_SQ_R_PES.CommandText +
          ' AND ID_PERFIL_SEG in (' + VarToStr(Input[0]) +') ';
      end;

   CAD_SQ_R_PES.CommandText := CAD_SQ_R_PES.CommandText +
                               ' ORDER BY ID_PERFIL_SEG ';

   Result := CAD_DP_R_PES.Data;
   CAD_SQ_R_PES.close;
end;

function TSM.CAD_DP_R_PRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadPrg: String;
  begin
    Result :=
      'select prg.*,                      ' +
      '  case prg.tipo ' +
      '    when 0 then ''Formulrio'' '     +
      '    when 1 then ''Relatrio''  '     +
      '  else ''?????'' end as int_tipo,  ' +
      ' ' +
      '    case modulo                            ' +
      '      when ''0'' then  ''CAD - Cadastros''   ' +
      '      when ''1'' then  ''CMP - Compras'' '     +
      '      when ''2'' then  ''CSU - Consultas''   ' +
      '      when ''3'' then  ''EST - Estoque'' '     +
      '      when ''4'' then  ''FAT - Faturamento'' ' +
      '      when ''5'' then  ''FIN - Financeiro''  ' +
      '      when ''6'' then  ''OFI - Oficina'' '     +
      '      when ''7'' then  ''SEG - Segurana''   ' +
      '      when ''8'' then  ''SGQ - Gesto de Qualidade'' ' +
      '      when ''9'' then  ''TAB - Tabelas'' ' +
      '    else ''????'' end as int_modulo '    +
      ' from CAD_TB_C_PRG PRG ';
  end;
begin
   CAD_SQ_R_PRG.Close;

   CAD_SQ_R_PRG.CommandText := enSqlRelCadPrg + ' WHERE 1=1 ';

   if Input[0]  <> '' then
      begin
        CAD_SQ_R_PRG.CommandText :=
          CAD_SQ_R_PRG.CommandText +
          ' and prg.modulo in (' + VarToStr(Input[0]) +') ';
      end;

   if Input[1]  <> '' then
      begin
        CAD_SQ_R_PRG.CommandText :=
          CAD_SQ_R_PRG.CommandText +
          ' and prg.tipo in (' + VarToStr(Input[1]) +') ';
      end;


   CAD_SQ_R_PRG.CommandText :=
          CAD_SQ_R_PRG.CommandText + ' order by prg.modulo, prg.descricao ';


   Result := CAD_DP_R_PRG.Data;
end;

function TSM.CAD_DP_R_TAMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelCadTam: String;
  begin
    Result :=
             'select * from cad_tb_c_tam tam ';
  end;
begin

   CAD_SQ_R_TAM.Close;
   CAD_SQ_R_TAM.CommandText := enSqlRelCadTam + ' WHERE 1=1 ';

   CAD_SQ_R_TAM.CommandText :=
          CAD_SQ_R_TAM.CommandText + ' order by tam.descricao ';

   Result := CAD_DP_R_TAM.Data;
end;

function TSM.CAD_DP_R_TMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelTme: String;
  begin
    Result :=
          ' SELECT TME.*, ' + #13#10 +
          '   cast(CASE tipo_movimento ' + #13#10 +
          '       when 0 then ''Entrada''' + #13#10 +
          '       when 1 then ''Sada''' + #13#10 +
          '   END as varchar(15)) AS int_desctipmov,' + #13#10 +
          '   cast( CASE  indicador' + #13#10 +
          '       when 0 then ''Normal''' + #13#10 +
          '       when 1 then ''Devoluo''' + #13#10 +
          '       when 2 then ''Transferncia''' + #13#10 +
          '   END as varchar(20)) AS int_descind,' + #13#10 +
          '    Nif.descricao AS INT_NOMEIPF,' + #13#10 +
          '    NiJ.descricao AS INT_NOMEIPJ,' + #13#10 +
          '    Nef.descricao AS INT_NOMEEPF,' + #13#10 +
          '    Nej.descricao AS INT_NOMEEPJ' + #13#10 +
          ' FROM CAD_TB_C_TME TME' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_CFO CIF ON CIF.id_cfo = tme.cfo_interno_pf' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_CFO CIJ ON CIJ.id_cfo = tme.cfo_interno_pj' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_CFO CEF ON CEF.id_cfo = tme.cfo_externo_pf' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_CFO CEJ ON CEJ.id_cfo = tme.cfo_externo_pj' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_NAT NIF ON NIF.ID_CLASSE = CIF.ID_CLASSE' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_NAT NIJ ON NIJ.ID_CLASSE = CIJ.ID_CLASSE' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_NAT NEF ON NEF.ID_CLASSE = CEF.ID_CLASSE' + #13#10 +
          ' LEFT OUTER JOIN CAD_TB_C_NAT NEJ ON NEJ.ID_CLASSE = CEJ.ID_CLASSE' + #13#10;

  end;
begin
   CAD_SQ_R_TME.Close;
   CAD_SQ_R_TME.CommandText := enSqlRelTme + ' WHERE 1 = 1 '  ;

    if input[0] <> '' then
      begin
        CAD_SQ_R_TME.CommandText := CAD_SQ_R_TME.CommandText +
               ' and TME.TIPO_MOVIMENTO in (' + VarToStr(Input[0]) +') ';
      end;

   if input[1] <> '' then
      begin
        CAD_SQ_R_TME.CommandText := CAD_SQ_R_TME.CommandText +
               ' and TME.INDICADOR in (' + VarToStr(Input[1]) +') ';
      end;

   if input[2] <> '' then
      begin
        CAD_SQ_R_TME.CommandText := CAD_SQ_R_TME.CommandText +
               ' and TME.ativo = ''' + VarToStr(Input[2]) +''' ';
      end;


   CAD_SQ_R_TME.CommandText := CAD_SQ_R_TME.CommandText + ' order by tme.descricao ';

   Result := CAD_DP_R_TME.Data;
   CAD_SQ_R_TME.Close;
end;

function TSM.CAD_DP_R_TRI_REGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelTri: String;
  begin
    Result :=
       ' select trg.*, ' +
       '   tme.descricao as int_nometme, ' +
       '   par.emp_fantasia as int_nomefan,  '+
       '   inf.descricao as int_nomeinf, ' +
       '   tri.descricao as int_nometri ' +
       '   ' +
       '   from CAD_TB_C_TRI_REG TRG ' +
       '     left outer join CAD_TB_C_TRI TRI on (TRI.ID_TRIBUTO = TRG.ID_TRIBUTO) ' +
       '     LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.id_tipo_mov_estoque = TRG.id_tipo_mov_estoque ' +
       '     LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA = TRG.ID_EMPRESA ' +
       '     LEFT OUTER JOIN CAD_TB_C_INF INF ON INF.ID_INF = TRG.ID_INF ';
  end;
begin
   CAD_SQ_R_TRI_REG.Close;
   CAD_SQ_R_TRI_REG.CommandText := enSqlRelTri + ' WHERE 1 = 1 '  ;

    if input[0] <> '' then
      begin
        CAD_SQ_R_TRI_REG.CommandText := CAD_SQ_R_TRI_REG.CommandText +
               ' and TRG.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
      end;

   if input[1] <> '' then
      begin
        CAD_SQ_R_TRI_REG.CommandText := CAD_SQ_R_TRI_REG.CommandText +
               ' and TRG.ID_TRIBUTO in (' + VarToStr(Input[1]) +') ';
      end;

   CAD_SQ_R_TRI_REG.CommandText := CAD_SQ_R_TRI_REG.CommandText + ' order by trg.id_empresa, trg.id_tributo ';

   Result := CAD_DP_R_TRI_REG.Data;
end;

function TSM.CAD_DP_R_VITDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlVit: String;
  begin
    Result :=
      ' Select cli.id_cliente as cod_cliente,vit.*, km.km_final,km.km_inicial, ' +
      '        cast(cli.nome as  varchar(30)) as int_nomecliente, '+
      '        cast(fun.nome as  varchar(30)) as int_nomevendedor , fun.id_funcionario, '+
      '        case tipo_mobile ' +
      '           when 1 then 0 ' +
      '        else coalesce(km_final,0) - coalesce(km_inicial,0) end km_rodado ' +
      ' from cad_tb_c_vit vit '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=vit.id_vendedor '+
      ' left outer join cad_tb_c_cli cli on cli.id_cliente=vit.id_cliente '+
      ' left outer join cad_tb_c_vit_kmt km on km.id_visita=vit.id_visita '+
      ' left outer join cad_tb_c_vei vei on vei.id_placa=vit.placa and vei.id_veiculo=vit.id_veiculo ';
  end;
begin
  CAD_SQ_R_VIT.Close;

  CAD_SQ_R_VIT.CommandText := enSqlVit +
   ' WHERE VIT.DTA_VISITA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
   ' AND VIT.DTA_VISITA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
   ' AND VIT.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';

  if Input[3] <> '' then
    begin
      CAD_SQ_R_VIT.CommandText := CAD_SQ_R_VIT.CommandText +
      ' AND VIT.PLACA = ''' + VarToStr(Input[3]) +''' ';
    end;

  if Input[4] <> '' then
    begin
      CAD_SQ_R_VIT.CommandText := CAD_SQ_R_VIT.CommandText +
      ' AND VIT.ID_VENDEDOR in (' + VarToStr(Input[4]) +') ';
    end;

  CAD_SQ_R_VIT.CommandText := CAD_SQ_R_VIT.CommandText +
    ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27 ';

  if Input[5] = 1 then
    CAD_SQ_R_VIT.CommandText := CAD_SQ_R_VIT.CommandText +
    ' ORDER BY VIT.PLACA, VIT.DTA_VISITA, VIT.HOR_INI'
  else
    CAD_SQ_R_VIT.CommandText := CAD_SQ_R_VIT.CommandText +
     ' ORDER BY int_nomevendedor, VIT.DTA_VISITA, VIT.HOR_INI';


  //CMServerForm.mm.Lines.Add(CAD_SQ_R_VIT.CommandText);
  Result := CAD_DP_R_VIT.Data;
end;

function TSM.EST_DP_M_CTEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlEstCte: String;
  begin
    Result :=
      'select cte.*, alm.descricao as int_nomealm '+
      'from est_tb_m_cte cte '+
      'left outer join cad_tb_c_alm alm on alm.id_almoxarifado=cte.id_almoxarifado ';
  end;
begin
   EST_SQ_M_CTE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           EST_SQ_M_CTE.CommandText := enSqlEstCte + ' WHERE 1=2 '
        else
           EST_SQ_M_CTE.CommandText := enSqlEstCte +
             ' WHERE CTE.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
             '   CTE.ID_CONTROLE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        EST_SQ_M_CTE.CommandText := enSqlEstCte +
          ' WHERE CTE.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   CTE.DTA_CONTAGEM = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else if Input[0] = 90 then
      begin
        if Input[1]<>'' then
          EST_SQ_M_CTE.CommandText := enSqlEstCte +
            ' WHERE CTE.ID_CONTROLE = ''' + VarToStr(Input[1])  +''' '
        else
           EST_SQ_M_CTE.CommandText := enSqlEstCte +
            ' WHERE 1=1 ';
      end
   else if Input[0] = 91 then
      begin
        EST_SQ_M_CTE.CommandText := enSqlEstCte +
          ' WHERE CTE.DTA_CONTAGEM = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ';
      end
   else if Input[0] = 92 then
      begin
        EST_SQ_M_CTE.CommandText := enSqlEstCte +
          ' WHERE CTE.STATUS = 0 AND '+
          ' CTE.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := EST_DP_M_CTE.Data;
end;

procedure TSM.EST_DP_M_CTEUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  status: Integer;
  cdsIte:TDataSet;
  msg,codControle:String;
begin
  status := 0;
  if DataSet.UpdateStatus in [usUnmodified] then
     begin
       DataSet.Next;
       if DataSet.UpdateStatus in [usModified] then
          begin
            if DataSet.FieldByName('status').Text <> '' then
               status := DataSet.FieldByName('status').AsInteger;

            DataSet.Prior;

            if status = 1 then
               begin
                 EST_RN_M_CTE.EST_DP_M_CTEUpdateData(DataSet,
                         BUS_DP_M_CTE_ITE_INT,
                         BUS_DP_M_CTE_RES_ITE_INT,
                         BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                         EST_DP_M_FES_ALM,EST_DP_M_LOT,Self);
               end;
          end
       else
          DataSet.Prior;
     end;

  if DataSet.UpdateStatus in [usInserted] then
     begin
        if (DataSet.FieldByName('offline').AsBoolean = true) then
          begin
            cdsIte := TDataSetField(Dataset.FieldByName('EST_SQ_M_CTE_ITE')).NestedDataSet;
            cdsIte.First;
            msg := '';
            while not cdsIte.Eof do
              begin
                 codControle := enVerifCteIteDup(
                    DataSet.FieldByName('id_empresa').AsString,
                    cdsIte.FieldByName('id_controle').AsString,
                    cdsIte.FieldByName('id_item').AsString,
                    cdsIte.FieldByName('id_cor').AsString,
                    cdsIte.FieldByName('id_tamanho').AsString);

                 if codControle<>'' then
                   begin
                     msg := msg +' N item '+cdsIte.FieldByName('id_item').AsString+' no pode ser inserido pois encontra-se numa contagem que est em aberto de n '+codControle+#13;
                   end;

                 cdsIte.Next;
              end;
            if msg<>'' then
              begin
                 raise Exception.Create(msg);
              end;
          end;
     end;
end;

function TSM.FAT_DP_M_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatNfe: String;
  begin
    Result :=
      'SELECT NFE.*, '+
      '   tme.descricao as int_nometme, '+
      '   cpg.descricao as int_nomecpg, '+
      '   vnd.nome as int_nomevnd, '+
      '   res.nome as int_nomeres, '+
      '   tra.descricao as int_nometra, '+
      '   tra.endereco as int_endtra, '+
      '   tra.bairro as int_baitra, ' +
      '   cit.nome as int_cidtra, '+
      '   cit.uf as int_esttra, '+
      '   tra.doc_cnpj as int_cnptra, '+
      '   tra.doc_ie as int_instra, '+
      '   par.emp_fantasia as int_nomeemp, ' +
      '   nat.descricao as int_descnat,  cfo.desc_nat_operacao_nfe as int_natope_nfe, ' +
      '   cast (case nfe_cod_sit ' +
      '      when ''00'' then ''Documento regular'' ' +
      '      when ''01'' then ''Escriturao extempornea de documento regular'' ' +
      '      when ''02'' then ''Documento cancelado'' ' +
      '      when ''03'' then ''Escriturao extempornea de documento cancelado'' ' +
      '      when ''04'' then ''NF-e denegada ou CT-e denegado'' ' +
      '      when ''05'' then ''NF-e ou CT-e com numerao inutilizada'' ' +
      '      when ''06'' then ''Documento fiscal complementar'' ' +
      '      when ''07'' then ''Escriturao extempornea de documento complementar'' ' +
      '      when ''08'' then ''Documento fiscal emitido com base em regime especial ou norma especfica'' ' +
      '    end as varchar(80) ) as int_descnfecodsit, ' +
      '   case '+
      '       when nfe.tipo_nf in (''E'',''D'',''F'')  then 0 '+
      '       when nfe.tipo_nf in (''S'',''R'') then CLI.ID_PERFIL_CLI end '+
      '   as INT_ID_PERFIL_CLI, '+
      '   cast( case '+
      '        when nfe.tipo_nf in (''E'',''D'',''F'') then fne.descricao  '+
      '        when nfe.tipo_nf in (''S'',''R'') then cli.nome  '+
      '   end as varchar(50) ) as INT_NOMEEMI,  '+
      '   case '+
      '      when nfe.nfe_ecf = 0 then '''+'NFE-e'+''' '+
      '      when nfe.nfe_ecf = 1 then '''+'ECF'+''' '+
      '      when nfe.nfe_ecf = 2 then '''+'NFC-e'+''' '+
      '      when nfe.nfe_ecf = 3 then '''+'NFS-e'+''' '+
      '   end as INT_NFEECF, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then '''+'Entrada'+''' '+
      '      when nfe.tipo_nf in (''S'',''R'') then '''+'Saidas'+''' '+
      '   end as INT_NOMEOPE, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.doc_cnpj '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.doc_cnpj_cpf '+
      '   end as INT_CNPJCPF, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then 0 '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.PESSOA '+
      '   end as INT_PESSOA, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.TEL_FIXO '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.TEL_FIXO '+
      '   end as INT_TELEFONE, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.DOC_IE '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.DOC_IE_IDENTIDADE '+
      '   end as INT_DOC_IE, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.EMAIL '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.EMAIL '+
      '   end as INT_EMAIL, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.CEP '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.CEP '+
      '   end as INT_CEP, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.ENDERECO '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.ENDERECO '+
      '   end as INT_ENDERECO, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then cif.uf '+
      '      when nfe.tipo_nf in (''S'',''R'') then cic.uf '+
      '   end as INT_ESTADO, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.BAIRRO '+
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.BAIRRO '+
      '   end as INT_BAIRRO, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.NUMERO '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.NUMERO '+
      '   end as INT_NUMERO, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.END_COMPLEMENTO '+
      '      when nfe.tipo_nf in (''S'',''R'') then CLI.END_COMPLEMENTO '+
      '   end as INT_COMPLEMENTO, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.ID_CIDADE '+
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.ID_CIDADE '+
      '   end as INT_COD_CIDADE, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then cif.nome '+
      '     when nfe.tipo_nf in (''S'',''R'') then cic.nome '+
      '   end as INT_NOM_CIDADE, '+
      '   case '+
      '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.cod_pais '+
      '      when nfe.tipo_nf in (''S'',''R'')then CLI.cod_pais '+
      '   end as INT_COD_PAIS, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then paf.descricao '+
      '     when nfe.tipo_nf in (''S'',''R'') then pac.descricao '+
      '   end as INT_NOM_PAIS, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then 1          ' +
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.TIPO_CLIENTE ' +
      '   end as INT_TIPOFINAL, '+
      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.CONTRIBUINTE          ' +
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.CONTRIBUINTE ' +
      '   end as INT_CONTRIBUINTE, '+

      '   case '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then ''''          ' +
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.DOC_IP ' +
      '   end as INT_DOC_IP, '+

      '  case  '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then  FNE.DOC_IM '+
      '     when nfe.tipo_nf in (''S'',''R'') then CLI.DOC_IM      '+
      '   end as INT_DOC_IM, '+


      '  case  '+
      '     when nfe.tipo_nf in (''S'',''R'') then  CLI.SUBSTITUTO_TRIBUTARIO  '+
      '     when nfe.tipo_nf in (''E'',''D'',''F'') then false                   '+
      '   end as INT_SUBSTITUTO_TRIBUTARIO,                                '+


      '   CPG.tipo_pagamento as int_indPag, '+
      '   cfo.id_classe as int_classe, ' +
      '   CCU.descricao as int_desc_ccu, '+
      '   false as int_selecao, '+
      '  cast (0 as numeric(18,2)) as int_tot_vlr_bruto, '+
      '  cast (0 as numeric(18,2)) as int_tot_vlr_liquido '+
      ' FROM FAT_TB_M_NFE NFE '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ID_EMITENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_FOR FNE ON FNE.ID_FORNECEDOR=ID_EMITENTE '+
      ' LEFT OUTER JOIN cad_tb_c_tme tme on tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque '+
      ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.id_condicao_pag=NFE.id_condicao_pag '+
      ' left outer join cad_tb_c_fun vnd on vnd.id_funcionario=nfe.id_vendedor '+
      ' left outer join cad_tb_c_fun res on res.id_funcionario=nfe.id_responsavel '+
      ' left outer join cad_tb_c_for tra on tra.id_fornecedor=NFE.id_transportadora '+
      ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
      ' left outer join cad_tb_c_cid cit on cit.id_cidade=tra.id_cidade '+
      ' left outer join cad_tb_c_cid cic on cic.id_cidade=cli.id_cidade '+
      ' left outer join cad_tb_c_cid cif on cif.id_cidade=fne.id_cidade '+
      ' left outer join cad_tb_c_pai pac on pac.id_pais=CLI.cod_pais ' +
      ' left outer join cad_tb_c_pai paf on paf.id_pais=fne.cod_pais ' +
      ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa ' +
      ' left outer join cad_tb_c_nat nat on cfo.id_classe = nat.id_classe '  +
      ' left outer join fin_tb_m_cxa cxa on cxa.id_abertura = nfe.id_abertura '+
      ' left outer join fat_tb_m_ped ped on ped.id_pedido = nfe.id_pedido_venda  '+
      ' left outer join cad_tb_c_ccu ccu on ccu.id_ccusto=nfe.id_ccusto ';
  end;


begin
   FAT_SQ_M_NFE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_NFE.CommandText := enSqlFatNfe + ' WHERE 1=2 '
        else
          begin
             FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
             ' WHERE NFE.ID_EMPRESA =''' + vartostr(Input[1]) +''' AND TIPO_NF=''' + Input[2] +
             ''' AND NFE.ID_FISCAL = ''' + vartostr(Input[3]) +''' ';
          end;
      end
   else if Input[0] = 1 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND TIPO_NF=''' + Input[2] +''' AND NFE.NUMERO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format(' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end
   else if Input[0] = 3 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format(' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND upper(FNE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end
   else if Input[0] = 4 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.NFE_COD_SIT = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.MODELO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.ID_TIPO_MOV_ESTOQUE = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 7 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.DTA_DOCUMENTO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )  +''' ';
      end
   else if Input[0] = 8 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )  +''' ';
      end
   else if Input[0] = 9 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND NFE.ID_PEDIDO_VENDA = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 10 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format('WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF=''' + Input[2] +''' AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end
   else if Input[0] = 11 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
              ' WHERE NFE.NFE_CHAVE = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 12 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
              ' WHERE NFE.ID_FISCAL = ''' + VarToStr(Input[1]) + ''' ';
      end
   else if Input[0] = 13 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
              ' WHERE NFE.ID_ORDEM = ''' + VarToStr(Input[1]) + ''' ';
      end
   else if Input[0] = 14 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
              ' WHERE NFE.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
              '       NFE.ecf_serial_impressora = ''' + VarToStr(Input[2]) + ''' AND ' +
              '       NFE.NUMERO in (' + VarToStr(Input[3]) + ') ';
      end
   else if Input[0] = 15 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE nfe.id_pedido_venda = '''+VarToStr(Input[1])+''' ' ;
      end
   else if Input[0] = 16 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE nfe.id_ors = '''+VarToStr(Input[1])+''' ' ;
      end
   else if Input[0] = 17 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND TIPO_NF IN ('+ Input[2] +') AND NFE.ID_FISCAL = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 18 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND TIPO_NF IN ('+ Input[2] +') AND NFE.NUMERO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 19 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format(' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end
   else if Input[0] = 20 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format(' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND upper(FNE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end
   else if Input[0] = 21 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.NFE_COD_SIT = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 22 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.MODELO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 23 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.ID_TIPO_MOV_ESTOQUE = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 24 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.DTA_DOCUMENTO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )  +''' ';
      end
   else if Input[0] = 25 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )  +''' ';
      end
   else if Input[0] = 26 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND NFE.ID_PEDIDO_VENDA = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 27 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          Format('WHERE NFE.ID_EMPRESA =''' + Input[1] +''' AND  TIPO_NF IN (' + Input[2] +') AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]);
      end

   else if Input[0] = 90 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1]))) +''' and  '+
          '       NFE.ID_EMPRESA =  ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' SELECT NUMERO, DTA_DOCUMENTO, ID_EMITENTE FROM FAT_TB_M_NFE '+
          ' WHERE TIPO_NF = '''+'E'+''' AND ID_FISCAL_FRETE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 92 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE TIPO_NF =''' + Input[1] +''' AND ID_EMITENTE = ''' + VarToStr(Input[2]) +''' ' +
          '   AND NFE.ID_EMPRESA = '''+ VarToStr(Input[3])+''' '+
          '   AND NFE.NUMERO > 0 ' +
          '   AND NFE.NFE_COD_SIT not in (''02'',''03'',''04'',''05'' )' +
          '   AND NFE.STATUS = 1 ';
      end
   else if Input[0] = 93 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
              ' WHERE NFE.ID_FISCAL <> '''  + VarToStr(Input[1]) + ''' '+
              ' AND NFE.NFE_CHAVE = ''' + VarToStr(Input[2]) + ''' ' +
              ' AND NFE.ID_EMPRESA = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 94 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ID_EMPRESA=''' + Input[1] +''' AND ID_EMITENTE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 95 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE TIPO_NF in (' + Input[1] + ')' +
          '   AND ID_EMITENTE = ''' + VarToStr(Input[2]) +''' '+
          '   AND NFE.STATUS = 1 ';
      end
   else if Input[0] = 96 then
      begin
        if input[1] = 0 then
           begin
             FAT_SQ_M_NFE.CommandText := enSqlFatNfe + ' WHERE 1 = 2 ';
           end;
        if input[1] = 1 then
           begin
              // Conversado com Mariel em 13/02/2015

              // Esta condio ir buscar todas as notas independente da data
              // Sendo assim o select ir trazer as notas:
              // grid de Notas fiscais ir mostrar as notas fiscais com os seguintes requisitos:
                 {  As notas da empresa logada AND
                    nota prpria da empresa (IND_EMITENTE = 0)  AND
                    nota fiscal com modelo 55 , 2D, ''(nota nova, no insert)
                    nota que est EM ABERTO (STATUS = 0) AND
                    nota com (ID_ABERTURA = 0  OR ID_ABERTURA = AO DO CAIXA(ID_ABERTURA) do dia AND
                    notas de ENTRADA, DEV. FORN, DEV. CLI e SADAS. (TIPO_NF = S, E, D e R)

                  Ou
                   As notas da empresa logada AND
                    nota prpria da empresa (IND_EMITENTE = 0)  AND
                    nota que est EM ABERTO (STATUS = 1) AND
                    nota fiscal com modelo 55 ou 2D AND
                    nota faturada pela a empresa (faturada = true AND
                    nota com DTA_EMISSAO = ao do dia AND
                    notas de ENTRADA, DEV. FORN, DEV. CLI e SADAS. (TIPO_NF = S, E, D e R)


                    Vale lembrar que na primeira condio as notas fiscais que teve problema de NMERO INUTILIZADO, o sitema mostrar tb.
                    Mas no ser pra toda vida, pois o usurio ter de decidir se reaproveita a nota fiscal ou
                    se EXCLUI a NF do sitema.
                  }
              FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ')' + {Busca notas Pendentes }
                '     AND NFE.MODELO in (''55'',''65'',''2D'','''') ' +
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                '     AND NFE.IND_EMITENTE = 0 '     +
                '     AND (NFE.ID_ABERTURA = 0 OR NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''') ' +
                '     AND NFE.STATUS  = 0 ) '   +
                '   OR ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
                '     AND NFE.IND_EMITENTE = 0 ' +
                '     AND NFE.MODELO in (''55'',''65'',''2D'','''') ' +
                '     AND NFE.FATURADA = true  ' +
                '     AND NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''' ' +
                '     AND NFE.STATUS = 1 ) ';
           end;
         if input[1] = 2 then
           begin
               FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ')' + {Busca notas Pendentes }
                '     AND NFE.MODELO in (''55'',''65'',''2D'','''') ' +
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                '     AND NFE.IND_EMITENTE = 0 '     +
                '     AND (NFE.ID_ABERTURA = 0 OR NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''') ' +
                '     AND NFE.STATUS  = 0  '   +
                '     AND NFE.ID_PEDIDO_VENDA = '''+VarToStr(Input[5])+''')'+
                '   OR ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
                '     AND NFE.IND_EMITENTE = 0 ' +
                '     AND NFE.MODELO in (''55'',''65'',''2D'','''') ' +
                '     AND NFE.FATURADA = true  ' +
                '     AND NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''' ' +
                '     AND NFE.STATUS = 1  '+
                '     AND NFE.ID_PEDIDO_VENDA = '''+VarToStr(Input[5])+''')';
           end;
        if input[1] = 3 then
           begin
               FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
                '     AND NFE.IND_EMITENTE = 0 ' +
                '     AND NFE.MODELO in (''55'') ' +
                '     AND NFE.FATURADA = true  ' +
                '     AND CXA.ID_FUNCIONARIO  = ''' + VarToStr(Input[4]) +''' ' +
                '     AND NFE.STATUS = 1 ) ';
           end;
         if input[1] = 4 then
           begin
               FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ')' + {Busca notas Pendentes }
                '     AND NFE.MODELO in (''55'','''') ' +
                '     AND NFE.TIPO_NF in (''S'') ' +
                '     AND NFE.IND_EMITENTE = 0 '     +
                '     AND (NFE.ID_ABERTURA = 0 OR NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''') ' +
                '     AND NFE.STATUS  = 0  '   +
                '     AND NFE.ID_PEDIDO_VENDA>0 AND PED.ENVIA_CARGA=TRUE ) '+
                '   OR ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
                '     AND NFE.TIPO_NF in (''S'')' +
                '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
                '     AND NFE.IND_EMITENTE = 0 ' +
                '     AND NFE.MODELO in (''55'','''') ' +
                '     AND NFE.FATURADA = true  ' +
                '     AND NFE.ID_ABERTURA  = ''' + VarToStr(Input[4]) +''' ' +
                '     AND NFE.STATUS = 1  '+
                '     AND NFE.ID_PEDIDO_VENDA>0 AND PED.ENVIA_CARGA=TRUE ) ';
           end;
         if input[1] = 5 then
            begin
               FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE ' +
                '   ( NFE.ID_EMPRESA  in (' + Input[2] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
                '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
                //   '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
                '     AND NFE.IND_EMITENTE = 0 ' +
                '     AND NFE.MODELO in (''55'') ' +
                '     AND NFE.FATURADA = true  ' +
                '     AND CXA.ID_FUNCIONARIO  = ''' + VarToStr(Input[4]) +''' ' +
                '     AND NFE.NUMERO  = ''' + VarToStr(Input[5]) +''' ' +
                '     AND NFE.STATUS = 1 ) ';
            end;
      end
   else if Input[0] = 97 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE NFE.TIPO_NF     = ''S'' ' +
          '   AND NFE.ID_EMPRESA  = '''     + VarToStr(Input[1]) + ''' ' +
          '   AND NFE.ID_EMITENTE = '''     + VarToStr(Input[2]) + ''' ' +
          '   AND NFE.POSVENDA   = FALSE' ;
      end
   else if Input[0] = 98 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE  NFE.ID_EMPRESA in (' + Input[1] + ')' +
          '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
          '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
          '   AND  NFE.NFE_ECF = 0 ' +
          '   AND  NFE.STATUS = 1 ';
      end
   else if Input[0] = 99 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE  NFE.ID_EMPRESA in (' + Input[1] + ')' +
          '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
          '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
          '   AND  NFE.NFE_ECF = 1 ' +
          '   AND  NFE.STATUS = 1 ';
      end
   else if Input[0] = 100 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE  NFE.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' ' +
               '   AND  NFE.TIPO_NF      = ''' + VarToStr(Input[2]) + ''' ' +
               '   AND  NFE.STATUS = 1 ';

        if Input[3] <> '' then
           begin
              FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
                '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

           end;
        if Input[5] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.ID_EMITENTE = ''' + VarToStr(Input[5]) + ''' ';
           end;

        if Input[6] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.NUMERO = ''' + VarToStr(Input[6]) + ''' ';
           end;

        if Input[7] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.SERIE <> ''' + VarToStr(Input[7]) + ''' ';
           end;
      end
   else if Input[0] = 101 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE nfe.tipo_nf = ''S'' ' +
               '   and nfe.status = 0 ' +
               '   and nfe.numero > 0 ' +
               //'   and nfe.dta_emissao < ''28/01/2016'' ' +
               '   and NFE.MODELO in (''55'',''65'',''2D'','''') ' +
               '   and nfe.nfe_cod_sit = ''00'' ';
      end
   else if Input[0] = 102 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE nfe.id_fiscal = '''+VarToStr(Input[1])+''' ' ;
      end
   else if Input[0] = 103 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE  NFE.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' ' +
               '   AND  NFE.TIPO_NF      = ''' + VarToStr(Input[2]) + ''' ' +
               '   AND  NFE.IND_EMITENTE = 0 '+
               '   AND  NFE.FATURADA = TRUE ';

        if Input[3] <> '' then
           begin
              FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
                '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

           end;
        if Input[5] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.ID_EMITENTE = ''' + VarToStr(Input[5]) + ''' ';
           end;

        if Input[6] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.NUMERO = ''' + VarToStr(Input[6]) + ''' ';
           end;
      end
   else if Input[0] = 104 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE NFE.TIPO_NF = ''S'' '+
                '  AND NFE.NFE_ECF = ''1'' '+
                '  AND NFE.MODELO =  ''2D'' ' +
                '  AND NFE.NUMERO > 0 '+
                '  AND NFE.STATUS = 1 '+
                '  AND NFE.NFE_COD_SIT <> ''02'' '+
                '  AND NFE.FATURADA = true  ' +
                '  AND NFE.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
                '  AND NFE.DTA_EMISSAO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
                '  AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
                '  ORDER BY NFE.DTA_EMISSAO DESC ' ;
      end
    else if Input[0] = 105 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
                ' WHERE NFE.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
                '  AND NFE.ID_FISCAL_REFERENCIADO = '''+VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 106 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '   ( NFE.ID_EMPRESA  in (' + Input[1] + ') ' +         {Busca notas faturadas sem erro, Faturadas ou Faturadas Canceladas }
          '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' )' +
          '     AND NFE.DTA_EMISSAO  = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2]))) + '''  '+
          '     AND NFE.CANC_DATA    = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + '''  '+
          '     AND NFE.IND_EMITENTE = 0 ' +
          '     AND NFE.MODELO in (''55'') ' +
          '     AND NFE.FATURADA = true  ' +
          '     AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ' +
          '     AND NFE.NFE_COD_SIT = ''02'' '+
          '     AND NFE.STATUS = 1 ) ';
      end
   else if Input[0] = 107 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA =''' + VarToStr(Input[1]) + ''' ' +
          '     AND NFE.NFE_ECF= ''0'' '+
          '     AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') '+
          '     AND NFE.STATUS = 1  ';

           if Input[2] = 0 then
              FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.NUMERO = ''' + VarToStr(Input[3]) + ''' ';
           if Input[2] = 1 then
              FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3]))) + ''' '+
                 ' AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[4])))+''' ';

      end
   else if Input[0] = 108 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA =''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.STATUS= ''1'' '+
          '    AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2]))) + ''' '+
          '    AND NFE.DTA_EMISSAO <= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])))+''' '+
          '    AND NFE.ID_EMITENTE = ''' + VarToStr(Input[4]) + ''' ';
      end
    else if Input[0] = 109 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.NFE_ECF = ''3'' '+
          '    AND NFE.SERIE   <> ''X'' '+
          '    AND NFE.NUMERO  = ''' + VarToStr(Input[2]) + ''' ';


      end
    else if Input[0] = 110 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.NFE_ECF = ''3'' '+
          '    AND NFE.SERIE   = ''X'' '+
          '    AND NFE.NUMERO  = ''' + VarToStr(Input[2]) + ''' ';
      end
   ///Filtros de 111 a 114 so utlizados para selecionar nota para gerao de outra nota complementar (EST_FM_M_NFS)
    else if Input[0] = 111 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.TIPO_NF = '''+  VarToStr(Input[2]) +''' '+
          '    AND NFE.ID_EMITENTE  = '''+VarToStr(Input[3]) +''' '+
          '    AND NFE.ID_FISCAL  = ''' + VarToStr(Input[4]) + ''' '+
          '    AND NFE.SERIE <> ''X''  AND NFE.NFE_FINALIDADE=''1'' '+
          '    AND NFE.NFE_ECF = ''0'' AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';

      end
   else if Input[0] = 112 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.TIPO_NF = '''+  VarToStr(Input[2]) +''' '+
          '    AND NFE.ID_EMITENTE  = '''+VarToStr(Input[3]) +''' '+
          '    AND NFE.NUMERO  = ''' + VarToStr(Input[4]) + ''' '+
          '    AND NFE.SERIE <> ''X''  AND NFE.NFE_FINALIDADE=''1'' '+
          '    AND NFE.NFE_ECF = ''0'' AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';
      end
    else if Input[0] = 113 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.TIPO_NF = '''+  VarToStr(Input[2]) +''' '+
          '    AND NFE.ID_EMITENTE  = '''+VarToStr(Input[3]) +''' '+
          '    AND NFE.DTA_EMISSAO  = ''' + VarToStr(Input[4]) + ''' '+
          '    AND NFE.SERIE <> ''X''  AND NFE.NFE_FINALIDADE=''1'' '+
          '    AND NFE.NFE_ECF = ''0'' AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';
      end
    else if Input[0] = 114 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.TIPO_NF = '''+  VarToStr(Input[2]) +''' '+
          '    AND NFE.ID_EMITENTE  = '''+VarToStr(Input[3]) +''' '+
          '    AND NFE.DTA_DOCUMENTO  = ''' + VarToStr(Input[4]) + ''' '+
          '    AND NFE.SERIE <> ''X''  AND NFE.NFE_FINALIDADE=''1'' '+
          '    AND NFE.NFE_ECF = ''0'' AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';
      end
   /////////FIM////////////////////////
   else if Input[0] = 115 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.ID_FISCAL_REF_COMP  = '''+VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 116 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.ID_ORDEM_GAR  = '''+VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 117 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
               ' WHERE  NFE.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' ' +
               '   AND  NFE.TIPO_NF      = ''' + VarToStr(Input[2]) + ''' ';

        if Input[3] <> '' then
           begin
              FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
                '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';

           end;
        if Input[5] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.ID_EMITENTE = ''' + VarToStr(Input[5]) + ''' ';
           end;

        if Input[6] <> '' then
           begin
             FAT_SQ_M_NFE.CommandText :=  FAT_SQ_M_NFE.CommandText +
                 ' AND NFE.NUMERO = ''' + VarToStr(Input[6]) + ''' ';
           end;
      end;

   if  Input[0] = 118 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND NFE.TIPO_NF = '''+  VarToStr(Input[2]) +''' '+
          '    AND NFE.ID_EMITENTE  = '''+VarToStr(Input[3]) +''' '+
          '    AND NFE.DTA_EMISSAO >= ''' + VarToStr(Input[4]) + ''' AND NFE.DTA_EMISSAO<= '''+VarToStr(Input[5])+''' '+
          '    AND NFE.SERIE <> ''X''  AND NFE.NFE_FINALIDADE=''1'' '+
          '    AND NFE.NFE_ECF = ''0'' AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';
      end;

    if  Input[0] = 119 then
      begin
        FAT_SQ_M_NFE.CommandText := enSqlFatNfe +
          ' WHERE ' +
          '    NFE.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' ' +
          '    AND (NFE.id_pedido_prod_1 = ''' +  VarToStr(Input[2]) + ''' '+
          '    or NFE.id_pedido_prod_2  = ''' + VarToStr(Input[3]) + ''' '+
          '    or NFE.id_pedido_prod_3  = ''' + VarToStr(Input[4]) + ''' '+
          '    or NFE.id_pedido_prod_4  = ''' + VarToStr(Input[5]) + ''' '+
          '    or NFE.id_pedido_prod_5  = ''' + VarToStr(Input[6]) + ''' ) '+
          '    AND NFE.STATUS= ''1'' AND NFE.NUMERO>0 AND ((NFE.FATURADA=TRUE) OR (NFE.FATURADA=FALSE AND NFE.TIPO_NF=''E''))  '+
          '    AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') ';
      end;

   // ORDER BY

   if (Input[0] <> '95') and (Input[0] <> '96') and (Input[0] <> '97') and (Input[0] <> '101')  and (Input[0] <> '104') then
    begin
      FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                                    ' ORDER BY DTA_DOCUMENTO DESC, ID_FISCAL DESC ';
    end;


   if Input[0] = 95 then
      begin
        FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                                    ' ORDER BY DTA_EMISSAO DESC, ID_FISCAL DESC ';
      end;

   if Input[0] = 96 then
      begin
        FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                                    ' ORDER BY DTA_EMISSAO DESC, ID_FISCAL DESC ';
      end;

   if Input[0] = 97 then
      begin
        FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                                    ' ORDER BY NFE.DTA_EMISSAO DESC, NFE.ID_FISCAL DESC ';
      end;
   if Input[0] = 101 then
      begin
        FAT_SQ_M_NFE.CommandText := FAT_SQ_M_NFE.CommandText +
                                    ' ORDER BY NFE.ID_FISCAL ';
      end;

  // CMServerForm.mm.Lines.Add(FAT_SQ_M_NFE.CommandText);
   //try
   Result := FAT_DP_M_NFE.Data;
   {   except
     on e: exception do
        begin
          CMServerForm.mm.Lines.Add('Erro no FAT_DP_M_NFE, Data: ' + DateToStr(date) + ' - ' + 'Hora: ' + TimeToStr(time) + ' -> ' + e.Message);
        end;
   end;}
   FAT_SQ_M_NFE.Close;
end;


procedure TSM.FAT_DP_M_NFEGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.GerFinEntrada(Sender: TObject; DataSet: TCustomClientDataSet;IdAbertura:integer;
                            NumeroNfe:String;DtaEmissaoNF: TDateTime;NFInutilizada:boolean; sm: TSM);
var
 cds:TDataSet;
 FIN_CD_M_PAG,FIN_CD_M_PAG_PAG,FIN_CD_M_CTA:TClientdataset;
 CAD_CD_C_FPG,FIN_CD_M_CXA,BUS_CD_C_PAR_CTR,BUS_CD_C_TIF:TClientdataset;
 xIdTitulo:Integer;
 xNumParcela,xNumParcelaAnt:String;
 xNewNumParcela:String;

 xIdFormaPag:integer;
 xIdPlano:String;
 xIdCCusto:Integer;
 xVlrTitulo:Currency;
 xDtaVencimento:TDateTime;
 xHistoricoPag: String;

 xChe_banco, xChe_agencia, xChe_emitente: String;
 xChe_conta, xChe_numero: String;

 xIdNfeTit: String;
begin
  //Procedimentos:
  //--------------------------------------
  //Gera Contas a Pagar



  FIN_CD_M_PAG    :=TClientDataSet.Create(self);
  FIN_CD_M_PAG_PAG    :=TClientDataSet.Create(self);
  FIN_CD_M_CTA    :=TClientDataSet.Create(self);

  FIN_CD_M_CXA    :=TClientDataSet.Create(self);
  CAD_CD_C_FPG    :=TClientDataSet.Create(self);

  BUS_CD_C_PAR_CTR    :=TClientDataSet.Create(self);
  BUS_CD_C_TIF        :=TClientDataSet.Create(self);


  FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
  FIN_CD_M_PAG.Close;
  FIN_CD_M_PAG.Data :=
  FIN_CD_M_PAG.DataRequest(VarArrayOf([90, Dataset.FieldByName('ID_FISCAL').AsString]));

  FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
  FIN_CD_M_PAG_PAG.Close;
  FIN_CD_M_PAG_PAG.Data :=
  FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([93, Dataset.FieldByName('ID_FISCAL').AsString]));

  FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
  FIN_CD_M_CTA.Close;
  FIN_CD_M_CTA.Data :=
  FIN_CD_M_CTA.DataRequest(VarArrayOf([96, Dataset.FieldByName('ID_FISCAL').AsString]));

  try
    if (not (dataset.UpdateStatus in [usDeleted])) and (NFInutilizada = false) then
       begin
         BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
         BUS_CD_C_PAR_CTR.Close;
         BUS_CD_C_PAR_CTR.Data :=
         BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([Dataset.FieldByName('ID_EMPRESA').AsString]));

         if BUS_CD_C_PAR_CTR.FieldByName('NFE_ID_TIPO_FINANCEIRO').AsString<>'' then
           begin
            BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
            BUS_CD_C_TIF.Close;
            BUS_CD_C_TIF.Data :=
            BUS_CD_C_TIF.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('NFE_ID_TIPO_FINANCEIRO').AsString]));
           end;

         FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
         FIN_CD_M_CXA.Close;
         FIN_CD_M_CXA.Data :=
         FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

         CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
         CAD_CD_C_FPG.Close;
         CAD_CD_C_FPG.Data :=
         CAD_CD_C_FPG.DataRequest(VarArrayOf([0,'']));

         cds:= TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_TIT')).NestedDataSet;



         while not (cds.Eof)  do
           begin
              xIdNfeTit      := cds.FieldByName('ID_NFE_TIT').AsString;
              xNumParcela    := cds.FieldByName('NUM_PARCELA').AsString;
              xNumParcelaAnt := cds.FieldByName('NUM_PARCELA').AsString;
              xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
              xIdPlano       := cds.FieldByName('ID_PLANO').AsString;
              xIdCCusto      := cds.FieldByName('ID_CCUSTO').AsInteger;
              xVlrTitulo     := cds.FieldByName('VLR_TITULO').AsCurrency;
              xDtaVencimento := cds.FieldByName('DTA_VENCIMENTO').AsDateTime;
              xHistoricoPag  := cds.FieldByName('HISTORICO_PAG').AsString;
              xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
              xHistoricoPag  := cds.FieldByName('HISTORICO_PAG').AsString;

              xChe_banco     := cds.FieldByName('che_banco').AsString;
              xChe_agencia   := cds.FieldByName('che_agencia').AsString;
              xChe_emitente  := cds.FieldByName('che_emitente').AsString;
              xChe_conta     := cds.FieldByName('che_conta').AsString;
              xChe_numero    := cds.FieldByName('che_numero').AsString;

             if cds.UpdateStatus in [usDeleted] then // Se o registro est com status de Deleo
                begin
                  if FIN_CD_M_PAG.Locate('NUM_PARCELA',xNumParcela,[]) then
                     begin
                       if FIN_CD_M_PAG_PAG.Locate('ID_FISCAL;ID_TITULO',varArrayOf([DataSet.FieldByName('ID_FISCAL').AsString,
                                                                                          FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]),[]) then
                         begin
                           FIN_CD_M_PAG_PAG.Delete;
                         end;

                       if FIN_CD_M_CTA.Locate('ID_FISCAL;ID_TITULO_PAG',varArrayOf([DataSet.FieldByName('ID_FISCAL').AsString,
                                                                                    FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]),[]) then
                         begin
                           FIN_CD_M_CTA.Delete;
                         end;
                       FIN_CD_M_PAG.Delete;
                     end;

                  if FIN_CD_M_CTA <> nil then
                    if FIN_CD_M_CTA.ChangeCount > 0 then
                      if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                         raise Exception.Create('Erro ao atualizar registro de movimento bancrio.');

                  if FIN_CD_M_PAG_PAG <> nil then
                    if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
                      if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                        raise Exception.Create('Erro ao atualizar registro de pagamento de contas a pagar.');

                  if FIN_CD_M_PAG <> nil then
                    if FIN_CD_M_PAG.ChangeCount > 0 then
                      if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                        raise Exception.Create('Erro ao atualizar registro de ttulo de contas a pagar.');
                end;

             if cds.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                begin
                  cds.Next;
                  if cds.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                     begin
                        if cds.FieldByName('ID_FORMA_PAG').AsInteger>0 then
                           xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
                        if cds.FieldByName('ID_PLANO').AsString<>'' then
                           xIdPlano       := cds.FieldByName('ID_PLANO').AsString;
                        if cds.FieldByName('ID_CCUSTO').AsInteger>0 then
                           xIdCCusto      := cds.FieldByName('ID_CCUSTO').AsInteger;
                        if cds.FieldByName('VLR_TITULO').AsCurrency>0 then
                           xVlrTitulo     := cds.FieldByName('VLR_TITULO').AsCurrency;
                        if not cds.FieldByName('DTA_VENCIMENTO').IsNull then
                           xDtaVencimento := cds.FieldByName('DTA_VENCIMENTO').AsDateTime;
                        if cds.FieldByName('ID_FORMA_PAG').AsInteger>0 then
                           xIdFormaPag    :=cds.FieldByName('ID_FORMA_PAG').AsInteger;
                        if cds.FieldByName('HISTORICO_PAG').AsString <> '' then
                           xHistoricoPag    :=cds.FieldByName('HISTORICO_PAG').AsString;
                        if cds.FieldByName('NUM_PARCELA').AsString <> '' then
                           xNumParcela    := cds.FieldByName('NUM_PARCELA').AsString;

                        if cds.FieldByName('che_banco').AsString <> '' then
                           xChe_banco     := cds.FieldByName('che_banco').AsString;

                        if cds.FieldByName('che_agencia').AsString <> '' then
                           xChe_agencia   := cds.FieldByName('che_agencia').AsString;

                        if cds.FieldByName('che_emitente').AsString <> '' then
                           xChe_emitente  := cds.FieldByName('che_emitente').AsString;

                        if cds.FieldByName('che_conta').AsString <> '' then
                           xChe_conta     := cds.FieldByName('che_conta').AsString;

                        if cds.FieldByName('che_numero').AsString <> '' then
                           xChe_numero    := cds.FieldByName('che_numero').AsString;


                        // Aqui ele deve procurar com o nro da parcela do registro original (anterior)
                        if FIN_CD_M_PAG.Locate('NUM_PARCELA',xNumParcelaAnt,[]) then
                           begin
                             CAD_CD_C_FPG.Locate('ID_FORMA_PAG',xIdFormaPag,[]);

                             FIN_CD_M_PAG.Edit;
                             FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger      := dataset.FieldByName('ID_EMPRESA').AsInteger;
                             FIN_CD_M_PAG.FieldByName('id_fiscal').AsInteger       := dataset.FieldByName('ID_FISCAL').AsInteger;
                             FIN_CD_M_PAG.FieldByName('id_plano').AsString         := xIdPlano;
                             FIN_CD_M_PAG.FieldByName('id_ccusto').AsInteger       := xIdCCusto;
                             FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := dataset.FieldByName('ID_EMITENTE').AsInteger;
                             FIN_CD_M_PAG.FieldByName('num_parcela').AsString      := xNumParcela;
                             FIN_CD_M_PAG.FieldByName('dta_emissao').AsDateTime    := dataset.FieldByName('DTA_EMISSAO').AsDateTime;
                             FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := xVlrTitulo;
                             FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := xVlrTitulo;

                             if ((CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5) AND
                                 (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0)) then
                               FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0
                             else
                               FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := xVlrTitulo;

                             FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := xDtaVencimento;
                             FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := xDtaVencimento;
                             if trim(xHistoricoPag) <> '' then
                                FIN_CD_M_PAG.FieldByName('historico').AsString     := xHistoricoPag
                             else
                                //FIN_CD_M_PAG.FieldByName('historico').AsString     := 'Gerado pela NF: ' + NumeroNfe;
                                FIN_CD_M_PAG.FieldByName('historico').AsString     := 'NF: ' + NumeroNfe;
                             // Origem
                             // 0 - estoque
                             // 1 - Caixa/Banco
                             FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 0;
                             FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := xIdFormaPag;
                             FIN_CD_M_PAG.FieldByName('id_local_titulo').AsString  := CAD_CD_C_FPG.FieldByName('id_local_titulo').AsString;
                             FIN_CD_M_PAG.FieldByName('per_juros').AsFloat         := 0;
                             FIN_CD_M_PAG.FieldByName('per_multa').AsFloat         := 0;
                             // 0 - Manual
                             // 1 - Automtica
                             FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;

                             FIN_CD_M_PAG.FieldByName('pre_conta').AsString      := xChe_conta;
                             FIN_CD_M_PAG.FieldByName('pre_cheque').AsString     := xChe_numero;
                             FIN_CD_M_PAG.FieldByName('pre_banco').AsString      := xChe_banco;
                             FIN_CD_M_PAG.FieldByName('pre_emitente').AsString   := xChe_emitente;
                             FIN_CD_M_PAG.FieldByName('pre_agencia').AsString    := xChe_agencia;

                             FIN_CD_M_PAG.Post;

                             if FIN_CD_M_PAG_PAG.Locate('ID_FISCAL;ID_TITULO',varArrayOf([DataSet.FieldByName('ID_FISCAL').AsString,
                                                                                          FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]),[]) then
                               begin
                                 FIN_CD_M_PAG_PAG.Delete;
                               end;

                             if FIN_CD_M_CTA.Locate('ID_FISCAL;ID_TITULO_PAG',varArrayOf([DataSet.FieldByName('ID_FISCAL').AsString,
                                                                                          FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]),[]) then
                               begin
                                 FIN_CD_M_CTA.Delete;
                               end;

                             if ((CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) AND
                                 (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [5])) then
                                begin
                                  FIN_CD_M_PAG_PAG.Insert;

                                  FIN_CD_M_PAG_PAG.FieldByName('ID_TITULO').AsInteger      :=
                                     FIN_CD_M_PAG.FieldByName('ID_TITULO').AsInteger;
                                  // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                  // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger       :=
                                       sm.enValorChave('FIN_TB_M_PBX');
                                     //dmApoio.enBusValorChave('FIN_TB_M_PBX');
                                  FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime :=
                                     FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency :=
                                     xVlrTitulo;
                                  FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat        := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency     := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency  := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString       :=
                                     'Ref. ao Tt: ' + cds.FieldByName('ID_NFE_TIT').AsString +
                                         ', da NF de Entrada: ' + NumeroNfe;

                                  FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger   :=
                                     xIdFormaPag;
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString        :=
                                     xIdPlano;

                                  FIN_CD_M_PAG_PAG.FieldByName('ID_RESPONSAVEL').AsInteger :=
                                      FIN_CD_M_CXA.FieldByName('id_funcionario').AsInteger;

                                  FIN_CD_M_PAG_PAG.FieldByName('ID_CCUSTO').AsInteger      :=
                                     CAD_CD_C_FPG.FieldByName('ID_CCUSTO').AsInteger;

                                  FIN_CD_M_PAG_PAG.FieldByName('ID_FISCAL').AsInteger      := DataSet.FieldByName('ID_FISCAL').AsInteger;
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger    := IdAbertura;


                                  FIN_CD_M_PAG_PAG.Post;
                                end;


                             if ((CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) AND
                                 (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [5]) AND
                                 (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean = true)) then
                                 begin
                                    FIN_CD_M_CTA.Insert;
                                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                    // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                    //FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := dmApoio.enBusValorChave('FIN_TB_M_CTA');
                                    FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := sm.enValorChave('FIN_TB_M_CTA');
                                    FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
                                    FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                                    FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                                    FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_emissao').AsDateTime;
                                    FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_emissao').AsDateTime;
                                    FIN_CD_M_CTA.FieldByName('num_doc').AsString             := xIdNfeTit;
                                    FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' + xIdNfeTit  + ', da NF de entrada: ' +
                                                                                                        NumeroNfe;

                                    FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := xVlrTitulo;
                                    FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 17; // 17-Nota Fiscal de Entrada
                                    FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                                    FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_TIF.FieldByName('id_tipo_financeiro').AsInteger;
                                    FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('NATUREZA').AsInteger;
                                    FIN_CD_M_CTA.FieldByName('id_plano').AsString            := xIdPlano;
                                    FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                                    FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := DataSet.FieldByName('ID_FISCAL').AsInteger;
                                    // Corresponde ao mesmo id_titulo do (FIN_TB_M_PAG) criado
                                    FIN_CD_M_CTA.FieldByName('id_titulo_pag').AsString      := xIdNfeTit;
                                    FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;

                                    // -------------------------------------------------------
                                    FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                                    FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                                    FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                                    FIN_CD_M_CTA.Post;
                                 end;

                           end;
                     end;
                end;
              if cds.UpdateStatus in [usInserted] then
                begin
                  CAD_CD_C_FPG.Locate('ID_FORMA_PAG',xIdFormaPag,[]);

                  FIN_CD_M_PAG.Insert;
                  FIN_CD_M_PAG.FieldByName('id_titulo').AsString        := xIdNfeTit;
                  FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger      := dataset.FieldByName('ID_EMPRESA').AsInteger;
                  FIN_CD_M_PAG.FieldByName('id_fiscal').AsInteger       := dataset.FieldByName('ID_FISCAL').AsInteger;
                  FIN_CD_M_PAG.FieldByName('id_plano').AsString         := xIdPlano;
                  FIN_CD_M_PAG.FieldByName('id_ccusto').AsInteger       := xIdCCusto;
                  FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := dataset.FieldByName('ID_EMITENTE').AsInteger;
                  FIN_CD_M_PAG.FieldByName('num_parcela').AsString      := xNumParcela;
                  FIN_CD_M_PAG.FieldByName('dta_lancamento').AsDateTime := date;
                  FIN_CD_M_PAG.FieldByName('dta_emissao').AsDateTime    := dataset.FieldByName('DTA_EMISSAO').AsDateTime;
                  FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := xVlrTitulo;
                  FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := xDtaVencimento;
                  FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := xDtaVencimento;
                  FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := xVlrTitulo;

                  if ((CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5) AND
                      (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0)) then
                      FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0
                  else
                      FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := xVlrTitulo;

                  if trim(xHistoricoPag) <> '' then
                     FIN_CD_M_PAG.FieldByName('historico').AsString     := xHistoricoPag
                  else
                     //FIN_CD_M_PAG.FieldByName('historico').AsString     := 'Gerado pela NF: ' + NumeroNfe;
                     FIN_CD_M_PAG.FieldByName('historico').AsString     := 'NF: ' + NumeroNfe;
                  // Origem
                  // 0 - estoque
                  // 1 - Caixa/Banco
                  FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 0;
                  FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := xIdFormaPag;
                  FIN_CD_M_PAG.FieldByName('id_local_titulo').AsString  := CAD_CD_C_FPG.FieldByName('id_local_titulo').AsString;
                  FIN_CD_M_PAG.FieldByName('per_juros').AsFloat         := 0;
                  FIN_CD_M_PAG.FieldByName('per_multa').AsFloat         := 0;
                  // 0 - Manual
                  // 1 - Automtica
                  FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;

                  FIN_CD_M_PAG.FieldByName('pre_conta').AsString      := xChe_conta;
                  FIN_CD_M_PAG.FieldByName('pre_cheque').AsString     := xChe_numero;
                  FIN_CD_M_PAG.FieldByName('pre_banco').AsString      := xChe_banco;
                  FIN_CD_M_PAG.FieldByName('pre_emitente').AsString   := xChe_emitente;
                  FIN_CD_M_PAG.FieldByName('pre_agencia').AsString    := xChe_agencia;

                  FIN_CD_M_PAG.Post;

                  if ((CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger  = 0) and
                     (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [5])) then
                    begin
                      FIN_CD_M_PAG_PAG.Insert;

                      FIN_CD_M_PAG_PAG.FieldByName('ID_TITULO').AsInteger      :=
                         cds.FieldByName('ID_NFE_TIT').AsInteger;
                      // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                      // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                      FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger       :=
                           sm.enValorChave('FIN_TB_M_PBX');
                         //DmApoio.enBusValorChave('FIN_TB_M_PBX');
                      FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime :=
                         FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                      FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency :=
                         xVlrTitulo;
                      FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat        := 0;
                      FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency     := 0;
                      FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency  := 0;
                      FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString       :=
                         'Ref. ao Tt: ' + cds.FieldByName('ID_NFE_TIT').AsString +
                             ', da NF de Entrada: ' + NumeroNfe;

                      FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger   :=
                         xIdFormaPag;
                      FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString        :=
                         xIdPlano;

                      FIN_CD_M_PAG_PAG.FieldByName('ID_RESPONSAVEL').AsInteger :=
                          FIN_CD_M_CXA.FieldByName('id_funcionario').AsInteger;

                      FIN_CD_M_PAG_PAG.FieldByName('ID_CCUSTO').AsInteger      :=
                         CAD_CD_C_FPG.FieldByName('ID_CCUSTO').AsInteger;

                      FIN_CD_M_PAG_PAG.FieldByName('ID_FISCAL').AsInteger      := DataSet.FieldByName('ID_FISCAL').AsInteger;
                      FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger    := IdAbertura;
                      FIN_CD_M_PAG_PAG.Post;
                    end;

                 if ((CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger  = 0) and
                     (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [5]) and
                     (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean = true)) then
                    begin
                      FIN_CD_M_CTA.Insert;
                      // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                      // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                      FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                           sm.enValorChave('FIN_TB_M_CTA');
                          //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                      FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
                      FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                      FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                      FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_emissao').AsDateTime;
                      FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_emissao').AsDateTime;
                      FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := cds.FieldByName('id_nfe_tit').AsInteger;
                      FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' + xIdNfeTit + ', da NF de sada: ' +
                                                                                                         NumeroNfe;


                      FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := xVlrTitulo;
                      FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 17; // 17-Nota Fiscal de Entrada
                      FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                      FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_TIF.FieldByName('id_tipo_financeiro').AsInteger;
                      FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('NATUREZA').AsInteger;
                      FIN_CD_M_CTA.FieldByName('id_plano').AsString            := xIdPlano;
                      FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                      FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := DataSet.FieldByName('ID_FISCAL').AsInteger;
                      // Corresponde ao mesmo id_titulo do (FIN_TB_M_PAG) criado
                      FIN_CD_M_CTA.FieldByName('id_titulo_pag').AsString      := xIdNfeTit;
                      FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger     := 0;
                      // -------------------------------------------------------
                      FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                      FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                      FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;

                      FIN_CD_M_CTA.Post;
                    end;
                end;
             cds.Next;
           end;
       end
    else
       begin
         if not (FIN_CD_M_PAG.IsEmpty) then
           begin
             FIN_CD_M_PAG.First;
             while not (FIN_CD_M_PAG.Eof)  do
               begin
                 if FIN_CD_M_PAG_PAG.Locate('ID_TITULO',FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString,[]) then
                   begin
                     FIN_CD_M_PAG_PAG.Delete;
                   end;

                 if FIN_CD_M_CTA.Locate('ID_TITULO_PAG',FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString,[]) then
                   begin
                     FIN_CD_M_CTA.Delete;
                   end;

                 FIN_CD_M_PAG.Delete;
               end;
           end;

         if FIN_CD_M_CTA <> nil then
          if FIN_CD_M_CTA.ChangeCount > 0 then
            if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
               raise Exception.Create('Erro ao atualizar registro de movimento bancrio.');

         if FIN_CD_M_PAG_PAG <> nil then
          if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
            if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
               raise Exception.Create('Erro ao atualizar registro de pagamento de contas a pagar.');

         if FIN_CD_M_PAG <> nil then
          if  FIN_CD_M_PAG.ChangeCount > 0 then
            if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
              raise Exception.Create('Erro ao atualizar registro de ttulo de contas a pagar.');

       end;

    if FIN_CD_M_PAG <> nil then
      if  FIN_CD_M_PAG.ChangeCount > 0 then
        if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
          raise Exception.Create('Erro ao atualizar registro de ttulo de contas a pagar.');

    if FIN_CD_M_PAG_PAG <> nil then
     if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
        if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
          raise Exception.Create('Erro ao atualizar registro de pagamento de contas a pagar.');

    if FIN_CD_M_CTA <> nil then
      if FIN_CD_M_CTA.ChangeCount > 0 then
        if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
           raise Exception.Create('Erro ao atualizar registro de movimento bancrio.');

  finally
    FIN_CD_M_PAG.Free;
    FIN_CD_M_PAG_PAG.Free;
    FIN_CD_M_CTA.Free;
    CAD_CD_C_FPG.Free;
    BUS_CD_C_PAR_CTR.Free;
    BUS_CD_C_TIF.Free;
  end;
end;



procedure TSM.AlterarDeletarTitOrv(Sender: TObject; DataSet: TCustomClientDataSet);
var
  BUS_CD_M_NFE,FIN_CD_M_REC:TClientDataSet;
  BUS_CD_C_FPG: TClientDataSet;
  i,j: Integer;
  FormaPagAnt,xListaCodFormaPag,xListaVlrFormaPag:String;
  ListaCodFormaPag,ListaVlrFormaPag:TStringList;
  valor,valor_parcela,valor_restante:Currency;
  status:Integer;
  HouveAlt: Boolean;
  QtdeReg: String;
begin

      TRY
       { BUS_CD_M_NFE := TClientDataSet.Create(nil);
        BUS_CD_M_NFE.SetProvider(BUS_DP_M_NFE_INT);
        BUS_CD_M_NFE.Close;
        BUS_CD_M_NFE.Data :=
        BUS_CD_M_NFE.DataRequest(VarArrayOf([90,DataSet.FieldByName('id_ordem').AsString]));}


        FIN_CD_M_REC := TClientDataSet.Create(nil);
        FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
        FIN_CD_M_REC.Close;
        FIN_CD_M_REC.Data :=
        FIN_CD_M_REC.DataRequest(VarArrayOf([94, DataSet.FieldByName('id_fiscal').AsString]));
        FormaPagAnt := '';
        valor := 0;
        xListaCodFormaPag := '';
        xListaVlrFormaPag := '';
        FIN_CD_M_REC.IndexFieldNames := 'ID_FORMA_PAG';
        FIN_CD_M_REC.First;
        while not (FIN_CD_M_REC.EOF) do
          begin
             if formaPagAnt <> FIN_CD_M_REC.FieldByName('ID_FORMA_PAG').AsString then
               begin
                 if xListaCodFormaPag <> '' then
                  begin
                   if xListaVlrFormaPag <> '' then
                     begin
                      xListaVlrFormaPag := xListaVlrFormaPag +';'+ CurrToStr(valor);
                     end
                   else
                     begin
                      xListaVlrFormaPag := CurrToStr(valor);
                     end;
                  end;

                 if xListaCodFormaPag <> '' then
                   begin
                     xListaCodFormaPag := xListaCodFormaPag +';'+ FIN_CD_M_REC.FieldByName('ID_FORMA_PAG').AsString;
                   end
                 else
                   begin
                    xListaCodFormaPag := FIN_CD_M_REC.FieldByName('ID_FORMA_PAG').AsString;
                   end;

                 formaPagAnt := FIN_CD_M_REC.FieldByName('ID_FORMA_PAG').AsString;
                 valor := 0;
               end;
             valor := valor + FIN_CD_M_REC.FieldByName('VLR_SALDO').AsCurrency;
             FIN_CD_M_REC.next;
          end;


        if xListaVlrFormaPag <> '' then
         begin
           xListaVlrFormaPag := xListaVlrFormaPag +';'+ CurrToStr(valor);
         end
        else
         begin
           xListaVlrFormaPag := CurrToStr(valor);
         end;


        ListaCodFormaPag := TStringList.Create;
        LIstaCodFormaPag.Delimiter:=';';
        LIstaCodFormapag.StrictDelimiter:=True;
        ListaCodFormaPag.DelimitedText := xListaCodFormaPag;

        ListaVlrFormaPag := TStringList.Create;
        LIstaVlrFormaPag.Delimiter:=';';
        LIstaVlrFormapag.StrictDelimiter:=True;
        ListaVlrFormaPag.DelimitedText := xListaVlrFormaPag;

        HouveAlt := false;

        for i := 0 to ListaCodFormapag.Count-1 do
          begin
             BUS_CD_C_FPG := TClientDataSet.Create(nil);
             BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
             BUS_CD_C_FPG.Close;
             BUS_CD_C_FPG.Data :=
             BUS_CD_C_FPG.DataRequest(VarArrayOf([0,ListaCodFormaPag[I]]));


             IF ((BUS_CD_C_FPG.FieldByname('ativa_red_parc_car_rec').AsBoolean = true) and
                 (BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger>0)) then
               begin
                  try
                   FIN_CD_M_REC.Filtered := true;
                   FIN_CD_M_REC.Filter := 'ID_FORMA_PAG = '+ListaCodFormaPag[I];
                   FIN_CD_M_REC.IndexFieldNames := 'DTA_VENCIMENTO';

                   FIN_CD_M_REC.First;
                   if FIN_CD_M_REC.RecordCount > BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger then
                     begin
                       valor_parcela := RoundTo(StrToCurr(ListaVlrFormapag[i])/(BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger*1.0),-2);
                       valor_restante := StrToCurr(ListaVlrFormapag[i]) - (BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger-1)*valor_parcela;

                       FIN_CD_M_REC.First;

                       for j := 0 to (BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger-1) do
                        begin
                          FIN_CD_M_REC.Edit;
                          if j = (BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger-1) then
                            begin
                              FIN_CD_M_REC.FieldByname('VLR_PARCELA').AsCurrency  := valor_restante;
                              FIN_CD_M_REC.FieldByname('VLR_ORIGINAL').AsCurrency := valor_restante;
                              FIN_CD_M_REC.FieldByname('VLR_SALDO').AsCurrency    := valor_restante;
                            end
                          else
                            begin
                              FIN_CD_M_REC.FieldByname('VLR_PARCELA').AsCurrency  := valor_parcela;
                              FIN_CD_M_REC.FieldByname('VLR_ORIGINAL').AsCurrency := valor_parcela;
                              FIN_CD_M_REC.FieldByname('VLR_SALDO').AsCurrency    := valor_parcela;
                            end;
                         FIN_CD_M_REC.FieldByname('INT_TIT_VLR_ALT').AsBoolean := true;
                         FIN_CD_M_REC.Next;
                        end;

                       FIN_CD_M_REC.Filter := 'ID_FORMA_PAG = '+ListaCodFormaPag[I]+' and int_tit_vlr_alt=false ';
                       FIN_CD_M_REC.First;

                       HouveAlt := true;

                       while not FIN_CD_M_REC.IsEmpty do
                         begin
                           FIN_CD_M_REC.Delete;
                         end;
                     end;

                  finally
                   FIN_CD_M_REC.Filtered := false;
                  end;
               end;
          end;

      if HouveAlt then
         begin
            FIN_CD_M_REC.Filtered := false;

            i:= 0;
            FIN_CD_M_REC.IndexFieldNames := 'DTA_VENCIMENTO';
            FIN_CD_M_REC.First;

            QtdeReg := IntToStr(FIN_CD_M_REC.RecordCount);
            while not FIN_CD_M_REC.eof do
               begin
                 inc(i);
                 FIN_CD_M_REC.edit;
                 FIN_CD_M_REC.FieldByName('NUM_PARCELA').AsString :=
                         FIN_CD_M_REC.FieldByName('INT_NUMERONF').AsString + '-' +
                         inttostr(i) + '/' + QtdeReg;
                 FIN_CD_M_REC.Post;
                 FIN_CD_M_REC.Next;
               end;
            FIN_CD_M_REC.First;
         end;

      if FIN_CD_M_REC <> nil then
        if FIN_CD_M_REC.ChangeCount > 0 then
          if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
            raise Exception.Create('Erro ao tentar atualizar os ttulos do contas a receber.');
      FINALLY
        FIN_CD_M_REC.Free;
        BUS_CD_C_FPG.Free;
      END;
end;

procedure TSM.GerFinSaida(Sender: TObject; DataSet: TCustomClientDataSet; IdAbertura: integer;
                          NumeroNfe,SerieNF: String; DtaEmissaoNF: TDateTime);
var
  FIN_CD_M_REC, FIN_CD_M_REC_PAG, CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_M_NFE_TIT_INT,BUS_CD_C_PAR_CTR,
  FIN_CD_M_RCR, FIN_CD_M_CTA,FIN_CD_M_CTA_2, FIN_CD_M_CTA_RCR:TClientdataset;
  CAD_CD_C_FPG:TClientdataset;
  xIdTitulo:Integer;
  xNumParcela,xNumParcelaAnt:String;
  xNewNumParcela:String;
  cds:TDataSet;

  xIdNfeTit: integer;
  xIdFormaPag, xIdVendedor:integer;
  xIdPlano:String;
  xIdCCusto:Integer;
  xVlrTitulo:Currency;
  xDtaVencimento:TDateTime;
  xCheConta, xCheCheque: Integer;
  xCheBanco, xCheEmit, xCheAgencia: String;
  xHistoricoPag,xCarIdMaquineta: String;
  NF_Faturada_Manual: Boolean;

  nfe_protocolo,nfe_recibo: String;
begin

  { TODO -oMaxsuel -cCriao :
    Criado em 31-03-2015
    Este mtodo tem a funo de gerar o financeiro da nota de sada. }

    //Procedimentos:
    //--------------------------------------
    //Gera Contas a Receber


  {
    0 - Nenhum,
    1 - Duplicata,
    2 - Promissoria,
    3 - Cartao,
    4 - Boleto,
    5 - Dinheiro,
    6 - Cheque
    7 - Credito
    8 - Pix
  }
  BUS_CD_C_PAR_CTR  := TClientDataSet.Create(self);
  FIN_CD_M_REC  := TClientDataSet.Create(self);
  CAD_CD_C_FPG  := TClientDataSet.Create(self);

  CAD_CD_C_CLI := TClientDataSet.Create(self);
  CAD_CD_C_CLI_CRD := TClientDataSet.Create(self);

  BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
  BUS_CD_C_PAR_CTR.Close;
  BUS_CD_C_PAR_CTR.Data :=
       BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([Dataset.FieldByName('ID_EMPRESA').AsString]));



  NF_Faturada_Manual := false;

  // if se for uma nota fiscal de sada(faturada) digitada pelo prprio funcionrio

  if (DataSet.FieldByName('tipo_nf').AsString = 'S') and
     (DataSet.FieldByName('origem_nf').AsString = 'B') then
      begin
        nfe_protocolo := DataSet.FieldByName('nfe_protocolo').AsString;
        nfe_recibo := DataSet.FieldByName('nfe_recibo').AsString;

        if DataSet.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
           begin
             DataSet.Next;
             if DataSet.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                begin
                  if DataSet.FieldByName('nfe_protocolo').AsString <> '' then
                     nfe_protocolo := DataSet.FieldByName('nfe_protocolo').AsString;
                  if DataSet.FieldByName('nfe_recibo').AsString <> '' then
                     nfe_recibo := DataSet.FieldByName('nfe_recibo').AsString;
                end;
             DataSet.Prior;
           end;

        if (DataSet.FieldByName('tipo_nf').AsString = 'S') and
           (DataSet.FieldByName('origem_nf').AsString = 'B') and
           (trim(nfe_protocolo) = '') and
           (trim(nfe_recibo) = '') then
            begin
              NF_Faturada_Manual := true;
            end;
      end;

  try
    if not (dataset.UpdateStatus in [usDeleted]) then
       begin

         FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
         FIN_CD_M_REC.Close;
         FIN_CD_M_REC.Data :=
             FIN_CD_M_REC.DataRequest(VarArrayOf([94, Dataset.FieldByName('ID_FISCAL').AsString]));

         CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
         CAD_CD_C_FPG.Close;
         CAD_CD_C_FPG.Data :=
             CAD_CD_C_FPG.DataRequest(VarArrayOf([1, '%']));

         if DataSet.FieldByName('IND_EMITENTE').AsInteger = 0 then // Prpria
            begin
              if SerieNF <> 'X' then
                 begin
                    if (trim(DataSet.FieldByName('MODELO').AsString) <> '2D') or
                       ( (NF_Faturada_Manual) and (trim(DataSet.FieldByName('MODELO').AsString) <> '55')) then
                       begin
                           if NF_Faturada_Manual then
                              begin
                                 cds := TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_TIT')).NestedDataSet;

                                 CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
                                 CAD_CD_C_CLI.Close;
                                 CAD_CD_C_CLI.Data :=
                                     CAD_CD_C_CLI.DataRequest(VarArrayOf([0, Dataset.FieldByName('ID_EMITENTE').AsString]));

                                 CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

                                 CAD_CD_C_CLI.edit;

                                 // Busca os ttulos da nota fiscal.
                                 BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
                                 BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
                                 BUS_CD_M_NFE_TIT_INT.Close;
                                 BUS_CD_M_NFE_TIT_INT.Data :=
                                     BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([dataset.FieldByName('id_fiscal').AsString]));

                                 if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                                    enVerSldLimFpgAtu(0, DataSet, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);


                                 // retorna o saldo de antes
                                 CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                                     CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + enVerSldLimAtu(0,DataSet,BUS_CD_M_NFE_TIT_INT,0);
                                 CAD_CD_C_CLI.Post;
                                 CAD_CD_C_CLI.Edit;

                               { if not (FIN_CD_M_REC.IsEmpty) then
                                   begin
                                     while not (FIN_CD_M_REC.Eof)  do
                                       begin
                                         FIN_CD_M_REC.Delete;
                                       end;
                                   end; }

                                 FIN_CD_M_CTA_2  := TClientDataSet.Create(self);
                                 FIN_CD_M_CTA_2.SetProvider(FIN_DP_M_CTA);
                                 FIN_CD_M_CTA_2.Close;
                                 FIN_CD_M_CTA_2.Data :=
                                     FIN_CD_M_CTA_2.DataRequest(VarArrayOf([94,DataSet.FieldByName('ID_FISCAL').AsString]));
                                 if not (FIN_CD_M_CTA_2.IsEmpty) then
                                    begin
                                      FIN_CD_M_CTA_2.First;
                                      while not (FIN_CD_M_CTA_2.Eof) do
                                        begin
                                          FIN_CD_M_CTA_2.Delete;
                                        end;
                                    end;

                                FIN_CD_M_RCR  := TClientDataSet.Create(self);
                                FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
                                FIN_CD_M_RCR.Close;
                                FIN_CD_M_RCR.Data :=
                                    FIN_CD_M_RCR.DataRequest(VarArrayOf([90,dataset.FieldByName('id_fiscal').AsInteger]));
                                if not (FIN_CD_M_RCR.IsEmpty) then
                                   begin
                                     FIN_CD_M_RCR.First;
                                     while not (FIN_CD_M_RCR.Eof) do
                                        begin
                                          FIN_CD_M_RCR.Delete;
                                        end;
                                   end;
                              end
                          else
                              begin
                                // Busca os ttulos da nota fiscal que est na tela do controle de caixa
                                BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
                                BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
                                BUS_CD_M_NFE_TIT_INT.Close;
                                BUS_CD_M_NFE_TIT_INT.Data :=
                                    BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([dataset.FieldByName('id_fiscal').AsString]));

                                cds :=  BUS_CD_M_NFE_TIT_INT;
                              end;
                       end
                    else
                       begin
                          // cds := TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_TIT')).NestedDataSet;
                          BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
                          BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
                          BUS_CD_M_NFE_TIT_INT.Close;
                          BUS_CD_M_NFE_TIT_INT.Data :=
                              BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([dataset.FieldByName('id_fiscal').AsString]));

                          cds :=  BUS_CD_M_NFE_TIT_INT;
                       end;
                 end
              else
                begin
                  cds := TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_TIT')).NestedDataSet;
                end;
            end;

         if DataSet.FieldByName('IND_EMITENTE').AsInteger = 1 then // Terceiro
            begin
              cds := TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_TIT')).NestedDataSet;
            end;

         cds.First;
         while not (cds.Eof)  do
           begin
             xIdNfeTit      := cds.FieldByName('ID_NFE_TIT').AsInteger;
             xNumParcela    := cds.FieldByName('NUM_PARCELA').AsString;
             xNumParcelaAnt := cds.FieldByName('NUM_PARCELA').AsString;
             xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
             xIdPlano       := cds.FieldByName('ID_PLANO').AsString;
             xIdCCusto      := cds.FieldByName('ID_CCUSTO').AsInteger;
             xVlrTitulo     := cds.FieldByName('VLR_TITULO').AsCurrency;
             xDtaVencimento := cds.FieldByName('DTA_VENCIMENTO').AsDateTime;
             xHistoricoPag  := cds.FieldByName('HISTORICO_PAG').AsString;
             xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
             xHistoricoPag  := cds.FieldByName('HISTORICO_PAG').AsString;

             xCheConta      := cds.FieldByName('che_conta').AsInteger;
             xCheCheque     := cds.FieldByName('che_numero').AsInteger;
             xCheBanco      := cds.FieldByName('che_banco').AsString;
             xCheAgencia    := cds.FieldByName('che_agencia').AsString;
             xCheEmit       := cds.FieldByName('che_emitente').AsString;

             xCarIdMaquineta := cds.FieldByName('ID_MAQUINETA').AsString;

             xIdVendedor    := dataset.FieldByName('id_vendedor').AsInteger;

             if  (NF_Faturada_Manual)
                  or
                 (DataSet.FieldByName('IND_EMITENTE').AsInteger = 1) or (SerieNF = 'X') then // Terceiro  ou Pedido sem NFe (X)
                begin
                   if cds.UpdateStatus in [usDeleted] then // Se o registro est com status de Deleo
                      begin
                        if FIN_CD_M_REC.Locate('NUM_PARCELA',xNumParcela,[]) then
                           begin
                             FIN_CD_M_REC.Delete;
                           end;
                      end;
                   if cds.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                      begin
                        cds.Next;
                        if cds.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                           begin
                             if FIN_CD_M_REC.Locate('NUM_PARCELA',xNumParcela,[]) then
                                begin
                                  FIN_CD_M_REC.Delete;
                                end;

                              if cds.FieldByName('ID_NFE_TIT').AsString <> '' then
                                 xIdNfeTit      := cds.FieldByName('ID_NFE_TIT').AsInteger;
                              if cds.FieldByName('ID_FORMA_PAG').AsInteger>0 then
                                 xIdFormaPag    := cds.FieldByName('ID_FORMA_PAG').AsInteger;
                              if cds.FieldByName('ID_PLANO').AsString<>'' then
                                 xIdPlano       := cds.FieldByName('ID_PLANO').AsString;
                              if cds.FieldByName('VLR_TITULO').AsCurrency>0 then
                                 xVlrTitulo     := cds.FieldByName('VLR_TITULO').AsCurrency;
                              if not cds.FieldByName('DTA_VENCIMENTO').IsNull then
                                 xDtaVencimento := cds.FieldByName('DTA_VENCIMENTO').AsDateTime;
                              if cds.FieldByName('ID_FORMA_PAG').AsInteger>0 then
                                 xIdFormaPag    :=cds.FieldByName('ID_FORMA_PAG').AsInteger;
                              if cds.FieldByName('HISTORICO_PAG').AsString <> '' then
                                 xHistoricoPag    :=cds.FieldByName('HISTORICO_PAG').AsString;
                              if cds.FieldByName('NUM_PARCELA').AsString <> '' then
                                 xNumParcela    := cds.FieldByName('NUM_PARCELA').AsString;

                              if cds.FieldByName('che_banco').AsString <> '' then
                                 xCheBanco      :=cds.FieldByName('che_banco').AsString;
                              if cds.FieldByName('che_agencia').AsString <> '' then
                                 xCheAgencia      :=cds.FieldByName('che_agencia').AsString;
                              if cds.FieldByName('che_emitente').AsString <> '' then
                                 xCheEmit         :=cds.FieldByName('che_emitente').AsString;
                              if cds.FieldByName('che_conta').AsInteger > 0 then
                                 xCheConta      := cds.FieldByName('che_conta').AsInteger;
                              if cds.FieldByName('che_numero').AsInteger > 0 then
                                 xCheCheque     := cds.FieldByName('che_numero').AsInteger;
                              if cds.FieldByName('ID_MAQUINETA').AsInteger > 0 then
                                 xCarIdMaquineta := cds.FieldByName('ID_MAQUINETA').AsString;

                              CAD_CD_C_FPG.locate('ID_FORMA_PAG',xIdFormaPag,[]);

                              if not (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [0,7]) then //0 - Nenhum  7 - Crdito
                                 begin
                                    FIN_CD_M_REC.Insert;
                                    FIN_CD_M_REC.FieldByName('id_empresa').AsInteger      := dataset.FieldByName('ID_EMPRESA').AsInteger;
                                    FIN_CD_M_REC.FieldByName('ID_TITULO').AsInteger       := xIdNfeTit;
                                    FIN_CD_M_REC.FieldByName('id_fiscal').AsInteger       := dataset.FieldByName('ID_FISCAL').AsInteger;
                                    FIN_CD_M_REC.FieldByName('id_plano').AsString         := xIdPlano;
                                    FIN_CD_M_REC.FieldByName('id_cliente').AsInteger      := dataset.FieldByName('ID_EMITENTE').AsInteger;
                                    FIN_CD_M_REC.FieldByName('num_parcela').AsString      := xNumParcela;
                                    FIN_CD_M_REC.FieldByName('dta_emissao').AsDateTime    := DtaEmissaoNF;
                                    FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := xVlrTitulo;
                                    FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := xDtaVencimento;
                                    FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := xDtaVencimento;
                                    FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := xVlrTitulo;
                                    FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := xVlrTitulo;
                                    FIN_CD_M_REC.FieldByName('car_id_maquineta').AsString := xCarIdMaquineta;

                                    if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
                                       (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
                                        FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency  := 0;
                                    if trim(xHistoricoPag) <> '' then
                                       FIN_CD_M_REC.FieldByName('historico').AsString     := xHistoricoPag
                                    else
                                       FIN_CD_M_REC.FieldByName('historico').AsString     := 'Gerado pela NF: ' + NumeroNfe;
                                    // Origem
                                       // 0 - Manual
                                       // 1 - Baixa do contas a receber
                                       // 2 - Nota Fiscal de Sada
                                    FIN_CD_M_REC.FieldByName('origem').AsInteger          := 2;
                                    FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := xIdFormaPag;
                                    FIN_CD_M_REC.FieldByName('id_local_titulo').AsString  := CAD_CD_C_FPG.FieldByName('id_local_titulo').AsString;
                                    // Tipo lanamento
                                       // 0 - Manual
                                       // 1 - Automtica
                                    FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                                    FIN_CD_M_REC.FieldByName('che_banco').AsString        := xCheBanco;
                                    FIN_CD_M_REC.FieldByName('che_agencia').AsString      := xCheAgencia;
                                    FIN_CD_M_REC.FieldByName('che_conta').AsInteger       := xCheConta;
                                    FIN_CD_M_REC.FieldByName('che_cheque').AsInteger      := xCheCheque;
                                    FIN_CD_M_REC.FieldByName('che_emitente').AsString     := xCheEmit;
                                    FIN_CD_M_REC.FieldByName('id_vendedor').AsInteger     := xIdVendedor;
                                    if (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [6]) then // 6 - Cheque
                                        FIN_CD_M_REC.FieldByName('situacao_chq').AsInteger  :=   1;
                                    FIN_CD_M_REC.Post;
                                 end;
                           end;
                      end;
                end;
             if (cds.UpdateStatus in [usInserted]) or

                (
                    (NF_Faturada_Manual=false) and

                    (DataSet.FieldByName('IND_EMITENTE').AsInteger = 0) and
                    (SerieNF <> 'X') ) { Nf Prpria e Nfe} then
                begin

                  CAD_CD_C_FPG.locate('ID_FORMA_PAG',xIdFormaPag,[]);

                  if not (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [0,7]) then //0 - Nenhum  7 - Crdito
                     begin
                        FIN_CD_M_REC.Insert;
                        FIN_CD_M_REC.FieldByName('id_empresa').AsInteger      := dataset.FieldByName('ID_EMPRESA').AsInteger;
                        FIN_CD_M_REC.FieldByName('ID_TITULO').AsInteger       := cds.FieldByName('ID_NFE_TIT').AsInteger;
                        FIN_CD_M_REC.FieldByName('id_fiscal').AsInteger       := dataset.FieldByName('ID_FISCAL').AsInteger;
                        FIN_CD_M_REC.FieldByName('id_plano').AsString         := xIdPlano;
                        FIN_CD_M_REC.FieldByName('id_cliente').AsInteger      := dataset.FieldByName('ID_EMITENTE').AsInteger;
                        FIN_CD_M_REC.FieldByName('num_parcela').AsString      := xNumParcela;
                        FIN_CD_M_REC.FieldByName('dta_emissao').AsDateTime    := DtaEmissaoNF;
                        FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := xVlrTitulo;
                        FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := xDtaVencimento;
                        FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := xDtaVencimento;
                        FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := xVlrTitulo;
                        FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := xVlrTitulo;

                        if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
                           (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
                            FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency  := 0;
                        if trim(xHistoricoPag) <> '' then
                           FIN_CD_M_REC.FieldByName('historico').AsString     := xHistoricoPag
                        else
                           FIN_CD_M_REC.FieldByName('historico').AsString     := 'Gerado pela NF: ' + NumeroNfe;
                        // Origem
                           // 0 - Manual
                           // 1 - Baixa do contas a receber
                           // 2 - Nota Fiscal de Sada
                        FIN_CD_M_REC.FieldByName('origem').AsInteger          := 2;
                        FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := xIdFormaPag;
                        FIN_CD_M_REC.FieldByName('id_local_titulo').AsString  := CAD_CD_C_FPG.FieldByName('id_local_titulo').AsString;
                        // Tipo lanamento
                           // 0 - Manual
                           // 1 - Automtica
                        FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                        FIN_CD_M_REC.FieldByName('che_banco').AsString        := xCheBanco;
                        FIN_CD_M_REC.FieldByName('che_agencia').AsString      := xCheAgencia;
                        FIN_CD_M_REC.FieldByName('che_conta').AsInteger       := xCheConta;
                        FIN_CD_M_REC.FieldByName('che_cheque').AsInteger      := xCheCheque;
                        FIN_CD_M_REC.FieldByName('che_emitente').AsString     := xCheEmit;
                        FIN_CD_M_REC.FieldByName('id_vendedor').AsInteger     := xIdVendedor;

                        if (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [6]) then // 6 - Cheque
                           FIN_CD_M_REC.FieldByName('situacao_chq').AsInteger  :=   1;

                        //if trim(SerieNF) = 'X' then   // Comentado por Maxsuel em 11/08/2016, pra atender quando for maquineta padro
                        //   begin
                             // Se entra aqui,  por que pode ser um Pedido Cupom
                             if trim(cds.FieldByName('id_maquineta').AsString) <> '' then
                                begin
                                  FIN_CD_M_REC.FieldByName('car_id_maquineta').AsInteger :=
                                               cds.FieldByName('id_maquineta').AsInteger;
                                end;
                        //   end;

                        FIN_CD_M_REC.Post;
                     end;
                end;
             cds.Next;
           end;
         cds.First;

        // if se for uma nota fiscal de sada(faturada) digitada pelo prprio funcionrio
        if (not (NF_Faturada_Manual)) {or (NF_Faturada_Manual=true) and (SerieNF = 'X')} then
           begin
              CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
              CAD_CD_C_CLI.Close;
              CAD_CD_C_CLI.Data :=
                 CAD_CD_C_CLI.DataRequest(VarArrayOf([0, Dataset.FieldByName('ID_EMITENTE').AsString]));

              CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

              CAD_CD_C_CLI.edit;



               if CAD_CD_C_CLI.FieldByName('dta_pri_compra').Text = '' then
                  begin
                    CAD_CD_C_CLI.FieldByName('dta_pri_compra').AsDateTime :=
                        DtaEmissaoNF;
                  end;

               if CAD_CD_C_CLI.FieldByName('dta_ult_compra').text = '' then
                  begin
                    CAD_CD_C_CLI.FieldByName('dta_ult_compra').AsDateTime :=
                        DtaEmissaoNF;
                  end
               else
                  begin
                    if CAD_CD_C_CLI.FieldByName('dta_ult_compra').AsDateTime <
                       DtaEmissaoNF then
                       begin
                         CAD_CD_C_CLI.FieldByName('dta_ult_compra').AsDateTime :=
                             DtaEmissaoNF;
                       end;
                  end;

               if DataSet.FieldByName('IND_EMITENTE').AsInteger = 1 then // Terceiro
                  begin
                     // Busca os ttulos da nota fiscal caso j exista.
                     BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
                     BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
                     BUS_CD_M_NFE_TIT_INT.Close;
                     BUS_CD_M_NFE_TIT_INT.Data :=
                         BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([dataset.FieldByName('id_fiscal').AsString]));


                     if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                        enVerSldLimFpgAtu(0, DataSet, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);


                     // retorna o saldo de antes
                     CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                         CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + enVerSldLimAtu(0,DataSet,BUS_CD_M_NFE_TIT_INT,0);
                  end;

                if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                  enVerSldLimFpgAtu(2, DataSet, cds,CAD_CD_C_CLI_CRD,0);

               // atualiza o saldo novamente
               CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                   CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency - enVerSldLimAtu(2,DataSet,cds,0);
               CAD_CD_C_CLI.Post;
           end;
       end
    else
       begin

         CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
         CAD_CD_C_CLI.Close;
         CAD_CD_C_CLI.Data :=
             CAD_CD_C_CLI.DataRequest(VarArrayOf([0, Dataset.FieldByName('ID_EMITENTE').AsString]));

         CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

         CAD_CD_C_CLI.edit;

         // Busca os ttulos da nota fiscal.
         BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
         BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
         BUS_CD_M_NFE_TIT_INT.Close;
         BUS_CD_M_NFE_TIT_INT.Data :=
             BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([dataset.FieldByName('id_fiscal').AsString]));

         cds :=  BUS_CD_M_NFE_TIT_INT;


         if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
            enVerSldLimFpgAtu(0, DataSet, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);

         // retorna o saldo de antes
         CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
             CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + enVerSldLimAtu(0,DataSet,BUS_CD_M_NFE_TIT_INT,0);
         CAD_CD_C_CLI.Post;


         FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
         FIN_CD_M_REC.Close;
         FIN_CD_M_REC.Data :=
         FIN_CD_M_REC.DataRequest(VarArrayOf([94, Dataset.FieldByName('ID_FISCAL').AsString]));
         if not (FIN_CD_M_REC.IsEmpty) then
           begin
             while not (FIN_CD_M_REC.Eof)  do
               begin
                 FIN_CD_M_REC.Delete;
               end;
           end;

         FIN_CD_M_CTA  := TClientDataSet.Create(self);
         FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
         FIN_CD_M_CTA.Close;
         FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([94,DataSet.FieldByName('ID_FISCAL').AsString]));
         if not (FIN_CD_M_CTA.IsEmpty) then
            begin
              FIN_CD_M_CTA.First;
              while not (FIN_CD_M_CTA.Eof) do
                begin
                  FIN_CD_M_CTA.Delete;
                end;
            end;

        FIN_CD_M_RCR  := TClientDataSet.Create(self);
        FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
        FIN_CD_M_RCR.Close;
        FIN_CD_M_RCR.Data :=
            FIN_CD_M_RCR.DataRequest(VarArrayOf([90,dataset.FieldByName('id_fiscal').AsInteger]));
        if not (FIN_CD_M_RCR.IsEmpty) then
           begin
             FIN_CD_M_RCR.First;
             while not (FIN_CD_M_RCR.Eof) do
                begin
                  FIN_CD_M_RCR.Delete;
                end;
           end;

       end;

  if not (dataset.UpdateStatus in [usDeleted]) then
     begin
       // Gera ou Deleta a movimentao de caixa/banco;
       FIN_CD_M_CTA  := TClientDataSet.Create(self);
       enGerFinCxaBco(sender,0,dataset,cds,FIN_CD_M_CTA,IdAbertura);

       // Gera ou Deleta o registro de pagamento do ttulo caso necessrio;
       enGerFinRecPag(sender,0,dataset,cds,FIN_CD_M_REC_PAG,IdAbertura,NumeroNfe);

       // Gera ou Deleta o registro de crdito caso necessrio;
       enGerFinRcr(sender,0,dataset,cds,FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,IdAbertura);

     end;




  if FIN_CD_M_REC.ChangeCount > 0 then
     if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
        abort;

  // Gravao do registro de pagamentos dos ttulos
  if FIN_CD_M_REC_PAG <> nil then
     if FIN_CD_M_REC_PAG.ChangeCount > 0  then
        if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
           abort;

  // Gravao dos registros de mov. de caixa dos ttulos
  if FIN_CD_M_CTA <> nil then
     if FIN_CD_M_CTA.ChangeCount > 0  then
        if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
           abort;

  // ir deletar os registros de mov. de caixa dos ttulos (da nota fiscal de sada digitada manualmente e j faturada)
  if FIN_CD_M_CTA_2 <> nil then
     if FIN_CD_M_CTA_2.ChangeCount > 0  then
        if not (FIN_CD_M_CTA_2.ApplyUpdates(0) = 0) then
           abort;

  // Gravao dos registros crdito utilizado de acordo com a forma de pagamento
  if FIN_CD_M_RCR <> nil then
     if FIN_CD_M_RCR.ChangeCount > 0  then
        if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
           abort;
  // Gravao dos registros de mov. de caixa Db e Cr de cada nota de crdito utilizada.
  if FIN_CD_M_CTA_RCR <> nil then
     if FIN_CD_M_CTA_RCR.ChangeCount > 0  then
        if not (FIN_CD_M_CTA_RCR.ApplyUpdates(0) = 0) then
           abort;

  // Gravao dados atualizado do cliente.
  if CAD_CD_C_CLI <> nil then
     if CAD_CD_C_CLI.ChangeCount > 0  then
        if not (CAD_CD_C_CLI.ApplyUpdates(0) = 0) then
           abort;

  finally
    CAD_CD_C_CLI.Free;
    CAD_CD_C_CLI_CRD.Free;
    FIN_CD_M_REC.Free;
    CAD_CD_C_FPG.Free;
    BUS_CD_M_NFE_TIT_INT.Free;
    FIN_CD_M_REC_PAG.Free;
    FIN_CD_M_RCR.Free;
    FIN_CD_M_CTA.Free;
    FIN_CD_M_CTA_2.Free;
    FIN_CD_M_CTA_RCR.Free;
   end;

end;

procedure TSM.GerarSqlTxt(dataset: TSQLDataSet);
var
  Arquivo: TextFile;
begin

   { TODO -oMaxsuel -cCriao :
Criado por Maxsuel Victor - Em 16/10/2014
Para gerar o txt do select de SQLDataSet }

   AssignFile(Arquivo,'c:\logs\sql.txt');
   Rewrite(Arquivo); //abre o arquivo para escrita

   Writeln(Arquivo,dataset.CommandText);
   Closefile(Arquivo); //fecha o handle de arquivo
end;

procedure TSM.GerarTxt(path_arquivo,texto: String);
var
  Arquivo: TextFile;
  txt: string;
begin

   { TODO -oMaxsuel -cCriao :
     Criado por Maxsuel Victor - Em 11/04/2018
     Para gerar o txt do texto }

   if not (DirectoryExists(ExtractFilePath(Application.ExeName)+'logs')) then
      ForceDirectories(ExtractFilePath(Application.ExeName)+'logs');

   txt := path_arquivo;

   AssignFile(Arquivo,txt);

    if not (FileExists(txt)) then
      Rewrite(Arquivo) //abre o arquivo para escrita
   else
      append(Arquivo);

   //Rewrite(Arquivo); //abre o arquivo para escrita

   Writeln(Arquivo,texto);
   Closefile(Arquivo); //fecha o handle de arquivo
end;

function TSM.OFI_DP_M_AGEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlOfiAge: String;
  begin
    Result := 'SELECT AGE.* FROM OFI_TB_M_AGE AGE ';
  end;
begin
   OFI_SQ_M_AGE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_M_AGE.CommandText := enSqlOfiAge + ' WHERE 1=2 '
        else
           OFI_SQ_M_AGE.CommandText := enSqlOfiAge +
             ' WHERE PLACA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_M_AGE.CommandText := enSqlOfiAge +
          Format('WHERE upper(NOME_CLIENTE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        OFI_SQ_M_AGE.CommandText := enSqlOfiAge +
             ' WHERE DTA_AGENDA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;

   Result := OFI_DP_M_AGE.Data;
end;

function TSM.OFI_DP_M_CVLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiCvl: String;
  begin
    Result :=
        ' select cvl.*, '+
        ' cast(case  cvl.tipo_movimento '+
        '  when 0  then  ''IPVA''         '+
        '  when 1  then  ''MULTA''        '+
        '  when 2  then  ''SEGURO''       '+
        ' end as varchar(10))  as int_tipo_mov, '+
        ' meq.id_placa as int_placa,meq.descricao as int_descricao from ofi_tb_m_cvl cvl '+
        ' left outer join pcp_tb_c_meq meq on meq.id_meq=cvl.id_meq and meq.id_empresa=cvl.id_empresa ';

  end;
begin
   OFI_SQ_M_CVL.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_M_CVL.CommandText := enSqlOfiCvl + ' WHERE 1=2 '
        else
          begin
           OFI_SQ_M_CVL.CommandText := enSqlOfiCvl +
             ' WHERE cvl.id_empresa = ''' + VarToStr(Input[1]) +''' ';
           if VarToStr(Input[2])<>'' then
             OFI_SQ_M_CVL.CommandText := OFI_SQ_M_CVL.CommandText +
             '   and cvl.id_controle = ''' + VarToStr(Input[2]) +''' ';
          end;
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_M_CVL.CommandText := enSqlOfiCvl +
           ' WHERE cvl.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and meq.id_placa = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        OFI_SQ_M_CVL.CommandText := enSqlOfiCvl +
           ' WHERE cvl.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and cvl.dta_controle = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;


   if Input[0] = 90 then
      begin
        OFI_SQ_M_CVL.CommandText := enSqlOfiCvl +
           ' WHERE cvl.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and cvl.id_meq = ''' + VarToStr(Input[2]) +''' ' +
             '   and cvl.dta_controle >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
             '   and cvl.dta_controle <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ';
      end;

   OFI_SQ_M_CVL.CommandText := OFI_SQ_M_CVL.CommandText + ' order by CVL.dta_controle desc ';

   Result := OFI_DP_M_CVL.Data;

   OFI_SQ_M_CVL.Close;
end;

function TSM.OFI_DP_M_OCQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiOcq: String;
  begin
    Result :=
      'SELECT OCQ.*, '+
      '       CLI.NOME AS INT_NOMECLI, '+
      '       FUC.NOME AS INT_NOMEFUC, '+
      '       ANA.NOME AS INT_NOMEANA, '+
      '       CPG.DESCRICAO AS INT_NOMECPG, '+
      '       EQP.DESCRICAO AS INT_NOMEEQP '+
      'FROM OFI_TB_M_OCQ OCQ '+
      'LEFT OUTER JOIN CAD_TB_C_EQP EQP ON EQP.ID_EQUIPAMENTO=OCQ.ID_EQUIPAMENTO '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCQ.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=OCQ.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=OCQ.ID_ANALISTA '+
      'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCQ.ID_CONDICAO_PAG ';
  end;
begin
   OFI_SQ_M_OCQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq + ' WHERE 1=2 '
        else
           OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
             ' WHERE OCQ.ID_ORCAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
          ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   OCQ.ID_EQUIPAMENTO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcQ +
          ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          Format('  upper(OCQ.NOME_cliente) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 3 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
             ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '   OCQ.DTA_ORCAMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
             ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  OCQ.DTA_VALIDADE = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
          ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '    OCQ.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
      end

   else if Input[0] = 90 then
      begin
        OFI_SQ_M_OCQ.CommandText := enSqlOfiOcq +
             ' WHERE OCQ.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  OCQ.STATUS = 0 AND ' +
             '  OCQ.DTA_VALIDADE < CURRENT_DATE ';
      end;

   Result := OFI_DP_M_OCQ.Data;

   OFI_SQ_M_OCQ.Close;
end;

function TSM.OFI_DP_M_OCVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlOfiOcv: String;
  begin
    Result :=
      'SELECT OCV.*, '+
      '       CLI.NOME AS INT_NOMECLI, '+
      '       FUC.NOME AS INT_NOMEFUC, '+
      '       ANA.NOME AS INT_NOMEANA, '+
      '       CPG.DESCRICAO AS INT_NOMECPG, '+
      '       VEI.DESCRICAO AS INT_NOMEVEI '+
      'FROM OFI_TB_M_OCV OCV '+
      'LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_PLACA=OCV.PLACA '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCV.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=OCV.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=OCV.ID_ANALISTA '+
      'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCV.ID_CONDICAO_PAG ';
  end;
begin
   OFI_SQ_M_OCV.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_M_OCV.CommandText := enSqlOfiOcv + ' WHERE 1=2 '
        else
           OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
             ' WHERE OCV.ID_ORCAMENTO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
          ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   OCV.PLACA = ''' + VarToStr(Input[2]) +''' ';
        if VarToStr(Input[3])<>'' then
           OFI_SQ_M_OCV.CommandText :=  OFI_SQ_M_OCV.CommandText +
              ' AND  OCV.TIPO_ORCAMENTO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
          ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          Format('  upper(OCV.NOME_cliente) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
        if VarToStr(Input[3])<>'' then
           OFI_SQ_M_OCV.CommandText :=  OFI_SQ_M_OCV.CommandText +
              ' AND  OCV.TIPO_ORCAMENTO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
             ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '   OCV.DTA_ORCAMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        if VarToStr(Input[3])<>'' then
           OFI_SQ_M_OCV.CommandText :=  OFI_SQ_M_OCV.CommandText +
              ' AND  OCV.TIPO_ORCAMENTO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
             ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  OCV.DTA_VALIDADE = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        if VarToStr(Input[3])<>'' then
           OFI_SQ_M_OCV.CommandText :=  OFI_SQ_M_OCV.CommandText +
              ' AND  OCV.TIPO_ORCAMENTO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
          ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '    OCV.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
        if VarToStr(Input[3])<>'' then
           OFI_SQ_M_OCV.CommandText :=  OFI_SQ_M_OCV.CommandText +
              ' AND  OCV.TIPO_ORCAMENTO = ''' + VarToStr(Input[3]) +''' ';
      end

   else if Input[0] = 90 then
      begin
        OFI_SQ_M_OCV.CommandText := enSqlOfiOcv +
             ' WHERE OCV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  OCV.STATUS = 0 AND ' +
             '  OCV.DTA_VALIDADE < CURRENT_DATE ';
      end;

   Result := OFI_DP_M_OCV.Data;

   OFI_SQ_M_OCV.Close;
end;

procedure TSM.OFI_DP_M_OCVGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
    enAudInserirCampoPacote(Properties);
end;

procedure TSM.OFI_DP_M_OCVUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  enAudGravar(Sender,DataSet);
end;

function TSM.OFI_DP_M_ORVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiOrv: String;
  begin
    Result :=
        '  SELECT  false as int_selecao,ORV.*,                  '+
        '     CLI.doc_cnpj_cpf AS INT_CPFCNPJ,                  '+
        '     CLI.pessoa as int_pessoacli,                         '+
        '     CLI.NOME AS INT_NOMECLI,                          '+
        '     CLI.TEL_FIXO AS INT_TELFIX,                       '+
        '     CLI.TEL_MOVEL AS INT_TELMOV,                      '+
        '     CLI.substituto_tributario AS INT_SUBST_TRIB,      '+
        '     case                                              '+
        '       when VEI.COMBUSTIVEL = 0 then ''Gasolina''      '+
        '       when VEI.COMBUSTIVEL = 1 then ''Alcool''        '+
        '       when VEI.COMBUSTIVEL = 2 then ''Diesel''        '+
        '       when VEI.COMBUSTIVEL = 3 then ''Gas Natural''   '+
        '       when VEI.COMBUSTIVEL = 4 then ''Eletrico''      '+
        '       when VEI.COMBUSTIVEL = 5 then ''Flex''          '+
        '     end as INT_NOMECOM,                               '+
        '     VEI.ID_PLACA AS INT_PLACA, VEI.DESCRICAO AS INT_NOMEVEI, '+
        '     TIO.DESCRICAO AS INT_NOMETIO, TIO.TIPO AS INT_TIPO_OS, CID.UF AS INT_UFCLI,     ' +
        '     VEI.ID_MVE, MVE.DESCRICAO AS INT_NOMEMVE,  ' +
        '     VEI.ANO_MODELO AS INT_ANOMODELO,                            '+
        '     VEI.ANO_FABRICACAO AS INT_ANOFABRIC, VEI.MOTOR AS INT_MOTORVEI, '+
        '     cast( case status_painel                           '+
        '        when  0  then ''Aguardando incio do servio''  '+
        '        when  1  then ''Prximas Ordens de Servios''   '+
        '        when  2  then ''Em Servio''      '+
        '        when  3  then ''Pr-Inspeo''      '+
        '        when  4  then ''Aguardando Lavagem''      '+
        '        when  5  then ''Inspeo Final''      '+
        '        when  6  then ''Aguardando Aprovao''      '+
        '        when  7  then ''Aguardando Peas''      '+
        '        when  8  then ''Aguardando Servio''      '+
        '        when  9  then ''Aguardando Pr-Entrega''      '+
        '        when  10 then ''Aguardando Entrega''      '+
        '        when  11 then ''Entregue''      '+
        '     end  as varchar(30)) as int_statuspainel, ' +
        '     eqp.descricao as int_nomeeqp, ' +
        '     meq.descricao as int_nomemeq, '+
        '     meq.tipo_mei as int_tipomei, '+
        '     ATE.NOME AS INT_NOMEATE '+
        '  FROM OFI_TB_M_ORV ORV                                '+
        '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE            ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA       ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=ORV.ID_ATENDENTE      '+
        '  LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO            ' +
        '  LEFT OUTER JOIN CAD_TB_C_MVE MVE ON MVE.ID_MVE=VEI.ID_MVE               ' +
        '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG        ' +
        '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG  ' +
        '  LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS     ' +
        '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE       ' +
        '  LEFT OUTER JOIN CAD_TB_C_EQP EQP ON EQP.ID_EQUIPAMENTO = ORV.ID_EQUIPAMENTO ' +
        '  LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ ';
  end;
begin
   OFI_SQ_M_ORV.Close;

   if (Input[3] = '1') or  // tela de Abertura de O.S
      (Input[3] = '3') then  // tela de Fechamento de O.S
      begin
         if Input[0] = 0 then
            begin
              if Trim(VarToStr(Input[1])) = '' then
                 OFI_SQ_M_ORV.CommandText := enSqlOfiOrv + ' WHERE 1=2 '
              else
                begin
                 OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_ORDEM = ''' + VarToStr(Input[1]) +''' '+
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
                 if Trim(VarToStr(Input[4]))<>'' then
                   OFI_SQ_M_ORV.CommandText := OFI_SQ_M_ORV.CommandText +
                      '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
                end;
            end
         else if Input[0] = 1 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE  ORV.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 2 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(VEI.ID_PLACA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 3 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                Format(' WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 4 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_TIPO_OS = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 5 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_ANALISTA = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 6 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                Format(' WHERE upper(ORV.obs_reclamacao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
         else if Input[0] = 7 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                  ' WHERE ' +
                  '       ORV.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ' +
                  '   AND ORV.ID_TIPO_OS = ''' + VarToStr(Input[2]) +''' ' +
                  '   AND ORV.ID_VEICULO = ''' + VarToStr(Input[4]) +''' ' +
                  '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[5]) +''' ' +
                  '   AND ORV.ID_ORDEM   <> ''' + VarToStr(Input[6]) +''' ' +
                  '   AND ORV.STATUS in (0,1,2) ' ;
            end
         else if Input[0] = 8 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(MVE.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' ;
            end
         else if Input[0] = 9 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_EQUIPAMENTO = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
            end
         else if Input[0] = 10 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(eqp.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' ;
            end
         else if Input[0] = 11 then
          begin
            OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                 ' WHERE ORV.TIPO_ORDEM = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
          end
         else if Input[0] = 12 then
          begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_MEQ = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
          end
         else if Input[0] = 13 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(MEQ.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
        else if Input[0] = 90 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE   '+
                     '   ORV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
                     '   AND ORV.ID_CLIENTE = '''+ VarToStr(Input[2])+''' '+
                     '   AND ORV.TIPO_ORDEM = ''' + VarToStr(Input[4]) +''' ' +
                     '   AND ORV.ID_VEICULO = ''' + VarToStr(Input[5]) +''' ' +
                     '   AND ORV.ID_ORDEM = ''' + VarToStr(Input[6]) +''' ' +
                     '   AND ORV.STATUS=''3'' ' ;
            end
        else if Input[0] = 91 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE   '+
                     '   ORV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
                     '   AND ORV.ID_CLIENTE = '''+ VarToStr(Input[2])+''' '+
                     '   AND ORV.TIPO_ORDEM = ''' + VarToStr(Input[4]) +''' ' +
                     '   AND ORV.ID_VEICULO = ''' + VarToStr(Input[5]) +''' ' +
                     '   AND ORV.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[6])) ) +''' ' +
                     '   AND ORV.STATUS=''3'' ' ;
            end
        else if Input[0] = 92 then  //Filtro utilizado pelo OS de Equipamento
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE   '+
                     '   ORV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
                     '   AND ORV.ID_CLIENTE = '''+ VarToStr(Input[2])+''' '+
                     '   AND ORV.TIPO_ORDEM = ''' + VarToStr(Input[4]) +''' ' +
                     '   AND ORV.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[5])) ) +''' ' +
                     '   AND ORV.STATUS in (0,1) ' ;
            end
        else if Input[0] = 93 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                  ' WHERE ' +
                  '       ORV.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ' +
                  '   AND ORV.ID_TIPO_OS = ''' + VarToStr(Input[2]) +''' ' +
                  '   AND ORV.ID_VEICULO = ''' + VarToStr(Input[4]) +''' ' +
                  '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[5]) +''' ' +
                  '   AND ORV.ID_ORDEM   <> ''' + VarToStr(Input[6]) +''' ' +
                  '   AND ORV.STATUS in (0,1) ' ;
            end;

         OFI_SQ_M_ORV.CommandText := OFI_SQ_M_ORV.CommandText + ' ORDER BY ORV.ID_ORDEM DESC ';
      end;

   if Input[3] = '2' then // Tela de Requisio (RQV)
      begin
         if Input[0] = 0 then
            begin
              if Trim(VarToStr(Input[1])) = '' then
                 OFI_SQ_M_ORV.CommandText := enSqlOfiOrv + ' WHERE 1=2 '
              else
                 OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_ORDEM = ''' + VarToStr(Input[1]) +'''  ' +
                   '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 1 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                   '   AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 2 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
              Format(' WHERE upper(VEI.ID_PLACA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                     '  AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                     '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                     '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 3 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                Format(' WHERE upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 4 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_TIPO_OS = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                   '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 5 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_ANALISTA = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                   '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 6 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                Format(' WHERE upper(ORV.obs_reclamacao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' '+
                '   AND ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 7 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(MVE.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' ;
            end
         else if Input[0] = 8 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                '   WHERE ORV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
                '     AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 9 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                '   WHERE ORV.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
                '     AND ORV.STATUS_PAINEL in (' + VarToStr(Input[2]) +') ' +
                '     AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 10 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                '   WHERE  exists (select ort.id_ordem from ofi_tb_m_orv_ite ort ' + #13#10 +
                '                  where  ort.id_ordem = orv.id_ordem '             + #13#10 +
                '                    and  ort.dta_requisicao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
                '                  ) ';
            end
         else if Input[0] = 11 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_EQUIPAMENTO = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
                   '  AND  ORV.STATUS in (0,1) ';
            end
         else if Input[0] = 13 then
          begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   ' WHERE ORV.ID_MEQ = ''' + VarToStr(Input[1]) +''' ' +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
          end
         else if Input[0] = 14 then
            begin
              OFI_SQ_M_ORV.CommandText := enSqlOfiOrv +
                   Format(' WHERE upper(MEQ.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
                   '   AND ORV.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
                   '   AND ORV.TIPO_ORDEM = '''+VarToStr(Input[4])  +''' ';
            end
      end;

   Result := OFI_DP_M_ORV.Data;

   OFI_SQ_M_ORV.Close;
end;

procedure TSM.OFI_DP_M_ORVUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
 OFI_DP_M_M_ORVUpdateData(DataSet,Sender,OFI_DP_M_OCV,
                                   CAD_DP_C_ITE,CAD_DP_C_TME, CAD_DP_C_FPG,
                                   FAT_DP_M_NFE, BUS_DP_M_NFE_ITE_INT, BUS_DP_M_NFE_TIT_INT,
                                   BUS_DP_M_ORV_PRO_INT, BUS_DP_M_ORV_ITE_INT,BUS_DP_M_ORV_TIT_INT,
                                   BUS_DP_M_ORV_TIT_SER_INT,
                                   CAD_DP_C_PAR, BUS_DP_C_PAR_CTR,
                                   EST_DP_M_FEA, EST_DP_M_FES, EST_DP_M_FES_ALM,EST_DP_M_LOT,
                                   BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,
                                   CAD_DP_C_CLI, CAD_DP_C_RAM,OFI_DP_C_TIO,BUS_DP_C_TRI_REG,DP_BR_CUPOM_MESTRE,BuscarConnBanco,self);
end;

function TSM.OFI_DP_M_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiPos: String;
  begin
    Result :=
          ' select   pos.*,' + #13#10 +
          ' cast (  ' + #13#10 +
          '     case pos.situacao' + #13#10 +
          '        when 0 then ''Satisfeito''' + #13#10 +
          '        when 1 then ''Instasfeito''' + #13#10 +
          '        when 2 then ''No encontrado''' + #13#10 +
          '    end             ' + #13#10 +
          '   as varchar(20)) as int_situacaopos,' + #13#10 +
          '  par.emp_fantasia as int_empfantasia,' + #13#10 +
          '  orv.id_cliente as int_codcliente,  ' + #13#10 +
          '  vei.descricao as int_nomevei, ' + #13#10 +
          '  cli.nome as int_nomecli, cli.tel_fixo as int_telfixo, ' + #13#10 +
          '  cli.tel_movel as int_telmovel, orv.dta_emissao as int_dtaemissaoorv, ' + #13#10 +
          '  orv.km_atual as int_kmatualorv, orv.obs_reclamacao as int_obsrecorv, ' + #13#10 +
          '  orv.obs_problema as int_obspro ' + #13#10 +
          ' from ofi_tb_m_pos pos' + #13#10 +
          '   left outer join ofi_tb_m_orv orv on (orv.id_ordem = pos.id_ordem)' + #13#10 +
          '   left outer join cad_tb_c_cli cli on (cli.id_cliente = orv.id_cliente)' + #13#10 +
          '   left outer join cad_tb_c_vei vei on (vei.id_veiculo = orv.id_veiculo)' + #13#10 +
          '   left outer join cad_tb_c_par par on (par.id_empresa = pos.id_empresa)' + #13#10;

  end;
begin
   OFI_SQ_M_POS.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           OFI_SQ_M_POS.CommandText := enSqlOfiPos + ' WHERE 1=2 '
        else
           OFI_SQ_M_POS.CommandText := enSqlOfiPos +
             ' WHERE pos.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and pos.id_posvenda = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        OFI_SQ_M_POS.CommandText := enSqlOfiPos +
           ' WHERE pos.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and cli.id_cliente = ''' + VarToStr(Input[2]) +''' ';
      end

   else if Input[0] = 2 then
      begin
        OFI_SQ_M_POS.CommandText := enSqlOfiPos +
                 ' WHERE pos.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
          Format('   and upper(cli.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 3 then
      begin
        OFI_SQ_M_POS.CommandText := enSqlOfiPos +
           ' WHERE pos.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           '   and pos.id_ordem  in (select id_ordem from fat_tb_m_nfe nfe ' +
                                     ' where nfe.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
                                     '   and nfe.numero = ''' + VarToStr(Input[2]) +''') ';
      end
   else if Input[0] = 4 then
      begin
        OFI_SQ_M_POS.CommandText := enSqlOfiPos +
           ' WHERE pos.id_ordem = ''' + VarToStr(Input[1]) +''' ';
      end;

   OFI_SQ_M_POS.CommandText := OFI_SQ_M_POS.CommandText + ' order by pos.dta_posvenda desc ';

   Result := OFI_DP_M_POS.Data;

   OFI_SQ_M_POS.Close;
end;

function TSM.OFI_DP_R_OFV_POS_002DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvPos02: String;
  begin
    Result :=
            ' select ' + #13#10 +
            '             orv.id_ordem, orv.dta_emissao,orv.id_analista,ORV.TIPO_ORDEM,ORV.CHASSI,' + #13#10 +
            '             orv.id_cliente,cli.nome as int_nomecli,' + #13#10 +
            '             ana.nome as int_nomeana,' + #13#10 +
            '             cpg.descricao as int_nomecpg,' + #13#10 +
            '           vei.id_veiculo,' + #13#10 +
            '           vei.id_placa as int_placa,   vei.descricao as int_nomevei,' + #13#10 +
            '           meq.id_meq, ' + #13#10 +
            '           meq.descricao as int_nomemeq,meq.nro_serie as int_seriemeq, meq.id_placa as int_placa_meq, '+ #13#10 +
            '           mde.descricao as int_modelomeq,                    '+
            '           cast(case orv.status' + #13#10 +
            '             when  0 then ''aberta''' + #13#10 +
            '             when 1 then ''em andamento''' + #13#10 +
            '             when 2 then ''fechada''' + #13#10 +
            '             when 3 then ''faturada''' + #13#10 +
            '             when 4 then ''cancelada''' + #13#10 +
            '           end as varchar(20)) as int_orvsituacao,' + #13#10 +
            '           orv.dta_entrega,orv.can_data, orv.can_motivo, ' + #13#10 +
            '           orv.vlr_despesas, orv.dta_emissao, ' + #13#10 +
            '           tio.descricao as int_nometio, ' + #13#10 +
            '           case' + #13#10 +
            '             when orv.dta_entrega < current_date then current_date - orv.dta_entrega' + #13#10 +
            '           else 0 end as int_atraso, ' + #13#10 +
            '           sum(case gru.tipo_item' + #13#10 +
            '              when ''09''  then vlr_liquido' + #13#10 +
            '           end) as vlr_liquido_ser,' + #13#10 +
            '           sum(case' + #13#10 +
            '              when  gru.tipo_item <> ''09''  then vlr_liquido' + #13#10 +
            '           end) as vlr_liquido_pro,' + #13#10 +
            '           sum(vlr_liquido) as vlr_total_sem_desp,' + #13#10 +
            '           orv.vlr_despesas + sum(vlr_liquido) as ' + #13#10 +
            '                 vlr_total_com_desp' + #13#10 +
            ' from ofi_tb_m_orv_ite ori' + #13#10 +
            ' left outer join cad_tb_c_ite    ite  on  ite.id_item=ori.id_item' + #13#10 +
            ' left outer join cad_tb_c_gru   gru on  gru.id_grupo = ite.id_grupo' + #13#10 +
            ' left outer join cad_tb_c_fun mec on  mec.id_funcionario=ori.id_mecanico' + #13#10 +
            ' left outer join ofi_tb_m_orv orv on orv.id_ordem =ori.id_ordem' + #13#10 +
            ' left outer join cad_tb_c_fun ana on ana.id_funcionario=orv.id_analista' + #13#10 +
            ' left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente' + #13#10 +
            ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
            ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo ' + #13#10 +
            ' LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ '+ #13#10 +
            ' LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE = MEQ.ID_MDE '+ #13#10 +
            ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os ' + #13#10 +
            ' where ori.cancelada = false ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Nro OS inicial
          3 - Nro OS final
          4 - Status
          5 - Empresa
          6 - Funcionario
          7 - Veculo
          8 - Condio de pagamento
          9 - Analista
          10 - Tipo de O.S
   }

   OFI_SQ_R_OFV_POS_002.Close;

   if Input[0] <> '' then
      begin
        if Input[12] = '0' then
           begin
             OFI_SQ_R_OFV_POS_002.CommandText := enSqlOfiRelOfvPos02 +
                  '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
        if Input[12] = '1' then
           begin
             OFI_SQ_R_OFV_POS_002.CommandText := enSqlOfiRelOfvPos02 +
                  '   AND  ORV.DTA_FECHAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_FECHAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
      end;

   if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POS_002.CommandText := enSqlOfiRelOfvPos02 +
                  '   AND  ORV.ID_ORDEM >= ''' + VarToStr(Input[2]) + ''' '+
                  '   AND  ORV.ID_ORDEM <= ''' + VarToStr(Input[3]) + ''' ';
      end;

   if Input[4] <> '' then
      begin
         OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
                   ' AND ORV.status = ''' + VarToStr(Input[4]) +''' ';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.id_empresa in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_RESPONSAVEL in (' + VarToStr(Input[6]) +')';
      end;

   if Input[7] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_VEICULO in (' + VarToStr(Input[7]) +')';
      end;

   if Input[8] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +')';
      end;

   if Input[9] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_ANALISTA in (' + VarToStr(Input[9]) +')';
      end;

   if Input[10] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_TIPO_OS in (' + VarToStr(Input[10]) +')';
      end;


   if Input[11] = 5 then   // O.S Com entrega atrasada.
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND orv.dta_entrega < current_date ';
      end;

   if Input[13] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.TIPO_ORDEM in (' + VarToStr(Input[13]) +')';
      end;

   if Input[14] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.CHASSI in (' + VarToStr(Input[14]) +')';
      end;

   if Input[15] <> '' then
      begin
        OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
             ' AND ORV.ID_MEQ in (' + VarToStr(Input[15]) +')';
      end;

   OFI_SQ_R_OFV_POS_002.CommandText := OFI_SQ_R_OFV_POS_002.CommandText +
                            ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24 ' + #13#10 +
                            ' order by int_orvsituacao, ORV.DTA_EMISSAO, ORV.ID_ORDEM ';

   Result := OFI_DP_R_OFV_POS_002.Data;

   OFI_SQ_R_OFV_POS_002.Close;
end;


function TSM.OFI_DP_R_OFV_POS_003DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvPos03: String;
  begin
    Result :=
            ' select ' + #13#10 +
            '             MEC.NOME   AS    INT_NOMEMEC, orv.id_ordem, orv.dta_emissao,orv.id_analista, ' + #13#10 +
            '             ORV.TIPO_ORDEM,ORV.CHASSI,  ' + #13#10 +
            '             orv.id_cliente,cli.nome as int_nomecli,' + #13#10 +
            '             ana.nome as int_nomeana,' + #13#10 +
            '             cpg.descricao as int_nomecpg,' + #13#10 +
            '           vei.id_veiculo,' + #13#10 +
            '           vei.id_placa as int_placa,   vei.descricao as int_nomevei,' + #13#10 +
            '           cast(case orv.status' + #13#10 +
            '             when  0 then ''aberta''' + #13#10 +
            '             when 1 then ''em andamento''' + #13#10 +
            '             when 2 then ''fechada''' + #13#10 +
            '             when 3 then ''faturada''' + #13#10 +
            '             when 4 then ''cancelada''' + #13#10 +
            '           end as varchar(20)) as int_orvsituacao,' + #13#10 +
            '           orv.dta_entrega,orv.can_data, orv.can_motivo, ' + #13#10 +
            '           orv.vlr_despesas, orv.dta_emissao, ' + #13#10 +
            '           tio.descricao as int_nometio, ORI.ID_MECANICO, ' + #13#10 +
            '           case' + #13#10 +
            '             when orv.dta_entrega < current_date then current_date - orv.dta_entrega' + #13#10 +
            '           else 0 end as int_atraso, ' + #13#10 +
            '           sum(case gru.tipo_item' + #13#10 +
            '              when ''09''  then vlr_liquido' + #13#10 +
            '           end) as vlr_liquido_ser,' + #13#10 +
            '           sum(case' + #13#10 +
            '              when  gru.tipo_item <> ''09''  then vlr_liquido' + #13#10 +
            '           end) as vlr_liquido_pro,' + #13#10 +
            '           sum(vlr_liquido) as vlr_total_sem_desp,' + #13#10 +
            '           orv.vlr_despesas + sum(vlr_liquido) as ' + #13#10 +
            '                 vlr_total_com_desp' + #13#10 +
            ' from ofi_tb_m_orv_ite ori' + #13#10 +
            ' left outer join cad_tb_c_ite    ite  on  ite.id_item=ori.id_item' + #13#10 +
            ' left outer join cad_tb_c_gru   gru on  gru.id_grupo = ite.id_grupo' + #13#10 +
            ' left outer join cad_tb_c_fun mec on  mec.id_funcionario=ori.id_mecanico' + #13#10 +
            ' left outer join ofi_tb_m_orv orv on orv.id_ordem =ori.id_ordem' + #13#10 +
            ' left outer join cad_tb_c_fun ana on ana.id_funcionario=orv.id_analista' + #13#10 +
            ' left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente' + #13#10 +
            ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
            ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo ' + #13#10 +
            ' LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ '+ #13#10 +
            ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os ' + #13#10 +
            ' where ori.cancelada = false ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Nro OS inicial
          3 - Nro OS final
          4 - Status
          5 - Empresa
          6 - Funcionario
          7 - Veculo
          8 - Condio de pagamento
          9 - Analista
          10 - Tipo de O.S
   }

   OFI_SQ_R_OFV_POS_003.Close;

   if Input[0] <> '' then
      begin
        if Input[11] = '0' then
           begin
             OFI_SQ_R_OFV_POS_003.CommandText := enSqlOfiRelOfvPos03 +
                  '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
        if Input[11] = '1' then
           begin
             OFI_SQ_R_OFV_POS_003.CommandText := enSqlOfiRelOfvPos03 +
                  '   AND  ORV.DTA_FECHAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_FECHAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
      end;

   if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POS_003.CommandText := enSqlOfiRelOfvPos03 +
                  '   AND  ORV.ID_ORDEM >= ''' + VarToStr(Input[2]) + ''' '+
                  '   AND  ORV.ID_ORDEM <= ''' + VarToStr(Input[3]) + ''' ';
      end;

   if Input[4] <> '' then
      begin
         OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
                   ' AND ORV.status = ''' + VarToStr(Input[4]) +''' ';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.id_empresa in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_RESPONSAVEL in (' + VarToStr(Input[6]) +')';
      end;

   if Input[7] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_VEICULO in (' + VarToStr(Input[7]) +')';
      end;

   if Input[8] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +')';
      end;

   if Input[9] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_ANALISTA in (' + VarToStr(Input[9]) +')';
      end;

   if Input[10] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_TIPO_OS in (' + VarToStr(Input[10]) +')';
      end;

   if Input[12] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.TIPO_ORDEM in (' + VarToStr(Input[12]) +')';
      end;

   if Input[13] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.CHASSI in (' + VarToStr(Input[13]) +')';
      end;

   if Input[14] <> '' then
      begin
        OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
             ' AND ORV.ID_MEQ in (' + VarToStr(Input[14]) +')';
      end;



   OFI_SQ_R_OFV_POS_003.CommandText := OFI_SQ_R_OFV_POS_003.CommandText +
                            ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22 ' + #13#10 +
                            ' order by int_orvsituacao, ORV.DTA_EMISSAO, ORV.ID_ORDEM ';

   Result := OFI_DP_R_OFV_POS_003.Data;

   OFI_SQ_R_OFV_POS_003.Close;
end;

function TSM.OFI_DP_R_OFV_POS_ESTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

function enSqlOfiRelOfvPosEst: String;
  begin
    Result :=
      'SELECT '+
	      ' NFE.ID_EMPRESA, '+
	      ' PAR.EMP_FANTASIA, '+
	      ' COUNT (DISTINCT NFE.ID_FISCAL) AS QTDE_NOTA, '+
        '(SELECT COUNT(DISTINCT ORV.ID_ORDEM) '+
	      '	FROM OFI_TB_M_ORV ORV '+
	      '	LEFT OUTER JOIN FAT_TB_M_NFE NFF ON NFF.ID_ORDEM =ORV.ID_ORDEM '+
	      '	LEFT OUTER JOIN CAD_TB_C_CFO CFF ON CFF.ID_CFO = NFF.ID_CFO '+
	      '	WHERE	CFF.ID_CLASSE IN (''SP10'', ''SP70'') '+
	      '	AND NFF.NFE_COD_SIT NOT IN (''02'', ''04'', ''05'') '+
	      '	AND NFF.STATUS = 1 '+
	      '	AND NFF.FATURADA = TRUE '+
	      '	AND NFF.TIPO_NF = ''S'' ';

  end;
begin
   OFI_SQ_R_OFV_POS_EST.Close;

  if Input[0] <> '' then
    begin
      if Input[11] = '0' then
         begin
           OFI_SQ_R_OFV_POS_EST.CommandText := enSqlOfiRelOfvPosEst +
                '   AND  NFF.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                '   AND  NFF.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
         end;
      if Input[11] = '1' then
         begin
           OFI_SQ_R_OFV_POS_EST.CommandText := enSqlOfiRelOfvPosEst +
                '   AND  ORV.DTA_FECHAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                '   AND  ORV.DTA_FECHAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
         end;
    end;

  if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POS_EST.CommandText := enSqlOfiRelOfvPosEst +
                  '   AND  NFF.ID_ORDEM >= ''' + VarToStr(Input[2]) + ''' '+
                  '   AND  NFF.ID_ORDEM <= ''' + VarToStr(Input[3]) + ''' ';
      end;

  { if Input[4] <> '' then
      begin
         OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
                   ' AND ORV.status = ''' + VarToStr(Input[4]) +''' ';
      end;}

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND NFF.id_empresa in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_RESPONSAVEL in (' + VarToStr(Input[6]) +')';
      end;

   if Input[7] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_VEICULO in (' + VarToStr(Input[7]) +')';
      end;

   if Input[8] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND NFF.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +')';
      end;

   if Input[9] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_ANALISTA in (' + VarToStr(Input[9]) +')';
      end;

   if Input[10] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_TIPO_OS in (' + VarToStr(Input[10]) +')';
      end;

   if Input[12] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.TIPO_ORDEM in (' + VarToStr(Input[12]) +')';
      end;

   if Input[13] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.CHASSI in (' + VarToStr(Input[13]) +')';
      end;

   if Input[14] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_MEQ in (' + VarToStr(Input[14]) +')';
      end;

   OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText + ' ) AS QTDE_VEICULO, ';

   OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
      ' SUM (COALESCE (NIT.VLR_UNITARIO * (NIT.QTDE - NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
      ' SUM (COALESCE (NIT.VLR_DESCONTO, 0)) AS VLR_DESCONTO, '+
      ' SUM (COALESCE (NFE.VLR_OUTRAS_DESP, 0)) AS VLR_DESPESA, '+
      ' SUM (COALESCE (NIT.VLR_UNITARIO * (NIT.QTDE - NIT.QTDE_DEVOLVIDA),0)) - '+
      ' SUM ((COALESCE (NIT.VLR_DESCONTO, 0) / NIT.QTDE) * (NIT.QTDE - NIT.QTDE_DEVOLVIDA)) AS VLR_LIQUIDO, '+
      ' SUM (CASE	WHEN GRU.TIPO_ITEM = ''09'' THEN COALESCE (NIT.VLR_UNITARIO * (NIT.QTDE - NIT.QTDE_DEVOLVIDA),0) - '+
      ' ((COALESCE (NIT.VLR_DESCONTO, 0) / NIT.QTDE) * (NIT.QTDE - NIT.QTDE_DEVOLVIDA))	END ) AS VLR_LIQUIDO_SER, '+
      ' SUM (CASE	WHEN GRU.TIPO_ITEM <> ''09'' THEN	COALESCE (NIT.VLR_UNITARIO * (NIT.QTDE - NIT.QTDE_DEVOLVIDA),0) - '+
      ' ((COALESCE (NIT.VLR_DESCONTO, 0) / NIT.QTDE) * (NIT.QTDE - NIT.QTDE_DEVOLVIDA))	END) AS VLR_LIQUIDO_PRO '+
      ' FROM	FAT_TB_M_NFE_ITE NIT '+
      ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL = NIT.ID_FISCAL '+
      ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON NIT.ID_ITEM = ITE.ID_ITEM '+
      ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = ITE.ID_GRUPO '+
      ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO = NFE.ID_CFO '+
      ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA = NFE.ID_EMPRESA '+
      ' LEFT OUTER JOIN OFI_TB_M_ORV ORV ON NFE.ID_ORDEM = ORV.ID_ORDEM '+
      ' WHERE	CFO.ID_CLASSE IN (''SP10'', ''SP70'') '+
      ' AND NFE.NFE_COD_SIT NOT IN (''02'', ''04'', ''05'') '+
      ' AND NFE.STATUS = 1 '+
      ' AND NFE.FATURADA = TRUE '+
      ' AND NFE.TIPO_NF = ''S'' ';

   if (Input[0] <> '') then
    begin
      if Input[11] = '0' then
         begin
           OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
                '   AND  NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                '   AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
         end;
      if Input[11] = '1' then
         begin
           OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
                '   AND  ORV.DTA_FECHAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                '   AND  ORV.DTA_FECHAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
         end;
    end;

  if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
                  '   NFE  ORV.ID_ORDEM >= ''' + VarToStr(Input[2]) + ''' '+
                  '   NFE  ORV.ID_ORDEM <= ''' + VarToStr(Input[3]) + ''' ';
      end;

 {  if Input[4] <> '' then
      begin
         OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
                   ' AND ORV.status = ''' + VarToStr(Input[4]) +''' ';
      end;}

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND NFE.id_empresa in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_RESPONSAVEL in (' + VarToStr(Input[6]) +')';
      end;

   if Input[7] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_VEICULO in (' + VarToStr(Input[7]) +')';
      end;

   if Input[8] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +')';
      end;

   if Input[9] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_ANALISTA in (' + VarToStr(Input[9]) +')';
      end;

   if Input[10] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_TIPO_OS in (' + VarToStr(Input[10]) +')';
      end;

   if Input[12] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.TIPO_ORDEM in (' + VarToStr(Input[12]) +')';
      end;

   if Input[13] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.CHASSI in (' + VarToStr(Input[13]) +')';
      end;

   if Input[14] <> '' then
      begin
        OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText +
             ' AND ORV.ID_MEQ in (' + VarToStr(Input[14]) +')';
      end;

   OFI_SQ_R_OFV_POS_EST.CommandText := OFI_SQ_R_OFV_POS_EST.CommandText + ' GROUP BY	1,2';

   //CMServerForm.mm.Lines.Add(OFI_SQ_R_OFV_POS_EST.CommandText);

   Result := OFI_DP_R_OFV_POS_EST.Data;
   OFI_SQ_R_OFV_POS_EST.Close;
end;

function TSM.OFI_DP_R_FIV_MEQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFivMeq: String;
  begin
    Result :=
            ' select meq.*, '+
            ' frn.descricao as int_nomefor, '+
            ' mde.descricao as int_desc_modelo, '+
            ' par.emp_fantasia as int_empfantasia, '+

            ' case meq.tipo_mei '+
            '   when 0 then ''Mquina'' '+
            '   when 1 then ''Equipamento'' '+
            '   when 2 then ''Outros'' '+
            '   when 3 then ''Ferramenta'' '+
            '   when 4 then ''Veculo'' '+
            ' else ''??????'' end as int_tipo_mei, '+


            ' case '+
            ' when MEQ.COMBUSTIVEL = 0 then ''Gasolina'' '+
            ' when MEQ.COMBUSTIVEL = 1 then ''Alcool''  '+
            ' when MEQ.COMBUSTIVEL = 2 then ''Diesel''  '+
            ' when MEQ.COMBUSTIVEL = 3 then ''Gas Natural'' '+
            ' when MEQ.COMBUSTIVEL = 4 then ''Eletrico'' '+
            ' when MEQ.COMBUSTIVEL = 5 then ''Flex''  '+
            ' end as INT_NOMECOM_MEQ '+


            ' from pcp_tb_c_meq meq  '+
            '            left outer join pcp_tb_c_mde mde on mde.id_mde = meq.id_meq '+
            '            left outer join cad_tb_c_for frn on frn.id_fornecedor = meq.id_fabricante '+
            '            left outer join cad_tb_c_par par on par.id_empresa = meq.id_empresa  ';

  end;
begin

   { TODO -oLuan -cCriao : Criado em 22/11/2017 }

   {
    input 0 - Mquina/Equip.
   }

   OFI_SQ_R_FIV_MEQ.Close;

   OFI_SQ_R_FIV_MEQ.CommandText := enSqlOfiRelFivMeq +
             ' where meq.id_meq in (' + VarToStr(Input[0]) +')' +
             ' order by meq.descricao ';
   Result := OFI_DP_R_FIV_MEQ.Data;

   OFI_SQ_R_FIV_MEQ.Close;
end;

function TSM.OFI_DP_R_FIV_OCVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFivOcv: String;
  begin
    Result :=
              'select ocv.*, ' + #13#10 +
              '       case coalesce(ocv.id_cliente,0)  ' + #13#10 +
              '         when 0 then nome_cliente' + #13#10 +
              '       else cli.nome end as int_nomecli,' + #13#10 +
              '       case ocv.status' + #13#10 +
              '         when 0 then ''Em aberto''' + #13#10 +
              '         when 1 then ''Importado''' + #13#10 +
              '         when 2 then ''Cancelado''' + #13#10 +
              '       else ''??????'' end as int_status,' + #13#10 +
              '       cpg.descricao as int_nomecpg, ' + #13#10 +
              '       fun.nome as int_nomeana ' +
              '       ' + #13#10 +
              'from ofi_tb_m_ocv ocv' + #13#10 +
              '  left outer join cad_tb_c_cli cli on cli.id_cliente = ocv.id_cliente' + #13#10 +
              '  left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag = ocv.id_condicao_pag' +
              '  left outer join cad_tb_c_fun fun on fun.id_funcionario = ocv.id_analista ';

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 01/10/2016 }

   {
    input 0 - Placa
    input 1 - Empresa
    input 2 - Perodo
   }

   OFI_SQ_R_FIV_OCV.Close;

   OFI_SQ_R_FIV_OCV.CommandText := enSqlOfiRelFivOcv +
       ' where ocv.placa in (''' + VarToStr(Input[0]) +''')' +
       '     and ocv.id_empresa in (' + VarToStr(Input[1]) +') ' +
       '     and  ocv.dta_orcamento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
       '     and  ocv.dta_orcamento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
       '     and ocv.tipo_orcamento = '''+VarToStr(Input[4])+''' '+
       ' order by ocv.dta_orcamento ';

   Result := OFI_DP_R_FIV_OCV.Data;

   OFI_SQ_R_FIV_OCV.Close;
end;

function TSM.OFI_DP_R_FIV_ORVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFivOrv: String;
  begin
    Result :=
              ' select orv.*, cli.nome as int_nomecli,' + #13#10 +
              '       cpg.descricao as int_nomecpg, ' + #13#10 +
              '       case orv.status' + #13#10 +
              '         when 0 then ''Aberta''' + #13#10 +
              '         when 1 then ''Em Andamento''' + #13#10 +
              '         when 2 then ''Fechada''' + #13#10 +
              '         when 3 then ''Faturada''' + #13#10 +
              '         when 4 then ''Cancelada''' + #13#10 +
              '         when 5 then ''Substituda'''+#13#10 +
              '       else ''??????'' end as int_status, ' + #13#10 +
              '       tio.descricao as int_nometio ' +
              '   from ofi_tb_m_orv orv' + #13#10 +
              ' left outer join cad_tb_c_cli cli on cli.id_cliente = orv.id_cliente' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag = orv.id_condicao_pag ' +
              ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os ' +
              ' where 1=1 ';

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 01/10/2016 }

   {
    input 0 - Placa
    input 1 - Empresa
    input 2 - Perodo
   }

   OFI_SQ_R_FIV_ORV.Close;

   OFI_SQ_R_FIV_ORV.CommandText := enSqlOfiRelFivOrv;

   if VarToStr(Input[0])<>'' then
      OFI_SQ_R_FIV_ORV.CommandText :=  OFI_SQ_R_FIV_ORV.CommandText+
       ' and orv.id_veiculo   in (' + VarToStr(Input[0]) +') ' ;

   if VarToStr(Input[5])<>'' then
      OFI_SQ_R_FIV_ORV.CommandText :=  OFI_SQ_R_FIV_ORV.CommandText+
       ' and orv.id_meq in (' + VarToStr(Input[5]) +') ' ;


    OFI_SQ_R_FIV_ORV.CommandText :=  OFI_SQ_R_FIV_ORV.CommandText+
       '     and orv.id_empresa in (' + VarToStr(Input[1]) +') ' +
       '     and  orv.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
       '     and  orv.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
       '     and  orv.tipo_ordem = '''+VarToStr(Input[4])+ ''' '+
       ' order by orv.dta_emissao ';

   Result := OFI_DP_R_FIV_ORV.Data;

   OFI_SQ_R_FIV_ORV.Close;
end;

function TSM.OFI_DP_R_FIV_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFivPos: String;
  begin
    Result :=
              ' select pos.*,' + #13#10 +
              '    fun.nome as int_nomeresp_pos,' + #13#10 +
              '    cli.nome as int_nomecli,' + #13#10 +
              '    case orv.status' + #13#10 +
              '         when 0 then ''Aberta''' + #13#10 +
              '         when 1 then ''Em Andamento''' + #13#10 +
              '         when 2 then ''Fechada''' + #13#10 +
              '         when 3 then ''Faturada''' + #13#10 +
              '         when 4 then ''Cancelada''' + #13#10 +
              '         when 5 then ''Substituda'''+#13#10 +
              '       else ''??????'' end as int_status,' + #13#10 +
              '    orv.*, ' + #13#10 +
              '    mve.descricao as int_nomemve, cor.descricao as int_nomecor  ' + #13#10 +
              ' from ofi_tb_m_pos pos' + #13#10 +
              '   left outer join cad_tb_c_fun fun on fun.id_funcionario = pos.id_responsavel  ' + #13#10 +
              '   left outer join ofi_tb_m_orv orv on orv.id_ordem = pos.id_ordem' + #13#10 +
              '   left outer join cad_tb_c_vei vei on vei.id_veiculo = orv.id_veiculo ' + #13#10 +
              '   left outer join cad_tb_c_mve mve on mve.id_mve = vei.id_mve ' + #13#10 +
              '   left outer join cad_tb_c_cor cor on cor.id_cor = vei.id_cor ' + #13#10 +
              '   left outer join cad_tb_c_cli cli on cli.id_cliente = orv.id_cliente';

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 01/10/2016 }

   {
    input 0 - Placa
    input 1 - Empresa
    input 2 - Perodo
   }

   OFI_SQ_R_FIV_POS.Close;

   OFI_SQ_R_FIV_POS.CommandText := enSqlOfiRelFivPos +
       ' where orv.id_veiculo   in (' + VarToStr(Input[0]) +')'    +
       '     and  pos.id_empresa in (' + VarToStr(Input[1]) +') ' +
       '     and  pos.dta_posvenda >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '+
       '     and  pos.dta_posvenda <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' '+
       '     and  orv.tipo_ordem= '''+ VarToStr(Input[4])+''' '+
       ' order by pos.dta_posvenda ';

   Result := OFI_DP_R_FIV_POS.Data;

   OFI_SQ_R_FIV_POS.Close;
end;

function TSM.OFI_DP_R_FIV_VEIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFivVei: String;
  begin
    Result :=
              ' select vei.*,' + #13#10 +
              '   case vei.alimentacao ' + #13#10 +
              '     when 0 then ''Injeo Eletrnica''' + #13#10 +
              '     when 1 then ''Carburador''' + #13#10 +
              '     when 2 then ''Bomba Injetora''' + #13#10 +
              '   else ''??????'' end as int_alimentacao,' + #13#10 +
              '   case vei.combustivel' + #13#10 +
              '     when 0 then ''Gasolina''' + #13#10 +
              '     when 1 then ''Alcool''' + #13#10 +
              '     when 2 then ''Diesel''' + #13#10 +
              '     when 3 then ''Gas Natural''' + #13#10 +
              '     when 4 then ''Eletrico''' + #13#10 +
              '     when 5 then ''Flex''' + #13#10 +
              '   else ''??????'' end as int_combustivel,' + #13#10 +
              '  ' + #13#10 +
              '   case vei.tipo' + #13#10 +
              '     when 0 then ''Veiculo''' + #13#10 +
              '     when 1 then ''Trator/Implemento''' + #13#10 +
              '   else ''??????'' end as int_tipo,' + #13#10 +
              '  ' + #13#10 +
              '   case vei.tipo_rodado' + #13#10 +
              '     when 0 then ''No Aplicavel'' ' + #13#10 +
              '     when 1 then ''Truck'' ' + #13#10 +
              '     when 2 then ''Toco'' ' + #13#10 +
              '     when 3 then ''Cavalo Mecanico''' + #13#10 +
              '     when 4 then ''VAN'' ' + #13#10 +
              '     when 5 then ''Utilitario'' ' + #13#10 +
              '     when 6 then ''Outros''' + #13#10 +
              '   else ''??????'' end as int_tipo_rodado,' + #13#10 +
              '  ' + #13#10 +
              '   case vei.tipo_carroceria' + #13#10 +
              '     when 0 then ''NaoAplicavel'' ' + #13#10 +
              '     when 1 then ''Aberta'' ' + #13#10 +
              '     when 2 then ''Fechada''' + #13#10 +
              '     when 3 then ''Graneleira'' ' + #13#10 +
              '     when 4 then ''PortaContainer'' ' + #13#10 +
              '     when 5 then ''Sider''' + #13#10 +
              '   else ''??????'' end as int_tipo_carroceria, ' + #13#10 +
              '   cor.descricao as int_nomecor, mve.descricao as int_nomemve ' +
              ' from cad_tb_c_vei vei ' + #13#10 +
              '  left outer join cad_tb_c_cor cor on cor.id_cor = vei.id_cor ' + #13#10 +
              '  left outer join cad_tb_c_mve mve on mve.id_mve = vei.id_mve ' + #13#10;

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 01/10/2016 }

   {
    input 0 - Veculo
   }

   OFI_SQ_R_FIV_VEI.Close;

   OFI_SQ_R_FIV_VEI.CommandText := enSqlOfiRelFivVei +
             ' where vei.id_veiculo in (' + VarToStr(Input[0]) +')' +
             '  and vei.tipo ='''+VarToStr(Input[1])+''' '+
             ' order by vei.descricao ';
   Result := OFI_DP_R_FIV_VEI.Data;

   OFI_SQ_R_FIV_VEI.Close;
end;


function TSM.OFI_DP_R_HIVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelOfiHiv: String;
  begin
    Result :=
        '  SELECT ORV.*,                                        '+
        '     CLI.NOME AS INT_NOMECLI,                          '+
        '     CLI.TEL_FIXO AS INT_TELFIX,                       '+
        '     CLI.TEL_MOVEL AS INT_TELMOV,                      '+
        '     CLI.DOC_CNPJ_CPF AS INT_CNPJCPFCLI,               '+
        '     CLI.ENDERECO AS INT_ENDERECOCLI, CLI.BAIRRO AS INT_BAIRROCLI, ' +
        '     CLI.CEP AS INT_CEPCLI, CID.NOME AS INT_NOMECID, CID.UF AS INT_UFCID, CLI.NUMERO AS INT_NUMEROCLI, ' +
        '     case                                              '+
        '       when VEI.COMBUSTIVEL = 0 then ''Gasolina''      '+
        '       when VEI.COMBUSTIVEL = 1 then ''Alcool''        '+
        '       when VEI.COMBUSTIVEL = 2 then ''Diesel''        '+
        '       when VEI.COMBUSTIVEL = 3 then ''Gas Natural''   '+
        '       when VEI.COMBUSTIVEL = 4 then ''Eletrico''      '+
        '       when VEI.COMBUSTIVEL = 5 then ''Flex''          '+
        '     end as INT_NOMECOM,                               '+
        '     VEI.ID_PLACA AS INT_PLACA, VEI.DESCRICAO AS INT_NOMEVEI, '+
        '     VEI.CHASSI AS INT_CHASSIVEI, VEI.ANO_MODELO AS INT_ANOMODELO, ' +
        '     VEI.ANO_FABRICACAO AS INT_ANOFABRIC, VEI.MOTOR AS INT_MOTORVEI, ' +
        '     MVE.DESCRICAO AS INT_MODELOMVE, COR.DESCRICAO AS INT_NOMECOR,  ' +
        '     MEQ.DESCRICAO AS INT_NOMEMEQ, MDE.DESCRICAO AS INT_NOMEMDE, '+
        '     case                                              '+
        '       when MEQ.COMBUSTIVEL = 0 then ''Gasolina''      '+
        '       when MEQ.COMBUSTIVEL = 1 then ''Alcool''        '+
        '       when MEQ.COMBUSTIVEL = 2 then ''Diesel''        '+
        '       when MEQ.COMBUSTIVEL = 3 then ''Gas Natural''   '+
        '       when MEQ.COMBUSTIVEL = 4 then ''Eletrico''      '+
        '       when MEQ.COMBUSTIVEL = 5 then ''Flex''          '+
        '     end as INT_NOMECOM_MEQ,                           '+
        '     MEQ.CHASSI AS INT_CHASSI_MEQ,MEQ.ID_PLACA AS INT_PLACA_MEQ, '+
        '     TIO.DESCRICAO AS INT_NOMETIO,                      ' +
        '     CPG.DESCRICAO AS int_nomecpg, ANA.NOME AS INT_NOMEANA,  ' +
        '     eqp.descricao as int_nomeeqp, eqp.modelo as int_modeloeqp, ' +
        '     eqp.serial as int_serialeqp, eqp.garantia as int_garantiaeqp ' +
        '  FROM OFI_TB_M_ORV ORV                                ' +
        '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE            ' +
        '  LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA       ' +
        '  LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO            ' +
        '  LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ=ORV.ID_MEQ                    ' +
        '  LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE=MEQ.ID_MDE                    ' +
        '  left outer join cad_tb_c_eqp eqp on                                          ' +
        '       eqp.id_equipamento = orv.id_equipamento                                 ' +
        '  LEFT OUTER JOIN CAD_TB_C_MVE MVE ON MVE.ID_MVE=VEI.ID_MVE                    ' +
        '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG        ' +
        '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG  ' +
        '  LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS ' +
        '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE ' +
        '  LEFT OUTER JOIN CAD_TB_C_COR COR ON COR.ID_COR = VEI.ID_COR ';
  end;
var
  CondicaoOrder:String;
begin
   OFI_SQ_R_HIV.Close;
   OFI_SQ_R_HIV.CommandText := enSqlRelOfiHiv +
             ' WHERE ORV.DTA_EMISSAO >= ''' + VarToStr(Input[1]) +''' AND ORV.DTA_EMISSAO <= '''+VarToStr(Input[2]) +''' ';

   if VarToStr(Input[3])<>'' then
     begin
       OFI_SQ_R_HIV.CommandText := OFI_SQ_R_HIV.CommandText +
          ' and orv.id_empresa in ('+VarToStr(Input[3])+') ';
     end;

   if VarToStr(Input[4])<>'' then
     begin
       OFI_SQ_R_HIV.CommandText := OFI_SQ_R_HIV.CommandText +
          ' and orv.id_veiculo in ('+VarToStr(Input[4])+') ';

     end;

   if VarToStr(Input[5])<>'' then
     begin
       OFI_SQ_R_HIV.CommandText := OFI_SQ_R_HIV.CommandText +
          ' and orv.tipo_ordem = '''+VarToStr(Input[5])+''' ';
     end;
  if VarToStr(Input[6])<>'' then
     begin
       OFI_SQ_R_HIV.CommandText := OFI_SQ_R_HIV.CommandText +
          ' and orv.id_meq in ('+VarToStr(Input[6])+') ';

     end;

  CondicaoOrder:= 'ORV.ID_VEICULO,';
  if VarToStr(Input[5])='4' then
     begin
       CondicaoOrder:= 'ORV.ID_MEQ,';
     end;


    OFI_SQ_R_HIV.CommandText := OFI_SQ_R_HIV.CommandText + ' ORDER BY '+CondicaoOrder+'ORV.DTA_EMISSAO DESC ';


   Result := OFI_DP_R_HIV.Data;
   OFI_SQ_R_HIV.Close;
end;

function TSM.OFI_DP_R_OFV_ABC_001DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvAbc001: String;
  begin
    Result :=
              ' select vei.id_mve, mve.descricao, sum(vlr_liquido) as vlr_liquido_pro_ser,    ' + #13#10 +
              '		(select sum(vlr_liquido) as vlr_liquido_pro_ser' + #13#10 +
              '   ' + #13#10 +
              '		from ofi_tb_m_orv_ite ori' + #13#10 +
              '	   left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '		 left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '		 left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              '		where ' + #13#10 +
              '				ori.cancelada = false and orv.status = 3 ' + #13#10 +
              '     and  orv.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
              '     and  orv.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
              if Input[2] <> '' then
                 begin
                   Result := Result +
                        ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
                 end;

              if Input[3] <> '' then
                 begin
                   Result := Result +
                         ' and ORV.id_tipo_os in (' + VarToStr(Input[3]) +')';
                 end;

              if Input[4] <> '' then
                 begin
                   Result := Result +
                         ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
                 end;

     Result := Result +
              '     ) as vlr_total       ' + #13#10 +
              '   ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              '  left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '  left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '  left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              ' where ' + #13#10 +
              '   ori.cancelada = false and orv.status = 3 ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Tipo de O.S
          4 - Modelo de Veculo
   }

   OFI_SQ_R_OFV_ABC_001.Close;

   OFI_SQ_R_OFV_ABC_001.CommandText := enSqlOfiRelOfvAbc001 +
            '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_001.CommandText := OFI_SQ_R_OFV_ABC_001.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_001.CommandText := OFI_SQ_R_OFV_ABC_001.CommandText +
             ' and ORV.id_tipo_os in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_001.CommandText := OFI_SQ_R_OFV_ABC_001.CommandText +
             ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
      end;

   OFI_SQ_R_OFV_ABC_001.CommandText := OFI_SQ_R_OFV_ABC_001.CommandText +
              ' group by vei.id_mve, mve.descricao' + #13#10 +
              ' order by 3 desc ';
   Result := OFI_DP_R_OFV_ABC_001.Data;

   OFI_SQ_R_OFV_ABC_001.Close;
end;

function TSM.OFI_DP_R_OFV_ABC_002DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvAbc002: String;
  begin
    Result :=
              ' select  orv.id_tipo_os, tio.descricao, sum(vlr_liquido) as vlr_liquido_pro_ser,' + #13#10 +
              '		(select sum(vlr_liquido) as vlr_liquido_pro_ser' + #13#10 +
              '   ' + #13#10 +
              '		from ofi_tb_m_orv_ite ori' + #13#10 +
              '            left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '            left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '            left outer join ofi_tb_c_tio tio on (orv.id_tipo_os   = tio.id_tipo_os)' + #13#10 +
              '            left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              '		where' + #13#10 +
              '				ori.cancelada = false and orv.status=3' + #13#10 +
              '     and  orv.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
              '     and  orv.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
              if Input[2] <> '' then
                 begin
                   Result := Result +
                        ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
                 end;

              if Input[3] <> '' then
                 begin
                   Result := Result +
                         ' and orv.id_tipo_os in (' + VarToStr(Input[3]) +')';
                 end;

              if Input[4] <> '' then
                 begin
                   Result := Result +
                         ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
                 end;
    result := result +
              '     ) as vlr_total       ' + #13#10 +
              '   ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              '  left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '  left outer join ofi_tb_c_tio tio on (orv.id_tipo_os   = tio.id_tipo_os)' + #13#10 +
              '  left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '  left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              ' where' + #13#10 +
              '   ori.cancelada = false  and orv.status=3 ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Tipo de O.S
          4 - Modelo de Veculo
   }

   OFI_SQ_R_OFV_ABC_002.Close;

   OFI_SQ_R_OFV_ABC_002.CommandText := enSqlOfiRelOfvAbc002 +
            '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_002.CommandText := OFI_SQ_R_OFV_ABC_002.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_002.CommandText := OFI_SQ_R_OFV_ABC_002.CommandText +
             ' and orv.id_tipo_os in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_002.CommandText := OFI_SQ_R_OFV_ABC_002.CommandText +
             ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
      end;

   OFI_SQ_R_OFV_ABC_002.CommandText := OFI_SQ_R_OFV_ABC_002.CommandText +
              ' group by orv.id_tipo_os, tio.descricao' + #13#10 +
              ' order by 3 desc';
   Result := OFI_DP_R_OFV_ABC_002.Data;

   OFI_SQ_R_OFV_ABC_002.Close;
end;

function TSM.OFI_DP_R_OFV_ABC_003DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvAbc003: String;
  begin
    Result :=
              ' select mve.id_mar, mar.descricao, sum(vlr_liquido) as vlr_liquido_pro_ser,' + #13#10 +
              '		(select sum(vlr_liquido) as vlr_liquido_pro_ser' + #13#10 +
              '   ' + #13#10 +
              '		from ofi_tb_m_orv_ite ori' + #13#10 +
              '            left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '            left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '            left outer join ofi_tb_c_tio tio on (orv.id_tipo_os   = tio.id_tipo_os)' + #13#10 +
              '            left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              '		where' + #13#10 +
              '				ori.cancelada = false and orv.status=3' + #13#10 +
              '     and  orv.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
              '     and  orv.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
              if Input[2] <> '' then
                 begin
                   Result := Result +
                        ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
                 end;

              if Input[3] <> '' then
                 begin
                   Result := Result +
                         ' and orv.id_tipo_os in (' + VarToStr(Input[3]) +')';
                 end;

              if Input[4] <> '' then
                 begin
                   Result := Result +
                         ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
                 end;
    result := result +
              '     ) as vlr_total       ' + #13#10 +
              '   ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              '  left outer join ofi_tb_m_orv orv on (orv.id_ordem   = ori.id_ordem)' + #13#10 +
              '  left outer join ofi_tb_c_tio tio on (orv.id_tipo_os   = tio.id_tipo_os)' + #13#10 +
              '  left outer join cad_tb_c_vei vei on (orv.id_veiculo = vei.id_veiculo)' + #13#10 +
              '  left outer join cad_tb_c_mve mve on (vei.id_mve     = mve.id_mve)' + #13#10 +
              '  left outer join cad_tb_c_mar mar on (mar.id_mar = mve.id_mar)' + #13#10 +
              ' where' + #13#10 +
              '   ori.cancelada = false  and orv.status=3 ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 30/09/2016 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Tipo de O.S
          4 - Modelo de Veculo
   }

   OFI_SQ_R_OFV_ABC_003.Close;

   OFI_SQ_R_OFV_ABC_003.CommandText := enSqlOfiRelOfvAbc003 +
            '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_003.CommandText := OFI_SQ_R_OFV_ABC_003.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_003.CommandText := OFI_SQ_R_OFV_ABC_003.CommandText +
             ' and orv.id_tipo_os in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_ABC_003.CommandText := OFI_SQ_R_OFV_ABC_003.CommandText +
             ' and mve.id_mve in (' + VarToStr(Input[4]) +')';
      end;

   OFI_SQ_R_OFV_ABC_003.CommandText := OFI_SQ_R_OFV_ABC_003.CommandText +
              ' group by 1, 2' + #13#10 +
              ' order by 3 desc';
   Result := OFI_DP_R_OFV_ABC_003.Data;

   OFI_SQ_R_OFV_ABC_003.Close;
end;

function TSM.OFI_DP_R_OFV_COM_001DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvCom001: String;
  begin
    Result :=
          {    ' select ' + #13#10 +
              '             mec.nome   as    int_nomemec,' + #13#10 +
              '             orv.id_ordem, orv.dta_emissao,' + #13#10 +
              '             orv.id_cliente,cli.nome as int_nomecli,' + #13#10 +
              '             ana.nome as int_nomeana,' + #13#10 +
              '             cpg.descricao as int_nomecpg,' + #13#10 +
              '             vei.id_veiculo,' + #13#10 +
              '             vei.id_placa as int_placa,   vei.descricao as int_nomevei,ori.id_mecanico,' + #13#10 +
              '             tio.descricao as int_nometio, ' + #13#10 +
              '           case orv.status' + #13#10 +
              '             when  0 then ''aberta''' + #13#10 +
              '             when 1 then ''em andamento''' + #13#10 +
              '             when 2 then ''fechada''' + #13#10 +
              '             when 3 then ''faturada''' + #13#10 +
              '             when 4 then ''cancelada''' + #13#10 +
              '           end as int_orvsituacao,' + #13#10 +
              '           orv.can_data, orv.can_motivo, ' + #13#10 +
              '           orv.dta_fechamento, ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then vlr_desconto   ' + #13#10 +
              '             end),0) as   vlr_desc_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then vlr_desconto ' + #13#10 +
              '             end),0) as   vlr_desc_peas ,    ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then vlr_liquido   ' + #13#10 +
              '             end),0) as   vlr_total_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then vlr_liquido ' + #13#10 +
              '             end),0) as   vlr_total_peas     ' + #13#10 +
              '                             ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              ' left outer join cad_tb_c_ite    ite  on  ite.id_item=ori.id_item' + #13#10 +
              ' left outer join cad_tb_c_gru   gru on  gru.id_grupo = ite.id_grupo' + #13#10 +
              ' left outer join cad_tb_c_fun mec on  mec.id_funcionario=ori.id_mecanico' + #13#10 +
              ' left outer join ofi_tb_m_orv orv on orv.id_ordem =ori.id_ordem' + #13#10 +
              ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os ' + #13#10 +
              ' left outer join cad_tb_c_fun ana on ana.id_funcionario=orv.id_analista' + #13#10 +
              ' left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
              ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo' + #13#10 +
              ' where ori.cancelada = false  and orv.status = 3 '; // + #13#10 +  }
             // '   and gru.tipo_item = ''09''' ;

  //Result :=
              ' select ' + #13#10 +
              '             mec.nome   as    int_nomemec,' + #13#10 +
              '             MEC.PER_COMISSAO AS INT_PER_COMISSAO, '+ #13#10 +
              '             orv.id_ordem, orv.dta_emissao,' + #13#10 +
              '             orv.id_cliente,cli.nome as int_nomecli,' + #13#10 +
              '             ana.nome as int_nomeana,' + #13#10 +
              '             cpg.descricao as int_nomecpg,' + #13#10 +
              '             vei.id_veiculo,' + #13#10 +
              '             vei.id_placa as int_placa,   vei.descricao as int_nomevei,ori.id_mecanico,' + #13#10 +
              '             tio.descricao as int_nometio, ' + #13#10 +
              '           case orv.status' + #13#10 +
              '             when  0 then ''aberta''' + #13#10 +
              '             when 1 then ''em andamento''' + #13#10 +
              '             when 2 then ''fechada''' + #13#10 +
              '             when 3 then ''faturada''' + #13#10 +
              '             when 4 then ''cancelada''' + #13#10 +
              '           end as int_orvsituacao,' + #13#10 +
              '           orv.can_data, orv.can_motivo, ' + #13#10 +
              '           orv.dta_fechamento, ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then ttt.vlr_desconto   ' + #13#10 +
              '             end),0) as   vlr_desc_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then ttt.vlr_desconto ' + #13#10 +
              '             end),0) as   vlr_desc_peas ,    ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then    ' + #13#10 +
              '                               (COALESCE(ttt.VLR_UNITARIO*(ttt.QTDE-ttt.QTDE_DEVOLVIDA),0)) - ' +
              '                               ((COALESCE(ttt.VLR_DESCONTO,0)/ttt.QTDE)*(ttt.qtde-ttt.qtde_devolvida)) ' +
              '             end),0) as   vlr_total_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then  ' + #13#10 +
              '                               (COALESCE(ttt.VLR_UNITARIO*(ttt.QTDE-ttt.QTDE_DEVOLVIDA),0)) - ' +
              '                               ((COALESCE(ttt.VLR_DESCONTO,0)/ttt.QTDE)*(ttt.qtde-ttt.qtde_devolvida)) ' +
              '             end),0) as   vlr_total_peas     ' + #13#10 +
              '                             ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              ' left outer join cad_tb_c_ite ite  on  ite.id_item=ori.id_item' + #13#10 +
              ' left outer join cad_tb_c_gru gru on  gru.id_grupo = ite.id_grupo' + #13#10 +
              ' left outer join cad_tb_c_fun mec on  mec.id_funcionario=ori.id_mecanico' + #13#10 +
              ' left outer join ofi_tb_m_orv orv on orv.id_ordem =ori.id_ordem' + #13#10 +
              ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os ' + #13#10 +
              ' left outer join cad_tb_c_fun ana on ana.id_funcionario=orv.id_analista' + #13#10 +
              ' left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
              ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo' + #13#10 +
              ' left outer join (select nfe.id_ordem,nfe.tipo_nf, CFO.ID_CLASSE,nfe.status, nfe.faturada,nfe.nfe_cod_sit,nfe.dta_emissao, nfe.ind_nf, inf.id_item, inf.id_sequencia, inf.qtde, ' + #13#10 +
              '                           inf.vlr_unitario,inf.qtde_devolvida, inf.vlr_desconto, inf.vlr_liquido ' + #13#10 +
              '                  from   fat_tb_m_nfe_ite inf ' + #13#10 +
              '                        left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = inf.id_fiscal' + #13#10 +
              '                        LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO ' + #13#10 +
              '                 ) ttt on ttt.id_ordem = ori.id_ordem ' + #13#10 +
              '                    and  ttt.id_item = ori.id_item ' + #13#10 +
              '                    and  ttt.id_sequencia = ori.id_sequencia ' +
              ' where ' +
              '    ttt.ID_CLASSE IN (''SP10'',''SP70'') AND ttt.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
              '    ttt.STATUS = 1 AND ttt.FATURADA = true AND ttt.TIPO_NF=''S'' AND ' +
              '    ori.cancelada = false  and orv.status = 3 ' ;


  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Mecnico
          4 - Veculo
          5 - Condio de pagamento
   }

   OFI_SQ_R_OFV_COM_001.Close;

   OFI_SQ_R_OFV_COM_001.CommandText := enSqlOfiRelOfvCom001 +
            '   AND  ttt.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
            '   AND  ttt.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ';

          //  '   AND  ORV.dta_fechamento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
          //  '   AND  ORV.dta_fechamento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ' ;


   if Input[2] <> '' then
      begin
        OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
             ' and ORI.id_mecanico in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
             ' and ORV.id_veiculo in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
             ' and ORV.id_condicao_pag in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
             ' and ORV.tipo_ordem in (' + VarToStr(Input[6]) +')';
      end;


   OFI_SQ_R_OFV_COM_001.CommandText := OFI_SQ_R_OFV_COM_001.CommandText +
                 ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17 ' + #13#10 +
                 ' order by orv.dta_emissao, orv.id_ordem ';

   //CMServerForm.mm.Lines.Add(OFI_SQ_R_OFV_COM_001.CommandText);
   Result := OFI_DP_R_OFV_COM_001.Data;

   OFI_SQ_R_OFV_COM_001.Close;

end;

function TSM.OFI_DP_R_OFV_COM_002DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvCom002: String;
  begin
    Result :=
              ' select ' + #13#10 +
              '           ori.id_mecanico,' + #13#10 +
              '           mec.nome   as    int_nomemec,' + #13#10 +
              '           MEC.PER_COMISSAO AS INT_PER_COMISSAO, '+ #13#10 +
              '           ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then ttt.vlr_desconto   ' + #13#10 +
              '             end),0) as   vlr_desc_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then ttt.vlr_desconto ' + #13#10 +
              '             end),0) as   vlr_desc_peas ,    ' + #13#10 +

              '            coalesce( sum (case gru.tipo_item ' + #13#10 +
              '               when ''09'' then    ' + #13#10 +
              '                               (COALESCE(ttt.VLR_UNITARIO*(ttt.QTDE-ttt.QTDE_DEVOLVIDA),0)) - ' +
              '                               ((COALESCE(ttt.VLR_DESCONTO,0)/ttt.QTDE)*(ttt.qtde-ttt.qtde_devolvida)) ' +
              '             end),0) as   vlr_total_servicos ,' + #13#10 +
              '                                              ' + #13#10 +
              '            coalesce( sum(case                ' + #13#10 +
              '               when gru.tipo_item  <> ''09'' then  ' + #13#10 +
              '                               (COALESCE(ttt.VLR_UNITARIO*(ttt.QTDE-ttt.QTDE_DEVOLVIDA),0)) - ' +
              '                               ((COALESCE(ttt.VLR_DESCONTO,0)/ttt.QTDE)*(ttt.qtde-ttt.qtde_devolvida)) ' +
              '             end),0) as   vlr_total_peas     ' + #13#10 +
              ' from ofi_tb_m_orv_ite ori' + #13#10 +
              '  left outer join cad_tb_c_ite    ite  on  ite.id_item=ori.id_item' + #13#10 +
              '  left outer join cad_tb_c_gru   gru on  gru.id_grupo = ite.id_grupo' + #13#10 +
              '  left outer join cad_tb_c_fun mec on  mec.id_funcionario=ori.id_mecanico' + #13#10 +
              '  left outer join ofi_tb_m_orv orv on orv.id_ordem =ori.id_ordem' + #13#10 +
              '  left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
              '  left outer join (select nfe.id_ordem,nfe.tipo_nf, CFO.ID_CLASSE,nfe.status, nfe.faturada,nfe.nfe_cod_sit,nfe.dta_emissao, nfe.ind_nf, inf.id_item, inf.id_sequencia, inf.qtde, ' + #13#10 +
              '                           inf.vlr_unitario,inf.qtde_devolvida, inf.vlr_desconto, inf.vlr_liquido ' + #13#10 +
              '                   from   fat_tb_m_nfe_ite inf ' + #13#10 +
              '                        left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = inf.id_fiscal' + #13#10 +
              '                        LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO ' + #13#10 +
              '                   ) ttt on ttt.id_ordem = ori.id_ordem ' + #13#10 +
              '                    and  ttt.id_item = ori.id_item ' + #13#10 +
              '                    and  ttt.id_sequencia = ori.id_sequencia ' +
              ' where ' +
              '    ttt.ID_CLASSE IN (''SP10'',''SP70'') AND ttt.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
              '    ttt.STATUS = 1 AND ttt.FATURADA = true AND ttt.TIPO_NF=''S'' AND ' +
              '    ori.cancelada = false and orv.status = 3 ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Mecnico
          4 - Veculo
          5 - Condio de pagamento
   }

   OFI_SQ_R_OFV_COM_002.Close;

   OFI_SQ_R_OFV_COM_002.CommandText := enSqlOfiRelOfvCom002 +
            '   AND  ttt.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
            '   AND  ttt.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ';

//            '   AND  ORV.dta_fechamento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
  //          '   AND  ORV.dta_fechamento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ';


   if Input[2] <> '' then
      begin
        OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
             ' and ORI.id_mecanico in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
             ' and ORV.id_veiculo in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
             ' and ORV.id_condicao_pag in (' + VarToStr(Input[5]) +')';
      end;

    if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
             ' and ORV.tipo_ordem in (' + VarToStr(Input[6]) +')';
      end;


   OFI_SQ_R_OFV_COM_002.CommandText := OFI_SQ_R_OFV_COM_002.CommandText +
                 ' group by 1,2,3 ' + #13#10 +
                 ' order by mec.nome ';

   //CMServerForm.mm.Lines.Add(OFI_SQ_R_OFV_COM_002.CommandText);
   Result := OFI_DP_R_OFV_COM_002.Data;

   OFI_SQ_R_OFV_COM_002.Close;

end;

function TSM.OFI_DP_R_OFV_FIVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelFiv: String;
  begin
    Result :=
              ' SELECT' + #13#10 +
              '       ORV.*,' + #13#10 +
              '       CLI.doc_cnpj_cpf AS INT_CPFCNPJ,' + #13#10 +
              '       CLI.pessoa as int_pessoacli,' + #13#10 +
              '       CLI.NOME AS INT_NOMECLI,' + #13#10 +
              '       CLI.TEL_FIXO AS INT_TELFIX,' + #13#10 +
              '       CLI.TEL_MOVEL AS INT_TELMOV,' + #13#10 +
              '       case' + #13#10 +
              '         when VEI.COMBUSTIVEL = 0 then ''Gasolina''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 1 then ''Alcool''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 2 then ''Diesel''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 3 then ''Gas Natural''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 4 then ''Eletrico''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 5 then ''Flex''' + #13#10 +
              '       end as INT_NOMECOM,' + #13#10 +
              '       VEI.ID_PLACA AS INT_PLACA,   VEI.DESCRICAO AS INT_NOMEVEI,' + #13#10 +
              '       meq.descricao as int_nomemeq,meq.nro_serie as int_seriemeq, '+ #13#10 +
              '       mde.descricao as int_modelomeq,                    '+  #13#10 +
              '       TIO.DESCRICAO AS INT_NOMETIO,' + #13#10 +
              '       CID.UF AS INT_UFCLI' + #13#10 +
              ' FROM OFI_TB_M_ORV ORV' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO' + #13#10 +
              ' LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ '+ #13#10 +
              ' LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE = MEQ.ID_MDE '+ #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG' + #13#10 +
              ' LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE' + #13#10;

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
   }

   OFI_SQ_R_OFV_FIV.Close;

   OFI_SQ_R_OFV_FIV.CommandText := enSqlOfiRelFiv +
            ' WHERE  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
            '   AND  ORV.STATUS = 3 ';
   if Input[4] = '1' then
       OFI_SQ_R_OFV_FIV.CommandText := OFI_SQ_R_OFV_FIV.CommandText +
            ' AND  upper(VEI.ID_PLACA) = ''' + VarToStr(Input[2]) +''' ';
   if Input[4] = '2' then
       OFI_SQ_R_OFV_FIV.CommandText := OFI_SQ_R_OFV_FIV.CommandText +
            ' AND  MEQ.ID_MEQ = ''' + VarToStr(Input[2]) +''' ';

   if Input[3] <> '' then
      begin
        OFI_SQ_R_OFV_FIV.CommandText := OFI_SQ_R_OFV_FIV.CommandText +
             ' and ORV.id_empresa in (' + VarToStr(Input[3]) +')';
      end;

   OFI_SQ_R_OFV_FIV.CommandText := OFI_SQ_R_OFV_FIV.CommandText + ' order by ORV.DTA_EMISSAO, ORV.ID_ORDEM ';

   Result := OFI_DP_R_OFV_FIV.Data;

   OFI_SQ_R_OFV_FIV.Close;
end;

function TSM.OFI_DP_R_OFV_POC_001DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvPoc01: String;
  begin
    Result :=
           '  SELECT                                   '+
           '    OCV.*,                                 '+
           '    CLI.doc_cnpj_cpf AS INT_CPFCNPJ,       '+
           '    CLI.pessoa as int_pessoacli,           '+
           '    CLI.NOME AS INT_NOMECLI,               '+
           '    CLI.TEL_FIXO AS INT_TELFIX,            '+
           '    CLI.TEL_MOVEL AS INT_TELMOV,           '+
           '    case ocv.status                        '+
           '      when  0 then ''Em Aberto''            '+
           '      when 1 then ''Importado''            '+
           '      when 2 then ''Cancelado''            '+
           '    end as INT_OCVSITUACAO,                '+
           '    case                                              '+
           '      when VEI.COMBUSTIVEL = 0 then ''Gasolina''      '+
           '      when VEI.COMBUSTIVEL = 1 then ''Alcool''        '+
           '      when VEI.COMBUSTIVEL = 2 then ''Diesel''        '+
           '      when VEI.COMBUSTIVEL = 3 then ''Gas Natural''   '+
           '      when VEI.COMBUSTIVEL = 4 then ''Eletrico''      '+
           '      when VEI.COMBUSTIVEL = 5 then ''Flex''          '+
           '    end as INT_NOMECOM,                                                           '+
           '    VEI.ID_PLACA AS INT_PLACA,   VEI.DESCRICAO AS INT_NOMEVEI,                    '+

           '    CID.UF AS INT_UFCLI, FUN.NOME AS INT_NOMEFUN, CPG.DESCRICAO AS INT_NOMECPG    '+
           '    FROM OFI_TB_M_OCV OCV                                                         '+
           '    LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCV.ID_CLIENTE             '+
           '    LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=OCV.ID_FUNCIONARIO        '+
           '    LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_PLACA=OCV.PLACA                    '+
           '    LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCV.ID_CONDICAO_PAG   '+
           '    LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE             '+
           '   WHERE 1 = 1                                                                    ';

  end;
begin

   { TODO -oLuan -cCriao : Criado em 08/12/2016 }



   OFI_SQ_R_OFV_POC_001.Close;
    OFI_SQ_R_OFV_POC_001.CommandText := enSqlOfiRelOfvPoc01;
   if Input[0] <> '' then
      begin

             OFI_SQ_R_OFV_POC_001.CommandText :=  OFI_SQ_R_OFV_POC_001.CommandText +
                  '   AND  OCV.DTA_ORCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  OCV.DTA_ORCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


      end;

   if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POC_001.CommandText :=  OFI_SQ_R_OFV_POC_001.CommandText +
                  '   AND  OCV.ID_FUNCIONARIO IN (' + VarToStr(Input[2]) + ') ';
      end;

   if Input[3] <> '' then
      begin
         OFI_SQ_R_OFV_POC_001.CommandText := OFI_SQ_R_OFV_POC_001.CommandText +
                  ' AND OCV.status = ''' + VarToStr(Input[3]) +''' ';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_POC_001.CommandText := OFI_SQ_R_OFV_POC_001.CommandText +
             ' AND OCV.id_empresa in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POC_001.CommandText := OFI_SQ_R_OFV_POC_001.CommandText +
             ' AND OCV.tipo_orcamento in (' + VarToStr(Input[5]) +')';
      end;

   OFI_SQ_R_OFV_POC_001.CommandText := OFI_SQ_R_OFV_POC_001.CommandText + ' order by OCV.DTA_ORCAMENTO, OCV.ID_ORCAMENTO ';

   Result := OFI_DP_R_OFV_POC_001.Data;

   OFI_SQ_R_OFV_POC_001.Close;
end;

function TSM.OFI_DP_R_OFV_POC_002DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvPoc02: String;
  begin
    Result :=
           ' SELECT  '+
           '  OCV.ID_ORCAMENTO, OCV.DTA_ORCAMENTO,OCV.DTA_VALIDADE,      '+
           '  OCV.ID_CLIENTE,                                            '+
           '  CLI.NOME AS INT_NOMECLI,OCV.id_funcionario,                '+
           '  FUN.NOME AS INT_NOMEFUN,                                   '+
           '  CPG.DESCRICAO AS INT_NOMECPG,                              '+
           '  VEI.ID_VEICULO,                                            '+
           '  VEI.ID_PLACA AS INT_PLACA,   VEI.DESCRICAO AS INT_NOMEVEI, '+
           ' cast( case OCV.status                                       '+
           '  when 0 then ''Em Aberto''                                    '+
           '  when 1 then ''Importado''                                    '+
           '  when 2 then ''Cancelado''                                    '+
           ' end as varchar(20)) as INT_OCVSITUACAO,                     '+

           ' sum(case gru.tipo_item                                      '+
           '   when ''09''  then vlr_liquido                               '+
           ' end) as vlr_liquido_ser,                                    '+

           ' sum(case                                                    '+
           '   when  gru.tipo_item <> ''09''  then vlr_liquido             '+
           ' end) as vlr_liquido_pro                                     '+

           ' FROM OFI_TB_M_OCV_ITE OCI                                                    '+
           ' LEFT OUTER JOIN CAD_TB_C_ITE ITE  ON  ITE.ID_ITEM=OCI.ID_ITEM             '+
           ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON  GRU.ID_GRUPO = ITE.ID_GRUPO           '+
           ' LEFT OUTER JOIN OFI_TB_M_OCV OCV ON OCV.ID_ORCAMENTO =OCI.ID_ORCAMENTO       '+
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=OCV.ID_FUNCIONARIO    '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=OCV.ID_CLIENTE            '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=OCV.ID_CONDICAO_PAG  '+
           ' LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_PLACA=OCV.PLACA                   '+
           ' WHERE  1 = 1 ';
  end;
begin

   { TODO -oLuan -cCriao : Criado em 08/12/2016 }

    OFI_SQ_R_OFV_POC_002.Close;
    OFI_SQ_R_OFV_POC_002.CommandText := enSqlOfiRelOfvPoc02;
   if Input[0] <> '' then
      begin
       OFI_SQ_R_OFV_POC_002.CommandText :=  OFI_SQ_R_OFV_POC_002.CommandText +
            '   AND  OCV.DTA_ORCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
            '   AND  OCV.DTA_ORCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;

   if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POC_002.CommandText :=  OFI_SQ_R_OFV_POC_002.CommandText +
                  '   AND  OCV.ID_FUNCIONARIO IN (' + VarToStr(Input[2]) + ') ';
      end;

   if Input[3] <> '' then
      begin
         OFI_SQ_R_OFV_POC_002.CommandText := OFI_SQ_R_OFV_POC_002.CommandText +
                  ' AND OCV.status = ''' + VarToStr(Input[3]) +''' ';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_OFV_POC_002.CommandText := OFI_SQ_R_OFV_POC_002.CommandText +
             ' AND OCV.id_empresa in (' + VarToStr(Input[4]) +')';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POC_002.CommandText := OFI_SQ_R_OFV_POC_002.CommandText +
             ' AND OCV.tipo_orcamento in (' + VarToStr(Input[5]) +')';
      end;

   OFI_SQ_R_OFV_POC_002.CommandText := OFI_SQ_R_OFV_POC_002.CommandText +
                ' group by 1,2,3,4,5,6,7,8,9,10,11,12 '+
                ' order by int_ocvsituacao, OCV.DTA_ORCAMENTO, OCV.ID_ORCAMENTO ';

   Result := OFI_DP_R_OFV_POC_002.Data;

   OFI_SQ_R_OFV_POC_002.Close;
end;

function TSM.OFI_DP_R_OFV_POS_001DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelOfvPos01: String;
  begin
    Result :=
              ' SELECT' + #13#10 +
              '       ORV.*,' + #13#10 +
              '       CLI.doc_cnpj_cpf AS INT_CPFCNPJ,' + #13#10 +
              '       CLI.pessoa as int_pessoacli,' + #13#10 +
              '       CLI.NOME AS INT_NOMECLI,' + #13#10 +
              '       CLI.TEL_FIXO AS INT_TELFIX,' + #13#10 +
              '       CLI.TEL_MOVEL AS INT_TELMOV,' + #13#10 +
              '      case orv.status' + #13#10 +
              '         when  0 then ''Aberta''' + #13#10 +
              '         when 1 then ''Em andamento''' + #13#10 +
              '         when 2 then ''Fechada''' + #13#10 +
              '         when 3 then ''Faturada''' + #13#10 +
              '         when 4 then ''Cancelada''' + #13#10 +
              '      end as INT_ORVSITUACAO,' + #13#10 +
              '       case' + #13#10 +
              '         when VEI.COMBUSTIVEL = 0 then ''Gasolina''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 1 then ''Alcool''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 2 then ''Diesel''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 3 then ''Gas Natural''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 4 then ''Eletrico''' + #13#10 +
              '         when VEI.COMBUSTIVEL = 5 then ''Flex''' + #13#10 +
              '       end as INT_NOMECOM,' + #13#10 +
              '       VEI.ID_PLACA AS INT_PLACA,   VEI.DESCRICAO AS INT_NOMEVEI,' + #13#10 +
              '       TIO.DESCRICAO AS INT_NOMETIO,' + #13#10 +
              '       CID.UF AS INT_UFCLI, ANA.NOME AS INT_NOMEANA, CPG.DESCRICAO AS INT_NOMECPG, ' + #13#10 +
              '  meq.descricao as int_nomemeq,meq.nro_serie as int_seriemeq,meq.id_placa as int_placa_meq, '+ #13#10 +
              '  case     '+
              '   when MEQ.COMBUSTIVEL = 0 then ''Gasolina'' '+
              '   when MEQ.COMBUSTIVEL = 1 then ''Alcool'' '+
              '   when MEQ.COMBUSTIVEL = 2 then ''Diesel'' '+
              '   when MEQ.COMBUSTIVEL = 3 then ''Gas Natural'' '+
              '   when MEQ.COMBUSTIVEL = 4 then ''Eletrico'' '+
              '   when MEQ.COMBUSTIVEL = 5 then ''Flex'' '+
              '  end as INT_NOMECOM_MEQ, '+
              '  mde.descricao as int_modelomeq     '+
              ' FROM OFI_TB_M_ORV ORV' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORV.ID_CLIENTE' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_FUN ANA ON ANA.ID_FUNCIONARIO=ORV.ID_ANALISTA' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=ORV.ID_VEICULO' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=ORV.ID_FORMA_PAG' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORV.ID_CONDICAO_PAG' + #13#10 +
              ' LEFT OUTER JOIN OFI_TB_C_TIO TIO ON TIO.ID_TIPO_OS = ORV.ID_TIPO_OS' + #13#10 +
              ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = CLI.ID_CIDADE' + #13#10 +
              ' LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ = ORV.ID_MEQ '+
              ' LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE = MEQ.ID_MDE '+
              ' WHERE 1 = 1  ';

  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 17/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Nro OS inicial
          3 - Nro OS final
          4 - Status
          5 - Empresa
          6 - Funcionario
          7 - Veculo
          8 - Condio de pagamento
          9 - Analista
          10 - Tipo de O.S
   }

   OFI_SQ_R_OFV_POS_001.Close;

   if Input[0] <> '' then
      begin
        if Input[11] = '0' then
           begin
             OFI_SQ_R_OFV_POS_001.CommandText := enSqlOfiRelOfvPos01 +
                  '   AND  ORV.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
        if Input[11] = '1' then
           begin
             OFI_SQ_R_OFV_POS_001.CommandText := enSqlOfiRelOfvPos01 +
                  '   AND  ORV.DTA_FECHAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
                  '   AND  ORV.DTA_FECHAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
           end;
      end;

   if Input[2] <> '' then
      begin
         OFI_SQ_R_OFV_POS_001.CommandText := enSqlOfiRelOfvPos01 +
                  '   AND  ORV.ID_ORDEM >= ''' + VarToStr(Input[2]) + ''' '+
                  '   AND  ORV.ID_ORDEM <= ''' + VarToStr(Input[3]) + ''' ';
      end;

   if Input[4] <> '' then
      begin
         OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
                  ' AND ORV.status = ''' + VarToStr(Input[4]) +''' ';
      end;

   if Input[5] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.id_empresa in (' + VarToStr(Input[5]) +')';
      end;

   if Input[6] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_RESPONSAVEL in (' + VarToStr(Input[6]) +')';
      end;

   if Input[7] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_VEICULO in (' + VarToStr(Input[7]) +')';
      end;

   if Input[8] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +')';
      end;

   if Input[9] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_ANALISTA in (' + VarToStr(Input[9]) +')';
      end;

   if Input[10] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_TIPO_OS in (' + VarToStr(Input[10]) +')';
      end;

   if Input[12] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.TIPO_ORDEM in (' + VarToStr(Input[12]) +')';
      end;

   if Input[13] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.CHASSI in (' + VarToStr(Input[13]) +')';
      end;

   if Input[14] <> '' then
      begin
        OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText +
             ' AND ORV.ID_MEQ in (' + VarToStr(Input[14]) +')';
      end;

   OFI_SQ_R_OFV_POS_001.CommandText := OFI_SQ_R_OFV_POS_001.CommandText + ' order by ORV.DTA_EMISSAO, ORV.ID_ORDEM ';

   Result := OFI_DP_R_OFV_POS_001.Data;

   OFI_SQ_R_OFV_POS_001.Close;

end;

function TSM.OFI_DP_R_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiRelPos: String;
  begin
    Result :=
          ' select   pos.*,' + #13#10 +
          ' cast (  ' + #13#10 +
          '     case pos.situacao' + #13#10 +
          '        when 0 then ''Satisfeito''' + #13#10 +
          '        when 1 then ''Instasfeito''' + #13#10 +
          '        when 2 then ''No encontrado''' + #13#10 +
          '    end             ' + #13#10 +
          '   as varchar(20)) as int_situacaopos,' + #13#10 +
          '  par.emp_fantasia as int_empfantasia,' + #13#10 +
          '   orv.id_cliente,cli.nome as int_nomecli' + #13#10 +
          ' from ofi_tb_m_pos pos' + #13#10 +
          '   left outer join ofi_tb_m_orv orv on (orv.id_ordem = pos.id_ordem) ' + #13#10 +
          '   left outer join cad_tb_c_cli cli on (cli.id_cliente = orv.id_cliente) ' + #13#10 +
          '   left outer join cad_tb_c_par par on (par.id_empresa = pos.id_empresa) ' + #13#10;
  end;
begin

   { TODO -oMaxsuel -cCriao : Criado em 16/09/2015 }

   {
    input 0 - Data inicial
          1 - Data final
          2 - Empresa
          3 - Cliente
          4 - Situacao
   }

   OFI_SQ_R_POS.Close;

   OFI_SQ_R_POS.CommandText := enSqlOfiRelPos +
         ' WHERE pos.dta_posvenda >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND '+
         '       pos.dta_posvenda <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   if Input[2] <> '' then
      begin
        OFI_SQ_R_POS.CommandText := OFI_SQ_R_POS.CommandText +
             ' and pos.id_empresa in (' + VarToStr(Input[2]) +')';
      end;

   if Input[3] <> '' then
      begin
        OFI_SQ_R_POS.CommandText := OFI_SQ_R_POS.CommandText +
             ' and orv.id_cliente in (' + VarToStr(Input[3]) +')';
      end;

   if Input[4] <> '' then
      begin
        OFI_SQ_R_POS.CommandText := OFI_SQ_R_POS.CommandText +
             ' and pos.situacao = ''' + VarToStr(Input[4]) +''' ';
      end;

   OFI_SQ_R_POS.CommandText := OFI_SQ_R_POS.CommandText + ' order by pos.dta_posvenda, pos.id_ordem, cli.nome ';

   Result := OFI_DP_R_POS.Data;

   OFI_SQ_R_POS.Close;
end;

function TSM.OFI_DP_R_POS_OSPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlOfiPosOsp: String;
  begin
    Result :=
          ' select orv.*,' + #13#10 +
          '       cli.doc_cnpj_cpf as int_cpfcnpj,' + #13#10 +
          '       cli.pessoa as int_pessoacli,' + #13#10 +
          '       cli.nome as int_nomecli,' + #13#10 +
          '       cli.tel_fixo as int_telfix,' + #13#10 +
          '       cli.tel_movel as int_telmov,' + #13#10 +
          '       case' + #13#10 +
          '         when vei.combustivel = 0 then ''gasolina''' + #13#10 +
          '         when vei.combustivel = 1 then ''alcool''' + #13#10 +
          '         when vei.combustivel = 2 then ''diesel''' + #13#10 +
          '         when vei.combustivel = 3 then ''gas natural''' + #13#10 +
          '         when vei.combustivel = 4 then ''eletrico''' + #13#10 +
          '         when vei.combustivel = 5 then ''flex''' + #13#10 +
          '       end as int_nomecom,' + #13#10 +
          '       vei.id_placa as int_placa,   vei.descricao as int_nomevei,' + #13#10 +
          '       tio.descricao as int_nometio,' + #13#10 +
          '       cid.uf as int_ufcli,' + #13#10 +
          '       mve.descricao as int_nomemve, ' + #13#10 +
          '       ANA.NOME AS INT_NOMEANA, CPG.DESCRICAO AS INT_NOMECPG ' + #13#10 +
          ' from ofi_tb_m_orv orv' + #13#10 +
          ' left outer join cad_tb_c_cli cli on cli.id_cliente=orv.id_cliente' + #13#10 +
          ' left outer join cad_tb_c_fun ana on ana.id_funcionario=orv.id_analista' + #13#10 +
          ' left outer join cad_tb_c_vei vei on vei.id_veiculo=orv.id_veiculo' + #13#10 +
          ' left outer join cad_tb_c_mve mve on mve.id_mve = vei.id_mve' + #13#10 +
          ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=orv.id_forma_pag' + #13#10 +
          ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=orv.id_condicao_pag' + #13#10 +
          ' left outer join ofi_tb_c_tio tio on tio.id_tipo_os = orv.id_tipo_os' + #13#10 +
          ' left outer join cad_tb_c_cid cid on cid.id_cidade = cli.id_cidade' + #13#10;
  end;
begin

   { TODO -oMaxsuel -cCriao : Mtodo criado em 05/10/2015. }

   // Ordens de Servio sem Ps Venda

   OFI_SQ_R_POS_OSP.Close;

   OFI_SQ_R_POS_OSP.CommandText := enSqlOfiPosOsp +
        ' WHERE orv.status = 3 and orv.id_empresa in (' + VarToStr(Input[0]) +') ' +
        ' and not exists (select * from ofi_tb_m_pos pos' + #13#10 +
        '                 where pos.id_empresa = orv.id_empresa ' + #13#10 +
        '                   and pos.id_ordem = orv.id_ordem)';

   Result := OFI_DP_R_POS_OSP.Data;

   OFI_SQ_R_POS_OSP.Close;
end;

procedure TSM.FAT_DP_M_NFEUpdateData(Sender: TObject; DataSet: TCustomClientDataSet);
var
  cdsTit: TDataSet;
  FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,FIN_CD_M_PCR,FAT_CD_M_XML: TClientDataSet;
  Faturada: Boolean;
  Origem_NF,NfeCodSitAnt, NfeCodSitAtual, NfeCodSitAtual_2,SerieNF,
  NfeObsAnt,NfeObsAtu: String;

  Ind_Emitente,Status,Nfe_ecf: Integer;
  Numero, IdAbertura: integer;
  DtaEmissao: TDateTime;
  i: integer;
  NFCancelada,NFInutilizada: Boolean;
  PreVenda: Boolean;
begin
   try
       NFCancelada   := false;
       NFInutilizada := false;

       Faturada         := Dataset.FieldByName('FATURADA').AsBoolean;
       Origem_NF        := Dataset.FieldByName('ORIGEM_NF').text;
       Numero           := Dataset.FieldByName('NUMERO').AsInteger;
       Ind_Emitente     := Dataset.FieldByName('IND_EMITENTE').AsInteger;
       Status           := Dataset.FieldByName('STATUS').AsInteger;
       NfeCodSitAnt     := Dataset.FieldByName('NFE_COD_SIT').AsString;
       NfeCodSitAtual   := Dataset.FieldByName('NFE_COD_SIT').AsString;
       NfeCodSitAtual_2 := '';
       IdAbertura       := Dataset.FieldByName('ID_ABERTURA').AsInteger;
       SerieNF          := Dataset.FieldByName('SERIE').AsString;
       NfeObsAnt        := trim(Dataset.FieldByName('NFE_OBS').AsString);
       DtaEmissao       := Dataset.FieldByName('DTA_EMISSAO').AsDateTime;
       Nfe_ecf          := Dataset.FieldByName('NFE_ECF').AsInteger;
       PreVenda         := Dataset.FieldByName('PREVENDA').Asboolean;
       if Dataset.UpdateStatus in [usUnmodified] then // Se o registro teve modificaes
         begin
           Dataset.Next;
           if Dataset.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
              begin
                if Dataset.FieldByName('FATURADA').text <> '' then
                   Faturada     := Dataset.FieldByName('FATURADA').AsBoolean;
                if Dataset.FieldByName('ORIGEM_NF').text <> '' then
                   Origem_NF    := Dataset.FieldByName('ORIGEM_NF').text;
                if Dataset.FieldByName('NUMERO').Text <> '' then
                   Numero       := Dataset.FieldByName('NUMERO').AsInteger;
                if Dataset.FieldByName('ID_ABERTURA').Text <> '' then
                   IdAbertura       := Dataset.FieldByName('ID_ABERTURA').AsInteger;
                if Dataset.FieldByName('IND_EMITENTE').text <> '' then
                   Ind_Emitente := Dataset.FieldByName('IND_EMITENTE').AsInteger;
                if Dataset.FieldByName('STATUS').text <> '' then
                   Status         := Dataset.FieldByName('STATUS').AsInteger;
                if Dataset.FieldByName('NFE_COD_SIT').AsString <> '' then
                   begin
                      NfeCodSitAtual   := Dataset.FieldByName('NFE_COD_SIT').AsString;
                      NfeCodSitAtual_2 := Dataset.FieldByName('NFE_COD_SIT').AsString;
                   end;
                if Dataset.FieldByName('SERIE').AsString <> '' then
                   SerieNF   := Dataset.FieldByName('SERIE').AsString;
                if trim(Dataset.FieldByName('NFE_OBS').AsString) <> '' then
                   NfeObsAtu := Dataset.FieldByName('NFE_OBS').AsString;
                if Dataset.FieldByName('DTA_EMISSAO').AsString <> '' then
                   DtaEmissao  := Dataset.FieldByName('DTA_EMISSAO').AsDateTime;
                if Dataset.FieldByName('NFE_ECF').AsString <> '' then
                   Nfe_ecf   := Dataset.FieldByName('NFE_ECF').AsInteger;
                if Dataset.FieldByName('PREVENDA').AsString <> '' then
                   PreVenda := Dataset.FieldByName('PREVENDA').Asboolean;
              end;
           Dataset.Prior;
         end;

     if NfeCodSitAnt <> NfeCodSitAtual_2 then
        begin
          if (NfeCodSitAtual_2 = '02') or
             (NfeCodSitAtual_2 = '04') or
             ((NfeCodSitAnt = '02') and (NfeCodSitAtual_2='')) then   //Adicionei mais essa condicao pois h gerao da nova nota fiscal com nfe_cod_sit='02' partindo do cupom fiscal
              NFCancelada := true;

          if ((Dataset.FieldByName('TIPO_NF').AsString = 'E')  or
              (Dataset.FieldByName('TIPO_NF').AsString = 'D') or
              (Dataset.FieldByName('TIPO_NF').AsString = 'R') or
              (Dataset.FieldByName('TIPO_NF').AsString = 'S')) then
            begin
              if (NfeCodSitAtual_2 = '05') then
                begin
                  NFCancelada   := true;
                  NFInutilizada := true;
                end;

            end;

        end;


     { *****************
        Nota de Entrada
      ****************** }
     if Dataset.FieldByName('Tipo_NF').text[1] in ['E'] then
        begin

          // Atualiza pedido de compra
          if NFCancelada = false then
            begin
              FAT_RN_M_EST.FatImortarCmpPedEst(DataSet,CMP_DP_M_PED,BUS_DP_M_NFE_ITE_INT);
              GerFinEntrada(Sender, DataSet,IdAbertura,IntToStr(Numero),DtaEmissao,false,self);
            end;

          if NFInutilizada then // Para desfazer o financeiro, por Maxsuel Victor em 24/10
             begin
               GerFinEntrada(Sender, DataSet,IdAbertura,IntToStr(Numero),DtaEmissao,NFInutilizada,self);
             end;

          {
            Com as condies abaixo o sistema s ira movimentar o estoque caso
            seja:
               1 - Nota Fiscal de Entrada de Terceiros; (Que  o dia-a-dia)
               2 - Nota Fiscal de Entrada que ser faturada pela prpria empresa
                   Depois que a nota for faturada o sistema no ir mais atualizar o estoque.
          }
          if ( ( (Origem_NF   = 'B') or (Origem_NF   = 'X') )   and  // Estoque ou Importao XML    ||\\
                (Ind_Emitente = 1) and                               // Terceiros  || ->> Nota Fisal de Terceiro
               (Status = 1))                                        // Encerrada  ||//
               or
             ((Dataset.FieldByName('ORIGEM_NF').text   = 'B')     and  // Estoque    ||\\
              (Dataset.FieldByName('IND_EMITENTE').AsInteger = 0) and  // Prpria    || ->> Nota Fisal Prpria
              (Dataset.FieldByName('STATUS').AsInteger = 0))       // Em aberto  ||//
              or
              ((Origem_NF   = 'B')    and  // Estoque
               (Ind_Emitente = 0)    and  // Nota fiscal propria
               (Status = 1)) then      //Encerrada
              begin
                FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,0,
                                                    DataSet.FieldByName('ID_FISCAL').AsInteger,
                                                    DataSet,
                                                    BUS_DP_M_NFE_ITE_INT,
                                                    CAD_DP_C_TME,
                                                    BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                    EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,NFCancelada,Self);
              end;

          // Situao quando a empresa ir faturar a nota de entrada e o sistema tem que apenas atualizar o FEA.
          if
             ((Origem_NF   = 'B')     and  // Estoque    ||\\
              (Ind_Emitente = 0) and       // Prpria    || ->> Nota Fisal da Prpria empresa
              (Faturada = true)  and       // Fat. Emp   ||//
              (Status = 1) and (NFCancelada=false))      then      // Em aberto  ||//
               begin
                 FAT_RN_M_EST.FatAtuDocFea(2,Dataset.FieldByName('ID_EMPRESA').AsInteger,
                                             Dataset.FieldByName('ID_FISCAL').AsInteger,
                                             Dataset.FieldByName('NUMERO').AsInteger,
                                             CAD_DP_C_TME,EST_DP_M_FEA);
               end;

          // Atualiza IQM
          if (NFCancelada=false) then
            AtualizarIQM(Sender, DataSet);


          if Dataset.UpdateStatus in [usDeleted] then
            begin
              if (Dataset.FieldByName('ORIGEM_NF').AsString = 'X') then
                begin
                  FAT_CD_M_XML := TClientDataSet.Create(self);
                  FAT_CD_M_XML.SetProvider(FAT_DP_M_XML);
                  FAT_CD_M_XML.Close;
                  FAT_CD_M_XML.Data :=
                  FAT_CD_M_XML.DataRequest(VarArrayOf([5, Dataset.FieldByName('ID_FISCAL').AsString]));

                  if not FAT_CD_M_XML.IsEmpty then
                     FAT_CD_M_XML.Delete;

                  if not (FAT_CD_M_XML.ApplyUpdates(0) = 0) then
                    begin
                      raise Exception.Create('Erro ao tentar excluir registro de importao xml.');
                      abort;
                    end;
                end;
            end;



        end;



     { ******************************************
         Nota de Devoluo de Vendas (entradas)
       ****************************************** }
     if Dataset.FieldByName('Tipo_NF').text[1] in ['R'] then
        begin
           {
            Com as condies abaixo o sistema s ira movimentar o estoque caso
            seja:
               1 - Nota Fiscal de Devoluo de Venda for de Terceiros;
               2 - Nota Fiscal de Devoluo de Venda que ser faturada pela prpria empresa
                   Depois que a nota for faturada o sistema no ir mais atualizar o estoque.
            }
            if ((Origem_NF   = 'B')     and  // Estoque    ||\\
                (Ind_Emitente = 1) and       // Terceiros  || ->> Nota Fisal de Terceiro
                (Status = 1))                // Encerrada  ||//
               or
               ((Origem_NF   = 'B') and  // Estoque    ||\\
                (Ind_Emitente = 0)  and  // Prpria    || ->> Nota Fisal Prpria
                (Numero = 0)        and
                (Status = 0))            // Em aberto  ||//
               or
               ( (Origem_NF   = 'B')    and  // Estoque    ||\\
                 (Ind_Emitente = 0) and      // Prpria    ||->> Nota Fisal Prpria
                 (Numero > 0)       and      //            ||//
                 (status = 1)       and      // Encerrada  ||//
                 (NFCancelada) )             // Cancelada  ||//
               or
               ( (Origem_NF = 'E') and
                  (Ind_Emitente = 0) and
                  (Numero > 0) )
               or
                ((Origem_NF   = 'C') and  // Oficina    ||\\
                (Ind_Emitente = 0)  and  // Prpria    || ->> Nota Fisal Prpria
                (Numero = 0)        and
                (Status = 0))            // Em aberto  ||//
               or
               ( (Origem_NF   = 'C')    and  // Oficina    ||\\
                 (Ind_Emitente = 0) and      // Prpria    ||->> Nota Fisal Prpria
                 (Numero > 0)       and      //            ||//
                 (status = 1)       and      // Encerrada  ||//
                 (NFCancelada) ) then            // Cancelada  ||//
                begin
                  FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,8,
                                                      DataSet.FieldByName('ID_FISCAL').AsInteger,
                                                      DataSet,
                                                      BUS_DP_M_NFE_ITE_INT,
                                                      CAD_DP_C_TME,
                                                      BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                      EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,NFCancelada,Self);

                  // Atualiza o campo QTDE_DEVOLVIDA dos itens da nota de origem
                  if (Origem_NF <> 'C') then
                    FAT_RN_M_EST.FatAtuQtdDevIte(DataSet,BUS_DP_M_NFE_ITE_INT,BUS_DP_M_NFE_DEV_INT,
                                               BUS_DP_M_NFE_DEV_ITE_INT,NFCancelada);
                end;

            { Ir gerar uma nota de crdito para o cliente.
              Servir tanto para Nota prpria como nota de Terceiros.

              Caso a nota fiscal seja cancelada o mtodo abaixo no ser executado.
            }
             if ((Origem_NF     = 'B')  and  // Estoque    ||\\
                (NfeCodSitAtual = '00') and         // Documento regular
                (Status         = 1))              // Encerrada  ||//
                or
                ((Origem_NF      = 'E') and
                 (NfeCodSitAtual = '00') and
                 (Status         = 1))
                or
                ((Origem_NF      = 'C') and  //Oficina
                 (NfeCodSitAtual = '00') and
                 (Status         = 1)) then
                begin
                  try
                    enGerFinRcr(Sender, 1, DataSet, CdsTit, FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,IdAbertura);
                  finally
                    FIN_CD_M_RCR.Free;
                  end;
                end;
        end;

     { *****************************************
         Nota Frete
       ***************************************** }
     if Dataset.FieldByName('Tipo_NF').text[1] in ['F'] then
        begin
          GerFinEntrada(Sender, DataSet,IdAbertura,IntToStr(Numero),DtaEmissao,false,self);
        end;


     { *****************************************
        Nota de Sada
       ***************************************** }
     if Dataset.FieldByName('Tipo_NF').text[1] in ['S'] then
        begin

          { TODO -oMaxsuel Victor -cCriao : Criado por Maxsuel Victor em 02/03/2015 }
          if (Faturada) and       // Quer dizer que a nota foi emitida pela prpria empresa e no de terceiros.
             ( (NfeCodSitAtual = '00') or (NfeCodSitAtual = '01') ) and
             (status = 1) and (PreVenda=false) then    // Encerrada
              begin
                GerFinSaida(Sender, DataSet,IdAbertura,IntToStr(Numero),SerieNF,DtaEmissao);

                if Dataset.FieldByName('ID_ORDEM').AsInteger >0 then
                   begin
                     AlterarDeletarTitOrv(Sender,DataSet);
                   end;

                if SerieNF = 'X' then
                   enAtualPedF11(DataSet.FieldByName('id_empresa').AsInteger,DataSet.FieldByName('id_pedido_venda').AsInteger);

              end;

           if PreVenda then
              begin
                if (dataset.UpdateStatus in [usDeleted]) then
                    begin
                      enExcluirPreVenda(DataSet.FieldByName('ecf_prevenda').AsString);
                    end;
              end;
          {
            A condio abaixo foi colocada para que o mtodo somente seja chamado,
            caso a nota fiscal de SADA tenha vindo da tela de Nota Fiscal e que
            esteja com STATUS de aberta ainda.
          }
          if ( ((Origem_Nf   = 'B')) and  // Estoque e em aberto
                (Status = 0)   )

             or

             ( ((Origem_Nf   = 'B') ) and  // Estoque e encerrada
                (Status = 1) and (Numero > 0) {and (NFCancelada)}) or

             ( ((Origem_Nf   = 'D')) and  // Gerado partindo do Cupom GerConWin e fechado
                (Status = 1) and (NFCancelada= false))  or

              ((Origem_Nf <> 'D') and (Origem_Nf <> 'C') and (Origem_Nf <> 'A') and
               (Nfe_ecf = 1) and (NFCancelada = true))  then
              begin
                FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,1,
                                                    DataSet.FieldByName('ID_FISCAL').AsInteger,
                                                    DataSet,
                                                    BUS_DP_M_NFE_ITE_INT,
                                                    CAD_DP_C_TME,
                                                    BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                    EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,NFCancelada,Self);
              end;


        end;

     { ******************************************
         Nota de Devoluo de Fornecedor (Sada)
       ****************************************** }
     if Dataset.FieldByName('Tipo_NF').text[1] in ['D'] then
        begin
           {
            A condio abaixo foi colocada para que o mtodo somente seja chamado,
            caso a nota fiscal de Devoluo para Fornecedor tenha vindo da tela de Nota Fiscal e que
            esteja com STATUS de aberta ainda.
            }

          if ((Origem_NF   = 'B')     and  // Estoque   ||\\
              (Ind_Emitente = 1) and       // Terceiros  || ->> Nota Fisal de Terceiro
              (status = 1))                // Encerrada  ||//
             or
             ( (Origem_NF   = 'B')    and  // Estoque    ||\\
               (Ind_Emitente = 0) and      // Prpria    || ->> Nota Fisal Prpria
               (Numero = 0)       and
               (status = 0))               // Em aberto  ||//
             or
             ( (Origem_NF   = 'B')    and  // Estoque    ||\\
               (Ind_Emitente = 0) and      // Prpria    ||->> Nota Fisal Prpria
               (Numero > 0)       and      //            ||//
               (status = 1)       and      // Encerrada  ||//
               (NFCancelada) )            // Cancelada  ||//
             or
              ( (Origem_NF   = 'B')    and  // Estoque    ||\\
               (Ind_Emitente = 0) and      // Prpria    ||->> Nota Fisal Prpria
               (Numero > 0)       and      //            ||//
               (status = 1)       and      // Encerrada  ||//
               (NFCancelada))             // Cancelada  ||//
             or
               ((Origem_NF   = 'C')    and  // Oficina    ||\\
               (Ind_Emitente = 0) and      // Prpria    || ->> Nota Fisal Prpria
               (Numero = 0)       and
               (status = 0))
             or
             ( (Origem_NF   = 'C')    and  // Oficina    ||\\
               (Ind_Emitente = 0) and      // Prpria    ||->> Nota Fisal Prpria
               (Numero > 0)       and      //            ||//
               (status = 1)       and      // Encerrada  ||//
               (NFCancelada) )   then         // Cancelada  ||//
              begin
                FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,7,
                                                    DataSet.FieldByName('ID_FISCAL').AsInteger,
                                                    DataSet,
                                                    BUS_DP_M_NFE_ITE_INT,
                                                    CAD_DP_C_TME,
                                                    BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                    EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,NFCancelada,Self);

                // Atualiza o campo QTDE_DEVOLVIDA dos itens da nota de origem
                if (Origem_NF <> 'C') then
                  FAT_RN_M_EST.FatAtuQtdDevIte(DataSet,BUS_DP_M_NFE_ITE_INT,BUS_DP_M_NFE_DEV_INT,
                             BUS_DP_M_NFE_DEV_ITE_INT,NFCancelada);
              end;



          if ((Origem_NF     = 'B')  and  // Estoque    ||\\
              (NfeCodSitAtual = '00') and         // Documento regular
              (Status         = 1))              // Encerrada  ||//
              or
              ((Origem_NF      = 'C') and  //Oficina
               (NfeCodSitAtual = '00') and
               (Status         = 1)) then
              begin
                try
                  enGerFinPcr(Sender, 0, DataSet, FIN_CD_M_PCR);
                finally
                  FIN_CD_M_PCR.Free;
                end;
              end;



        end;



   finally
    // dspUpdateData(Sender, DataSet);
   end;

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;


function TSM.FAT_DP_M_ORCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatOrc: String;
  begin
    Result :=
      'select ORC.*, CLI.NOME AS INT_NOMECLI, FUN.NOME AS INT_NOMEFUN, '+
      '       CPG.DESCRICAO INT_NOMECPG, FPG.DESCRICAO AS INT_NOMEFPG, '+
      '       CLI.ID_PERFIL_CLI AS INT_ID_PERFIL '+
      'from FAT_TB_M_ORC ORC '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ORC.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=ORC.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=ORC.ID_CONDICAO_PAG '+
      'LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = ORC.ID_FORMA_PAG ';


  end;
begin
   FAT_SQ_M_ORC.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_ORC.CommandText := enSqlFatOrc + ' WHERE 1=2 '
        else
           FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
              ' WHERE ORC.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' AND ' +
              '       ORC.ID_ORCAMENTO = ''' + VarToStr(Input[2]) + ''' ';
      end;
   if Input[0] = 1 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
           ' WHERE ORC.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ORC.ID_CLIENTE = '''+ VarToStr(Input[2]) +''' ';
      end;
   if Input[0] = 2 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
        ' WHERE ORC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;
   if Input[0] = 3 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
           ' WHERE ORC.ID_PEDIDO = '''+ VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 4 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
           ' WHERE ORC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ORC.ID_CLIENTE = '''+ VarToStr(Input[2]) +''' AND ORC.STATUS=0 ';
      end;
   if Input[0] = 5 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
           ' WHERE ORC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ORC.DTA_ORCAMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;
   if Input[0] = 6 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
            ' WHERE ORC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   if Input[0] = 7 then
      begin
        FAT_SQ_M_ORC.CommandText := enSqlFatOrc +
           ' WHERE ORC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ORC.ID_CLIENTE = '''+ VarToStr(Input[2]) +''' AND ORC.STATUS=0 AND ' +
           '       ORC.ID_FUNCIONARIO = '''+ VarToStr(Input[3]) +''' ';
      end;

   Result := FAT_DP_M_ORC.Data;
   FAT_SQ_M_ORC.Close;
end;

procedure TSM.FAT_DP_M_PCABeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
var
   qry:TSqlQuery;
   data, ano: String;
begin

  if (UpdateKind = ukInsert) and (SourceDS = FAT_SQ_M_PCA) then
     begin
       if DeltaDs.fieldByName('seq_carreg_anual').newValue='' then
          begin
            data := FormatDateTime('dd/mm/yyyy',date);
            ano  := copy(data,7,4);
            try
              qry := TSqlQuery.Create(self);
              qry.SQLConnection := self.conexao;
              qry.Close;
              qry.SQL.Add(' select coalesce(max(seq_carreg_anual),0) as ult_carreg_anual from fat_tb_m_pca ');
              qry.SQL.Add(' where dta_carregamento >= ''01/01/' + ano + ''' ' );
              qry.SQL.Add('   and dta_carregamento <= ''31/12/' + ano + ''' ' );
              qry.Open;
              DeltaDs.fieldByName('seq_carreg_anual').newValue :=
                  qry.fieldByName('ult_carreg_anual').newValue + 1;

              qry.Close;
            finally
               FreeAndNil(qry);
            end;

            //  sm.enValorChave('FIN_TB_M_PAG_NUM').ToString;
          end;
     end;
end;

function TSM.FAT_DP_M_PCADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlPca: String;
  begin
    Result :=
    ' select pca.*, '+
    '     fun.nome as int_nomeres,mta.nome as int_nomemot '+
    ' from fat_tb_m_pca pca '+
    ' left outer join cad_tb_c_fun fun on fun.id_funcionario=pca.id_responsavel '+
    ' left outer join pcp_tb_c_mta mta on mta.id_motorista=pca.id_motorista ';
  end;
begin
   { TODO -oLuan : Criado em 22/03/2016 }
   FAT_SQ_M_PCA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_PCA.CommandText := enSqlPca + ' WHERE 1=2 '
        else
           FAT_SQ_M_PCA.CommandText := enSqlPca +
             ' WHERE PCA.ID_CARREGAMENTO = ''' + VarToStr(Input[1]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FAT_SQ_M_PCA.CommandText := enSqlPca +
           Format('where upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        FAT_SQ_M_PCA.CommandText := enSqlPca +
           ' WHERE PCA.DTA_CARREGAMENTO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ';
      end
  else if Input[0] = 3 then
      begin
        FAT_SQ_M_PCA.CommandText := enSqlPca +
          ' WHERE exists (select id_pedido from fat_tb_m_pca_ped where ID_CARREGAMENTO = pca.ID_CARREGAMENTO and id_pedido =  ''' + VarToStr(Input[1]) +''' ) ';
      end
  else
      if Input[0] = 4 then
         begin
            FAT_SQ_M_PCA.CommandText := enSqlPca +
                 ' WHERE PCA.seq_carreg_anual = ''' + VarToStr(Input[1]) + ''' '  +
                 '   AND extract(year from PCA.DTA_CARREGAMENTO) = ''' + VarToStr(Input[2]) + ''' ';
         end
   else if Input[0] = 90 then
      begin
        FAT_SQ_M_PCA.CommandText := enSqlPca +' WHERE 1=1 ';
        if (Input[1] <> '') then
          begin
           FAT_SQ_M_PCA.CommandText := FAT_SQ_M_PCA.CommandText +
           ' AND PCA.DTA_CARREGAMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' '+
           ' AND PCA.DTA_CARREGAMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
          end;
        if (Input[3] <> '') then
          begin
            FAT_SQ_M_PCA.CommandText := FAT_SQ_M_PCA.CommandText +
            ' AND PCA.ID_CARREGAMENTO = ''' + VarToStr(Input[3]) + ''' ';
          end;
      end;

   Result := FAT_DP_M_PCA.Data;
end;

function TSM.FAT_DP_M_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFatPed: String;
  begin
    Result :=
        'SELECT false as int_selecao, PED.*, CLI.NOME AS INT_NOMECLI, TME.DESCRICAO AS INT_NOMETME, '+
        '       FUN.NOME AS INT_NOMEFUN, CPG.DESCRICAO AS INT_NOMECPG, '+
        '       ATE.NOME AS INT_NOMEATE, RES.NOME AS INT_NOMERES,FNC.NOME AS INT_NOME_RCN, '+
        '       FNL.NOME AS INT_NOMELIB, CID.NOME AS INT_NOMECID, '+
        '       CID.UF AS INT_NOMEEST, CLI.doc_cnpj_cpf AS INT_CPFCNPJ, CLI.pessoa as int_pessoacli, '+
        '       CLI.ID_PERFIL_CLI AS INT_ID_PERFIL, '+
        '       FPI.NOME AS INT_NOMEPRI_IMPRES,  FSI.NOME AS INT_NOMESEG_IMPRES, ' +
        '       FTI.NOME AS INT_NOMETER_IMPRES,                                  ' +
        '       ORS.ID_ORS, '+
        ' cast( case ped.situacao_aprovacao ' +
        '   when 0 then ''Em espera'' '+
        '   when 1 then ''Aprovado'' ' +
        '   when 2 then ''Reprovado'' ' +
        ' end as varchar(20) ) as int_sitaprov, ' +
        ' cast( case ped.situacao     ' +
        '   when 0 then ''Em aberto'' ' +
        '   when 1 then ''Reprovado'' ' +
        '   when 2 then ''Em produo'' ' +
        '   when 3 then ''Faturado''  ' +
        '   when 4 then ''Cancelado'' ' +
        ' end as varchar(20) ) as int_sitped, ' +
        ' cast( case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''' + #13#10 +
        '           when (ped.situacao = 1) then ''Reprovado''' + #13#10 +
        '           when (ped.situacao = 2) then ''Em produo''' + #13#10 +
        '           when (ped.situacao = 3) then ''Faturado''' + #13#10 +
        '           when (ped.situacao = 4) then ''Cancelado''' + #13#10 +
        '         end as varchar(20) ) as int_sitped2, ' +

        '  case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then 1 '+ #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then 2 '+ #13#10 +
        '           when (ped.situacao = 2) then 3 '+ #13#10 +
        '           when (ped.situacao = 3) then 4 ' + #13#10 +
        '           when (ped.situacao = 4) then 5 '+ #13#10 +
        '           when (ped.situacao = 1) then 6 ' + #13#10 +
        '         end  as int_sitOrd, ' +

        ' cli.doc_ie_identidade as int_ie_rg_cli, reg.descricao as int_nomereg, ' +
        ' mta.nome as int_nomemta, fun.tel_movel as  int_telmovel_ven, fun.tel_fixo as int_telfixo_ven, '+
 //       '       (lpad(CAST(EXTRACT(HOUR FROM PED.HOR_PEDIDO) as varchar(2)),2,'''+'0'+''')||'''+':'+'''|| '+
 //       '       lpad(CAST(EXTRACT(MINUTE FROM PED.HOR_PEDIDO) as varchar(2)),2,'''+'0'+''')) AS INT_HORA '+
        ' OPR.num_lote as int_numloteopr ' +
        'FROM FAT_TB_M_PED PED '+
        'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = PED.ID_CLIENTE '+
        'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE = PED.ID_TIPO_MOV_ESTOQUE '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=PED.ID_VENDEDOR '+
        'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=PED.ID_CONDICAO_PAG '+
        'LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=PED.ID_ATENDENTE '+
        'LEFT OUTER JOIN CAD_TB_C_FUN RES ON RES.ID_FUNCIONARIO=PED.ID_RESPONSAVEL '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FNC ON FNC.ID_FUNCIONARIO=PED.ID_RESP_CONF '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FNL ON FNL.ID_FUNCIONARIO=PED.ID_USUARIO_LIB '+
        'LEFT OUTER JOIN CAD_TB_C_FUN FPI ON FPI.ID_FUNCIONARIO=PED.id_func_pri_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FSI ON FSI.ID_FUNCIONARIO=PED.id_func_seg_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_FUN FTI ON FTI.ID_FUNCIONARIO=PED.id_func_ter_impressao ' +
        'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
        'LEFT OUTER JOIN PCP_TB_M_ORS ORS ON ORS.ID_PEDIDO=PED.ID_PEDIDO ' +
        'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO = CLI.ID_REGIAO ' +
        'LEFT OUTER JOIN PCP_TB_M_OPR OPR ON ' +
        '           (OPR.ID_EMPRESA = PED.ID_EMPRESA AND OPR.ID_OPR = PED.PCP_ID_OPR) '+
        'LEFT OUTER JOIN PCP_TB_C_MTA MTA ON  MTA.ID_MOTORISTA = PED.ID_MOTORISTA ';



  end;
 var
   CondicaoOrder:string;
begin
   CondicaoOrder := '';
   FAT_SQ_M_PED.Close;

    case Input[0] of
       0: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       1: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       2: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';//' ORDER BY PED.SITUACAO_APROVACAO ';
       3: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       4: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       5: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       6: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
       7: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
      11: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
      12: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
      13: CondicaoOrder := ' ORDER BY int_sitOrd,ped.dta_pedido ';
    end;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_PED.CommandText := enSqlFatPed + ' WHERE 1 = 2 '
        else
           FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ' +
              CondicaoOrder;
      end;
   if Input[0] = 1 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                         CondicaoOrder;
      end;
   if Input[0] = 2 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
                  CondicaoOrder;
      end;
   if Input[0] = 3 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                  CondicaoOrder;
      end;
   if Input[0] = 4 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                  CondicaoOrder;
      end;
   if Input[0] = 5 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
                  CondicaoOrder;
      end;
   if Input[0] = 6 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  CLI.DOC_CNPJ_CPF = ' + QuotedStr(VarToStr(Input[2]))  +
                  CondicaoOrder;
      end;
   if Input[0] = 7 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2]))) +''' AND ' +
             ' PED.DTA_PEDIDO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])))+''' '+
                  CondicaoOrder;
      end;
   if Input[0] = 8 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.SITUACAO = 0 AND PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ' +
              CondicaoOrder;
      end;

   if Input[0] = 9 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.SITUACAO = 0 AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
                  CondicaoOrder;
      end;

   if Input[0] = 10 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.SITUACAO = 0 AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                         CondicaoOrder;
      end;

   if Input[0] = 11 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CID.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                  CondicaoOrder;
      end;
   if Input[0] = 12 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.APELIDO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                         CondicaoOrder;
      end;

   if Input[0] = 13 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.ID_CLIENTE = ' + QuotedStr(VarToStr(Input[2]))  +
                  CondicaoOrder;
      end;

   if Input[0] = 70 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_PED.CommandText := enSqlFatPed + ' WHERE 1 = 2 '
        else
           FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ' +
             '   AND PED.SITUACAO = 0 ' +
              CondicaoOrder;
      end;
   if Input[0] = 71 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                 '   AND PED.SITUACAO = 0 and PED.situacao_aprovacao = 1 ' +
                         ' ORDER BY PED.ID_PEDIDO DESC ';
      end;
   if Input[0] = 72 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
         '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 73 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
          '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 74 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
          '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 75 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
        '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 76 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  CLI.DOC_CNPJ_CPF = ' + QuotedStr(VarToStr(Input[2]))  +
        '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 77 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2]))) +''' AND ' +
             ' PED.DTA_PEDIDO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])))+''' '+
             '   AND PED.SITUACAO = 0 ' +
                  CondicaoOrder;
      end;
   if Input[0] = 78 then
      begin
         FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 ' PED.ID_CLIENTE = '''+VarToStr(Input[2]) +''' '+
                         ' ORDER BY PED.DTA_PEDIDO limit 5 ';
      end;

   if Input[0] = 79 then
      begin
         FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 '   PED.ID_CLIENTE = '''+VarToStr(Input[2]) + ''' ' +
                 //  '   PED.SITUACAO in (' + VarToStr(Input[3]) + ') '     +
                 ' ORDER BY PED.DTA_PEDIDO DESC, PED.ID_PEDIDO DESC';
      end;

   if Input[0] = 80 then
      begin
         FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 '   PED.ID_MKT = '''+VarToStr(Input[2]) + ''' ' +
                 ' ORDER BY PED.DTA_PEDIDO,PED.ID_PEDIDO DESC ';
      end;

   if Input[0] = 81 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                 '   AND PED.SITUACAO = 0 and PED.situacao_aprovacao = 1 and cpg.tipo_pagamento = 2 ' +
                         ' ORDER BY PED.ID_PEDIDO DESC ';
      end;

   if Input[0] = 90 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND COALESCE(PED.TIPO_RESTRICAO,'''+''+''') <> '''+''+'''  AND  '+
             '       PED.SITUACAO = '''+'0'+''' AND PED.SITUACAO_APROVACAO = '''+'0'+''' ';

             if Input[2] = 0 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY PED.DTA_PEDIDO, PED.ID_PEDIDO ';

             if Input[2] = 1 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY PED.DTA_PEDIDO DESC, PED.ID_PEDIDO ';

             if Input[2] = 2 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.DTA_PEDIDO, PED.ID_PEDIDO ';

             if Input[2] = 3 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY PED.ID_PEDIDO ';

             if Input[2] = 4 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY PED.ID_PEDIDO DESC ';

      end;

   if Input[0] = 91 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND PED.SITUACAO in (0,2) AND PED.SITUACAO_APROVACAO='''+'0'+'''   ';

             if Input[2] = 0 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.DTA_PEDIDO, PED.ID_PEDIDO ';

             if Input[2] = 1 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.DTA_PEDIDO DESC, PED.ID_PEDIDO ';

             if Input[2] = 2 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.ID_PEDIDO ';

             if Input[2] = 3 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.ID_PEDIDO DESC ';
      end;

   if Input[0] = 92 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND PED.SITUACAO in ('+ VarToStr(Input[2]) + ') ' +
             ' ORDER BY PED.ID_PEDIDO DESC, PED.DTA_PEDIDO DESC ';
      end;

      //Os filtros em diante so utilizados pelo FAT_FM_M_PCA atravs da tela de pesquisa PSQ_FM_X_PED
    if Input[0] = 93 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) + ''' ' +
             ' ORDER BY PED.ID_PEDIDO DESC ';
      end;

    if Input[0] = 94 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             Format(' AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
              ' ORDER BY CLI.NOME';
      end;

    if Input[0] = 95 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
                 ' ORDER BY FUN.NOME  ' ;
      end;


     if Input[0] = 96 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
              Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
               ' ORDER BY CPG.DESCRICAO  ';
      end;


     if Input[0] = 97 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
               Format(' AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                ' ORDER BY TME.DESCRICAO ';
      end;

     if Input[0] = 98 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO IN (0,2) ';
        if (Input[1] <>'') then
          begin
           FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ';
          end;
        FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
             ' AND PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             ' ORDER BY  PED.DTA_PEDIDO DESC ';
      end;
       //////////////////////////////////////////////////////////////////////////////////////

     if Input[0] = 99 then
        begin
          FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA  in (' + VarToStr(Input[1]) + ') ' +
             '   AND PED.SITUACAO = 0 ' +
             '   AND PED.SITUACAO_APROVACAO in ('+ VarToStr(Input[2]) + ') ' +
             '   AND PED.dta_prev_entrega < current_date  ';

          if (Input[3] = '0') then
              FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText + ' ORDER BY PED.ID_PEDIDO';
          if (Input[3] = '1') then
              FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText + ' ORDER BY PED.ID_PEDIDO DESC';
          if (Input[3] = '2') then
              FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText + ' ORDER BY PED.DTA_PEDIDO ';
          if (Input[3] = '3') then
              FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText + ' ORDER BY PED.DTA_PEDIDO DESC';
        end;

     if Input[0] = 100 then
        begin
          FAT_SQ_M_PED.CommandText := enSqlFatPed +
               ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
               '   AND PED.ID_PEDIDO in ('+ VarToStr(Input[2]) + ') ';
        end;


      //Os filtros em diante so utilizados pelo FAT_FM_M_SEP atravs da tela de pesquisa PSQ_FM_X_PED
     if Input[0] = 101 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) + ''' ' +
             ' ORDER BY PED.ID_PEDIDO DESC ';
      end;

     if Input[0] = 102 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             Format(' AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
              ' ORDER BY CLI.NOME';
      end;

     if Input[0] = 103 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
                 ' ORDER BY FUN.NOME  ' ;
      end;


     if Input[0] = 104 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
              Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
               ' ORDER BY CPG.DESCRICAO  ';
      end;


     if Input[0] = 105 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
               Format(' AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                ' ORDER BY TME.DESCRICAO ';
      end;

     if Input[0] = 106 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO=''0'' AND PED.SITUACAO_APROVACAO=''1'' AND PED.ENVIA_CARGA=TRUE AND PED.CONFERIDO=FALSE '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             ' ORDER BY  PED.DTA_PEDIDO DESC ';
      end;
      //////////////////////////////////////////////////////////////////////////////////

    if Input[0] = 107 then
       begin
         FAT_SQ_M_PED.CommandText := enSqlFatPed +
          ' WHERE  PED.ID_PEDIDO in (' + VarToStr(Input[1]) +') ' +
          ' ORDER BY PED.DTA_PEDIDO ';
       end;


   //Os filtros em diante so utilizados pelo PCP_FM_M_ACR atravs da tela de pesquisa PSQ_FM_X_PED
     if Input[0] = 108 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) + ''' ' +
             ' ORDER BY PED.ID_PEDIDO DESC ';
      end;

     if Input[0] = 109 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             Format(' AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
              ' ORDER BY CLI.NOME';
      end;

     if Input[0] = 110 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
                 ' ORDER BY FUN.NOME  ' ;
      end;


     if Input[0] = 111 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
              Format(' upper(CPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
               ' ORDER BY CPG.DESCRICAO  ';
      end;


     if Input[0] = 112 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
         ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
         ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
               Format(' AND upper(TME.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                ' ORDER BY TME.DESCRICAO ';
      end;

     if Input[0] = 113 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
        ' where PED.SITUACAO not in (''1'',''4'') and PED.SITUACAO_APROVACAO not in (''2'') '+
             ' AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             ' ORDER BY  PED.DTA_PEDIDO DESC ';
      end;

   //O filtro a seguir  utilizados pelo FAT_FM_N_RTE
   if Input[0] = 114 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND PED.SITUACAO in ('+ VarToStr(Input[2]) + ') ' +
             ' ORDER BY PED.DTA_PEDIDO DESC, PED.ID_PEDIDO DESC  ';
      end;


   if Input[0] = 115 then
      begin
        if Input[1] = '0' then
           begin
              if Trim(VarToStr(Input[2])) = '' then
                 FAT_SQ_M_PED.CommandText := enSqlFatPed + ' WHERE 1 = 2 '
              else
                 FAT_SQ_M_PED.CommandText := enSqlFatPed +
                   ' WHERE PED.ID_EMPRESA =   ''' + VarToStr(Input[2]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[3]) +''' ' +
                   ' AND PED.ID_VENDEDOR = ''' + VarToStr(Input[4]) +''' ' +
                    CondicaoOrder;
           end;
      end;

   if Input[0] = 116 then
      begin
         if Input[1] = '1' then
            begin
              FAT_SQ_M_PED.CommandText := enSqlFatPed +
                       ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[2]) + ''' AND ' +
                       Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[3]))]) +
                       ' AND PED.ID_VENDEDOR = ''' + VarToStr(Input[4]) +''' ' +
                               CondicaoOrder;
            end;
      end;

   if Input[0] = 117 then
      begin
       if Input[1] = '2' then
          begin
            FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[2]) + ''' AND  PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ' +
                 ' AND PED.ID_VENDEDOR = ''' + VarToStr(Input[4]) +''' ' +
                      CondicaoOrder;
          end;
      end;

   if Input[0] = 118 then
      begin
       if Input[1] = '3' then
          begin
            FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[2]) + ''' AND  PED.DTA_PEDIDO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3]))) +''' AND ' +
                 ' PED.DTA_PEDIDO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])))+''' '+
                 ' AND PED.ID_VENDEDOR = ''' + VarToStr(Input[5]) +''' ' +
                      CondicaoOrder;
          end;
      end;

    if Input[0] = 119 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.SITUACAO in (0,2)  AND PED.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PED.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ' +
              CondicaoOrder;
      end;

   if Input[0] = 120 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.SITUACAO in (0,2)  AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  PED.DTA_PEDIDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
                  CondicaoOrder;
      end;

   if Input[0] = 121 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
                 ' WHERE PED.SITUACAO in (0,2)  AND PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
                 Format('upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]) +
                         CondicaoOrder;
      end;

   if Input[0] = 122 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND PED.SITUACAO in ('+ VarToStr(Input[2]) + ') ' +
             '   AND PED.ID_CLIENTE  = ''' + VarToStr(Input[3]) + ''' ' +
             ' ORDER BY PED.ID_PEDIDO DESC ';
      end;

   if Input[0] = 123 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND ( PED.SITUACAO in ('+ VarToStr(Input[2]) + ') or ' +
             '         EXISTS (SELECT * FROM FAT_TB_M_NFE nfe ' +
             '                    inner join pcp_tb_m_ors ORS ON ORS.ID_ORS = NFE.ID_ORS ' +
             '                 where  ors.id_pedido = ped.id_pedido and ' +
             '                        nfe.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''') )' +
             ' ORDER BY PED.ID_PEDIDO DESC, PED.DTA_PEDIDO DESC ';
      end;

   if Input[0] = 124 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND ( PED.SITUACAO in ('+ VarToStr(Input[2]) + ') or ' +
             '         EXISTS (SELECT * FROM FAT_TB_M_NFE nfe ' +
             '                    inner join pcp_tb_m_ors ORS ON ORS.ID_ORS = NFE.ID_ORS ' +
             '                 where  ors.id_pedido = ped.id_pedido and ' +
             '                        nfe.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''') )' +
             '   AND PED.ID_CLIENTE  = ''' + VarToStr(Input[3]) + ''' ' +
             ' ORDER BY PED.ID_PEDIDO DESC, PED.DTA_PEDIDO DESC ';
      end;


   if Input[0] = 125 then
      begin
        FAT_SQ_M_PED.CommandText := enSqlFatPed +
             ' WHERE PED.ID_EMPRESA = ''' + VarToStr(Input[1]) +
              ''' AND PED.SITUACAO in (0,2) AND PED.SITUACAO_APROVACAO='''+'0'+''' AND CPG.TIPO_PAGAMENTO = 2  ';

             if Input[2] = 0 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.DTA_PEDIDO, PED.ID_PEDIDO ';

             if Input[2] = 1 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.DTA_PEDIDO DESC, PED.ID_PEDIDO ';

             if Input[2] = 2 then
                FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.ID_PEDIDO ';

             if Input[2] = 3 then
                 FAT_SQ_M_PED.CommandText := FAT_SQ_M_PED.CommandText +
                     ' ORDER BY INT_NOMEEST,INT_NOMECID,PED.ID_PEDIDO DESC ';
      end;



  {   Cdigo do pedido
Nome do cliente
Nome do vendedor
Desc. condio pagto
Desc. tipo de estoque
Data
Cnpj/Cpf
ltimos 15 dias
Cidade }



   //CMServerForm.mm.Lines.Add(FAT_SQ_M_PED.CommandText);

   Result := FAT_DP_M_PED.Data;

   FAT_SQ_M_PED.Close;
end;

procedure TSM.FAT_DP_M_PEDGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FAT_DP_M_PEDUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_TME: TClientDataSet;
  BUS_CD_C_PAR_CTR, FAT_CD_M_ORC, FAT_CD_M_NFE,
  PCP_CD_M_ROM, PCP_CD_M_ROM_PED, PCP_CD_M_ROM_PED_ITE, PCP_CD_M_ROM_ITE: TClientDataSet;
  FAT_CD_M_PCA, FAT_CD_M_PCA_PED, FAT_CD_M_PCA_PED_ITE: TClientDataSet;
  BUS_CD_M_PED_GER, BUS_CD_M_PED_ITE_GER, BUS_CD_M_PED_TIT_GER, BUS_CD_M_OPR_PED_INT: TClientDataSet;
  BUS_CD_C_PAR_MOD: TDataSet;
  SituacaoPedAnt,SituacaoPed, SituacaoAprov: integer;
  PedAprovado,PedAprovadoAnt: Boolean;
  EnviaCarga,Conferido:Boolean;

  DataSet_Itens, DataSet_Tit : TDataSet;

  QtdeAnt: Currency;
  gerar_perdido_diferenca: Boolean;

  id_pedido_novo_ger: string;
begin

  try

  // Buscar dados do parmetros de controle
  BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
  BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
  BUS_CD_C_PAR_CTR.Close;
  BUS_CD_C_PAR_CTR.Data :=
      BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

  BUS_CD_C_PAR_MOD := TDataSetField(BUS_CD_C_PAR_CTR.FieldByName('BUS_SQ_C_PAR_MOD')).NestedDataSet;


  if (BUS_CD_C_PAR_MOD.FieldByName('SGQ').AsBoolean) then
     begin
       if (DataSet.UpdateStatus in [usUnmodified]) then
           begin
             { BBB_SQ_M_ROM_PED_ITE_INT := TSQLDataSet.Create(nil);
              BBB_SQ_M_ROM_PED_ITE_INT.SQLConnection := conexao;
              BBB_SQ_M_ROM_PED_ITE_INT.CommandType   := ctQuery;
              BBB_SQ_M_ROM_PED_ITE_INT.CommandText   := ' SELECT * FROM PCP_TB_M_ROM_PED_ITE '
                                                        ' WHERE ID_PEDIDO = ' +
                                                          dataset.FieldByName('ID_PEDIDO').AsString;

              BBB_DP_M_ROM_PED_ITE_INT := TDataSetProvider.Create(nil);
              BBB_DP_M_ROM_PED_ITE_INT.DataSet := BBB_SQ_M_ROM_PED_ITE_INT;

              BBB_CD_M_ROM_PED_ITE_INT := TClientDataSet.Create(nil);
              BBB_CD_M_ROM_PED_ITE_INT.SetProvider(BBB_DP_M_ROM_PED_ITE_INT);
              BBB_CD_M_ROM_PED_ITE_INT.Open;}

              DataSet_Itens := TDataSetField(DataSet.FieldByName('FAT_SQ_M_PED_ITE')).NestedDataSet;
              DataSet_Tit   := TDataSetField(DataSet.FieldByName('FAT_SQ_M_PED_TIT')).NestedDataSet;

              PCP_CD_M_ROM := TClientDataSet.Create(self);
              PCP_CD_M_ROM.SetProvider(PCP_DP_M_ROM);
              PCP_CD_M_ROM.Close;
              PCP_CD_M_ROM.Data :=
                   PCP_CD_M_ROM.DataRequest(VarArrayOf([6,DataSet.FieldByName('ID_PEDIDO').AsInteger]));

              PCP_CD_M_ROM_ITE := TClientDataSet.Create(self);
              PCP_CD_M_ROM_ITE.DataSetField     := TDataSetField(PCP_CD_M_ROM.FieldByName('PCP_SQ_M_ROM_ITE'));

              PCP_CD_M_ROM_PED := TClientDataSet.Create(self);
              PCP_CD_M_ROM_PED.DataSetField     := TDataSetField(PCP_CD_M_ROM.FieldByName('PCP_SQ_M_ROM_PED'));

              PCP_CD_M_ROM_PED_ITE := TClientDataSet.Create(self);
              PCP_CD_M_ROM_PED_ITE.DataSetField := TDataSetField(PCP_CD_M_ROM_PED.FieldByName('PCP_SQ_M_ROM_PED_ITE'));



              if not (PCP_CD_M_ROM.IsEmpty) then
                 begin
                   PCP_CD_M_ROM.edit;


                   PCP_CD_M_ROM_PED.Locate('id_pedido',DataSet.FieldByName('ID_PEDIDO').AsInteger,[]);

                   PCP_CD_M_ROM_PED_ITE.First;
                   while not (PCP_CD_M_ROM_PED_ITE.eof) do
                       begin
                         PCP_CD_M_ROM.FieldByName('ped_ite_qtde_total').AsCurrency :=
                             PCP_CD_M_ROM.FieldByName('ped_ite_qtde_total').AsCurrency  -
                                 PCP_CD_M_ROM_PED_ITE.FieldByName('qtde').AsCurrency;
                         PCP_CD_M_ROM_PED_ITE.Next;
                       end;
                   PCP_CD_M_ROM_PED_ITE.First;

                   DataSet_Itens.First;
                   while not (DataSet_Itens.Eof) do
                       begin
                          if (DataSet_Itens.UpdateStatus in [usUnmodified]) then
                              begin
                                DataSet_Itens.Next;
                                if (DataSet_Itens.UpdateStatus in [usModified]) then
                                   begin
                                     if DataSet_Itens.FieldByName('qtde').AsString <> '' then
                                        begin
                                          DataSet_Itens.Prior;

                                          QtdeAnt := DataSet_Itens.FieldByName('qtde').AsCurrency;

                                          if PCP_CD_M_ROM_PED_ITE.locate('id_pedido;id_item;id_ped_ite',
                                                                             VarArrayOf([DataSet_Itens.FieldByName('id_pedido').AsString,
                                                                                         DataSet_Itens.FieldByName('id_item').AsString,
                                                                                         DataSet_Itens.FieldByName('id_sequencia').AsString
                                                                                        ]),[]) then
                                             begin
                                               DataSet_Itens.Next;
                                               if PCP_CD_M_ROM_PED_ITE.FieldByName('qtde').AsCurrency <>
                                                  DataSet_Itens.FieldByName('qtde').AsCurrency then
                                                  begin
                                                    PCP_CD_M_ROM_PED_ITE.edit;
                                                    PCP_CD_M_ROM_PED_ITE.FieldByName('qtde').AsCurrency :=
                                                        DataSet_Itens.FieldByName('qtde').AsCurrency;
                                                    PCP_CD_M_ROM_PED_ITE.Post;
                                                  end;

                                                DataSet_Itens.Prior;
                                              end;

                                          if PCP_CD_M_ROM_ITE.locate('id_item;id_cor;id_tamanho',
                                                                         VarArrayOf([DataSet_Itens.FieldByName('id_item').AsString,
                                                                                     DataSet_Itens.FieldByName('id_cor').AsString,
                                                                                     DataSet_Itens.FieldByName('id_tamanho').AsString
                                                                                    ]),[]) then
                                             begin
                                                DataSet_Itens.Next;
                                                if PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency <>
                                                   DataSet_Itens.FieldByName('qtde').AsCurrency then
                                                   begin
                                                     PCP_CD_M_ROM_ITE.edit;
                                                     PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency :=
                                                        ( PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency - QtdeAnt ) +
                                                        DataSet_Itens.FieldByName('qtde').AsCurrency;
                                                     PCP_CD_M_ROM_ITE.Post;
                                                  end;
                                             end;
                                        end;
                                   end
                                else
                                   begin
                                     DataSet_Itens.Prior;
                                   end;
                              end;

                          if (DataSet_Itens.UpdateStatus in [usDeleted]) then
                              begin
                                if PCP_CD_M_ROM_PED_ITE.locate('id_pedido;id_item;id_ped_ite',
                                                               VarArrayOf([DataSet_Itens.FieldByName('id_pedido').AsString,
                                                                           DataSet_Itens.FieldByName('id_item').AsString,
                                                                           DataSet_Itens.FieldByName('id_sequencia').AsString
                                                                          ]),[]) then
                                   begin
                                     // Maxsuel Victor , em 24/10/2017
                                     // O item do pedido de venda, que fica t no romaneio, s pode ser excludo
                                     // se o mesmo no tiver nenhuma conferncia.
                                     // Se o item estiver confirido, o sistema no deixa delatar o item na tela do pedido de venda.
                                     if PCP_CD_M_ROM_PED_ITE.FieldByName('qtde_conferida').AsInteger = 0 then
                                        begin
                                          PCP_CD_M_ROM_PED_ITE.delete;

                                          if PCP_CD_M_ROM_ITE.locate('id_item;id_cor;id_tamanho',
                                                               VarArrayOf([DataSet_Itens.FieldByName('id_item').AsString,
                                                                           DataSet_Itens.FieldByName('id_cor').AsString,
                                                                           DataSet_Itens.FieldByName('id_tamanho').AsString
                                                                          ]),[]) then
                                             begin
                                                if (PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency >=
                                                    DataSet_Itens.FieldByName('qtde').AsCurrency) then
                                                   begin
                                                   //  if (PCP_CD_M_ROM_ITE.FieldByName('qtde_conferida').AsCurrency -
                                                   //      DataSet_Itens.FieldByName('qtde').AsCurrency) <=
                                                   //      PCP_CD_M_ROM_ITE.FieldByName('qtde_conferida').AsCurrency then
                                                   //      begin
                                                           PCP_CD_M_ROM_ITE.edit;
                                                           PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency :=
                                                                PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency -
                                                                    DataSet_Itens.FieldByName('qtde').AsCurrency;
                                                           PCP_CD_M_ROM_ITE.post;


                                                           if PCP_CD_M_ROM_ITE.FieldByName('qtde').AsCurrency = 0 then
                                                              PCP_CD_M_ROM_ITE.delete;
                                                   //      end;
                                                   end;
                                             end;
                                        end;
                                   end;

                              end;
                          DataSet_Itens.Next;
                       end;
                    PCP_CD_M_ROM.edit;
                    //PCP_CD_M_ROM.FieldByName('ped_ite_qtde_total').AsCurrency := 0;

                    PCP_CD_M_ROM_PED_ITE.First;
                    while not (PCP_CD_M_ROM_PED_ITE.eof) do
                       begin
                         PCP_CD_M_ROM.FieldByName('ped_ite_qtde_total').AsCurrency :=
                             PCP_CD_M_ROM.FieldByName('ped_ite_qtde_total').AsCurrency  +
                                 PCP_CD_M_ROM_PED_ITE.FieldByName('qtde').AsCurrency;
                         PCP_CD_M_ROM_PED_ITE.Next;
                       end;
                    PCP_CD_M_ROM.Post;
                 end;


             gerar_perdido_diferenca := false;

             DataSet.Next;
             if (DataSet.UpdateStatus in [usModified]) then
                 begin
                   if DataSet.FieldByName('GERAR_PEDIDO_DIFERENCA').text <> '' then
                      begin
                        gerar_perdido_diferenca := DataSet.FieldByName('GERAR_PEDIDO_DIFERENCA').AsBoolean;
                        id_pedido_novo_ger      := DataSet.FieldByName('id_pedido_gerado').AsString;
                      end;
                 end;
             DataSet.Prior;

             if (gerar_perdido_diferenca) and (DataSet.FieldByName('situacao').AsInteger = 2) then // em produo
                begin

                   // id_pedido_novo_ger := DataSet.GetOptionalParam('ID_PEDIDO_GERADO');

                   BUS_CD_M_OPR_PED_INT := TClientDataSet.Create(self);
                   BUS_CD_M_OPR_PED_INT.SetProvider(BUS_DP_M_OPR_PED_INT);
                   BUS_CD_M_OPR_PED_INT.Close;
                       BUS_CD_M_OPR_PED_INT.Data :=
                           BUS_CD_M_OPR_PED_INT.DataRequest(VarArrayOf([0, DataSet.FieldByName('pcp_id_opr').AsInteger]));

                   BUS_CD_M_PED_GER := TClientDataSet.Create(self);
                   BUS_CD_M_PED_GER.SetProvider(BUS_DP_M_PED_GER);
                   BUS_CD_M_PED_GER.Close;
                   BUS_CD_M_PED_GER.Data :=
                         BUS_CD_M_PED_GER.DataRequest(VarArrayOf([0,'']));

                   BUS_CD_M_PED_ITE_GER := TClientDataSet.Create(self);
                   BUS_CD_M_PED_ITE_GER.DataSetField     := TDataSetField(BUS_CD_M_PED_GER.FieldByName('BUS_SQ_M_PED_ITE_GER'));

                   BUS_CD_M_PED_TIT_GER := TClientDataSet.Create(self);
                   BUS_CD_M_PED_TIT_GER.DataSetField     := TDataSetField(BUS_CD_M_PED_GER.FieldByName('BUS_SQ_M_PED_TIT_GER'));

                   fat_rn_m_ped.FatGerarNovoPed(id_pedido_novo_ger, DataSet,DataSet_Itens, DataSet_Tit,BUS_CD_M_PED_GER,
                                                BUS_CD_M_PED_ITE_GER,BUS_CD_M_PED_TIT_GER,BUS_CD_M_OPR_PED_INT,self);
                end;

             FAT_CD_M_PCA  := TClientDataSet.Create(nil);
             FAT_CD_M_PCA.SetProvider(FAT_DP_M_PCA);
             FAT_CD_M_PCA.close;
             FAT_CD_M_PCA.Data :=
                   FAT_CD_M_PCA.DataRequest(VarArrayOf([3,DataSet.FieldByName('ID_PEDIDO').AsInteger]));

             FAT_CD_M_PCA_PED     := TClientDataSet.Create(self);
             FAT_CD_M_PCA_PED.DataSetField     := TDataSetField(FAT_CD_M_PCA.FieldByName('FAT_SQ_M_PCA_PED'));

             FAT_CD_M_PCA_PED_ITE := TClientDataSet.Create(self);
             FAT_CD_M_PCA_PED_ITE.DataSetField     := TDataSetField(FAT_CD_M_PCA_PED.FieldByName('FAT_SQ_M_PCA_PED_ITE'));

             if not (FAT_CD_M_PCA.IsEmpty) then
                begin
                  DataSet_Itens.First;
                  while not (DataSet_Itens.Eof) do
                     begin
                        if (DataSet_Itens.UpdateStatus in [usDeleted]) then
                            begin
                              if FAT_CD_M_PCA_PED_ITE.Locate('ID_PEDIDO;ID_SEQUENCIA',
                                     VarArrayOf([DataSet_Itens.FieldByName('id_pedido').AsInteger,DataSet_Itens.FieldByName('id_sequencia').AsInteger]),[]) then
                                 begin
                                   FAT_CD_M_PCA_PED_ITE.Delete;
                                 end;
                            end;
                        DataSet_Itens.Next;
                     end;
                end;
             DataSet_Itens.First;

             if PCP_CD_M_ROM <> nil then
                if PCP_CD_M_ROM.ChangeCount > 0 then
                   if not (PCP_CD_M_ROM.ApplyUpdates(0) = 0) then
                      begin
                        raise Exception.Create('Erro ao tentar atualizar o Relatrio de Carga(Romaneio - PCP_TB_M_ROM).');
                        abort;
                      end;

             if FAT_CD_M_PCA <> nil then
                if FAT_CD_M_PCA.ChangeCount > 0 then
                   if not (FAT_CD_M_PCA.ApplyUpdates(0) = 0) then
                      begin
                        raise Exception.Create('Erro ao tentar atualizar o carregamento (Carregamento - FAT_TB_M_PCA).');
                        abort;
                      end;

             if BUS_CD_M_PED_GER <> nil then
                if BUS_CD_M_PED_GER.ChangeCount > 0 then
                   if not (BUS_CD_M_PED_GER.ApplyUpdates(0) = 0) then
                      begin
                        raise Exception.Create('Erro ao tentar gerar o novo pedido de venda (automtico).');
                        abort;
                      end;

             if BUS_CD_M_OPR_PED_INT <> nil then
                if BUS_CD_M_OPR_PED_INT.ChangeCount > 0 then
                   if not (BUS_CD_M_OPR_PED_INT.ApplyUpdates(0) = 0) then
                      begin
                        raise Exception.Create('Erro ao tentar gerar o novo pedido de venda (automtico).');
                        abort;
                      end;

             if PCP_CD_M_ROM <> nil then
                begin
                  FreeAndNil(PCP_CD_M_ROM);
                  FreeAndNil(PCP_CD_M_ROM_PED);
                  FreeAndNil(PCP_CD_M_ROM_PED_ITE);
                end;

             if FAT_CD_M_PCA <> nil then
                begin
                  FreeAndNil(FAT_CD_M_PCA);
                  FreeAndNil(FAT_CD_M_PCA_PED);
                  FreeAndNil(FAT_CD_M_PCA_PED_ITE);
                end;

             if BUS_CD_M_PED_GER <> nil then
                begin
                  FreeAndNil(BUS_CD_M_PED_GER);
                  FreeAndNil(BUS_CD_M_PED_ITE_GER);
                  FreeAndNil(BUS_CD_M_PED_TIT_GER);
                end;

             if BUS_CD_M_OPR_PED_INT <> nil then
                begin
                  FreeAndNil(BUS_CD_M_OPR_PED_INT);
                end;
           end;
     end;

  // 28/01/2025 por Maxsuel Victor
  //  Esse if foi mais pra baixo, para depois dos cdigos da atualizao dos oramento
     // if (BUS_CD_C_PAR_MOD.FieldByName('SGQ').AsBoolean) and (BUS_CD_C_PAR_CTR.FieldByName('sgq_ped_gera_nfs').AsBoolean = false) then
        // exit;

  PedAprovado := false;
  PedAprovadoAnt := false;
  EnviaCarga := false;
  if (DataSet.UpdateStatus in [usInserted]) then
      begin
         if DataSet.FieldByName('SITUACAO_APROVACAO').AsInteger = 1 then
           begin
            PedAprovado := true;
            PedAprovadoAnt := true;
           end;

         SituacaoPed    := DataSet.FieldByName('SITUACAO').AsInteger;
         SituacaoPedAnt := DataSet.FieldByName('SITUACAO').AsInteger;

         EnviaCarga     := DataSet.FieldByName('ENVIA_CARGA').AsBoolean;
         Conferido      := DataSet.FieldByName('CONFERIDO').AsBoolean;

         if DataSet.FieldByName('ID_ORCAMENTO').AsInteger > 0 then
            begin
               // Buscar a ordem de oramento
               FAT_CD_M_ORC := TClientDataSet.Create(nil);
               FAT_CD_M_ORC.SetProvider(FAT_DP_M_ORC);
               FAT_CD_M_ORC.Close;
               FAT_CD_M_ORC.Data :=
                   FAT_CD_M_ORC.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_EMPRESA').AsInteger,DataSet.FieldByName('ID_ORCAMENTO').AsInteger]));

               if not FAT_CD_M_ORC.IsEmpty then
                  begin
                    FAT_CD_M_ORC.edit;
                    FAT_CD_M_ORC.FieldByName('status').AsInteger    := 1;
                    FAT_CD_M_ORC.FieldByName('id_pedido').AsInteger :=
                                 DataSet.FieldByName('id_pedido').AsInteger;
                    FAT_CD_M_ORC.Post;

                    if FAT_CD_M_ORC <> nil then
                       if FAT_CD_M_ORC.ChangeCount > 0 then
                          if not (FAT_CD_M_ORC.ApplyUpdates(0) = 0) then
                                  raise Exception.Create('Erro ao tentar atualizar o oramento.');
                  end;
            end;
      end;


  if (DataSet.UpdateStatus in [usDeleted]) then
      begin
        SituacaoPedAnt := DataSet.FieldByName('SITUACAO').AsInteger;
        SituacaoPed    := DataSet.FieldByName('SITUACAO').AsInteger;
       if DataSet.FieldByName('ID_ORCAMENTO').AsInteger > 0 then
          begin
             // Buscar a ordem de oramento
             FAT_CD_M_ORC := TClientDataSet.Create(nil);
             FAT_CD_M_ORC.SetProvider(FAT_DP_M_ORC);
             FAT_CD_M_ORC.Close;
             FAT_CD_M_ORC.Data :=
                 FAT_CD_M_ORC.DataRequest(VarArrayOf([0, DataSet.FieldByName('ID_EMPRESA').AsInteger,DataSet.FieldByName('ID_ORCAMENTO').AsInteger]));

             if not FAT_CD_M_ORC.IsEmpty then
                begin
                  FAT_CD_M_ORC.edit;
                  FAT_CD_M_ORC.FieldByName('status').AsInteger    := 0;
                  FAT_CD_M_ORC.FieldByName('id_pedido').AsInteger := 0;
                  FAT_CD_M_ORC.Post;

                  if FAT_CD_M_ORC <> nil then
                     if FAT_CD_M_ORC.ChangeCount > 0 then
                        if not (FAT_CD_M_ORC.ApplyUpdates(0) = 0) then
                                raise Exception.Create('Erro ao tentar atualizar o oramento.');
                end;
          end;
      end;


  if (BUS_CD_C_PAR_MOD.FieldByName('SGQ').AsBoolean) and (BUS_CD_C_PAR_CTR.FieldByName('sgq_ped_gera_nfs').AsBoolean = false) then
      exit;


  if (DataSet.UpdateStatus in [usUnmodified]) then
     begin
       SituacaoPedAnt := DataSet.FieldByName('SITUACAO').AsInteger;
       SituacaoPed    := DataSet.FieldByName('SITUACAO').AsInteger;
       EnviaCarga     := DataSet.FieldByName('ENVIA_CARGA').AsBoolean;
       Conferido      := DataSet.FieldByName('CONFERIDO').AsBoolean;


       if DataSet.FieldByName('SITUACAO_APROVACAO').AsInteger = 1 then
         begin
          PedAprovado := true;
          PedAprovadoAnt := true;
         end;

       DataSet.Next;
       if (DataSet.UpdateStatus in [usModified]) then
          begin
             if DataSet.FieldByName('SITUACAO').AsString <> '' then
                SituacaoPed := DataSet.FieldByName('SITUACAO').AsInteger;
             if DataSet.FieldByName('SITUACAO_APROVACAO').AsString <> '' then
                begin
                  if DataSet.FieldByName('SITUACAO_APROVACAO').AsInteger = 0 then
                     begin
                       PedAprovado := false;
                     end;
                  if DataSet.FieldByName('SITUACAO_APROVACAO').AsInteger = 1 then
                     begin
                       PedAprovado := true;
                     end;
                end;
              if DataSet.FieldByName('ENVIA_CARGA').AsString <> '' then
                begin
                  EnviaCarga := DataSet.FieldByName('ENVIA_CARGA').AsBoolean;
                end;
              if DataSet.FieldByName('CONFERIDO').AsString <> '' then
                begin
                  Conferido := DataSet.FieldByName('CONFERIDO').AsBoolean;
                end;
          end;
       DataSet.Prior;
     end;




   // Comentado por Maxsuel Victor, em 19/05/2017 , tive que deixar como antes pois quando alterava o pedido de venda
   // o sistema no estava apagando a nota fiscal.
   //if ((SituacaoPedAnt = 0) and (SituacaoPed = 0)) and (not ((PedAprovadoAnt=true) and (PedAprovado=false)))  then //and (PedAprovado) then

     // em aberto
   if ((SituacaoPedAnt = 0) and (SituacaoPed = 0))  then //and (PedAprovado) then
     begin
       if DataSet.FieldByName('origem').AsString <> '2' then
          begin
            if EnviaCarga = false then
               begin
               FAT_RN_M_EST.FatGerNfs(2,DataSet,CAD_DP_C_PAR, BUS_DP_C_PAR_CTR,CAD_DP_C_ITE,CAD_DP_C_TME,CAD_DP_C_FPG,
                         FAT_DP_M_NFE,BUS_DP_M_NFE_ITE_INT, BUS_DP_M_NFE_TIT_INT,
                         BUS_DP_M_ORV_ITE_INT,BUS_DP_M_ORV_TIT_INT,BUS_DP_M_ORV_TIT_SER_INT,BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,
                         CAD_DP_C_CLI, CAD_DP_C_RAM, BUS_DP_C_TRI_REG,DP_BR_CUPOM_MESTRE,BuscarConnBanco,Self);
               end
            else if EnviaCarga and Conferido and PedAprovado then
               begin
                 FAT_RN_M_EST.FatGerNfsPed(0, DataSet,
                     CAD_DP_C_PAR,BUS_DP_C_PAR_CTR,CAD_DP_C_ITE,CAD_DP_C_TME,CAD_DP_C_FPG,
                     FAT_DP_M_NFE,BUS_DP_M_PED,EST_DP_M_FES,EST_DP_M_FEA,EST_DP_M_LOT,
                     BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,CAD_DP_C_CLI, CAD_DP_C_RAM, BUS_DP_C_TRI_REG,
                    BuscarConnBanco,Self);
               end;

          end
       else
          begin
             // Pedido de Venda cupom  (FAT_FM_M_PNF)
             FAT_RN_M_EST.FatGerNfs(4,DataSet,CAD_DP_C_PAR, BUS_DP_C_PAR_CTR,CAD_DP_C_ITE,CAD_DP_C_TME,CAD_DP_C_FPG,
                         FAT_DP_M_NFE,BUS_DP_M_NFE_ITE_INT, BUS_DP_M_NFE_TIT_INT,
                         BUS_DP_M_ORV_ITE_INT,BUS_DP_M_ORV_TIT_INT,BUS_DP_M_ORV_TIT_SER_INT,BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,
                         CAD_DP_C_CLI, CAD_DP_C_RAM, BUS_DP_C_TRI_REG,DP_BR_CUPOM_MESTRE,BuscarConnBanco,Self);

          end;
     end
  else
     begin
       if (SituacaoPedAnt = 0) and (SituacaoPed = 4) then
          begin

            FAT_CD_M_NFE := TClientDataSet.Create(nil);
            FAT_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
            FAT_CD_M_NFE.Close;
            FAT_CD_M_NFE.Data :=
                  FAT_CD_M_NFE.DataRequest(VarArrayOf([15,DataSet.FieldByName('ID_PEDIDO').AsString]));
            if not FAT_CD_M_NFE.IsEmpty then
               begin
                 if (FAT_CD_M_NFE.FieldByName('status').AsInteger = 0) and
                    (FAT_CD_M_NFE.FieldByName('numero').AsCurrency = 0) then
                    begin
                      FAT_CD_M_NFE.Delete;
                    end
                 else
                    begin
                     if (FAT_CD_M_NFE.FieldByName('prevenda').AsBoolean = false) then
                       begin
                         if (FAT_CD_M_NFE.FieldByName('status').AsInteger = 1) then
                            begin
                              raise Exception.Create('Operao no permitida pois a nota fiscal deste pedido de venda j est com status de encerrada.');
                            end;
                         if(FAT_CD_M_NFE.FieldByName('numero').AsCurrency > 0) then
                            begin
                              raise Exception.Create('Operao no permitida pois a nota fiscal deste pedido de venda j possui nmero.');
                            end;
                       end;
                    end;
               end;

          end;
     end;
                                                           // em aberto             // reprovado
  if (((SituacaoPedAnt = 0) and (SituacaoPed = 0) ) {and (not ((PedAprovadoAnt=true) and (PedAprovado=false)))})  or ( (SituacaoPedAnt = 0) and (SituacaoPed = 1) )  or ((SituacaoPedAnt = 3) and (SituacaoPed = 4)) or ((SituacaoPedAnt = 0) and (SituacaoPed = 4))  then
      begin
        CAD_CD_C_TME := TClientDataSet.Create(nil);
        CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
        CAD_CD_C_TME.Close;
        CAD_CD_C_TME.Data :=
              CAD_CD_C_TME.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString]));

        if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and // Sada
           (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)   then // Normal
           begin
             FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,6,
                                                 DataSet.FieldByName('ID_PEDIDO').AsInteger,
                                                 DataSet,
                                                 BUS_DP_M_PED_ITE_INT,
                                                 CAD_DP_C_TME,
                                                 BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                 EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
           end;
      end;



  if FAT_CD_M_NFE <> nil then
     if FAT_CD_M_NFE.ChangeCount > 0 then
        if not (FAT_CD_M_NFE.ApplyUpdates(0) = 0) then
                raise Exception.Create('Erro ao tentar atualizar o oramento.');



  finally
     BUS_CD_C_PAR_CTR.Free;
     FAT_CD_M_ORC.Free;
     CAD_CD_C_TME.Free;
     if FAT_CD_M_NFE <> nil then
        FreeAndNil(FAT_CD_M_NFE);


     { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
      enAudGravar(Sender,DataSet);
  end;

  //enAudGravar(sender, dataset);



end;

function TSM.FAT_DP_M_PEXDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlFatPex: String;
  begin
    Result := ' select pex.* from fat_tb_m_pex pex ';
  end;
begin
  FAT_SQ_M_PEX.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_PEX.CommandText := enSqlFatPex + ' WHERE 1 = 2 '
        else
           FAT_SQ_M_PEX.CommandText := enSqlFatPex +
             ' WHERE PEX.ID_EMPRESA =   ''' + VarToStr(Input[1]) + ''' AND PEX.ID_PEDIDO = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := FAT_DP_M_PEX.Data;
   FAT_SQ_M_PEX.Close;
end;

function TSM.FAT_DP_M_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   Result := fat_rn_m_pos.fat_dr_m_pos(Sender, Input, FAT_SQ_M_POS, FAT_DP_M_POS);
end;

function TSM.FAT_DP_M_ROMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRom: String;
  begin
    Result :=
       '   select                                                                    ' +
       '      rom.*, mta.nome as int_nomemta, mta.doc_cpf as int_doc_cpf,            ' +
       '     fun.nome as int_nomeres,                                                ' +
       '     vei.id_veiculo as int_id_veiculo, vei.tara as int_tara,                 ' +
       '     vei.cap_veiculo as int_cap_veiculo, vei.tipo_rodado as int_tipo_rodado, ' +
       '     vei.tipo_carroceria as int_tipo_carroceria,                             ' +
       '     vei.renavam as int_renavam, vei.uf_licenciado as int_uf_licenciado,     ' +
       '     cast( case rom.tipo                     ' +
       '        when 0 then ''Clientes''             ' +
       '        when 1 then ''Fornecedores''         ' +
       '     end as varchar(20) ) as int_desctipo,   ' +
       '     vei.placa_reboque as int_placa_reboque, ' +
       '     vei.tara_reboque as int_tara_reboque, vei.cap_reboque as int_cap_reboque, ' +
       '     vei.cubagem_reboque as int_cubagem_reboque     ' +
       '                                                                             ' +
       '    from fat_tb_m_rom rom                                                    ' +
       '      left outer join pcp_tb_c_mta mta on                                    ' +
       '         (mta.id_motorista = rom.id_motorista)                               ' +
       '     left outer join cad_tb_c_fun fun on                                     ' +
       '         (fun.id_funcionario = rom.id_responsavel)                           ' +
       '     left outer join cad_tb_c_vei vei on                                     ' +
       '         (vei.id_placa = rom.id_placa)                                       ';
  end;
begin
   FAT_SQ_M_ROM.Close;

   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_ROM.CommandText := enSqlFatRom + ' WHERE 1=2 '
        else
           FAT_SQ_M_ROM.CommandText := enSqlFatRom +
              ' WHERE ID_ROMANEIO = ''' + VarToStr(Input[1]) + ''' ';
      end;

   if Input[0] = 1 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
           ' WHERE ROM.ID_EMPRESA  = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ROM.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

   if Input[0] = 2 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
           ' WHERE ROM.ID_EMPRESA   = ''' + VarToStr(Input[1]) + ''' AND ' +
           '       ROM.ID_MOTORISTA = ''' + VarToStr(Input[2]) + ''' ' ;
      end;

   if Input[0] = 3 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
          ' WHERE ROM.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
             Format(' upper(MTA.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;


   if Input[0] = 4 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
          ' WHERE ROM.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
             Format(' upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   if Input[0] = 5 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
          ' WHERE ROM.ID_PLACA = ''' + VarToStr(Input[1]) + ''' AND ' +
          '       rom.status = 1 and ' +
          '       coalesce(ROM.cancelado,false) = false and ' +
          '       coalesce(ROM.mdf_encerrado,false) = false ';
      end;

   if Input[0] = 6 then
      begin
        FAT_SQ_M_ROM.CommandText := enSqlFatRom +
          ' WHERE rom.status = 1 and ' +
          '       coalesce(ROM.cancelado,false) = false and ' +
          '       coalesce(ROM.mdf_encerrado,false) = false ';
      end;

   FAT_SQ_M_ROM.CommandText := FAT_SQ_M_ROM.CommandText  +
                               ' ORDER BY DTA_EMISSAO DESC ';

   Result := FAT_DP_M_ROM.Data;

   FAT_SQ_M_ROM.Close;
end;

procedure TSM.FAT_DP_M_ROMGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FAT_DP_M_ROMUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin


   FAT_RN_M_ROM.FAT_DP_M_ROMUpdateData(Sender, DataSet,FAT_DP_M_PCA,BUS_DP_M_PCA);
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 06/09/2016 }
  enAudGravar(Sender,DataSet);

end;

function TSM.FAT_DP_M_XMLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlXml: String;
  begin
    Result :=
      ' select xml.*, '+
      ' tme.descricao as int_desctme, '+
      ' cpg.descricao as int_desccpg '+
      ' from fat_tb_m_xml xml '+
      ' left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=xml.id_tipo_estoque '+
      ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=xml.id_condicao_pag ';
  end;
begin
   { TODO -oLuan : Criado no dia 31/03/2016 }

   FAT_SQ_M_XML.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_XML.CommandText := enSqlXml + ' WHERE 1=2 '
        else
           FAT_SQ_M_XML.CommandText := enSqlXml +
             ' WHERE XML.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
             '   XML.ID_CONTROLE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FAT_SQ_M_XML.CommandText := enSqlXml +
          ' WHERE XML.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   XML.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else if Input[0] = 2 then
      begin
        FAT_SQ_M_XML.CommandText := enSqlXml +
          ' WHERE XML.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   XML.NOTA_FISCAL = ''' + VarToStr(Input[2])  +''' ';
      end
   else if Input[0] = 3 then
      begin
        FAT_SQ_M_XML.CommandText := enSqlXml +
          ' WHERE XML.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          Format('upper(XML.NOME_EMITENTE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        FAT_SQ_M_XML.CommandText := enSqlXml +
          ' WHERE XML.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          ' XML.CNPJ_EMITENTE = '''+ VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 5 then
      begin
        FAT_SQ_M_XML.CommandText := enSqlXml +
          ' WHERE XML.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := FAT_DP_M_XML.Data;
end;

function TSM.FAT_DP_R_ABC_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlRelFatAbcCli: String;
   ListaCodGrupo:TStrings;
   i:Integer;
begin

  enSqlRelFatAbcCli := '';

  {
     input[0] - Data ini
     input[1] - Data fin
     input[2] - Empresa
     input[3] - Faixa A
     input[4] - Faixa B
     input[5] - Faixa C
     input[6] - Tipo de Estoque
     input[7] - CFOP
     input[8] - Condio de Pagamento
     input[9] - Vendedor
     input[10] - Perfil do Cliente
     input[11] - Forncedor
  }


  enSqlRelFatAbcCli :=
                  ' with REL_CURVA_ABC  '+
                  '  AS                   '+
                  '    (                    '+
                  '  SELECT                   '+
                  '     NFE.ID_EMITENTE AS ID_CLIENTE, '+
                  '     CLI.NOME AS INT_NOMECLI, CLI.ID_PERFIL_CLI, '+
                  '     CID.UF AS ESTADO, '+
                  '     CID.NOME AS INT_NOMECID, '+
                  '        SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_VENDA, '+
                  '     (( SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)))*100)/  '+

                  '     (SELECT  SUM(COALESCE(I_NIT.VLR_UNITARIO*(I_NIT.QTDE-I_NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(I_NIT.VLR_DESCONTO,0)/I_NIT.QTDE)*(I_nit.qtde-I_nit.qtde_devolvida)) '+
                  '      FROM FAT_TB_M_NFE_ITE I_NIT '+
                  '        LEFT OUTER JOIN FAT_TB_M_NFE I_NFE ON I_NFE.ID_FISCAL = I_NIT.ID_FISCAL '+
                  '        LEFT OUTER JOIN CAD_TB_C_CFO CFO   ON CFO.ID_CFO      = I_NFE.ID_CFO  ' +
                  '        LEFT OUTER JOIN CAD_TB_C_CLI CLI   ON CLI.ID_CLIENTE  = I_NFE.ID_EMITENTE  '+
                  '        LEFT OUTER JOIN CAD_TB_C_ITE ITE   ON ITE.ID_ITEM     = I_NIT.ID_ITEM   '+
                  '     WHERE ' +
                  '        CFO.ID_CLASSE IN (''SP10'',''SP70'') AND I_NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND I_NFE.STATUS = 1 AND ' +
                  '        I_NFE.FATURADA = true AND I_NFE.TIPO_NF='''+'S'+'''  ' +
                  '        AND I_NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                  '            I_NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
              ' AND I_NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;


   if Input[6] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
              ' AND I_NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
               ' AND I_NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
               ' AND I_NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
               ' AND I_NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;


   if Input[12] <> '' then
      begin
        enSqlRelFatAbcCli := enSqlRelFatAbcCli +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      enSqlRelFatAbcCli := enSqlRelFatAbcCli  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      enSqlRelFatAbcCli := enSqlRelFatAbcCli  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     enSqlRelFatAbcCli := enSqlRelFatAbcCli  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  enSqlRelFatAbcCli := enSqlRelFatAbcCli + ' OR ';
              end;

           enSqlRelFatAbcCli := enSqlRelFatAbcCli + ' ) ';
      end;



  enSqlRelFatAbcCli := enSqlRelFatAbcCli +
                  '        AND I_NFE.TIPO_NF=''S'' AND I_NIT.QTDE>0) AS PERC    ' +

                  '  FROM FAT_TB_M_NFE_ITE NIT  ' +
                  '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL  '+
                  '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR  '+
                  '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE  '+
                  '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE  '+
                  '  LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
                  '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM   '+
                  '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO       '+
                  '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
                  '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
                  '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR  '+
                  '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO       ' +
                  ' WHERE NIT.QTDE > 0                                                                                                       ' +
                  '   AND CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND    ' +
                  '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+'''  ' +
                  '   AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                  '       NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' ;

   FAT_SQ_R_ABC_CLI.Close;
   FAT_SQ_R_ABC_CLI.CommandText := '';
   FAT_SQ_R_ABC_CLI.CommandText := enSqlRelFatAbcCli;

   if Input[2] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
              ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[6] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
              ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;


   if Input[12] <> '' then
      begin
         FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText + ' OR ';
              end;

           FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText + ' ) ';
      end;


   FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
                                   ' GROUP BY 1,2,3,4,5 ' +
                                   ' ORDER BY 6 DESC ' +
                                   ' ) ';

   FAT_SQ_R_ABC_CLI.CommandText := FAT_SQ_R_ABC_CLI.CommandText  +
                   ' SELECT ABC.*,                                                                                                          ' +
                   '  (SELECT coalesce(sum(E2.VLR_VENDA), 0)                                                                                ' +
                   '    FROM  REL_CURVA_ABC e2                                                                                              ' +
                   '    WHERE ABC.PERC<= e2.PERC ) acumulado,                                                                               ' +
                   '  (SELECT coalesce(sum(E2.perc), 0)                                                                                     ' +
                   '    FROM  REL_CURVA_ABC e2                                                                                              ' +
                   '    WHERE ABC.PERC<= e2.PERC ) per_acumulado,                                                                           ' +
                   '    case                                                                                                                ' +
                   '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
                   '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                                   Input[3] +                  ' then ''A'' ' +
                   '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
                   '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3]
                                  + ' and ' +
                   '              (SELECT coalesce(sum(E2.perc), 0)      ' +
                   '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                                   Input[3] + ' + ' + Input[4] + ' then ''B'' ' +
                   '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
                   '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3] + ' + ' + Input[4]
                                  + ' and ' +
                   '              (SELECT coalesce(sum(E2.perc), 0)      ' +
                   '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                                   Input[3] + ' + ' + Input[4] + ' + ' + Input[5] + ' then ''C'' ' +
                   '    end as tipo         '+
                   ' FROM REL_CURVA_ABC ABC '+
                   ' ORDER BY ABC.PERC DESC ';

   Result := FAT_DP_R_ABC_CLI.Data;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_ABC_CLI.commandtext);

   FAT_SQ_R_ABC_CLI.Close;

end;

function TSM.FAT_DP_R_ABC_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlRelFatAbcFor: String;
   ListaCodGrupo:TStrings;
   i:Integer;
begin

  enSqlRelFatAbcFor := '';

  {
     input[0] - Data ini
     input[1] - Data fin
     input[2] - Empresa
     input[3] - Faixa A
     input[4] - Faixa B
     input[5] - Faixa C
     input[6] - Tipo de Estoque
     input[7] - CFOP
     input[8] - Condio de Pagamento
     input[09] - Vendedor
     input[10] - Perfil do Cliente
     input[11] - Forncedor
  }


  enSqlRelFatAbcFor :=
                   ' WITH REL_CURVA_ABC                                                                                                     ' +
                   ' AS                                                                                                                     ' +
                   ' (                                                                                                                      ' +
                   ' SELECT                                                                                                                 ' +
                   ' ITE.ID_FORNECEDOR,  '+
                   '    FOC.DESCRICAO,   '+
                   '    CID.UF AS ESTADO, '+
                   '    CID.NOME AS INT_NOMECID,                                                                                            ' +
                   '    SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_VENDA,      ' +
                   '    ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida))  )*100)/           ' +
                   '    (SELECT SUM(COALESCE(I_NIT.VLR_UNITARIO*(I_NIT.QTDE-I_NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(I_NIT.VLR_DESCONTO,0)/I_NIT.QTDE)*(I_nit.qtde-I_nit.qtde_devolvida))    ' +
                   '     FROM FAT_TB_M_NFE_ITE I_NIT                                                                                        ' +
                   '        LEFT OUTER JOIN FAT_TB_M_NFE I_NFE ON I_NFE.ID_FISCAL = I_NIT.ID_FISCAL                                         ' +
                   '        LEFT OUTER JOIN CAD_TB_C_CFO CFO   ON CFO.ID_CFO      = I_NFE.ID_CFO                                                 ' +
                   '        LEFT OUTER JOIN CAD_TB_C_CLI CLI   ON CLI.ID_CLIENTE  = I_NFE.ID_EMITENTE  '+
                   '        LEFT OUTER JOIN CAD_TB_C_ITE ITE   ON ITE.ID_ITEM     = I_NIT.ID_ITEM   '+
                   '     WHERE ' +
                   '        CFO.ID_CLASSE IN (''SP10'',''SP70'') AND I_NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND I_NFE.STATUS = 1 AND ' +
                   '        I_NFE.FATURADA = true AND I_NFE.TIPO_NF='''+'S'+'''  ' +
                   '        AND I_NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                   '            I_NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
              ' AND I_NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;


   if Input[6] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
              ' AND I_NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
               ' AND I_NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
               ' AND I_NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
               ' AND I_NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;


   if Input[12] <> '' then
      begin
        enSqlRelFatAbcFor := enSqlRelFatAbcFor +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      enSqlRelFatAbcFor := enSqlRelFatAbcFor  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      enSqlRelFatAbcFor := enSqlRelFatAbcFor  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     enSqlRelFatAbcFor := enSqlRelFatAbcFor  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  enSqlRelFatAbcFor := enSqlRelFatAbcFor + ' OR ';
              end;

           enSqlRelFatAbcFor := enSqlRelFatAbcFor + ' ) ';
      end;


  enSqlRelFatAbcFor := enSqlRelFatAbcFor +
                   '        AND I_NFE.TIPO_NF=''S'' AND I_NIT.QTDE>0) AS PERC                                                                                ' +
                   ' FROM FAT_TB_M_NFE_ITE NIT                                                                                              ' +
                   '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL                                                        ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE                                                     ' +
                   '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI                                                ' +
                   '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR                                                 ' +
                   '  LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE                                    ' +
                   '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM                                                            ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                                                              ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG                                            ' +
                   '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR                                                ' +
                   '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO                                                          ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=FOC.ID_CIDADE                                                        ' +
                   ' WHERE NIT.QTDE > 0                                                                                                       ' +
                   '   AND CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND    ' +
                   '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+'''  ' +
                   '   AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                   '       NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' ;

   FAT_SQ_R_ABC_FOR.Close;
   FAT_SQ_R_ABC_FOR.CommandText := '';
   FAT_SQ_R_ABC_FOR.CommandText := enSqlRelFatAbcFor;

   if Input[2] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
              ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[6] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
              ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;

    if Input[12] <> '' then
      begin
         FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText + ' OR ';
              end;

           FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText + ' ) ';
      end;


   FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
                                   ' GROUP BY 1,2,3,4   ' +
                                   ' ORDER BY 5 DESC      ' +
                                   ' )';

   FAT_SQ_R_ABC_FOR.CommandText := FAT_SQ_R_ABC_FOR.CommandText  +
             ' SELECT ABC.*,                                                                                                          ' +
             '  (SELECT coalesce(sum(E2.VLR_VENDA), 0)                                                                                ' +
             '    FROM  REL_CURVA_ABC e2                                                                                              ' +
             '    WHERE ABC.PERC<= e2.PERC ) acumulado,                                                                               ' +
             '  (SELECT coalesce(sum(E2.perc), 0)                                                                                     ' +
             '    FROM  REL_CURVA_ABC e2                                                                                              ' +
             '    WHERE ABC.PERC<= e2.PERC ) per_acumulado,                                                                           ' +
             '    case                                                                                                                ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] +                  ' then ''A'' ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3]
                            + ' and ' +
             '              (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] + ' + ' + Input[4] + ' then ''B'' ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3] + ' + ' + Input[4]
                            + ' and ' +
             '              (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] + ' + ' + Input[4] + ' + ' + Input[5] + ' then ''C'' ' +
             '    end as tipo         '+
             ' FROM REL_CURVA_ABC ABC '+
             ' ORDER BY ABC.PERC DESC ';

   Result := FAT_DP_R_ABC_FOR.Data;

   FAT_SQ_R_ABC_FOR.Close;
end;

function TSM.FAT_DP_R_ABC_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlRelFatAbcGru: String;
   ListaCodGrupo:TStrings;
   i:Integer;
begin

  enSqlRelFatAbcGru := '';

   {
   input[0] - Data ini
   input[1] - Data fin
   input[2] - Empresa
   input[3] - Faixa A
   input[4] - Faixa B
   input[5] - Faixa C
   input[6] - Tipo de Estoque
   input[7] - CFOP
   input[8] - Condio de Pagamento
   input[09] - Vendedor
   input[10] - Perfil do Cliente
   input[11] - Forncedor
   }


  enSqlRelFatAbcGru :=
                   ' WITH REL_CURVA_ABC                                                                                                     ' +
                   ' AS                                                                                                                     ' +
                   ' (                                                                                                                      ' +
                   ' SELECT                                                                                                                 ' +
                   '    ITE.ID_GRUPO ,                    ' +
                   '    GRU.DESCRICAO AS INT_NOMEGRU,                                                                   ' +
                 //  '    CID.UF AS ESTADO,                                                                               ' +
                 //  '    CID.NOME AS INT_NOMECID,                                                                        ' +
                   '    SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_VENDA,         ' +
                   '    ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida))  )*100)/            ' +
                   '    (SELECT SUM(COALESCE(I_NIT.VLR_UNITARIO*(I_NIT.QTDE-I_NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(I_NIT.VLR_DESCONTO,0)/I_NIT.QTDE)*(I_nit.qtde-I_nit.qtde_devolvida)) ' +
                   '     FROM FAT_TB_M_NFE_ITE I_NIT                                                                                        ' +
                   '        LEFT OUTER JOIN FAT_TB_M_NFE I_NFE ON I_NFE.ID_FISCAL=I_NIT.ID_FISCAL                                           ' +
                   '        LEFT OUTER JOIN CAD_TB_C_CFO CFO   ON CFO.ID_CFO      = I_NFE.ID_CFO                                                 ' +
                   '        LEFT OUTER JOIN CAD_TB_C_CLI CLI   ON CLI.ID_CLIENTE  = I_NFE.ID_EMITENTE  '+
                   '        LEFT OUTER JOIN CAD_TB_C_ITE ITE   ON ITE.ID_ITEM     = I_NIT.ID_ITEM   '+
                   '     WHERE ' +
                   '        CFO.ID_CLASSE IN (''SP10'',''SP70'') AND I_NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND I_NFE.STATUS = 1 AND ' +
                   '        I_NFE.FATURADA = true AND I_NFE.TIPO_NF='''+'S'+'''  ' +
                   '        AND I_NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                   '            I_NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
              ' AND I_NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;


   if Input[6] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
              ' AND I_NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
               ' AND I_NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
               ' AND I_NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
               ' AND I_NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;


   if Input[12] <> '' then
      begin
        enSqlRelFatAbcGru := enSqlRelFatAbcGru +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      enSqlRelFatAbcGru := enSqlRelFatAbcGru  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      enSqlRelFatAbcGru := enSqlRelFatAbcGru  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     enSqlRelFatAbcGru := enSqlRelFatAbcGru  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  enSqlRelFatAbcGru := enSqlRelFatAbcGru + ' OR ';
              end;

           enSqlRelFatAbcGru := enSqlRelFatAbcGru + ' ) ';
      end;

  enSqlRelFatAbcGru := enSqlRelFatAbcGru +
                   '        AND I_NFE.TIPO_NF=''S'' AND I_NIT.QTDE>0) AS PERC                                                               ' +
                   ' FROM FAT_TB_M_NFE_ITE NIT                                                                                              ' +
                   '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL                                                        ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE                                                     ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE                                                        ' +
                   '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI                                                ' +
                   '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR                                                 ' +
                   '  LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE                                    ' +
                   '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM                                                            ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                                                              ' +
                   '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG                                            ' +
                   '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR                                                ' +
                   '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO                                                          ' +
                   ' WHERE NIT.QTDE > 0                                                                                                       ' +
                   '   AND CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND    ' +
                   '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+'''  ' +
                   '   AND   NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
                   '         NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';


   FAT_SQ_R_ABC_GRU.Close;
   FAT_SQ_R_ABC_GRU.CommandText := '';
   FAT_SQ_R_ABC_GRU.CommandText := enSqlRelFatAbcGru;

   if Input[2] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
              ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[6] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
              ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[7]) +') ';
      end;

   if Input[8] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[8]) +') ';
      end;

   if Input[9] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' +  VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
               ' AND ITE.ID_FORNECEDOR in (' +  VarToStr(Input[11]) +') ';
      end;
   if Input[12] <> '' then
      begin
         FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[12]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText + ' OR ';
              end;

           FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText + ' ) ';
      end;



   FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
                                   ' GROUP BY 1,2  ' +
                                   ' ORDER BY 3 DESC     ' +
                                   ' ) ' ;

   FAT_SQ_R_ABC_GRU.CommandText := FAT_SQ_R_ABC_GRU.CommandText  +
             ' SELECT ABC.*,                                                                                                          ' +
             '  (SELECT coalesce(sum(E2.VLR_VENDA), 0)                                                                                ' +
             '    FROM  REL_CURVA_ABC e2                                                                                              ' +
             '    WHERE ABC.PERC<= e2.PERC ) acumulado,                                                                               ' +
             '  (SELECT coalesce(sum(E2.perc), 0)                                                                                     ' +
             '    FROM  REL_CURVA_ABC e2                                                                                              ' +
             '    WHERE ABC.PERC<= e2.PERC ) per_acumulado,                                                                           ' +
             '    case                                                                                                                ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] +                  ' then ''A'' ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3]
                            + ' and ' +
             '              (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] + ' + ' + Input[4] + ' then ''B'' ' +
             '       when  (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) > ' + Input[3] + ' + ' + Input[4]
                            + ' and ' +
             '              (SELECT coalesce(sum(E2.perc), 0)      ' +
             '               FROM  REL_CURVA_ABC e2 WHERE ABC.PERC<= e2.PERC ) <= ' +
                             Input[3] + ' + ' + Input[4] + ' + ' + Input[5] + ' then ''C'' ' +
             '    end as tipo         '+
             ' FROM REL_CURVA_ABC ABC '+
             ' ORDER BY ABC.PERC DESC ';
   //CMServerForm.mm.Clear;
   //CMServerForm.mm.Lines.Add(FAT_SQ_R_ABC_GRU.CommandText);
   Result := FAT_DP_R_ABC_GRU.Data;

   FAT_SQ_R_ABC_GRU.Close;
end;

function TSM.FAT_DP_R_COV_FATDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCovFat,CondicaoOrder :string;
begin
    CondicaoOrder := '';
    if (Input[0] = 0)  then
       begin
             enSqlCovFat :=
              ' SELECT fun.nome as int_nomevend, '+
              ' fun.id_funcionario as int_cod_fun, '+
              ' cli.nome as cliente, '+
              ' cli.id_cliente as int_codcliente, '+
              ' nfe.id_empresa, '+
              ' par.emp_razao as int_emprazao, '+
              ' nfe.numero as Nota_fiscal, '+
              ' nfe.dta_emissao, '+
              ' nfe.vlr_liquido as vlr_liquido, '+

              ' case fun.vnd_interno_externo '+
              ' when 0 then '''+'Interno'+''' '+
              ' when 1 then '''+'Externo'+''' '+
              ' end as tipo_vendedor, '+

              ' case fun.vnd_interno_externo '+
              ' when 0 then cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*gru.per_cmv_interno/100),0) as NUMERIC(18,2)) '+
              ' when 1 then cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*gru.per_cmv_externo/100),0) as NUMERIC(18,2)) '+
              ' end as vlr_comissao ';

             { if VarToStr(Input[3])='0' then
                 begin
                   enSqlCovFat :=  enSqlCovFat +
                     ' case fun.vnd_interno_externo '+
                     ' when 0 then cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*gru.per_cmv_interno/100),0) as NUMERIC(18,2)) '+
                     ' when 1 then cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*gru.per_cmv_externo/100),0) as NUMERIC(18,2)) '+
                     ' end as vlr_comissao ';
                 end;

              if VarToStr(Input[3])='1' then
                 begin
                     enSqlCovFat :=  enSqlCovFat +
                     ' cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*nfi.per_cmv/100),0) as NUMERIC(18,2)) '+
                     ' as vlr_comissao ';
                 end;  }

             enSqlCovFat :=  enSqlCovFat +
              ' from fat_tb_m_nfe nfe '+
              ' left outer join cad_tb_c_cli cli on cli.id_cliente = nfe.id_emitente '+
              ' left outer join cad_tb_c_fun fun on fun.id_funcionario = nfe.id_vendedor '+
              ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa '+
              ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal '+
              ' left outer join cad_tb_c_ite ite on ite.id_item=nfi.id_item '+
              ' left outer join cad_tb_c_for frn on frn.id_fornecedor=ite.id_fornecedor '+
              ' left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo '+
              ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
              ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
              ' NFE.FATURADA = true AND NFE.TIPO_NF=''S'' ';



          CondicaoOrder := ' order by nfe.id_empresa,int_nomevend ';
       end;


  FAT_SQ_R_COV_FAT.Close;
  FAT_SQ_R_COV_FAT.CommandText :='';


  FAT_SQ_R_COV_FAT.CommandText := enSqlCovFat +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[4] <> '' then
      begin
        FAT_SQ_R_COV_FAT.CommandText := FAT_SQ_R_COV_FAT.CommandText  +
             ' AND PAR.ID_EMPRESA in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_COV_FAT.CommandText := FAT_SQ_R_COV_FAT.CommandText  +
             ' AND FUN.ID_FUNCIONARIO in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_COV_FAT.CommandText := FAT_SQ_R_COV_FAT.CommandText  +
             ' AND FRN.ID_FORNECEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_COV_FAT.CommandText := FAT_SQ_R_COV_FAT.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[7]) +') ';
      end;

  if CondicaoOrder <>'' then
    begin
      FAT_SQ_R_COV_FAT.CommandText := FAT_SQ_R_COV_FAT.CommandText  +' group by 1,2,3,4,5,6,7,8,9 '+ CondicaoOrder;
    end;
  //CMServerForm.mm.Lines.Add(FAT_SQ_R_COV_FAT.CommandText);
  Result := FAT_DP_R_COV_FAT.Data;

  FAT_SQ_R_COV_FAT.Close;

end;


function TSM.FAT_DP_R_COV_FAT_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCovFat,CondicaoOrder :string;
begin
    CondicaoOrder := '';
    if (Input[0] = 0)  then
       begin
             enSqlCovFat :=
              ' SELECT               '+
              ' nfe.id_empresa,      '+
              ' par.emp_razao as int_emprazao,     '+
              ' fun.id_funcionario as int_cod_fun, '+
              ' fun.nome as int_nomevend,          '+
              ' gru.id_grupo as int_codgrupo,      '+
              ' gru.descricao as int_nomegrupo,    '+
              ' ITE.id_item as int_coditem,        '+
              ' ITE.descricao as int_nomeitem,     '+
              ' cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))),0) as NUMERIC(18,2)) as vlr_liquido, '+
              ' cast(coalesce(sum(((nfi.qtde-nfi.qtde_devolvida)*nfi.vlr_unitario-(coalesce(nfi.vlr_desconto,0)/nfi.qtde)*(nfi.qtde-nfi.qtde_devolvida))*nfi.per_cmv/100),0) as NUMERIC(18,2)) as vlr_comissao  '+
              ' from fat_tb_m_nfe nfe '+
              ' left outer join cad_tb_c_cli cli on cli.id_cliente = nfe.id_emitente '+
              ' left outer join cad_tb_c_fun fun on fun.id_funcionario = nfe.id_vendedor '+
              ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa '+
              ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal '+
              ' left outer join cad_tb_c_ite ite on ite.id_item=nfi.id_item '+
              ' left outer join cad_tb_c_for frn on frn.id_fornecedor=ite.id_fornecedor '+
              ' left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo '+
              ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
              ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
              ' NFE.FATURADA = true AND NFE.TIPO_NF=''S'' ';



          CondicaoOrder := ' order by nfe.id_empresa,int_nomevend,int_nomegrupo,int_nomeitem ';
       end;


  FAT_SQ_R_COV_FAT_ITE.Close;
  FAT_SQ_R_COV_FAT_ITE.CommandText :='';


  FAT_SQ_R_COV_FAT_ITE.CommandText := enSqlCovFat +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_COV_FAT_ITE.CommandText := FAT_SQ_R_COV_FAT_ITE.CommandText  +
             ' AND PAR.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_COV_FAT_ITE.CommandText := FAT_SQ_R_COV_FAT_ITE.CommandText  +
             ' AND FUN.ID_FUNCIONARIO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_COV_FAT_ITE.CommandText := FAT_SQ_R_COV_FAT_ITE.CommandText  +
             ' AND FRN.ID_FORNECEDOR in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_COV_FAT_ITE.CommandText := FAT_SQ_R_COV_FAT_ITE.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[6]) +') ';
      end;

  if CondicaoOrder <>'' then
    begin
      FAT_SQ_R_COV_FAT_ITE.CommandText := FAT_SQ_R_COV_FAT_ITE.CommandText  +' group by 1,2,3,4,5,6,7,8 '+ CondicaoOrder;
    end;
  //CMServerForm.mm.Lines.Add(FAT_SQ_R_COV_FAT.CommandText);
  Result := FAT_DP_R_COV_FAT_ITE.Data;

  FAT_SQ_R_COV_FAT_ITE.Close;
end;

function TSM.FAT_DP_R_COV_FAT_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCovFat,CondicaoOrder :string;
begin
    CondicaoOrder := '';

    enSqlCovFat :=
      ' SELECT fun.nome as int_nomevend, '+
      ' fun.id_funcionario as int_cod_fun, '+
      ' cli.nome as cliente, '+
      ' cli.id_cliente as int_codcliente, '+
      ' ped.id_pedido, '+
      ' ped.id_empresa, '+
      ' ped.dta_pedido, '+
      ' ors.id_ors, '+
      ' par.emp_razao as int_emprazao, '+
      ' nfe.numero as int_numero_nf, '+
      ' nfe.dta_emissao as int_emissao_nf, '+
      ' ped.vlr_liquido as vlr_liquido, '+
      '    coalesce((select sum(ppe.vlr_desc_pos_fat) from fin_tb_m_rbx_ppe ppe ' + #13#10 +
      '          where ppe.id_pedido = ped.id_pedido ),0) as vlr_desc_pos_fat, ' +
      ' ped.sgq_per_comissao, ' +
      ' (cast(      ' +
      '        (ped.vlr_liquido - ' +
      '           coalesce((select sum(ppe.vlr_desc_pos_fat) from fin_tb_m_rbx_ppe ppe ' + #13#10 +
      '            where ppe.id_pedido = ped.id_pedido ),0) ) * ' +
      '        (coalesce(ped.sgq_per_comissao,0)/100) as NUMERIC(18,2))) '+
      ' as vlr_comissao                 '+

      ' from fat_tb_m_ped ped '+
      ' left outer join cad_tb_c_cli cli on cli.id_cliente = ped.id_cliente '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario = ped.id_vendedor '+
      ' left outer join cad_tb_c_par par on par.id_empresa = ped.id_empresa '+
      ' left outer join pcp_tb_m_ors ors on ors.id_pedido=ped.id_pedido '+
      ' left outer join fat_tb_m_nfe nfe on nfe.id_ors=ors.id_ors  '+
      ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
      ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
      ' NFE.FATURADA = true AND NFE.TIPO_NF=''S'' ';

  CondicaoOrder := ' order by ped.id_empresa,int_nomevend,ped.dta_pedido,ped.id_pedido ';



  FAT_SQ_R_COV_FAT_PED.Close;
  FAT_SQ_R_COV_FAT_PED.CommandText :='';


  FAT_SQ_R_COV_FAT_PED.CommandText := enSqlCovFat +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_COV_FAT_PED.CommandText := FAT_SQ_R_COV_FAT_PED.CommandText  +
             ' AND PAR.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_COV_FAT_PED.CommandText := FAT_SQ_R_COV_FAT_PED.CommandText  +
             ' AND FUN.ID_FUNCIONARIO in (' + VarToStr(Input[4]) +') ';
      end;

  if CondicaoOrder <>'' then
    begin
      FAT_SQ_R_COV_FAT_PED.CommandText := FAT_SQ_R_COV_FAT_PED.CommandText + CondicaoOrder;
    end;
  //CMServerForm.mm.Lines.Add(FAT_SQ_R_COV_FAT.CommandText);
  Result := FAT_DP_R_COV_FAT_PED.Data;

  FAT_SQ_R_COV_FAT_PED.Close;
end;

function TSM.FAT_DP_R_COV_RECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCovRec,CondicaoOrder :string;
begin

    if (Input[0] = 1)  then
       begin
         enSqlCovRec :=
          ' select cast(case when fun.nome is null then '' INDEFINIDO'' '+
          '    else  trim(fun.nome) end  as varchar(50)) as int_nomevend, '+

          ' case when FUN.id_funcionario is null then 0 '+
          '   else FUN.id_funcionario end as int_cod_fun, '+

          ' cli.nome as cliente, '+
          ' cli.id_cliente as int_cod_cliente, '+
          ' rec.id_empresa, '+
          ' par.emp_razao as int_emprazao, '+
          ' rec.num_parcela as titulo, '+
          ' rec.dta_emissao, '+
          ' rec.dta_vencimento, '+
          ' pg.dta_pagamento, '+
          ' rec.vlr_original as vlr_titulo, '+
          ' pg.vlr_pagamento, '+
          ' pg.vlr_desconto, '+
          ' pg.vlr_juros,  '+

          ' case fun.vnd_interno_externo '+
	        ' when 0 then '''+'Interno'+''' '+
	        ' when 1 then '''+'Externo'+''' '+
          ' end as tipo_vendedor, '+

          ' case fun.vnd_interno_externo '+
	        ' when 0 then cast(sum(nfi.qtde*nfi.vlr_unitario*gru.per_cmv_interno/100*rec.vlr_original/nfe.vlr_liquido) as NUMERIC(18,2)) '+
	        ' when 1 then cast(sum(nfi.qtde*nfi.vlr_unitario*gru.per_cmv_externo/100*rec.vlr_original/nfe.vlr_liquido) as NUMERIC(18,2)) '+
          ' end as vlr_comissao '+
          ' from fin_tb_m_rec_pag pg '+
          ' left outer join fin_tb_m_rec rec on rec.id_titulo = pg.id_titulo '+
          ' left outer join cad_tb_c_cli cli on cli.id_cliente = rec.id_cliente '+
          ' left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal '+
          ' left outer join cad_tb_c_fun fun on fun.id_funcionario = nfe.id_vendedor '+
          ' left outer join cad_tb_c_par par on par.id_empresa = rec.id_empresa '+
          ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag = pg.id_forma_pag '+
          ' left outer join fat_tb_m_nfe_ite nfi on nfi.id_fiscal=nfe.id_fiscal '+
          ' left outer join cad_tb_c_ite ite on ite.id_item=nfi.id_item '+
          ' left outer join cad_tb_c_for frn on frn.id_fornecedor=ite.id_item '+
          ' left outer join cad_tb_c_gru gru on gru.id_grupo=ite.id_grupo '+
          ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
          ' NFE.FATURADA = true AND NFE.TIPO_NF=''S'' AND REC.VLR_SALDO<>REC.VLR_ORIGINAL AND FPG.DOC_IMPRESSO <> 7 ';

          CondicaoOrder := ' order by rec.id_empresa,int_nomevend,cli.nome';
       end;


  FAT_SQ_R_COV_REC.Close;
  FAT_SQ_R_COV_REC.CommandText :='';


  FAT_SQ_R_COV_REC.CommandText := enSqlCovRec +
   ' AND PG.DTA_PAGAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     PG.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_COV_REC.CommandText := FAT_SQ_R_COV_REC.CommandText  +
             ' AND PAR.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_COV_REC.CommandText := FAT_SQ_R_COV_REC.CommandText  +
             ' AND FUN.ID_FUNCIONARIO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_COV_REC.CommandText := FAT_SQ_R_COV_REC.CommandText  +
             ' AND FRN.ID_FORNECEDOR in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_COV_REC.CommandText := FAT_SQ_R_COV_REC.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[6]) +') ';
      end;

  if CondicaoOrder <>'' then
    begin
       FAT_SQ_R_COV_REC.CommandText := FAT_SQ_R_COV_REC.CommandText  +
       ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,fun.vnd_interno_externo '+
                                        CondicaoOrder;
    end;
  //CMServerForm.mm.Lines.Add(FAT_SQ_R_COV_REC.CommandText);
  Result := FAT_DP_R_COV_REC.Data;

  FAT_SQ_R_COV_REC.Close;
end;

function TSM.FAT_DP_R_DEV_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

   { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 24/11/2014 (select passado por Mariel) }


   // input[0] - Tipo do relatrio
      // 1 - Relatrio Geral
      // 2 - Relatrio por Fornecedor
   // input[1]  - Data inicial
   // input[2]  - Data final
   // input[3]  - Empresa
   // input[4]  - Itens
   // input[5]  - Cor
   // input[6]  - Tamanho
   // input[7] - Fornecedor


   FAT_SQ_R_DEV_FOR.Close;
   FAT_SQ_R_DEV_FOR.CommandText :=

     ' SELECT ITE.ID_ITEM,                             ' +
     '   ITE.DESCRICAO AS INT_NOMEITE,                 ' +
     '   COR.DESCRICAO AS INT_NOMECOR,                 ' +
     '   TAM.DESCRICAO AS INT_NOMETAM,                 ' +
     '   ITE.ID_UND_VENDA,                             ' +
     '   GRU.DESCRICAO AS INT_NOMEGRU,                 ' +
     '   NFE.ID_EMITENTE,                             ' +
     '   FUC.FANTASIA,                                 ' +
     '   FUC.DESCRICAO AS INT_NOMEFOR,                 ' +
     '   coalesce(SUM(NIT.QTDE),0) QTDE,               ' +
     '   coalesce(SUM(NIT.VLR_LIQUIDO),0) VLR_TOTAL    ' +
     ' FROM FAT_TB_M_NFE_ITE NIT                       ' +
     '    LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL ' +
     '    LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM     ' +
     '    LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO   ' +
     '    LEFT OUTER JOIN CAD_TB_C_FOR FUC ON FUC.ID_FORNECEDOR=nfe.ID_EMITENTE ' +
     '    LEFT OUTER JOIN CAD_TB_C_COR COR ON (COR.ID_COR = NIT.ID_COR)           ' +
     '    LEFT OUTER JOIN CAD_TB_C_TAM TAM ON (TAM.ID_TAMANHO = NIT.ID_TAMANHO)  ' +
     ' WHERE NFE.tipo_nf = ''D''  ' +
     '    and    nfe.dta_emissao >= ''' +
                 FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+ ''' ' +
     '    and    nfe.dta_emissao <= ''' +
                 FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )+ ''' ';

   // input[0] - Tipo do relatrio
      // 1 - Relatrio Geral
      // 2 - Relatrio por Fornecedor
   // input[1]  - Data inicial
   // input[2]  - Data final
   // input[3]  - Empresa
   // input[4]  - Itens
   // input[5]  - Cor
   // input[6]  - Tamanho
   // input[7] - Fornecedor

   if Input[3] <> '' then
      begin
        FAT_SQ_R_DEV_FOR.CommandText :=
          FAT_SQ_R_DEV_FOR.CommandText +
          ' and nfe.id_empresa in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        FAT_SQ_R_DEV_FOR.CommandText :=
          FAT_SQ_R_DEV_FOR.CommandText +
          ' and nit.id_item in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        FAT_SQ_R_DEV_FOR.CommandText :=
          FAT_SQ_R_DEV_FOR.CommandText +
          ' and nit.id_cor in (' + VarToStr(Input[5]) +') ';
      end;

   if Input[6] <> '' then
      begin
        FAT_SQ_R_DEV_FOR.CommandText :=
          FAT_SQ_R_DEV_FOR.CommandText +
          ' and nit.id_tamanho in (' + VarToStr(Input[6]) +') ';
      end;

   if Input[7] <> '' then
      begin
        FAT_SQ_R_DEV_FOR.CommandText :=
          FAT_SQ_R_DEV_FOR.CommandText +
          ' and nfe.id_emitente in (' + VarToStr(Input[7]) +') ';
      end;

   FAT_SQ_R_DEV_FOR.CommandText := FAT_SQ_R_DEV_FOR.CommandText  +
     ' GROUP BY  ITE.ID_ITEM,          ' +
     '   ITE.DESCRICAO, COR.DESCRICAO, ' +
     '   TAM.DESCRICAO,ITE.ID_UND_VENDA,' +
     '   GRU.DESCRICAO, NFE.ID_EMITENTE, FUC.FANTASIA, FUC.DESCRICAO';

   if Input[0] = 0 then
      FAT_SQ_R_DEV_FOR.CommandText := FAT_SQ_R_DEV_FOR.CommandText +
           ' order by GRU.DESCRICAO, ITE.DESCRICAO, COR.DESCRICAO, TAM.DESCRICAO ';

   if Input[0] = 1 then
      FAT_SQ_R_DEV_FOR.CommandText := FAT_SQ_R_DEV_FOR.CommandText +
           ' order by nfe.id_emitente, GRU.DESCRICAO, ITE.DESCRICAO, COR.DESCRICAO, TAM.DESCRICAO ';
   // CMServerForm.mm.Lines.Add(EST_SQ_M_FEA.CommandText);
   //GerarSqlTxt(FAT_SQ_R_DEV_FOR);

   Result := FAT_DP_R_DEV_FOR.Data;
end;

function TSM.FAT_DP_R_GAM_0190DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
      ' select und.id_unidade, und.descricao '+
      '  from fat_tb_m_nfe_ite nfi '+
      ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
      ' left outer join cad_tb_c_ite ite on (nfi.id_item = ite.id_item) '+
      ' left outer join cad_tb_c_und und on (und.id_unidade=ite.id_und_compra) '+ //alterei de ite.id_und_venda para ite.id_und_compra.Responsavel:Luan.Data:20/01/2016
      ' left outer join cad_tb_c_par_ctr par on (par.id_empresa = nfe.id_empresa) '  +
      ' where nfe.status = 1 '+
      ' and nfe.modelo in (''01'',''04'',''55'',''02'',''2D'') '+
      ' and nfe.serie <> ''X'' ';
  end;

begin
     { TODO -oLuan -cCriao : Criado em 08/01/2016; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
   //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_0190.Close;


   FAT_SQ_R_GAM_0190.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' and nfe.nfe_cod_sit in (' + VarToStr(Input[3]) +') ';
    if Input[4]=0 then
       begin
        FAT_SQ_R_GAM_0190.CommandText := FAT_SQ_R_GAM_0190.CommandText +
       ' and not ( nfe.ind_emitente =0 and ((par.eff_perfil ='''+'1'+''') or (par.eff_perfil ='''+'0'+'''))  )';

       end;
   FAT_SQ_R_GAM_0190.CommandText := FAT_SQ_R_GAM_0190.CommandText +  ' group by 1,2 ';
   Result := FAT_DP_R_GAM_0190.Data;
   FAT_SQ_R_GAM_0190.Close;
end;

function TSM.FAT_DP_R_GAM_0400DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
     Result :=
       ' select cfo.id_cfo codigo,cfo.descricao,cfo.id_classe '+
       ' from fat_tb_m_nfe_ite nfi '+
       ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
       ' left outer join cad_tb_c_ite ite on (nfi.id_item = ite.id_item) '+
       ' left outer join cad_tb_c_cfo cfo on (cfo.id_cfo=nfi.id_cfo) '+
       ' where nfe.status = 1 '+
       ' and nfe.modelo in (''01'',''04'',''55'',''02'',''2D'') '+
       ' and nfe.serie <> ''X'' ';
  end;
begin

    { TODO -oLuan -cCriao : Criado em 08/01/2016; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
   //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
  FAT_SQ_R_GAM_0400.Close;
  FAT_SQ_R_GAM_0400.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' and nfe.nfe_cod_sit in (' + VarToStr(Input[3]) +') ' +
       ' group by 1,2 ';
  Result := FAT_DP_R_GAM_0400.Data;
  FAT_SQ_R_GAM_0400.Close;
end;

function TSM.FAT_DP_R_GAM_0405DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
      ' select inf.id_inf as codigo, inf.descricao '+
      ' from fat_tb_m_nfe_ite nfi '+
      ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
      ' left outer join cad_tb_c_ite ite on (nfi.id_item = ite.id_item) '+
      ' left outer join cad_tb_c_inf inf on (inf.id_inf=nfi.id_inf_fisco) '+
      ' where nfe.status = 1 '+
      ' and nfe.modelo in (''01'',''04'',''55'',''02'',''2D'') '+
      ' and nfe.serie <> ''X'' ';
  end;
begin
    { TODO -oLuan -cCriao : Criado em 08/01/2016; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
     //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_0405.Close;

   FAT_SQ_R_GAM_0405.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' and nfe.nfe_cod_sit in (' + VarToStr(Input[3]) +') ' +
       ' group by 1,2 ';

   Result := FAT_DP_R_GAM_0405.Data;

   FAT_SQ_R_GAM_0405.Close;
end;

function TSM.FAT_DP_R_GAM_100DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select' + #13#10 +
              '   nfe.id_fiscal, nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj     as cpf_cnpj,' + #13#10 +
              '   frn.id_cidade,' + #13#10 +
              '   nfe.modelo,       ' + #13#10 +
              '   nfe.nfe_cod_sit  as situacao_lancto,' + #13#10 +
              '   0  as qtde_canceladas,' + #13#10 +
              '   nfe.serie, ' + #13#10 +
              '   nfe.sub_serie, ' + #13#10 +
              '   ''''  as cod_consolidado,' + #13#10 +
              '   nfe.numero, ' + #13#10 +
              '   1    as qtde_doc,    ' + #13#10 +
              '   nfe.dta_emissao,' + #13#10 +
              '   nfe.dta_documento,' + #13#10 +
              '   cfo.id_classe, ' + #13#10 +
              '   cfo.id_classe,' + #13#10 +
              '   '''' as num_lancto_contabil,' + #13#10 +
              '   nfe.vlr_mercadoria as vlr_contabil,' + #13#10 +
              '   nfe.iss_valor   as vlr_iss, ' + #13#10 +
              '   nfe.icm_n_base  as vlr_base_icms, ' + #13#10 +
              '   nfe.icm_n_valor as vlr_icms,' + #13#10 +
              '   nfe.icm_s_valor as vlr_icms_subst,    ' + #13#10 +
              '   nfe.vlr_isenta,' + #13#10 +
              '   nfe.vlr_outras,' + #13#10 +
              '   '''' as cod_observacao  ' + #13#10 +
              ' from  fat_tb_m_nfe nfe' + #13#10 +
              '  left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '      (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              '  left outer join cad_tb_c_cpg cpg ON   ' + #13#10 +
              '      (cpg.id_condicao_pag = nfe.id_condicao_pag) ' + #13#10 +
              '  left outer join cad_tb_c_for frn ON   ' + #13#10 +
              '      (frn.id_fornecedor = nfe.id_emitente)' + #13#10 +
              ' where nfe.status = 1' + #13#10 +
              '  and  nfe.modelo in (''06'',''21'',''22'',''28'',''29'')' + #13#10 +
              '  and  nfe.tipo_nf = ''E''  ' + #13#10 +
              '  and  nfe.serie <> ''X'' ';
  end;
begin

   {
      input[0]  - empresa
      input[1]  - Data ini
      input[2]  - Data fin
   }

   FAT_SQ_R_GAM_100.Close;
    //A pedido de Esau,alterei o filtro de dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_100.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.dta_documento ';


   Result := FAT_DP_R_GAM_100.Data;

   FAT_SQ_R_GAM_100.Close;
end;

function TSM.FAT_DP_R_GAM_105DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              'select ' + #13#10 +
              '    nfi.id_fiscal,nfi.id_cfo, nfi.icm_n_aliquota as aliq_icm,  ' + #13#10 +
              '    coalesce(sum(nfi.vlr_mercadoria),0) as vlr_mercadoria,' + #13#10 +
              '    COALESCE(sum(nfi.iss_valor),0)   as vlr_iss,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_base),0)  as vlr_base_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_valor),0) as vlr_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_s_valor),0) as vlr_icms_subst,     ' + #13#10 +
              '    COALESCE(sum(nfi.vlr_isenta),0)  as vlr_isenta,' + #13#10 +
              '    COALESCE(sum(nfi.vlr_outras),0)  as vlr_outras,' + #13#10 +
              '    0 as ind_petr        ' + #13#10 +
              'from fat_tb_m_nfe_ite nfi' + #13#10 +
              'left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              'where nfe.status = 1' + #13#10 +
              ' and  nfe.modelo in (''06'',''21'',''22'',''28'',''29'')' + #13#10 +
              ' and  nfe.tipo_nf = ''E''  ' + #13#10 +
              ' and  nfe.serie <> ''X''  ' + #13#10;


  end;
begin
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_105.Close;

   FAT_SQ_R_GAM_105.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' group by nfi.id_fiscal, nfi.id_cfo, aliq_icm ' + #13#10 +
       ' order by nfi.id_fiscal, nfi.id_cfo, aliq_icm ';

   Result := FAT_DP_R_GAM_105.Data;

   FAT_SQ_R_GAM_105.Close;
end;

function TSM.FAT_DP_R_GAM_150DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin

    Result :=
                'select ' + #13#10 +
                '   cli.id_cliente AS CODIGO,' + #13#10 +
                '   cli.nome as nome,' + #13#10 +
                '   ''01058'' AS COD_PAIS,   ' + #13#10 +
                '   cli.doc_cnpj_cpf,' + #13#10 +
                '   cid.uf as UF,' + #13#10 +
                '   case cli.pessoa' + #13#10 +
                '      when 1 then cli.doc_ie_identidade ' + #13#10 +
                '   else '''' end as IE, ' + #13#10 +
                '   cid.id_cidade as ID_CIDADE,' + #13#10 +
                '   cli.doc_im as IM,' + #13#10 +
                '   '''' as SUFRAMA, ' + #13#10 +
                '   cli.endereco, cli.numero, cli.end_complemento, cli.bairro ' + #13#10 +
                'from cad_tb_c_cli cli' + #13#10 +
                'left outer join cad_tb_c_cid cid on (cid.ID_CIDADE = cli.ID_CIDADE)' + #13#10 +
                'where exists (select nfe.id_fiscal from fat_tb_m_nfe nfe ' + #13#10 +
                '              where ' + #13#10 +
                '                    nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
                '                and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
                '                and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
                '                and (nfe.tipo_nf = ''S'' or nfe.tipo_nf = ''R'')' + #13#10 +
                '                and nfe.nfe_cod_sit in (' + VarToStr(Input[3]) +') ' +
                '                and nfe.id_emitente = cli.id_cliente ' + #13#10 +
                '                and nfe.numero > 0 '+ #13#10 +
                '                and nfe.modelo in ('+VarToStr(Input[4])+') ' + #13#10 +
                //'                and nfe.modelo in (''01'',''04'',''1B'',''55'',''2D'',''59'')   ' + #13#10 +
                '                and nfe.status = 1 ' + #13#10 +
                '                and nfe.serie <> ''X'') '+ #13#10 +
                '                ' + #13#10 +
                'union all' + #13#10 +
                'select ' + #13#10 +
                '   frn.id_fornecedor AS CODIGO,' + #13#10 +
                '   frn.descricao as nome, ' + #13#10 +
                '   ''01058'' AS COD_PAIS, ' + #13#10 +
                '   COALESCE(frn.doc_cnpj,'''') || COALESCE(frn.doc_cpf,'''')  as doc_cnpj_cpf, ' + #13#10 +
                '   cid.uf as UF, ' + #13#10 +
                '   frn.doc_ie as IE, ' + #13#10 +
                '   cid.id_cidade as ID_CIDADE,' + #13#10 +
                '   frn.doc_im as IM,' + #13#10 +
                '   '''' as SUFRAMA, ' + #13#10 +
                '   frn.endereco, frn.numero, frn.end_complemento, frn.bairro ' + #13#10 +
                'from cad_tb_c_for frn' + #13#10 +
                'left outer join cad_tb_c_cid cid on (cid.ID_CIDADE = frn.ID_CIDADE)' + #13#10 +
                'where exists (select nfe.id_fiscal from fat_tb_m_nfe nfe ' + #13#10 +
                '              where ' + #13#10 +
                '                nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
                '                and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
                '                and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
                '                and (tipo_nf = ''E'' or tipo_nf = ''D'' or tipo_nf = ''F'') ' + #13#10 +
                '                and nfe.nfe_cod_sit in (' + VarToStr(Input[3]) +') ' +
                '                and nfe.id_emitente = frn.id_fornecedor' + #13#10 +
                '                and nfe.numero > 0 ' + #13#10 +
                '                and nfe.modelo in ('+VarToStr(Input[4])+') ' + #13#10 +
               // '                and nfe.modelo in (''01'',''04'',''1B'',''55'',''2D'',''59'')   ' + #13#10 +

                '                and nfe.status = 1 ' + #13#10 +
                '                and nfe.serie <> ''X'') '
  end;
begin
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   {
    input[0]  - Data ini
    input[1]  - Data fin
   }

   FAT_SQ_R_GAM_150.Close;

   FAT_SQ_R_GAM_150.CommandText := enSqlFatRelGam +
                                   ' order by codigo ';

   Result := FAT_DP_R_GAM_150.Data;

   FAT_SQ_R_GAM_150.Close;
end;

function TSM.FAT_DP_R_GAM_190DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
                '   SELECT nfi.id_st_icm, nfi.id_cfo, nfi.icm_n_aliquota,  ' + #13#10 +
                '         sum(coalesce(nfi.vlr_liquido,0)) as vlr_operacao, ' + #13#10 +
                '         sum(coalesce(nfi.icm_n_base,0))  as vlr_bc_icms, ' + #13#10 +
                '         sum(coalesce(nfi.icm_n_valor,0)) as vlr_icms, ' + #13#10 +
                '         sum(coalesce(nfi.icm_s_base,0))  as vlr_base_icms_sub, ' + #13#10 +
                '         sum(coalesce(nfi.icm_s_valor,0)) as vlr_icms_sub, ' + #13#10 +
                '         sum(nfi.qtde*coalesce(nfi.vlr_unitario,0))-sum(coalesce(nfi.icm_n_valor,0)) as vlr_base_reduzida, ' + #13#10 +
                '         sum(coalesce(nfi.ipi_valor,0)) as vlr_ipi ' + #13#10 +
                '   FROM fat_tb_m_nfe_ite nfi ';

  end;
begin

  {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_190.Close;

   FAT_SQ_R_GAM_190.CommandText := enSqlFatRelGam +
       ' where nfi.id_fiscal  in (' + VarToStr(Input[0]) +') ' +
       ' group by 1,2,3 ';


   Result := FAT_DP_R_GAM_190.Data;

   FAT_SQ_R_GAM_190.Close;


end;

function TSM.FAT_DP_R_GAM_200DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
        ' select            ' + #13#10 +
        '      nfi.id_item, ' + #13#10 +
        '      ite.id_ncm,  ' + #13#10 +
        '      ncm.cest,    ' + #13#10 +
        '      ite.descricao,    ' + #13#10 +
        '      ite.id_und_compra,' + #13#10 +
        '      ite.cod_barra,    ' + #13#10 +
        '      gru.tipo_item,    ' + #13#10 +
        '      '''' as ex_ipi,   ' + #13#10 +
        '      '''' as cod_gen,  ' + #13#10 +
        '      gru.ali_interna_icms as aliq_icms ' + #13#10 +
        ' from fat_tb_m_nfe_ite nfi' + #13#10 +
        '   left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
        '   left outer join cad_tb_c_ite ite on (nfi.id_item = ite.id_item)' + #13#10 +
        '   left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)'  + #13#10 +
        '   left outer join cad_tb_c_par_ctr par on (par.id_empresa = nfe.id_empresa)'  + #13#10 +
        '   left outer join cad_tb_c_ncm ncm on (ncm.id_ncm = ite.id_ncm)'  + #13#10 +

        ' where nfe.status = 1    ' + #13#10 +
        '   and nfe.modelo in (''01'',''04'',''1B'',''55'') ' + #13#10+
        ' and nfe.serie <> ''X''  ';

//        '   and nfe.modelo in (''01'',''04'',''55'',''02'',''2D'') ' + #13#10;

    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 14/07/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_200.Close;

   if Input[0]=0 then   //Sped Contribuicoes
      begin
        FAT_SQ_R_GAM_200.CommandText := enSqlFatRelGam +
            ' and nfe.id_empresa   in (' + VarToStr(Input[1]) +') ' +
            ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
            ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) ) + ''' ' +
            ' and nfe.nfe_cod_sit in (' + VarToStr(Input[4]) +') ' +
            ' group by 1,2,3,4,5,6,7,8,9,10 ' +
            ' order by 1,2,3,4,5,6,7,8,9,10 ';
     end;
   if Input[0]=1 then   //Sped Fiscal
      begin
        FAT_SQ_R_GAM_200.CommandText := enSqlFatRelGam +
            ' and nfe.id_empresa   in (' + VarToStr(Input[1]) +') ' +
            ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
            ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) ) + ''' ' +
            ' and nfe.nfe_cod_sit in (' + VarToStr(Input[4]) +') ' +
            ' and not ( nfe.ind_emitente =0 and ((par.eff_perfil ='''+'1'+''') or (par.eff_perfil ='''+'0'+'''))  )' +
            ' group by 1,2,3,4,5,6,7,8,9,10 ' +
            ' order by 1,2,3,4,5,6,7,8,9,10 ';
      end;



   Result := FAT_DP_R_GAM_200.Data;

   FAT_SQ_R_GAM_200.Close;
end;

function TSM.FAT_DP_R_GAM_300DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select ' + #13#10 +
              '    nfi.id_fiscal,' + #13#10 +
              '    nfi.id_sequencia,' + #13#10 +
              '    nfi.id_item,' + #13#10 +
              '    ite.descricao as desc_item,' + #13#10 +
              '    ite.id_und_compra,     ' + #13#10 +
              '    nfi.vlr_unitario, ' + #13#10 +
              '    nfi.qtde,' + #13#10 +
              '    nfi.vlr_desconto,' + #13#10 +
              '    nfi.vlr_acrescimo,     ' + #13#10 +
              '    nfi.vlr_mercadoria,' + #13#10 +
              '    nfi.vlr_liquido,' + #13#10 +
              '    ite.id_ncm,' + #13#10 +
              '    nfi.id_st_icm,' + #13#10 +
              '    nfi.id_cfo,' + #13#10 +
              '    nfi.icm_n_base,' + #13#10 +
              '    nfi.icm_n_aliquota aliq_icms_i, ' + #13#10 +
              '    nfi.icm_n_valor,' + #13#10 +
              '    nfi.icm_s_base,' + #13#10 +
              '    0 as aliq_st,' + #13#10 +
              '    nfi.icm_s_valor,' + #13#10 +
              '    nfi.ipi_base,' + #13#10 +
              '    nfi.ipi_aliquota,' + #13#10 +
              '    nfi.ipi_valor,' + #13#10 +
              '    0 as ind_mov, ' + #13#10 +
              '      '''' as ex_ipi,   ' + #13#10 +
              '      '''' as cod_gen,  ' + #13#10 +
             { '    cfo.id_classe as cod_nat, ' + #13#10 + }
             { '    nfe.id_tipo_mov_estoque as cod_nat,' +  #13#10 + }
              '    nfi.id_cfo as cod_nat,' +  #13#10 +
              '    0 as ind_apur,' + #13#10 +
              '    nfi.id_st_ipi,' + #13#10 +
              '    '''' as cod_enq, nfi.id_st_pis, nfi.pis_base,nfi.pis_aliquota,' + #13#10 +
              '    '''' as quant_bc_pis, 0 as aliq_pis,   nfi.pis_valor,' + #13#10 +
              '    nfi.id_st_cof, nfi.cof_base, nfi.cof_aliquota,' + #13#10 +
              '    '''' as quant_bc_cof, 0 as aliq_cof , nfi.cof_valor,' + #13#10 +
              '    cfo.cod_cta, ncm.cest, ite.cod_barra, gru.tipo_item, ' +
              '    gru.ali_interna_icms as aliq_icms, gru.cod_ntr as nat_rec' + #13#10 +
              'from fat_tb_m_nfe_ite nfi' + #13#10 +
              'left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              'left outer join cad_tb_c_ite ite on ' + #13#10 +
              '     (ite.id_item = nfi.id_item) ' + #13#10 +
              '   left outer join cad_tb_c_gru gru on' + #13#10 +
              '     (gru.id_grupo = ite.id_grupo)' + #13#10 +
              'left outer join cad_tb_c_ncm ncm on (ncm.id_ncm = ite.id_ncm)'  + #13#10 +
              'left outer join cad_tb_c_cfo cfo on ' + #13#10 +
              '     (cfo.id_cfo = nfi.id_cfo) ';
    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 14/07/2015; }

  {
    input[0]  - IdFiscal
  }

   FAT_SQ_R_GAM_300.Close;

   FAT_SQ_R_GAM_300.CommandText := enSqlFatRelGam +
       ' where nfe.id_fiscal  = ''' + VarToStr(Input[0]) +''' ' +
       ' order by nfi.id_item ';
   Result := FAT_DP_R_GAM_300.Data;

   FAT_SQ_R_GAM_300.Close;
end;

function TSM.FAT_DP_R_GAM_405DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select bir.data_movimento, ' +
              '   max(case when bir.SIGLA = ''CRO'' then bir.VALOR else '''' end) CRO,         ' +
              '   max(case when bir.SIGLA = ''CRZ'' then bir.VALOR else '''' end) CRZ,         ' +
              '   max(case when bir.SIGLA = ''CCF'' then bir.VALOR else '''' end) NUM_COO_FIN, ' +
              '   max(case when bir.SIGLA = ''GT''  then bir.VALOR else '''' end) GT_FIN,      ' +
              '   max(case when bir.SIGLA = ''VENDABRUTA'' then bir.VALOR else '''' end)VL_BRT ' +
              ' from BR_ITENS_RZ bir ';
    end;

begin
  { TODO -oMaxsuel -cCriao : Criado em 17/08/2015; }

  {
    input[0]  - Serial
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_405.Close;

   FAT_SQ_R_GAM_405.CommandText := enSqlFatRelGam +
       ' where bir.serial = ''' + VarToStr(Input[0]) +''' ' +
       ' and bir.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and bir.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' group by bir.data_movimento ' +
       ' order by bir.data_movimento ' ;
   Result := FAT_DP_R_GAM_405.Data;
   FAT_SQ_R_GAM_405.Close;
end;

function TSM.FAT_DP_R_GAM_420DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao : Criado em 20/08/2015; }

  {
    input[0]  - Serial
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_420.Close;
   FAT_SQ_R_GAM_420.CommandText :=
                    ' SELECT RZ.data_movimento,' + #13#10 +
                    ' case rz.sigla' + #13#10 +
                    '   when ''ICMSAL'' then rz.tipo||rz.aliquota' + #13#10 +
                    '   when ''ICMSII'' then rz.tipo||rz.aliquota' + #13#10 +
                    '   when ''ICMSFF'' then (''F1'')' + #13#10 +
                    ' end as TOTALIZADOR,' + #13#10 +
                    ' case rz.sigla' + #13#10 +
                    '   when ''ICMSAL'' then rz.valor' + #13#10 +
                    '   when ''ICMSII'' then rz.valor' + #13#10 +
                    '   when ''ICMSFF'' then rz.valor' + #13#10 +
                    ' end as VLR_ACUM,' + #13#10 +
                    ' rz.indice AS num_totalizador,' + #13#10 +
                    ' rz.descricao' + #13#10 +
                    ' FROM br_itens_rz RZ' + #13#10 +
                    ' WHERE trim(rz.valor) > ''0,00'' and  SUBSTR(RZ.tag,1,1)=''3'' AND' + #13#10 +
                    '       RZ.sigla<> ''ICMSNN'' ' + #13#10 +
                    ' and rz.serial = ''' + VarToStr(Input[0]) +''' ' + #13#10 +
                    ' and rz.data_movimento = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
                   // ' and rz.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
                    '  '      + #13#10 +
                    '  '      + #13#10 +
                    ' UNION ALL' + #13#10 +
                    '  '       + #13#10 +
                    '  '      + #13#10 +
                    ' SELECT RZ.data_movimento,' + #13#10 +
                    ' case rz.sigla' + #13#10 +
                    '   when ''ICMSCANCEL'' then ''Can-T''' + #13#10 +
                    '   when ''ICMSDESCONTO'' then ''DT''' + #13#10 +
                    ' end as TOTALIZADOR,' + #13#10 +
                    ' case rz.sigla' + #13#10 +
                    '   when ''ICMSCANCEL'' then rz.valor' + #13#10 +
                    '   when ''ICMSDESCONTO'' then rz.valor' + #13#10 +
                    ' end as VLR_ACUM,' + #13#10 +
                    ' rz.indice AS num_totalizador,' + #13#10 +
                    ' rz.descricao' + #13#10 +
                    ' FROM br_itens_rz RZ' + #13#10 +
                    ' WHERE trim(rz.valor) > ''0,00'' and  SUBSTR(RZ.tag,1,1)=''2'' AND' + #13#10 +
                    '      RZ.sigla IN (''ICMSCANCEL'',''ICMSDESCONTO'')' + #13#10 +
                    ' and rz.serial = ''' + VarToStr(Input[0]) +''' ' + #13#10 +
                    ' and rz.data_movimento = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
                    ' order by 1  ';
                   // ' and rz.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' ;

   Result := FAT_DP_R_GAM_420.Data;
   FAT_SQ_R_GAM_420.Close;
end;

function TSM.FAT_DP_R_GAM_425DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

  { TODO -oMaxsuel -cCriao : Criado em 20/08/2015; }

  {
    input[0]  - Serial
    input[1]  - Data emissao
    input[2]  - Totalizador
   }
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_425.Close;
   FAT_SQ_R_GAM_425.CommandText :=
              ' select nfi.id_item, ite.id_und_compra,   ' + #13#10 +
              '      ite.id_ncm, ncm.cest, ite.descricao,ite.cod_barra, gru.tipo_item, ' + #13#10 +
              '      '''' as ex_ipi,   ' + #13#10 +
              '      '''' as cod_gen,  ' + #13#10 +
              '      gru.ali_interna_icms as aliq_icms, ' + #13#10 +
              '       sum(coalesce(nfi.qtde,0)) quantidade,' + #13#10 +
              '       sum(nfi.vlr_liquido) vlr_total,' + #13#10 +
              '       sum(coalesce(nfi.pis_valor,0)) vlr_pis,' + #13#10 +
              '       sum(coalesce(nfi.cof_valor,0)) vlr_cofins' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi' + #13#10 +
              ' left outer join  fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal' + #13#10 +
              ' left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item' + #13#10 +
              ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)'  + #13#10 +
              ' left outer join cad_tb_c_ncm ncm on (ncm.id_ncm = ite.id_ncm)'  + #13#10 +
              ' where  nfe.tipo_nf = ''S'' and ' + #13#10 +
              '        nfe.ecf_serial_impressora = ''' + VarToStr(Input[0]) +'''  and ' + #13#10 +
              '        nfe.status    = 1 and' + #13#10 +
              '        nfe.nfe_cod_sit <> ''02'' and' + #13#10 +
              '        nfe.nfe_ecf=1 and        ' + #13#10 +
              '        nfe.serie <> ''X'' and ' + #13#10 +
              '        ((nfi.id_st_icm<>''60'') and (nfi.id_st_icm<>''500'') ) and' + #13#10 +
              '        nfe.dta_emissao= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
              '        (''T''|| substr(replace(cast(nfi.icm_n_aliquota as varchar),''.'',''''),1,4))=''' + VarToStr(Input[2]) +''' ' +  #13#10 +
              ' group by 1,2,3,4,5,6,7,8,9,10 ' + #13#10 +
              '     '  + #13#10 +
              ' union all' + #13#10 +
              '     '  + #13#10 +
              ' SELECT nfi.id_item, ite.id_und_compra,   ' + #13#10 +
              '      ite.id_ncm, ncm.cest, ite.descricao,ite.cod_barra, gru.tipo_item, ' + #13#10 +
              '      '''' as ex_ipi,   ' + #13#10 +
              '      '''' as cod_gen,  ' + #13#10 +
              '      gru.ali_interna_icms as aliq_icms, ' + #13#10 +

              '        sum(coalesce(nfi.qtde,0)) quantidade,' + #13#10 +
              '        sum(nfi.vlr_liquido) vlr_total,' + #13#10 +
              '        sum(coalesce(nfi.pis_valor,0)) vlr_pis,' + #13#10 +
              '        sum(coalesce(nfi.cof_valor,0)) vlr_cofins' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi' + #13#10 +
              ' left outer join  fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal' + #13#10 +
              ' left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item' + #13#10 +
              ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)'  + #13#10 +
              ' left outer join cad_tb_c_ncm ncm on (ncm.id_ncm = ite.id_ncm)'  + #13#10 +
              ' WHERE nfe.tipo_nf   = ''S'' and ' + #13#10 +
              '       nfe.ecf_serial_impressora = ''' + VarToStr(Input[0]) +'''  and ' + #13#10 +
              '       nfe.status    = 1 and' + #13#10 +
              '       nfe.nfe_cod_sit = ''02'' and  ' + #13#10 +
              '       nfe.nfe_ecf=1 and ' + #13#10 +
              '        nfe.serie <> ''X'' and ' + #13#10 +
              '       nfe.dta_emissao= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
              '       ''Can-T''= ''' + VarToStr(Input[2]) +''' ' + #13#10 +
              ' group by 1,2,3,4,5,6,7,8,9,10 ' + #13#10 +
              '     '  + #13#10 +
              ' UNION ALL' + #13#10 +
              '     '  + #13#10 +
              ' select nfi.id_item, ite.id_und_compra,   ' + #13#10 +
              '      ite.id_ncm, ncm.cest, ite.descricao,ite.cod_barra, gru.tipo_item, ' + #13#10 +
              '      '''' as ex_ipi,   ' + #13#10 +
              '      '''' as cod_gen,  ' + #13#10 +
              '      gru.ali_interna_icms as aliq_icms, ' + #13#10 +
              '        sum(coalesce(nfi.qtde,0)) quantidade,' + #13#10 +
              '        sum(nfi.vlr_liquido) vlr_total,' + #13#10 +
              '        sum(coalesce(nfi.pis_valor,0)) vlr_pis,' + #13#10 +
              '        sum(coalesce(nfi.cof_valor,0)) vlr_cofins' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi' + #13#10 +
              ' left outer join  fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal' + #13#10 +
              ' left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item' + #13#10 +
              ' left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)'  + #13#10 +
              ' left outer join cad_tb_c_ncm ncm on (ncm.id_ncm = ite.id_ncm)'  + #13#10 +
              ' where  nfe.tipo_nf = ''S'' and ' + #13#10 +
              '        nfe.ecf_serial_impressora = ''' + VarToStr(Input[0]) +'''  and ' + #13#10 +
              '        nfe.status    = 1 and' + #13#10 +
              '        nfe.nfe_cod_sit <> ''02'' and' + #13#10 +
              '        nfe.nfe_ecf=1 and        ' + #13#10 +
              '        nfe.serie <> ''X'' and ' + #13#10 +
              '        ((nfi.id_st_icm=''60'') or (nfi.id_st_icm=''500'') ) and' + #13#10 +
              '        nfe.dta_emissao= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
              '        ''F1''= ''' + VarToStr(Input[2]) +''' '  + #13#10 +
              ' group by 1,2,3,4,5,6,7,8,9,10 ';
   Result := FAT_DP_R_GAM_425.Data;
   FAT_SQ_R_GAM_425.Close;
end;

function TSM.FAT_DP_R_GAM_460DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select' + #13#10 +
              '   nfe.id_fiscal, ' + #13#10 +
              '   nfe.cpf_cnpj,' + #13#10 +
              '   nfe.modelo,    ' + #13#10 +
              '   nfe.nfe_cod_sit,' + #13#10 +
              '   nfe.numero, ' + #13#10 +
              '   nfe.dta_emissao,    ' + #13#10 +
              '   nfe.vlr_liquido as vlr_contabil,' + #13#10 +
              '   nfe.pis_valor, ' + #13#10 +
              '   nfe.cof_valor,' + #13#10 +
              '  '''' as nome_adq ' + #13#10 +
              ' from fat_tb_m_nfe nfe' + #13#10 +
              ' where nfe.status = 1' + #13#10 +
              '  and  nfe.modelo in (''02'',''2D'')' + #13#10 +
              '  and  nfe.nfe_ecf = 1 ' + #13#10 +
              ' and nfe.serie <> ''X'' ';

    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 27/08/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_460.Close;

   FAT_SQ_R_GAM_460.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.id_fiscal ';

   Result := FAT_DP_R_GAM_460.Data;

   FAT_SQ_R_GAM_460.Close;
end;

function TSM.FAT_DP_R_GAM_470DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
          ' select ' + #13#10 +
          '    nfi.id_fiscal,' + #13#10 +
          '    nfi.id_sequencia,' + #13#10 +
          '    nfi.id_item,' + #13#10 +
          '    ite.id_und_venda,     ' + #13#10 +
          '    nfi.vlr_unitario,    ' + #13#10 +
          '    nfi.qtde,' + #13#10 +
          '    0 as qtde_canc,' + #13#10 +
          '    nfi.vlr_desconto,' + #13#10 +
          '    nfi.vlr_acrescimo,     ' + #13#10 +
          '    nfi.vlr_liquido,' + #13#10 +
          '    nfi.id_st_icm,' + #13#10 +
          '    nfi.id_cfo,' + #13#10 +
          '    nfi.icm_n_aliquota aliq_icms, ' + #13#10 +
          '    nfi.pis_valor ,' + #13#10 +
          '    nfi.cof_valor' + #13#10 +
          ' from fat_tb_m_nfe_ite nfi' + #13#10 +
          ' left outer join fat_tb_m_nfe nfe on ' + #13#10 +
          '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
          ' left outer join cad_tb_c_ite ite on ' + #13#10 +
          '     (ite.id_item = nfi.id_item)';
  end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 27/08/2015; }

  {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_470.Close;

   FAT_SQ_R_GAM_470.CommandText := enSqlFatRelGam +
       ' where nfe.id_fiscal   in (' + VarToStr(Input[0]) +') ' +
       ' order by nfi.id_fiscal ';

   Result := FAT_DP_R_GAM_470.Data;

   FAT_SQ_R_GAM_470.Close;
end;

function TSM.FAT_DP_R_GAM_481DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
             { '  select' + #13#10 +
              '    nfi.id_fiscal, nfi.id_item,   nfi.id_st_pis, ' + #13#10 +
              '    nfi.id_cfo, ' + #13#10 +
              '    nfi.pis_aliquota as aliq_pis,' + #13#10 +
              '    0 as quant_bc_pis, ' + #13#10 +
              '    0 as aliq_pis_quant,' + #13#10 +
              '    COALESCE(sum(nfi.vlr_liquido),0) as vlr_liquido,' + #13#10 +
              '    COALESCE(sum(nfi.pis_base),0) as vlr_pis_base,' + #13#10 +
              '    COALESCE(sum(nfi.pis_valor),0) as vlr_pis,' + #13#10 +
              '    ''1234'' as cod_cta' + #13#10 +
              '  from fat_tb_m_nfe_ite nfi '; }

             ' SELECT NFI.id_item, NFI.id_st_pis, NFI.id_cfo ,NFI.pis_aliquota, '+
             ' Sum( coalesce(nfi.qtde,0) * coalesce(nfi.vlr_unitario,0) ) vlr_item, '+
             ' Sum( coalesce(nfi.pis_valor,0)) vlr_pis, '+
             ' Sum( coalesce(nfi.pis_base,0)) vlr_pis_base '+
             ' FROM fat_tb_m_nfe_ite NFI ';


  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 19/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_481.Close;
   FAT_SQ_R_GAM_481.CommandText := enSqlFatRelGam +
      ' LEFT OUTER JOIN cad_tb_c_ite P ON P.id_item = NFI.id_item '+
      ' LEFT OUTER JOIN fat_tb_m_nfe NFE ON NFE.id_fiscal =NFI.id_fiscal and NFE.id_empresa in ('+VarToStr(Input[0])+') '+
      '  WHERE (NFE.tipo_nf IN (''E'',''S'',''R'',''D'')) AND (NFE.status IN (''1'',''0'')) AND  NFE.modelo=''2D'' '+
      ' and NFE.dta_emissao = '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+''' '+
      ' group by NFI.id_item, NFI.id_st_pis, NFI.id_cfo, NFI.pis_aliquota ';

      { ' where nfi.id_fiscal   = ''' + VarToStr(Input[0]) +''' '+
       '  group by nfi.id_fiscal, nfi.id_item, ' + #13#10 +
       '           nfi.id_st_pis,  nfi.id_cfo, nfi.pis_aliquota ' +
       '  order by nfi.id_fiscal, nfi.id_item, ' + #13#10 +
       '           nfi.id_st_pis,  nfi.id_cfo, nfi.pis_aliquota ';}
   Result := FAT_DP_R_GAM_481.Data;
   FAT_SQ_R_GAM_481.Close;
end;

function TSM.FAT_DP_R_GAM_485DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
             { ' select' + #13#10 +
              '    nfi.id_fiscal, nfi.id_item,   nfi.id_st_cof, ' + #13#10 +
              '    nfi.id_cfo, ' + #13#10 +
              '    nfi.cof_aliquota as aliq_cof,' + #13#10 +
              '    0 as quant_bc_cof, ' + #13#10 +
              '    0 as aliq_cof_quant,' + #13#10 +
              '    COALESCE(sum(nfi.vlr_liquido),0) as vlr_liquido,' + #13#10 +
              '    COALESCE(sum(nfi.cof_base),0) as vlr_cof_base,' + #13#10 +
              '    COALESCE(sum(nfi.cof_valor),0) as vlr_cof,' + #13#10 +
              '    ''1234'' as cod_cta' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi ';}

              ' SELECT NFI.id_item, NFI.id_st_cof, NFI.id_cfo ,NFI.cof_aliquota, '+
              ' Sum( coalesce(nfi.qtde,0) * coalesce(nfi.vlr_unitario,0) ) vlr_item, '+
              ' Sum( coalesce(nfi.cof_valor,0)) vlr_cofins, '+
              ' Sum( coalesce(nfi.cof_base,0)) vlr_cof_base '+
              ' FROM fat_tb_m_nfe_ite NFI ';
  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 19/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_485.Close;
   FAT_SQ_R_GAM_485.CommandText := enSqlFatRelGam +
       {' where nfi.id_fiscal   = ''' + VarToStr(Input[0]) +''' '+
       ' group by  nfi.id_fiscal, nfi.id_item, ' + #13#10 +
       '           nfi.id_st_cof,  nfi.id_cfo, nfi.cof_aliquota ' +
       ' order by  nfi.id_fiscal, nfi.id_item, ' + #13#10 +
       '           nfi.id_st_cof,  nfi.id_cfo, nfi.cof_aliquota ';}

       ' LEFT OUTER JOIN cad_tb_c_ite P ON P.id_item = NFI.id_item '+
       ' LEFT OUTER JOIN fat_tb_m_nfe NFE ON NFE.id_fiscal =NFI.id_fiscal and NFE.id_empresa in ('+VarToStr(Input[0])+') '+
       '  WHERE (NFE.tipo_nf IN (''E'',''S'',''R'',''D'')) AND (NFE.status IN (''1'',''0'')) AND  NFE.modelo=''2D'' '+
       ' and NFE.dta_emissao='''+ FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+''' '+
       ' group by NFI.id_item, NFI.id_st_cof, NFI.id_cfo, NFI.cof_aliquota ';
   Result := FAT_DP_R_GAM_485.Data;
   FAT_SQ_R_GAM_485.Close;

end;

function TSM.FAT_DP_R_GAM_490DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select nfi.id_st_icm, nfi.id_cfo, nfi.icm_n_aliquota,                          ' +
              '       sum(nfi.vlr_liquido) vlr_operacao,                           ' +
              '       sum(coalesce(nfi.icm_n_base,0)) vlr_base_icm,                ' +
              '       sum(coalesce(nfi.icm_n_valor,0)) vlr_icm                     ' +
              ' from fat_tb_m_nfe_ite nfi                                          ' +
              '                                                                    ' +
              ' left outer join  fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal ' +
              ' left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item     ';
    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 21/08/2015; }

  {
    input[0]  - Serial
    input[1]  - Data emissao
  }
   //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
  FAT_SQ_R_GAM_490.Close;

  FAT_SQ_R_GAM_490.CommandText := enSqlFatRelGam +
      ' where  nfe.tipo_nf = ''S'' and                                       ' +
      '        nfe.ecf_serial_impressora = ''' + VarToStr(Input[0]) +'''  and ' + #13#10 +
      '        nfe.status    = 1 and                                        ' +
     // '        nfe.nfe_cod_sit = ''02'' and                                   ' +
      '        nfe.nfe_ecf=1 and                                            ' +
      '        nfe.serie <> ''X'' and '+
    //  '        ((nfi.id_st_icm <> ''60'') and (nfi.id_st_icm<>''500'') ) and    ' +
      '        nfe.dta_emissao = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
      ' group by 1,2,3 ';
  Result := FAT_DP_R_GAM_490.Data;
  FAT_SQ_R_GAM_490.Close;
end;

function TSM.FAT_DP_R_GAM_500DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select' + #13#10 +
              '   nfe.id_fiscal,nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente               as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj                   as cpf_cnpj,' + #13#10  +
              '   nfe.id_emitente                as cod_participantes, ' + #13#10 +
              '   nfe.modelo,                    ' + #13#10 +
              '   nfe.nfe_cod_sit                as cod_sit,' + #13#10   +
              '   nfe.serie, nfe.sub_serie, nfe.numero, nfe.nfe_chave,'  + #13#10 +
              '   ''''  as cod_cons, '  + #13#10 +
              '   nfe.dta_emissao, nfe.dta_documento,' + #13#10 +
              '   nfe.vlr_mercadoria as vlr_doc,' + #13#10 +
              '   nfe.vlr_desconto, ' + #13#10 +
              '   0 as vlr_forn, '    + #13#10 +
              '   0 as vlr_serv_nt, ' + #13#10 +
              '   0 as vlr_terc, '    + #13#10 +
              '   0 as vlr_da, '      + #13#10 +
              '   nfe.icm_n_base as vlr_base_icms, ' + #13#10 +
              '   nfe.icm_n_valor as vlr_icms,' + #13#10 +
              '   nfe.icm_s_base as vlr_base_icms_subst, ' + #13#10 +
              '   nfe.icm_s_valor as vlr_icms_subst, ' + #13#10 +
              '   '''' as cod_inf, '    + #13#10 +
              '   nfe.ipi_valor as vlr_ipi,' + #13#10 +
              '   nfe.pis_valor as vlr_pis,' + #13#10 +
              '   nfe.cof_valor as vlr_cof,' + #13#10 +
              '   '''' as tp_ligacao, ' + #13#10 +
              '   '''' as cod_grupo_tencao ' + #13#10 +
              ' from  fat_tb_m_nfe nfe' + #13#10 +
              ' left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '   (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg ON   ' + #13#10 +
              '   (cpg.id_condicao_pag = nfe.id_condicao_pag) ' + #13#10 +
              ' where nfe.status = 1 and nfe.modelo in (''06'',''28'',''29'') ' + #13#10 +
              ' and nfe.serie <> ''X'' ';
  end;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
     //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_500.Close;

   FAT_SQ_R_GAM_500.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.dta_documento ';

   Result := FAT_DP_R_GAM_500.Data;

   FAT_SQ_R_GAM_500.Close;
end;

function TSM.FAT_DP_R_GAM_501DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
                ' select' + #13#10 +
                '    nfi.id_fiscal,  nfi.id_st_pis, '      + #13#10 +
                '    nfi.id_cfo, '                         + #13#10 +
                '    nfi.pis_aliquota   as aliq_pis,'      + #13#10 +
                '    sum(nfi.vlr_liquido) as vlr_liquido,' + #13#10 +
                '    sum(nfi.pis_base)  as vlr_base_pis,'  + #13#10 +
                '    sum(nfi.pis_valor) as vlr_pis,'       + #13#10 +
                '    0 as nat_bc_cred, ' + #13#10 +
                '   '''' as cod_cta ' + #13#10 +
                ' from fat_tb_m_nfe_ite nfi ';

  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 21/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_501.Close;
   FAT_SQ_R_GAM_501.CommandText := enSqlFatRelGam +
       ' where nfi.id_fiscal  = ''' + VarToStr(Input[0]) +''' '+
       ' group by nfi.id_fiscal,  nfi.id_st_pis,  nfi.id_cfo, nfi.pis_aliquota ' +
       ' order by nfi.id_fiscal,  nfi.id_st_pis,  nfi.id_cfo, nfi.pis_aliquota ' ;
   Result := FAT_DP_R_GAM_501.Data;
   FAT_SQ_R_GAM_501.Close;
end;

function TSM.FAT_DP_R_GAM_505DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
                ' select' + #13#10 +
                '    nfi.id_fiscal,  nfi.id_st_cof, ' + #13#10 +
                '    nfi.id_cfo, '                    + #13#10 +
                '    nfi.cof_aliquota as aliq_cof,'   + #13#10 +
                '    sum(nfi.vlr_liquido) as vlr_liquido,' + #13#10 +
                '    sum(nfi.cof_base) as vlr_base_cof,' + #13#10 +
                '    sum(nfi.cof_valor) as vlr_cof,'     + #13#10 +
                '    0 as nat_bc_cred, ' + #13#10 +
                '    '''' as cod_cta'                    + #13#10 +
                ' from fat_tb_m_nfe_ite nfi '            ;



  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 21/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_505.Close;
   FAT_SQ_R_GAM_505.CommandText := enSqlFatRelGam +
       ' where nfi.id_fiscal  = ''' + VarToStr(Input[0]) +''' '+
       ' group by  nfi.id_fiscal,  nfi.id_st_cof,  nfi.id_cfo, nfi.cof_aliquota';
   Result := FAT_DP_R_GAM_505.Data;
   FAT_SQ_R_GAM_505.Close;
end;

function TSM.FAT_DP_R_GAM_510DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              '  select ' + #13#10 +
              '    nfi.id_fiscal,' + #13#10 +
              '    nfi.id_sequencia,' + #13#10 +
              '    nfi.id_item,' + #13#10 +
              '    ''2207'' as cod_class,' + #13#10 +
              '    ite.id_und_venda,     ' + #13#10 +
              '    nfi.vlr_unitario, ' + #13#10 +
              '    nfi.qtde,' + #13#10 +
              '    nfi.vlr_desconto,' + #13#10 +
              '    nfi.id_st_icm,' + #13#10 +
              '    nfi.id_cfo,' + #13#10 +
              '    nfi.icm_n_base,' + #13#10 +
              '    nfi.icm_n_aliquota AS aliq_icms, ' + #13#10 +
              '    nfi.icm_s_base,' + #13#10 +
              '    nfi.icm_s_valor,' + #13#10 +
              '    0 as ind_rec,' + #13#10 +
              '    '''' as cod_part,' + #13#10 +
              '    nfi.pis_valor,' + #13#10 +
              '    nfi.cof_valor,' + #13#10 +
              '    18 as cod_cta' + #13#10 +
              'from fat_tb_m_nfe_ite nfi' + #13#10 +
              'left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              'left outer join cad_tb_c_ite ite on ' + #13#10 +
              '     (ite.id_item = nfi.id_item)' + #13#10 +
              'where nfe.status = 1 ' + #13#10 +
              ' and nfe.serie <> ''X'' ';
  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - IdFiscal

   }

   FAT_SQ_R_GAM_510.Close;

   FAT_SQ_R_GAM_510.CommandText := enSqlFatRelGam +
       ' and nfe.id_fiscal =  ''' + VarToStr(Input[0]) +''' ' +
       ' order by nfe.dta_emissao ';

   Result := FAT_DP_R_GAM_510.Data;
   FAT_SQ_R_GAM_510.Close;
end;

function TSM.FAT_DP_R_GAM_590DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select   ' +
              '  nfi.id_fiscal,   nfi.id_cfo, nfi.icm_n_aliquota as aliq_icms, ' +
              '  coalesce(sum(nfi.vlr_liquido),0) as vlr_operacao,        ' +
              '  COALESCE(sum(nfi.icm_n_base),0) as vlr_base_icms,             ' +
              '  COALESCE(sum(nfi.icm_n_valor),0) as vlr_icms,                 ' +
              '  COALESCE(sum(nfi.icm_s_base),0) as vlr_base_icms_subst,       ' +
              '  COALESCE(sum(nfi.icm_s_valor),0) as vlr_icms_subst,           ' +
              '  sum(nfi.qtde*coalesce(nfi.vlr_unitario,0))-                   ' +
              '  sum(coalesce(nfi.icm_n_valor,0)) as vlr_base_reduzida,        ' +
              '  ''09'' as cod_obs                                             ' +
              '  from fat_tb_m_nfe_ite nfi                                     ' +
              '  left outer join fat_tb_m_nfe nfe on                           ' +
              '  (nfe.id_fiscal = nfi.id_fiscal)                               ';


  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_590.Close;
   FAT_SQ_R_GAM_590.CommandText := enSqlFatRelGam +
       ' where nfe.id_fiscal   = ''' + VarToStr(Input[0]) +''' '+
       ' group by 1,2,3 ';
   Result := FAT_DP_R_GAM_590.Data;
   FAT_SQ_R_GAM_590.Close;
end;

function TSM.FAT_DP_R_GAM_600DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
        ' SELECT cd.n_cupom, cd.serial_impressora, cm.data_movimento, replace(replace(cm.cpf_cnpj,''.'',''''),''-'','''') AS cpf_cnpj ,cm.n_caixa, '+
        '  case cm.cancelado  '+
        '          when ''S'' then ''90'' '+
        '          when ''N'' then ''00'' '+
        '  end situacao, '+
        '  (select valor from br_itens_rz brr '+
        '          where                      '+
        '                  brr.serial = cd.serial_impressora '+
        '      and brr.sigla = ''CRO''                       '+
        '      and brr.data_movimento =                      '+
        '                          (select max(brz.data_movimento) from br_itens_rz brz '+
        '                                  where brz.serial = cd.serial_impressora      '+
        '                                          and brz.sigla = ''CRO'')) AS CRO,      '+

        '  (select valor from br_itens_rz brr                                            '+
        '          where                                                                 '+
        '                  brr.serial = cd.serial_impressora                             '+
        '      and brr.sigla = ''CRZ''                                                   '+
        '      and brr.data_movimento =                                                  '+
        '        (select max(brz.data_movimento) from br_itens_rz brz                    '+
        '          where brz.serial = cd.serial_impressora                               '+
        '            and brz.sigla = ''CRZ'')) AS CRZ,                                   '+

        '  (select distinct na.id_classe                                                 '+
        '    FROM br_cupom_detalhe Cx                                                    '+
        '    left outer join cad_tb_c_cfo cf on replace(CF.id_cfo,''.'','''')= cast(cx.cfop as varchar(5)) '+
        '    left outer join cad_tb_c_nat na on na.id_classe = cf.id_classe                            '+
        '    where cx.n_cupom=cd.n_cupom and cx.serial_impressora = cd.serial_impressora ) as classe,  '+

        '  Sum(cd.valor_total) Vlr_total,                                                              '+
        '  Sum(cd.desconto) Vlr_desconto,                                                              '+
        '  Sum(case when cm.cancelado=''S''  then cd.valor_total end) vlr_cancelado,                     '+
        '  Sum(case when (not cd.aliquota in (''F1'',''II'')) and (not cd.cst_icms in (''40'',''41'',''90''))  then cd.valor_total end) base_icms, '+
        '  Sum(case when (not cd.aliquota in (''F1'',''II'')) and (not cd.cst_icms in (''40'',''41'',''90''))  then (cd.valor_total * CAST(replace(replace(cd.aliquota,''.'',''''),'','',''.'')  AS NUMERIC(18,2) )  )/100 end) Vlr_icms,  '+
        '  Sum(case when cd.aliquota = ''F1''  then cd.valor_total end) base_icms_sub,  '+
        '  Sum(case when cd.aliquota = ''0,00'' then cd.valor_total end) VLR_ISENTO     '+
        '  FROM br_cupom_detalhe Cd  '+
        '  left outer join br_cupom_mestre cm on cm.serial_impressora=cd.serial_impressora and cm.n_cupom=cd.n_cupom  '+
        '  left outer join cad_tb_c_par par on trim(par.emp_cnpj)=trim(replace(replace(replace(cm.cnpj_empresa,''.'',''''),''/'',''''),''-'','''')) ';



    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 14/07/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
   //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_600.Close;

   FAT_SQ_R_GAM_600.CommandText := enSqlFatRelGam +
        ' Where cm.data_movimento>= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) )+''' and '+
        ' cm.data_movimento<= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+''' and '+
        ' par.id_empresa in  ('+VarToStr(Input[2])+') '+
        ' group by 1,2,3,4,5,6,7 ';
   Result := FAT_DP_R_GAM_600.Data;

   FAT_SQ_R_GAM_600.Close;
end;

function TSM.FAT_DP_R_GAM_610DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
        ' SELECT CD.N_CUPOM,CD.n_item, cd.cod_produto, cd.unidade,  '+
        '  cd.valor_unitario, cd.qtde, cd.desconto,                 '+
        '  cd.valor_total, cd.cst_icms, cd.cfop, cd.aliquota ,      '+
        '  case when (not cd.aliquota in (''F1'',''II'')) and (not cd.cst_icms in (''40'',''41'',''90'')) then cd.valor_total end base_icms, '+
        '  case when (not cd.aliquota in (''F1'',''II'')) and (not cd.cst_icms in (''40'',''41'',''90'')) then (cd.valor_total * CAST(replace(replace(cd.aliquota,''.'',''''),'','',''.'') AS NUMERIC(18,2) )  )/100 end Vlr_icms, '+
        '  case when cd.aliquota = ''F1''  then cd.valor_total end base_icms_sub, '+
        '  case when cd.aliquota = ''0,00'' then cd.valor_total end VLR_ISENTO  '+
        '  FROM br_cupom_detalhe Cd '+
        '  left outer join br_cupom_mestre cm on cm.serial_impressora=cd.serial_impressora and cm.n_cupom=cd.n_cupom ';
    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 14/07/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_610.Close;

   FAT_SQ_R_GAM_610.CommandText := enSqlFatRelGam +
       ' where  CD.N_CUPOM='''+VarToStr(Input[0])+''' and cd.SERIAL_IMPRESSORA='''+VarToStr(Input[1])+''' '+
       ' and (cm.data_movimento>= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )+''' and '+
                  '       cm.data_movimento<= '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) )+''' )';

   Result := FAT_DP_R_GAM_610.Data;

   FAT_SQ_R_GAM_610.Close;
end;

function TSM.FAT_DP_R_GAM_700DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=

             ' SELECT NFI.id_item, NFI.id_st_pis, NFI.id_cfo ,NFI.pis_aliquota, '+
             '      P.id_ncm,  ' + #13#10 +
             '      P.descricao,    ' + #13#10 +
             '      P.id_und_compra,' + #13#10 +
             '      P.cod_barra,    ' + #13#10 +
             '      gru.tipo_item,    ' + #13#10 +
             '      '''' as ex_ipi,   ' + #13#10 +
             '      '''' as cod_gen,  ' + #13#10 +
             '      gru.ali_interna_icms as aliq_icms, ' + #13#10 +
             ' Sum( coalesce(nfi.qtde,0) * coalesce(nfi.vlr_unitario,0) ) vlr_item, '+
             ' Sum( coalesce(nfi.pis_valor,0)) vlr_pis, '+
             ' Sum( coalesce(nfi.pis_base,0)) vlr_pis_base '+
             ' FROM fat_tb_m_nfe_ite NFI ';


  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 19/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_700.Close;
   FAT_SQ_R_GAM_700.CommandText := enSqlFatRelGam +
      ' LEFT OUTER JOIN cad_tb_c_ite P ON P.id_item = NFI.id_item '+
      ' left outer join cad_tb_c_gru gru on (gru.id_grupo = P.id_grupo) '  +
      ' LEFT OUTER JOIN fat_tb_m_nfe NFE ON NFE.id_fiscal =NFI.id_fiscal and NFE.id_empresa in ('+VarToStr(Input[0])+') '+
      '  WHERE (NFE.tipo_nf IN (''E'',''S'',''R'',''D'')) AND (NFE.status IN (''1'',''0'')) AND  NFE.modelo=''2D'' '+
      ' and NFE.DTA_DOCUMENTO = '''+FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )+''' '+
      ' group by NFI.id_item, NFI.id_st_pis, NFI.id_cfo, NFI.pis_aliquota, P.id_ncm, P.descricao, '+
      '     P.id_und_compra, P.cod_barra, gru.tipo_item,ex_ipi,cod_gen,aliq_icms ';


   Result := FAT_DP_R_GAM_700.Data;
   FAT_SQ_R_GAM_700.Close;

end;

function TSM.FAT_DP_R_GAM_710DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
           ' select * from fat_tb_m_nfe nfe '+
           '  where  nfe.tipo_nf =  ''S'' and trim(nfe.nfe_chave)='''' and nfe.modelo=''55'' ';


  end;
begin

   FAT_SQ_R_GAM_710.Close;
   FAT_SQ_R_GAM_710.CommandText := enSqlFatRelGam +

       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ';


   Result := FAT_DP_R_GAM_710.Data;
   FAT_SQ_R_GAM_710.Close;
end;

function TSM.FAT_DP_R_GAM_A_100DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              'select ' + #13#10 +
              '   nfe.id_fiscal,' + #13#10 +
              '   nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj     as cpf_cnpj,' + #13#10 +
              '   nfe.nfe_cod_sit  as cod_sit,   ' + #13#10 +
              '   nfe.id_emitente  as cod_participantes,    ' + #13#10 +
              '   nfe.serie, nfe.sub_serie, nfe.numero, ' + #13#10 +
              '   nfe.nfe_chave,' + #13#10 +
              '   nfe.modelo,' + #13#10 +
              '   nfe.dta_emissao, ' + #13#10 +
              '   nfe.dta_documento,' + #13#10 +
              '   nfe.vlr_liquido as vlr_doc,   ' + #13#10 +
              '   case cpg.tipo_pagamento' + #13#10 +
              '     when 2 then 9' + #13#10 +
              '   else cpg.tipo_pagamento end as int_tipopgto,' + #13#10 +
              '   nfe.vlr_desconto,' + #13#10 +
              '   nfe.pis_base, ' + #13#10 +
              '   nfe.pis_valor as vlr_pis,' + #13#10 +
              '   nfe.cof_base,   ' + #13#10 +
              '   nfe.cof_valor as vlr_cof,' + #13#10 +
              '   0 as vlr_pis_ret,' + #13#10 +
              '   0 as vlr_cof_ret,' + #13#10 +
              '   iss_valor as vlr_iss' + #13#10 +
              ' from  fat_tb_m_nfe nfe' + #13#10 +
              ' ' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg ON' + #13#10 +
              '   (cpg.id_condicao_pag = nfe.id_condicao_pag)' + #13#10 +
              ' where nfe.status = 1 ' + #13#10 +
              '   and nfe.ind_nf = 2 ' + #13#10 +
              ' and nfe.serie <> ''X'' ';
  end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 18/08/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_A_100.Close;

   FAT_SQ_R_GAM_A_100.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.id_fiscal ';

   Result := FAT_DP_R_GAM_A_100.Data;

   FAT_SQ_R_GAM_A_100.Close;
end;

function TSM.FAT_DP_R_GAM_A_170DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select ' + #13#10 +
              '    nfi.id_fiscal,' + #13#10 +
              '    nfi.id_sequencia,' + #13#10 +
              '    nfi.id_item,' + #13#10 +
              '    ite.descricao as desc_item,' + #13#10 +
              '    nfi.vlr_liquido,' + #13#10 +
              '    nfi.vlr_desconto,' + #13#10 +
              '    0 as nat_bc_cred,' + #13#10 +
              '    0 as ind_orig_cred,' + #13#10 +
              '    nfi.id_st_pis,' + #13#10 +
              '    nfi.pis_base,' + #13#10 +
              '    nfi.pis_valor,' + #13#10 +
              '    nfi.pis_aliquota,' + #13#10 +
              '    nfi.id_st_cof,' + #13#10 +
              '    nfi.cof_base,' + #13#10 +
              '    nfi.cof_valor,' + #13#10 +
              '    nfi.cof_aliquota,' + #13#10 +
              '    cfo.cod_cta,' + #13#10 +
              '    ''01'' as cod_ccus, ' + #13#10 +
              '    gru.cod_ntr as nat_rec ' +
              'from fat_tb_m_nfe_ite nfi' + #13#10 +
              'left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              'left outer join cad_tb_c_ite ite on ' + #13#10 +
              '     (ite.id_item = nfi.id_item) ' +
              'left outer join cad_tb_c_gru gru on   ' + #13#10 +
              '     (gru.id_grupo = ite.id_grupo)         ' + #13#10 +
              'left outer join cad_tb_c_cfo cfo on ' + #13#10 +
              '     (cfo.id_cfo = nfi.id_cfo) ';

    end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 19/08/2015; }

  {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_A_170.Close;

   FAT_SQ_R_GAM_A_170.CommandText := enSqlFatRelGam +
        ' where nfe.id_fiscal  = ''' + VarToStr(Input[0]) +''' ' +
        ' order by nfi.id_item ';
   Result := FAT_DP_R_GAM_A_170.Data;
   FAT_SQ_R_GAM_A_170.Close;
end;

function TSM.FAT_DP_R_GAM_C20DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              'select' + #13#10 +
              '   nfe.id_fiscal,' + #13#10 +
              '   nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj     as cpf_cnpj, ' + #13#10 +
              '   nfe.id_emitente   as cod_participantes, ' + #13#10 +
              '   nfe.modelo,       ' + #13#10 +
              '   nfe.nfe_cod_sit  as situacao_lancto,' + #13#10 +
              '   nfe.serie, ' + #13#10 +
              '   nfe.numero, ' + #13#10 +
              '   nfe.nfe_chave,' + #13#10 +
              '   nfe.dta_emissao, ' + #13#10 +
              '   nfe.dta_documento,' + #13#10 +
              '   cfo.id_cfo, ' + #13#10 +
              '   cpg.tipo_pagamento as ind_pagamento,' + #13#10 +
              '   nfe.vlr_liquido as vlr_contabil,' + #13#10 +
              '   nfe.vlr_desconto,    ' + #13#10 +
              '   nfe.vlr_acrescimo,' + #13#10 +
              '   nfe.vlr_mercadoria,    ' + #13#10 +
              '   nfe.fre_valor,    ' + #13#10 +
              '   nfe.vlr_seguro,' + #13#10 +
              '   nfe.vlr_outras, ' + #13#10 +
              '   0 as vlr_op_iss,   ' + #13#10 +
              '   nfe.icm_n_base as vlr_base_icms, ' + #13#10 +
              '   nfe.icm_n_valor as vlr_icms,' + #13#10 +
              '   nfe.icm_s_base as vlr_base_icms_subst,    ' + #13#10 +
              '   nfe.icm_s_valor as vlr_icms_subst, ' + #13#10 +
              '   0 as vlr_at,' + #13#10 +
              '   nfe.ipi_valor as vlr_ipi,  ' + #13#10 +
              '   nfe.ind_frete, ' + #13#10 +
              '   0 as  vlr_aba_nt, ' + #13#10 +
              '   nfe.pis_valor, ' + #13#10 +
              '   nfe.pis_valor_st, ' + #13#10 +
              '   nfe.cof_valor, ' + #13#10 +
              '   nfe.cof_valor_st ' + #13#10 +
              'from  fat_tb_m_nfe nfe' + #13#10 +
              'left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '   (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              'left outer join cad_tb_c_cpg cpg ON   ' + #13#10 +
              '   (cpg.id_condicao_pag = nfe.id_condicao_pag) ' + #13#10 +
              'where nfe.status = 1' + #13#10 +
              ' and nfe.modelo in (''01'',''04'',''1B'',''55'') ' + #13#10 +
              ' and nfe.serie <> ''X'' ' + #13#10 +
              ' ';
  end;
begin

  { TODO -oMaxsuel -cCriao : Criado em 14/07/2015; }

  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
   //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_C20.Close;

   FAT_SQ_R_GAM_C20.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
      // ' order by nfe.id_fiscal ';
        ' order by nfe.numero ';
   Result := FAT_DP_R_GAM_C20.Data;

   FAT_SQ_R_GAM_C20.Close;
end;

function TSM.FAT_DP_R_GAM_D_100DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select ' + #13#10 +
              '   NFE.ID_FISCAL,NFE.IND_OPERACAO AS IND_OPERACAO,' + #13#10 +
              '   NFE.IND_EMITENTE               AS IND_EMITENTE,' + #13#10 +
              '   NFE.CPF_CNPJ                   AS CPF_CNPJ,' + #13#10 +
              '   NFE.ID_EMITENTE                AS COD_PARTICIPANTES,' + #13#10 +
              '   NFE.MODELO,' + #13#10 +
              '   NFE.NFE_COD_SIT                AS COD_SIT,' + #13#10 +
              '   NFE.SERIE, NFE.SUB_SERIE, NFE.NUMERO, NFE.NFE_CHAVE,' + #13#10 +
              '   NFE.DTA_EMISSAO, NFE.DTA_DOCUMENTO,' + #13#10 +
              '   '''' AS TP_CT_e,' + #13#10 +
              '   NFE.VLR_LIQUIDO AS VLR_DOC,' + #13#10 +
              '   NFE.VLR_DESCONTO,' + #13#10 +
              '   NFE.IND_FRETE ,' + #13#10 +
              '   NFE.VLR_MERCADORIA AS VLR_SERV,' + #13#10 +
              '   NFE.ICM_N_BASE AS VLR_BASE_ICMS,' + #13#10 +
              '   NFE.ICM_N_VALOR AS VLR_ICMS,' + #13#10 +
              '   0 AS VL_NT,' + #13#10 +
              '   '''' AS COD_INF ,' + #13#10 +
              '   '''' AS COD_CTA, ' + #13#10  +
              '   '''' AS CHV_CTE_REF ' + #13#10  +
              ' FROM  FAT_TB_M_NFE NFE' + #13#10 +
              ' WHERE NFE.STATUS = 1 AND NFE.MODELO IN (''07'',''08'',''8B'',''09'',''10'',''11'',''26'',''27'',''57'') '+ #13#10 +
              ' AND NFE.SERIE <> ''X'' ';
  end;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtro e ordenacao dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_D_100.Close;

   FAT_SQ_R_GAM_D_100.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.dta_documento, nfe.id_fiscal ';

   Result := FAT_DP_R_GAM_D_100.Data;

   FAT_SQ_R_GAM_D_100.Close;
end;

function TSM.FAT_DP_R_GAM_D_190DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGamD190: String;
  begin
    Result :=
              '    select ' + #13#10 +
              '           case ' + #13#10 +
              '              when coalesce(nfe.icm_n_valor,0) > 0 then ' + #13#10 +
              '                  ''00''' + #13#10 +
              '           else ' + #13#10 +
              '              ''41''' + #13#10 +
              '           end as id_st_icm, nfe.id_cfo,  ' + #13#10 +
              '           ' + #13#10 +
              '           case ' + #13#10 +
              '              when coalesce(nfe.icm_n_valor,0) > 0 then ' + #13#10 +
              '                  round( (coalesce(nfe.icm_n_valor,0) * 100) / coalesce(nfe.icm_n_base,0) ,2)' + #13#10 +
              '           else 0 ' + #13#10 +
              '           end as icm_n_aliquota,' + #13#10 +
              '                         sum(coalesce(nfe.vlr_liquido,0)) as vlr_operacao, ' + #13#10 +
              '                         sum(coalesce(nfe.icm_n_base,0))  as vlr_bc_icms, ' + #13#10 +
              '                         sum(coalesce(nfe.icm_n_valor,0)) as vlr_icms, ' + #13#10 +
              '                         sum(coalesce(nfe.icm_s_base,0))  as vlr_base_icms_sub, ' + #13#10 +
              '                         sum(coalesce(nfe.icm_s_valor,0)) as vlr_icms_sub, ' + #13#10 +
              '                         0 as vlr_base_reduzida                         ' + #13#10 +
              '    FROM  fat_tb_m_nfe nfe ' + #13#10 ;
  end;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 22/01/2018 }

   {
    input[0]  - id fiscal
   }

   FAT_SQ_R_GAM_D_190.Close;

   FAT_SQ_R_GAM_D_190.CommandText := enSqlFatRelGamD190 +
       ' where nfe.id_fiscal in (' + VarToStr(Input[0]) +') ' +
       ' group by 1,2,3 ';

   Result := FAT_DP_R_GAM_D_190.Data;

   FAT_SQ_R_GAM_D_190.Close;

end;

function TSM.FAT_DP_R_GAM_D_500DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              'select' + #13#10 +
              '   NFE.ID_FISCAL,NFE.IND_OPERACAO AS IND_OPERACAO,' + #13#10 +
              '   NFE.IND_EMITENTE               AS IND_EMITENTE,' + #13#10 +
              '   NFE.CPF_CNPJ                   AS CPF_CNPJ,' + #13#10 +
              '   NFE.ID_EMITENTE                AS COD_PARTICIPANTES,' + #13#10 +
              '   NFE.MODELO,' + #13#10 +
              '   NFE.NFE_COD_SIT                AS COD_SIT,' + #13#10 +
              '   NFE.SERIE, NFE.SUB_SERIE, NFE.NUMERO, NFE.NFE_CHAVE,' + #13#10 +
              '   NFE.DTA_EMISSAO, NFE.DTA_DOCUMENTO,' + #13#10 +
              '   '''' AS TP_CT_e,' + #13#10 +
              '   NFE.VLR_LIQUIDO AS VLR_DOC,' + #13#10 +
              '   NFE.VLR_DESCONTO,' + #13#10 +
              '   NFE.VLR_MERCADORIA AS VLR_SERV,' + #13#10 +
              '   0 AS VLR_SERV_NT,' + #13#10 +
              '   0 AS VLR_TERC,' + #13#10 +
              '   0 AS VLR_DA,' + #13#10 +
              '   NFE.ICM_N_BASE AS VLR_BASE_ICMS,' + #13#10 +
              '   NFE.ICM_N_VALOR AS VLR_ICMS,' + #13#10 +
              '   '''' AS COD_INF,' + #13#10 +
              '   NFE.PIS_VALOR,' + #13#10 +
              '   NFE.COF_VALOR,' + #13#10 +
              '   '''' AS COD_CTA,' + #13#10 +
              '  '''' AS TP_ASSINANTE' + #13#10 +
              ' FROM  FAT_TB_M_NFE NFE' + #13#10 +
              ' WHERE NFE.STATUS = 1 ' + #13#10 +
              '   AND NFE.MODELO IN (''21'',''22'') '+ #13#10 +
              ' AND NFE.SERIE <> ''X'' ';
  end;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }
    //A pedido de Esau alterei o filtroe e ordenacao dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   FAT_SQ_R_GAM_D_500.Close;

   FAT_SQ_R_GAM_D_500.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.dta_documento, nfe.id_fiscal ';

   Result := FAT_DP_R_GAM_D_500.Data;

   FAT_SQ_R_GAM_D_500.Close;
end;



function TSM.FAT_DP_R_GAM_D_510DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              '  select ' + #13#10 +
              '    nfi.id_fiscal,' + #13#10 +
              '    nfi.id_sequencia,' + #13#10 +
              '    nfi.id_item,' + #13#10 +
              '    ''03'' as cod_class,' + #13#10 +
              '    ite.id_und_venda,     ' + #13#10 +
              '    nfi.vlr_unitario, ' + #13#10 +
              '    nfi.qtde,' + #13#10 +
              '    nfi.vlr_desconto,' + #13#10 +
              '    nfi.id_st_icm,' + #13#10 +
              '    nfi.id_cfo,' + #13#10 +
              '    nfi.icm_n_base,' + #13#10 +
              '    nfi.icm_n_aliquota AS aliq_icms, ' + #13#10 +
              '    nfi.icm_s_base,' + #13#10 +
              '    nfi.icm_s_valor,' + #13#10 +
              '    0 as ind_rec,' + #13#10 +
              '    '''' as cod_part,' + #13#10 +
              '    nfi.pis_valor,' + #13#10 +
              '    nfi.cof_valor,' + #13#10 +
              '    100 as cod_cta' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi' + #13#10 +
              ' left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              ' left outer join cad_tb_c_ite ite on ' + #13#10 +
              '     (ite.id_item = nfi.id_item)' + #13#10 +
              ' where nfe.status = 1' + #13#10 +
              ' and nfe.serie <> ''X''  ';
  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_D_510.Close;

   FAT_SQ_R_GAM_D_510.CommandText := enSqlFatRelGam +
       ' and nfe.id_fiscal  = ''' + VarToStr(Input[0]) +''' ' +
       ' order by nfe.dta_emissao ';
   Result := FAT_DP_R_GAM_D_510.Data;
   FAT_SQ_R_GAM_D_510.Close;
end;

function TSM.FAT_DP_R_GAM_D_590DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select' + #13#10 +
              '    nfi.id_fiscal,   nfi.id_cfo, nfi.icm_n_aliquota as aliq_icms,' + #13#10 +
              '    coalesce(sum(nfi.vlr_liquido),0) as vlr_operacao,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_base),0) as vlr_base_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_valor),0) as vlr_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_s_base),0) as vlr_base_icms_subst,' + #13#10 +
              '    COALESCE(sum(nfi.icm_s_valor),0) as vlr_icms_subst,' + #13#10 +
              '    sum(nfi.qtde*coalesce(nfi.vlr_unitario,0))-' + #13#10 +
              '    sum(coalesce(nfi.icm_n_valor,0)) as vlr_base_reduzida, ' + #13#10 +
              '    ''09'' as cod_obs' + #13#10 +
              'from fat_tb_m_nfe_ite nfi' + #13#10 +
              'left outer join fat_tb_m_nfe nfe on' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal) ';



  end;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 17/08/2015 }

   {
    input[0]  - IdFiscal
   }

   FAT_SQ_R_GAM_D_590.Close;
   FAT_SQ_R_GAM_D_590.CommandText := enSqlFatRelGam +
       ' where nfe.id_fiscal   = ''' + VarToStr(Input[0]) +''' '+
       ' group by 1,2,3 ';
   Result := FAT_DP_R_GAM_D_590.Data;
   FAT_SQ_R_GAM_D_590.Close;
end;

function TSM.FAT_DP_R_GAM_120DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              'select' + #13#10 +
              '   nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj     as cpf_cnpj,' + #13#10 +
              '   frn.id_cidade,' + #13#10 +
              '   nfe.modelo,       ' + #13#10 +
              '   nfe.nfe_cod_sit  as situacao_lancto,' + #13#10 +
              '   nfe.serie, ' + #13#10 +
              '   nfe.sub_serie, ' + #13#10 +
              '   nfe.numero, ' + #13#10 +
              '   nfe.nfe_chave,' + #13#10 +
              '   nfe.dta_emissao,' + #13#10 +
              '   nfe.dta_documento,' + #13#10 +
              '   cfo.id_classe, ' + #13#10 +
              '   '''' as num_lancto_contabil,' + #13#10 +
              '   cpg.tipo_pagamento as ind_pagamento,' + #13#10 +
              '   nfe.vlr_mercadoria as vlr_contabil,' + #13#10 +
              '   nfe.id_cfo,' + #13#10 +
              '   nfe.icm_n_base  as vlr_base_icms,' + #13#10 +
             // '   round(  ((icm_n_valor * 100) / nfe.icm_n_base),2) as alq_icms,                ' + #13#10 +
              '   CAST (CASE coalesce(nfe.icm_n_base,0) '+ #13#10 +
              '   WHEN 0 THEN 0 '+ #13#10 +
              '   ELSE round(((coalesce(icm_n_valor,0) * 100) / nfe.icm_n_base),2) END AS NUMERIC(18,2)) AS alq_icms, '+ #13#10 +
              '   nfe.icm_n_valor as vlr_icms,' + #13#10 +
              '   nfe.icm_s_valor as vlr_icms_subst,    ' + #13#10 +
              '   nfe.vlr_isenta,' + #13#10 +
              '   nfe.vlr_outras,' + #13#10 +
              '   '''' as cod_observacao  ' + #13#10 +
              'from  fat_tb_m_nfe nfe' + #13#10 +
              '  left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '      (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              '  left outer join cad_tb_c_cpg cpg ON   ' + #13#10 +
              '      (cpg.id_condicao_pag = nfe.id_condicao_pag) ' + #13#10 +
              '  left outer join cad_tb_c_for frn ON   ' + #13#10 +
              '      (frn.id_fornecedor = nfe.id_emitente)' + #13#10 +
              'where nfe.status = 1' + #13#10 +
              ' and  nfe.modelo in (''07'',''08'',''09'',''10'',''11'',''18'',''26'',''27'',''57'')' + #13#10 +
              ' and  nfe.tipo_nf = ''F''  ' + #13#10 +
              ' and  nfe.serie <> ''X''  ';
    end;
begin
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_120.Close;

   FAT_SQ_R_GAM_120.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' order by nfe.dta_documento ';

   Result := FAT_DP_R_GAM_120.Data;

   FAT_SQ_R_GAM_120.Close;
end;

function TSM.FAT_DP_R_GAM_E20DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select' + #13#10 +
              '   nfe.id_fiscal,nfe.ind_operacao as ind_operacao,' + #13#10 +
              '   nfe.ind_emitente as ind_emitente,' + #13#10 +
              '   nfe.cpf_cnpj     as cpf_cnpj,' + #13#10 +
              '   nfe.id_emitente   as cod_participantes, ' + #13#10 +
              '   nfe.modelo,       ' + #13#10 +
              '   nfe.nfe_cod_sit  as situacao_lancto,' + #13#10 +
              '   nfe.serie, nfe.numero, nfe.nfe_chave,' + #13#10 +
              '   nfe.dta_emissao, nfe.dta_documento,' + #13#10 +
              '   cfo.id_classe as cod_natureza, cfo.id_classe as cod_cla_oper,' + #13#10 +
              '   10 as num_lancto_contabil,' + #13#10 +
              '   cpg.tipo_pagamento as ind_pagamento,' + #13#10 +
              '   nfe.vlr_liquido as vlr_contabil,' + #13#10 +
              '   nfe.iss_valor as vlr_iss, nfe.icm_n_base as vlr_base_icms, ' + #13#10 +
              '   nfe.icm_n_valor as vlr_icms,' + #13#10 +
              '   nfe.icm_s_valor as vlr_icms_subst, ' + #13#10 +
              '   0 as vlr_icms_subst_credit, 0 as vlr_icms_subst_saida,' + #13#10 +
              '   0 as vlr_icms_oper_entr, ' + #13#10 +
              '   nfe.vlr_isenta, nfe.vlr_outras, nfe.ipi_valor as vlr_ipi,' + #13#10 +
              '   0 as vlr_outros_ipi ' + #13#10 +
              ' from  fat_tb_m_nfe nfe' + #13#10 +
              ' left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '   (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              ' left outer join cad_tb_c_cpg cpg ON   ' + #13#10 +
              '   (cpg.id_condicao_pag = nfe.id_condicao_pag) ' + #13#10 +
              ' where nfe.status = 1 and nfe.modelo in (''01'',''04'',''55'') '+ #13#10 +
              ' and nfe.serie <> ''X'' ';
  end;
begin
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
   {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_E20.Close;

   FAT_SQ_R_GAM_E20.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
      // ' order by nfe.dta_documento ';
        ' order by nfe.numero ';

   Result := FAT_DP_R_GAM_E20.Data;

   FAT_SQ_R_GAM_E20.Close;

end;

function TSM.FAT_DP_R_GAM_E25DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
              ' select ' + #13#10 +
              '    nfi.id_fiscal,nfi.id_cfo, nfi.icm_n_aliquota as aliq_icms,        ' + #13#10 +
              '    coalesce(sum(nfi.vlr_mercadoria),0) as vlr_mercadoria,' + #13#10 +
              '    COALESCE(sum(nfi.iss_valor),0) as vlr_iss,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_base),0) as vlr_base_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_n_valor),0) as vlr_icms,' + #13#10 +
              '    COALESCE(sum(nfi.icm_s_base),0) as vlr_base_icms_subst,' + #13#10 +
              '    COALESCE(sum(nfi.icm_s_valor),0) as vlr_icms_subst,' + #13#10 +
              '    COALESCE(sum(nfi.vlr_isenta),0) as vlr_isenta,' + #13#10 +
              '    COALESCE(sum(nfi.vlr_outras),0) as vlr_outras,' + #13#10 +
              '    COALESCE(sum(nfi.ipi_base),0) as vlr_ipi_base,' + #13#10 +
              '    coalesce(sum(nfi.vlr_liquido),0) as vlr_contabil,' + #13#10 +
              '    0 as vlr_ipi_isento,' + #13#10 +
              '    0 as vlr_ipi_outros,        ' + #13#10 +
              '    case ' + #13#10 +
              '      when nfi.id_cfo in (''1651'',''1652'',''1653'',''1658'',' + #13#10 +
              '                          ''1659'',''1660'',''1661'',''1662'',' + #13#10 +
              '												  ''1663'',''1664'',''2651'',''2652'', ' + #13#10 +
              '													''2653'',''2658'',''2659'',''2660'',' + #13#10 +
              '													''2661'',''1662'',''1663'') then 1' + #13#10 +
              '    else 0 end as ind_petr,    ' + #13#10 +
              '    ''0'' as ind_imun' + #13#10 +
              '    ' + #13#10 +
              ' from fat_tb_m_nfe_ite nfi' + #13#10 +
              ' left outer join fat_tb_m_nfe nfe on ' + #13#10 +
              '     (nfe.id_fiscal = nfi.id_fiscal)' + #13#10 +
              ' where nfe.status = 1  and nfe.modelo in (''01'',''04'',''55'') ' + #13#10 +
              ' and nfe.serie <> ''X'' ';

  end;
begin
    //A pedido de Esau alterei o filtro dta_emissao para dta_documento.Responsavel:Luan.Data:21/01/2016
  {
    input[0]  - empresa
    input[1]  - Data ini
    input[2]  - Data fin
   }

   FAT_SQ_R_GAM_E25.Close;

   FAT_SQ_R_GAM_E25.CommandText := enSqlFatRelGam +
       ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       ' group by nfi.id_fiscal,nfi.id_cfo, aliq_icms ' +
       ' order by nfi.id_fiscal,nfi.id_cfo, aliq_icms ';

   Result := FAT_DP_R_GAM_E25.Data;

   FAT_SQ_R_GAM_E25.Close;

end;



function TSM.FAT_DP_R_GAM_E60DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
      ' select BIR.data_movimento,r.serial as ECF_FAB,ecf.ecf_caixa as ECF_CX, '+

      ' r.coo_inicial NUM_DOC_INI, r.coo_final NUM_DOC_FIN, '+
      ' (max(case when bir.SIGLA = ''GT''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) else 0 end)- '+
      ' SUM(case when bir.SIGLA = ''VENDABRUTA''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) END))     AS GT_INI, '+
     // ' max(0) AS GT_INI, '+
      ' max(case when bir.SIGLA = ''CRO'' then bir.VALOR else '''' end) CRO, '+
      ' max(case when bir.SIGLA = ''CRZ'' then bir.VALOR else '''' end) CRZ, '+
     // ' max(case when bir.SIGLA = ''CCF'' then bir.VALOR else '''' end) NUM_DOC_FIN, '+
      //' max(0) NUM_DOC_INI, '+
      ' max(case when bir.SIGLA = ''GT'' then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) else 0 end) GT_FIN, '+

      ' sum(0) AS VLR_OP_ISS, '+
      ' SUM(case when bir.SIGLA = ''ICMSCANCEL'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_CANC_ICMS, '+
      ' SUM(case when bir.SIGLA = ''ICMSDESCONTO'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_DESC_ICMS,  '+
      ' SUM(case when bir.SIGLA = ''ICMSACRESCIMO'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_ACMO_ICMS,  '+

      ' SUM(case when bir.SIGLA = ''VENDALIQUIDA'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_LIQ, '+
      ' SUM(case when bir.SIGLA = ''ICMSII'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_ISN,  '+
      ' SUM(case when bir.SIGLA = ''ICMSNN'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_NT, '+
      ' SUM(case when bir.SIGLA = ''ICMSFF'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_ST, '+

      ' SUM(case when bir.SIGLA = ''ICMSAL'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) end) VLR_BC_ICMS, '+
      ' SUM(case when bir.SIGLA = ''ICMSAL'' then  CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) *CAST(replace(replace(bir.aliquota,''.'',''''),'','',''.'') AS NUMERIC(18,2) )/100  end) VLR_ICMS, '+
      ' SUM(case when bir.SIGLA = ''VENDABRUTA''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) END) VLR_BRT '+

      ' from BR_ITENS_RZ bir '+
      ' left outer join br_reducaoz r on r.serial=BIR.serial and r.data_movimento=BIR.data_movimento  '+
      ' left outer join cad_tb_c_ecf ecf on ecf.ecf_serial_impressora = bir.serial  '+
      ' where 1=1 ';
  end;
begin
    { TODO -oLuan -cCriao : Criado em 30/03/2016; }

  {
    input[0]  - Data ini
    input[1]  - Data fin
   }


   FAT_SQ_R_GAM_E60.Close;

   FAT_SQ_R_GAM_E60.CommandText := enSqlFatRelGam +
       ' and bir.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       ' and bir.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' group by 1,2,3,4,5 '+
       ' order by BIR.data_movimento ';

   Result := FAT_DP_R_GAM_E60.Data;

   FAT_SQ_R_GAM_E60.Close;
end;

function TSM.FAT_DP_R_GAM_E65DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' SELECT BCD.CFOP AS ID_CFO, '+
     '   CASE WHEN   BCD.aliquota=''II'' THEN ''0,00'' '+
     '             ELSE BCD.aliquota  END as ALIQ_ICMS, '+
     '          '''' AS IND_IMUN, '+
     '          sum(coalesce(BCD.valor_total,0)) as VRL_BC_ICMS_P '+
     '   FROM br_cupom_detalhe BCD '+
     '   LEFT OUTER JOIN br_cupom_mestre BCM ON BCM.n_cupom=BCD.n_cupom AND BCM.serial_impressora=BCD.serial_impressora  '+
     '   WHERE 1=1 ';
  end;

begin

    { TODO -oLuan -cCriao : Criado em 30/03/2016; }

  {
    input[0]  - Data ini
    input[1]  - Data fin
   }

   FAT_SQ_R_GAM_E65.Close;

   FAT_SQ_R_GAM_E65.CommandText := enSqlFatRelGam +
       ' and bcm.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       ' and bcm.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' group by 1,2,3 ';


   Result := FAT_DP_R_GAM_E65.Data;

   FAT_SQ_R_GAM_E65.Close;
end;

function TSM.FAT_DP_R_GAM_E80DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' SELECT CFO.id_classe, lpad(to_char(EXTRACT(day FROM BCM.data_movimento),''99''),2,''0'') AS NUM_MR, BCM.data_movimento AS DT_DOC, '+
     '          ''0'' AS INT_TOT, '+
     '          '''' AS COD_MOD, '+
     '          '''' AS NUM_LCTO, '+
     '          '''' AS IND_OBS, '+
     '          sum(case when BCD.cancelado= ''N'' then  BCD.qtde*BCD.valor_unitario end) AS VLR_BRUTO, '+
     '          SUM(case when BCD.cancelado= ''S'' then  BCD.qtde*BCD.valor_unitario end) AS VLR_CANCELADO, '+
     '          sum(case when BCD.cancelado= ''N'' then BCD.desconto end) AS VLR_DESCONTO, '+
     '          sum(case when BCD.cancelado= ''N'' and (not BCD.aliquota in (''II'',''F1'') )  then BCD.valor_total end) AS VLR_BC_ICMS, '+
     '          sum(case when BCD.cancelado= ''N'' and (not BCD.aliquota in (''II'',''F1'') )  then (BCD.valor_total* CAST(replace(replace(BCD.aliquota,''.'',''''),'','',''.'') AS NUMERIC(18,2) ))/100 end) AS VLR_ICMS, '+
     '          sum(case when BCD.cancelado= ''N'' then (BCD.valor_total) end) AS VLR_contabil, '+
     '          SUM(case when BCD.cancelado= ''N'' and BCD.aliquota = ''II''      then BCD.valor_total end) AS VLR_isento, '+
     '          SUM(case when BCD.cancelado= ''N'' and BCD.aliquota = ''F1''      then BCD.valor_total end) AS VLR_st, '+
     '          SUM(0) AS VLR_OP_ISS, '+
     '          SUM(0) AS VL_ACMO_ICMS '+
     '   FROM br_cupom_detalhe BCD '+
     '   LEFT OUTER JOIN br_cupom_mestre BCM ON BCM.n_cupom=BCD.n_cupom AND BCM.serial_impressora=BCD.serial_impressora '+
     '   LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CAST(CFO.ID_CFO AS NUMERIC(4,0)) = BCD.CFOP '+
     '   WHERE 1=1 ';
  end;
begin
    { TODO -oLuan -cCriao : Criado em 30/03/2016; }

  {
    input[0]  - Data ini
    input[1]  - Data fin
   }

   FAT_SQ_R_GAM_E80.Close;

   FAT_SQ_R_GAM_E80.CommandText := enSqlFatRelGam +
       ' and bcm.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       ' and bcm.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' group by 1,2,3,4,5,6,7 '+
       ' order by 3 ';

   Result := FAT_DP_R_GAM_E80.Data;

   FAT_SQ_R_GAM_E80.Close;
end;

function TSM.FAT_DP_R_GAM_E85DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' SELECT BCD.cfop, BCD.aliquota, '+
     '          '''' AS IND_IMUN, '+
     '          sum(case when BCD.cancelado= ''N'' then BCD.valor_total end) AS VLR_BRUTO, '+
     '          SUM(case when BCD.cancelado= ''S'' then BCD.valor_total end) AS VLR_CANCELADO, '+
     '          sum(case when BCD.cancelado= ''N'' then BCD.desconto end) AS VLR_DESCONTO, '+
     '          sum(case when BCD.cancelado= ''N'' and (not BCD.aliquota in (''II'',''F1'') )  then BCD.valor_total end) AS VLR_BC_ICMS, '+
     '          sum(case when BCD.cancelado= ''N'' and (not BCD.aliquota in (''II'',''F1'') )  then (BCD.valor_total* CAST(replace(replace(BCD.aliquota,''.'',''''),'','',''.'') AS NUMERIC(18,2) ))/100 end) AS VLR_ICMS, '+
     '          sum(case when BCD.cancelado= ''N'' then (BCD.valor_total-BCD.desconto) end) AS VLR_contabil, '+
     '          SUM(case when BCD.cancelado= ''N'' and BCD.aliquota = ''II''      then BCD.valor_total end) AS VLR_isento, '+
     '          SUM(case when BCD.cancelado= ''N'' and BCD.aliquota = ''F1''      then BCD.valor_total end) AS VLR_st, '+
     '          SUM(0) AS VLR_OP_ISS_P '+

     '   FROM br_cupom_detalhe BCD '+
     '   LEFT OUTER JOIN br_cupom_mestre BCM ON BCM.n_cupom=BCD.n_cupom AND BCM.serial_impressora=BCD.serial_impressora '+
     '   WHERE 1=1 ';
  end;
begin
    { TODO -oLuan -cCriao : Criado em 30/03/2016; }

  {
    input[0]  - Data ini
    input[1]  - Data fin
   }

   FAT_SQ_R_GAM_E85.Close;

   FAT_SQ_R_GAM_E85.CommandText := enSqlFatRelGam +
       ' and bcm.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       ' and bcm.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' group by 1,2,3 '+
       ' order by 1 ';

   Result := FAT_DP_R_GAM_E85.Data;

   FAT_SQ_R_GAM_E85.Close;
end;

function TSM.FAT_DP_R_GAM_E_A_305DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatEA305:String;
  begin
    Result :=
            ' select    ' + #13#10 +
            '   0 as ind_mro,' + #13#10 +
            '   nfe.ind_operacao as ind_ope,   ' + #13#10 +
            '   nfe.dta_emissao as dt_doc,   ' + #13#10 +
            '   cfo.id_classe as cop,       ' + #13#10 +
            '   '''' as  num_lcto,' + #13#10 +
            '   1  as qtd_lcto,          ' + #13#10 +
            '   sum(coalesce(nfi.vlr_mercadoria,0)) as vl_cont,' + #13#10 +
            '   sum(coalesce(nfi.iss_valor,0)) as vlr_op_iss,    ' + #13#10 +
            '   sum(coalesce(nfi.icm_n_base,0))  as vl_bc_icms, ' + #13#10 +
            '   sum(coalesce(nfi.icm_n_valor,0)) as vl_icms,' + #13#10 +
            '   sum(coalesce(nfi.icm_s_valor,0)) as vl_icms_st,' + #13#10 +
            '   '''' as vl_st_ent,' + #13#10 +
            '   '''' as vl_st_fnt,' + #13#10 +
            '   '''' as vl_st_uf,' + #13#10 +
            '   '''' as vl_st_oe,' + #13#10 +
            '   '''' as vl_at,' + #13#10 +
            '   sum(coalesce(nfi.vlr_isenta,0)) as vl_isnt_icms,' + #13#10 +
            '   sum(coalesce(nfi.vlr_outras,0)) as vl_out_icms,      ' + #13#10 +
            '   sum(coalesce(nfi.ipi_base,0)) as vl_bc_ipi,' + #13#10 +
            '   sum(coalesce(nfi.ipi_valor,0)) as vl_ipi,' + #13#10 +
            '   '''' as vl_isnt_ipi,' + #13#10 +
            '   '''' as vl_out_ipi ' + #13#10 +
            '   ' + #13#10 +
            ' from  fat_tb_m_nfe_ite nfi' + #13#10 +
            '  left outer join fat_tb_m_nfe nfe on' + #13#10 +
            '      (nfe.id_fiscal = nfi.id_fiscal) ' + #13#10 +
            '  left outer join cad_tb_c_cfo cfo ON' + #13#10 +
            '      (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
            '  ' + #13#10;

  end;
begin
    FAT_SQ_R_GAM_E_A_305.Close;
    FAT_SQ_R_GAM_E_A_305.CommandText := enSqlFatEA305 +
           ' where nfe.status = 1 ' + #13#10 +
           '  and  nfe.nfe_cod_sit = ''00''  ' + #13#10 +
           '  and  nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
           '  and  nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
           '  and  nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
           '  and  nfe.serie <> ''X''' + #13#10 +
           ' group by 1,2,3,4,5 ' +
           ' order by 1,2,3 ' ;
   Result := FAT_DP_R_GAM_E_A_305.Data;
   FAT_SQ_R_GAM_E_A_305.Close;
end;

function TSM.FAT_DP_R_GAM_E_B_305DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatEB305:String;
  begin
    Result :=
              ' select  ' + #13#10 +
              '   1 as ind_mro,' + #13#10 +
              '   nfe.ind_operacao as ind_ope,   ' + #13#10 +
              '   cfo.id_classe as cop,       ' + #13#10 +
              '   '''' as  num_lcto,' + #13#10 +
              '   1  as qtd_lcto,          ' + #13#10 +
              '   sum(coalesce(nfi.vlr_mercadoria,0)) as vl_cont,' + #13#10 +
              '   sum(coalesce(nfi.iss_valor,0)) as vlr_op_iss,    ' + #13#10 +
              '   sum(coalesce(nfi.icm_n_base,0))  as vl_bc_icms, ' + #13#10 +
              '   sum(coalesce(nfi.icm_n_valor,0)) as vl_icms,' + #13#10 +
              '   sum(coalesce(nfi.icm_s_valor,0)) as vl_icms_st,' + #13#10 +
              '   '''' as vl_st_ent,' + #13#10 +
              '   '''' as vl_st_fnt,' + #13#10 +
              '   '''' as vl_st_uf,' + #13#10 +
              '   '''' as vl_st_oe,' + #13#10 +
              '   '''' as vl_at,' + #13#10 +
              '   sum(coalesce(nfi.vlr_isenta,0)) as vl_isnt_icms,' + #13#10 +
              '   sum(coalesce(nfi.vlr_outras,0)) as vl_out_icms,      ' + #13#10 +
              '   sum(coalesce(nfi.ipi_base,0)) as vl_bc_ipi,' + #13#10 +
              '   sum(coalesce(nfi.ipi_valor,0)) as vl_ipi,' + #13#10 +
              '   '''' as vl_isnt_ipi,' + #13#10 +
              '   '''' as vl_out_ipi ' + #13#10 +
              '   ' + #13#10 +
              ' from  fat_tb_m_nfe_ite nfi' + #13#10 +
              '  left outer join fat_tb_m_nfe nfe on' + #13#10 +
              '      (nfe.id_fiscal = nfi.id_fiscal) ' + #13#10 +
              '  left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '      (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              '  ' + #13#10;

  end;
begin
    FAT_SQ_R_GAM_E_B_305.Close;
    FAT_SQ_R_GAM_E_B_305.CommandText := enSqlFatEB305 +
           ' where nfe.status = 1 ' + #13#10 +
           '  and  nfe.nfe_cod_sit = ''00''  ' + #13#10 +
           '  and  nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
           '  and  nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
           '  and  nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
           '  and  nfe.serie <> ''X''' + #13#10 +
           ' group by 1,2,3,4,5 ' +
           ' order by 1,2,3 ';

   Result := FAT_DP_R_GAM_E_B_305.Data;
   FAT_SQ_R_GAM_E_B_305.Close;

end;

function TSM.FAT_DP_R_GAM_E_C_305DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatEC305:String;
  begin
    Result :=
              ' select  ' + #13#10 +
              '   2 as ind_mro,' + #13#10 +
              '   nfe.ind_operacao as ind_ope,   ' + #13#10 +
              '   nfe.dta_emissao as dt_doc,   ' + #13#10 +
              '   '''' as  num_lcto,' + #13#10 +
              '   1  as qtd_lcto,          ' + #13#10 +
              '   sum(coalesce(nfi.vlr_mercadoria,0)) as vl_cont,' + #13#10 +
              '   sum(coalesce(nfi.iss_valor,0)) as vlr_op_iss,    ' + #13#10 +
              '   sum(coalesce(nfi.icm_n_base,0))  as vl_bc_icms, ' + #13#10 +
              '   sum(coalesce(nfi.icm_n_valor,0)) as vl_icms,' + #13#10 +
              '   sum(coalesce(nfi.icm_s_valor,0)) as vl_icms_st,' + #13#10 +
              '   '''' as vl_st_ent,' + #13#10 +
              '   '''' as vl_st_fnt,' + #13#10 +
              '   '''' as vl_st_uf,' + #13#10 +
              '   '''' as vl_st_oe,' + #13#10 +
              '   '''' as vl_at,' + #13#10 +
              '   sum(coalesce(nfi.vlr_isenta,0)) as vl_isnt_icms,' + #13#10 +
              '   sum(coalesce(nfi.vlr_outras,0)) as vl_out_icms,      ' + #13#10 +
              '   sum(coalesce(nfi.ipi_base,0)) as vl_bc_ipi,' + #13#10 +
              '   sum(coalesce(nfi.ipi_valor,0)) as vl_ipi,' + #13#10 +
              '   '''' as vl_isnt_ipi,' + #13#10 +
              '   '''' as vl_out_ipi ' + #13#10 +
              '   ' + #13#10 +
              ' from  fat_tb_m_nfe_ite nfi' + #13#10 +
              '  left outer join fat_tb_m_nfe nfe on' + #13#10 +
              '      (nfe.id_fiscal = nfi.id_fiscal) ' + #13#10 +
              '  left outer join cad_tb_c_cfo cfo ON' + #13#10 +
              '      (cfo.id_cfo = nfe.id_cfo)' + #13#10 +
              '  ' + #13#10;

  end;
begin
    FAT_SQ_R_GAM_E_C_305.Close;
    FAT_SQ_R_GAM_E_C_305.CommandText := enSqlFatEC305 +
           ' where nfe.status = 1 ' + #13#10 +
           '  and  nfe.nfe_cod_sit = ''00''  ' + #13#10 +
           '  and  nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
           '  and  nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
           '  and  nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
           '  and  nfe.serie <> ''X''' + #13#10 +
           ' group by 1,2,3,4,5 ' +
           ' order by 1,2,3 ';

   Result := FAT_DP_R_GAM_E_C_305.Data;
   FAT_SQ_R_GAM_E_C_305.Close;

end;

function TSM.FAT_DP_R_GAM_G_600DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
      ' select (sum(coalesce(nfi.icm_s_valor,0)) + sum(coalesce(nfi.icm_n_vlr_dif_aliq,0)))   as vl_tot_nf, '+
      ' sum(0)    as vl_tot_aj, '+
      ' sum(0)  as vl_tot_da  '+
      ' from fat_tb_m_nfe_ite nfi '+
      ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
      ' where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_600.Close;
    FAT_SQ_R_GAM_G_600.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.tipo_nf = ''E'' '+
          ' and nfe.serie <> ''X'' '+
         // ' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
   Result := FAT_DP_R_GAM_G_600.Data;
   FAT_SQ_R_GAM_G_600.Close;
end;

function TSM.FAT_DP_R_GAM_G_605DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
      ' select uf_emitente, '+
      ' case nfi.id_cfo  '+
      '   when ''1406'' then 0 '+
      '   when ''1407'' then 1 '+
      ' end as IND_SIT, '+
      ' sum(nfi.icm_s_valor) + sum(coalesce(nfi.icm_n_vlr_dif_aliq,0)) as vl_tot_nf, '+
      ' sum(0)    as vl_tot_aj, '+
      ' sum(0)  as vl_tot_da  '+
      ' from fat_tb_m_nfe_ite nfi '+
      ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
      ' where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_605.Close;
    FAT_SQ_R_GAM_G_605.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.tipo_nf = ''E'' '+
          ' and nfe.serie <> ''X''  '+
         // ' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and nfi.id_cfo in (''1406'',''1407'') '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
          ' group by 1,2 ';
   Result := FAT_DP_R_GAM_G_605.Data;
   FAT_SQ_R_GAM_G_605.Close;
end;

function TSM.FAT_DP_R_GAM_G_610DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
      ' select '+
      '       (sum(coalesce(nfi.vlr_part_dest,0))  + sum(coalesce(nfi.vlr_part_orig,0))) as vl_tot_part_nf, '+
      '       (sum(0)   + sum(0))   as vl_aj_part, '+
      '       ((sum(coalesce(nfi.vlr_part_dest,0)) + sum(coalesce(nfi.vlr_part_orig,0))) + '+
      '       (sum(0) + sum(0))) as vl_tot_part_desc '+
      ' from fat_tb_m_nfe_ite nfi '+
      '  left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
      '  left outer join cad_tb_c_cfo cfo on (cfo.id_cfo = nfe.id_cfo) '+
      '  where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_610.Close;
    FAT_SQ_R_GAM_G_610.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.faturada = true '+
          ' and nfe.tipo_nf = ''S'' '+
          ' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfe.serie <> ''X'' '+
          ' and cfo.id_classe in (''SP10'',''SP70'') '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and coalesce(nfi.vlr_part_dest,0) > 0  '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
   Result := FAT_DP_R_GAM_G_610.Data;
   FAT_SQ_R_GAM_G_610.Close;
end;

function TSM.FAT_DP_R_GAM_G_615DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' select uf_emitente, '+
     '  (sum(coalesce(nfi.vlr_part_dest,0)) + sum(coalesce(nfi.vlr_part_orig,0))) as vl_tot_part_uf_nf, '+
     '  (sum(0)   + sum(0))   as vl_aj_part_uf, '+
     '  ((sum(coalesce(nfi.vlr_part_dest,0)) + sum(coalesce(nfi.vlr_part_orig,0))) + '+
     '  (sum(0) + sum(0))) '+
     '      as vl_tot_part_uf_desc '+
     '  from fat_tb_m_nfe_ite nfi  '+
     '  left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
     '  left outer join cad_tb_c_cfo cfo on (cfo.id_cfo = nfe.id_cfo) '+
     '  where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_615.Close;
    FAT_SQ_R_GAM_G_615.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.tipo_nf = ''S'' '+
          ' and nfe.faturada = true '+
          ' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfe.serie <> ''X'' '+
          ' and cfo.id_classe in (''SP10'',''SP70'') '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and coalesce(nfi.vlr_part_dest,0) > 0 '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
          ' group by 1 ';
   Result := FAT_DP_R_GAM_G_615.Data;
   FAT_SQ_R_GAM_G_615.Close;
end;

function TSM.FAT_DP_R_GAM_G_620DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' select nfe.ind_operacao, '+
     '  nfe.ind_emitente, '+
     '  sum(nfi.icm_s_valor)   as vl_tot_st_nf, '+
     '   sum(0)    as vl_tot_aj_st, '+
     '  (sum(nfi.icm_s_valor) + sum(0)) as vl_tot_aj_st, '+
     '  0  as vl_tot_st_comb  '+
     ' from fat_tb_m_nfe_ite nfi '+
     ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
     ' where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_620.Close;
    FAT_SQ_R_GAM_G_620.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.tipo_nf in (''E'',''S'') '+
          ' and nfe.serie <> ''X'' '+
         // ' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
          ' group by 1,2 ';
   Result := FAT_DP_R_GAM_G_620.Data;
   FAT_SQ_R_GAM_G_620.Close;
end;

function TSM.FAT_DP_R_GAM_G_625DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam:String;
  begin
    Result :=
     ' select nfe.uf_emitente, '+
     ' case nfe.tipo_nf '+
     '    when ''E'' then 0 '+
     '    when ''S'' then 1 '+
     '  end as IND_TP_ST, '+
     '  sum(nfi.icm_s_valor) as vl_tot_st_nf, '+
     '  sum(0)    as vl_tot_aj_st, '+
     '  (sum(nfi.icm_s_valor) + sum(0)) as vl_tot_aj_st '+
     ' from fat_tb_m_nfe_ite nfi '+
     ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) '+
     '  where 1=1 ';
  end;
begin
    FAT_SQ_R_GAM_G_625.Close;
    FAT_SQ_R_GAM_G_625.CommandText := enSqlFatRelGam +
          ' and nfe.status = 1 '+
          ' and nfe.numero > 0 '+
          ' and nfe.tipo_nf in (''E'',''S'') '+
          ' and nfe.serie <> ''X'' '+
          //' and nfe.nfe_cod_sit <> ''02'' '+
          ' and nfi.id_st_icm in (''10'',''70'',''201'',''202'',''203'',''500'') '+
          ' and nfe.id_empresa   in (' + VarToStr(Input[0]) +') ' +
          ' and nfe.dta_documento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
          ' and nfe.dta_documento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
          ' group by 1,2 ';
   Result := FAT_DP_R_GAM_G_625.Data;
   FAT_SQ_R_GAM_G_625.Close;
end;

function TSM.FAT_DP_R_GAM_H20DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
            'select ' + #13#10 +
            '  inv.id_empresa, ' + #13#10 +
            '  inv.dta_inventario,   ' + #13#10 +
            '  ''0'' as ind_data,  ' + #13#10 +
           // '  sum(inv.qtde * inv.custo) as vlr_estoque,' + #13#10 +
            '  sum(coalesce(inv.qtde,0) * coalesce(inv.custo,0)) as vlr_estoque,' + #13#10 +
            '  0 as vlr_icms_recup,' + #13#10 +
            '  0 as vlr_ipi_recup,' + #13#10 +
            '  0 as vlr_cofins_recup,' + #13#10 +
            '  0 as vlr_trib_n_cumul,' + #13#10 +
            '  sum(inv.qtde * inv.custo) as vlr_estoque,' + #13#10 +
            '  '''' as num_lancto,' + #13#10 +
            '  '''' as cod_observacao  ' + #13#10 +
            ' from est_tb_m_inv inv ' + #13#10+
            ' left outer join cad_tb_c_ite ite on ite.id_item  = INV.id_item '+
            ' left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ';
    end;
var
  DiaIni,MesIni,AnoIni, DiaFim,MesFim,AnoFim: Word;
  DataIni,DataFim: TDateTime;


begin
  {
    input[0]  - empresa
    input[1]  - Data base
   }


 { DecodeDate(VarToDateTime(Input[1]),AnoIni,MesIni,DiaIni);
  DecodeDate(VarToDateTime(Input[2]),AnoFim,MesFim,DiaFim);

  DataIni := StrToDate('31/12/'+IntToStr(AnoIni));
  DataFim := StrToDate('31/12/'+IntToStr(AnoFim));  }

  FAT_SQ_R_GAM_H20.Close;

  FAT_SQ_R_GAM_H20.CommandText := enSqlFatRelGam +
       ' where coalesce(inv.qtde,0) > 0 and coalesce(inv.custo,0) > 0 and ite.ativo = true and inv.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       '   and inv.dta_inventario = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ' +
       '   and gru.tipo_item <> '''+'07'+''' '+
       ' group by inv.id_empresa,inv.dta_inventario ';

  {FAT_SQ_R_GAM_H20.CommandText := enSqlFatRelGam +
       ' where inv.qtde > 0 and inv.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       '   and inv.dta_inventario >= ''' + FormatDateTime(CFormatoData, DataIni ) + ''' ' +
       '   and inv.dta_inventario <= ''' + FormatDateTime(CFormatoData, DataFim ) + ''' ' +
       ' group by inv.id_empresa,inv.dta_inventario '; }


  //  CMServerForm.mm.Lines.Add(FAT_SQ_R_GAM_H20.CommandText);
  Result := FAT_DP_R_GAM_H20.Data;
  FAT_SQ_R_GAM_H20.Close;
end;

function TSM.FAT_DP_R_GAM_H30DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;


var
  DiaIni,MesIni,AnoIni, DiaFim,MesFim,AnoFim: Word;
  DataIni,DataFim: TDateTime;
  enSqlFatRelGam: String;
begin
  {
    input[0]  - empresa
    input[1]  - Data base
   }
  //Adicionei os campo do fat_dp_r_gam_200 e de fat_dp_r_gam_0190 e dexei a filtragem por data
  DecodeDate(VarToDateTime(Input[1]),AnoIni,MesIni,DiaIni);
  //DecodeDate(VarToDateTime(Input[2]),AnoFim,MesFim,DiaFim);

  //DataIni := StrToDate('31/12/'+IntToStr(AnoIni));
  //DataFim := StrToDate('31/12/'+IntToStr(AnoFim));

  DataIni := StrToDate(Input[1]);


  enSqlFatRelGam :=
          ' with temp_inv' + #13#10 +
          ' as(' + #13#10 +
          ' select ' + #13#10 +
          '  inv.id_empresa,' + #13#10 +
          '  inv.dta_inventario,   ' + #13#10 +
          '  inv.id_item,   ' + #13#10 +
          '  ncm.cest,   ' + #13#10 +
          ' ite.id_ncm as int_codncm, ' + #13#10 +
          ' ite.descricao as int_nomeite, '  + #13#10 +
          ' ite.cod_barra, '  + #13#10 +
          ' gru.tipo_item, '   + #13#10 +
          ' '''' as ex_ipi, '   + #13#10 +
          ' '''' as cod_gen, '  + #13#10 +
          ' gru.ali_interna_icms as aliq_icms, ' + #13#10 +
          ' und.id_unidade as int_id_und, '  + #13#10 +
          ' und.descricao as int_desc_und, ' + #13#10 +

          '  avg(inv.custo) as vlr_unit, ' + #13#10 +
          '  sum(inv.qtde) as qtd,' + #13#10 +
          '  sum(inv.qtde * inv.custo) as vlr_liquido,' + #13#10 +
          '  0 as vlr_icms,' + #13#10 +
          '  0 as vlr_ipi, ' + #13#10 +
          '  0 as vlr_pis,' + #13#10 +
          '  0 as vlr_cofins,' + #13#10 +
          '  0 as vlr_trib_n_cumul,' + #13#10 +
          '  '''' as cod_observacao' + #13#10 +
          ' from est_tb_m_inv inv' + #13#10 +

          '  left outer join cad_tb_c_ite ite on '  + #13#10 +
          ' (ite.id_item = inv.id_item) '  + #13#10 +
          '  left outer join cad_tb_c_gru gru on '  + #13#10 +
          '  (gru.id_grupo = ite.id_grupo) '  + #13#10 +
          ' left outer join cad_tb_c_und und on '  + #13#10 +
          ' (und.id_unidade=ite.id_und_compra) '  + #13#10 +
          ' left outer join cad_tb_c_ncm ncm on (ncm.id_ncm=ite.id_ncm) '+

          ' where inv.id_empresa     in (' + VarToStr(Input[0]) +') ' +
          '   and coalesce(inv.qtde,0) > 0 and coalesce(inv.custo,0) > 0 ' +
          '   and inv.dta_inventario = ''' + FormatDateTime(CFormatoData, DataIni ) + ''' ' +
          '   and ite.ativo = true ' +
          //'   and inv.dta_inventario <= ''' + FormatDateTime(CFormatoData, DataFim ) + ''' ' +
          ' group by 1,2,3,4,5,6,7,8,9,10,11,12' + #13#10 +
          ' )' + #13#10 +
          ' select ' + #13#10 +
          '    ''0'' as ind_posse, ' + #13#10 +
          '    par.emp_cnpj, ' + #13#10 +
          '    gru.tipo_item as ind_item,  ' + #13#10 +
          '    ite.id_ncm, ' + #13#10 +
          '    tnv.*, ' + #13#10 +
          '    ite.id_und_compra,    ' + #13#10 +
          '    123 as cod_cta    ' + #13#10 +
          ' from temp_inv as tnv' + #13#10 +
          '	  left outer join cad_tb_c_par par on ' + #13#10 +
          '     (par.id_empresa = tnv.id_empresa)' + #13#10 +
          '	  left outer join cad_tb_c_ite ite on' + #13#10 +
          '     (ite.id_item = tnv.id_item)' + #13#10 +
          '   left outer join cad_tb_c_gru gru on' + #13#10 +
          '     (gru.id_grupo = ite.id_grupo)' + #13#10 +
          '   where gru.tipo_item <> '''+'07'+''' '+
          ' order by tnv.id_empresa,tnv.id_item ';


   FAT_SQ_R_GAM_H30.Close;

   FAT_SQ_R_GAM_H30.CommandText := enSqlFatRelGam;

  //   CMServerForm.mm.Lines.Add(FAT_SQ_R_GAM_H30.CommandText);
   Result := FAT_DP_R_GAM_H30.Data;
   FAT_SQ_R_GAM_H30.Close;
end;

function TSM.FAT_DP_R_GAM_H50DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
            ' select ' + #13#10 +
            '   inv.id_empresa,' + #13#10 +
            '   inv.dta_inventario,   ' + #13#10 +
            '   gru.tipo_item,   ' + #13#10 +
            '   sum(inv.qtde * inv.custo) as vlr_total  ' + #13#10 +
            ' from est_tb_m_inv inv' + #13#10 +
            '	  left outer join cad_tb_c_ite ite on' + #13#10 +
            '     (ite.id_item  = inv.id_item)' + #13#10 +
            '   left outer join cad_tb_c_gru gru on' + #13#10 +
            '     (gru.id_grupo = ite.id_grupo)' + #13#10 +
            ' where inv.qtde > 0 and ite.ativo = true ' + #13#10;
    end;
var
  DiaIni,MesIni,AnoIni, DiaFim,MesFim,AnoFim: Word;
  DataIni,DataFim: TDateTime;
begin
  {
    input[0]  - empresa
    input[1]  - Data base
   }

  DecodeDate(VarToDateTime(Input[1]),AnoIni,MesIni,DiaIni);
  DecodeDate(VarToDateTime(Input[2]),AnoFim,MesFim,DiaFim);

  DataIni := StrToDate('31/12/'+IntToStr(AnoIni));
  DataFim := StrToDate('31/12/'+IntToStr(AnoFim));


   FAT_SQ_R_GAM_H50.Close;

   FAT_SQ_R_GAM_H50.CommandText := enSqlFatRelGam +
       '   and inv.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       '   and inv.dta_inventario >= ''' + FormatDateTime(CFormatoData, DataIni ) + ''' ' +
       '   and inv.dta_inventario <= ''' + FormatDateTime(CFormatoData, DataFim ) + ''' ' +
       ' group by inv.id_empresa,inv.dta_inventario,gru.tipo_item ';

  // CMServerForm.mm.Lines.Add('FAT_SQ_R_GAM_H50 ' + #13 + FAT_SQ_R_GAM_H50.CommandText);
   Result := FAT_DP_R_GAM_H50.Data;

   FAT_SQ_R_GAM_H50.Close;
end;

function TSM.FAT_DP_R_GAM_H60DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelGam: String;
  begin
    Result :=
            ' select ' + #13#10 +
            '   inv.id_empresa,' + #13#10 +
            '   inv.dta_inventario,   ' + #13#10 +
            '   ite.id_ncm,' + #13#10 +
            '   sum(inv.qtde * inv.custo) as vlr_total  ' + #13#10 +
            ' from est_tb_m_inv inv' + #13#10 +
            '	 left outer join cad_tb_c_ite ite on' + #13#10 +
            '     (ite.id_item  = inv.id_item)  ' + #13#10 +
            ' where inv.qtde > 0 and ite.ativo = true  ' + #13#10;
    end;
var
  DiaIni,MesIni,AnoIni, DiaFim,MesFim,AnoFim: Word;
  DataIni,DataFim: TDateTime;
begin
  {
    input[0]  - empresa
    input[1]  - Data base
   }

  DecodeDate(VarToDateTime(Input[1]),AnoIni,MesIni,DiaIni);
  DecodeDate(VarToDateTime(Input[2]),AnoFim,MesFim,DiaFim);

  DataIni := StrToDate('31/12/'+IntToStr(AnoIni));
  DataFim := StrToDate('31/12/'+IntToStr(AnoFim));


   FAT_SQ_R_GAM_H60.Close;

   FAT_SQ_R_GAM_H60.CommandText := enSqlFatRelGam +
       '   and inv.id_empresa  in (' + VarToStr(Input[0]) +') ' +
       '   and inv.dta_inventario >= ''' + FormatDateTime(CFormatoData, DataIni ) + ''' ' +
       '   and inv.dta_inventario <= ''' + FormatDateTime(CFormatoData, DataFim ) + ''' ' +
       ' group by inv.id_empresa,inv.dta_inventario,ite.id_ncm ';

   Result := FAT_DP_R_GAM_H60.Data;

   FAT_SQ_R_GAM_H60.Close;
end;

function TSM.FAT_DP_R_GAM_INV_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelInvIte: String;
  begin
    Result :=
            ' select ' + #13#10 +
            '   inv.id_item,' + #13#10 +
            '   ite.descricao as int_nomeite   ' + #13#10 +
            ' from est_tb_m_inv inv' + #13#10 +
            '	  left outer join cad_tb_c_ite ite on' + #13#10 +
            '     (ite.id_item  = inv.id_item)' + #13#10 +
            ' where inv.qtde > 0 and ite.ativo = true ' + #13#10;
    end;
var
  DiaIni,MesIni,AnoIni, DiaFim,MesFim,AnoFim: Word;
  DataIni,DataFim: TDateTime;
begin
  {
    input[0]  - empresa
    input[1]  - Data base
   }

  DecodeDate(VarToDateTime(Input[1]),AnoIni,MesIni,DiaIni);

  //DecodeDate(VarToDateTime(Input[2]),AnoFim,MesFim,DiaFim);

  DataIni := StrToDate(IntToStr(DiaIni) + '/' + IntToStr(MesIni) + '/'+IntToStr(AnoIni));
  DataFim := StrToDate(IntToStr(DiaIni) + '/' + IntToStr(MesIni) + '/'+IntToStr(AnoIni));

  FAT_SQ_R_GAM_INV_ITE.Close;

  FAT_SQ_R_GAM_INV_ITE.CommandText := enSqlFatRelInvIte +
       '   and inv.id_empresa   in (' + VarToStr(Input[0]) +') ' +
       '   and inv.dta_inventario >= ''' + FormatDateTime(CFormatoData, DataIni ) + ''' ' +
       '   and inv.dta_inventario <= ''' + FormatDateTime(CFormatoData, DataFim ) + ''' ';
  // CMServerForm.mm.Lines.Add('FAT_SQ_R_GAM_H50 ' + #13 + FAT_SQ_R_GAM_H50.CommandText);
  Result := FAT_DP_R_GAM_INV_ITE.Data;

  FAT_SQ_R_GAM_INV_ITE.Close;
end;


function TSM.FAT_DP_R_ICM_CFODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlIcm, CondicaoOrder, CondicaoGroup: String;
begin

    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlIcm:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Icms
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por CST
                  // 01-Por CFOP
                  // 02-Por Produto


    CondicaoOrder := '';
    CondicaoGroup := '';


    if (Input[9] = 1)  then
       begin
         enSqlIcm :=
          'SELECT '+
          '   NIT.ID_CFO, CFO.DESCRICAO, '+
          '   SUM(COALESCE(NIT.VLR_LIQUIDO,0)) AS VLR_LIQUIDO, '+
          //'   SUM(COALESCE(NIT.VLR_LIQUIDO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
          '   SUM(COALESCE(NIT.ICM_N_BASE,0)) AS BASE_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_N_VALOR,0)) AS VALOR_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_S_BASE,0)) AS BASE_ICM_SUBS, '+
          '   SUM(COALESCE(NIT.ICM_S_VALOR,0)) AS VALOR_ICM_SUBS '+
          'FROM FAT_TB_M_NFE_ITE NIT '+
          'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
          'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
          'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
          'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
          'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
          'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
          'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
          'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
          CondicaoGroup :='GROUP BY 1,2 ';
       end;

    case Input[9] of
       0: CondicaoOrder := 'ORDER BY NIT.ID_ST_ICM';
       1: CondicaoOrder := 'ORDER BY CFO.DESCRICAO ';
       2: CondicaoOrder := 'ORDER BY ITE.DESCRICAO ';
    end;


  FAT_SQ_R_ICM_CFO.Close;
  FAT_SQ_R_ICM_CFO.CommandText :='';


  FAT_SQ_R_ICM_CFO.CommandText := enSqlIcm +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText +
   ' AND NFE.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND NIT.ID_ST_ICM in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_ICM_CFO.CommandText := FAT_SQ_R_ICM_CFO.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_ICM_CFO.Data;
end;

function TSM.FAT_DP_R_ICM_CSTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlIcm, CondicaoOrder, CondicaoGroup: String;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlIcm:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Icms
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por CST
                  // 01-Por CFOP
                  // 02-Por Produto


    CondicaoOrder := '';
    CondicaoGroup := '';


    if (Input[9] = 0)  then
       begin
         enSqlIcm :=
          'SELECT '+
          '   NFE.IND_OPERACAO, NIT.ID_ST_ICM, '+
          '   SUM(COALESCE(NIT.VLR_LIQUIDO,0)) AS VLR_LIQUIDO, '+
        //  '   SUM(COALESCE(NIT.VLR_LIQUIDO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
          '   SUM(COALESCE(NIT.ICM_N_BASE,0)) AS BASE_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_N_VALOR,0)) AS VALOR_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_S_BASE,0)) AS BASE_ICM_SUBS, '+
          '   SUM(COALESCE(NIT.ICM_S_VALOR,0)) AS VALOR_ICM_SUBS '+
          'FROM FAT_TB_M_NFE_ITE NIT '+
          'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
          'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
          'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
          'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
          'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
          'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
          'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
          'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
          CondicaoGroup := 'GROUP BY 1,2 ';
       end;

    case Input[9] of
       0: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,NIT.ID_ST_ICM';
       1: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,CFO.DESCRICAO ';
       2: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,ITE.DESCRICAO ';
    end;


  FAT_SQ_R_ICM_CST.Close;
  FAT_SQ_R_ICM_CST.CommandText :='';


  FAT_SQ_R_ICM_CST.CommandText := enSqlIcm +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND NIT.ID_ST_ICM in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_ICM_CST.CommandText := FAT_SQ_R_ICM_CST.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_ICM_CST.Data;
end;

function TSM.FAT_DP_R_ICM_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlIcm, CondicaoOrder, CondicaoGroup: String;
begin

    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlIcm:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Icms
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por CST
                  // 01-Por CFOP
                  // 02-Por Produto


    CondicaoOrder := '';
    CondicaoGroup := '';


    if (Input[9] = 2)  then
       begin
         enSqlIcm :=
          'SELECT '+
          '   NFE.IND_OPERACAO,NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE, '+
          '   SUM(COALESCE(NIT.VLR_LIQUIDO,0)) AS VLR_LIQUIDO, '+
          //'   SUM(COALESCE(NIT.VLR_LIQUIDO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
          '   SUM(COALESCE(NIT.ICM_N_BASE,0)) AS BASE_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_N_VALOR,0)) AS VALOR_ICM_NORMAL, '+
          '   SUM(COALESCE(NIT.ICM_S_BASE,0)) AS BASE_ICM_SUBS, '+
          '   SUM(COALESCE(NIT.ICM_S_VALOR,0)) AS VALOR_ICM_SUBS '+
          'FROM FAT_TB_M_NFE_ITE NIT '+
          'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
          'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
          'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
          'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
          'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
          'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
          'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
          'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
          'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
          CondicaoGroup := 'GROUP BY 1,2,3 ';
       end;

    case Input[9] of
       0: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,NIT.ID_ST_ICM';
       1: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,CFO.DESCRICAO ';
       2: CondicaoOrder := 'ORDER BY NFE.IND_OPERACAO,ITE.DESCRICAO ';
    end;


  FAT_SQ_R_ICM_ITE.Close;
  FAT_SQ_R_ICM_ITE.CommandText :='';


  FAT_SQ_R_ICM_ITE.CommandText := enSqlIcm +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND NIT.ID_ST_ICM in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_ICM_ITE.CommandText := FAT_SQ_R_ICM_ITE.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_ICM_ITE.Data;
end;

function TSM.FAT_DP_R_IQM_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlNfeIteIqm: String;
  begin
    Result :=
       'select ipt.*, ' +
        '  fun.nome AS desc_fun, ite.id_und_compra, ite.descricao AS desc_ite, ' +
        '  und.descricao AS desc_und, iqm.id_emitente,                         ' +
        '  frn.descricao, frn.fantasia, fcn.nome AS nome_apro_gerente,         ' +
        '  fco.nome AS nome_exec,                                              ' +
        '  iqm.dta_recebimento, iqm.dta_emissao_nf, iqm.numero_nf,              ' +
        '  case ipt.cnd_comercial ' +
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        '  END DESC_CND_COMER, '+
        ' CASE ipt.QTD_PC_NF '+
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        ' END DESC_QTD, '+
        ' CASE ipt.QUALIDADE '+
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        ' END DESC_QUAL, '+
        ' CASE ipt.PRES_PRODUTO '+
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        ' END DESC_PRED_PROD, '+
        ' CASE ipt.CERT_QUALIDADE '+
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        ' END DESC_CERT_QUAL, '+
        ' CASE ipt.RESULTADO '+
        '      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
        '      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
        ' END DESC_RESUL '+
        ' from fat_tb_m_iqm_ite ipt '+
        '  left outer join fat_tb_m_iqm iqm on iqm.id_iqm = ipt.id_iqm ' +
        '  left outer join cad_tb_c_fun fun     on (fun.id_funcionario = ipt.id_responsavel) ' +
        '  left outer join cad_tb_c_ite ite     on (ite.id_item        = ipt.id_item)        ' +
        '  left outer join cad_tb_c_und und     on (und.id_unidade     = ite.id_und_compra)  ' +
        '  left outer join cad_tb_c_for frn     on (frn.id_fornecedor  = iqm.id_emitente)    ' +
        '  left outer join cad_tb_c_fun fcn     on (fcn.id_funcionario = ipt.apro_gerente)   ' +
        '  left outer join cad_tb_c_fun fco     on (fco.id_funcionario = ipt.exec_por) ';
  end;
begin
   //parametros
   // 0 - data inicial
   // 1 - data final
   // 2 - empresa
   // 3 - codigo emitente
   // 4 - codigo do item
   // 5 - numero da nf
   // 6 - cdigo fornecedor da nf
   // 7 - 0 - nfe.dta_documento, iqm.id_item, iqm.id_sequencia,
   //     1 - iqm.id_item, iqm.id_sequencia, nfe.dta_documento, nfe.numero

   FAT_SQ_R_IQM_ITE.Close;
   FAT_SQ_R_IQM_ITE.CommandText := enSqlNfeIteIqm +
   ' WHERE iqm.dta_recebimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
   '       iqm.dta_recebimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
   if Input[2]  <> '' then
      begin
        FAT_SQ_R_IQM_ITE.CommandText :=
          FAT_SQ_R_IQM_ITE.CommandText +
          ' and iqm.id_empresa = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[3]  <> '' then
      begin
        FAT_SQ_R_IQM_ITE.CommandText :=
          FAT_SQ_R_IQM_ITE.CommandText +
          ' and iqm.id_emitente in (' + VarToStr(Input[3]) +') ';
      end;
   if Input[4]  <> '' then
      begin
        FAT_SQ_R_IQM_ITE.CommandText :=
          FAT_SQ_R_IQM_ITE.CommandText +
          ' and ipt.id_item in (' + VarToStr(Input[4]) +') ';
      end;
   if Input[5]  <> '' then
      begin
        FAT_SQ_R_IQM_ITE.CommandText :=
          FAT_SQ_R_IQM_ITE.CommandText +
          ' and iqm.numero_nf in (' + VarToStr(Input[5]) +') ' +
          ' and iqm.id_emitente in (' + VarToStr(Input[6]) +') ';
      end;
   if Input[7] = 0 then
      begin
        FAT_SQ_R_IQM_ITE.CommandText := FAT_SQ_R_IQM_ITE.CommandText +' order by iqm.dta_emissao_nf, ipt.id_item, ipt.id_sequencia ';
      end
   else if Input[7] = 1 then
      begin
        FAT_SQ_R_IQM_ITE.CommandText := FAT_SQ_R_IQM_ITE.CommandText +' order by ipt.id_item, ipt.id_sequencia, iqm.dta_emissao_nf, iqm.numero_nf ';
      end;

   //GerarSqlTxt(FAT_SQ_R_IQM_ITE);
   Result := FAT_DP_R_IQM_ITE.Data;
end;

function TSM.FAT_DP_R_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelNfe: String;
  begin
        Result :=
          'SELECT NFE.*, '+
          '   tme.descricao as int_nometme, cfo.descricao as int_nomecfo, '+
          '   cpg.descricao as int_nomecpg, '+
          '   vnd.nome as int_nomevnd, '+
          '   res.nome as int_nomeres, '+
          '   tra.descricao as int_nometra, '+
          '   tra.endereco as int_endtra, '+
          '   tra.bairro as int_baitra, ' +
          '   cit.nome as int_cidtra, '+
          '   cit.uf as int_esttra, '+
          '   tra.doc_cnpj as int_cnptra, '+
          '   tra.doc_ie as int_instra, '+
          '   par.emp_fantasia as int_nomeemp, ' +
          '   nat.descricao as int_descnat, ' +
          '   CAST (CASE nfe_cod_sit '+
          '           WHEN ''02'' THEN ''SIM'' '+
          '           ELSE ''NO'' END AS VARCHAR(3)) AS INT_NOTACANCELADA, '+
          '   cast (case nfe_cod_sit ' +
          '      when ''00'' then ''Documento regular'' ' +
          '      when ''01'' then ''Escriturao extempornea de documento regular'' ' +
          '      when ''02'' then ''Documento cancelado'' ' +
          '      when ''03'' then ''Escriturao extempornea de documento cancelado'' ' +
          '      when ''04'' then ''NF-e denegada ou CT-e denegado'' ' +
          '      when ''05'' then ''NF-e ou CT-e com numerao inutilizada'' ' +
          '      when ''06'' then ''Documento fiscal complementar'' ' +
          '      when ''07'' then ''Escriturao extempornea de documento complementar'' ' +
          '      when ''08'' then ''Documento fiscal emitido com base em regime especial ou norma especfica'' ' +
          '    end as varchar(80) ) as int_descnfecodsit, ' +
          '   case '+
          '       when nfe.tipo_nf in (''E'',''D'',''F'')  then 0 '+
          '       when nfe.tipo_nf in (''S'',''R'') then CLI.ID_PERFIL_CLI end '+
          '   as INT_ID_PERFIL_CLI, '+
          '   cast( case '+
          '        when nfe.tipo_nf in (''E'',''D'',''F'') then fne.descricao  '+
          '        when nfe.tipo_nf in (''S'',''R'') then cli.nome  '+
          '   end as varchar(50) ) as INT_NOMEEMI,  '+
          '   case '+
          '      when nfe.nfe_ecf = 0 then '''+'NFE'+''' '+
          '      when nfe.nfe_ecf = 1 then '''+'ECF'+''' '+
          '   end as INT_NFEECF, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then '''+'Entrada'+''' '+
          '      when nfe.tipo_nf in (''S'',''R'') then '''+'Saidas'+''' '+
          '   end as INT_NOMEOPE, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.doc_cnpj '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.doc_cnpj_cpf '+
          '   end as INT_CNPJCPF, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then 0 '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.PESSOA '+
          '   end as INT_PESSOA, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.TEL_FIXO '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.TEL_FIXO '+
          '   end as INT_TELEFONE, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.DOC_IE '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.DOC_IE_IDENTIDADE '+
          '   end as INT_DOC_IE, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.EMAIL '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.EMAIL '+
          '   end as INT_EMAIL, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.CEP '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.CEP '+
          '   end as INT_CEP, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.ENDERECO '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.ENDERECO '+
          '   end as INT_ENDERECO, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then cif.uf '+
          '      when nfe.tipo_nf in (''S'',''R'') then cic.uf '+
          '   end as INT_ESTADO, '+
          '   case '+
          '     when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.BAIRRO '+
          '     when nfe.tipo_nf in (''S'',''R'') then CLI.BAIRRO '+
          '   end as INT_BAIRRO, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.NUMERO '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.NUMERO '+
          '   end as INT_NUMERO, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.END_COMPLEMENTO '+
          '      when nfe.tipo_nf in (''S'',''R'') then CLI.END_COMPLEMENTO '+
          '   end as INT_COMPLEMENTO, '+
          '   case '+
          '     when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.ID_CIDADE '+
          '     when nfe.tipo_nf in (''S'',''R'') then CLI.ID_CIDADE '+
          '   end as INT_COD_CIDADE, '+
          '   case '+
          '     when nfe.tipo_nf in (''E'',''D'',''F'') then cif.nome '+
          '     when nfe.tipo_nf in (''S'',''R'') then cic.nome '+
          '   end as INT_NOM_CIDADE, '+
          '   case '+
          '      when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.cod_pais '+
          '      when nfe.tipo_nf in (''S'',''R'')then CLI.cod_pais '+
          '   end as INT_COD_PAIS, '+
          '   case '+
          '     when nfe.tipo_nf in (''E'',''D'',''F'') then paf.descricao '+
          '     when nfe.tipo_nf in (''S'',''R'') then pac.descricao '+
          '   end as INT_NOM_PAIS, '+
          '   CPG.tipo_pagamento as int_indPag, '+
          '   cfo.id_classe as int_classe,  NFE.ICM_N_VALOR vlr_icm,  NFE.ICM_S_VALOR vlr_icm_subs' +
          ' FROM FAT_TB_M_NFE NFE '+
          ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ID_EMITENTE '+
          ' LEFT OUTER JOIN CAD_TB_C_FOR FNE ON FNE.ID_FORNECEDOR=ID_EMITENTE '+
          ' LEFT OUTER JOIN cad_tb_c_tme tme on tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque '+
          ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.id_condicao_pag=NFE.id_condicao_pag '+
          ' left outer join cad_tb_c_fun vnd on vnd.id_funcionario=nfe.id_vendedor '+
          ' left outer join cad_tb_c_fun res on res.id_funcionario=nfe.id_responsavel '+
          ' left outer join cad_tb_c_for tra on tra.id_fornecedor=NFE.id_transportadora '+
          ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
          ' left outer join cad_tb_c_cid cit on cit.id_cidade=tra.id_cidade '+
          ' left outer join cad_tb_c_cid cic on cic.id_cidade=cli.id_cidade '+
          ' left outer join cad_tb_c_cid cif on cif.id_cidade=fne.id_cidade '+
          ' left outer join cad_tb_c_pai pac on pac.id_pais=CLI.cod_pais ' +
          ' left outer join cad_tb_c_pai paf on paf.id_pais=fne.cod_pais ' +
          ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa ' +
          ' left outer join cad_tb_c_nat nat on cfo.id_classe = nat.id_classe ';
  end;
begin

   {
    input[0]  - 00 - Espelho das Notas
                01 - Resumo das Notas
                02 - nao
                03 - nao
                04 - Agrupado por Tipo de Estoque
                05 - Agrupado por CFOP
                06 - Detalhado por Item
    input[1]  - Data ini
    input[2]  - Data fin
    input[3]  - Tipo nota fiscal
    input[4]  - Nro do documento
    input[5]  - Pesquisar por
    input[6]  - empresa
    input[7]  - Tipo de Estoque
    input[8]  - CFOP
    input[9]  - Modelo
    input[10] - Cod. Situao NFE
    input[11] - Ordenao
    input[12] - Exibir Nota Cancelada
    input[15] - 0 - Emisso;  1 - Data documento
   }

   FAT_SQ_R_NFE.Close;


   if input[15] = '0' then
      begin
        FAT_SQ_R_NFE.CommandText := enSqlFatRelNfe +
          ' WHERE NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
          ' AND   NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else
      begin
        FAT_SQ_R_NFE.CommandText := enSqlFatRelNfe +
             ' WHERE NFE.DTA_DOCUMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
             ' AND   NFE.DTA_DOCUMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end;

   if VarToStr(Input[3])<>'C' then
      FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
          ' AND   NFE.TIPO_NF = ''' + VarToStr(Input[3]) +''' '
   else
      FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
          ' AND   NFE.NFE_COD_SIT=''02'' ';

   FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
          ' AND   NFE.NUMERO > 0 AND NFE.STATUS = 1 ';


   if input[4] <> '' then
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.NUMERO = ''' + VarToStr(Input[4]) +''' ';
      end;

   if input[5] <> '' then
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.NFE_ECF = ''' + VarToStr(Input[5]) +''' ';
      end;

   if input[6] <> '' then // Empresa
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[6]) +')';
      end;

   if input[7] <> '' then // Tipo de Estoque
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.id_tipo_mov_estoque in (' + VarToStr(Input[7]) +')';
      end;

   if input[8] <> '' then // Cfop
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.id_cfo in (' + VarToStr(Input[8]) +')';
      end;

   if input[9] <> '' then //Modelo
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.modelo in (' + VarToStr(Input[9]) +')';
      end;

   if input[10] <> '' then //Cod. Situacao NFE
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.nfe_cod_sit in (' + VarToStr(Input[10]) +')';
      end;

   if (VarToStr(Input[3])<>'C') and  (input[12] = '0') then //Exibir Nota Cancelada
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.nfe_cod_sit <> ''02'' ';
      end;

   if input[13] <> '' then //Id. Emitente
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.id_emitente in ('+VarToStr(Input[13])+') ';
      end;

   if input[14] = '' then
      begin
        FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.serie <> ''X'' ';
      end
   else
    begin
      FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +
                                    ' AND NFE.serie = ''X'' ';
    end;


   if (input[0] = 0) or
      (input[0] = 1)  then
      begin
        if input[11] = 0 then // Data de emisso
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_EMPRESA, NFE.DTA_EMISSAO ';
        if input[11] = 1 then // Data de documento
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_EMPRESA, NFE.DTA_DOCUMENTO ';
        if input[11] = 2 then // Nrmeo da NFe
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_EMPRESA, NFE.NUMERO ';
      end;
   if input[0] = 4 then
      begin
        if input[11] = 0 then // Data de emisso
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_TIPO_MOV_ESTOQUE, NFE.ID_EMPRESA, NFE.DTA_EMISSAO ';
        if input[11] = 1 then // Data de documento
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_TIPO_MOV_ESTOQUE, NFE.ID_EMPRESA, NFE.DTA_DOCUMENTO ';
        if input[11] = 2 then // Numero
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_TIPO_MOV_ESTOQUE, NFE.ID_EMPRESA, NFE.NUMERO ';
      end;

   if input[0] = 5 then
      begin
        if input[11] = 0 then // Data de emisso
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_CFO, NFE.ID_EMPRESA, NFE.DTA_EMISSAO ';
        if input[11] = 1 then // Data de DOCUMENTO
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_CFO, NFE.ID_EMPRESA, NFE.DTA_DOCUMENTO ';
        if input[11] = 2 then // nUMERO
           FAT_SQ_R_NFE.CommandText := FAT_SQ_R_NFE.CommandText +  ' ORDER BY NFE.NFE_COD_SIT,NFE.ID_CFO, NFE.ID_EMPRESA, NFE.NUMERO ';
      end;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_NFE.CommandText);
   Result := FAT_DP_R_NFE.Data;

   FAT_SQ_R_NFE.Close;
end;

function TSM.FAT_DP_R_NFE_CFODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelNfeCfo: String;
  begin
    Result :=
      ' SELECT NFE.NFE_COD_SIT,cfo.descricao as int_nomecfo,nfe.id_cfo, nfe.id_empresa, par.emp_fantasia as int_nomeemp,  ' +
      '  SUM(NFE.ICM_N_VALOR) AS vlr_icm,      ' +
      '  SUM(NFE.ICM_S_VALOR) AS vlr_icm_subs, ' +
      '  SUM(NFE.PIS_VALOR) +                  ' +
      '  SUM(NFE.COF_VALOR) AS vlr_pis_cof,    ' +
      '  SUM(NFE.VLR_LIQUIDO) as vlr_liquido  ' +
      ' FROM FAT_TB_M_NFE NFE                  ' +
      ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa '+
      '   left outer join cad_tb_c_cfo cfo     ' +
      ' on cfo.id_cfo=nfe.id_cfo ' ;

  end;
begin

   {
    input[0]  - 03 - Resumo por CFop
    input[1]  - Data ini
    input[2]  - Data fin
    input[3]  - Tipo nota fiscal
    input[4]  - Nro do documento
    input[5]  - Pesquisar por
    input[6]  - empresa
    input[7]  - Tipo de Estoque
    input[8]  - CFOP
    input[9]  - Modelo
    input[10] - Cod. Situao NFE
    input[11] - Ordenao
    input[12] - Cod. Id Emitente
    input[14] - 0 - Data de emisso; 1 - Data do documento
   }

   FAT_SQ_R_NFE_CFO.Close;


   if input[14] = '0' then
      begin
         FAT_SQ_R_NFE_CFO.CommandText := enSqlFatRelNfeCfo +
                ' WHERE NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
                '  AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ' +
                '  AND  NFE.TIPO_NF = ''' + VarToStr(Input[3]) +''' ' +
                '  AND  NFE.NUMERO > 0 AND NFE.STATUS = 1 ' ;
      end
   else
      begin
         FAT_SQ_R_NFE_CFO.CommandText := enSqlFatRelNfeCfo +
                ' WHERE NFE.DTA_DOCUMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
                '  AND  NFE.DTA_DOCUMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ' +
                '  AND  NFE.TIPO_NF = ''' + VarToStr(Input[3]) +''' ' +
                '  AND  NFE.NUMERO > 0 AND NFE.STATUS = 1 ' ;
      end;

   if input[4] <> '' then
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.NUMERO = ''' + VarToStr(Input[4]) +''' ';
      end;

   if input[5] <> '' then
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.NFE_ECF = ''' + VarToStr(Input[5]) +''' ';
      end;

   if input[6] <> '' then // Empresa
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[6]) +')';
      end;

   if input[7] <> '' then // Tipo de Estoque
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.id_tipo_mov_estoque in (' + VarToStr(Input[7]) +')';
      end;

   if input[8] <> '' then // Cfop
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.id_cfo in (' + VarToStr(Input[8]) +')';
      end;

   if input[9] <> '' then //Modelo
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.modelo in (' + VarToStr(Input[9]) +')';
      end;

   if input[10] <> '' then //Cod. Situao NFE
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.nfe_cod_sit in (' + VarToStr(Input[10]) +')';
      end;

    if input[12] <> '' then //Cod. Id Emitente
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.id_emitente in (' + VarToStr(Input[12]) +')';
      end;

    if input[13] = '' then
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.serie <> ''X'' ';
      end
    else
      begin
        FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                    ' AND NFE.serie = ''X'' ';
      end;

   FAT_SQ_R_NFE_CFO.CommandText := FAT_SQ_R_NFE_CFO.CommandText +
                                   ' GROUP BY NFE.NFE_COD_SIT,nfe.id_empresa,par.emp_fantasia,int_nomecfo,nfe.id_cfo '+
                                   ' ORDER BY NFE.NFE_COD_SIT,nfe.id_empresa,par.emp_fantasia,int_nomecfo,nfe.id_cfo ';
   Result := FAT_DP_R_NFE_CFO.Data;
   FAT_SQ_R_NFE_CFO.Close;
end;

function TSM.FAT_DP_R_NFE_DPIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelNfeDpi: String;
  begin
    Result :=
      ' select '+ #13#10+
      ' '''' as sap, par.emp_fantasia AS "empresa",	ite.descricao AS "PRODUTO",	'+ #13#10+
      ' nfe.NUMERO AS "NUMERO NOTA FISCAL", '+ #13#10+
      ' nfe.serie,nfe.modelo,nfe.id_pedido_venda,nit.id_item,nit.id_st_icm,nit.vlr_desconto, '+ #13#10+
	    ' nit.icm_n_valor,ite.id_und_venda,cpg.descricao as int_nomecpg,tme.descricao as int_nometme, '+ #13#10+
      ' nfe.dta_emissao AS "data de emisso nota fiscal",	nfe.id_cfo AS "cfop", '''' as gerente, '+ #13#10+
      ' cfo.id_classe || ''-'' || nat.descricao AS "natureza", nit.vlr_unitario, '+ #13#10+
      ' ven.doc_cpf as "cpf consultor/vendedor",nfe.dta_documento, '+ #13#10+

      ' CASE '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''E'') OR (nfe.tipo_nf = ''D'') THEN frn.descricao '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cli.nome '+ #13#10+
      ' END AS CLIENTE_FORNECEDOR, '+ #13#10+

      ' CAST (  '+ #13#10+
      '   CASE   '+ #13#10+
      '     WHEN (nfe.tipo_nf = ''E'') OR (nfe.tipo_nf = ''D'') THEN frn.doc_cnpj '+ #13#10+
      '     WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cli.doc_cnpj_cpf  '+ #13#10+
      '   END AS VARCHAR (20) '+ #13#10+
      ' ) AS CPF_CNPJ, '+ #13#10+

      ' CASE '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''E'') OR (nfe.tipo_nf = ''D'') THEN ''0'' '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cli.doc_ip '+ #13#10+
      ' END AS INSCRICAO_PROD, '+ #13#10+

      ' CASE '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''E'') OR (nfe.tipo_nf = ''D'') THEN cdd.nome '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cid.nome '+ #13#10+
      ' END AS MUNICIPIO,'+ #13#10+

      ' CASE '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''E'') OR (nfe.tipo_nf = ''D'') THEN cdd.uf '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cid.uf '+ #13#10+
      ' END AS ESTADO,'+ #13#10+

     { ' CASE '+ #13#10+
      '   WHEN nft.dta_vencimento IS NOT NULL THEN nft.dta_vencimento  '+ #13#10+
      ' ELSE nfe.dta_emissao '+ #13#10+
      ' END AS "DATA VENCIMENTO", '+ #13#10+  }

      ' CASE '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cul.descricao '+ #13#10+
      ' END AS CULTURA, '+ #13#10+

      ' CASE  '+ #13#10+
      '   WHEN ven.nome IS NULL THEN ''LOJA'' '+ #13#10+
      ' ELSE ven.nome '+ #13#10+
      '   END AS "CONSULTOR/VENDEDOR",  '+ #13#10+

      ' CASE  '+ #13#10+
      '   WHEN ven.nome IS NULL THEN ''LOJA'' '+ #13#10+
      ' ELSE ven.nome  '+ #13#10+
      ' END AS VENDEDOR, '+ #13#10+

      ' CASE  '+ #13#10+
      '   WHEN (nfe.tipo_nf = ''S'') OR (nfe.tipo_nf = ''R'') THEN cli.tel_fixo '+ #13#10+
      ' END AS "TELEFONE DO PRODUTOR", '+ #13#10+

      ' SUM (nit.QTDE) AS QUANTIDADE, '+ #13#10+

      ' round(CAST (SUM (COALESCE (NIT.VLR_UNITARIO * (NIT.QTDE),0)) - '+ #13#10+
      '   SUM ((COALESCE (NIT.VLR_DESCONTO, 0) / NIT.QTDE) * (nit.qtde)) AS NUMERIC (18, 2)),2 '+ #13#10+
      ' ) AS VALOR_TOTAL '+ #13#10+

    ' FROM fat_tb_m_nfe_ite nit '+ #13#10+

    ' LEFT OUTER JOIN cad_tb_c_ite ite ON ite.id_item = nit.id_item '+ #13#10+
    ' LEFT OUTER JOIN fat_tb_m_nfe nfe ON nfe.id_fiscal = nit.id_fiscal  '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_par par ON par.id_empresa = nfe.id_empresa  '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_cfo cfo ON nfe.id_cfo = cfo.id_cfo '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_nat nat ON cfo.id_classe = nat.id_classe   '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_cli cli ON cli.id_cliente = nfe.id_emitente  '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_for frn ON frn.id_fornecedor = nfe.id_emitente   '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_cid cid ON cid.id_cidade = cli.id_cidade  '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_cid cdd ON cdd.id_cidade = frn.id_cidade  '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_fun ven ON ven.id_funcionario = nfe.id_vendedor  '+ #13#10+
    ' LEFT OUTER JOIN fat_tb_m_ped ped ON ped.id_pedido = nfe.id_pedido_venda '+ #13#10+
    ' LEFT OUTER JOIN fat_tb_m_ped_ite pit ON pit.id_pedido = nfe.id_pedido_venda and pit.id_sequencia=nit.id_sequencia '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_ite_cul cti ON cti.id_item = pit.id_item '+ #13#10+
    ' AND cti.id_cultura = pit.id_cultura '+ #13#10+
    ' LEFT OUTER JOIN cad_tb_c_cul cul ON cul.id_cultura = cti.id_cultura  '+ #13#10+
    //' LEFT OUTER JOIN fat_tb_m_nfe_tit nft ON nft.id_fiscal = nit.id_fiscal'+#13#10+
    ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag=nfe.id_condicao_pag'+#13#10+
    ' left outer join cad_tb_c_tme tme on tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque'+#13#10;
  end;
begin
  FAT_SQ_R_NFE_DPI.Close;

  FAT_SQ_R_NFE_DPI.CommandText := enSqlFatRelNfeDpi +
    ' WHERE nfe.DTA_DOCUMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) )  +''' ' + #13#10 +
    ' AND   nfe.DTA_DOCUMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ';

  if input[2] <> '' then // Empresa
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND nfe.ID_EMPRESA in (' + VarToStr(Input[2]) +')'+ #13#10;
      end;

   if input[3] <> '' then // Tipo de Estoque
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.id_tipo_mov_estoque in (' + VarToStr(Input[3]) +')'+ #13#10;
      end;

   if input[4] <> '' then // Cfop
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.id_cfo in (' + VarToStr(Input[4]) +')'+ #13#10;
      end;

   if input[5] <> '' then //Modelo
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.modelo in (' + VarToStr(Input[5]) +')'+ #13#10;
      end;

   if (input[8] <> 'C') AND (input[6] <> '') then //Cod. Situao NFE
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.nfe_cod_sit in (' + VarToStr(Input[6]) +')'+ #13#10;
      end;

    if input[7] <> '' then //Cod. Id Emitente
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.id_emitente in (' + VarToStr(Input[7]) +')'+ #13#10;
      end;

    if (input[8] <> 'T') and (input[8] <> 'C') and (input[8] <> '') then
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.TIPO_NF = ''' + VarToStr(Input[8]) +''' ' + #13#10;
      end
    else if (input[8] = 'C') then
      begin
         FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NFE.NFE_COD_SIT = ''02'' ' + #13#10;
      end;

    if (input[9] <> '') then
      begin
        FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
                                    ' AND NIT.id_item in (' + VarToStr(Input[9]) +')'+ #13#10;
      end;

    if Input[10] <> '' then
       begin
          FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
               ' and ite.id_grupo in (' + VarToStr(Input[10]) +') ';
       end;

    if Input[11] <> '' then
        begin
          FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
               ' and nfe.id_almoxarifado in (' + VarToStr(Input[11]) +') ';
        end;

     if Input[12] <> '' then
        begin
          FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
               ' and ite.id_familia in (' + VarToStr(Input[12]) +') ';
        end;

      FAT_SQ_R_NFE_DPI.CommandText := FAT_SQ_R_NFE_DPI.CommandText +
      ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24, '+ #13#10 +
      ' 25,26,27,28,29,30,par.id_empresa '+ #13#10 +
      ' order by par.id_empresa, nfe.dta_emissao, nfe.numero, ite.descricao '+ #13#10;


   //CMServerForm.mm.Lines.Add(FAT_SQ_R_NFE_DPI.CommandText);
   Result := FAT_DP_R_NFE_DPI.Data;
   FAT_SQ_R_NFE_DPI.Close;
end;

function TSM.FAT_DP_R_NFE_TMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelNfeTme: String;
  begin
    Result :=
      ' SELECT NFE.NFE_COD_SIT,tme.descricao as int_nometme, nfe.id_empresa, par.emp_fantasia as int_nomeemp, ' +
      '   SUM(NFE.VLR_LIQUIDO) as vlr_liquido  ' +
      '                                        ' +
      ' FROM FAT_TB_M_NFE NFE                  ' +
      ' left outer join cad_tb_c_par par on par.id_empresa = nfe.id_empresa '+
      '  LEFT OUTER JOIN cad_tb_c_tme tme on   ' +
      '       tme.id_tipo_mov_estoque=nfe.id_tipo_mov_estoque ';

  end;
begin

   {
    input[0]  - 02 - Resumo por Tipo de Movimento de Estoque
    input[1]  - Data ini
    input[2]  - Data fin
    input[3]  - Tipo nota fiscal
    input[4]  - Nro do documento
    input[5]  - Pesquisar por
    input[6]  - empresa
    input[7]  - Tipo de Estoque
    input[8]  - CFOP
    input[9] = Modelo
    input[10] - Cod. Situao NFE
    input[11] - Ordenao
    input[12] - Cod. Id Emitente
    input[14] = 0 - Data de emisso;  1 = Data do documento
   }

   FAT_SQ_R_NFE_TME.Close;


   if input[14] = '0' then
      begin
        FAT_SQ_R_NFE_TME.CommandText := enSqlFatRelNfeTme +
          ' WHERE NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
          '  AND  NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ' +
          '  AND  NFE.TIPO_NF = ''' + VarToStr(Input[3]) +''' ' +
          '  AND  NFE.NUMERO > 0 AND NFE.STATUS = 1 ' ;
      end
   else
      begin
        FAT_SQ_R_NFE_TME.CommandText := enSqlFatRelNfeTme +
          ' WHERE NFE.DTA_DOCUMENTO >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) )  +''' ' +
          '  AND  NFE.DTA_DOCUMENTO <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ' +
          '  AND  NFE.TIPO_NF = ''' + VarToStr(Input[3]) +''' ' +
          '  AND  NFE.NUMERO > 0 AND NFE.STATUS = 1 ' ;
      end;

   if input[4] <> '' then
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.NUMERO = ''' + VarToStr(Input[4]) +''' ';
      end;

   if input[5] <> '' then
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.NFE_ECF = ''' + VarToStr(Input[5]) +''' ';
      end;

   if input[6] <> '' then // Empresa
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[6]) +')';
      end;

   if input[7] <> '' then // Tipo de Estoque
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.id_tipo_mov_estoque in (' + VarToStr(Input[7]) +')';
      end;

   if input[8] <> '' then // Cfop
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.id_cfo in (' + VarToStr(Input[8]) +')';
      end;

   if input[9] <> '' then //Modelo
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.modelo in (' + VarToStr(Input[9]) +')';
      end;

   if input[10] <> '' then //Cod. Situao NFE
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.nfe_cod_sit in (' + VarToStr(Input[10]) +')';
      end;

   if input[12] <> '' then //Cod. Id Emitente
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.id_emitente in (' + VarToStr(Input[12]) +')';
      end;

   if input[13] = '' then
      begin
        FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.serie <> ''X'' ';
      end
   else
    begin
      FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                    ' AND NFE.serie = ''X'' ';
    end;



   FAT_SQ_R_NFE_TME.CommandText := FAT_SQ_R_NFE_TME.CommandText +
                                   ' GROUP BY NFE.NFE_COD_SIT,nfe.id_empresa,par.emp_fantasia,int_nometme ' +
                                   ' ORDER BY NFE.NFE_COD_SIT,nfe.id_empresa,par.emp_fantasia,int_nometme ';

   Result := FAT_DP_R_NFE_TME.Data;
   FAT_SQ_R_NFE_TME.Close;
end;

function TSM.FAT_DP_R_NOT_ROTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlNotRot: String;
begin
  Result := ' SELECT cli.id_cliente, cli.NOME AS INT_CLIENTE '+
            ' FROM cad_tb_c_cli cli '+
            ' left outer join pcp_tb_c_rot rot2 on rot2.id_rota=cli.id_rota ';
end;
begin
  FAT_SQ_R_NOT_ROT.Close;
  FAT_SQ_R_NOT_ROT.CommandText :=' ';

  FAT_SQ_R_NOT_ROT.CommandText :=  enSqlNotRot +
    ' WHERE NOT EXISTS '+
    ' ( select nfe.id_emitente '+
	  ' from fat_tb_m_nfe nfe '+
	  ' left outer join cad_tb_c_fun fun on fun.id_funcionario=nfe.id_vendedor '+
	  ' left outer join pcp_tb_c_rot rot on rot.id_rota=cli.id_rota '+
	  ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo '+
    ' WHERE cli.id_cliente=nfe.id_emitente AND CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
    '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[4]) +') ';
      end;

  FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText + ' ) ';  // fim do "not exists"

  if Input[3] <> '' then
      begin
        FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText  +
             ' AND ROT2.ID_ROTA in (' + VarToStr(Input[3]) +') ';
      end;

  FAT_SQ_R_NOT_ROT.CommandText := FAT_SQ_R_NOT_ROT.CommandText + ' ORDER BY CLI.ID_CLIENTE ';

  Result := FAT_DP_R_NOT_ROT.Data;
end;

function TSM.FAT_DP_R_PCADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPcaRel: String;
  begin
    Result :=
    ' select pca.*, '+
    '     fun.nome as int_nomeres,mta.nome as int_nomemot '+
    ' from fat_tb_m_pca pca '+
    ' left outer join cad_tb_c_fun fun on fun.id_funcionario=pca.id_responsavel '+
    ' left outer join pcp_tb_c_mta mta on mta.id_motorista=pca.id_motorista ';
  end;
begin
   { TODO -oMaxsuel Victor : Criado em 21/11/2018 }
   FAT_SQ_R_PCA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_R_PCA.CommandText := enSqlPcaRel + ' WHERE 1=2 '
        else
           FAT_SQ_R_PCA.CommandText := enSqlPcaRel +
             ' WHERE PCA.ID_CARREGAMENTO = ''' + VarToStr(Input[1]) + ''' ';
      end;
   Result := FAT_DP_R_PCA.Data;
end;

function TSM.FAT_DP_R_PEDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelPed: String;
  begin
    Result :=
        ' SELECT PED.*, CLI.NOME AS INT_NOMECLI, TME.DESCRICAO AS INT_NOMETME, '+
        '       FUN.NOME AS INT_NOMEFUN, CPG.DESCRICAO AS INT_NOMECPG, '+
        '       ATE.NOME AS INT_NOMEATE, RES.NOME AS INT_NOMERES, '+
        '       CID.NOME AS INT_NOMECID, '+
        '       CID.UF AS INT_NOMEEST, CLI.doc_cnpj_cpf AS INT_CPFCNPJ, CLI.pessoa as int_pessoacli, '+
        '       CLI.ID_PERFIL_CLI AS INT_ID_PERFIL, '+
        ' cast( case situacao_aprovacao ' +
        '   when 0 then ''Em espera'' '+
        '   when 1 then ''Aprovado'' ' +
        '   when 2 then ''Reprovado'' ' +
        ' end as varchar(20) ) as int_sitaprov, ' +
        ' cast( case ped.situacao     ' +
        '   when 0 then ''Em aberto'' ' +
        '   when 1 then ''Reprovado'' ' +
        '   when 2 then ''Em produo'' ' +
        '   when 3 then ''Faturado''  ' +
        '   when 4 then ''Cancelado'' ' +
        ' end as varchar(20) ) as int_sitped, '+
        ' cast( case      ' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''' + #13#10 +
        '           when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''' + #13#10 +
        '           when (ped.situacao = 1) then ''Reprovado''' + #13#10 +
        '           when (ped.situacao = 2) then ''Em produo''' + #13#10 +
        '           when (ped.situacao = 3) then ''Faturado''' + #13#10 +
        '           when (ped.situacao = 4) then ''Cancelado''' + #13#10 +
        '         end as varchar(20) ) as int_sitped2, ' +
        ' cast(case ped.mod_frete             '+
        '      when 0 then ''CIF''              '+
        '      when 1 then ''FOB''              '+
        '      else ''---''                     '+
        '   end as varchar(3)) as int_modfrete, '+
        ' cli.doc_ie_identidade as int_ie_rg_cli, ' +
        ' PAR.EMP_FANTASIA AS INT_EMPFANTASIA, NFE.DTA_EMISSAO AS DTA_EMISSAO_NFE, ORS.ID_ORS AS ORDEM_FAT,  '+
        ' case ' +
        '   when sgq_texto_cond_pgto <> '''' then sgq_texto_cond_pgto ' +
        ' else  CPG.DESCRICAO end as int_desc_cond_pag ' +
        ' FROM FAT_TB_M_PED PED '+
        ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = PED.ID_CLIENTE '+
        ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE = PED.ID_TIPO_MOV_ESTOQUE '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=PED.ID_VENDEDOR '+
        ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=PED.ID_CONDICAO_PAG '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN ATE ON ATE.ID_FUNCIONARIO=PED.ID_ATENDENTE '+
        ' LEFT OUTER JOIN CAD_TB_C_FUN RES ON RES.ID_FUNCIONARIO=PED.ID_RESPONSAVEL '+
        ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
        ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=PED.ID_EMPRESA ' +
        ' LEFT OUTER JOIN PCP_TB_M_ORS ORS ON ORS.ID_PEDIDO=PED.ID_PEDIDO ' +
        ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_ORS=ORS.ID_ORS ';
  end;
 var
   CondicaoOrder:String;
   situacao: integer;
begin

  { TODO -oLuan -cCriao :
  Criado em 19/05/2017}
    { Input[0]
        0 - Relatrio Geral
        1 - Relatrio por Situao
      Input[1] - Data inicial
      Input[2] - Data Final
      Input[3] - Ordenao
      Input[4] - Situao
      Input[5] - Empresa
      Input[6] - Vendedor
    }

   FAT_SQ_R_PED.Close;


  if (Input[7] = '0' ) then
     begin
       FAT_SQ_R_PED.CommandText := enSqlRelPed +
          ' WHERE PED.DTA_PEDIDO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+''' '+
            ' AND PED.DTA_PEDIDO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' ';
     end
  else
     begin
       FAT_SQ_R_PED.CommandText := enSqlRelPed +
          ' WHERE NFE.DTA_EMISSAO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+''' '+
            ' AND NFE.DTA_EMISSAO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' ';
     end;

  {if (Input[4] <> '') then
     begin
       FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
           '   AND PED.SITUACAO  in ('+VarToStr(Input[4]) +')';
     end;}

  if (Input[4] <> '') then
     begin
       //situacao := StrToInt(Input[4]) - 1;

       if (Input[9] = 'true') or (Input[10] = 'true') then
          begin
            FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                 '  AND ( ( PED.SITUACAO  in ('+VarToStr(Input[4]) +') ' +
                 '  AND PED.SITUACAO_APROVACAO in (1,0) ) ';

                 // o parentese ')' que est faltando ir ficar no cdigo mais abaixo 
          end
       else 
          begin
             FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                 '  AND ( PED.SITUACAO  in ('+VarToStr(Input[4]) +') ' +
                 '  AND PED.SITUACAO_APROVACAO in (1,0) ) ';
          end;
     end;

   if (Input[9] = 'true') then
     begin
       if (Input[4] <> '') and (Input[10] = 'true') then
           begin
             FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                       '   OR ( PED.SITUACAO  in (0) ' +
                       '        AND PED.SITUACAO_APROVACAO = 0 ) ';
           end
       else
           begin
             if (Input[4] <> '')  then
                 begin
                   FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                             '   OR ( PED.SITUACAO  in (0) ' +
                             '        AND PED.SITUACAO_APROVACAO = 0 ) ) ';
                 end;

             if (Input[10] = 'true') then
                 begin
                   FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                       '   AND ( (PED.SITUACAO  in (0) ' +
                       '   AND PED.SITUACAO_APROVACAO = 0 ) ';
                       // o parentese ')' que est faltando ir ficar no cdigo mais abaixo 
                 end
             else
                begin
                 if (Input[4] = '')  then
                     begin
                       FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                          '   AND (PED.SITUACAO  in (0) ' +
                          '   AND PED.SITUACAO_APROVACAO = 0 ) ';
                     end;
                end;
           end;
     end;

  if (Input[10] = 'true') then
     begin
       if (Input[4] <> '') or (Input[9] = 'true') then
           begin
             FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                 '   OR (  PED.SITUACAO in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 1 ) )';
           end
       else
           begin
             FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
                 '   AND ( PED.SITUACAO in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 1 ) ';
           end
     end;

  if (Input[5] <> '' ) then
     begin
        FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
             ' and PED.ID_EMPRESA IN (' + VarToStr(Input[5]) +') ';
     end;

  if (Input[6] <> '' ) then
     begin
        FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
             ' and PED.ID_VENDEDOR IN (' + VarToStr(Input[6]) +') ';
     end;

  if (Input[8] <> '' ) then
     begin
        FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
             ' and PED.ID_CONDICAO_PAG IN (' + VarToStr(Input[8]) +') ';
     end;

  CondicaoOrder := '';
  if (Input[0] = '1') then
     begin
       //CondicaoOrder := 'PED.SITUACAO,';
       CondicaoOrder := 'int_sitped2, ';
     end;

  if (Input[3] = '0') then
      FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText + ' ORDER BY '+CondicaoOrder+' PED.ID_PEDIDO ';
  if (Input[3] = '1') then
      FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText + ' ORDER BY '+CondicaoOrder+' PED.ID_PEDIDO DESC ';
  if (Input[3] = '2') then
      FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText + ' ORDER BY '+CondicaoOrder+' PED.DTA_PEDIDO ';
  if (Input[3] = '3') then
      FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText + ' ORDER BY '+CondicaoOrder+' PED.DTA_PEDIDO DESC ';

//  CMServerForm.mm.Lines.Add(FAT_SQ_R_PED.CommandText);

  Result := FAT_DP_R_PED.Data;
  FAT_SQ_R_PED.Close;
end;

function TSM.FAT_DP_R_PED_ITE_NFEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelPed: String;
  begin
    // Se usa SGQ
    if input[12] = 'FALSE' then
       begin
          Result :=
            ' select pit.*,   '+

            ' cast( case situacao_aprovacao  '+
            '     when 0 then ''Em espera''    '+
            '     when 1 then ''Aprovado''     '+
            '     when 2 then ''Reprovado''    '+
            '   end as varchar(20) ) as int_sitaprov, '+
            '   cast( case ped.situacao               '+
            '     when 0 then ''Em aberto''             '+
            '     when 1 then ''Reprovado''             '+
            '     when 2 then ''Em produo''           '+
            '     when 3 then ''Faturado''              '+
            '     when 4 then ''Cancelado''             '+
            '   end as varchar(20) ) as int_sitped,     '+
            '   cast( case                              '+
            '     when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''  '+
            '     when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''  '+
            '     when (ped.situacao = 1) then ''Reprovado''                                    '+
            '     when (ped.situacao = 2) then ''Em produo''                                  '+
            '     when (ped.situacao = 3) then ''Faturado''                                    '+
            '     when (ped.situacao = 4) then ''Cancelado''                                   '+
            '       end as varchar(20) ) as int_sitped2,                                       '+

            '   ped.dta_pedido,ped.id_empresa, par.emp_razao as int_nomeemp,                   '+
            '   ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda, '+
            '   cor.descricao as int_nomecor,tam.descricao as int_nometam, ' +
            '   nfe.numero as int_numero,nfe.dta_emissao as int_dta_emissao, '+
            '   cli.nome as int_nomecli,fun.nome as int_nomevnd   from fat_tb_m_ped_ite pit    '+
            '   left outer join cad_tb_c_ite ite on ite.id_item=pit.id_item                    '+
            '   left outer join fat_tb_m_ped ped on ped.id_pedido=pit.id_pedido                '+
            '   left outer join fat_tb_m_nfe nfe on nfe.id_pedido_venda=ped.id_pedido          '+
            '   left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente              '+
            '   left outer join cad_tb_c_fun fun on fun.id_funcionario=ped.id_vendedor         '+
            '   left outer join cad_tb_c_par par on par.id_empresa=ped.id_empresa              '+
            '   left outer join cad_tb_c_cor cor on cor.id_cor=pit.id_cor                      '+
            '   left outer join cad_tb_c_tam tam on tam.id_tamanho=pit.id_tamanho              ';
       end;
    // Se usa SGQ
    if input[12] = 'TRUE' then
       begin
          Result :=
            ' select pit.*,   '+

            ' cast( case situacao_aprovacao  '+
            '     when 0 then ''Em espera''    '+
            '     when 1 then ''Aprovado''     '+
            '     when 2 then ''Reprovado''    '+
            '   end as varchar(20) ) as int_sitaprov, '+
            '   cast( case ped.situacao               '+
            '     when 0 then ''Em aberto''             '+
            '     when 1 then ''Reprovado''             '+
            '     when 2 then ''Em produo''           '+
            '     when 3 then ''Faturado''              '+
            '     when 4 then ''Cancelado''             '+
            '   end as varchar(20) ) as int_sitped,     '+
            '   cast( case                              '+
            '     when (ped.situacao = 0) and (ped.situacao_aprovacao = 0) then ''Digitado''  '+
            '     when (ped.situacao = 0) and (ped.situacao_aprovacao = 1) then ''Aprovado''  '+
            '     when (ped.situacao = 1) then ''Reprovado''                                    '+
            '     when (ped.situacao = 2) then ''Em produo''                                  '+
            '     when (ped.situacao = 3) then ''Faturado''                                    '+
            '     when (ped.situacao = 4) then ''Cancelado''                                   '+
            '       end as varchar(20) ) as int_sitped2,                                       '+

            '   ped.dta_pedido,ped.id_empresa, par.emp_razao as int_nomeemp,                   '+
            '   ite.descricao as int_nomeite,ite.id_und_venda as int_undvenda, '+
            '   cor.descricao as int_nomecor,tam.descricao as int_nometam, ' +
            '   nfe.numero as int_numero,nfe.dta_emissao as int_dta_emissao, '+
            '   cli.nome as int_nomecli,fun.nome as int_nomevnd   from fat_tb_m_ped_ite pit    '+
            '   left outer join cad_tb_c_ite ite on ite.id_item=pit.id_item                    '+
            '   left outer join fat_tb_m_ped ped on ped.id_pedido=pit.id_pedido                '+
            '   left outer join pcp_tb_m_ors ors on ors.id_pedido=ped.id_pedido                '+
            '   left outer join fat_tb_m_nfe nfe on nfe.id_ors=ors.id_ors                      '+
            '   left outer join cad_tb_c_cli cli on cli.id_cliente=ped.id_cliente              '+
            '   left outer join cad_tb_c_fun fun on fun.id_funcionario=ped.id_vendedor         '+
            '   left outer join cad_tb_c_par par on par.id_empresa=ped.id_empresa              '+
            '   left outer join cad_tb_c_cor cor on cor.id_cor=pit.id_cor                      '+
            '   left outer join cad_tb_c_tam tam on tam.id_tamanho=pit.id_tamanho              ';
       end;

  end;
 var
   CondicaoOrder:String;
   situacao: integer;
begin

{ TODO -oLuan -cCriao :
Criado em 19/05/2017}
    { Input[0]
        0 - Relatrio Geral
        1 - Relatrio por Situao
      Input[1] - Data inicial
      Input[2] - Data Final
      Input[3] - Ordenao
      Input[4] - Situao
      Input[5] - Empresa
      Input[6] - Vendedor
    }

   FAT_SQ_R_PED_ITE_NFE.Close;


  if (Input[7] = '0' ) then
     begin
       FAT_SQ_R_PED_ITE_NFE.CommandText := enSqlRelPed +
          ' WHERE PED.DTA_PEDIDO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+''' '+
            ' AND PED.DTA_PEDIDO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' ';
     end
  else
     begin
       FAT_SQ_R_PED_ITE_NFE.CommandText := enSqlRelPed +
          ' WHERE NFE.DTA_EMISSAO>='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+''' '+
            ' AND NFE.DTA_EMISSAO<='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])))+''' ';
     end;

  {if (Input[4] <> '') then
     begin
       FAT_SQ_R_PED.CommandText := FAT_SQ_R_PED.CommandText +
           '   AND PED.SITUACAO  in ('+VarToStr(Input[4]) +')';
     end;}

  {
  if (Input[4] <> '') then
     begin
       // situacao := StrToInt(Input[4]) - 1;

       FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
          '  AND PED.SITUACAO  in ('+VarToStr(Input[4]) +') ';
     end;


  if (Input[10] = 'true') then
     begin
       FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '   AND PED.SITUACAO  in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 0 ';
     end;

  if (Input[11] = 'true') then
     begin
       FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '   AND PED.SITUACAO in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 1 ';
     end;
  }

  if (Input[4] <> '') then
     begin
       //situacao := StrToInt(Input[4]) - 1;

       if (Input[10] = 'true') or (Input[11] = 'true') then
          begin
            FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '  AND ( ( PED.SITUACAO  in ('+VarToStr(Input[4]) +') ' +
                 '  AND PED.SITUACAO_APROVACAO in (1,0) ) ';

                 // o parentese ')' que est faltando ir ficar no cdigo mais abaixo
          end
       else
          begin
             FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '  AND ( PED.SITUACAO  in ('+VarToStr(Input[4]) +') ' +
                 '  AND PED.SITUACAO_APROVACAO in (1,0) ) ';
          end;
     end;

  if (Input[10] = 'true') then
     begin
       if (Input[4] <> '') and (Input[11] = 'true') then
           begin
             FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                       '   OR ( PED.SITUACAO  in (0) ' +
                       '        AND PED.SITUACAO_APROVACAO = 0 ) ';
           end
       else
           begin
             if (Input[4] <> '')  then
                 begin
                   FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                             '   OR ( PED.SITUACAO  in (0) ' +
                             '        AND PED.SITUACAO_APROVACAO = 0 ) ) ';
                 end;

             if (Input[11] = 'true') then
                 begin
                   FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                       '   AND ( (PED.SITUACAO  in (0) ' +
                       '   AND PED.SITUACAO_APROVACAO = 0 ) ';
                       // o parentese ')' que est faltando ir ficar no cdigo mais abaixo
                 end
             else
                begin
                 if (Input[4] = '')  then
                     begin
                       FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                          '   AND (PED.SITUACAO  in (0) ' +
                          '   AND PED.SITUACAO_APROVACAO = 0 ) ';
                     end;
                end;
           end;
     end;

  if (Input[11] = 'true') then
     begin
       if (Input[4] <> '') or (Input[10] = 'true') then
           begin
             FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '   OR (  PED.SITUACAO in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 1 ) )';
           end
       else
           begin
             FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
                 '   AND ( PED.SITUACAO in (0) ' +
                 '   AND PED.SITUACAO_APROVACAO = 1 ) ';
           end
     end;


  if (Input[5] <> '' ) then
     begin
        FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
             ' and PED.ID_EMPRESA IN (' + VarToStr(Input[5]) +') ';
     end;

  if (Input[6] <> '' ) then
     begin
        FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
             ' and PED.ID_VENDEDOR IN (' + VarToStr(Input[6]) +') ';
     end;

  if (Input[8] <> '' ) then
     begin
        FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
             ' and PIT.ID_ITEM IN (' + VarToStr(Input[8]) +') ';
     end;

  if (Input[9] <> '' ) then
     begin
        FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText +
             ' and PED.ID_CONDICAO_PAG IN (' + VarToStr(Input[9]) +') ';
     end;


  CondicaoOrder := 'PED.ID_EMPRESA, ';
  if (Input[0] = '1') then
     begin
       //CondicaoOrder := 'PED.SITUACAO,';
       CondicaoOrder := CondicaoOrder +'int_sitped2, ';
     end;

  if (Input[3] = '0') then
      FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText + ' ORDER BY '+CondicaoOrder+' PED.ID_PEDIDO ';
  if (Input[3] = '1') then
      FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText + ' ORDER BY '+CondicaoOrder+' PED.ID_PEDIDO DESC ';
  if (Input[3] = '2') then
      FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText + ' ORDER BY '+CondicaoOrder+' PED.DTA_PEDIDO ';
  if (Input[3] = '3') then
      FAT_SQ_R_PED_ITE_NFE.CommandText := FAT_SQ_R_PED_ITE_NFE.CommandText + ' ORDER BY '+CondicaoOrder+' PED.DTA_PEDIDO DESC ';

//  CMServerForm.mm.Lines.Add(FAT_SQ_R_PED.CommandText);

  Result := FAT_DP_R_PED_ITE_NFE.Data;
  FAT_SQ_R_PED_ITE_NFE.Close;
end;

function TSM.FAT_DP_R_PIS_CIPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPis, CondicaoOrder,CondicaoGroup: String;
begin

    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPis:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Pis/Cofins
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Produto
                  // 01-Por CST


    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 1)  then
       begin
         enSqlPis :=
            'SELECT '+
            '   NIT.ID_ST_PIS, '+
            '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_LIQUIDO, '+
            '   SUM(COALESCE(NIT.PIS_BASE,0)) AS BASE_PIS, '+
            '   SUM(COALESCE(NIT.PIS_VALOR,0)) AS VALOR_PIS, '+
            '   SUM(COALESCE(NIT.COF_BASE,0)) AS BASE_COFINS, '+
            '   SUM(COALESCE(NIT.COF_VALOR,0)) AS VALOR_COFINS '+
            'FROM FAT_TB_M_NFE_ITE NIT '+
            'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
            'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
            'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
            'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
            'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
            'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
            'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
            'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
            'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
            'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
            CondicaoGroup := 'GROUP BY 1 ';
       end;

    case Input[9] of
       0: CondicaoOrder := 'Order By ITE.DESCRICAO';
       1: CondicaoOrder := 'Order By NIT.ID_ST_PIS ';
    end;


  FAT_SQ_R_PIS_CIP.Close;
  FAT_SQ_R_PIS_CIP.CommandText :='';


  FAT_SQ_R_PIS_CIP.CommandText := enSqlPis +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
          '   AND NFE.nfe_cod_sit = ''00''' + #13#10 +
          '   AND NFE.STATUS = 1 ' + #13#10 +
          '   AND CFO.id_classe in (''SP10'',''SP70'')' + #13#10;


  FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';




  if Input[3] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND NIT.ID_ST_PIS in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;


   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  + CondicaoGroup;
      end;



   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PIS_CIP.CommandText := FAT_SQ_R_PIS_CIP.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PIS_CIP.Data;

end;

function TSM.FAT_DP_R_PIS_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPis, CondicaoOrder,CondicaoGroup: String;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPis:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Pis/Cofins
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Produto
                  // 01-Por CST


    CondicaoOrder := '';
    CondicaoGroup := '';


    if (Input[9] = 0)  then
       begin
         enSqlPis :=
            'SELECT '+
            '   NIT.ID_ST_PIS,NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE, '+
            '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_LIQUIDO, '+
            '   SUM(COALESCE(NIT.PIS_BASE,0)) AS BASE_PIS, '+
            '   SUM(COALESCE(NIT.PIS_VALOR,0)) AS VALOR_PIS, '+
            '   SUM(COALESCE(NIT.COF_BASE,0)) AS BASE_COFINS, '+
            '   SUM(COALESCE(NIT.COF_VALOR,0)) AS VALOR_COFINS '+
            'FROM FAT_TB_M_NFE_ITE NIT '+
            'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
            'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
            'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
            'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
            'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
            'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
            'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
            'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
            'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
            'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
            CondicaoGroup := 'GROUP BY 1,2,3 ';

       end;


    CondicaoOrder := 'Order By NIT.ID_ST_PIS,ITE.DESCRICAO';
    {case Input[9] of
       0: CondicaoOrder := 'Order By ITE.DESCRICAO';
       1: CondicaoOrder := 'Order By NIT.ID_ST_PIS ';
    end;}


  FAT_SQ_R_PIS_ITE.Close;
  FAT_SQ_R_PIS_ITE.CommandText :='';


  FAT_SQ_R_PIS_ITE.CommandText := enSqlPis +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
          '   AND NFE.nfe_cod_sit = ''00''' + #13#10 +
          '   AND NFE.STATUS = 1 ' + #13#10 +
          '   AND CFO.id_classe in (''SP10'',''SP70'')'    + #13#10;

  FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';




  if Input[3] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND NIT.ID_ST_PIS in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;


   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  + CondicaoGroup;
      end;



   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PIS_ITE.CommandText := FAT_SQ_R_PIS_ITE.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PIS_ITE.Data;

end;

function TSM.FAT_DP_R_PIS_NFLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlPis,CondicaoOrder,CondicaoGroup:string;
begin
      { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPis:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Pis/Cofins
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Produto
                  // 01-Por CST


    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 2)  then
       begin
         enSqlPis :=
            ' SELECT '+
            '   NIT.ID_ST_PIS,NFE.ID_FISCAL,NFE.NUMERO,NFE.MODELO,NFE.DTA_EMISSAO,CLI.NOME AS INT_NOMECLI, '+
            '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_LIQUIDO, '+
            '   SUM(COALESCE(NIT.PIS_BASE,0)) AS BASE_PIS, '+
            '   SUM(COALESCE(NIT.PIS_VALOR,0)) AS VALOR_PIS, '+
            '   SUM(COALESCE(NIT.COF_BASE,0)) AS BASE_COFINS, '+
            '   SUM(COALESCE(NIT.COF_VALOR,0)) AS VALOR_COFINS  '+
            '  FROM FAT_TB_M_NFE_ITE NIT  '+
            '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
            '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
            '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE  '+
            '  LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
            '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
            '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
            '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
            '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
            '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR  '+
            '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO ';
              CondicaoGroup := 'GROUP BY 1,2,3,4,5,6 ';
       end;

  CondicaoOrder := ' Order By NIT.ID_ST_PIS,NFE.NUMERO ';


  FAT_SQ_R_PIS_NFL.Close;
  FAT_SQ_R_PIS_NFL.CommandText :='';


  FAT_SQ_R_PIS_NFL.CommandText := enSqlPis +
          ' WHERE NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
          '   AND NFE.nfe_cod_sit = ''00''' + #13#10 +
          '   AND NFE.STATUS = 1 ' + #13#10 +
          '   AND CFO.id_classe in (''SP10'',''SP70'')' + #13#10;


  FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';




  if Input[3] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND NIT.ID_ST_PIS in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;


   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  + CondicaoGroup;
      end;



   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PIS_NFL.CommandText := FAT_SQ_R_PIS_NFL.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PIS_NFL.Data;
end;

function TSM.FAT_DP_R_PIS_RPCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  var enSqlPis, CondicaoOrder,CondicaoGroup: String;
begin
   { TODO -oLuan : Criado em 11/03/2016 }
    enSqlPis:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  CST Pis/Cofins
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Produto
                  // 01-Por CST
                  // 02-Por Nota Fiscal
                  // 03-Resumo PIS/COFINS por CST

    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 3)  then
       begin
         enSqlPis :=

           ' SELECT NFE.id_empresa, '+
           ' NFE.nfe_cod_sit AS Situacao, '+
           ' NFI.id_st_pis as CST_PIS, '+
           ' NFI.pis_aliquota as AliPis, '+
           ' NFI.id_st_cof as CST_COF, '+
           ' NFI.cof_aliquota as AliCoF, '+
           ' par.emp_razao, '+
           ' par.emp_fantasia, '+
           ' sum( NFI.vlr_liquido ) Total_Operacao, '+
           ' sum( NFI.pis_base) as PisBase, '+
           ' sum( NFI.pis_valor) as PisValor, '+
           ' sum( NFI.Cof_base) as CofBase, '+
           ' sum( NFI.Cof_valor) as CofValor '+
           ' FROM fat_tb_m_nfe_ite NFI '+
           ' LEFT OUTER JOIN fat_tb_m_nfe NFE ON NFE.id_fiscal=NFI.id_fiscal '+
           ' LEFT OUTER JOIN cad_tb_c_ite ite ON ite.id_item=NFI.id_item '+
           ' LEFT OUTER JOIN cad_tb_c_par par ON par.id_empresa=NFE.id_empresa '+
           '  where ' +
           '    NFE.NFE_COD_SIT = ''00'' '+
           '    AND NFE.STATUS = 1 '+
           '    AND NFE.FATURADA = true ';
           CondicaoGroup := ' group by 1,2,3,4,5,6,7,8 ';
           CondicaoOrder := ' order by 1,4 ';
       end;


    FAT_SQ_R_PIS_RPC.CommandText := enSqlPis +
           ' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';


     FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';




  if Input[3] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND NIT.ID_ST_PIS in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;


   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  + CondicaoGroup;
      end;



   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PIS_RPC.CommandText := FAT_SQ_R_PIS_RPC.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PIS_RPC.Data;


end;

function TSM.FAT_DP_R_POSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatPos: String;
  begin
    Result :=
      ' select pos.*,par.emp_fantasia as int_empfantasia,par.emp_razao as int_emprazao,cli.nome as int_nomecli, '+
      ' fun.nome as int_nomeresp from fat_tb_m_pos pos '+
      ' left outer join cad_tb_c_cli cli on cli.id_cliente=pos.id_cliente                   '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=pos.id_responsavel           '+
      ' left outer join cad_tb_c_par par on par.id_empresa=pos.id_empresa ';
    end;
begin

  FAT_SQ_R_POS.CommandText := enSqlFatPos +
           ' WHERE POS.DTA_POSVENDA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
           '     POS.DTA_POSVENDA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND '+
           '     POS.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';

  if Input[4] <> '' then
     FAT_SQ_R_POS.CommandText := FAT_SQ_R_POS.CommandText  +
             ' AND POS.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';

  if Input[0]=0 then
     FAT_SQ_R_POS.CommandText := FAT_SQ_R_POS.CommandText  +
             ' ORDER BY POS.ID_EMPRESA,INT_NOMECLI,POS.DTA_POSVENDA ';

  if Input[0]=1 then
     FAT_SQ_R_POS.CommandText := FAT_SQ_R_POS.CommandText  +
             ' ORDER BY POS.ID_EMPRESA,POS.DTA_POSVENDA,INT_NOMECLI ';

  Result := FAT_DP_R_POS.Data;

  FAT_SQ_R_POS.Close;
end;

function TSM.FAT_DP_R_PVE_01DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
enSqlPve, CondicaoOrder, CondicaoGroup,codQuebra: String;
nQuebra,i:integer;
ListaCodGrupo:TStringList;
begin
     { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo
                  // 13-Vendas por Perfil e Regiao

    CondicaoOrder := '';


   { if (Input[10] = 0) or (Input[10] = 1) or (Input[10] = 3) or (Input[10] = 4) or
       (Input[10] = 7) or (Input[10] = 13) OR (Input[10] = 14) then
       begin }

  {  if (Input[10] = '010200') or (Input[10] = '010800') or (Input[10] = '010300') or (Input[10] = '010100') or
       (Input[10] = '010700') or (Input[10] = '010701') OR (Input[10] = '010000') then
       begin }
         enSqlPve :=
           'SELECT ';
           if  Input[15] = '1'  then
             enSqlPve :=  enSqlPve +
               '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
               '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
           else
             enSqlPve :=  enSqlPve +
               '   0 as INT_ID_EMPRESA, '+
               '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';


         enSqlPve :=  enSqlPve +
           '   NFE.NUMERO, NFE.ID_PEDIDO_VENDA, NFE.DTA_EMISSAO, '+
           '   NFE.ID_CONDICAO_PAG,CPG.DESCRICAO AS INT_NOMECPG, '+
           '   NFE.ID_VENDEDOR,    FUC.NOME AS INT_NOMEVND, '+
           '   NFE.ID_EMITENTE,    CLI.NOME AS INT_NOMECLI, '+
           '   CLI.ID_PERFIL_CLI,  PEC.DESCRICAO AS INT_NOMEPEC, '+
           '   CLI.ID_REGIAO, REG.DESCRICAO AS INT_NOMEREG, '+
           '   CLI.ID_ROTA, ROT.DESCRICAO AS INT_NOMEROT, '+
           '   CID.UF AS ESTADO, '+
           '   CID.NOME||''-''||CID.UF AS INT_NOMECIDADE ';


           {'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV ';}

          nQuebra := 1;
          while nQuebra<=2 do
            begin
              codQuebra := copy(Input[12],3+2*(nQuebra-1),2);

              if codQuebra='00' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST('''' AS VARCHAR(20))  AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(NFE.DTA_EMISSAO AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

              if codQuebra='01' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(CID.NOME||''-''||CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

              if codQuebra='02' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(NFE.ID_EMITENTE  AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(CLI.NOME,'' INDEFINIDO'' )AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

              if codQuebra='03' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(NFE.ID_CONDICAO_PAG AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(CPG.DESCRICAO,'' INDEFINIDO'' ) AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

              if codQuebra='04' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='05' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(FOC.ID_FORNECEDOR AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(FOC.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='06' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(GRU.ID_GRUPO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(GRU.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='07' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(ITE.ID_ITEM AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(ITE.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='08' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(PEC.ID_PERFIL_CLI AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(PEC.DESCRICAO,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='09' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(FUC.ID_FUNCIONARIO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(FUC.NOME, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='11' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(CLI.ID_ROTA AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(ROT.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;

               if codQuebra='12' then
                begin
                  enSqlPve := enSqlPve +
                   ' , CAST(MEC.ID_FUNCIONARIO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
                  enSqlPve := enSqlPve +
                   ' , CAST(COALESCE(MEC.NOME, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
                end;



              inc(nQuebra);
            end;



         enSqlPve := enSqlPve +
           ',  SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+

           ' FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:= 'GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23 ';

     //  end;


           { case Input[10] of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME;ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO;CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO;ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end;   }

           { case AnsiIndexStr(VarToStr(Input[10]), ['010200','010800','010500','010300','010100', '010601',
                                           '010400','010700','010101','010600','010401','0001','0000','010701','010000'])  of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end; }
             CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,INT_DESCQUEBRA1,INT_DESCQUEBRA2,NFE.DTA_EMISSAO ';

  FAT_SQ_R_PVE_01.Close;
  FAT_SQ_R_PVE_01.CommandText :='';


  FAT_SQ_R_PVE_01.CommandText := enSqlPve +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
          '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;
  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;
   if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;





   if Input[16] <> '' then
      begin
         FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
            ' AND ( ';

          ListaCodGrupo := TStringList.Create;
          LIstaCodGrupo.Delimiter:=',';
          LIstaCodGrupo.StrictDelimiter:=True;
          ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

          for i := 0 to ListaCodGrupo.Count-1 do
            begin
              if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                begin
                    FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                end
              else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                begin
                    FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                end
              else
                begin
                   FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
                      ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                end;

              if i < (ListaCodGrupo.Count-1) then
                FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText + ' OR ';
            end;

         FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText + ' ) ';

      end;

   if Input[17] <> '' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  +
             ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_01.CommandText := FAT_SQ_R_PVE_01.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PVE_01.Data;



end;

function TSM.FAT_DP_R_PVE_02DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
 enSqlPve, CondicaoOrder, CondicaoGroup: String;
 ListaCodGrupo:TStringList;
 i:Integer;
begin
     { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Regiao
    //  Input[10]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo


    CondicaoOrder := '';


    {if (Input[10] = 2) or (Input[10] = 5) or (Input[10] = 6) then
       begin }
    { if (Input[10] = '010500') or (Input[10] = '010601') or (Input[10] = '010400') then
       begin }
      if (Input[12] = '010600') or (Input[12] = '010700') or (Input[12] = '010500') then
       begin
         enSqlPve :=
           'SELECT ';

         if  Input[15] = '1'  then
           enSqlPve :=  enSqlPve +
             '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
             '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
         else
           enSqlPve :=  enSqlPve +
             '   0 as INT_ID_EMPRESA, '+
             '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';


         enSqlPve :=  enSqlPve +
           '   NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE, '+
           '   ITE.ID_UND_VENDA, '+
           '   GRU.ID_GRUPO, '+
           '   GRU.DESCRICAO AS INT_NOMEGRU, '+
           '   ITE.ID_FORNECEDOR, '+
           '   FOC.DESCRICAO AS INT_NOMEFOR, '+
           '   GRU.TIPO_ITEM, '+
           '   CASE '+
           '     WHEN GRU.TIPO_ITEM = '''+'00'+''' THEN '''+'MERCADORIA PARA REVENDA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'01'+''' THEN '''+'MATERIA PRIMA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'02'+''' THEN '''+'EMBALAGEM'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'03'+''' THEN '''+'PRODUTO EM PROCESSO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'04'+''' THEN '''+'PRODUTO ACABADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'05'+''' THEN '''+'SUBPRODUTO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'06'+''' THEN '''+'PRODUTO INTERMEDIARIO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'07'+''' THEN '''+'MATERIAL DE USO E CONSUMO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'08'+''' THEN '''+'ATIVO IMOBILIZADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'09'+''' THEN '''+'SERVICOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'10'+''' THEN '''+'OUTROS INSUMOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'99'+''' THEN '''+'OUTROS'+''' '+
           '   END AS INT_NOMETIP, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:='GROUP BY 1,2,3,4,5,6,7,8,9,10,11 ';
       end;





          {  case Input[10] of
              0: CondicaoOrder := ' ORDER BY CPG.DESCRICAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,ITE.DESCRICAO ';
              2: CondicaoOrder := ' ORDER BY GRU.ID_GRUPO,INT_NOMEITE ';
              3: CondicaoOrder := ' ORDER BY CID.UF ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY PEC.DESCRICAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME;ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO;CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO;ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
           end;  }

           {case AnsiIndexStr(VarToStr(Input[10]), ['010200','010800','010500','010300','010100', '010601',
                                           '010400','010700','010101','010600','010401','0001','0000','010701','010000'])  of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end; }

            case AnsiIndexStr(VarToStr(Input[12]), ['010600','010700','010500'])  of
                  0: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,GRU.DESCRICAO ';
                  1: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,ITE.DESCRICAO ';
                  2: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,FOC.DESCRICAO ';
           end;


  FAT_SQ_R_PVE_02.Close;
  FAT_SQ_R_PVE_02.CommandText :='';


  FAT_SQ_R_PVE_02.CommandText := enSqlPve +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
          '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

  if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

  if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

  if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

  if Input[16] <> '' then
      begin
         FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
            ' AND ( ';

          ListaCodGrupo := TStringList.Create;
          LIstaCodGrupo.Delimiter:=',';
          LIstaCodGrupo.StrictDelimiter:=True;
          ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

          for i := 0 to ListaCodGrupo.Count-1 do
            begin
              if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                begin
                    FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                end
              else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                begin
                    FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                end
              else
                begin
                   FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
                      ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                end;

              if i < (ListaCodGrupo.Count-1) then
                FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText + ' OR ';
            end;

         FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText + ' ) ';

      end;

   if Input[17] <> '' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  +
             ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
      end;


   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_02.CommandText := FAT_SQ_R_PVE_02.CommandText  + CondicaoOrder;
      end;


   Result := FAT_DP_R_PVE_02.Data;
end;

function TSM.FAT_DP_R_PVE_03DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPve, CondicaoOrder, CondicaoGroup: String;
  i:Integer;
  ListaCodGrupo:TStringList;

begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Regiao
    //  Input[10]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo


    CondicaoOrder := '';


    {if (Input[10] = 8) or (Input[10] = 9) then
       begin  }
    {if (Input[10] = '010101') or (Input[10] = '010600') then
       begin  }
    if (Input[12] = '010207') or (Input[12] = '010702') then
       begin
        enSqlPve :=
           'SELECT ';

        if  Input[15] = '1'  then
          enSqlPve :=  enSqlPve +
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
        else
           enSqlPve :=  enSqlPve +
           '   0 as INT_ID_EMPRESA, '+
           '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

        enSqlPve :=  enSqlPve +
           '   NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE, '+
           '   ITE.ID_UND_VENDA, '+
           '   GRU.ID_GRUPO, '+
           '   GRU.DESCRICAO AS INT_NOMEGRU, '+
           '   ITE.ID_FORNECEDOR, '+
           '   FOC.DESCRICAO AS INT_NOMEFOR, '+
           '   GRU.TIPO_ITEM, '+
           '   CASE '+
           '     WHEN GRU.TIPO_ITEM = '''+'00'+''' THEN '''+'MERCADORIA PARA REVENDA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'01'+''' THEN '''+'MATERIA PRIMA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'02'+''' THEN '''+'EMBALAGEM'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'03'+''' THEN '''+'PRODUTO EM PROCESSO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'04'+''' THEN '''+'PRODUTO ACABADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'05'+''' THEN '''+'SUBPRODUTO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'06'+''' THEN '''+'PRODUTO INTERMEDIARIO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'07'+''' THEN '''+'MATERIAL DE USO E CONSUMO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'08'+''' THEN '''+'ATIVO IMOBILIZADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'09'+''' THEN '''+'SERVICOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'10'+''' THEN '''+'OUTROS INSUMOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'99'+''' THEN '''+'OUTROS'+''' '+
           '   END AS INT_NOMETIP, '+
           '   NFE.ID_EMITENTE,    CLI.NOME AS INT_NOMECLI, '+
           '   CID.UF, CID.NOME AS INT_NOMECID, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
          // '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
          '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA  '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:='GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ';


       end;


     {if (Input[10] = 10) then
       begin }
     {if (Input[10] = '010401') then
       begin }
     if (Input[12] = '010507') then
       begin
         enSqlPve :=
           'SELECT ';

         if  Input[15] = '1'  then
           enSqlPve :=  enSqlPve +
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
         else
           enSqlPve :=  enSqlPve +
           '   0 as INT_ID_EMPRESA, '+
           '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

         enSqlPve :=  enSqlPve +
           '   NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE, '+
           '   ITE.ID_UND_VENDA, '+
           '   GRU.ID_GRUPO, '+
           '   GRU.DESCRICAO AS INT_NOMEGRU, '+
           '   ITE.ID_FORNECEDOR, '+
           '   FOC.DESCRICAO AS INT_NOMEFOR, '+
           '   GRU.TIPO_ITEM, '+
           '   CASE '+
           '     WHEN GRU.TIPO_ITEM = '''+'00'+''' THEN '''+'MERCADORIA PARA REVENDA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'01'+''' THEN '''+'MATERIA PRIMA'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'02'+''' THEN '''+'EMBALAGEM'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'03'+''' THEN '''+'PRODUTO EM PROCESSO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'04'+''' THEN '''+'PRODUTO ACABADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'05'+''' THEN '''+'SUBPRODUTO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'06'+''' THEN '''+'PRODUTO INTERMEDIARIO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'07'+''' THEN '''+'MATERIAL DE USO E CONSUMO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'08'+''' THEN '''+'ATIVO IMOBILIZADO'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'09'+''' THEN '''+'SERVICOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'10'+''' THEN '''+'OUTROS INSUMOS'+''' '+
           '     WHEN GRU.TIPO_ITEM = '''+'99'+''' THEN '''+'OUTROS'+''' '+
           '   END AS INT_NOMETIP, '+

           '   CAST(0  AS INTEGER) AS ID_EMITENTE, '+
           '   CAST(''0'' AS VARCHAR(50)) AS INT_NOMECLI, '+
           '   CAST(''0'' AS VARCHAR(2)) AS UF, '+
           '   CAST(''0'' AS VARCHAR(60)) AS INT_NOMECID, '+

           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA  '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:='GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ';

       end;







           { case Input[10] of
              0: CondicaoOrder := ' ORDER BY CPG.DESCRICAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY CID.UF ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY PEC.DESCRICAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
           end;  }

          {  case AnsiIndexStr(VarToStr(Input[10]), ['010200','010800','010500','010300','010100', '010601',
                                           '010400','010700','010101','010600','010401','0001','0000','010701','010000'])  of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end; }

            case AnsiIndexStr(VarToStr(Input[12]), ['010207','010702','010507'])  of
                 0: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,INT_NOMECLI,INT_NOMEITE ';
                 1: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,ITE.DESCRICAO,CLI.NOME ';
                 2: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,FOC.DESCRICAO,ITE.DESCRICAO ';
           end;


  FAT_SQ_R_PVE_03.Close;
  FAT_SQ_R_PVE_03.CommandText :='';


  FAT_SQ_R_PVE_03.CommandText := enSqlPve +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
          '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

   if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

  if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

  if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;


   if Input[16] <> '' then
      begin
         FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
            ' AND ( ';

          ListaCodGrupo := TStringList.Create;
          LIstaCodGrupo.Delimiter:=',';
          LIstaCodGrupo.StrictDelimiter:=True;
          ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

          for i := 0 to ListaCodGrupo.Count-1 do
            begin
              if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                begin
                    FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                end
              else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                begin
                    FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                end
              else
                begin
                   FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
                      ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                end;

              if i < (ListaCodGrupo.Count-1) then
                FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText + ' OR ';
            end;

         FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText + ' ) ';

      end;

   if Input[17] <> '' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  +
             ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_03.CommandText := FAT_SQ_R_PVE_03.CommandText  + CondicaoOrder;
      end;

   //CMServerForm.mm.Clear;
   //CMServerForm.mm.Lines.Add(FAT_SQ_R_PVE_03.CommandText);


   Result := FAT_DP_R_PVE_03.Data;

end;

function TSM.FAT_DP_R_PVE_04DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPve, CondicaoOrder, CondicaoGroup: String;
  i:Integer;
  ListaCodGrupo:TStringList;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Regiao
    //  Input[10]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo


    CondicaoOrder := '';


    {if (Input[10] = 11) then
       begin }
    {if (Input[10] = '0001') then
       begin  }
     if (Input[12] = '020200') then
       begin
         enSqlPve :=
           'SELECT ';

         if  Input[15] = '1'  then
           enSqlPve :=  enSqlPve +
            '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
            '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
         else
           enSqlPve :=  enSqlPve +
            '   0 as INT_ID_EMPRESA, '+
            '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

         enSqlPve :=  enSqlPve +
           '   NFE.ID_VENDEDOR, FUC.NOME AS INT_NOMEVND, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO  ' +
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';

           CondicaoGroup:='GROUP BY 1,2,3,4 ';
       end;



   { case Input[10] of
      0: CondicaoOrder := ' ORDER BY CPG.DESCRICAO ';
      1: CondicaoOrder := ' ORDER BY FUC.NOME ';
      2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
      3: CondicaoOrder := ' ORDER BY CID.UF ';
      4: CondicaoOrder := ' ORDER BY CLI.NOME ';
      5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
      6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
      7: CondicaoOrder := ' ORDER BY PEC.DESCRICAO ';
      8: CondicaoOrder := ' ORDER BY CLI.NOME;ITE.DESCRICAO ';
      9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO;CLI.NOME ';
     10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO;ITE.DESCRICAO ';
     11: CondicaoOrder := ' ORDER BY FUC.NOME ';
     12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
    end;  }

    { case AnsiIndexStr(VarToStr(Input[10]), ['010200','010800','010500','010300','010100', '010601',
                                           '010400','010700','010101','010600','010401','0001','0000','010701','010000'])  of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
                 11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end; }

        case AnsiIndexStr(VarToStr(Input[12]), ['020200'])  of
              0: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,FUC.NOME ';
           end;


    FAT_SQ_R_PVE_04.Close;
    FAT_SQ_R_PVE_04.CommandText :='';


    FAT_SQ_R_PVE_04.CommandText := enSqlPve +
            ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
            '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

    FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText +
     ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
     '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
        end;

    if Input[8] <> '' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
               ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
        end;

    if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

    if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

    if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

    if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

   if Input[16] <> '' then
      begin
         FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
            ' AND ( ';

          ListaCodGrupo := TStringList.Create;
          LIstaCodGrupo.Delimiter:=',';
          LIstaCodGrupo.StrictDelimiter:=True;
          ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

          for i := 0 to ListaCodGrupo.Count-1 do
            begin
              if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                begin
                    FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                end
              else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                begin
                    FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                end
              else
                begin
                   FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
                      ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                end;

              if i < (ListaCodGrupo.Count-1) then
                FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText + ' OR ';
            end;

         FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText + ' ) ';

      end;

   if Input[17] <> '' then
      begin
        FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  +
             ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
      end;

     if CondicaoGroup<>'' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  + CondicaoGroup;
        end;

     if CondicaoOrder<>'' then
        begin
          FAT_SQ_R_PVE_04.CommandText := FAT_SQ_R_PVE_04.CommandText  + CondicaoOrder;
        end;


     Result := FAT_DP_R_PVE_04.Data;

end;

function TSM.FAT_DP_R_PVE_05DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPve, CondicaoOrder, CondicaoGroup: String;
    i:Integer;
    ListaCodGrupo:TStringList;
begin
    { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }
    FAT_SQ_R_PVE_05.Close;
    FAT_SQ_R_PVE_05.CommandText :='';
    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Regiao
    //  Input[10]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo


    CondicaoOrder := '';


   { if (Input[10] = 12) then
       begin  }
    { if (Input[10] = '0000') then
       begin  }
     if (Input[12] = '020100') then
       begin
          enSqlPve :=   'SELECT ';
           if  Input[15] = '1'  then
             enSqlPve :=  enSqlPve +
               '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
               '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
           else
             enSqlPve :=  enSqlPve +
               '   0 as INT_ID_EMPRESA, '+
               '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';



         enSqlPve :=   enSqlPve +

          '   COALESCE(GR1.ID_GRUPO,'' INDEFINIDO'') as ID_GRUPO_N1,COALESCE(GR1.DESCRICAO,'' INDEFINIDO'') AS INT_NOMEGRU_N1, '+
          '   COALESCE(GR2.ID_GRUPO,'' INDEFINIDO'') as ID_GRUPO_N2, '+
          '        COALESCE(GR2.DESCRICAO,'' INDEFINIDO'') AS INT_NOMEGRU_N2, '+
          '        ITE.ID_GRUPO, GRU.DESCRICAO AS INT_NOMEGRU, '+
          '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
          '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
          '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO  ' +
          //   '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+

          ' FROM FAT_TB_M_NFE_ITE NIT '+
          ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL  '+
          ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
          ' LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
          ' LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
          ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
          ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
          ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
          ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
          '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
          '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
          '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
          '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
          '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+

          '  LEFT OUTER JOIN CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
          '                                      GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' '+

          '  LEFT OUTER JOIN CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or '+
          '                                      GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4)||''.000'' '+
          '  LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
          '  LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
          CondicaoGroup := '  GROUP BY 1,2,3,4,5,6,7,8 ';

       end;



   { case Input[10] of
      0: CondicaoOrder := ' ORDER BY CPG.DESCRICAO ';
      1: CondicaoOrder := ' ORDER BY FUC.NOME ';
      2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
      3: CondicaoOrder := ' ORDER BY CID.UF ';
      4: CondicaoOrder := ' ORDER BY CLI.NOME ';
      5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
      6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
      7: CondicaoOrder := ' ORDER BY PEC.DESCRICAO ';
      8: CondicaoOrder := ' ORDER BY CLI.NOME;ITE.DESCRICAO ';
      9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO;CLI.NOME ';
     10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO;ITE.DESCRICAO ';
     11: CondicaoOrder := ' ORDER BY FUC.NOME ';
     12: CondicaoOrder := ' ORDER BY ITE.ID_GRUPO ';
    end; }

    { case AnsiIndexStr(VarToStr(Input[10]), ['010200','010800','010500','010300','010100', '010601',
                                           '010400','010700','010101','010600','010401','0001','0000','010701','010000'])  of
              0: CondicaoOrder := ' ORDER BY NFE.ID_CONDICAO_PAG,NFE.DTA_EMISSAO ';
              1: CondicaoOrder := ' ORDER BY FUC.NOME,NFE.DTA_EMISSAO ';
              2: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
              3: CondicaoOrder := ' ORDER BY ESTADO,NFE.DTA_EMISSAO ';
              4: CondicaoOrder := ' ORDER BY CLI.NOME,NFE.DTA_EMISSAO ';
              5: CondicaoOrder := ' ORDER BY ITE.DESCRICAO ';
              6: CondicaoOrder := ' ORDER BY FOC.DESCRICAO ';
              7: CondicaoOrder := ' ORDER BY INT_NOMEPEC,NFE.DTA_EMISSAO ';
              8: CondicaoOrder := ' ORDER BY CLI.NOME,ITE.DESCRICAO ';
              9: CondicaoOrder := ' ORDER BY ITE.DESCRICAO,CLI.NOME ';
             10: CondicaoOrder := ' ORDER BY FOC.DESCRICAO,ITE.DESCRICAO ';
             11: CondicaoOrder := ' ORDER BY FUC.NOME ';
             12: CondicaoOrder := ' ORDER BY GRU.DESCRICAO ';
             13: CondicaoOrder := ' ORDER BY INT_NOMEPEC,INT_NOMEREG,NFE.DTA_EMISSAO ';
             14: CondicaoOrder := ' ORDER BY INT_NOMECIDADE,NFE.DTA_EMISSAO ';
           end; }

      case AnsiIndexStr(VarToStr(Input[12]), ['020100'])  of

                0: CondicaoOrder :=  ' order by  INT_ID_EMPRESA,ID_GRUPO_N1,ID_GRUPO_N2,ITE.ID_GRUPO ';

           end;



    FAT_SQ_R_PVE_05.CommandText :=  enSqlPve;

    FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText +
            ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
            '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

    FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText +
     ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
     '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
        end;

    if Input[8] <> '' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
               ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
        end;

    if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

    if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;


    if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND ITE2.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

    if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;


   if Input[16] <> '' then
      begin
         FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
            ' AND ( ';

          ListaCodGrupo := TStringList.Create;
          LIstaCodGrupo.Delimiter:=',';
          LIstaCodGrupo.StrictDelimiter:=True;
          ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

          for i := 0 to ListaCodGrupo.Count-1 do
            begin
              if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                begin
                    FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                end
              else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                begin
                    FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
                      ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                      '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                end
              else
                begin
                   FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
                      ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                end;

              if i < (ListaCodGrupo.Count-1) then
                FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText + ' OR ';
            end;

         FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText + ' ) ';

      end;

   if Input[17] <> '' then
      begin
        FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  +
             ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
      end;


     if CondicaoGroup<>'' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  + CondicaoGroup;
        end;

     if CondicaoOrder<>'' then
        begin
          FAT_SQ_R_PVE_05.CommandText := FAT_SQ_R_PVE_05.CommandText  + CondicaoOrder;
        end;


     Result := FAT_DP_R_PVE_05.Data;

end;

function TSM.FAT_DP_R_PVE_06DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  var enSqlPve, CondicaoOrder, CondicaoGroup,codQuebra: String;
  nQuebra,i:integer;
  ListaCodGrupo:TStringList;

begin

          enSqlPve :=
             'SELECT ';

          if  Input[15] = '1'  then
            enSqlPve :=  enSqlPve +
             '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
             '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
          else
             enSqlPve :=  enSqlPve +
             '   0 as INT_ID_EMPRESA, '+
             '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

          enSqlPve :=  enSqlPve +
               ' NFE.ID_FISCAL,NFE.NUMERO,NFE.DTA_EMISSAO,NFE.ID_VENDEDOR,FUC.NOME AS INT_NOMEVND,NIT.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE,         '+
               ' ITE.ID_UND_VENDA,                                                '+
               ' GRU.ID_GRUPO,                                                    '+
               ' GRU.DESCRICAO AS INT_NOMEGRU,                                    '+
               ' ITE.ID_FORNECEDOR,                                               '+
               ' FOC.DESCRICAO AS INT_NOMEFOR,                                    '+
               ' GRU.TIPO_ITEM,                                                   '+
               ' CASE                                                             '+
               '  WHEN GRU.TIPO_ITEM = ''00'' THEN ''MERCADORIA PARA REVENDA''    '+
               '  WHEN GRU.TIPO_ITEM = ''01'' THEN ''MATERIA PRIMA''              '+
               '  WHEN GRU.TIPO_ITEM = ''02'' THEN ''EMBALAGEM''                  '+
               '  WHEN GRU.TIPO_ITEM = ''03'' THEN ''PRODUTO EM PROCESSO''        '+
               '  WHEN GRU.TIPO_ITEM = ''04'' THEN ''PRODUTO ACABADO''            '+
               '  WHEN GRU.TIPO_ITEM = ''05'' THEN ''SUBPRODUTO''                 '+
               '  WHEN GRU.TIPO_ITEM = ''06'' THEN ''PRODUTO INTERMEDIARIO''      '+
               '  WHEN GRU.TIPO_ITEM = ''07'' THEN ''MATERIAL DE USO E CONSUMO''  '+
               '  WHEN GRU.TIPO_ITEM = ''08'' THEN ''ATIVO IMOBILIZADO''          '+
               '  WHEN GRU.TIPO_ITEM = ''09'' THEN ''SERVICOS''                   '+
               '  WHEN GRU.TIPO_ITEM = ''10'' THEN ''OUTROS INSUMOS''             '+
               '  WHEN GRU.TIPO_ITEM = ''99'' THEN ''OUTROS''                     '+
               ' END AS INT_NOMETIP,                                              '+
               '  NFE.ID_EMITENTE, CLI.NOME AS INT_NOMECLI,                       '+
               ' CID.UF, CID.NOME AS INT_NOMECID                                 ';


          nQuebra := 1;
          codQuebra := copy(Input[12],3,2);

          if codQuebra='01' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(CID.NOME||''-''||CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

          if codQuebra='02' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(NFE.ID_EMITENTE  AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(CLI.NOME,'' INDEFINIDO'' )AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

          if codQuebra='03' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(NFE.ID_CONDICAO_PAG AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(CPG.DESCRICAO,'' INDEFINIDO'' ) AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

          if codQuebra='04' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

           if codQuebra='05' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(FOC.ID_FORNECEDOR AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(FOC.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

           if codQuebra='06' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(GRU.ID_GRUPO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(GRU.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

           if codQuebra='07' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(ITE.ID_ITEM AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(ITE.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

           if codQuebra='08' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(PEC.ID_PERFIL_CLI AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(PEC.DESCRICAO,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;

           if codQuebra='09' then
            begin
              enSqlPve := enSqlPve +
               ' , CAST(FUC.ID_FUNCIONARIO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
              enSqlPve := enSqlPve +
               ' , CAST(COALESCE(FUC.NOME, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
            end;


           enSqlPve := enSqlPve +

             ' ,SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
             ' SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO,                            '+
             //' SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
             '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM( (case when nit.qtde>0 then (COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE) else 0 end) *(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
             ' SUM(NIT.QTDE) AS QTDE,                                                        '+
             ' SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV                                           '+
             '  FROM FAT_TB_M_NFE_ITE NIT                                                    '+
             '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL              '+
             '  LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
             '  LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO       '+
             '  LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA            '+
             '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR       '+
             '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE           '+
             '  LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE              '+
             '  LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
             '  LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM                         '+
             '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                           '+
             '  LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG         '+
             '  LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI             '+
             '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR             '+
             '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO                       '+
             '  LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
             '  LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO                     ';



          FAT_SQ_R_PVE_06.Close;
          FAT_SQ_R_PVE_06.CommandText :='';


          FAT_SQ_R_PVE_06.CommandText := enSqlPve +
                  ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
                  '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

          FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText +
           ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
           '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

          if Input[3] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
              end;

          if Input[4] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
              end;

          if Input[5] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
              end;

          if Input[6] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
              end;

          if Input[7] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
              end;

          if Input[8] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
              end;

          if Input[9] <> '' then
              begin
                FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                     ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
              end;

          if Input[10] <> '' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
            end;

          if Input[11] <> '' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
            end;

          if Input[13] <> '' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
            end;

         if Input[14] = '0' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND NFE.ID_ORDEM > 0 ';
            end;

         if Input[14] = '2' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
            end;

         if Input[16] <> '' then
            begin
               FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                  ' AND ( ';

                ListaCodGrupo := TStringList.Create;
                LIstaCodGrupo.Delimiter:=',';
                LIstaCodGrupo.StrictDelimiter:=True;
                ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

                for i := 0 to ListaCodGrupo.Count-1 do
                  begin
                    if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                      begin
                          FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                            ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                            '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                      end
                    else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                      begin
                          FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                            ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                            '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                      end
                    else
                      begin
                         FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                            ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                      end;

                    if i < (ListaCodGrupo.Count-1) then
                      FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText + ' OR ';
                  end;

               FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText + ' ) ';

            end;

         if Input[17] <> '' then
            begin
              FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
                   ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
            end;

          FAT_SQ_R_PVE_06.CommandText := FAT_SQ_R_PVE_06.CommandText  +
             '  GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20               '+
             '  ORDER BY INT_ID_EMPRESA,INT_DESCQUEBRA1,NFE.DTA_EMISSAO,INT_NOMEITE           ';

           Result := FAT_DP_R_PVE_06.Data;


end;

function TSM.FAT_DP_R_PVE_07DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  CondicaoOrder,CondicaoGroup,enSqlPve:String;
begin

     if (Input[11] = '020300') then
       begin
         enSqlPve :=
           'SELECT ';

         if  Input[14] = '1'  then
          enSqlPve :=  enSqlPve +
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
         else
           enSqlPve :=  enSqlPve +
           '   0 as INT_ID_EMPRESA, '+
           '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

         enSqlPve :=  enSqlPve +
           ' NTT.ID_FORMA_PAG, FPG.descricao AS int_nomefpg, '+
           ' SUM(COALESCE(NTT.VLR_TITULO,0)) AS VLR_TOTAL '+
           ' FROM FAT_TB_M_NFE_TIT NTT                     '+
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=NTT.ID_FORMA_PAG '+

           ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NTT.ID_FISCAL  '+
           ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA  '+
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE     '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                         '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG       '+
           ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI           '+
           ' LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           ' LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO                   ';


           CondicaoGroup:='GROUP BY 1,2,3,4 ';
       end;

    case AnsiIndexStr(VarToStr(Input[11]), ['020300'])  of
              0: CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,INT_NOMEFPG ';
           end;


    FAT_SQ_R_PVE_07.Close;
    FAT_SQ_R_PVE_07.CommandText :='';


    FAT_SQ_R_PVE_07.CommandText := enSqlPve +
            ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
            '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

    FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText +
     ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
     '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
               ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
        end;

    

    if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

    if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

    if Input[12] <> '' then
      begin
        FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[12]) +') ';
      end;

   if Input[13] = '0' then
      begin
        FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[13] = '2' then
      begin
        FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;


     if CondicaoGroup<>'' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  + CondicaoGroup;
        end;

     if CondicaoOrder<>'' then
        begin
          FAT_SQ_R_PVE_07.CommandText := FAT_SQ_R_PVE_07.CommandText  + CondicaoOrder;
        end;


     Result := FAT_DP_R_PVE_07.Data;
end;

function TSM.FAT_DP_R_PVE_08DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  nQuebra:Integer;
  enSqlPve,codQuebra,CondicaoOrder,CondicaoGroup:String;
begin


    enSqlPve :=
           'SELECT ';

    if  Input[15] = '1'  then
      enSqlPve :=  enSqlPve +
       '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
       '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '
    else
       enSqlPve :=  enSqlPve +
       '   0 as INT_ID_EMPRESA, '+
       '   CAST('''' AS VARCHAR(60)) AS INT_NOMEEMP, ';

    enSqlPve :=  enSqlPve +
           ' NFE.id_fiscal, NFE.ID_EMITENTE,CLI.NOME AS INT_NOMECLI, '+
           ' NFE.DTA_EMISSAO,NFE.NUMERO,NFE.ID_PEDIDO_VENDA,NFE.VLR_LIQUIDO AS INT_VLR_NOTA ';



    nQuebra := 1;
    while nQuebra<=2 do
      begin
        codQuebra := copy(Input[12],3+2*(nQuebra-1),2);

        if codQuebra='00' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST('''' AS VARCHAR(20))  AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(NFE.DTA_EMISSAO AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

        if codQuebra='01' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(CID.NOME||''-''||CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

        if codQuebra='02' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST(NFE.ID_EMITENTE  AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(CLI.NOME,'' INDEFINIDO'' )AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

        if codQuebra='03' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST(NFE.ID_CONDICAO_PAG AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(CPG.DESCRICAO,'' INDEFINIDO'' ) AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

        if codQuebra='04' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST('''' AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(CID.UF,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

         if codQuebra='08' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST(PEC.ID_PERFIL_CLI AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(PEC.DESCRICAO,'' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

         if codQuebra='09' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST(FUC.ID_FUNCIONARIO AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(FUC.NOME, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

         if codQuebra='10' then
          begin
            enSqlPve := enSqlPve +
             ' , CAST(FPG.ID_FORMA_PAG AS VARCHAR(20)) AS INT_CODQUEBRA'+IntToStr(nQuebra);
            enSqlPve := enSqlPve +
             ' , CAST(COALESCE(FPG.DESCRICAO, '' INDEFINIDO'') AS VARCHAR(100)) AS INT_DESCQUEBRA'+IntToStr(nQuebra);
          end;

        inc(nQuebra);
      end;

     enSqlPve := enSqlPve +
           ' ,NTT.ID_FORMA_PAG, FPG.descricao AS int_nomefpg, '+
           ' SUM(COALESCE(NTT.VLR_TITULO,0)) AS VLR_TOT_TITULO '+
           ' FROM FAT_TB_M_NFE_TIT NTT                     '+
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG=NTT.ID_FORMA_PAG '+
           ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NTT.ID_FISCAL  '+
           ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           ' LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           ' LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';

     CondicaoGroup := ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ';
     CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,INT_DESCQUEBRA1,INT_DESCQUEBRA2,NFE.DTA_EMISSAO ';



    FAT_SQ_R_PVE_08.Close;
    FAT_SQ_R_PVE_08.CommandText :='';


    FAT_SQ_R_PVE_08.CommandText := enSqlPve +
            ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
            '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

    FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText +
     ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
     '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
               ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
        end;



    if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

    if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

    if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

     if CondicaoGroup<>'' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  + CondicaoGroup;
        end;

     if CondicaoOrder<>'' then
        begin
          FAT_SQ_R_PVE_08.CommandText := FAT_SQ_R_PVE_08.CommandText  + CondicaoOrder;
        end;


     Result := FAT_DP_R_PVE_08.Data;

end;

function TSM.FAT_DP_R_PVE_AXCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
enSqlAxc,CondicaoGroup,CondicaoOrder: String;
nQuebra:integer;
begin
  enSqlAxc:='';

  enSqlAxc :=
           'SELECT '+
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '+
           '   NFE.NUMERO, NFE.ID_PEDIDO_VENDA, NFE.DTA_EMISSAO, '+
           '   NFE.ID_CONDICAO_PAG,CPG.DESCRICAO AS INT_NOMECPG, '+
           '   NFE.ID_VENDEDOR,    FUC.NOME AS INT_NOMEVND, '+
           '   NFE.ID_EMITENTE,    CLI.NOME AS INT_NOMECLI, '+
           '   CLI.ID_PERFIL_CLI,  PEC.DESCRICAO AS INT_NOMEPEC, '+
           '   CLI.ID_REGIAO, REG.DESCRICAO AS INT_NOMEREG, '+
           '   CLI.ID_ROTA, ROT.DESCRICAO AS INT_NOMEROT, '+
           '   CID.UF AS ESTADO, '+
           '   CID.NOME||''-''||CID.UF AS INT_NOMECIDADE '+
           ',  SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+

           ' FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:= 'GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 ';
           CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,NFE.DTA_EMISSAO ';

  FAT_SQ_R_PVE_AXC.Close;
  FAT_SQ_R_PVE_AXC.CommandText :='';


  FAT_SQ_R_PVE_AXC.CommandText := enSqlAxc +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT in (''02'') AND NFE.STATUS = 1 AND ' +
          '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;
  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;
   if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_AXC.CommandText := FAT_SQ_R_PVE_AXC.CommandText  + CondicaoOrder;
      end;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_PVE_AXC.CommandText);
   Result := FAT_DP_R_PVE_AXC.Data;
end;

function TSM.FAT_DP_R_PVE_AXDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
enSqlAxd,CondicaoGroup,CondicaoOrder: String;
nQuebra:integer;
begin
  enSqlAxd:='';

  enSqlAxd :=
           'SELECT '+
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '+
           '   NFE.NUMERO, NFE.ID_PEDIDO_VENDA, NFE.DTA_EMISSAO, '+
           '   NFE.ID_CONDICAO_PAG,CPG.DESCRICAO AS INT_NOMECPG, '+
           '   NFE.ID_VENDEDOR,    FUC.NOME AS INT_NOMEVND, '+
           '   NFE.ID_EMITENTE,    CLI.NOME AS INT_NOMECLI, '+
           '   CLI.ID_PERFIL_CLI,  PEC.DESCRICAO AS INT_NOMEPEC, '+
           '   CLI.ID_REGIAO, REG.DESCRICAO AS INT_NOMEREG, '+
           '   CLI.ID_ROTA, ROT.DESCRICAO AS INT_NOMEROT, '+
           '   CID.UF AS ESTADO, '+
           '   CID.NOME||''-''||CID.UF AS INT_NOMECIDADE '+
           ',  SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+

           ' FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';
           CondicaoGroup:= 'GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 ';
           CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,NFE.DTA_EMISSAO ';

  FAT_SQ_R_PVE_AXD.Close;
  FAT_SQ_R_PVE_AXD.CommandText :='';


  FAT_SQ_R_PVE_AXD.CommandText := enSqlAxd +
          ' WHERE NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
          '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'R'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;
  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;
   if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_AXD.CommandText := FAT_SQ_R_PVE_AXD.CommandText  + CondicaoOrder;
      end;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_PVE_AXD.CommandText);
   Result := FAT_DP_R_PVE_AXD.Data;
end;

function TSM.FAT_DP_R_PVE_AXPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
enSqlAxp,CondicaoGroup,CondicaoOrder: String;
nQuebra:integer;
begin
  enSqlAxp:='';

  enSqlAxp :=
           ' SELECT PED.*,CLI.NOME AS INT_NOMECLI '+
           ' FROM FAT_TB_M_PED PED '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=PED.ID_CLIENTE ';

  FAT_SQ_R_PVE_AXP.Close;
  FAT_SQ_R_PVE_AXP.CommandText :='';


  FAT_SQ_R_PVE_AXP.CommandText := enSqlAxp +
          ' WHERE PED.SITUACAO = ''0'' AND PED.SITUACAO_APROVACAO <> ''2'' ' +
          ' AND PED.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  Result := FAT_DP_R_PVE_AXP.Data;
end;

function TSM.FAT_DP_R_PVE_AXVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
enSqlAxv,CondicaoGroup,CondicaoOrder: String;
nQuebra:integer;
begin
  enSqlAxv:='';

  enSqlAxv :=
           'SELECT '+
           '   NFE.ID_EMPRESA as INT_ID_EMPRESA, '+
           '   CAST(PAR.EMP_RAZAO AS VARCHAR(60)) AS INT_NOMEEMP, '+
           '   NFE.NUMERO, NFE.ID_PEDIDO_VENDA, NFE.DTA_EMISSAO, '+
           '   NFE.ID_CONDICAO_PAG,CPG.DESCRICAO AS INT_NOMECPG, '+
           '   NFE.ID_VENDEDOR,    FUC.NOME AS INT_NOMEVND, '+
           '   NFE.ID_EMITENTE,    CLI.NOME AS INT_NOMECLI, '+
           '   CLI.ID_PERFIL_CLI,  PEC.DESCRICAO AS INT_NOMEPEC, '+
           '   CLI.ID_REGIAO, REG.DESCRICAO AS INT_NOMEREG, '+
           '   CLI.ID_ROTA, ROT.DESCRICAO AS INT_NOMEROT, '+
           '   CID.UF AS ESTADO, '+
           '   CID.NOME||''-''||CID.UF AS INT_NOMECIDADE, '+

           '(select coalesce(sum(rrr.vlr_parcela),0) - '+
           ' coalesce((select sum(coalesce(vlr_pagamento,0)) + sum(coalesce(vlr_desconto,0)) '+
           ' - sum (coalesce(vlr_juros,0)) + sum(coalesce(vlr_acrescimo,0)) '+
           ' from fin_tb_m_rec_pag rpg '+
           ' left outer join fin_tb_m_rec eee on eee.id_titulo = rpg.id_titulo '+
           ' where eee.id_cliente = nfe.id_emitente '+
           ' and rpg.dta_pagamento < nfe.dta_emissao),0) as vlr_saldo '+
           ' from fin_tb_m_rec rrr '+
           ' where rrr.id_empresa = nfe.id_empresa and '+
           ' rrr.dta_emissao < nfe.dta_emissao and '+
           ' rrr.id_cliente = nfe.id_emitente '+
           ' ) as vlr_saldo, '+

           '  SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_BRUTO, '+
           '   SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO,  ' +
           //'   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           '   SUM(NIT.QTDE) AS QTDE, '+
           '   SUM(NIT.QTDE_DEVOLVIDA) AS QTDE_DEV '+

           ' FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=NFE.ID_EMPRESA '+
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
           'LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';

           CondicaoGroup:= 'GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19 '+
             ' HAVING '+
             ' ( SELECT '+
             ' COALESCE (SUM(rrr.vlr_parcela), 0) - COALESCE ( '+
             ' ( '+
             ' SELECT  '+
             ' SUM (COALESCE(vlr_pagamento, 0)) + SUM (COALESCE(vlr_desconto, 0)) - SUM (COALESCE(vlr_juros, 0)) + SUM (COALESCE(vlr_acrescimo, 0)) '+
             ' FROM '+
             ' fin_tb_m_rec_pag rpg '+
             ' LEFT OUTER JOIN fin_tb_m_rec eee ON eee.id_titulo = rpg.id_titulo '+
             ' WHERE '+
             ' eee.id_cliente = nfe.id_emitente '+
             ' AND rpg.dta_pagamento < nfe.dta_emissao '+
             '         ), '+
             '         0  '+
             '       ) AS vlr_saldo '+
             '     FROM '+
             '       fin_tb_m_rec rrr '+
             '     WHERE '+
             '       rrr.id_empresa = nfe.id_empresa '+
             '     AND rrr.dta_emissao < nfe.dta_emissao '+
             '     AND rrr.id_cliente = nfe.id_emitente '+
             '   ) > 0';
           CondicaoOrder := ' ORDER BY INT_ID_EMPRESA,NFE.DTA_EMISSAO ';

  FAT_SQ_R_PVE_AXV.Close;
  FAT_SQ_R_PVE_AXV.CommandText :='';


  FAT_SQ_R_PVE_AXV.CommandText := enSqlAxv +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
          '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;
  if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;
   if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

   if Input[11] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND ITE.ID_ITEM in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_PVE_AXV.CommandText := FAT_SQ_R_PVE_AXV.CommandText  + CondicaoOrder;
      end;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_PVE_AXV.CommandText);
   Result := FAT_DP_R_PVE_AXV.Data;
end;

function TSM.FAT_DP_R_PVE_QTD_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

    FAT_SQ_R_PVE_QTD_CLI.Close;
    FAT_SQ_R_PVE_QTD_CLI.CommandText :=
        ' SELECT NFE.ID_EMPRESA,            '+
        ' COALESCE(COUNT(DISTINCT NFE.ID_EMITENTE),0) AS INT_QTDE_CLIENTE '+
        ' FROM FAT_TB_M_NFE NFE             '+
        ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
        ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
        ' LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO '+
        ' LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
        ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND '+
        ' NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF=''S'' ';


    FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText +
     ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
     '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';



    if Input[0] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
        end;


    if Input[3] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
               ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
        end;

    if Input[9] <> '' then
      begin
        FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
             ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
      end;

    if Input[10] <> '' then
      begin
        FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
             ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
      end;

    if Input[13] <> '' then
      begin
        FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
      end;

   if Input[14] = '0' then
      begin
        FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
             ' AND NFE.ID_ORDEM > 0 ';
      end;

   if Input[14] = '2' then
      begin
        FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
             ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
      end;

    FAT_SQ_R_PVE_QTD_CLI.CommandText := FAT_SQ_R_PVE_QTD_CLI.CommandText  +
                                         ' GROUP BY NFE.ID_EMPRESA ';
   // CMServerForm.mm.Lines.Add(FAT_SQ_R_PVE_QTD_CLI.CommandText);
    Result := FAT_DP_R_PVE_QTD_CLI.Data;
end;

function TSM.FAT_DP_R_PVE_TOL_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPve:String;
  i:Integer;
  ListaCodGrupo:TStringList;
 begin
  { TODO -oLuan -cCriao : Criado por Luan em 19/12/2017 }
    FAT_SQ_R_PVE_TOL_GRU.Close;
    FAT_SQ_R_PVE_TOL_GRU.CommandText :='';
    enSqlPve:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Forma de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Regiao
    //  Input[10]  Relatrio
                  // 00-Venda por Condicao de Pagamento
                  // 01-Vendas por Vendedor
                  // 02-Vendas por Grupo de Item
                  // 03-Vendas por Estado
                  // 04-Vendas por Cliente
                  // 05-Vendas por Item
                  // 06-Vendas por Fornecedor
                  // 07-Vendas por Perfil do Cliente
                  // 08-Vendas por Cliente e Item
                  // 09-Vendas por Item e Cliente
                  // 10-Vendas por Fornecedor e Item
                  // 11-Resumo por Vendedor
                  // 12-Resumo por grupo





         enSqlPve :=


          '    select  SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO_TOTAL,  '+
          '            SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO_TOTAL '+
          '       from FAT_TB_M_NFE_ITE NIT  '+
          '           LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
          '           LEFT OUTER JOIN OFI_TB_M_ORV_ITE ORI ON ORI.ID_ORDEM=NFE.ID_ORDEM AND ORI.ID_SEQUENCIA=NIT.ID_SEQUENCIA '+
          '           LEFT OUTER JOIN CAD_TB_C_FUN MEC ON MEC.ID_FUNCIONARIO=ORI.ID_MECANICO '+
          '           LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
          '           LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
          '           LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
          '           LEFT OUTER JOIN CAD_TB_C_ITE ITE2 ON ITE2.ID_ITEM=NIT.ID_ITEM '+
          '           LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
          '           LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
          '           LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
          '           LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE2.ID_FORNECEDOR  '+
          '           LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE2.ID_GRUPO  '+
          '           LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=CLI.ID_ROTA '+
          '           LEFT OUTER JOIN PCP_TB_C_REG REG ON REG.ID_REGIAO=CLI.ID_REGIAO ';


          if (Length(VarToStr(Input[18]))=1) then
              enSqlPve :=    enSqlPve +
                  '  where  substring(ITE2.ID_GRUPO from 1 for 1) = '''+VarToStr(Input[18])+''''
          else
              enSqlPve :=    enSqlPve +
                  '  where  substring(ITE2.ID_GRUPO from 1 for 4) = '''+VarToStr(Input[18])+'''';


          enSqlPve :=    enSqlPve +
          ' AND CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND ' +
          '   NFE.STATUS = 1 AND NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') '+


          ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
          '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

           FAT_SQ_R_PVE_TOL_GRU.CommandText :=  enSqlPve;

          if Input[3] <> '' then
            begin
               FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                   ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
            end;

          if Input[4] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
              end;

          if Input[5] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
              end;

          if Input[6] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
              end;

          if Input[7] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
              end;

          if Input[8] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND ITE2.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
              end;

          if Input[9] <> '' then
            begin
               FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                   ' AND REG.ID_REGIAO in (' + VarToStr(Input[9]) +') ';
            end;

          if Input[10] <> '' then
            begin
               FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                   ' AND CLI.ID_CLIENTE in (' + VarToStr(Input[10]) +') ';
            end;


          if Input[11] <> '' then
            begin
               FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                   ' AND ITE2.ID_ITEM in (' + VarToStr(Input[11]) +') ';
            end;

          if Input[13] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND ROT.ID_ROTA in (' + VarToStr(Input[13]) +') ';
              end;

           if Input[14] = '0' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND NFE.ID_ORDEM > 0 ';
              end;

           if Input[14] = '2' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND (NFE.ID_ORDEM = 0 OR NFE.ID_ORDEM IS NULL) ';
              end;

           if Input[16] <> '' then
              begin
                  FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                    ' AND ( ';

                  ListaCodGrupo := TStringList.Create;
                  LIstaCodGrupo.Delimiter:=',';
                  LIstaCodGrupo.StrictDelimiter:=True;
                  ListaCodGrupo.DelimitedText :=  VarToStr(Input[16]);

                  for i := 0 to ListaCodGrupo.Count-1 do
                    begin
                      if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                        begin
                             FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                              ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                              '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                        end
                      else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                        begin
                             FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                              ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                              '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                        end
                      else
                        begin
                            FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                              ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                        end;

                      if i < (ListaCodGrupo.Count-1) then
                         FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText + ' OR ';
                    end;

                  FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText + ' ) ';

              end;

           if Input[17] <> '' then
              begin
                 FAT_SQ_R_PVE_TOL_GRU.CommandText :=  FAT_SQ_R_PVE_TOL_GRU.CommandText  +
                     ' AND ORI.ID_MECANICO in (' + VarToStr(Input[17]) +') ';
              end;






     //CMServerForm.mm.Lines.Add( FAT_SQ_R_PVE_TOL_GRU.CommandText);
     Result := FAT_DP_R_PVE_TOL_GRU.Data;
end;

function TSM.FAT_DP_R_RET_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRet, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRet:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Cliente
                  // 01-Por Item
                  // 02-Por Fornecedor
                  // 03-Por Grupo
                  // 04-Por Vendedor
    //  Input[10]  0 - Valor custo
    //             1 - Valor custo da ultima compra   "EST_SQ_M_FESvlr_custo_ult_compra"




    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 0)  then
       begin
         enSqlRet :=
           ' SELECT NFE.ID_EMITENTE, CLI.NOME AS INT_NOMECLI, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, ';
           if Input[10] = 0 then
              enSqlRet := enSqlRet +
                  '   SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, '
           else
              if Input[10] = 1 then
                 enSqlRet := enSqlRet +
                     '   SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, ';

           enSqlRet := enSqlRet +
                '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100) AS VLR_desp_fixa, '+
                '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100) AS VLR_desp_vari, ';

           if Input[10] = 0 then
              enSqlRet := enSqlRet +
               '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
               '   (SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui '
           else
              if Input[10] = 1 then
                enSqlRet := enSqlRet +
                 '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
                 '   (SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui ';

           enSqlRet := enSqlRet +
           ' FROM FAT_TB_M_NFE_ITE NIT '+
           ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           //' LEFT OUTER JOIN EST_TB_M_FEA FEA ON FEA.ID_ITEM=NIT.ID_ITEM AND FEA.ID_EMPRESA=NFE.ID_EMPRESA AND '+
           //'                                     FEA.ID_FISCAL = NFE.ID_FISCAL ' +
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN EST_TB_M_FES FES ON FES.ID_EMPRESA = NFE.ID_EMPRESA AND FES.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI '+
           ' LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           ' LEFT OUTER JOIN CAD_TB_C_PAR_CTR CTR ON CTR.ID_EMPRESA=NFE.ID_EMPRESA ';
            CondicaoGroup := 'GROUP BY 1,2 ';
            CondicaoOrder := 'Order By 2';
       end;


  FAT_SQ_R_RET_CLI.Close;
  FAT_SQ_R_RET_CLI.CommandText :='';


  FAT_SQ_R_RET_CLI.CommandText := enSqlRet +
          ' WHERE GRU.TIPO_ITEM <> ''09'' AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') '+
          ' AND NFE.FATURADA=TRUE AND ' +
          '       CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.STATUS = 1 AND NFE.TIPO_NF='''+'S'+''' and (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
            ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_RET_CLI.CommandText := FAT_SQ_R_RET_CLI.CommandText  + CondicaoOrder;
      end;
   //CMServerForm.mm.Lines.Add(FAT_SQ_R_RET_CLI.CommandText);
   Result := FAT_DP_R_RET_CLI.Data;

end;

function TSM.FAT_DP_R_RET_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRet, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRet:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Cliente
                  // 01-Por Item
                  // 02-Por Fornecedor
                  // 03-Por Grupo
                  // 04-Por Vendedor
    //  Input[10]  0 - Valor custo
    //             1 - Valor custo da ultima compra   "EST_SQ_M_FESvlr_custo_ult_compra"




    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 2)  then
       begin

         enSqlRet :=
           ' SELECT ';

         if (Input[11] = 0) then
           begin
             enSqlRet := enSqlRet +
               ' 0 AS INT_CODCLIENTE, '+
               ' CAST('''' AS VARCHAR(100)) AS INT_NOMECLI, ';
           end
         else
           begin
              enSqlRet := enSqlRet +
               ' CLI.ID_CLIENTE AS INT_CODCLIENTE, '+
               ' CLI.NOME AS INT_NOMECLI, ';
           end;

         enSqlRet := enSqlRet +

           ' ITE.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, ';
            if Input[10] = 0 then
              enSqlRet := enSqlRet +
                  '   SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, '
           else
              if Input[10] = 1 then
                 enSqlRet := enSqlRet +
                     '   SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, ';


           enSqlRet := enSqlRet +
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100) AS VLR_desp_fixa, '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100) AS VLR_desp_vari, ';


           if Input[10] = 0 then
              enSqlRet := enSqlRet +
               '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
               '   (SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui '
           else
              if Input[10] = 1 then
                enSqlRet := enSqlRet +
                 '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
                 '   (SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui ';
           enSqlRet := enSqlRet +
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           //'LEFT OUTER JOIN EST_TB_M_FEA FEA ON FEA.ID_ITEM=NIT.ID_ITEM AND FEA.ID_EMPRESA=NFE.ID_EMPRESA AND '+
           //'                                    FEA.ID_FISCAL = NFE.ID_FISCAL ' +
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN EST_TB_M_FES FES ON FES.ID_EMPRESA = NFE.ID_EMPRESA AND FES.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR_CTR CTR ON CTR.ID_EMPRESA=NFE.ID_EMPRESA ';
            CondicaoGroup := 'GROUP BY 1,2,3,4 ';
            CondicaoOrder := 'Order By INT_NOMEFOR';
       end;


  FAT_SQ_R_RET_FOR.Close;
  FAT_SQ_R_RET_FOR.CommandText :='';


  FAT_SQ_R_RET_FOR.CommandText := enSqlRet +
          ' WHERE GRU.TIPO_ITEM <> ''09'' AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.FATURADA = TRUE AND ' +
          '       CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.STATUS = 1 AND NFE.TIPO_NF='''+'S'+''' and (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
            ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_RET_FOR.CommandText := FAT_SQ_R_RET_FOR.CommandText  + CondicaoOrder;
      end;

   Result := FAT_DP_R_RET_FOR.Data;

end;

function TSM.FAT_DP_R_RET_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRet, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRet:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Cliente
                  // 01-Por Item
                  // 02-Por Fornecedor
                  // 03-Por Grupo
                  // 04-Por Vendedor
    //  Input[10]  0 - Valor custo
    //             1 - Valor custo da ultima compra   "EST_SQ_M_FESvlr_custo_ult_compra"




    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 3)  then
       begin
         enSqlRet :=
           ' SELECT ';

         if (Input[11] = 0) then
           begin
             enSqlRet := enSqlRet +
               ' 0 AS INT_CODCLIENTE, '+
               ' CAST('''' AS VARCHAR(100)) AS INT_NOMECLI, ';
           end
         else
           begin
              enSqlRet := enSqlRet +
               ' CLI.ID_CLIENTE AS INT_CODCLIENTE, '+
               ' CLI.NOME AS INT_NOMECLI, ';
           end;

         enSqlRet := enSqlRet +
           ' ITE.ID_GRUPO, GRU.DESCRICAO AS INT_NOMEGRU, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, ';
            if Input[10] = 0 then
              enSqlRet := enSqlRet +
                  '   SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, '
           else
              if Input[10] = 1 then
                 enSqlRet := enSqlRet +
                     '   SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, ';

           enSqlRet := enSqlRet +
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100) AS VLR_desp_fixa, '+
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100) AS VLR_desp_vari, ';

           if Input[10] = 0 then
              enSqlRet := enSqlRet +
               '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
               '   (SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui '
           else
              if Input[10] = 1 then
                enSqlRet := enSqlRet +
                 '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
                 '   (SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui ';
           enSqlRet := enSqlRet +
           ' FROM FAT_TB_M_NFE_ITE NIT '+
           ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           //'LEFT OUTER JOIN EST_TB_M_FEA FEA ON FEA.ID_ITEM=NIT.ID_ITEM AND FEA.ID_EMPRESA=NFE.ID_EMPRESA AND '+
           //'                                    FEA.ID_FISCAL = NFE.ID_FISCAL ' +
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN EST_TB_M_FES FES ON FES.ID_EMPRESA = NFE.ID_EMPRESA AND FES.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
           ' LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           ' LEFT OUTER JOIN CAD_TB_C_PAR_CTR CTR ON CTR.ID_EMPRESA=NFE.ID_EMPRESA ';
            CondicaoGroup := 'GROUP BY 1,2,3,4 ';
            CondicaoOrder := 'Order By 2';
       end;


  FAT_SQ_R_RET_GRU.Close;
  FAT_SQ_R_RET_GRU.CommandText :='';


  FAT_SQ_R_RET_GRU.CommandText := enSqlRet +
          ' WHERE GRU.TIPO_ITEM <> ''09'' AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.FATURADA = TRUE AND ' +
          '       CFO.ID_CLASSE IN (''SP10'',''SP70'') AND  NFE.STATUS = 1 AND NFE.TIPO_NF='''+'S'+''' and (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
            ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_RET_GRU.CommandText := FAT_SQ_R_RET_GRU.CommandText  + CondicaoOrder;
      end;

   Result := FAT_DP_R_RET_GRU.Data;
end;

function TSM.FAT_DP_R_RET_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRet, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRet:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Cliente
                  // 01-Por Item
                  // 02-Por Fornecedor
                  // 03-Por Grupo
                  // 04-Por Vendedor
    //  Input[10]  0 - Valor custo
    //             1 - Valor custo da ultima compra   "EST_SQ_M_FESvlr_custo_ult_compra"



    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 1)  then
       begin
         enSqlRet :=
           ' with tb_tit_dias_medio as (select pit.id_pedido,avg(pit.dias) as TIT_DIAS_MED from fat_tb_m_ped_tit pit '+
           ' group by 1) '+
           ' SELECT ';

         if (Input[11] = 0) then
           begin
             enSqlRet := enSqlRet +
               ' CLI.ID_CLIENTE AS INT_CODCLIENTE, '+
               ' CAST(CLI.NOME AS VARCHAR(100)) AS INT_NOMECLI, ';
           end
         else
           begin
              enSqlRet := enSqlRet +
               ' CLI.ID_CLIENTE AS INT_CODCLIENTE, '+
               ' CLI.NOME AS INT_NOMECLI, ';
           end;

         enSqlRet := enSqlRet +
           '  ITE.ID_ITEM, ITE.DESCRICAO AS INT_NOMEITE,ITE.ID_UND_VENDA, NFE.VLR_DESCONTO, '+
           '       NFE.NUMERO, NFE.DTA_EMISSAO,coalesce(NFE.ID_VENDEDOR,0) ID_VENDEDOR ,NFE.ID_CONDICAO_PAG, NFE.MODELO, NFE.SERIE, '+
           ' COALESCE(PED.DIAS_CPG_PRAZO,''0'') AS DIAS_CPG_PRAZO,TDM.TIT_DIAS_MED,NIT.VLR_UNITARIO,	SUM(NIT.QTDE-NIT.QTDE_DEVOLVIDA) AS QTDE, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, '+
           ' (100-(SUM(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA))*100/SUM(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA)) )) AS RENTA, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, ';

         if Input[10] = 0 then
            enSqlRet := enSqlRet +
                '   SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, '
         else
            if Input[10] = 1 then
               enSqlRet := enSqlRet +
                   '   SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, ';

         enSqlRet := enSqlRet +
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100) AS VLR_desp_fixa, '+
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100) AS VLR_desp_vari, ';

         if Input[10] = 0 then
            enSqlRet := enSqlRet +
             '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
             '   (SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
             '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
             '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui '
         else
            if Input[10] = 1 then
              enSqlRet := enSqlRet +
               '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
               '   (SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui ';

         enSqlRet := enSqlRet +
           ' FROM FAT_TB_M_NFE_ITE NIT '+
           ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           //' LEFT OUTER JOIN EST_TB_M_FEA FEA ON FEA.ID_ITEM=NIT.ID_ITEM AND FEA.ID_EMPRESA=NFE.ID_EMPRESA AND '+
           //'                                     FEA.ID_FISCAL = NFE.ID_FISCAL ' +
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN EST_TB_M_FES FES ON FES.ID_EMPRESA = NFE.ID_EMPRESA AND FES.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
           ' LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           ' LEFT OUTER JOIN CAD_TB_C_PAR_CTR CTR ON CTR.ID_EMPRESA=NFE.ID_EMPRESA '+
           ' LEFT OUTER JOIN FAT_TB_M_PED PED ON PED.ID_PEDIDO=NFE.ID_PEDIDO_VENDA AND PED.ID_EMPRESA=NFE.ID_EMPRESA '+
           ' LEFT OUTER JOIN tb_tit_dias_medio TDM on TDM.id_pedido=PED.id_pedido ';
            CondicaoGroup := 'GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ';
            CondicaoOrder := 'Order By ITE.DESCRICAO,NFE.NUMERO';
       end;


  FAT_SQ_R_RET_ITE.Close;
  FAT_SQ_R_RET_ITE.CommandText :='';


  FAT_SQ_R_RET_ITE.CommandText := enSqlRet +
          ' WHERE GRU.TIPO_ITEM <> ''09'' AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.FATURADA = TRUE AND ' +
          '       CFO.ID_CLASSE IN (''SP10'',''SP70'') AND  NFE.STATUS = 1 AND NFE.TIPO_NF='''+'S'+''' and (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
            ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_RET_ITE.CommandText := FAT_SQ_R_RET_ITE.CommandText  + CondicaoOrder;
      end;

   //CMServerForm.mm.Lines.Add(FAT_SQ_R_RET_ITE.CommandText);
   Result := FAT_DP_R_RET_ITE.Data;

end;

function TSM.FAT_DP_R_RET_VNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRet, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRet:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Tipo de Estoque
    //  Input[4]  CFOP
    //  Input[5]  Condicao de Pagamento
    //  Input[6]  Vendedor
    //  Input[7]  Perfil de Cliente
    //  Input[8]  Fornecedor
    //  Input[9]  Relatrio
                  // 00-Por Cliente
                  // 01-Por Item
                  // 02-Por Fornecedor
                  // 03-Por Grupo
                  // 04-Por Vendedor
    //  Input[10]  0 - Valor custo
    //             1 - Valor custo da ultima compra   "EST_SQ_M_FESvlr_custo_ult_compra"




    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[9] = 4)  then
       begin
         enSqlRet :=
           ' SELECT ';

         if (Input[11] = 0) then
           begin
             enSqlRet := enSqlRet +
               ' 0 AS INT_CODCLIENTE, '+
               ' CAST('''' AS VARCHAR(100)) AS INT_NOMECLI, ';
           end
         else
           begin
              enSqlRet := enSqlRet +
               ' CLI.ID_CLIENTE AS INT_CODCLIENTE, '+
               ' CLI.NOME AS INT_NOMECLI, ';
           end;

         enSqlRet := enSqlRet +
           ' NFE.ID_VENDEDOR, FUC.NOME AS INT_NOMEVND, '+
           '   SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_LIQUIDO, ';
           if Input[10] = 0 then
            enSqlRet := enSqlRet +
                '   SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, '
           else
              if Input[10] = 1 then
                 enSqlRet := enSqlRet +
                     '   SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)) AS VLR_CUSTO, ';

           enSqlRet := enSqlRet +
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100) AS VLR_desp_fixa, '+
           '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100) AS VLR_desp_vari, ';

           if Input[10] = 0 then
              enSqlRet := enSqlRet +
               '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
               '   (SUM(COALESCE(NIT.VLR_CUSTO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
               '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui '
           else
              if Input[10] = 1 then
                enSqlRet := enSqlRet +
                 '   ((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))- ' +
                 '   (SUM(COALESCE(FES.vlr_custo_ult_compra*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0)))- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_fixa,0))/count(*))/100)- '+
                 '   (((SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))-SUM(COALESCE(NIT.VLR_DESCONTO,0)))*sum(COALESCE(ctr.per_desp_var,0))/count(*))/100)) AS VLR_Lucro_liqui ';

         enSqlRet := enSqlRet +
           'FROM FAT_TB_M_NFE_ITE NIT '+
           'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NIT.ID_FISCAL '+
           //'LEFT OUTER JOIN EST_TB_M_FEA FEA ON FEA.ID_ITEM=NIT.ID_ITEM AND FEA.ID_EMPRESA=NFE.ID_EMPRESA AND '+
           //'                                    FEA.ID_FISCAL = NFE.ID_FISCAL ' +
           'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE '+
           'LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE '+
           'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=NIT.ID_ITEM '+
           ' LEFT OUTER JOIN EST_TB_M_FES FES ON FES.ID_EMPRESA = NFE.ID_EMPRESA AND FES.ID_ITEM=NIT.ID_ITEM '+
           'LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
           'LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG '+
           'LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI  '+
           'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR=ITE.ID_FORNECEDOR '+
           'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=ITE.ID_GRUPO '+
           'LEFT OUTER JOIN CAD_TB_C_PAR_CTR CTR ON CTR.ID_EMPRESA=NFE.ID_EMPRESA ';
            CondicaoGroup := 'GROUP BY 1,2,3,4 ';
            CondicaoOrder := 'Order By 2';
       end;


  FAT_SQ_R_RET_VND.Close;
  FAT_SQ_R_RET_VND.CommandText :='';


  FAT_SQ_R_RET_VND.CommandText := enSqlRet +
          ' WHERE GRU.TIPO_ITEM <> ''09'' AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.FATURADA = TRUE AND ' +
          '       CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.STATUS = 1 AND NFE.TIPO_NF='''+'S'+''' and (NIT.QTDE-NIT.QTDE_DEVOLVIDA)>0 AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
             ' AND NFE.ID_TIPO_MOV_ESTOQUE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
             ' AND NFE.ID_CFO in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
             ' AND NFE.ID_CONDICAO_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
            ' AND CLI.ID_PERFIL_CLI in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  +
             ' AND ITE.ID_FORNECEDOR in (' + VarToStr(Input[8]) +') ';
      end;

   if CondicaoGroup<>'' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FAT_SQ_R_RET_VND.CommandText := FAT_SQ_R_RET_VND.CommandText  + CondicaoOrder;
      end;

   Result := FAT_DP_R_RET_VND.Data;

end;

function TSM.FAT_DP_R_ROTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRot: String;
begin
  Result := ' select nfe.id_emitente, nfe.numero, cli.nome as int_cliente, '+
            ' fun.nome as int_vendedor, '+
            ' nfe.id_pedido_venda, rot.id_rota,rot.descricao as int_rota, nfe.dta_emissao,'+
            ' SUM(COALESCE(NIT.VLR_UNITARIO*(NIT.QTDE-NIT.QTDE_DEVOLVIDA),0))- '+
            ' SUM((COALESCE(NIT.VLR_DESCONTO,0)/NIT.QTDE)*(nit.qtde-nit.qtde_devolvida)) AS VLR_LIQUIDO, '+            ' SUM(COALESCE(NIT.VLR_DESCONTO,0)) AS VLR_DESCONTO, '+
            ' sum(nit.qtde) as qtde, '+
            ' sum(nit.qtde_devolvida) as qtde_dev '+
            ' from fat_tb_m_nfe_ite nit '+
            ' left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nit.id_fiscal '+
            ' left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente '+
            ' left outer join cad_tb_c_fun fun on fun.id_funcionario=nfe.id_vendedor '+
            ' left outer join pcp_tb_c_rot rot on rot.id_rota=cli.id_rota '+
            ' left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo';

end;
begin
  FAT_SQ_R_ROT.Close;
  FAT_SQ_R_ROT.CommandText :='';

  FAT_SQ_R_ROT.CommandText := enSqlFatRot +
          ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND ' +
          '   NFE.FATURADA = true AND NFE.TIPO_NF='''+'S'+''' and NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  FAT_SQ_R_ROT.CommandText := FAT_SQ_R_ROT.CommandText +
   ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

  if Input[3] <> '' then
      begin
        FAT_SQ_R_ROT.CommandText := FAT_SQ_R_ROT.CommandText  +
             ' AND ROT.ID_ROTA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FAT_SQ_R_ROT.CommandText := FAT_SQ_R_ROT.CommandText  +
             ' AND NFE.ID_VENDEDOR in (' + VarToStr(Input[4]) +') ';
      end;

  FAT_SQ_R_ROT.CommandText := FAT_SQ_R_ROT.CommandText  +
    'GROUP BY 1,2,3,4,5,6,7,8 '+
    'ORDER BY ROT.ID_ROTA, NFE.NUMERO ';

  Result := FAT_DP_R_ROT.Data;
end;

function TSM.FAT_DP_R_SIN_050DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatRelSin050:String;
  begin
    Result :=
      'select nfe.id_empresa,  nfe.id_cfo, nfe.nfe_cod_sit,' + #13#10 +
      '                       nfe.id_emitente,nfe.modelo, nfe.serie, nfe.numero, nfe.dta_emissao, nfe.ind_emitente,     ' + #13#10 +
      '                       cast (case ' + #13#10 +
      '                          when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.doc_cnpj ' + #13#10 +
      '                          when nfe.tipo_nf in (''S'',''R'') then CLI.doc_cnpj_cpf   ' + #13#10 +
      '                       end as varchar(14) ) as INT_CNPJCPF,                                        ' + #13#10 +
      '                       cast( case ' + #13#10 +
      '                          when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.DOC_IE ' + #13#10 +
      '                          when (nfe.tipo_nf in (''S'',''R'')) and (cli.pessoa = 1) then CLI.DOC_IE_IDENTIDADE ' + #13#10 +
      '                          when (nfe.tipo_nf in (''S'',''R'')) and (cli.pessoa = 0) then ''ISENTO''   ' + #13#10 +
      '                       end as varchar(14) ) as INT_DOC_IE,' + #13#10 +
      '                       cast(case ' + #13#10 +
      '                          when nfe.tipo_nf in (''E'',''D'',''F'') then cif.uf ' + #13#10 +
      '                          when nfe.tipo_nf in (''S'',''R'') then cic.uf ' + #13#10 +
      '                       end as char(2)) as INT_ESTADO, ' + #13#10 +
      '                                        ' + #13#10 +
      '                       (nfe.vlr_liquido) vlr_contabil,                            ' + #13#10 +
      '                       coalesce(nfe.icm_n_base,0)  vlr_base_icm,                ' + #13#10 +
      '                       coalesce(nfe.icm_n_valor,0) vlr_icm,                     ' + #13#10 +
      '                       coalesce(nfe.VLR_OUTRAS,0)  vlr_outras,                  ' + #13#10 +
      '                       coalesce(nfe.VLR_ISENTA,0)  vlr_isenta,' + #13#10 +
      '                       case' + #13#10 +
      '                         when (coalesce(nfe.icm_n_base,0) > 0) and ' + #13#10 +
      '                              (coalesce(nfe.icm_n_valor,0) > 0) ' + #13#10 +
      '                            then  round( ( (coalesce(nfe.icm_n_valor,0) * 100) / coalesce(nfe.icm_n_base,0) ),0 )' + #13#10 +
      '                       else 0 end as icm_n_aliquota' + #13#10 +
      '                              ' + #13#10 +
      '                     from fat_tb_m_nfe nfe                                                              ' + #13#10 +
      '                     LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ID_EMITENTE     ' + #13#10 +
      '                     LEFT OUTER JOIN CAD_TB_C_FOR FNE ON FNE.ID_FORNECEDOR=ID_EMITENTE  ' + #13#10 +
      '                     left outer join cad_tb_c_cid cic on cic.id_cidade=cli.id_cidade ' + #13#10 +
      '                     left outer join cad_tb_c_cid cif on cif.id_cidade=fne.id_cidade ';

  end;

begin

   FAT_SQ_R_SIN_050.Close;

   FAT_SQ_R_SIN_050.CommandText := enSqlFatRelSin050 +

      ' where   ' + #13#10 +
      '  nfe.id_empresa   = ''' + VarToStr(Input[0]) + ''' and ' +
      '  nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
      '  nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' and ' +
      '  nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1' + #13#10 +
      '  and nfe.modelo in (''01'',''06'',''21'',''22'',''55'') ' + #13#10+
      '  and nfe.faturada = true ' + #13#10 +
      '  and nfe.nfe_ecf not in (2,3)' + #13#10 +
      //  '  and nfe.id_cfo not in (''1556'',''2556'',''5933'',''6933'')' + #13#10 +
      //  '  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ' +
      '  order by nfe.numero ';

   Result := FAT_DP_R_SIN_050.Data;

   FAT_SQ_R_SIN_050.Close;
end;


function TSM.FAT_DP_R_SIN_054DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatSin054:String;
  begin
    Result :=
        '                select  ' + #13#10 +
        '                cast (case ' + #13#10 +
        '                    when nfe.tipo_nf in (''E'',''D'',''F'') then FNE.doc_cnpj ' + #13#10 +
        '                    when nfe.tipo_nf in (''S'',''R'') then CLI.doc_cnpj_cpf   ' + #13#10 +
        '                 end as varchar(14) ) as INT_CNPJCPF,                                          ' + #13#10 +
        '                 nfe.dta_emissao,   ' + #13#10 +
        '                 nfe.serie, nfe.numero, nfi.id_cfo,nfe.modelo,nfi.id_item, ite.descricao int_nomeite,' + #13#10 +
        '                 nfe.nfe_cod_sit, nfe.ind_emitente,nfi.id_st_icm,icm_n_aliquota, nfi.qtde, gru.origem_mercadoria, ' + #13#10 +
        '                 coalesce(nfi.vlr_liquido,0)    vlr_liquido,                        ' + #13#10 +
        '                 coalesce(nfi.vlr_desconto,0)   vlr_desconto,                ' + #13#10 +
        '                 coalesce(nfi.icm_n_base,0)     vlr_base_icm,                ' + #13#10 +
        '                 coalesce(nfi.icm_s_base,0)     vlr_base_subst,' + #13#10 +
        '                 coalesce(nfi.ipi_valor,0)      vlr_ipi                ' + #13#10 +
        '                             ' + #13#10 +
        '               from fat_tb_m_nfe_ite nfi                                          ' + #13#10 +
        '                                                                                  ' + #13#10 +
        '               left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal ' + #13#10 +
        '               left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item      ' + #13#10 +
        '               LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ID_EMITENTE     ' + #13#10 +
        '               LEFT OUTER JOIN CAD_TB_C_FOR FNE ON FNE.ID_FORNECEDOR=ID_EMITENTE  ' +
        '               left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo    ' + #13#10;
  end;

begin

   FAT_SQ_R_SIN_054.Close;

   FAT_SQ_R_SIN_054.CommandText := enSqlFatSin054 +

      ' where   ' + #13#10 +
      '  nfe.id_empresa   = ''' + VarToStr(Input[0]) + ''' and ' +
      '  nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
      '  nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' and ' +
      '  nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1' + #13#10 +
      '  and nfe.faturada = true ' + #13#10 +
      '  and nfe.nfe_ecf not in (2,3)' + #13#10 +
      '  and nfe.modelo in (''01'',''06'',''21'',''22'',''55'') ' + #13#10+
   //   '  and nfe.id_cfo not in (''1556'',''2556'',''5933'',''6933'')' + #13#10 +
     // '  group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ';
      ' order by nfe.numero ';

   Result := FAT_DP_R_SIN_054.Data;

   FAT_SQ_R_SIN_054.Close;
end;

function TSM.FAT_DP_R_SIN_075DataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatSin075:String;
  begin
    Result :=
          ' select nfi.id_item, ite.id_ncm, ite.descricao, ite.id_und_venda,avg(nfi.ipi_aliquota) as ipi_aliquota,' + #13#10 +
          '       avg(nfi.icm_n_aliquota) as icm_n_aliquota, avg(nfi.icm_n_base) as icm_n_base                  ' + #13#10 +
          ' from fat_tb_m_nfe_ite nfi                                                                                                                         ' + #13#10 +
          '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = nfi.id_fiscal ' + #13#10 +
          '   left outer join cad_tb_c_ite ite  on ite.id_item = nfi.id_item     ' + #13#10;

  end;
begin
  { TODO -oMaxsuel -cCriao : Criado em 01/01/2018 }


   FAT_SQ_R_SIN_075.Close;

   FAT_SQ_R_SIN_075.CommandText := enSqlFatSin075 +
       '  where  nfe.id_empresa   = ''' + VarToStr(Input[0]) + '''  ' +
       '   and nfe.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       '   and nfe.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
       '   and nfe.nfe_cod_sit not in (''02'',''04'',''05'') and nfe.status = 1' + #13#10 +
       '   and nfe.modelo in (''01'',''06'',''21'',''22'',''55'') ' + #13#10+
       '   and nfe.faturada = true ' + #13#10 +
       '   and nfe.nfe_ecf not in (2,3)' + #13#10 +
       ' group by 1,2,3,4'    +
       ' order by 1 ';

   Result := FAT_DP_R_SIN_075.Data;

   FAT_SQ_R_SIN_075.Close;
end;

function TSM.FAT_DP_R_SIN_60ADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatSin60A:String;
  begin
    Result :=
      'select cm.data_movimento, cm.serial_impressora, cd.aliquota, sum(cd.valor_total)+sum(cd.desconto) valor_total  from br_cupom_detalhe cd' + #13#10 +
      '  left outer join br_cupom_mestre cm on cm.serial_impressora=cd.serial_impressora and cm.n_cupom=cd.n_cupom' + #13#10;
  end;
begin
  { TODO -oMaxsuel -cCriao : Criado em 01/01/2018 }


   FAT_SQ_R_SIN_60A.Close;

   FAT_SQ_R_SIN_60A.CommandText := enSqlFatSin60A +
       ' where cm.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       '   and cm.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       'group by 1,2,3' + #13#10 +
       'order by 1 ';

   Result := FAT_DP_R_SIN_60A.Data;

   FAT_SQ_R_SIN_60A.Close;
end;


function TSM.FAT_DP_R_SIN_60MDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatSin60M:String;
  begin
      {' select BIR.data_movimento,r.serial as ECF_FAB,ecf.ecf_caixa as ECF_CX, '+
      '   r.coo_inicial NUM_DOC_INI, r.coo_final NUM_DOC_FIN, '+
      '   (max(case when bir.SIGLA = ''GT''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) else 0 end)- '+
      '   SUM(case when bir.SIGLA = ''VENDABRUTA''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) END))     AS GT_INI, '+
      '   max(case when bir.SIGLA = ''CRO'' then bir.VALOR else '''' end) CRO, '+
      '   max(case when bir.SIGLA = ''CRZ'' then bir.VALOR else '''' end) CRZ, '+
      '   max(case when bir.SIGLA = ''GT'' then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) else 0 end) GT_FIN, '+
      '   SUM(case when bir.SIGLA = ''VENDABRUTA''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) END) VLR_BRT '+}

    Result :=
        '               select BIR.data_movimento,bir.serial as ECF_FAB,ecf.ecf_caixa as ECF_CX, ' + #13#10 +
        '                 r.coo_inicial NUM_DOC_INI, r.coo_final NUM_DOC_FIN,      ' + #13#10 +
        '                 cast(max(case when bir.SIGLA = ''CRO'' then bir.VALOR else '''' end) as varchar(20)) CRO,' + #13#10 +
        '                 cast(max(case when bir.SIGLA = ''CRZ'' then bir.VALOR else '''' end) as varchar(20)) CRZ,' +
        '                 max(case when bir.SIGLA = ''GT'' then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) else 0 end) GT_FIN, ' + #13#10 +
        '                 SUM(case when bir.SIGLA = ''VENDABRUTA''  then CAST(replace(replace(bir.VALOR,''.'',''''),'','' ,''.'') AS NUMERIC(18,2) ) END) VLR_BRT' + #13#10 +
        '               from BR_ITENS_RZ bir ' + #13#10 +
        '                 left outer join br_reducaoz r on r.serial=BIR.serial and r.data_movimento=BIR.data_movimento ' + #13#10 +
        '                 left outer join cad_tb_c_ecf ecf on ecf.ecf_serial_impressora = bir.serial ';

  end;
begin
  { TODO -oMaxsuel -cCriao : Criado em 01/01/2018 }


   FAT_SQ_R_SIN_60M.Close;

   FAT_SQ_R_SIN_60M.CommandText := enSqlFatSin60M +
       ' where bir.data_movimento >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[0])) ) + ''' ' +
       '   and bir.data_movimento <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' ' +
       ' group by 1,2,3,4,5 '+
       ' order by BIR.data_movimento ';

   Result := FAT_DP_R_SIN_60M.Data;

   FAT_SQ_R_SIN_60M.Close;
end;


function TSM.FAT_DP_R_VISDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatVis: String;
  begin
    Result :=
    ' select vis.*,  '+
    ' vic.id_vis as int_id_vis_cli, '+
    ' fun.nome as int_nomeven, '+
    ' cli.nome as int_nomecli, '+
    ' vic.doc_cnpj_cpf, '+
    ' vic.dta_visita, '+
    ' vic.id_cliente, '+
    ' vic.id_vis_cli '+
    ' from pro_tb_m_vis_cli vic '+
    ' left outer join pro_tb_m_vis vis  on vic.id_vis=vis.id_vis '+
    ' left outer join cad_tb_c_fun fun on fun.id_funcionario=vis.id_vendedor '+
    ' left outer join cad_tb_c_cli cli on cli.id_cliente=vic.id_cliente ';

  end;
begin
  FAT_SQ_R_VIS.Close;
  FAT_SQ_R_VIS.CommandText := enSqlFatVis + ' WHERE VIS.ID_EMPRESA in ('+Input[0]+') ';

  if (Input[1] <> '') and (Input[2] <> '') then
    begin
      FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText +
      ' AND vic.dta_visita >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
      ' AND vic.dta_visita <='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+''' ';

    end;

  if (Input[3] <> '') and (Input[4] <> '') then
    begin
      FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText +
      ' AND VIS.SEMANA = ''' + VarToStr(Input[3]) +''' '+
      ' AND VIS.ANO = ''' + VarToStr(Input[4]) +''' ';
    end;

  if Input[5] <> '0' then
    begin
      if Input[5] = '1' then
        FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText + ' AND VIS.FECHADA = ''F'' '
      else
       FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText + ' AND VIS.FECHADA = ''T'' ';
    end;

  if Input[6] <> '' then
    begin
      FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText + ' AND VIS.ID_VENDEDOR in ('+Input[6]+') ';
    end;

  if Input[7] = '0' then
    begin
      FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText + ' ORDER BY VIS.ID_VIS, VIC.ID_VIS_CLI';
    end
  else
    begin
      FAT_SQ_R_VIS.CommandText := FAT_SQ_R_VIS.CommandText +
      ' ORDER BY VIS.ID_VENDEDOR, VIS.ID_VIS, VIC.ID_VIS_CLI';
    end;

  //CMServerForm.mm.Lines.Add(FAT_SQ_R_VIS.CommandText);
  Result := FAT_DP_R_VIS.Data;
end;



function TSM.FAT_DP_R_VIS_RES_VENDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatResVen: String;
  begin
    Result :=
      ' select id_funcionario, nome from cad_tb_c_fun' + #13#10 +
      ' where id_funcionario in  ' + #13#10 +
      '   (' + #13#10 +
      '     select vic.id_vendedor      ' + #13#10 +
      '       from cad_tb_c_vit vic ' + #13#10 +
      '     where vic.tipo_mobile in (0,3)       ' + #13#10;
  end;
begin
  FAT_SQ_R_VIS_RES_VEN.Close;
  FAT_SQ_R_VIS_RES_VEN.CommandText := enSqlFatResVen + ' and VIC.ID_EMPRESA in ('+Input[0]+') ';

  if (Input[1] <> '') and (Input[2] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText +
      ' AND vic.dta_visita >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
      ' AND vic.dta_visita <='''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+''' ';

    end;

  if (Input[3] <> '') and (Input[4] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText +
        ' AND VIC.SEMANA = ''' + VarToStr(Input[3]) +''' '+
        ' AND VIC.ANO    = ''' + VarToStr(Input[4]) +''' ';
    end;



 { if Input[5] <> '0' then
    begin
      if Input[5] = '1' then
        FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText + ' AND VIS.FECHADA = ''F'' '
      else
       FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText + ' AND VIS.FECHADA = ''T'' ';
    end;  }

  if Input[6] <> '' then
    begin
      FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText + ' AND VIC.ID_VENDEDOR in ('+Input[6]+') ';
    end;

  FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText +

         ' group by 1)';

  FAT_SQ_R_VIS_RES_VEN.CommandText := FAT_SQ_R_VIS_RES_VEN.CommandText + ' ORDER BY ID_FUNCIONARIO ';

  Result := FAT_DP_R_VIS_RES_VEN.Data;
end;

function TSM.FAT_DP_R_VIS_RES_VEN_CLIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatVisResVenCli: String;
  begin
    Result :=
    ' select vis.*,                   '+
    '   vic.id_vis as int_id_vis_cli, '+
    '   fun.nome as int_nomeven, '+
    '   cli.nome as int_nomecli, '+
    '   vic.doc_cnpj_cpf, '+
    '   vic.dta_visita, '+
    '   vic.id_cliente, '+
    '   vic.id_vis_cli '+
    ' from pro_tb_m_vis_cli vic '+
    '   left outer join pro_tb_m_vis vis  on vic.id_vis=vis.id_vis '+
    '   left outer join cad_tb_c_fun fun on fun.id_funcionario=vis.id_vendedor '+
    '   left outer join cad_tb_c_cli cli on cli.id_cliente=vic.id_cliente ';

  end;
begin
  FAT_SQ_R_VIS_RES_VEN_CLI.Close;
  FAT_SQ_R_VIS_RES_VEN_CLI.CommandText :=
    ' select vis.*,                   '+  #13+#10+
    '   vic.id_vis as int_id_vis_cli, '+ #13+#10+
    '   fun.nome as int_nomeven, '+  #13+#10+
    '   cli.nome as int_nomecli, '+  #13+#10+
    '   cli.desenvolvimento, '+  #13+#10+
    '  cast( CASE when cli.desenvolvimento=true then  '+#13+#10+
    '  ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])) )+'''-cli.dta_inicio_desnv) end as int4) as dias_desnv, '+ #13+#10+
    '   vic.doc_cnpj_cpf, '+#13+#10+
    '   vic.dta_visita, '+  #13+#10+
    '   vic.id_cliente, '+  #13+#10+
    '   vic.id_vis_cli '+  #13+#10+
    ' from pro_tb_m_vis_cli vic '+  #13+#10+
    '   left outer join pro_tb_m_vis vis  on vic.id_vis=vis.id_vis '+ #13+#10+
    '   left outer join cad_tb_c_fun fun on fun.id_funcionario=vis.id_vendedor '+#13+#10+
    '   left outer join cad_tb_c_cli cli on cli.id_cliente=vic.id_cliente '+ #13+#10+
    ' WHERE VIS.ID_EMPRESA in ('+Input[0]+') '+#13+#10;

  if (Input[1] <> '') and (Input[2] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText +
             ' and vic.dta_visita >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
             ' and vic.dta_visita <='''  + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+''' ';

    end;

  if (Input[3] <> '') and (Input[4] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText +
      ' AND VIS.SEMANA = ''' + VarToStr(Input[3]) +''' '+
      ' AND VIS.ANO = ''' + VarToStr(Input[4]) +''' ';
    end;

   if  (Input[8] <> '') then
    begin
      if (Input[8] = '0') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText +
          ' AND cli.desenvolvimento = true ';
        end;
      if (Input[8] = '1') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText +
          ' AND (cli.desenvolvimento is not true) ';
        end;
    end;

 { if Input[5] <> '0' then
    begin
      if Input[5] = '1' then
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText + ' AND VIS.FECHADA = ''F'' '
      else
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText  + ' AND VIS.FECHADA = ''T'' ';
    end; }

    FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText + ' AND VIS.ID_VENDEDOR = '''+Input[6]+''' ';


  if Input[7] = '0' then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText + ' ORDER BY VIS.ID_VIS, VIC.ID_VIS_CLI';
    end
  else
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText +
          ' ORDER BY VIS.ID_VENDEDOR, VIS.ID_VIS, VIC.ID_VIS_CLI';
    end;

  //CMServerForm.mm.Lines.Add(FAT_SQ_R_VIS.CommandText);
  Result := FAT_DP_R_VIS_RES_VEN_CLI.Data;
end;


function TSM.FAT_DP_R_VIS_RES_VEN_CLI_EXTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatVisVenCliExt: String;
  begin
    enSqlFatVisVenCliExt :=
     '  select cli.id_cliente, cli.nome, vit.dta_visita  from cad_tb_c_vit vit ' +
     '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) ';
  end;
begin
  FAT_SQ_R_VIS_RES_VEN_CLI_EXT.Close;
  FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText :=
        '  select cli.id_cliente, cli.nome, '+ #13+#10+
        '  cli.desenvolvimento,             '+ #13+#10+
        '  cast( CASE when cli.desenvolvimento=true then  '+ #13+#10+
        '  ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])) )+'''-cli.dta_inicio_desnv) end as int4) as dias_desnv, '+#13+#10+
        ' vit.dta_visita  from cad_tb_c_vit vit ' + #13+#10+
        '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) '+ #13+#10+
        ' WHERE  VIT.ID_EMPRESA in ('+Input[0]+') '      + #13+#10+
        '   AND  VIT.ID_VENDEDOR = '''+Input[6]+'''  and tipo_mobile in (0,3) ';

  if  (Input[8] <> '') then
    begin
      if (Input[8] = '0') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
          ' AND cli.desenvolvimento = true ';
        end;
      if (Input[8] = '1') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
          ' AND (cli.desenvolvimento is not true) ';
        end;
    end;


  FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
       ' and vit.id_cliente not in  ';

  if (Input[1] <> '') and (Input[2] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[1]))) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[2]))) +'''  '+
            '    and vis.id_vendedor = '''+Input[6]+''') ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[1]))) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[2]))) +'''  ';
    end;

  if (Input[3] <> '') and (Input[4] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
        '          (                                                       ' +
        '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
        '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
        '  where                                     ' +
        '  extract(year from vcl.dta_visita) = ''' + VarToStr(Input[4]) +''' ' +
        '    and vis.semana >= '''+ VarToStr(Input[3]) + '''  and vis.semana <=  '''+VarToStr(Input[3])+''' ' +
        '    and vis.id_vendedor = '''+Input[6]+''') ' +
        '    and vit.semana >= '''+ VarToStr(Input[3]) + '''  and vit.semana <=  '''+VarToStr(Input[3])+''' ';
    end;

 { if Input[5] <> '0' then
    begin
      if Input[5] = '1' then
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText + ' AND VIS.FECHADA = ''F'' '
      else
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText  + ' AND VIS.FECHADA = ''T'' ';
    end;   }




      FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_EXT.CommandText +
            ' GROUP BY 1,2,3,4,5 '  +
            ' ORDER BY vit.dta_visita ';

  //CMServerForm.mm.Lines.Add(FAT_SQ_R_VIS.CommandText);
  Result := FAT_DP_R_VIS_RES_VEN_CLI_EXT.Data;

  FAT_SQ_R_VIS_RES_VEN_CLI_EXT.close;

end;

function TSM.FAT_DP_R_VIS_RES_VEN_CLI_PRODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFatVisVenCli: String;
  begin
     enSqlFatVisVenCli :=
     '  select cli.id_cliente, cli.nome, vit.dta_visita  from cad_tb_c_vit vit ' +
     '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) ';
  end;
begin

  FAT_SQ_R_VIS_RES_VEN_CLI_PRO.Close;
  FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText :=
     '  select cli.id_cliente, cli.nome, '+
     '   cli.desenvolvimento, '+
     '  cast( CASE when cli.desenvolvimento=true then  '+
     '  ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])) )+'''-cli.dta_inicio_desnv) end as int4) as dias_desnv, '+
     ' vit.dta_visita  from cad_tb_c_vit vit ' +
     '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) '+
     '    WHERE VIT.ID_EMPRESA in ('+Input[0]+') '   +
     '     AND VIT.ID_VENDEDOR in ('+Input[6]+') and tipo_mobile in (0,3) ';


  if  (Input[8] <> '') then
    begin
      if (Input[8] = '0') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
          ' AND cli.desenvolvimento = true ';
        end;
      if (Input[8] = '1') then
        begin
          FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
          ' AND (cli.desenvolvimento is not true) ';
        end;
    end;

  FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
         ' and vit.id_cliente in  ';

  if (Input[1] <> '') and (Input[2] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[1]))) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[2]))) +'''  '+
            '    and vis.id_vendedor = '''+Input[6]+''') ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[1]))) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(VarToStr(Input[2]))) +'''  ';
    end;

  if (Input[3] <> '') and (Input[4] <> '') then
    begin
      FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
        '          (                                                       ' +
        '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
        '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
        '  where                                     ' +
        '  extract(year from vcl.dta_visita) = ''' + VarToStr(Input[4]) +''' ' +
        '    and vis.semana >= '''+ VarToStr(Input[3]) + '''  and vis.semana <=  '''+VarToStr(Input[3])+''' ' +
        '    and vis.id_vendedor = '''+Input[6]+''') ' +
        '    and vit.semana >= '''+ VarToStr(Input[3]) + '''  and vit.semana <=  '''+VarToStr(Input[3])+''' ';
    end;

 { if Input[5] <> '0' then
    begin
      if Input[5] = '1' then
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText + ' AND VIS.FECHADA = ''F'' '
      else
         FAT_SQ_R_VIS_RES_VEN_CLI.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI.CommandText  + ' AND VIS.FECHADA = ''T'' ';
    end;   }




      FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText := FAT_SQ_R_VIS_RES_VEN_CLI_PRO.CommandText +
            ' GROUP BY 1,2,3,4,5 ' +
            ' ORDER BY vit.dta_visita ';

  //CMServerForm.mm.Lines.Add(FAT_SQ_R_VIS.CommandText);
  Result := FAT_DP_R_VIS_RES_VEN_CLI_PRO.Data;

  FAT_SQ_R_VIS_RES_VEN_CLI_PRO.close;
end;

function TSM.FAT_DP_M_ETGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinETG: String;
  begin
    Result :=
     ' select etg.*,fpg.descricao as int_nomefpg,mta.nome as int_nome_mot    '+
     '  from fat_tb_m_etg etg                                                 '+
     '  left outer join pcp_tb_c_mta mta on mta.id_motorista=etg.id_motorista  '+
     '  left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=etg.id_forma_pag ';
  end;
begin

   FAT_SQ_M_ETG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_ETG.CommandText := enSqlFinETG + ' WHERE 1=2 '
        else
          begin
            FAT_SQ_M_ETG.CommandText := enSqlFinETG +
             ' WHERE  etg.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' and etg.id_entrega = ''' + VarToStr(Input[2]) + ''' ';
         end;
      end
   else if Input[0] = 1 then
      begin
        FAT_SQ_M_ETG.CommandText := enSqlFinETG +
             ' WHERE etg.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND etg.id_pedido = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FAT_SQ_M_ETG.CommandText := enSqlFinETG +
             ' WHERE etg.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := FAT_DP_M_ETG.Data;
   FAT_SQ_M_ETG.Close;
end;

function TSM.FAT_DP_M_IQMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlFatIqm: String;
  begin
    Result := '  select iqm.* ,  ' +
              '  frn.fantasia as int_nomefor ' +
              '  from fat_tb_m_iqm iqm ' +
              '  left outer join cad_tb_c_for frn on frn.id_fornecedor = iqm.id_emitente';
  end;
begin
   FAT_SQ_M_IQM.Close;


   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
             ' WHERE iqm.id_iqm = ''' + VarToStr(Input[1]) +'''  ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
               ' WHERE iqm.numero_nf = ''' + VarToStr(Input[1]) +''' ' +
               '   and iqm.id_empresa = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
             ' WHERE iqm.id_emitente = ''' + VarToStr(Input[1]) +''' ' +
             '   and iqm.id_empresa = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
          Format(' WHERE upper(frn.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]) +
          '   and iqm.id_empresa = ''' + VarToStr(Input[2]) +''' ';;
      end
   else if Input[0] = 4 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
               ' WHERE iqm.dta_recebimento = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
               '   and iqm.id_empresa = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
               ' WHERE iqm.dta_recebimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
               '       iqm.dta_recebimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
               '   and iqm.id_empresa = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
               ' WHERE exists  (select mite.* from fat_tb_m_iqm_ite mite where mite.id_iqm=iqm.id_iqm and mite.id_item='+
                  Input[1]+')';
      end
   else if Input[0] = 7 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm + ' WHERE 1=2 '
        else
           FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
               ' WHERE exists (select mite.* from fat_tb_m_iqm_ite mite ' +
               ' left outer join cad_tb_c_ite ite on ite.id_item=mite.id_item '+
               ' where  mite.id_iqm=iqm.id_iqm and '+
               Format(' upper(ite.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))])+')';
      end
   else if Input[0] = 90 then
      begin
        FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
            ' WHERE iqm.situacao = 0 and iqm.id_emitente = ''' + VarToStr(Input[1]) +''' ' +
            '   and iqm.numero_nf = ''' + VarToStr(Input[2]) +''' ' +
            '   and iqm.serie = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        FAT_SQ_M_IQM.CommandText := enSqlFatIqm +
            ' WHERE iqm.id_iqm <> ''' + VarToStr(Input[1]) +''' ' +
            '   and iqm.id_emitente = ''' + VarToStr(Input[2]) + ''' ' +
            '   and iqm.numero_nf = ''' + VarToStr(Input[3]) + ''' ' +
            '   and iqm.serie = ''' + VarToStr(Input[4]) + ''' ';
            if input[5] <> '' then
               begin
                 FAT_SQ_M_IQM.CommandText := FAT_SQ_M_IQM.CommandText +
                     '   and iqm.sub_serie = ''' + VarToStr(Input[5]) +''' ';
               end;
      end;

   FAT_SQ_M_IQM.CommandText := FAT_SQ_M_IQM.CommandText + ' order by iqm.id_iqm desc ';
   //GerarSqlTxt(FAT_SQ_M_IQM);
   Result := FAT_DP_M_IQM.Data;
   FAT_SQ_M_IQM.Close;
end;

procedure TSM.FAT_DP_M_IQMUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
   FAT_CD_M_IQM_ITE, CMP_CD_M_PED_ITE, CMP_CD_M_PED_IQM, CMP_CD_M_PED_IQM_ITE: TDataSet;
   CMP_CD_M_PED, FAT_CD_M_IQM_ITE_INT: TClientdataset;
   Arquivo: TextFile;
   lTexto:String;
   oldQtde, oldQtdeIteIqm: Extended;
   lGravaPed: Boolean;
   lCodSeq: Integer;

begin
  { TODO -oMaxsuel -cCriao : Mtodo criado pelo grande Maxsuel Victor em 24/10/2014. }
  CMP_CD_M_PED := TClientDataSet.Create(self);
  CMP_CD_M_PED.SetProvider(CMP_DP_M_PED);

  lGravaPed := false;




  FAT_CD_M_IQM_ITE     := TDataSetField(Dataset.FieldByName('FAT_SQ_M_IQM_ITE')).NestedDataSet;


  try
       // Se o IQM no estiver em modo de Excluso
     if not (dataset.UpdateStatus in [usDeleted]) then
        begin

          if dataset.FieldByName('id_pedido_compra').AsInteger > 0 then
             begin
               CMP_CD_M_PED.Close;
               CMP_CD_M_PED.Data :=
                   CMP_CD_M_PED.DataRequest(
                        VarArrayOf([0,dataset.FieldByName('id_pedido_compra').AsInteger]));

               CMP_CD_M_PED_ITE     := TDataSetField(CMP_CD_M_PED.FieldByName('CMP_SQ_M_PED_ITE')).NestedDataSet;
               CMP_CD_M_PED_IQM     := TDataSetField(CMP_CD_M_PED.FieldByName('CMP_SQ_M_PED_IQM')).NestedDataSet;
               CMP_CD_M_PED_IQM_ITE := TDataSetField(CMP_CD_M_PED_IQM.FieldByName('CMP_SQ_M_PED_IQM_ITE')).NestedDataSet;

               CMP_CD_M_PED.Edit;

               // Se o IQM estiver em modo de Insero
               if (dataset.UpdateStatus in [usInserted]) then
                   begin

                     CMP_CD_M_PED_IQM.Insert;
                     CMP_CD_M_PED_IQM.FieldByName('ID_IQM').AsInteger    :=
                             dataset.FieldByName('id_iqm').AsInteger;
                     CMP_CD_M_PED_IQM.FieldByName('ID_PEDIDO').AsInteger :=
                             dataset.FieldByName('id_pedido_compra').AsInteger;

                     FAT_CD_M_IQM_ITE.First;
                     while not FAT_CD_M_IQM_ITE.Eof do
                        begin

                          // Cria um registro novo na tabela itens do iqm do pedido de compra
                          CMP_CD_M_PED_IQM_ITE.Insert;
                          CMP_CD_M_PED_IQM_ITE.FieldByName('ID_SEQUENCIA').AsInteger   := FAT_CD_M_IQM_ITE.FieldByName('ID_SEQUENCIA_ITE_CMP_PED').AsInteger;
                          CMP_CD_M_PED_IQM_ITE.FieldByName('id_item').AsInteger        := FAT_CD_M_IQM_ITE.FieldByName('id_item').AsInteger;
                          CMP_CD_M_PED_IQM_ITE.FieldByName('id_cor').text              := FAT_CD_M_IQM_ITE.FieldByName('id_cor').text;
                          CMP_CD_M_PED_IQM_ITE.FieldByName('id_tamanho').text          := FAT_CD_M_IQM_ITE.FieldByName('id_tamanho').text;


                          if CMP_CD_M_PED_ITE.Locate('ID_SEQUENCIA',FAT_CD_M_IQM_ITE.FieldByName('ID_SEQUENCIA_ITE_CMP_PED').AsString,[]) then
                             begin
                                // Atualizando a tabela CMP_CD_M_PED_ITE
                                CMP_CD_M_PED_ITE.edit;

                                if (FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat >
                                     CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat) or

                                   (FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat >
                                        (CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat -
                                         CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat))  then
                                   begin
                                     {CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                         CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat;

                                     // Preenche o campo qtde do registro da tabela de itens do iqm do pedido de compra
                                     CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                         CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat; }

                                     CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                         FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                     CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                         FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;
                                   end
                                else
                                   begin
                                     CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                            CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat +
                                            FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                     CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                         FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;
                                   end;
                                CMP_CD_M_PED_ITE.FieldByName('qtde_a_baixar').AsFloat := 0;

                                CMP_CD_M_PED_IQM_ITE.Post;

                                CMP_CD_M_PED_ITE.Post;
                             end;
                          FAT_CD_M_IQM_ITE.Next;
                          lGravaPed := true;
                        end;
                   end
               else
                  begin
                     CMP_CD_M_PED_IQM.Filtered := false;
                     CMP_CD_M_PED_IQM.Filtered := true;
                     CMP_CD_M_PED_IQM.Filter   := ' ID_IQM = ' + dataset.FieldByName('id_iqm').Text;

                     CMP_CD_M_PED_ITE.First;
                     CMP_CD_M_PED_IQM_ITE.First;


                     FAT_CD_M_IQM_ITE.First;
                     while not FAT_CD_M_IQM_ITE.eof do
                           begin
                              lCodSeq := 0;
                              oldQtdeIteIqm := 0;
                              oldQtde := FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                              // Caso o registro do FAT_CD_M_IQM_ITE tenha sofrido alterao o sistema trar
                              // dois registros: o original e o modificado(traz os valoes apenas das colunas que
                              // foram alteradas
                              // Esse if pega o registro original
                              if FAT_CD_M_IQM_ITE.UpdateStatus in [usUnmodified] then
                                 begin
                                   oldQtde := FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;
                                   lCodSeq := FAT_CD_M_IQM_ITE.FieldByName('ID_SEQUENCIA_ITE_CMP_PED').AsInteger;
                                   FAT_CD_M_IQM_ITE.Next;
                                 end;
                              // caso o campo qtde tenha sido alterado
                              if oldQtde <> FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat then
                                 begin
                                   if lCodSeq > 0 then
                                      begin
                                        if CMP_CD_M_PED_ITE.Locate('ID_SEQUENCIA',lCodSeq,[]) then
                                           begin
                                              CMP_CD_M_PED_IQM_ITE.Locate('ID_SEQUENCIA',lCodSeq,[]);

                                              // Atualizando a tabela CMP_CD_M_PED_ITE
                                              CMP_CD_M_PED_ITE.edit;
                                              CMP_CD_M_PED_IQM_ITE.edit;

                                             { if (FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat >
                                                  CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat) or

                                                 (FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat >
                                                      (CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat -
                                                       CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat)) then
                                                 begin
                                                   oldQtdeIteIqm := CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat;
                                                   {
                                                   // Atualiza o campo qtde do registro da
                                                   //     tabela de itens do iqm do pedido de compra
                                                   CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                                       CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat -
                                                       (CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat -
                                                        oldQtdeIteIqm);

                                                   CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                                      CMP_CD_M_PED_ITE.FieldByName('qtde').AsFloat; }

                                                   // Atualiza o campo qtde do registro da
                                                   //     tabela de itens do iqm do pedido de compra
                                            {       CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                                      FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                                   CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                                      (CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat - oldQtde)
                                                         FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;
                                                 end
                                              else
                                                 begin

                                                   // Atualiza o campo qtde do registro da
                                                   //     tabela de itens do iqm do pedido de compra
                                                   CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                                       FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                                   CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                                      (CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat -
                                                         oldQtde) + FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                                 end;   }

                                              CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat :=
                                                     FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                                 CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat :=
                                                    (CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat -
                                                       oldQtde) + FAT_CD_M_IQM_ITE.FieldByName('qtde').AsFloat;

                                              lGravaPed := true;
                                              CMP_CD_M_PED_ITE.FieldByName('qtde_a_baixar').AsFloat := 0;


                                              CMP_CD_M_PED_ITE.Post;
                                              CMP_CD_M_PED_IQM_ITE.Post;
                                           end;
                                      end;
                                 end;
                              FAT_CD_M_IQM_ITE.Next;
                              // fim CMP_CD_M_PED_ITE
                           end;
                  end;
               FAT_CD_M_IQM_ITE.First;

               // Atualizando o Pedido de Compra
               CMP_CD_M_PED_ITE.Filtered := true;
                     CMP_CD_M_PED_ITE.Filter   := ' QTDE <> QTDE_BAIXADA ';

                 //  STATUS
                 //  0 - pendente
                 //  1 - entregue parcial
                 //  2 - entregue total
                 //  3 - finalizado

               if not CMP_CD_M_PED_ITE.IsEmpty then
                      CMP_CD_M_PED.FieldByName('STATUS').AsInteger := 1
               else
                      CMP_CD_M_PED.FieldByName('STATUS').AsInteger := 2;

               CMP_CD_M_PED_ITE.Filtered := false;
               CMP_CD_M_PED_IQM.Filtered := false;
               CMP_CD_M_PED.Post;
             end;
        end
    else
        begin
          // Esse else significa que o FAT_TB_M_IQM ser deletado com isso caso
          // ele tenha pedido de compra o mesmo dever ser atualizado.

          if dataset.FieldByName('id_pedido_compra').AsInteger > 0 then
             begin
               FAT_CD_M_IQM_ITE_INT := TClientDataSet.Create(self);
               FAT_CD_M_IQM_ITE_INT.SetProvider(FAT_DP_M_IQM_ITE_INT);

               FAT_CD_M_IQM_ITE_INT.Close;
               FAT_CD_M_IQM_ITE_INT.Data :=
                          FAT_CD_M_IQM_ITE_INT.DataRequest(VarArrayOf([Dataset.FieldByName('ID_IQM').text]));

               CMP_CD_M_PED.Close;
               CMP_CD_M_PED.Data :=
                   CMP_CD_M_PED.DataRequest(
                      VarArrayOf([0,dataset.FieldByName('id_pedido_compra').AsInteger]));


               CMP_CD_M_PED_ITE     := TDataSetField(CMP_CD_M_PED.FieldByName('CMP_SQ_M_PED_ITE')).NestedDataSet;
               CMP_CD_M_PED_IQM     := TDataSetField(CMP_CD_M_PED.FieldByName('CMP_SQ_M_PED_IQM')).NestedDataSet;
               CMP_CD_M_PED_IQM_ITE := TDataSetField(CMP_CD_M_PED_IQM.FieldByName('CMP_SQ_M_PED_IQM_ITE')).NestedDataSet;

               if not CMP_CD_M_PED.IsEmpty then
                   begin
                     CMP_CD_M_PED_IQM.Filtered := false;
                     CMP_CD_M_PED_IQM.Filtered := true;
                     CMP_CD_M_PED_IQM.Filter   := ' ID_IQM = ' + dataset.FieldByName('id_iqm').Text;


                     FAT_CD_M_IQM_ITE_INT.First;
                     while not FAT_CD_M_IQM_ITE_INT.Eof do
                        begin
                          if CMP_CD_M_PED_ITE.Locate('ID_SEQUENCIA',
                                                     FAT_CD_M_IQM_ITE_INT.FieldByName('id_sequencia_ite_cmp_ped').AsInteger,[]) then
                             begin
                               CMP_CD_M_PED_IQM_ITE.Locate('ID_SEQUENCIA',FAT_CD_M_IQM_ITE_INT.FieldByName('id_sequencia_ite_cmp_ped').AsInteger,[]);

                               CMP_CD_M_PED_ITE.edit;
                               CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat := CMP_CD_M_PED_ITE.FieldByName('qtde_baixada').AsFloat -
                                                                                       CMP_CD_M_PED_IQM_ITE.FieldByName('qtde').AsFloat;
                               CMP_CD_M_PED_ITE.Post;
                               CMP_CD_M_PED_IQM_ITE.Delete;
                               lGravaPed := true;
                             end;
                          FAT_CD_M_IQM_ITE_INT.Next;
                        end;
                     CMP_CD_M_PED_IQM.delete;

                     // Atualizando o Pedido de Compra
                     CMP_CD_M_PED_ITE.Filtered := true;
                     CMP_CD_M_PED_ITE.Filter   := ' QTDE_BAIXADA > 0';

                       //  STATUS
                       //  0 - pendente
                       //  1 - entregue parcial
                       //  2 - entregue total
                       //  3 - finalizado


                     CMP_CD_M_PED.Edit;
                     if not CMP_CD_M_PED_ITE.IsEmpty then
                            CMP_CD_M_PED.FieldByName('STATUS').AsInteger := 1
                     else
                        CMP_CD_M_PED.FieldByName('STATUS').AsInteger := 0;

                     CMP_CD_M_PED_ITE.Filtered := false;
                     CMP_CD_M_PED.Post;
                   end;
                end;
        end;

  //Grava no banco
  if lGravaPed then
      begin
        if dataset.FieldByName('id_pedido_compra').AsInteger > 0 then
           begin
             if not (CMP_CD_M_PED.ApplyUpdates(0) = 0) then
                begin
                  abort;
                end;
           end;
      end;

  finally
    {AssignFile(Arquivo,'c:\logs\teste.txt');
     Rewrite(Arquivo); //abre o arquivo para escrita
     Writeln(Arquivo,lTexto);
     Closefile(Arquivo); //fecha o handle de arquivo
    }

    dspUpdateData(Sender, DataSet);
    CMP_CD_M_PED.Free;
    FAT_CD_M_IQM_ITE_INT.Free;
  end;

end;

function TSM.FAT_DP_M_IQM_ITE_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin

   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 25/10/2014}

   FAT_SQ_M_IQM_ITE_INT.Close;
   FAT_SQ_M_IQM_ITE_INT.CommandText :=
         ' SELECT * FROM FAT_TB_M_IQM_ITE ' +
         ' WHERE ID_IQM = ''' + VarToStr(Input[0]) +''' ';

   //GerarSqlTxt(FAT_SQ_M_IQM_ITE_INT);
   Result := FAT_DP_M_IQM_ITE_INT.Data;
end;

function TSM.FAT_DP_M_MKTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlPca: String;
  begin
    Result :=
              ' select mkt.*,                      ' +
              '   fun.nome as int_nomeresp,        ' +
              '   rot.descricao as int_nomerot,    ' +
              '   par.emp_fantasia as int_nomefan  ' +
              ' from fat_tb_m_mkt mkt              ' +
              '      left outer join cad_tb_c_fun  fun on  ' +
              '                    (fun.id_funcionario = mkt.id_responsavel) ' +
              '      left outer join pcp_tb_c_rot  rot on  ' +
              '                    (rot.id_rota = mkt.id_rota) ' +
              '     left outer join cad_tb_c_par par on        ' +
              '                    (par.id_empresa = mkt.id_empresa) ';

  end;
begin
   { TODO -oMaxsuel : Criado em 02/12/2016 }
   FAT_SQ_M_MKT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FAT_SQ_M_MKT.CommandText := enSqlPca + ' WHERE 1 = 2 '
        else
           FAT_SQ_M_MKT.CommandText := enSqlPca +
             ' WHERE mkt.id_mkt = ''' + VarToStr(Input[2]) + ''' ';

        if Input[3] <> 0 then
           FAT_SQ_M_MKT.CommandText := FAT_SQ_M_MKT.CommandText +
                                       ' and mkt.id_responsavel = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FAT_SQ_M_MKT.CommandText := enSqlPca +
           ' WHERE mkt.id_empresa = ''' + VarToStr(Input[1]) + ''' ' +
           '  and MKT.DTA_CRIACAO = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
           if Input[3] <> 0 then
              FAT_SQ_M_MKT.CommandText := FAT_SQ_M_MKT.CommandText +
                                   ' and mkt.id_responsavel = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 2 then
      begin
        FAT_SQ_M_MKT.CommandText := enSqlPca +
             ' WHERE mkt.id_empresa = ''' + VarToStr(Input[1]) + ''' ' +
             '   and mkt.id_vis = ''' + VarToStr(Input[2]) + ''' ';
        if Input[3] <> 0 then
           FAT_SQ_M_MKT.CommandText := FAT_SQ_M_MKT.CommandText +
                                       ' and mkt.id_responsavel = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 3 then
      begin
        FAT_SQ_M_MKT.CommandText := enSqlPca +
             ' WHERE mkt.id_empresa = ''' + VarToStr(Input[1]) + ''' ' +
             '   and exists ' +
             '       ( select id_mkt from fat_tb_m_mkt_ped mpd ' +
             '         where mpd.id_mkt = mkt.id_mkt ' +
             '           and mpd.id_pedido = '''  + VarToStr(Input[2]) + ''') ';
        if Input[3] <> 0 then
           FAT_SQ_M_MKT.CommandText := FAT_SQ_M_MKT.CommandText +
                                       ' and mkt.id_responsavel = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 4 then
      begin
        FAT_SQ_M_MKT.CommandText := enSqlPca +
             ' WHERE mkt.id_empresa = ''' + VarToStr(Input[1]) + ''' ' +
             '   and exists ' +
             '       ( select id_cliente from fat_tb_m_mkt_cli mcl ' +
             '         where mcl.id_mkt = mkt.id_mkt ' +
             '           and mcl.id_cliente = '''  + VarToStr(Input[2]) + ''') ';
        if Input[3] <> 0 then
           FAT_SQ_M_MKT.CommandText := FAT_SQ_M_MKT.CommandText +
                                       ' and mkt.id_responsavel = ''' + VarToStr(Input[3]) + ''' ';
      end;

   Result := FAT_DP_M_MKT.Data;

   FAT_SQ_M_MKT.Close;
end;

procedure TSM.FAT_DP_M_MKTGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 02/12/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FAT_DP_M_MKTUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin

  FAT_RN_M_MKT.FAT_DP_M_MKTUpdateData(sender,dataset,BuscarConnBanco);

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 02/12/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_BRDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinBrd: String;
  begin
    Result :=
       ' SELECT brd.*,                    ' +
       '   ctc.descricao as int_nomectc,  ' +
       '   tif.descricao as int_nometif,  ' +
       '   fpg.descricao as int_nomefpg,  ' +
       '   fun.nome as int_nomeresp_cria, ' +
       '   fca.nome as int_nomeresp_lib,  ' +
       '   fcc.nome as int_nomeresp_bxa,  ' +
       '   fcn.nome as int_nomeresp_can  ' +
       ' FROM fin_tb_m_brd brd            ' +
       '                                  ' +
       '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON fpg.id_forma_pag = brd.id_forma_pag             ' +
       '  left outer join cad_tb_c_ctc ctc on ctc.id_conta = brd.id_conta                     ' +
       '  LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.id_abertura=brd.id_abertura                 ' +
       '  left outer join cad_tb_c_tif tif on tif.id_tipo_financeiro = brd.id_tipo_financeiro ' +
       '  left outer join cad_tb_c_fun fun on fun.id_funcionario = brd.id_resp_criacao        ' +
       '  left outer join cad_tb_c_fun fca on fca.id_funcionario = brd.id_resp_lib            ' +
       '  left outer join cad_tb_c_fun fcc on fcc.id_funcionario = brd.id_resp_bxa ' +
       '  left outer join cad_tb_c_fun fcn on fcn.id_funcionario = brd.id_resp_canc ';
  end;

begin

   FIN_SQ_M_BRD.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_BRD.CommandText := enSqlFinBrd + ' WHERE 1=2 '
        else
           FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
             ' WHERE  brd.id_brd = ''' + VarToStr(Input[1]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
             ' WHERE brd.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND brd.dta_criacao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
             ' WHERE brd.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND brd.dta_lib = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
             ' WHERE brd.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND brd.dta_bxa = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
          ' WHERE BRD.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          Format(' AND upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 5 then
      begin
        FIN_SQ_M_BRD.CommandText := enSqlFinBrd +
          ' WHERE BRD.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ';

        if VarToStr(Input[2])='0' then
           FIN_SQ_M_BRD.CommandText :=  FIN_SQ_M_BRD.CommandText +
              ' AND BRD.LIBERADO=FALSE AND BRD.BAIXADO=FALSE AND BRD.CANCELADO=FALSE  ';

        if VarToStr(Input[2])='1' then
           FIN_SQ_M_BRD.CommandText :=  FIN_SQ_M_BRD.CommandText +
              ' AND BRD.LIBERADO=TRUE AND BRD.BAIXADO=FALSE AND BRD.CANCELADO=FALSE  ';

        if VarToStr(Input[2])='2' then
           FIN_SQ_M_BRD.CommandText :=  FIN_SQ_M_BRD.CommandText +
              ' AND BRD.BAIXADO=TRUE AND BRD.CANCELADO=FALSE  ';

        if VarToStr(Input[2])='3' then
           FIN_SQ_M_BRD.CommandText :=  FIN_SQ_M_BRD.CommandText +
              ' AND BRD.CANCELADO=TRUE  ';

      end;

   FIN_SQ_M_BRD.CommandText := FIN_SQ_M_BRD.CommandText + ' order by brd.id_brd  desc';

   Result := FIN_DP_M_BRD.Data;

   FIN_SQ_M_BRD.Close;

end;

procedure TSM.FIN_DP_M_BRDGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin

   enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_BRDUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_BRD.FIN_DP_M_BRDUpdateData(sender,DataSet,self);

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 28/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_CBXDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlCbx: String;
  begin
    Result :=
     ' select cbx.*,fpg.descricao as int_nomefpg from fin_tb_m_cbx cbx '+
     ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=cbx.id_forma_pag ';
  end;
begin
   { TODO -oLuan : Criado no dia 18/01/2016 }

   FIN_SQ_M_CBX.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_CBX.CommandText := enSqlCbx + ' WHERE 1=2 '
        else
           FIN_SQ_M_CBX.CommandText := enSqlCbx +
             ' WHERE CBX.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
             '   CBX.ID_CBX = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_CBX.CommandText := enSqlCbx +
          ' WHERE CBX.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          '   CBX.DTA_BAIXA = ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) )  +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_CBX.CommandText := enSqlCbx +
          ' WHERE CBX.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and ' +
          Format('upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);

      end;
   Result := FIN_DP_M_CBX.Data;
end;

procedure TSM.FIN_DP_M_CBXUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
VAR
 xTitulos:string;
 cds:TDataSet;
 FIN_CD_M_REC,FIN_CD_M_CTA,FIN_CD_M_REC_PAG,BUS_CD_M_CBX_TIT:TClientdataset;
Begin
 BUS_CD_M_CBX_TIT:=TClientDataSet.Create(nil);
 FIN_CD_M_REC:=TClientDataSet.Create(nil);
 FIN_CD_M_REC_PAG:= TClientDataSet.Create(nil);
 FIN_CD_M_CTA:= TClientDataSet.Create(nil);
 xTitulos := '';
 try
    if (dataset.UpdateStatus in [usInserted]) then
       begin
         FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
         FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
          FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
         cds := TDataSetField(Dataset.FieldByName('FIN_SQ_M_CBX_TIT')).NestedDataSet;
         while not (cds.Eof)  do
           begin
               if xTitulos <> '' then
                  begin
                    xTitulos :=
                    xTitulos + ',' +''''+ cds.FieldByName('ID_TITULO').AsString+'''';
                  end;
               if xTitulos = '' then
                  begin
                    xTitulos :=
                    xTitulos +''''+cds.FieldByName('ID_TITULO').AsString+'''';
                  end;
              if cds.UpdateStatus in [usUnmodified] then
                 begin
                   cds.Next;
                 end;
               cds.Next;
            end;

            FIN_CD_M_REC.Close;
            FIN_CD_M_REC.Data :=
            FIN_CD_M_REC.DataRequest(VarArrayOf([91, xTitulos]));

            cds.First;
            while not cds.Eof do
              begin
                FIN_CD_M_REC.Locate('ID_TITULO',varArrayOf([cds.FieldByName('ID_TITULO').AsString]),[]);
                FIN_CD_M_REC.Edit;
                FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency  :=
                                         FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency
                                         -  (cds.FieldByName('VLR_LIQUIDO').asCurrency +
                                              cds.FieldByName('VLR_DESCONTO_OPE').asCurrency +
                                              cds.FieldByName('VLR_DESCONTO_ANTEC').asCurrency);

                 FIN_CD_M_REC.Post;
                cds.Next;
              end;

             FIN_CD_M_CTA.Close;
             FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));
            // FIN_CD_M_CTA  := TClientDataSet.Create(self);
             enGerFinCxaBco(sender,3,dataset,cds,FIN_CD_M_CTA,0);
             enGerFinRecPag(sender,2,dataset,cds,FIN_CD_M_REC_PAG,0,'');


       end;

     if (dataset.UpdateStatus in [usDeleted]) then
       begin
          BUS_CD_M_CBX_TIT.SetProvider(BUS_DP_M_CBX_TIT);
          FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
          FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);

          BUS_CD_M_CBX_TIT.Close;
          BUS_CD_M_CBX_TIT.Data :=
          BUS_CD_M_CBX_TIT.DataRequest(VarArrayOf([0, Dataset.FieldByName('ID_CBX').AsString]));

          {cds := TDataSetField(Dataset.FieldByName('FIN_SQ_M_CBX_TIT')).NestedDataSet;
          cds.First;
         while not (cds.Eof)  do
           begin
               if xTitulos <> '' then
                  begin
                    xTitulos :=
                    xTitulos + ',' +''''+ cds.FieldByName('ID_TITULO').AsString+'''';
                  end;
               if xTitulos = '' then
                  begin
                    xTitulos :=
                    xTitulos +''''+cds.FieldByName('ID_TITULO').AsString+'''';
                  end;
              if cds.UpdateStatus in [usUnmodified] then
                 begin
                   cds.Next;
                 end;
               cds.Next;
            end;  }

         BUS_CD_M_CBX_TIT.First;
         while not (BUS_CD_M_CBX_TIT.Eof)  do
           begin
               if xTitulos <> '' then
                  begin
                    xTitulos :=
                    xTitulos + ',' +''''+ BUS_CD_M_CBX_TIT.FieldByName('ID_TITULO').AsString+'''';
                  end;
               if xTitulos = '' then
                  begin
                    xTitulos :=
                    xTitulos +''''+BUS_CD_M_CBX_TIT.FieldByName('ID_TITULO').AsString+'''';
                  end;
                BUS_CD_M_CBX_TIT.Next;
            end;



            FIN_CD_M_REC.Close;
            FIN_CD_M_REC.Data :=
            FIN_CD_M_REC.DataRequest(VarArrayOf([91, xTitulos]));

            BUS_CD_M_CBX_TIT.First;
            while not BUS_CD_M_CBX_TIT.Eof do
              begin
                FIN_CD_M_REC.Locate('ID_TITULO',varArrayOf([BUS_CD_M_CBX_TIT.FieldByName('ID_TITULO').AsString]),[]);
                FIN_CD_M_REC.Edit;
                FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency  :=
                                         FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency   +
                                           BUS_CD_M_CBX_TIT.FieldByName('VLR_BRUTO').asCurrency;
                 FIN_CD_M_REC.Post;
                 BUS_CD_M_CBX_TIT.Next;
              end;

            FIN_CD_M_REC_PAG := TClientDataSet.Create(nil);
            FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
            FIN_CD_M_REC_PAG.Close;
            FIN_CD_M_REC_PAG.Data :=
            FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([5,DataSet.FieldByName('ID_CBX').AsString]));
            if not (FIN_CD_M_REC_PAG.IsEmpty) then
               begin
                 FIN_CD_M_REC_PAG.First;
                 while not (FIN_CD_M_REC_PAG.Eof) do
                    begin
                      FIN_CD_M_REC_PAG.Delete;
                    end;
               end;

            FIN_CD_M_CTA := TClientDataSet.Create(nil);
            FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
            FIN_CD_M_CTA.Close;
            FIN_CD_M_CTA.Data :=
            FIN_CD_M_CTA.DataRequest(VarArrayOf([102,DataSet.FieldByName('ID_EMPRESA').AsString,DataSet.FieldByName('ID_CBX').AsString]));
            if not (FIN_CD_M_CTA.IsEmpty) then
               begin
                 FIN_CD_M_CTA.First;
                 while not (FIN_CD_M_CTA.Eof) do
                    begin
                      FIN_CD_M_CTA.Delete;
                    end;
               end;

       end;
      if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
         raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
      if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
         raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
      if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
         raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
 finally
   FIN_CD_M_REC.Free;
   FIN_CD_M_REC_PAG.Free;
   FIN_CD_M_CTA.Free;
 end;

end;

function TSM.FIN_DP_M_COBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFinCob: String;
  begin
    Result :=
      'SELECT COB.*, '+
      '  FUN.NOME AS INT_NOMEFUN, '+
      '  CLI.NOME AS INT_NOMECLI, '+
      '  CLI.TEL_FIXO AS INT_TELFIX, '+
      '  CLI.TEL_MOVEL AS INT_TELMOV, '+
      '  CLI.EMAIL AS INT_EMAIL '+
      'FROM '+
      '  FIN_TB_M_COB COB '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=COB.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=COB.ID_CLIENTE ';
  end;
begin
   FIN_SQ_M_COB.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_COB.CommandText := enSqlFinCob + ' WHERE 1=2 '
        else
           FIN_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.ID_CONTROLE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end

   else if Input[0] = 2 then
      begin
        FIN_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.DTA_COBRANCA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format('  upper(COB.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
    else if Input[0] = 4 then
      begin
        FIN_SQ_M_COB.CommandText := enSqlFinCob +
             ' WHERE COB.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND COB.DTA_ACORDO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
    else if Input[0] = 5 then
      begin
        FIN_SQ_M_COB.CommandText := enSqlFinCob +
          ' WHERE COB.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := FIN_DP_M_COB.Data;

   FIN_SQ_M_COB.Close;
end;

function TSM.FIN_DP_M_CONDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCon: String;
  begin
    Result :=
      'select con.* , ctc.descricao as int_nomectc '+
      'from fin_tb_m_con con '+
      'left outer join cad_tb_c_ctc ctc on ctc.id_conta=con.id_conta ';
  end;
begin
   FIN_SQ_M_CON.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_CON.CommandText := enSqlCon + ' WHERE 1=2 '
        else
           FIN_SQ_M_CON.CommandText := enSqlCon +
             ' WHERE CON.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             '   AND CON.ID_CONCILIACAO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_CON.CommandText := enSqlCon +
             ' WHERE CON.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             '   AND CON.DTA_CONCILIACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_CON.CommandText := enSqlCon +
          ' WHERE CON.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
          Format(' AND upper(ctc.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := FIN_DP_M_CON.Data;

end;

procedure TSM.FIN_DP_M_CONUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_CTA_CON.FIN_DP_M_CTA_CONUpdateData(DataSet,CAD_DP_C_FPG, CAD_DP_C_CTC, CAD_DP_C_TIF,
     FIN_DP_M_CTA,BUS_DP_M_CTA, BUS_DP_M_CON_CTA_INT, BUS_DP_M_CON_GER_INT,self);
end;

function TSM.FIN_DP_M_CTADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCta: String;
  begin
    Result :=
      'select false as int_selecao, MCT.* , PCT.DESCRICAO AS INT_NOMEPCT, '+
      ' case mct.origem                                     ' +
      '      when ''0''  then  ''Manual''                   ' +
      '      when ''1''  then  ''Baixa de Conta a Receber'' ' +
      '      when ''2''  then  ''Baixa de Contas a Pagar''  ' +
      '      when ''3''  then  ''Devoluo de vendas''      ' +
      '      when ''4''  then  ''Conciliao bancria''     ' +
      '      when ''5''  then  ''Nota Fiscal de Sada''     ' +
      '      when ''6''  then  ''Nota de Crdito''          ' +
      '      when ''7''  then  ''Abertura de caixa''        ' +
      '      when ''8''  then  ''Controle de Caixa''        ' +
      '      when ''9''  then  ''Movimentao de cheque''   ' +
      '      when ''10''  then  ''Conciliao bancria''   ' +
      '    end  as int_origem,       ' +
      ' case mct.deb_cre             ' +
      ' when ''0'' then ''Dbito''   ' +
      ' when ''1'' then ''Crdito''  ' +
      ' end as int_debcre,           ' +
      ' TIF.DESCRICAO AS INT_NOMETIF, CTC.CEDENTE_NOM AS INT_NOMECTC, '+
      ' OBR.DESCRICAO AS INT_DESC_OBR, '+
      ' CLI.NOME AS INT_NOMECLI '+
      'from FIN_TB_M_CTA MCT '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=MCT.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO=MCT.ID_PLANO '+
      'LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO=MCT.ID_TIPO_FINANCEIRO '+
      'LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA=MCT.ID_CONTA '+
      'LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA=MCT.ID_OBRA ';
end;
begin
   FIN_SQ_M_CTA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_CTA.CommandText := enSqlCta + ' WHERE 1=2 '
        else
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.NUM_DOC = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.DTA_LANCAMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.ID_CONTA = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
          'WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
          '      upper(TIF.DESCRICAO) LIKE '''+uppercase(VarToStr(Input[2]))+'%'+'''  ';
      end
   else if Input[0] = 4 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.ID_PLANO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
          'WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
          '      upper(MCT.HISTORICO) LIKE '''+uppercase(VarToStr(Input[2]))+'%'+''' ';
      end
   else if Input[0] = 6 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.DTA_MOVIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             '   AND  MCT.VLR_LANCAMENTO = ''' + VarToStr(Input[3]) +'''  ' +
             '   AND  MCT.CONCILIADO = FALSE ';
      end
   else if Input[0] = 7 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.DTA_MOVIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

   else if Input[0] = 8 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND  MCT.NUM_DOC = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 9 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND  MCT.DTA_LANCAMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';
      end
   else if Input[0] = 10 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND  MCT.ID_CONTA = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 11 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND upper(TIF.DESCRICAO) LIKE '''+uppercase(VarToStr(Input[3]))+'%'+'''  ';
      end
   else if Input[0] = 12 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             '   AND MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND MCT.ID_PLANO = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 13 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
          ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
          '  AND MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
          '  AND upper(MCT.HISTORICO) LIKE '''+uppercase(VarToStr(Input[3]))+'%'+''' ';
      end
   else if Input[0] = 14 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE  MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +'''  '+
             '   AND  MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +'''  '+
             '   AND  MCT.DTA_MOVIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';
      end

   else if Input[0] = 90 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_BAIXA_PBX = ''' + VarToStr(Input[1]) +''' and '+
             '      MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 91 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_BAIXA_PBX = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 92 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_BAIXA_RBX = ''' + VarToStr(Input[1]) +''' and '+
             '      MCT.TIPO_LANCAMENTO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 93 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_BAIXA_RBX = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 94 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_FISCAL = ''' + VarToStr(Input[1]) +''' AND ' +
             '       MCT.ORIGEM = ''5'' ';
      end
   else if Input[0] = 95 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_CREDITO in (' + VarToStr(Input[1]) +') AND ' +
             '       MCT.ORIGEM = ''6'' ';
      end
   else if Input[0] = 96 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';

      end
   else if Input[0] = 97 then
      begin
           FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.id_mch = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 98 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA     = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND MCT.ID_CONTA       = ''' + VarToStr(Input[2]) + ''' ' +
             '   AND MCT.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) + '''  '+
             '   AND MCT.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) + ''' ';
      end
   else if Input[0] = 99 then
      begin
        if Input[1] <> '' then
           begin
             FIN_SQ_M_CTA.CommandText := enSqlCta +
                 ' WHERE MCT.ID_CONCILIACAO = ''' + VarToStr(Input[1]) +''' ';
           end;
      end
   else if Input[0] = 100 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_CONTROLE in (' + VarToStr(Input[1]) +')  ';
      end
   else if Input[0] = 101 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA in (' + VarToStr(Input[1]) +')  ' +
             '   AND MCT.CONCILIADO = false ' +
             '   AND MCT.ID_CONTA   in (' + VarToStr(Input[2]) +')  ' +
             '   AND TIF.NATUREZA   in (' + VarToStr(Input[3]) +')  ';
      end
   else if Input[0] = 102 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.ID_CBX = ''' +  VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 103 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_BRD = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 104 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.origem = 8  '     +
             '   and MCT.NUM_DOC     = ''' + VarToStr(Input[2]) +''' ' +
             '   AND MCT.ID_ABERTURA = ''' + VarToStr(Input[3]) +''' ';
      end
   else if Input[0] = 105 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.ID_LMF      = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 106 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.ID_PRC      = ''' + VarToStr(Input[2]) +''' '+
             '   AND MCT.ID_PRC_DET  = ''' + VarToStr(Input[3]) +'''  ';
      end
   else if Input[0] = 107 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_CONCILIACAO  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.ORIGEM=10 '+
             '   AND MCT.ID_TITULO_REC >0 ';
        if  VarToStr(Input[2])<>'' then
           FIN_SQ_M_CTA.CommandText := FIN_SQ_M_CTA.CommandText +
              ' AND MCT.ID_TITULO_REC IN ('+VarToStr(Input[2])+')';

      end
   else if Input[0] = 108 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_CONCILIACAO  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND MCT.ORIGEM=10 '+
             '   AND MCT.ID_TITULO_PAG >0 ';
        if  VarToStr(Input[2])<>'' then
           FIN_SQ_M_CTA.CommandText := FIN_SQ_M_CTA.CommandText +
              ' AND MCT.ID_TITULO_PAG IN ('+VarToStr(Input[2])+')';
      end
   else if Input[0] = 109 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_CREDITO  = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 110 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_DCT_DESC  = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 111 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ID_DCT_CANC  = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 112 then
      begin
        FIN_SQ_M_CTA.CommandText := enSqlCta +
             ' WHERE MCT.ORIGEM=11 AND '+
             ' MCT.ID_TITULO_REC  IN (' + VarToStr(Input[1]) +') ';
      end;

   Result := FIN_DP_M_CTA.Data;

   FIN_SQ_M_CTA.close;
end;

procedure TSM.FIN_DP_M_CTAGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_CTAUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
VAR
 lNumDoc,lConta,lTipoFinanceiro,lContaExp,lTipoFinanceiroExp, lPagCredCli,lCodCliente :Integer;
 lhistorico,lPlanoContas,lPlanoContasExp:String;
 lvlrLancamento:currency;
 lDtaLancamento,lDtaMovimento:TDateTime;

 lNumDocNew,lContaNew,lTipoFinanceiroNew,lContaExpNew,lTipoFinanceiroExpNew, lPagCredCliNew,lCodClienteNew:Integer;
 lhistoricoNew,lPlanoContasNew,lPlanoContasExpNew:String;
 lvlrLancamentoNew:currency;
 lDtaLancamentoNew,lDtaMovimentoNew:TDateTime;
 criExportaNew,geraPagNew:boolean;

 regExporta,regPag:boolean;


 cds:TDataSet;
 FIN_CD_M_PAG,FIN_CD_M_CTA,FIN_CD_M_PAG_PAG,FIN_CD_M_RCR,CAD_CD_C_TIF,BUS_CD_C_PAR_CTR,BUS_CD_C_FPG,BUS_CD_C_FOR,BUS_CD_C_CTC,FIN_CD_M_CXA,CAD_CD_C_CTC:TClientdataset;
Begin

   if (dataset.FieldByName('ORIGEM').AsInteger = 0) then
     begin
      try
       BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
       BUS_CD_C_FPG :=TClientDataSet.Create(nil);
       BUS_CD_C_FOR :=TClientDataSet.Create(nil);
       BUS_CD_C_CTC :=TClientDataSet.Create(nil);
       CAD_CD_C_TIF := TClientDataSet.Create(nil);
       FIN_CD_M_PAG :=TClientDataSet.Create(nil);
       FIN_CD_M_PAG_PAG := TClientDataSet.Create(nil);
       FIN_CD_M_CTA := TClientDataSet.Create(nil);
       FIN_CD_M_CXA := TClientDataSet.Create(nil);
       CAD_CD_C_CTC := TClientDataSet.Create(nil);
       FIN_CD_M_RCR := TClientDataSet.Create(nil);

        lNumDoc       := dataset.FieldByName('NUM_DOC').AsInteger;
        lDtaLancamento   := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
        lDtaMovimento    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
        lConta       := dataset.FieldByName('ID_CONTA').AsInteger;
        lTipoFinanceiro       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContas       := dataset.FieldByName('ID_PLANO').AsString;
        lContaExp       := dataset.FieldByName('EXP_ID_CONTA').AsInteger;
        lTipoFinanceiroExp     := dataset.FieldByName('EXP_ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContasExp       := dataset.FieldByName('EXP_ID_PLANO').AsString;
        lhistorico := dataset.FieldByName('HISTORICO').AsString;
        lvlrLancamento := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;
        lCodCliente :=  dataset.FieldByName('ID_CLIENTE').AsInteger;
        lPagCredCli :=  dataset.FieldByName('PAG_CRED_CLI').AsInteger;

        lNumDocNew       := dataset.FieldByName('NUM_DOC').AsInteger;
        lDtaLancamentoNew   := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
        lDtaMovimentoNew    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
        lContaNew       := dataset.FieldByName('ID_CONTA').AsInteger;
        lTipoFinanceiroNew       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContasNew       := dataset.FieldByName('EXP_ID_PLANO').AsString;
        lContaExpNew       := dataset.FieldByName('EXP_ID_CONTA').AsInteger;
        lTipoFinanceiroExpNew     := dataset.FieldByName('EXP_ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContasExpNew       := dataset.FieldByName('EXP_ID_PLANO').AsString;
        lhistoricoNew := dataset.FieldByName('HISTORICO').AsString;
        lvlrLancamentoNew := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;
        lCodClienteNew :=  dataset.FieldByName('ID_CLIENTE').AsInteger;
        lPagCredCliNew :=  dataset.FieldByName('PAG_CRED_CLI').AsInteger;


        if dataset.UpdateStatus in [usUnmodified] then
           begin
              dataset.next;

              if trim(dataset.FieldByName('NUM_DOC').AsString) <> '' then
                 lNumDocNew       := dataset.FieldByName('NUM_DOC').AsInteger;

              if trim(dataset.FieldByName('DTA_LANCAMENTO').AsString) <> '' then
                 lDtaLancamentoNew   := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;

              if trim(dataset.FieldByName('DTA_MOVIMENTO').AsString) <> '' then
                 lDtaMovimentoNew    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;

              if trim(dataset.FieldByName('ID_CONTA').AsString) <> '' then
                 lContaNew       := dataset.FieldByName('ID_CONTA').AsInteger;

              if trim(dataset.FieldByName('ID_TIPO_FINANCEIRO').AsString) <> '' then
                 lTipoFinanceiroNew       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;

              if trim(dataset.FieldByName('ID_PLANO').AsString) <> '' then
                 lPlanoContasNew       := dataset.FieldByName('ID_PLANO').AsString;

              if trim(dataset.FieldByName('EXP_ID_CONTA').AsString) <> '' then
                 lContaExpNew       := dataset.FieldByName('EXP_ID_CONTA').AsInteger;

              if trim(dataset.FieldByName('EXP_ID_TIPO_FINANCEIRO').AsString) <> '' then
                 lTipoFinanceiroExpNew     := dataset.FieldByName('EXP_ID_TIPO_FINANCEIRO').AsInteger;

              if trim(dataset.FieldByName('EXP_ID_PLANO').AsString) <> '' then
                 lPlanoContasExpNew       := dataset.FieldByName('EXP_ID_PLANO').AsString;

              if trim(dataset.FieldByName('HISTORICO').AsString) <> '' then
                 lhistoricoNew := dataset.FieldByName('HISTORICO').AsString;

              if trim(dataset.FieldByName('VLR_LANCAMENTO').AsString) <> '' then
                 lvlrLancamentoNew := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;

              if trim(dataset.FieldByName('ID_CLIENTE').AsString) <> '' then
                 lCodClienteNew := dataset.FieldByName('ID_CLIENTE').AsInteger;


              if trim(dataset.FieldByName('PAG_CRED_CLI').AsString) <> '' then
                 lPagCredCliNew := dataset.FieldByName('PAG_CRED_CLI').AsInteger;

              dataset.Prior;

            end;

       regExporta := false;
       regPag := false;
       criExportaNew := false;
       geraPagNew := false;



       CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
       CAD_CD_C_TIF.Close;
       CAD_CD_C_TIF.Data :=
       CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiro]));
       if (CAD_CD_C_TIF.FieldByName('CRI_EXPORTA').AsBoolean = True) then
         begin
           regExporta := true;
           criExportaNew := true;
         end;
       if (CAD_CD_C_TIF.FieldByName('GERA_PAG').AsBoolean = True) then
         begin
           regPag := true;
           geraPagNew := true;
         end;

       if (lTipoFinanceiro<>lTipoFinanceiroNew) then
         begin
          CAD_CD_C_TIF:= TClientDataSet.Create(nil);
          CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
          CAD_CD_C_TIF.Close;
          CAD_CD_C_TIF.Data :=
          CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiroNew]));
          if (CAD_CD_C_TIF.FieldByName('CRI_EXPORTA').AsBoolean = True) then
           begin
            regExporta := true;
            criExportaNew := true;
           end
          else
            begin
              criExportaNew := false;
            end;

          if (CAD_CD_C_TIF.FieldByName('GERA_PAG').AsBoolean = True) then
           begin
            regPag := true;
            geraPagNew := true;
           end
          else
            begin
              geraPagNew := false;
            end;
         end;

       FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
       FIN_CD_M_RCR.Close;
       FIN_CD_M_RCR.Data :=
       FIN_CD_M_RCR.DataRequest(VarArrayOf([93,dataset.FieldByName('ID_CONTROLE').AsString]));

       if not FIN_CD_M_RCR.IsEmpty then
         begin
          FIN_CD_M_RCR.Delete;
         end;


       if (not (dataset.UpdateStatus in [usDeleted])) and (lPagCredCliNew = 1) then
          begin
            FIN_CD_M_RCR.Insert;
            // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
            FIN_CD_M_RCR.FieldByName('id_credito').AsInteger        :=
               sm.enValorChave('FIN_TB_M_RCR');
               // DmApoio.enBusValorChave('FIN_TB_M_RCR');
            FIN_CD_M_RCR.FieldByName('ID_EMPRESA').AsInteger   := dataset.FieldByName('ID_EMPRESA').AsInteger;
            FIN_CD_M_RCR.FieldByName('ID_CLIENTE').AsInteger   := lCodClienteNew;
            FIN_CD_M_RCR.FieldByName('DTA_CREDITO').AsDateTime   :=  lDtaMovimentoNew ;
            FIN_CD_M_RCR.FieldBYname('historico').AsString := 'Pagto de crdito do cliente por mov. caixa: ' +
                                                                 IntToStr(lContaNew);
            FIN_CD_M_RCR.FieldByName('VLR_CREDITO').AsCurrency   :=  lvlrLancamentoNew  ;
            FIN_CD_M_RCR.FieldByName('DEB_CRE').AsInteger :=  0;

            FIN_CD_M_RCR.FieldByName('ORIGEM').AsInteger :=  4;

            FIN_CD_M_RCR.FieldByName('id_cta').AsInteger      := dataset.FieldByName('ID_CONTROLE').AsInteger;
            FIN_CD_M_RCR.FieldByName('NUM_DOCUMENTO').AsString    := '0';
            FIN_CD_M_RCR.FieldByName('PRE_BANCO').AsString        := '0';
            FIN_CD_M_RCR.FieldByName('PRE_AGENCIA').AsString      := '0';
            FIN_CD_M_RCR.FieldByName('PRE_CONTA').AsString        := '0';
            FIN_CD_M_RCR.FieldByName('PRE_CHEQUE').AsString       := '0';
            FIN_CD_M_RCR.FieldByName('CANCELADO').AsBoolean      := false;

            FIN_CD_M_RCR.Post;
          end;




       if (regExporta = True) then
         begin

           if not (dataset.UpdateStatus in [usDeleted]) then
             begin

                 if (dataset.UpdateStatus in [usUnmodified]) then
                   begin
                      FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
                      FIN_CD_M_CTA.Close;
                      FIN_CD_M_CTA.Data :=
                      FIN_CD_M_CTA.DataRequest(VarArrayOf([1,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('ID_CONTROLE').AsString]));
                      if not (FIN_CD_M_CTA.IsEmpty) then
                        begin
                          if criExportaNew = false then
                            begin
                              while not (FIN_CD_M_CTA.Eof) do
                               begin
                                FIN_CD_M_CTA.Delete;
                               end;
                            end
                          else
                            begin
                              CAD_CD_C_CTC:= TClientDataSet.Create(nil);
                              CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                              CAD_CD_C_CTC.Close;
                              CAD_CD_C_CTC.Data :=
                              CAD_CD_C_CTC.DataRequest(VarArrayOf([0, lContaExpNew]));

                              CAD_CD_C_TIF:= TClientDataSet.Create(nil);
                              CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                              CAD_CD_C_TIF.Close;
                              CAD_CD_C_TIF.Data :=
                              CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiroExpNew]));

                              FIN_CD_M_CTA.Edit;
                              FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := lNumDocNew;
                              FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                              FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := lDtaLancamentoNew;


                              FIN_CD_M_CTA.FieldByName('historico').AsString           := lhistoricoNew;
                              FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrLancamentoNew;

                              FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := lContaExpNew;
                              FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := lTipoFinanceiroExpNew;

                              FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasExpNew;

                              FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
                              FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := lDtaMovimentoNew;
                                if ({(dataset.FieldByName('tipo_lancamento').AsInteger = 0) and }
                                   (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0) )  then
                                  begin
                                      FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                      FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                      FIN_CD_M_CXA.Close;
                                      FIN_CD_M_CXA.Data :=
                                      FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaExpNew]));
                                      FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                      FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                      FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 0;
                                  end;
                              FIN_CD_M_CTA.Post;
                            end;
                        end
                        else
                          begin
                            if criExportaNew = true then
                              begin
                                CAD_CD_C_CTC:= TClientDataSet.Create(nil);
                                CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                                CAD_CD_C_CTC.Close;
                                CAD_CD_C_CTC.Data :=
                                CAD_CD_C_CTC.DataRequest(VarArrayOf([0, lContaExpNew]));

                                CAD_CD_C_TIF:= TClientDataSet.Create(nil);
                                CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                                CAD_CD_C_TIF.Close;
                                CAD_CD_C_TIF.Data :=
                                CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiroExpNew]));

                                FIN_CD_M_CTA.Insert;
                                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                // Alterado de SM para dmApoio por Maxsuel Victor em 22/08/17 devido a mudana geral, pra deixar os processos mais rpido.
                                FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                                     sm.enValorChave('FIN_TB_M_CTA');
                                     // DmApoio.enBusValorChave('FIN_TB_M_CTA');
                                FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := lNumDocNew;

                                FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                                FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := dataset.FieldBYName('tipo_lancamento').AsInteger;
                                FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                                FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := lDtaLancamentoNew;
                               // FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := lDtaMovimentoNew;

                                FIN_CD_M_CTA.FieldByName('historico').AsString           := lhistoricoNew;
                                FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrLancamentoNew;
                                FIN_CD_M_CTA.FieldByName('origem').AsInteger             := dataset.FieldByName('origem').AsInteger;
                                FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := lContaExpNew;
                                FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := lTipoFinanceiroExpNew;

                                FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasExpNew;
                                FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                                FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := dataset.FieldByName('id_controle').AsInteger;
                                FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                                FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                                FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                                FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                                FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;

                                FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
                                FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := lDtaMovimentoNew;
                                if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                                  begin
                                    FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                    FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                    FIN_CD_M_CXA.Close;
                                    FIN_CD_M_CXA.Data :=
                                    FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaExpNew]));
                                    FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                    FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                    FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 0;
                                  end;


                                FIN_CD_M_CTA.Post;
                              end;
                          end;
                   end;
                 if (dataset.UpdateStatus in [usInserted]) then
                   begin
                    FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
                    FIN_CD_M_CTA.Close;
                    FIN_CD_M_CTA.Data :=
                    FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));
                    enGerFinCxaBco(sender,4,dataset,cds,FIN_CD_M_CTA,0);
                   end;

             end
           else
             begin
                FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
                FIN_CD_M_CTA.Close;
                FIN_CD_M_CTA.Data :=
                FIN_CD_M_CTA.DataRequest(VarArrayOf([1,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('ID_CONTROLE').AsString]));

                if not (FIN_CD_M_CTA.IsEmpty) then
                  begin
                   while not (FIN_CD_M_CTA.Eof) do
                    begin
                     FIN_CD_M_CTA.Delete;
                    end;
                  end;
             end;

           if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
             begin
               raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
             end;

       end;

      if FIN_CD_M_RCR <> nil then
        if FIN_CD_M_RCR.ChangeCount > 0 then
          if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
             begin
              raise Exception.Create('Erro ao tentar atualizar a tabela de crdito.');
             end;


       { BUS_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
        BUS_CD_C_CTC.Close;
        BUS_CD_C_CTC.Data :=
        BUS_CD_C_CTC.DataRequest(VarArrayOf([0,dataset.FieldByName('ID_CONTA').AsString]));  }

       if ((dataset.FieldBYName('TIPO_LANCAMENTO').AsInteger = 1) and (regPag = true)) then
         begin
            BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
            BUS_CD_C_PAR_CTR.Close;
            BUS_CD_C_PAR_CTR.Data :=
            BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataset.FieldByName('ID_EMPRESA').AsString]));

             if ((trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORMA_PAG').AsString) = '') or
                (trim(BUS_CD_C_PAR_CTR.FieldByName('MVB_ID_FORNECEDOR').AsString) = '') or
                (trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_LOCAL_TITULO').AsString) = '')) then
              begin
                raise Exception.Create('Os parmetros forma de pagamento,local de ttulo e fornecedor devem ser preenchidos.');
              end;

            BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
            BUS_CD_C_FPG.Close;
            BUS_CD_C_FPG.Data :=
            BUS_CD_C_FPG.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORMA_PAG').AsString]));

            if BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger <> 0 then
              begin
                raise Exception.Create('Forma de Pagamento deve ser do tipo a vista.');
              end;

            BUS_CD_C_FOR.SetProvider(CAD_DP_C_FOR);
            BUS_CD_C_FOR.Close;
            BUS_CD_C_FOR.Data :=
            BUS_CD_C_FOR.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('MVB_ID_FORNECEDOR').AsString]));

            if (BUS_CD_C_FOR.IsEmpty) then
              begin
                raise Exception.Create('Fornecedor no cadastrado.');
              end;

            if not (dataset.UpdateStatus in [usDeleted]) then
             begin

                 if (dataset.UpdateStatus in [usUnmodified]) then
                   begin
                      FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
                      FIN_CD_M_PAG.Close;
                      FIN_CD_M_PAG.Data :=
                      FIN_CD_M_PAG.DataRequest(VarArrayOf([94,dataset.FieldByName('ID_CONTROLE').AsString]));


                      if not (FIN_CD_M_PAG.IsEmpty) then
                        begin
                          FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                          FIN_CD_M_PAG_PAG.Close;
                          FIN_CD_M_PAG_PAG.Data :=
                          FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([3,FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]));

                          if geraPagNew = false then
                            begin
                              while not (FIN_CD_M_PAG_PAG.Eof) do
                               begin
                                FIN_CD_M_PAG_PAG.Delete;
                               end;
                              while not (FIN_CD_M_PAG.Eof) do
                               begin
                                FIN_CD_M_PAG.Delete;
                               end;

                              if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                                 begin
                                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                 end;

                              if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                                 begin
                                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                 end;
                            end
                          else
                            begin

                              FIN_CD_M_PAG.Edit;
                              FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('mvb_id_fornecedor').AsInteger;


                                FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                                FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := lvlrLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := lvlrLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('historico').AsString                := lhistoricoNew;
                                FIN_CD_M_PAG.FieldByName('id_plano').AsString         := lPlanoContasNew;
                                FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;

                                FIN_CD_M_PAG.Post;

                                FIN_CD_M_PAG_PAG.Edit;

                                FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := lDtaLancamentoNew;
                                FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := lvlrLancamentoNew;

                                FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                                FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := lPlanoContasNew;
                                FIN_CD_M_PAG_PAG.FieldByName('historico').AsString                := lhistoricoNew;

                                FIN_CD_M_PAG_PAG.Post;

                                if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                                  begin
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                  end;

                                if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                                  begin
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                  end;
                            end;
                        end
                        else
                          begin
                            if geraPagNew = true then
                              begin
                                FIN_CD_M_PAG.Insert;
                                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  := self.enValorChave('FAT_TB_M_NFE_TIT');
                                FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                                FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('mvb_id_fornecedor').AsInteger;
                                FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                                FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := lDtaLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 4;//Movimento Bancario
                                FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                                FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := lvlrLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := lvlrLancamentoNew;
                                FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                                FIN_CD_M_PAG.FieldByName('historico').AsString        := lhistoricoNew;
                                FIN_CD_M_PAG.FieldByName('id_plano').AsString         := lPlanoContasNew;
                                FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                                FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                                FIN_CD_M_PAG.FieldByName('id_cta').AsInteger          := dataset.FieldByName('ID_CONTROLE').AsInteger;

                                FIN_CD_M_PAG.Post;

                                FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                                FIN_CD_M_PAG_PAG.Close;
                                FIN_CD_M_PAG_PAG.Data :=
                                FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));
                                FIN_CD_M_PAG_PAG.Insert;

                                FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                                                self.enValorChave('FIN_TB_M_PBX');
                                               // DmApoio.enBusValorChave('FIN_TB_M_PBX');

                                FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := lDtaLancamentoNew;
                                FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := lvlrLancamentoNew;

                                FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                                FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                                FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                                FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                                FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := lhistoricoNew;
                                FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                                FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                                FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := lPlanoContasNew;
                                FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                                FIN_CD_M_PAG_PAG.Post;

                                if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                                 begin
                                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                 end;

                                if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                                 begin
                                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                 end;

                              end;
                          end;
                   end;
                 if (dataset.UpdateStatus in [usInserted]) then
                   begin

                    FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
                    FIN_CD_M_PAG.Close;
                    FIN_CD_M_PAG.Data :=
                    FIN_CD_M_PAG.DataRequest(VarArrayOf([0,'']));
                    FIN_CD_M_PAG.Insert;

                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  :=
                         self.enValorChave('FAT_TB_M_NFE_TIT');
                       //DmApoio.enBusValorChave('FAT_TB_M_NFE_TIT');
                    FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('mvb_id_fornecedor').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                    FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 4;//Movimento Bancario
                    FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;
                    FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;
                    FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                    FIN_CD_M_PAG.FieldByName('historico').AsString        := dataset.FieldByName('HISTORICO').AsString;
                    FIN_CD_M_PAG.FieldByName('id_plano').AsString         := dataset.FieldByName('ID_PLANO').AsString;
                    FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                    FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                    FIN_CD_M_PAG.FieldByName('id_cta').AsInteger          := dataset.FieldByName('ID_CONTROLE').AsInteger;

                    FIN_CD_M_PAG.Post;

                    FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                    FIN_CD_M_PAG_PAG.Close;
                    FIN_CD_M_PAG_PAG.Data :=
                    FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));
                    FIN_CD_M_PAG_PAG.Insert;

                    FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                         self.enValorChave('FIN_TB_M_PBX');
                    FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := dataset.FieldByName('DTA_LANCAMENTO').AsDateTime;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := dataset.FieldByName('VLR_LANCAMENTO').AsCurrency;

                    FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := dataset.FieldByName('HISTORICO').AsString;
                    FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := dataset.FieldByName('ID_PLANO').AsString;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                    FIN_CD_M_PAG_PAG.Post;

                    if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                     begin
                      raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                     end;

                    if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                      begin
                        raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                      end;
                   end;

             end
           else
             begin
                FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
                FIN_CD_M_PAG.Close;
                FIN_CD_M_PAG.Data :=
                FIN_CD_M_PAG.DataRequest(VarArrayOf([94,dataset.FieldByName('ID_CONTROLE').AsString]));

                FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                FIN_CD_M_PAG_PAG.Close;
                FIN_CD_M_PAG_PAG.Data :=
                FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([3,FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]));

                if not (FIN_CD_M_PAG_PAG.IsEmpty) then
                  begin
                   while not (FIN_CD_M_PAG_PAG.Eof) do
                    begin
                     FIN_CD_M_PAG_PAG.Delete;
                    end;
                  end;

                if not (FIN_CD_M_PAG.IsEmpty) then
                  begin
                   while not (FIN_CD_M_PAG.Eof) do
                    begin
                     FIN_CD_M_PAG.Delete;
                    end;
                  end;

                if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                 begin
                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                 end;

                if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                 begin
                  raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                 end;
             end;
         end;

      finally
        BUS_CD_C_CTC.Free;
        BUS_CD_C_FPG.Free;
        BUS_CD_C_PAR_CTR.Free;
        FIN_CD_M_CTA.Free;
        FIN_CD_M_PAG.Free;
        FIN_CD_M_PAG_PAG.Free;
        CAD_CD_C_TIF.Free;
        FIN_CD_M_CXA.Free;
        FIN_CD_M_RCR.Free;
        CAD_CD_C_CTC.Free;
      end;
     end;

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_CTA_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCta: String;
  begin
    Result :=
      'select false as int_selecao, MCT.* , PCT.DESCRICAO AS INT_NOMEPCT, '+
      ' case mct.origem                                     ' +
      '      when ''0''  then  ''Manual''                   ' +
      '      when ''1''  then  ''Baixa de Conta a Receber'' ' +
      '      when ''2''  then  ''Baixa de Contas a Pagar''  ' +
      '      when ''3''  then  ''Devoluo de vendas''      ' +
      '      when ''4''  then  ''Conciliao bancria''     ' +
      '      when ''5''  then  ''Nota Fiscal de Sada''     ' +
      '      when ''6''  then  ''Nota de Crdito''          ' +
      '      when ''7''  then  ''Abertura de caixa''        ' +
      '      when ''8''  then  ''Controle de Caixa''        ' +
      '      when ''9''  then  ''Movimentao de cheque''   ' +
      '      when ''10''  then  ''Conciliao bancria''   ' +
      '    end  as int_origem,       ' +
      ' case mct.deb_cre             ' +
      ' when ''0'' then ''Dbito''   ' +
      ' when ''1'' then ''Crdito''  ' +
      ' end as int_debcre,           ' +
      ' TIF.DESCRICAO AS INT_NOMETIF, CTC.CEDENTE_NOM AS INT_NOMECTC '+
      'from FIN_TB_M_CTA MCT '+
      'LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO=MCT.ID_PLANO '+
      'LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO=MCT.ID_TIPO_FINANCEIRO '+
      'LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA=MCT.ID_CONTA ';
  end;
begin
   FIN_SQ_M_CTA_INT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_CTA_INT.CommandText := enSqlCta + ' WHERE 1=2 '
        else
           FIN_SQ_M_CTA_INT.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.NUM_DOC = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_CTA_INT.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.EXP_ID_CONTROLE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_CTA_INT.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.ID_LMF = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_CTA_INT.CommandText := enSqlCta +
             ' WHERE MCT.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' and '+
             '       MCT.ID_PRC = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := FIN_DP_M_CTA_INT.Data;
   FIN_SQ_M_CTA_INT.close;
end;

function TSM.FIN_DP_M_CXADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlCxa: String;
  begin
    Result :=
      'SELECT CXA.*, '+
      '             FUN.NOME AS INT_NOMEFUN, '+
      '             CTC.BANCO AS INT_BANCO, '+
      '             CTC.DESCRICAO INT_NOMECTC,'+
      '             CTC.TIPO AS INT_TIPOCTC, ' +
      '             PAR.EMP_RAZAO AS INT_NOMEPAR, '+
      '             ECF.ECF_MARCA_IMPRESSORA AS INT_MARCAECF, ' +
      '             ECF.ECF_MODELO_IMPRESSORA AS INT_MODELOECF, ECF.ECF_CAIXA AS INT_CAIXAECF ' +
      'FROM FIN_TB_M_CXA CXA '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO = CXA.ID_FUNCIONARIO '+
      'LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA = CXA.ID_CONTA '+
      'LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA=CXA.ID_EMPRESA ' +
      'LEFT OUTER JOIN CAD_TB_C_ECF ECF ON ECF.ECF_SERIAL_IMPRESSORA=CXA.ECF_SERIAL_IMPRESSORA ';
  end;
begin
   FIN_SQ_M_CXA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_CXA.CommandText := enSqlCxa + ' WHERE 1=2 '
        else
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.ID_ABERTURA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.DTA_ABERTURA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 90 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=0 AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[1]) +''' ' +
             '   AND CXA.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 91 then
      begin
            { TODO -oMaxsuel -cAlterao da string :
              Alterao , por Maxsuel Victor 13/11/2014.
              Foi includo o campo STATUS=0 , pra pode
              trazer somente se a conta tiver aberta. }
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[1]) +''' and '+
             '       CXA.ID_CONTA = ''' + VarToStr(Input[2]) +''' and '+
             '       CXA.STATUS = 0 and ' +
             '       CXA.DTA_ABERTURA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' and ' +
             '       CXA.ID_EMPRESA = ''' + VarToStr(Input[4]) +'''  ';
      end
   else if Input[0] = 92 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=0 AND CXA.ID_CONTA = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 93 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=0 AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[1]) +''' ' +
             '   AND CXA.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' ' +
             '   AND CXA.ID_CONTA = ''' + VarToStr(Input[3]) +''' ';
      end

   else if Input[0] = 94 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=0 AND FUN.ATIVO = TRUE ' +
             '   AND CXA.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end

    else if Input[0] = 95 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=0 ' +
             '   AND CXA.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             '   AND CXA.ID_CONTA = ''' + VarToStr(Input[2])+''' ';
      end
    else if Input[0] = 96 then
      begin
           FIN_SQ_M_CXA.CommandText := enSqlCxa +
             ' WHERE CXA.STATUS=1 AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[1]) +''' ' +
             '   AND CXA.ID_EMPRESA = ''' + VarToStr(Input[2]) +''' '+
             '   order by dta_fechamento,hor_fechamento ';
      end;
   //   try
   Result := FIN_DP_M_CXA.Data;
   FIN_SQ_M_CXA.Close;
end;

procedure TSM.FIN_DP_M_CXAGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
   { TODO -oLuan : Inserido por Luan, em 18/07/2017 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_CXAUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
   enGerFinCxaBco(Sender, 1, DataSet, nil,nil,0);
   { TODO -oLuan : Inserido por Luan, em 18/07/2017 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_DCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinDct: String;
  begin
    Result :=
     ' select dct.*,                            '+
     ' ctc.descricao as int_descconta,          '+
     ' lto.descricao as int_desc_localtit from  '+
     ' fin_tb_m_dct dct                         '+
     ' left outer join cad_tb_c_ctc ctc on ctc.id_conta=dct.id_conta '+
     ' left outer join cad_tb_c_lto lto on lto.id_local_titulo=dct.id_local_titulo ';

  end;

begin

   FIN_SQ_M_DCT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_DCT.CommandText := enSqlFinDct + ' WHERE 1=2 '
        else
           FIN_SQ_M_DCT.CommandText := enSqlFinDct +
             ' WHERE  dct.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' and dct.id_dct = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_DCT.CommandText := enSqlFinDct +
             ' WHERE dct.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND dct.data_operacao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_DCT.CommandText := enSqlFinDct +
             ' WHERE dct.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND dct.tipo_operacao = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := FIN_DP_M_DCT.Data;
   FIN_SQ_M_DCT.Close;
end;

procedure TSM.FIN_DP_M_DCTGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
   enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_DCTUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_DCT.FIN_DP_M_DCTUpdateData(DataSet, Sender,BuscarConnBanco,self);
end;

function TSM.FIN_DP_M_LDMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinLDM: String;
  begin
    Result :=
     ' select ldm.*,mta.nome as int_nome_mot,fpg.descricao as int_nomefpg from fin_tb_m_ldm ldm  '+
     ' left outer join pcp_tb_c_mta mta on mta.id_motorista=ldm.id_motorista '+
     ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=ldm.id_forma_pag ';
  end;

begin

   FIN_SQ_M_LDM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_LDM.CommandText := enSqlFinLDM + ' WHERE 1=2 '
        else
           FIN_SQ_M_LDM.CommandText := enSqlFinLDM +
             ' WHERE  ldm.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' and ldm.id_ldm = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_LDM.CommandText := enSqlFinLDM +
             ' WHERE ldm.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND ldm.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_LDM.CommandText := enSqlFinLDM +
             ' WHERE ldm.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND ldm.dta_vencimento = ''' + VarToStr(Input[2]) +''' ';
      end
    else if Input[0] = 3 then
      begin
        FIN_SQ_M_LDM.CommandText := enSqlFinLDM +
             ' WHERE ldm.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
               Format(' AND upper(MTA.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
    else if Input[0] = 4 then
      begin
        FIN_SQ_M_LDM.CommandText := enSqlFinLDM +
             ' WHERE ldm.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := FIN_DP_M_LDM.Data;
   FIN_SQ_M_LDM.Close;
end;

function TSM.FIN_DP_M_LMFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinLmf: String;
  begin
    Result :=
     ' select lmf.*,fun.nome as int_nomefun,                                              '+
     ' pct.descricao as int_nomepct,                                                      '+
     ' tif.descricao as int_nometif,                                                      '+
     ' obr.descricao as int_nomeobr                                                       '+
     ' from fin_tb_m_lmf lmf                                                              '+
     ' left outer join cad_tb_c_fun fun on fun.id_funcionario=lmf.id_funcionario          '+
     ' left outer join cad_tb_c_pct pct on pct.id_plano=lmf.id_plano                      '+
     ' left outer join cad_tb_c_tif tif on tif.id_tipo_financeiro=lmf.id_tipo_financeiro  '+
     ' LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA=LMF.ID_OBRA                        ';
  end;

begin

   FIN_SQ_M_LMF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_LMF.CommandText := enSqlFinLmf + ' WHERE 1=2 '
        else
           FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
             ' WHERE  lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' and lmf.id_lmf = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
             ' WHERE lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
              Format(' AND upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
             ' WHERE lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND lmf.dta_movimento = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
          ' WHERE lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          ' and lmf.id_plano = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
          ' WHERE lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          Format(' AND upper(TIF.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 5 then
      begin
        FIN_SQ_M_LMF.CommandText := enSqlFinLmf +
          ' WHERE lmf.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          ' and lmf.id_conta = ''' + VarToStr(Input[2]) + ''' ';
      end;

   Result := FIN_DP_M_LMF.Data;
   FIN_SQ_M_LMF.Close;
end;

procedure TSM.FIN_DP_M_LMFUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
VAR
 lConta,lTipoFinanceiro,lContaExp,lTipoFinanceiroExp,lIdObra:Integer;
 lhistorico,lPlanoContas,lPlanoContasExp:String;
 lvlrMovimento:currency;
 lDtaVencimento,lDtaMovimento:TDateTime;

 lContaNew,lTipoFinanceiroNew,lIdObraNew:Integer;
 lhistoricoNew,lPlanoContasNew:String;
 lvlrMovimentoNew:currency;
 lDtaVencimentoNew ,lDtaMovimentoNew:TDateTime;


 cds:TDataSet;
 FIN_CD_M_PAG,FIN_CD_M_CTA,FIN_CD_M_PAG_PAG,CAD_CD_C_TIF,BUS_CD_C_PAR_CTR,BUS_CD_C_FPG,BUS_CD_C_FOR,FIN_CD_M_CXA,CAD_CD_C_CTC:TClientdataset;
Begin

    try

       BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
       BUS_CD_C_FPG :=TClientDataSet.Create(nil);
       BUS_CD_C_FOR :=TClientDataSet.Create(nil);
       CAD_CD_C_TIF := TClientDataSet.Create(nil);
       FIN_CD_M_PAG :=TClientDataSet.Create(nil);
       FIN_CD_M_PAG_PAG := TClientDataSet.Create(nil);
       FIN_CD_M_CTA := TClientDataSet.Create(nil);
       FIN_CD_M_CXA := TClientDataSet.Create(nil);
       CAD_CD_C_CTC := TClientDataSet.Create(nil);


        lDtaMovimento    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
        lDtaVencimento    := dataset.FieldByName('DTA_VENCIMENTO').AsDateTime;
        lConta       := dataset.FieldByName('ID_CONTA').AsInteger;
        lTipoFinanceiro       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContas       := dataset.FieldByName('ID_PLANO').AsString;
        lhistorico := dataset.FieldByName('HISTORICO').AsString;
        lvlrMovimento := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;
        lIdObra := dataset.FieldByName('ID_OBRA').AsInteger;


        lDtaMovimentoNew    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
        lDtaVencimentoNew    := dataset.FieldByName('DTA_VENCIMENTO').AsDateTime;
        lContaNew       := dataset.FieldByName('ID_CONTA').AsInteger;
        lTipoFinanceiroNew       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
        lPlanoContasNew       := dataset.FieldByName('ID_PLANO').AsString;
        lhistoricoNew := dataset.FieldByName('HISTORICO').AsString;
        lvlrMovimentoNew := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;
        lIdObraNew := dataset.FieldByName('ID_OBRA').AsInteger;



      if dataset.UpdateStatus in [usUnmodified] then
         begin
            dataset.next;

            if trim(dataset.FieldByName('DTA_VENCIMENTO').AsString) <> '' then
               lDtaVencimentoNew   := dataset.FieldByName('DTA_VENCIMENTO').AsDateTime;

            if trim(dataset.FieldByName('DTA_MOVIMENTO').AsString) <> '' then
               lDtaMovimentoNew    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;

            if trim(dataset.FieldByName('ID_CONTA').AsString) <> '' then
               lContaNew       := dataset.FieldByName('ID_CONTA').AsInteger;

            if trim(dataset.FieldByName('ID_TIPO_FINANCEIRO').AsString) <> '' then
               lTipoFinanceiroNew       := dataset.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;

            if trim(dataset.FieldByName('ID_PLANO').AsString) <> '' then
               lPlanoContasNew       := dataset.FieldByName('ID_PLANO').AsString;


            if trim(dataset.FieldByName('HISTORICO').AsString) <> '' then
               lhistoricoNew := dataset.FieldByName('HISTORICO').AsString;

            if trim(dataset.FieldByName('VLR_MOVIMENTO').AsString) <> '' then
               lvlrMovimentoNew := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;

            if trim(dataset.FieldByName('ID_OBRA').AsString) <> '' then
               lIdObraNew := dataset.FieldByName('ID_OBRA').AsInteger;
            dataset.Prior;

          end;

      BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
      BUS_CD_C_PAR_CTR.Close;
      BUS_CD_C_PAR_CTR.Data :=
      BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataset.FieldByName('ID_EMPRESA').AsString]));

       if ((trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORMA_PAG').AsString) = '') or
          (trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORNECEDOR').AsString) = '') or
          (trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_LOCAL_TITULO').AsString) = '')) then
        begin
          raise Exception.Create('Os parmetros forma de pagamento,local de ttulo e fornecedor devem ser preenchidos.');
        end;

      BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
      BUS_CD_C_FPG.Close;
      BUS_CD_C_FPG.Data :=
      BUS_CD_C_FPG.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORMA_PAG').AsString]));

      if BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger <> 0 then
        begin
          raise Exception.Create('Forma de Pagamento deve ser do tipo a vista.');
        end;

      BUS_CD_C_FOR.SetProvider(CAD_DP_C_FOR);
      BUS_CD_C_FOR.Close;
      BUS_CD_C_FOR.Data :=
      BUS_CD_C_FOR.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORNECEDOR').AsString]));

      if (BUS_CD_C_FOR.IsEmpty) then
        begin
          raise Exception.Create('Fornecedor no cadastrado.');
        end;


     CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
     CAD_CD_C_TIF.Close;
     CAD_CD_C_TIF.Data :=
     CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiro]));



     if (lTipoFinanceiro<>lTipoFinanceiroNew) then
       begin
        CAD_CD_C_TIF:= TClientDataSet.Create(nil);
        CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
        CAD_CD_C_TIF.Close;
        CAD_CD_C_TIF.Data :=
        CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiroNew]));
       end;


     if not (dataset.UpdateStatus in [usDeleted]) then
       begin
           if (dataset.UpdateStatus in [usInserted]) then
             begin
              FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
              FIN_CD_M_CTA.Close;
              FIN_CD_M_CTA.Data :=
              FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));
              enGerFinCxaBco(sender,7,dataset,cds,FIN_CD_M_CTA,0);

              if (CAD_CD_C_TIF.FieldBYName('natureza').AsInteger=0) and (CAD_CD_C_TIF.FieldByName('prestacao_conta').AsBoolean = false) then
                 begin
                    FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
                    FIN_CD_M_PAG.Close;
                    FIN_CD_M_PAG.Data :=
                    FIN_CD_M_PAG.DataRequest(VarArrayOf([0,'']));
                    FIN_CD_M_PAG.Insert;

                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  :=
                         self.enValorChave('FAT_TB_M_NFE_TIT');
                         //DmApoio.enBusValorChave('FAT_TB_M_NFE_TIT');
                    FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('pde_id_fornecedor').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                    FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
                    FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 5;//Lanamento de Movimento do Funcionrio
                    FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;
                    FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;
                    FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                    FIN_CD_M_PAG.FieldByName('historico').AsString        := dataset.FieldByName('HISTORICO').AsString;
                    FIN_CD_M_PAG.FieldByName('id_plano').AsString         := dataset.FieldByName('ID_PLANO').AsString;
                    FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                    FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                    FIN_CD_M_PAG.FieldByName('id_lmf').AsInteger          := dataset.FieldByName('ID_LMF').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_obra').AsInteger         := dataset.FieldByName('ID_OBRA').AsInteger;
                    FIN_CD_M_PAG.Post;

                    FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                    FIN_CD_M_PAG_PAG.Close;
                    FIN_CD_M_PAG_PAG.Data :=
                    FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));
                    FIN_CD_M_PAG_PAG.Insert;

                    FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                        self.enValorChave('FIN_TB_M_PBX');
                        //DmApoio.enBusValorChave('FIN_TB_M_PBX');
                    FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := dataset.FieldByName('DTA_MOVIMENTO').AsDateTime;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := dataset.FieldByName('VLR_MOVIMENTO').AsCurrency;

                    FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := dataset.FieldByName('HISTORICO').AsString;
                    FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := dataset.FieldByName('ID_PLANO').AsString;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                    FIN_CD_M_PAG_PAG.Post;
                 end;

             end;

           if (dataset.UpdateStatus in [usUnmodified]) then
             begin
                FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
                FIN_CD_M_CTA.Close;
                FIN_CD_M_CTA.Data :=
                FIN_CD_M_CTA.DataRequest(VarArrayOf([2,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('ID_LMF').AsString]));
                if not (FIN_CD_M_CTA.IsEmpty) then
                  begin
                    CAD_CD_C_CTC:= TClientDataSet.Create(nil);
                    CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                    CAD_CD_C_CTC.Close;
                    CAD_CD_C_CTC.Data :=
                    CAD_CD_C_CTC.DataRequest(VarArrayOf([0, lContaNew]));


                    FIN_CD_M_CTA.Edit;
                    FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                    FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := lDtaMovimentoNew;

                    FIN_CD_M_CTA.FieldByName('historico').AsString           := lhistoricoNew;
                    FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrMovimentoNew;

                    FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := lContaNew;
                    FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := lTipoFinanceiroNew;

                    FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasNew;

                    FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
                    FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := lDtaMovimentoNew;
                    FIN_CD_M_CTA.FieldByName('id_obra').AsInteger            := lIdObraNew;
                      if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                        begin
                            FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                            FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                            FIN_CD_M_CXA.Close;
                            FIN_CD_M_CXA.Data :=
                            FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaNew]));
                            FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                            FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                            FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 0;
                        end;
                    FIN_CD_M_CTA.Post;
                  end;


                FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
                FIN_CD_M_PAG.Close;
                FIN_CD_M_PAG.Data :=
                FIN_CD_M_PAG.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_LMF').AsString]));


                if not (FIN_CD_M_PAG.IsEmpty) then
                  begin

                    FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                    FIN_CD_M_PAG_PAG.Close;
                    FIN_CD_M_PAG_PAG.Data :=
                    FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([3,FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]));

                    while not (FIN_CD_M_PAG_PAG.Eof) do
                     begin
                      FIN_CD_M_PAG_PAG.Delete;
                     end;
                    while not (FIN_CD_M_PAG.Eof) do
                     begin
                      FIN_CD_M_PAG.Delete;
                     end;


                     if FIN_CD_M_PAG_PAG <> nil then
                       if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
                         if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                           begin
                             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
                           end;

                     if FIN_CD_M_PAG <> nil then
                       if FIN_CD_M_PAG.ChangeCount > 0 then
                         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                           begin
                             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
                           end;

                  end
                else
                  begin
                     FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
                     FIN_CD_M_PAG_PAG.Close;
                     FIN_CD_M_PAG_PAG.Data :=
                     FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));

                  end;

                if (CAD_CD_C_TIF.FieldByName('natureza').AsInteger=0) and (CAD_CD_C_TIF.FieldByName('prestacao_conta').AsBoolean = false) then
                  begin
                    FIN_CD_M_PAG.Insert;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  :=
                        self.enValorChave('FAT_TB_M_NFE_TIT');
                        //DmApoio.enBusValorChave('FAT_TB_M_NFE_TIT');
                    FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('pde_id_fornecedor').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                    FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := lDtaMovimentoNew;
                    FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := lDtaMovimentoNew;
                    FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := lDtaMovimentoNew;
                    FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 5;//Lanamento do Movimento Funcionario
                    FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := lvlrMovimentoNew;
                    FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := lvlrMovimentoNew;
                    FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                    FIN_CD_M_PAG.FieldByName('historico').AsString        := lhistoricoNew;
                    FIN_CD_M_PAG.FieldByName('id_plano').AsString         := lPlanoContasNew;
                    FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                    FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                    FIN_CD_M_PAG.FieldByName('id_lmf').AsInteger          := dataset.FieldByName('ID_LMF').AsInteger;
                    FIN_CD_M_PAG.FieldByName('id_obra').AsInteger         := lIdObraNew;
                    FIN_CD_M_PAG.Post;

                    
                    FIN_CD_M_PAG_PAG.Insert;

                    FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                        self.enValorChave('FIN_TB_M_PBX');
                        DmApoio.enBusValorChave('FIN_TB_M_PBX');
                    FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := lDtaMovimentoNew;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := lvlrMovimentoNew;

                    FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                    FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := lhistoricoNew;
                    FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := lPlanoContasNew;
                    FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                    FIN_CD_M_PAG_PAG.Post;
                  end;
             end;
       end
     else
       begin
          FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
          FIN_CD_M_CTA.Close;
          FIN_CD_M_CTA.Data :=
          FIN_CD_M_CTA.DataRequest(VarArrayOf([2,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('ID_LMF').AsString]));

          if not (FIN_CD_M_CTA.IsEmpty) then
            begin
             while not (FIN_CD_M_CTA.Eof) do
              begin
               FIN_CD_M_CTA.Delete;
              end;
            end;


          FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
          FIN_CD_M_PAG.Close;
          FIN_CD_M_PAG.Data :=
          FIN_CD_M_PAG.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_LMF').AsString]));


          if not (FIN_CD_M_PAG.IsEmpty) then
            begin

              FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
              FIN_CD_M_PAG_PAG.Close;
              FIN_CD_M_PAG_PAG.Data :=
              FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([3,FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString]));

              while not (FIN_CD_M_PAG_PAG.Eof) do
               begin
                FIN_CD_M_PAG_PAG.Delete;
               end;
              while not (FIN_CD_M_PAG.Eof) do
               begin
                FIN_CD_M_PAG.Delete;
               end;
            end;


       if FIN_CD_M_PAG_PAG <> nil then
         if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
           if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
             begin
               raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
             end;

       if FIN_CD_M_PAG <> nil then
        if FIN_CD_M_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
           end;


       end;


     if FIN_CD_M_CTA <> nil then
       if FIN_CD_M_CTA.ChangeCount > 0 then
        if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
          begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de movimentao da conta.');
          end;


     if FIN_CD_M_PAG <> nil then
       if FIN_CD_M_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
           end;

     if FIN_CD_M_PAG_PAG <> nil then
       if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
           end;



   finally
    BUS_CD_C_FPG.Free;
    BUS_CD_C_FOR.Free;
    BUS_CD_C_PAR_CTR.Free;
    FIN_CD_M_CTA.Free;
    FIN_CD_M_PAG.Free;
    FIN_CD_M_PAG_PAG.Free;
    CAD_CD_C_TIF.Free;
    FIN_CD_M_CXA.Free;
    CAD_CD_C_CTC.Free;
   end;

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_MCHDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
    result:= FIN_RN_M_MCH.fin_dr_m_mch(Sender, Input, FIN_SQ_M_MCH, FIN_DP_M_MCH);
end;

procedure TSM.FIN_DP_M_MCHUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_MCH.FIN_DP_M_MCHUpdateData(DataSet,CAD_DP_C_FPG, CAD_DP_C_TIF,CAD_DP_C_CTC,
                                      BUS_DP_M_MCH_CHE_INT,BUS_DP_M_REC_HCH_INT,  FIN_DP_M_REC, FIN_DP_M_REC_PAG,
                                      FIN_DP_M_CTA, BUS_DP_C_PAR_CTR,BUS_DP_M_REC_INT,self);
end;

function TSM.FIN_DP_R_MCH_TOTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
   FIN_SQ_R_MCH_TOT.Close;

   FIN_SQ_R_MCH_TOT.CommandText :=
            '  with tb_vlr_total_por_mch as (select DISTINCT ON (mch.id_controle) mch.id_controle, mch.id_empresa,mch.vlr_movimento, '+
            '          mch.vlr_tot_movimento, mch.vlr_tot_juros '+
            ' from fin_tb_m_mch_che mche '+
            ' left outer join fin_tb_m_mch mch on mch.id_controle = mche.id_controle '+
            ' left outer join fin_tb_m_rec rec on rec.id_titulo = mche.id_titulo '+
            ' WHERE MCH.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
            '    MCH.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

    if Input[2] <> '' then
      begin
        FIN_SQ_R_MCH_TOT.CommandText := FIN_SQ_R_MCH_TOT.CommandText  +
              ' and mche.id_titulo in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_MCH_TOT.CommandText := FIN_SQ_R_MCH_TOT.CommandText  +
              ' and rec.che_cheque in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        FIN_SQ_R_MCH_TOT.CommandText := FIN_SQ_R_MCH_TOT.CommandText  +
              ' and mch.id_empresa in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        FIN_SQ_R_MCH_TOT.CommandText := FIN_SQ_R_MCH_TOT.CommandText  +
              ' and rec.id_cliente in (' + VarToStr(Input[5]) +') ';
      end;

    FIN_SQ_R_MCH_TOT.CommandText := FIN_SQ_R_MCH_TOT.CommandText  +
        ') select sum(vmch.vlr_movimento) as tot_movimento, sum(vmch.vlr_tot_movimento) as tot_ger_movimento, sum(vmch.vlr_tot_juros) as tot_juros  '+
        '  from tb_vlr_total_por_mch vmch ';

   Result := FIN_DP_R_MCH_TOT.Data;
   FIN_SQ_R_MCH_TOT.Close;
end;

function TSM.FIN_DP_M_ORCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlOrcPag: String;
  begin
    Result :=
        ' select * from fin_tb_m_orc';
  end;
begin
   FIN_SQ_M_ORC.Close;
   if Input[0] = 0 then
      begin
         if (Input[1] <> '') then
           begin
             FIN_SQ_M_ORC.CommandText := enSqlOrcPag +
               ' WHERE id_orc = ''' + VarToStr(Input[1]) +''' ';
           end
         else
           begin
             FIN_SQ_M_ORC.CommandText := enSqlOrcPag +
               ' WHERE 1=2 ';
           end;
      end
   else if Input[0] = 1 then
      begin
           FIN_SQ_M_ORC.CommandText := enSqlOrcPag +
             ' WHERE ano = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 2 then
      begin
         FIN_SQ_M_ORC.CommandText := enSqlOrcPag;
         if (Input[1] <> '') then
            begin
             FIN_SQ_M_ORC.CommandText := FIN_SQ_M_ORC.CommandText +
                ' WHERE id_empresa = ''' + VarToStr(Input[1]) +''' ';
            end;
      end;

   if Input[0] = 90 then
      begin
        FIN_SQ_M_ORC.CommandText := enSqlOrcPag +
                ' WHERE id_empresa = ''' + VarToStr(Input[1]) +''' '+
                ' and ano = '''+VarToStr(Input[2])+'''';
      end;
   Result := FIN_DP_M_ORC.Data;
end;

procedure TSM.FIN_DP_M_PAGBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
 FIN_RN_M_PAG.FIN_BUR_M_PAG(Sender, SourceDS, DeltaDS, UpdateKind, Applied,self);
end;

function TSM.FIN_DP_M_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
 result := FIN_RN_M_PAG.FIN_DR_M_PAG(Sender, Input, FIN_SQ_M_PAG, FIN_DP_M_PAG);
end;

procedure TSM.FIN_DP_M_PAGGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 06/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_PAGUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 06/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_PAG_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPagPag: String;
  begin
    Result :=
        ' select * from fin_tb_m_pag_pag pag';
  end;
begin
   FIN_SQ_M_PAG_PAG.Close;
   if Input[0] = 0 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 1 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.ID_BAIXA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  pag.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[0] = 2 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE 1 = 2 ';
      end;

   if Input[0] = 3 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.id_titulo = '''+VarToStr(Input[1])+''' ';
      end;

   if Input[0] = 90 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.id_titulo = '''+VarToStr(Input[1])+''' ';
      end;

   if Input[0] = 91 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.id_brd = '''+VarToStr(Input[1])+''' ';
      end;

   if Input[0] = 92 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.id_titulo in ('+VarToStr(Input[1])+') ';
      end;

   if Input[0] = 93 then
      begin
           FIN_SQ_M_PAG_PAG.CommandText := enSqlPagPag +
             ' WHERE pag.id_fiscal ='''+VarToStr(Input[1])+''' ';
      end;

   Result := FIN_DP_M_PAG_PAG.Data;

end;

procedure TSM.FIN_DP_M_PBXBeforeUpdateRecord(Sender: TObject;
  SourceDS: TDataSet; DeltaDS: TCustomClientDataSet; UpdateKind: TUpdateKind;
  var Applied: Boolean);
begin
  if UpdateKind = ukInsert then
     begin
       if SourceDS = FIN_SQ_M_PBX then
          begin
            DeltaDS.fieldByName('dta_lancamento').newValue:= date;
          end;
     end;
end;

function TSM.FIN_DP_M_PBXDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFinPbx: String;
  begin
    Result :=
        'SELECT PBX.*, '+
        '  FOC.descricao AS INT_NOMEFOR, '+
        '  FOC.doc_cnpj as INT_DOCCNPJ,  '+
        '  FPG.descricao AS INT_NOMEFPG, '+
        '  PCT.descricao AS INT_NOMEPCT  '+
        'FROM FIN_TB_M_PBX PBX '+
        'LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.id_fornecedor=PBX.id_fornecedor '+
        'LEFT OUTER JOIN CAD_TB_C_FPG FPG ON fpg.id_forma_pag=PBX.id_forma_pag '+
        'LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.id_abertura=PBX.id_abertura '+
        'LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.id_plano=PBX.id_plano ';
  end;

begin

   FIN_SQ_M_PBX.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_PBX.CommandText := enSqlFinPbx + ' WHERE 1=2 '
        else
           FIN_SQ_M_PBX.CommandText := enSqlFinPbx +
             ' WHERE  PBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND PBX.ID_BAIXA = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_PBX.CommandText := enSqlFinPbx +
          ' WHERE  PBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(FOC.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_PBX.CommandText := enSqlFinPbx +
             ' WHERE PBX.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND PBX.DTA_BAIXA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_PBX.CommandText := enSqlFinPbx +
          ' WHERE PBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          Format(' AND upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_PBX.CommandText := enSqlFinPbx +
          ' WHERE PBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          Format(' and upper(PBX.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := FIN_DP_M_PBX.Data;

   FIN_SQ_M_PBX.Close;
end;

procedure TSM.FIN_DP_M_PBXUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_PBX.FIN_DP_M_PBXUpdateData(sender,DataSet,
                                      FIN_DP_M_PAG_PAG,FIN_DP_M_PAG,FIN_DP_M_CTA,CAD_DP_C_FPG,
                                      CAD_DP_C_CTC,CAD_DP_C_TIF,FIN_DP_M_PCR,FIN_DP_M_PBX_TIT_INT,BUS_DP_C_PAR_CTR,self);

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_PBX_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPbxTit: String;
  begin
    Result :=
        ' SELECT TIT.* FROM FIN_TB_M_PBX_TIT TIT';
  end;
begin
   FIN_SQ_M_PBX_TIT_INT.Close;
   if Input[0] = 0 then
      begin
           FIN_SQ_M_PBX_TIT_INT.CommandText := enSqlPbxTit +
             ' WHERE tit.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := FIN_DP_M_PBX_TIT_INT.Data;

end;

function TSM.FIN_DP_M_PCRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFinPcr: String;
  begin
    Result :=
     ' SELECT PCR.*, '+
     ' FON.DESCRICAO AS INT_NOMEFOR '+
     ' FROM  FIN_TB_M_PCR PCR '+
     ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PCR.ID_FORNECEDOR ';

  end;
begin
   FIN_SQ_M_PCR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr + ' WHERE 1=2 '
        else
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
             ' WHERE PCR.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PCR.ID_CREDITO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
           ' WHERE PCR.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             Format('AND upper(FON.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
             ' WHERE PCR.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
             ' AND PCR.ID_FORNECEDOR = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
          ' WHERE PCR.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
          Format('AND upper(HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
               ' WHERE PCR.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' '+
               ' AND PCR.DTA_CREDITO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;


   if Input[0] = 90 then
     begin
         FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
               ' WHERE PCR.ID_FORNECEDOR = ''' + VarToStr(Input[1]) +''' '+
               ' AND PCR.ID_BAIXA = ''' + VarToStr(Input[2]) + ''' '+
               ' AND PCR.ID_TITULO in (' + VarToStr(Input[3])  + ') ';
     end
   else if Input[0] = 91 then
     begin
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
               ' WHERE PCR.ID_FORNECEDOR = ''' + VarToStr(Input[1]) +''' '+
               ' AND PCR.ID_BAIXA = ''' + VarToStr(Input[2]) + ''' ';
     end
   else if Input[0] = 92 then
     begin
           FIN_SQ_M_PCR.CommandText := enSqlFinPcr +
               ' WHERE PCR.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
     end;


   Result := FIN_DP_M_PCR.Data;

end;



function TSM.FIN_DP_M_PRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlFinPrc: String;
  begin
    Result :=

     ' select prc.*,lmf.id_funcionario as int_codfun,                             '+
     ' lmf.dta_movimento as int_dta_mov,                                          '+
     ' lmf.vlr_movimento as int_vlr_mov,                                          '+
     ' lmf.vlr_saldo as int_vlr_saldo,                                            '+
     ' fun.nome as int_nomefun                                                    '+
     ' from fin_tb_m_prc prc                                                      '+
     ' left outer join fin_tb_m_lmf lmf on lmf.id_lmf=prc.id_lmf                  '+
     ' left outer join cad_tb_c_fun fun on fun.id_funcionario=lmf.id_funcionario  ';
  end;

begin

   FIN_SQ_M_PRC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_PRC.CommandText := enSqlFinPrc + ' WHERE 1=2 '
        else
           FIN_SQ_M_PRC.CommandText := enSqlFinPrc +
             ' WHERE  prc.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' and prc.id_prc = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_PRC.CommandText := enSqlFinPrc +
             ' WHERE prc.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND prc.dta_prestacao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_PRC.CommandText := enSqlFinPrc +
             ' WHERE prc.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' '+
             ' AND prc.id_lmf = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_PRC.CommandText := enSqlFinPrc +
          ' WHERE PRC.ID_EMPRESA = ''' + VarToStr(Input[1]) + '''  ' +
          Format(' AND upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   Result := FIN_DP_M_PRC.Data;
   FIN_SQ_M_PRC.Close;
end;


procedure TSM.FIN_DP_M_PRCUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
VAR
 lTipoFinanceiro:Integer;
 lTipoFinanceiroCP,lTipoTitulo,lConta,lPlanoContas,lHistorico:String;
 lvlrPrestacao,lvlrTotalPrestacao:currency;
 lDtaPrestacao:TDateTime;

 lTipoFinanceiroNew:Integer;
 lTipoFinanceiroCPNew,lTipoTituloNew,lContaNew,lPlanoContasNew,lHistoricoNew:String;
 lvlrPrestacaoNew,lvlrTotalPrestacaoNew:currency;
 lDtaPrestacaoNew:TDateTime;
 xTitulos,xIdTitulo:String;

 BUS_DP_M_LMF_INT:TDataSetProvider;
 BUS_SQ_M_LMF_INT:TSqlDataSet;

 cds:TDataSet;
 FIN_CD_M_PAG,FIN_CD_M_CTA,FIN_CD_M_PAG_PAG,CAD_CD_C_TIF,BUS_CD_C_PAR_CTR,BUS_CD_C_FPG,BUS_CD_C_FOR,FIN_CD_M_CXA,CAD_CD_C_CTC,BUS_CD_M_LMF:TClientdataset;
Begin





    try
       cds:= TDataSetField(Dataset.FieldByName('FIN_SQ_M_PRC_DET')).NestedDataSet;


       BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
       BUS_CD_C_FPG :=TClientDataSet.Create(nil);
       BUS_CD_C_FOR :=TClientDataSet.Create(nil);
       CAD_CD_C_TIF := TClientDataSet.Create(nil);
       FIN_CD_M_PAG :=TClientDataSet.Create(nil);
       FIN_CD_M_PAG_PAG := TClientDataSet.Create(nil);
       FIN_CD_M_CTA := TClientDataSet.Create(nil);
       FIN_CD_M_CXA := TClientDataSet.Create(nil);
       CAD_CD_C_CTC := TClientDataSet.Create(nil);

       BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
       BUS_CD_C_PAR_CTR.Close;
       BUS_CD_C_PAR_CTR.Data :=
       BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataset.FieldByName('ID_EMPRESA').AsString]));

       if ((trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORNECEDOR').AsString) = '') or
          (trim(BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_LOCAL_TITULO').AsString) = '')) then
        begin
          raise Exception.Create('Os parmetros forma de pagamento,local de ttulo e fornecedor devem ser preenchidos.');
        end;

      BUS_CD_C_FOR.SetProvider(CAD_DP_C_FOR);
      BUS_CD_C_FOR.Close;
      BUS_CD_C_FOR.Data :=
      BUS_CD_C_FOR.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('PDE_ID_FORNECEDOR').AsString]));

      if (BUS_CD_C_FOR.IsEmpty) then
        begin
          raise Exception.Create('Fornecedor no cadastrado.');
        end;


      FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA_INT);
      FIN_CD_M_CTA.Close;
      FIN_CD_M_CTA.Data :=
      FIN_CD_M_CTA.DataRequest(VarArrayOf([3,dataset.FieldByName('ID_EMPRESA').AsInteger,
                                            dataset.FieldByName('ID_PRC').AsInteger]));

      FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
      FIN_CD_M_PAG.Close;
      FIN_CD_M_PAG.Data :=
      FIN_CD_M_PAG.DataRequest(VarArrayOf([96,dataset.FieldByName('ID_PRC').AsInteger]));


      FIN_CD_M_PAG.First;
      while not FIN_CD_M_PAG.eof do
       begin
         if xTitulos  <> '' then
           xTitulos := xTitulos +','+''''+FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString+''''
         else
           xTitulos := xTitulos +''''+ FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString+'''';

         FIN_CD_M_PAG.Next;
       end;

      FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
      if xTitulos<>'' then
        begin
         FIN_CD_M_PAG_PAG.Close;
         FIN_CD_M_PAG_PAG.Data :=
         FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([92,xTitulos]));
        end
      else
        begin
         FIN_CD_M_PAG_PAG.Close;
         FIN_CD_M_PAG_PAG.Data :=
         FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));
        end;


      BUS_SQ_M_LMF_INT := TSQLDataSet.Create(nil);
      BUS_SQ_M_LMF_INT.SQLConnection := Conexao;
      BUS_SQ_M_LMF_INT.CommandType   := ctQuery;
      BUS_SQ_M_LMF_INT.CommandText   := 'SELECT * FROM FIN_TB_M_LMF WHERE ID_LMF = ' +
                                       dataset.FieldByName('ID_LMF').AsString;

      BUS_DP_M_LMF_INT := TDataSetProvider.Create(nil);
      BUS_DP_M_LMF_INT.DataSet := BUS_SQ_M_LMF_INT;

      BUS_CD_M_LMF := TClientDataSet.Create(nil);
      BUS_CD_M_LMF.SetProvider(BUS_DP_M_LMF_INT);
      BUS_CD_M_LMF.Open;

      lvlrTotalPrestacao := dataset.FieldByName('VLR_TOTAL_PRC').AsCurrency;
      lvlrTotalPrestacaoNew := dataset.FieldByName('VLR_TOTAL_PRC').AsCurrency;
      if not (dataset.UpdateStatus in [usDeleted]) then
       begin
          if dataset.UpdateStatus in [usUnmodified] then
               begin
                  dataset.next;
                   if trim(dataset.FieldByName('VLR_TOTAL_PRC').AsString) <> '' then
                     lvlrTotalPrestacaoNew := dataset.FieldByName('VLR_TOTAL_PRC').AsCurrency;
                  dataset.Prior;
               end;


      cds.First;
      while not cds.eof do
        begin
            lConta                := cds.FieldByName('ID_CONTA').AsString;
            lTipoFinanceiro       := cds.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
            lTipoFinanceiroCP     := cds.FieldByName('ID_TIPO_FINANCEIRO_CP').AsString;
            lTipoTitulo           := cds.FieldByName('ID_TIPO_TITULO').AsString;
            lPlanoContas          := cds.FieldByName('ID_PLANO').AsString;
            lvlrPrestacao         := cds.FieldByName('VLR_PRESTACAO').AsCurrency;
            lHistorico            := cds.FieldByName('HISTORICO').AsString;

            lContaNew                := cds.FieldByName('ID_CONTA').AsString;
            lTipoFinanceiroNew       := cds.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;
            lTipoFinanceiroCPNew     := cds.FieldByName('ID_TIPO_FINANCEIRO_CP').AsString;
            lTipoTituloNew           := cds.FieldByName('ID_TIPO_TITULO').AsString;
            lPlanoContasNew          := cds.FieldByName('ID_PLANO').AsString;
            lvlrPrestacaoNew         := cds.FieldByName('VLR_PRESTACAO').AsCurrency;
            lHistoricoNew            := cds.FieldByName('HISTORICO').AsString;




            if cds.UpdateStatus in [usUnmodified] then
               begin
                  cds.next;

                  if trim(cds.FieldByName('ID_CONTA').AsString) <> '' then
                     lContaNew       := cds.FieldByName('ID_CONTA').AsString;

                  if trim(cds.FieldByName('ID_TIPO_FINANCEIRO').AsString) <> '' then
                     lTipoFinanceiroNew       := cds.FieldByName('ID_TIPO_FINANCEIRO').AsInteger;

                  if trim(cds.FieldByName('ID_TIPO_FINANCEIRO_CP').AsString) <> '' then
                     lTipoFinanceiroCPNew       := cds.FieldByName('ID_TIPO_FINANCEIRO_CP').AsString;

                 if trim(cds.FieldByName('ID_TIPO_TITULO').AsString) <> '' then
                     lTipoTituloNew       := cds.FieldByName('ID_TIPO_TITULO').AsString;

                  if trim(cds.FieldByName('ID_PLANO').AsString) <> '' then
                     lPlanoContasNew       := cds.FieldByName('ID_PLANO').AsString;

                  if trim(cds.FieldByName('VLR_PRESTACAO').AsString) <> '' then
                     lvlrPrestacaoNew := cds.FieldByName('VLR_PRESTACAO').AsCurrency;

                   if trim(cds.FieldByName('HISTORICO').AsString) <> '' then
                     lhistoricoNew := cds.FieldByName('HISTORICO').AsString;

                  cds.Prior;

                end;


           if not (cds.UpdateStatus in [usDeleted]) then
             begin
                 if (cds.UpdateStatus in [usInserted]) then
                   begin
                     CAD_CD_C_TIF := TClientDataSet.Create(nil);
                     CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                     CAD_CD_C_TIF.Close;
                     CAD_CD_C_TIF.Data :=
                     CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiro]));

                    if lConta<>'0' then
                      begin
                        enGerFinCxaBco(sender,8,dataset,cds,FIN_CD_M_CTA,0);
                      end;

                    if CAD_CD_C_TIF.FieldByName('natureza').AsInteger = 0 then
                       begin

                          FIN_CD_M_PAG.Insert;
                          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                          FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  :=
                              self.enValorChave('FAT_TB_M_NFE_TIT');
                              //DmApoio.enBusValorChave('FAT_TB_M_NFE_TIT');
                          FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                          FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('pde_id_fornecedor').AsInteger;
                          FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                          FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                          FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                          FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                          FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 6;//Prestacao de Contas
                          FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := cds.FieldBYName('ID_TIPO_TITULO').AsInteger;
                          FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := cds.FieldByName('VLR_PRESTACAO').AsCurrency;
                          FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := cds.FieldByName('VLR_PRESTACAO').AsCurrency;
                          FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                          FIN_CD_M_PAG.FieldByName('historico').AsString        := cds.FieldByName('HISTORICO').AsString;
                          FIN_CD_M_PAG.FieldByName('id_plano').AsString         := cds.FieldByName('ID_PLANO').AsString;
                          FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                          FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                          FIN_CD_M_PAG.FieldByName('id_prc').AsInteger          := dataset.FieldByName('ID_PRC').AsInteger;
                          FIN_CD_M_PAG.FieldByName('id_prc_det').AsInteger      := cds.FieldByName('ID_SEQUENCIA').AsInteger;

                          FIN_CD_M_PAG.Post;


                          FIN_CD_M_PAG_PAG.Insert;

                          FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                          FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger     :=
                              sm.enValorChave('FIN_TB_M_PBX');
                              //DmApoio.enBusValorChave('FIN_TB_M_PBX');
                          FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                          FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := cds.FieldByName('VLR_PRESTACAO').AsCurrency;

                          FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                          FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                          FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                          FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                          FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := cds.FieldByName('HISTORICO').AsString;
                          FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                          FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := cds.FieldBYName('ID_TIPO_TITULO').AsInteger;
                          FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := cds.FieldByName('ID_PLANO').AsString;
                          FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                          FIN_CD_M_PAG_PAG.Post;
                       end;

                   end;

                 if (cds.UpdateStatus in [usUnmodified]) then
                   begin

                      CAD_CD_C_TIF:= TClientDataSet.Create(nil);
                      CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                      CAD_CD_C_TIF.Close;
                      CAD_CD_C_TIF.Data :=
                      CAD_CD_C_TIF.DataRequest(VarArrayOf([0, lTipoFinanceiroNew]));

                      try
                      FIN_CD_M_CTA.Filtered := true;
                      FIN_CD_M_CTA.Filter:='ID_PRC_DET='+cds.FieldBYName('ID_SEQUENCIA').AsString;


                      if not FIN_CD_M_CTA.IsEmpty then
                        begin

                          if lContaNew<> '0' then
                            begin
                              CAD_CD_C_CTC:= TClientDataSet.Create(nil);
                              CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                              CAD_CD_C_CTC.Close;
                              CAD_CD_C_CTC.Data :=
                              CAD_CD_C_CTC.DataRequest(VarArrayOf([0,lContaNew]));



                              if FIN_CD_M_CTA.Locate('ID_PRC_DET;ID_TIPO_FINANCEIRO',
                                        varArrayOf([cds.FieldBYName('ID_SEQUENCIA').AsString,lTipoFinanceiro]),[]) then
                                 begin
                                   FIN_CD_M_CTA.Edit;
                                 end
                              else
                                 begin
                                   FIN_CD_M_CTA.Insert;
                                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                   FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                                       self.enValorChave('FIN_TB_M_CTA');
                                       // DmApoio.enBusValorChave('FIN_TB_M_CTA');
                                 end;



                                  FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

                                  FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
                                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

                                  FIN_CD_M_CTA.FieldByName('historico').AsString           := lHistoricoNew;
                                  FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lVlrPrestacaoNew;
                                  FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
                                  FIN_CD_M_CTA.FieldByName('id_conta').AsString            := lContaNew;
                                  FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := ltipoFinanceiroNew;

                                  FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasNew;
                                  FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                                  FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
                                  FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                                  FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                                  FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cds.FieldByName('id_sequencia').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;

                                  if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                                      begin
                                          FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                          FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                          FIN_CD_M_CXA.Close;
                                          FIN_CD_M_CXA.Data :=
                                          FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaNew]));
                                          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                      end;

                                  FIN_CD_M_CTA.Post;


                              if lTipoFinanceiroCPNew<>'0' then
                                begin
                                   if (lTipoFinanceiroCP <> '0') and FIN_CD_M_CTA.Locate('ID_PRC_DET;ID_TIPO_FINANCEIRO',
                                          varArrayOf([cds.FieldBYName('ID_SEQUENCIA').AsString,lTipoFinanceiroCP]),[]) then
                                      begin
                                        FIN_CD_M_CTA.Edit;
                                      end
                                   else
                                      begin
                                       FIN_CD_M_CTA.Insert;
                                       // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                       FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                                          self.enValorChave('FIN_TB_M_CTA');
                                       //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                                      end;


                                  CAD_CD_C_TIF := TClientDataSet.Create(nil);
                                  CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                                  CAD_CD_C_TIF.Close;
                                  CAD_CD_C_TIF.Data :=
                                  CAD_CD_C_TIF.DataRequest(VarArrayOf([0,lTipoFinanceiroCPNew]));



                                  FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

                                  FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
                                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

                                  FIN_CD_M_CTA.FieldByName('historico').AsString           := lHistoricoNew;
                                  FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrPrestacaoNew;
                                  FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
                                  FIN_CD_M_CTA.FieldByName('id_conta').AsString            := lcontaNew;
                                  FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsString  := ltipoFinanceiroCPNew;

                                  FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasNew;
                                  FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                                  FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
                                  FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                                  FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                                  FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cds.FieldByName('id_sequencia').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;

                                  if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                                      begin
                                          FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                          FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                          FIN_CD_M_CXA.Close;
                                          FIN_CD_M_CXA.Data :=
                                          FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaNew]));
                                          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                      end;

                                  FIN_CD_M_CTA.Post;
                                end
                              else
                                begin
                                  if lTipoFinanceiroCP<>'0' then
                                    begin
                                      if FIN_CD_M_CTA.Locate('ID_PRC_DET;ID_TIPO_FINANCEIRO',
                                          varArrayOf([cds.FieldBYName('ID_SEQUENCIA').AsString,lTipoFinanceiroCP]),[]) then
                                        FIN_CD_M_CTA.Delete;
                                    end;
                                end;

                            end
                          else
                            begin
                              while not FIN_CD_M_CTA.EOF do
                                FIN_CD_M_CTA.Delete;
                            end;
                       end
                     else
                       if lContaNew<> '0' then
                         begin
                             CAD_CD_C_CTC:= TClientDataSet.Create(nil);
                             CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                             CAD_CD_C_CTC.Close;
                             CAD_CD_C_CTC.Data :=
                             CAD_CD_C_CTC.DataRequest(VarArrayOf([0,lContaNew]));

                             FIN_CD_M_CTA.Insert;
                             // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                             FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                                 self.enValorChave('FIN_TB_M_CTA');
                             FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

                              FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                              FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
                              FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                              FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
                              FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

                              FIN_CD_M_CTA.FieldByName('historico').AsString           := lhistoricoNew;
                              FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrPrestacaoNew;
                              FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
                              FIN_CD_M_CTA.FieldByName('id_conta').AsString            := lContaNew;
                              FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := ltipoFinanceiroNew;

                              FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasNew;
                              FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                              FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
                              FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                              FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                              FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                              FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                              FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                              FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
                              FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cds.FieldByName('id_sequencia').AsInteger;
                              FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;

                              if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                                  begin
                                      FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                      FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                      FIN_CD_M_CXA.Close;
                                      FIN_CD_M_CXA.Data :=
                                      FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,lContaNew]));
                                      FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                      FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                  end;
                             FIN_CD_M_CTA.Post;




                             if lTipoFinanceiroCPNew<>'0' then
                                begin
                                  CAD_CD_C_TIF := TClientDataSet.Create(nil);
                                  CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                                  CAD_CD_C_TIF.Close;
                                  CAD_CD_C_TIF.Data :=
                                  CAD_CD_C_TIF.DataRequest(VarArrayOf([0,lTipoFinanceiroCPNew]));

                                  FIN_CD_M_CTA.Insert;

                                  FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

                                  FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
                                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

                                  FIN_CD_M_CTA.FieldByName('historico').AsString           := lhistoricoNew;
                                  FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := lvlrPrestacaoNew;
                                  FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
                                  FIN_CD_M_CTA.FieldByName('id_conta').AsString            := lContaNew;
                                  FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsString  := lTipoFinanceiroCPNew;

                                  FIN_CD_M_CTA.FieldByName('id_plano').AsString            := lPlanoContasNew;
                                  FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                                  FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
                                  FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                                  FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                                  FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                                  FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cds.FieldByName('id_sequencia').AsInteger;
                                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;

                                  if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                                      begin
                                          FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                                          FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                                          FIN_CD_M_CXA.Close;
                                          FIN_CD_M_CXA.Data :=
                                          FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,cds.FieldByName('id_conta').AsString]));
                                          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                                          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                                      end;


                                  FIN_CD_M_CTA.Post;
                                end;
                         end;
                      finally
                        FIN_CD_M_CTA.Filtered := false;
                      end;

                      CAD_CD_C_TIF := TClientDataSet.Create(nil);
                      CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                      CAD_CD_C_TIF.Close;
                      CAD_CD_C_TIF.Data :=
                      CAD_CD_C_TIF.DataRequest(VarArrayOf([0,lTipoFinanceiroNew]));

                      if FIN_CD_M_PAG.Locate('ID_PRC_DET',
                                        varArrayOf([cds.FieldBYName('ID_SEQUENCIA').AsString]),[]) then
                        begin
                          xIdTitulo := FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString;

                          if CAD_CD_C_TIF.FieldByName('natureza').AsInteger = 0 then
                            begin
                              FIN_CD_M_PAG.Edit;
                              FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('pde_id_fornecedor').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                              FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 6;//Prestacao de Contas
                              FIN_CD_M_PAG.FieldByName('id_forma_pag').AsString     := lTipoTituloNew;
                              FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := lvlrPrestacaoNew;
                              FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := lvlrPrestacaoNew;
                              FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                              FIN_CD_M_PAG.FieldByName('historico').AsString        := lhistoricoNew;
                              FIN_CD_M_PAG.FieldByName('id_plano').AsString         := lPlanoContasNew;
                              FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                              FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                              FIN_CD_M_PAG.FieldByName('id_prc').AsInteger          := dataset.FieldByName('ID_PRC').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_prc_det').AsInteger         := cds.FieldByName('id_sequencia').AsInteger;

                              FIN_CD_M_PAG.Post;


                              IF FIN_CD_M_PAG_PAG.Locate('ID_TITULO',
                                        varArrayOf([xidTitulo]),[]) then
                                begin
                                  FIN_CD_M_PAG_PAG.Edit;

                                  FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := lvlrPrestacaoNew;

                                  FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                                  FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := lhistoricoNew;
                                  FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsString       := lTipoTituloNew;
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := lPlanoContasNew;
                                  FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;

                                  FIN_CD_M_PAG_PAG.Post;
                                end;
                             end
                          else
                            begin
                              FIN_CD_M_PAG.Delete;
                              IF FIN_CD_M_PAG_PAG.Locate('ID_TITULO',
                                        varArrayOf([xidTitulo]),[]) then
                                begin
                                  FIN_CD_M_PAG_PAG.Delete;
                                end;

                              if FIN_CD_M_PAG_PAG <> nil then
                                if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
                                 if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                                   begin
                                     raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar .');
                                   end;

                               if FIN_CD_M_PAG <> nil then
                                if FIN_CD_M_PAG.ChangeCount > 0 then
                                 if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                                   begin
                                     raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
                                   end;

                            end;

                        end
                      else
                        begin
                          if CAD_CD_C_TIF.FieldByName('natureza').AsInteger = 0 then
                            begin
                              FIN_CD_M_PAG.Insert;
                              // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                              FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger  :=
                                 self.enValorChave('FAT_TB_M_NFE_TIT');
                              FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := BUS_CD_C_PAR_CTR.FieldBYName('pde_id_fornecedor').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := 0;
                              FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 6;//Prestacao de Contas
                              FIN_CD_M_PAG.FieldByName('id_forma_pag').AsString     := lTipoTituloNew;
                              FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := lvlrPrestacaoNew;
                              FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := lvlrPrestacaoNew;
                              FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
                              FIN_CD_M_PAG.FieldByName('historico').AsString        := lhistoricoNew;
                              FIN_CD_M_PAG.FieldByName('id_plano').AsString         := lPlanoContasNew;
                              FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_LOCAL_TITULO').AsInteger;
                              FIN_CD_M_PAG.FieldByName('tipo_lancamento').AsInteger := 1;
                              FIN_CD_M_PAG.FieldByName('id_prc').AsInteger          := dataset.FieldByName('ID_PRC').AsInteger;
                              FIN_CD_M_PAG.FieldByName('id_prc_det').AsInteger      := cds.FieldByName('id_sequencia').AsInteger;

                              FIN_CD_M_PAG.Post;

                              FIN_CD_M_PAG_PAG.Insert;

                              FIN_CD_M_PAG_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
                              // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                              FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                                  self.enValorChave('FIN_TB_M_PBX');
                              FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := dataset.FieldByName('DTA_PRESTACAO').AsDateTime;
                              FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := lvlrPrestacaoNew;

                              FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                              FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                              FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
                              FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                              FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          := lhistoricoNew;
                              FIN_CD_M_PAG_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                              FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsString       := lTipoTituloNew;
                              FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           := lPlanoContasNew;
                              FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger       := 0;



                              FIN_CD_M_PAG_PAG.Post;
                            end;
                        end;
                     cds.Next;
                   end;
             end
           else
             begin
                try
                  FIN_CD_M_CTA.Filtered := true;
                  FIN_CD_M_CTA.Filter:= 'ID_PRC_DET='+cds.FieldByName('id_sequencia').AsString;
                  FIN_CD_M_CTA.First;
                  if not (FIN_CD_M_CTA.IsEmpty) then
                    begin
                     while not (FIN_CD_M_CTA.Eof) do
                      begin
                       FIN_CD_M_CTA.Delete;
                      end;
                    end;
                finally
                  FIN_CD_M_CTA.Filtered := false;
                end;

                if FIN_CD_M_PAG.Locate('ID_PRC_DET',
                                        varArrayOf([cds.FieldByName('id_sequencia').AsString]),[]) then
                  begin
                    xIdTitulo := FIN_CD_M_PAG.FieldByName('ID_TITULO').AsString;
                    FIN_CD_M_PAG.Delete;
                    if FIN_CD_M_PAG_PAG.Locate('ID_PRC_DET',
                                        varArrayOf([cds.FieldByName('id_sequencia').AsString]),[]) then
                      FIN_CD_M_PAG_PAG.Delete;


                   if FIN_CD_M_PAG_PAG <> nil then
                      if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
                       if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                         begin
                           raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar .');
                         end;

                     if FIN_CD_M_PAG <> nil then
                      if FIN_CD_M_PAG.ChangeCount > 0 then
                       if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                         begin
                           raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
                         end;
                  end;

             end;

             cds.Next;
       end;

          BUS_CD_M_LMF.Edit;

          if dataset.UpdateStatus in [usUnmodified] then
                 BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency :=
                    (BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency - lvlrTotalPrestacao) + lvlrTotalPrestacaoNew
          else if dataset.UpdateStatus in [usInserted] then
              BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency :=
                    (BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency + lvlrTotalPrestacao);

          BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency :=
                 BUS_CD_M_LMF.FieldByName('VLR_MOVIMENTO').AsCurrency - BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency;


          if BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency = 0 then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 2;
            end
          ELSE if (BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency=0) then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 0;
            end
          else if BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency >0 then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 1;
            end;



          BUS_CD_M_LMF.Post;



      end
     else
       begin
         FIN_CD_M_CTA.First;
         while not (FIN_CD_M_CTA.Eof) do
          begin
           FIN_CD_M_CTA.Delete;
          end;

          FIN_CD_M_PAG_PAG.First;
          while not (FIN_CD_M_PAG_PAG.Eof) do
           begin
            FIN_CD_M_PAG_PAG.Delete;
           end;

          FIN_CD_M_PAG.First;
          while not (FIN_CD_M_PAG.Eof) do
           begin
            FIN_CD_M_PAG.Delete;
           end;

          BUS_CD_M_LMF.Edit;
          BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency :=
             (BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency - lvlrTotalPrestacao);
          BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency :=
                 BUS_CD_M_LMF.FieldByName('VLR_MOVIMENTO').AsCurrency - BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency;

          if BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency = 0 then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 2;
            end
          ELSE if (BUS_CD_M_LMF.FieldByName('VLR_PAGO').AsCurrency=0) then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 0;
            end
          else if BUS_CD_M_LMF.FieldByName('VLR_SALDO').AsCurrency >0 then
            begin
               BUS_CD_M_LMF.FieldByName('STATUS').AsInteger := 1;
            end;

          BUS_CD_M_LMF.Post;


       if FIN_CD_M_PAG_PAG <> nil then
        if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar .');
           end;

       if FIN_CD_M_PAG <> nil then
        if FIN_CD_M_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
           end;
       end;




     if FIN_CD_M_CTA <> nil then
       if FIN_CD_M_CTA.ChangeCount > 0 then
        if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
          begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de movimentao da conta.');
          end;


     if FIN_CD_M_PAG <> nil then
       if FIN_CD_M_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar.');
           end;

     if FIN_CD_M_PAG_PAG <> nil then
       if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
         if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar a tabela de contas a pagar .');
           end;

     if BUS_CD_M_LMF <> nil then
       if BUS_CD_M_LMF.ChangeCount > 0 then
         if not (BUS_CD_M_LMF.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar o saldo do movimento do funcionrio.');
           end;

   finally
    BUS_CD_C_FPG.Free;
    BUS_CD_C_FOR.Free;
    BUS_CD_C_PAR_CTR.Free;
    FIN_CD_M_CTA.Free;
    FIN_CD_M_PAG.Free;
    FIN_CD_M_PAG_PAG.Free;
    CAD_CD_C_TIF.Free;
    FIN_CD_M_CXA.Free;
    CAD_CD_C_CTC.Free;
    BUS_CD_M_LMF.Free;
   end;

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;



function TSM.FIN_DP_M_RBXDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlFinRbx: String;
  begin
    Result :=
      'SELECT rbx.*, '+
      '  CLI.NOME AS INT_NOMECLI, FPG.DESCRICAO AS INT_NOMEFPG, '+
      '  CLI.doc_cnpj_cpf AS INT_DOCCNPJCPF, ' +
      '  FNR.NOME AS INT_NOMERES, CCU.DESCRICAO AS INT_NOMECCU, fpg.doc_impresso as INT_DOC_IMPRESSO '+
      'FROM FIN_TB_M_RBX RBX '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = RBX.ID_CLIENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = RBX.ID_FORMA_PAG '+
      ' LEFT OUTER JOIN CAD_TB_C_FUN FNR on (FNR.ID_FUNCIONARIO = RBX.ID_RESPONSAVEL) ' +
      ' LEFT OUTER JOIN CAD_TB_C_CCU CCU ON (CCU.ID_CCUSTO = RBX.ID_CCUSTO) ' +
      ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA = RBX.ID_ABERTURA ';
  end;

begin

   FIN_SQ_M_RBX.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_RBX.CommandText := enSqlFinRbx + ' WHERE 1=2 '
        else
           FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
             ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  RBX.ID_BAIXA = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
          ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
             ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND  RBX.DTA_BAIXA = ''' +
             FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
          ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
          ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(RBX.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 5 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
         ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
         '    exists (select id_baixa from fin_tb_m_rbx_ger where id_baixa = rbx.id_baixa and che_cheque = ''' + VarToStr(Input[2]) +''' ) ';
      end
   else if Input[0] = 6 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
         ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
         '    exists (select rxt.id_baixa from fin_tb_m_rbx_tit rxt ' +
         '              left outer join fin_tb_m_rec rec on rec.id_titulo = rxt.id_titulo ' +
         '              left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal ' +
         '            where rxt.id_baixa = rbx.id_baixa   ' +
         '              and nfe.id_ors = ''' + VarToStr(Input[2]) +''' ) ';
      end

   else if Input[0] = 90 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
              ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
              '   AND RBX.ID_ABERTURA  = ''' + VarToStr(Input[2]) + ''' ' +
              '   AND RBX.ID_RESPONSAVEL = ''' + VarToStr(Input[3]) + ''' ';
      end
   else if Input[0] = 91 then
      begin
        FIN_SQ_M_RBX.CommandText := enSqlFinRbx +
         ' WHERE RBX.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
         '    exists (select id_baixa from fin_tb_m_rbx_ger ' +
         '            where id_baixa = rbx.id_baixa and che_cheque = ''' + VarToStr(Input[2]) +''' ) ' +
         '   and RBX.ID_CLIENTE = ''' + VarToStr(Input[3]) + ''' ';
      end;


   Result := FIN_DP_M_RBX.Data;

   FIN_SQ_M_RBX.Close;
end;

procedure TSM.FIN_DP_M_RBXGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
 { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_RBXUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
  FIN_RN_M_RBX.FIN_DP_M_RBXUpdateData(sender,DataSet,
                                      FIN_DP_M_REC_PAG,FIN_DP_M_REC,FIN_DP_M_CTA,CAD_DP_C_FPG,
                                      CAD_DP_C_CTC,CAD_DP_C_TIF,FIN_DP_M_RCR,FIN_DP_M_RBX_TIT_INT,FIN_DP_M_CXA,BUS_DP_C_PAR_CTR,CAD_DP_C_CLI,
                                      BUS_DP_M_RBX_TIT,self);

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);
end;

function TSM.FIN_DP_M_RBX_TIT_INTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRbxTit: String;
  begin
    Result :=
        ' SELECT TIT.* FROM FIN_TB_M_RBX_TIT TIT';
  end;
begin
   FIN_SQ_M_RBX_TIT_INT.Close;
   if Input[0] = 0 then
      begin
           FIN_SQ_M_RBX_TIT_INT.CommandText := enSqlRbxTit +
             ' WHERE tit.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := FIN_DP_M_RBX_TIT_INT.Data;
end;

function TSM.FIN_DP_M_RCRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRcr: String;
  begin
    Result :=
      ' SELECT RCR.*, '+
      ' CLI.NOME AS INT_NOMECLI,CLI.DOC_CNPJ_CPF AS INT_DOCCNPJCPF, '+
      ' FPG.DESCRICAO AS INT_NOMEFPG, FPG.DOC_IMPRESSO AS INT_DOCIMPRESSO, '+
      ' CTC.CEDENTE_NOM AS INT_NOMECTC '+
      ' FROM FIN_TB_M_RCR RCR '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = RCR.ID_CLIENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = RCR.ID_FORMA_PAG '+
      ' LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA=RCR.ID_CONTA ';
  end;
begin
   FIN_SQ_M_RCR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_RCR.CommandText := enSqlRcr + ' WHERE 1=2 '
        else
           FIN_SQ_M_RCR.CommandText := enSqlRcr +
             ' WHERE RCR.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND RCR.ID_CREDITO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
          ' WHERE RCR.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
             ' WHERE RCR.ID_EMPRESA = ''' + VarToStr(Input[1]) +
             ''' AND RCR.DTA_CREDITO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
          ' WHERE RCR.ID_EMPRESA = ''' + VarToStr(Input[1])  + ''' AND ' +
          Format(' upper(RCR.HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
             ' WHERE RCR.ID_BAIXA  = ''' + VarToStr(Input[1]) +''' ' +
             '   AND RCR.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 90 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
             ' WHERE RCR.ID_FISCAL  = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 91 then
      begin
        FIN_SQ_M_RCR.CommandText := enSqlRcr +
             ' WHERE RCR.ID_BAIXA   = ''' + VarToStr(Input[1]) +''' ' +
             '   AND RCR.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 92 then
     begin
         FIN_SQ_M_RCR.CommandText := enSqlRcr +
               ' WHERE RCR.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' '+
               ' AND RCR.ID_BAIXA = ''' + VarToStr(Input[2]) + ''' '+
               ' AND RCR.ID_TITULO in (' + VarToStr(Input[3])  + ') ';
     end
   else if Input[0] = 93 then
     begin
         FIN_SQ_M_RCR.CommandText := enSqlRcr +
               ' WHERE RCR.ID_CTA = ''' + VarToStr(Input[1]) +''' ';
     end;
   Result := FIN_DP_M_RCR.Data;

   FIN_SQ_M_RCR.Close;
end;

procedure TSM.FIN_DP_M_RCRUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
VAR
 vlrAcum,vlrLancamento:currency;
 xTitulos,xHistorico,xDoc_impresso,xTitulosRec:string;
 num_parcelas:integer;
 xDataCorrente:TDateTime;
 cancelado:Boolean;
 num_max_parcelas:Integer;
 cds:TDataSet;
 FIN_CD_M_REC,FIN_CD_M_CTA,FIN_CD_M_REC_PAG,BUS_CD_C_PAR_CTR,BUS_CD_C_FPG:TClientdataset;
 BUS_SQ_M_RCR: TSQLDataSet;
 BUS_CD_M_RCR: TClientDataSet;
 BUS_DP_M_RCR: TDataSetProvider;

 Begin
 { TODO -oLuan : Criado em 17/03/2016 }
 if (DataSet.FieldByName('ORIGEM').AsInteger = 0) then
   begin
     FIN_CD_M_REC:=TClientDataSet.Create(nil);
     FIN_CD_M_REC_PAG:= TClientDataSet.Create(nil);
     FIN_CD_M_CTA:= TClientDataSet.Create(nil);
     BUS_CD_C_PAR_CTR:= TClientDataSet.Create(nil);
     BUS_CD_C_FPG:= TClientDataSet.Create(nil);
     xTitulos := '';
     num_max_parcelas := 0;
     try
        if (dataset.UpdateStatus in [usInserted]) then
           begin
             xDoc_impresso := '';
             BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
             BUS_CD_C_PAR_CTR.Close;
             BUS_CD_C_PAR_CTR.Data :=
                 BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataSet.FieldByName('ID_EMPRESA').AsString]));

             if ((not BUS_CD_C_PAR_CTR.FieldByName('RCR_CRI_FORMA_PAG').IsNull) and
                 (BUS_CD_C_PAR_CTR.FieldByName('RCR_CRI_FORMA_PAG').AsBoolean = True)) then
               begin
                 if (DataSet.FieldByName('DEB_CRE').AsInteger = 1) then
                    begin
                       FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
                       FIN_CD_M_CTA.Close;
                       FIN_CD_M_CTA.Data :=
                       FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));

                       FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
                       FIN_CD_M_REC.Close;
                       FIN_CD_M_REC.Data :=
                       FIN_CD_M_REC.DataRequest(VarArrayOf([0,'']));

                       BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                       BUS_CD_C_FPG.Close;
                       BUS_CD_C_FPG.Data :=
                       BUS_CD_C_FPG.DataRequest(VarArrayOf([0,dataSet.FieldByName('ID_FORMA_PAG').AsString]));
                       xDoc_impresso := BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsString;
                       xHistorico := 'Ref. Controle de Crdito: '+dataset.FieldByName('id_credito').AsString+', do Cliente: '+
                            dataset.FieldByName('int_nomecli').AsString;


                       if ((BUS_CD_C_FPG.FieldByName('ativa_red_parc_car_rec').AsBoolean = true) and
                           (BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger > 0))  then
                         begin
                           if (DataSet.FieldByName('CAR_PARCELAS').AsInteger >
                               BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger) then
                             begin
                               num_max_parcelas := BUS_CD_C_FPG.FieldByName('qtde_red_parc_car_rec').AsInteger;
                             end
                           else
                             begin
                               num_max_parcelas := DataSet.FieldByName('CAR_PARCELAS').AsInteger;
                             end;
                         end
                       else
                         begin
                           num_max_parcelas := DataSet.FieldByName('CAR_PARCELAS').AsInteger;
                         end;



                    end;

                 if xDoc_impresso = '3' then //Cartao
                    begin
                       if (DataSet.FieldByName('DEB_CRE').AsInteger = 1) then
                            begin

                               num_parcelas := 1;
                               vlrAcum := 0;
                               xDataCorrente := DataSet.FieldByName('DTA_VENCIMENTO').AsDateTime;

                               while (num_parcelas <= num_max_parcelas) do
                                 begin
                                   FIN_CD_M_REC.Insert;
                                   // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                   FIN_CD_M_REC.FieldByName('id_titulo').AsInteger  :=
                                      self.enValorChave('FAT_TB_M_NFE_TIT');
                                   FIN_CD_M_REC.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                                   FIN_CD_M_REC.FieldByName('NUM_PARCELA').AsString := dataset.FieldByName('id_credito').AsString+'-'+
                                                                                       IntToStr(num_parcelas)+'/'+IntToSTr(num_max_parcelas);
                                   FIN_CD_M_REC.FieldByName('id_cliente').AsInteger   := dataSet.FieldBYName('ID_CLIENTE').AsInteger;
                                   FIN_CD_M_REC.FieldByName('DTA_EMISSAO').AsDateTime    := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                   FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := xDataCorrente;
                                   FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := xDataCorrente;//DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                   FIN_CD_M_REC.FieldByName('origem').AsInteger          := 4;//Controle de Credito do Cliente
                                   FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := DataSet.FieldBYName('ID_FORMA_PAG').AsInteger;

                                   FIN_CD_M_REC.FieldByName('historico').AsString        := xHistorico;
                                   FIN_CD_M_REC.FieldByName('id_plano').AsString         := BUS_CD_C_PAR_CTR.FieldBYName('RCR_ID_PLANO').AsString;
                                   FIN_CD_M_REC.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_FPG.FieldBYName('ID_LOCAL_TITULO').AsInteger;
                                   FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                                   FIN_CD_M_REC.FieldByName('id_credito').AsInteger      := dataset.FieldByName('ID_CREDITO').AsInteger;

                                   if num_parcelas < num_max_parcelas then
                                     begin
                                      vlrLancamento := RoundTo(dataSet.FieldByName('VLR_CREDITO').AsCurrency / num_max_parcelas,-2);
                                      vlrAcum := vlrAcum + vlrLancamento;
                                     end
                                    else
                                     begin
                                      vlrLancamento := dataSet.FieldByName('VLR_CREDITO').AsCurrency - vlrAcum;
                                     end;

                                   FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := vlrLancamento;
                                   FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := vlrLancamento;
                                   FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := vlrLancamento;

                                   FIN_CD_M_REC.Post;

                                   num_parcelas := num_parcelas + 1;

                                   xDataCorrente := xDataCorrente + 30;
                                 end;
                                if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                                  begin
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                  end;
                            end
                            else
                              begin
                                 raise Exception.Create('Movimento deve ser tipo crdito.');
                              end;
                     end;


                     if xDoc_impresso = '5' then //Dinheiro
                        begin
                          if DataSet.FieldByName('DEB_CRE').AsInteger = 1 then //Crdito
                             begin
                                 FIN_CD_M_REC.Insert;
                                 // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                 FIN_CD_M_REC.FieldByName('id_titulo').AsInteger  :=
                                    self.enValorChave('FAT_TB_M_NFE_TIT');
                                 FIN_CD_M_REC.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                                 FIN_CD_M_REC.FieldByName('id_cliente').AsInteger   := DataSet.FieldBYName('ID_CLIENTE').AsInteger;
                                 FIN_CD_M_REC.FieldByName('num_parcela').AsString      := DataSet.FieldByName('ID_CREDITO').AsString;
                                 FIN_CD_M_REC.FieldByName('DTA_EMISSAO').AsDateTime    := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                 FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := DataSet.FieldByName('DTA_VENCIMENTO').AsDateTime;
                                 FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                 FIN_CD_M_REC.FieldByName('origem').AsInteger          := 4;//Controle de Credito do Cliente
                                 FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := //BUS_CD_C_PAR_CTR.FieldBYName('PDE_ID_FORMA_PAG').AsInteger;
                                                                                          DataSet.FieldBYName('ID_FORMA_PAG').AsInteger;
                                 FIN_CD_M_REC.FieldByName('historico').AsString        := xHistorico;
                                 FIN_CD_M_REC.FieldByName('id_plano').AsString         := BUS_CD_C_PAR_CTR.FieldBYName('RCR_ID_PLANO').AsString;
                                 FIN_CD_M_REC.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_FPG.FieldBYName('ID_LOCAL_TITULO').AsInteger;
                                 FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                                 FIN_CD_M_REC.FieldByName('id_credito').AsInteger      := dataset.FieldByName('ID_CREDITO').AsInteger;

                                 FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := dataSet.FieldByName('VLR_CREDITO').AsCurrency;
                                 FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := dataSet.FieldByName('VLR_CREDITO').AsCurrency;
                                 FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := 0;

                                 FIN_CD_M_REC.Post;

                                 FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
                                 FIN_CD_M_REC_PAG.Close;
                                 FIN_CD_M_REC_PAG.Data :=
                                 FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([2,'']));
                                 FIN_CD_M_REC_PAG.Insert;
                                 // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                 FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger   :=
                                    self.enValorChave('FIN_TB_M_RBX');
                                 FIN_CD_M_REC_PAG.FieldByName('id_titulo').AsInteger  := FIN_CD_M_REC.FieldByName('id_titulo').AsInteger;
                                 FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                 FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    := dataSet.FieldByName('VLR_CREDITO').AsCurrency;

                                 FIN_CD_M_REC_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
                                 FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
                                 FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
                                 FIN_CD_M_REC_PAG.FieldByName('historico').AsString          := xHistorico;
                                 FIN_CD_M_REC_PAG.FieldByName('COM_SUBSTITUICAO').AsBoolean  := false;
                                 FIN_CD_M_REC_PAG.FieldByName('ID_FORMA_PAG').AsInteger      := DataSet.FieldBYName('ID_FORMA_PAG').AsInteger;
                                 FIN_CD_M_REC_PAG.FieldByName('ID_PLANO').AsString           := BUS_CD_C_PAR_CTR.FieldBYName('RCR_ID_PLANO').AsString;
                                 FIN_CD_M_REC_PAG.FieldByName('ID_ABERTURA').AsInteger       := DataSet.FieldByName('ID_ABERTURA').AsInteger;

                                 FIN_CD_M_REC_PAG.Post;

                                 enGerFinCxaBco(sender,5,dataset,cds,FIN_CD_M_CTA,0);
                                 if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');

                                 if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');

                                 if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de movimentao de contas.');
                             end;

                        end;

                       if xDoc_impresso = '6' then //Cheque
                         begin
                            if (DataSet.FieldByName('DEB_CRE').AsInteger = 1) then
                              begin
                                FIN_CD_M_REC.Insert;
                                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                                FIN_CD_M_REC.FieldByName('id_titulo').AsInteger  :=
                                     self.enValorChave('FAT_TB_M_NFE_TIT');
                                FIN_CD_M_REC.FieldByName('id_empresa').AsInteger := dataset.FieldByName('ID_EMPRESA').AsInteger;
                                FIN_CD_M_REC.FieldByName('id_cliente').AsInteger   := DataSet.FieldBYName('ID_CLIENTE').AsInteger;
                                FIN_CD_M_REC.FieldByName('num_parcela').AsString      := DataSet.FieldByName('ID_CREDITO').AsString;
                                FIN_CD_M_REC.FieldByName('DTA_EMISSAO').AsDateTime    := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := DataSet.FieldByName('DTA_VENCIMENTO').AsDateTime;
                                FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := DataSet.FieldByName('DTA_CREDITO').AsDateTime;
                                FIN_CD_M_REC.FieldByName('origem').AsInteger          := 4;//Controle de Credito do Cliente
                                FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := DataSet.FieldBYName('ID_FORMA_PAG').AsInteger;
                                FIN_CD_M_REC.FieldByName('situacao_chq').AsInteger    := 1;
                                FIN_CD_M_REC.FieldByName('historico').AsString        := xHistorico;
                                FIN_CD_M_REC.FieldByName('id_plano').AsString         := BUS_CD_C_PAR_CTR.FieldBYName('RCR_ID_PLANO').AsString;
                                FIN_CD_M_REC.FieldByName('id_local_titulo').AsInteger := BUS_CD_C_FPG.FieldBYName('ID_LOCAL_TITULO').AsInteger;
                                FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                                FIN_CD_M_REC.FieldByName('id_credito').AsInteger      := dataset.FieldByName('ID_CREDITO').AsInteger;

                                FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := dataSet.FieldByName('VLR_CREDITO').AsCurrency;
                                FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := dataSet.FieldByName('VLR_CREDITO').AsCurrency;
                                FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := dataSet.FieldByName('VLR_CREDITO').AsCurrency;


                                FIN_CD_M_REC.FieldByName('che_conta').AsInteger := dataset.FieldByName('pre_conta').AsInteger;
                                FIN_CD_M_REC.FieldByName('che_cheque').AsInteger      := dataset.FieldByName('pre_cheque').AsInteger;
                                FIN_CD_M_REC.FieldByName('che_banco').AsString   := dataSet.FieldByName('pre_banco').AsString;
                                FIN_CD_M_REC.FieldByName('che_emitente').AsString    := dataSet.FieldByName('pre_emitente').AsString;
                                FIN_CD_M_REC.FieldByName('che_agencia').AsString      := dataSet.FieldByName('pre_agencia').AsString;



                                FIN_CD_M_REC.Post;

                                if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                                  begin
                                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');
                                  end;
                              end
                             else
                              begin
                                 raise Exception.Create('Movimento deve ser tipo crdito.');
                              end;
                         end;
               end;
           end;

         if (dataset.UpdateStatus in [usUnmodified]) then
           begin
             cancelado := dataset.FieldByName('CANCELADO').AsBoolean;
             dataset.Next;

             if dataset.FieldByName('CANCELADO').AsString <> '' then
                cancelado := dataset.FieldByName('CANCELADO').AsBoolean;


             if (cancelado = true) then
               begin
                 dataset.Prior;



                 BUS_SQ_M_RCR := TSQLDataSet.Create(nil);
                 BUS_SQ_M_RCR.SQLConnection := conexao;
                 BUS_SQ_M_RCR.CommandType   := ctQuery;
                 BUS_SQ_M_RCR.CommandText   :=
                      ' SELECT RCR.*, '+
                      ' CLI.NOME AS INT_NOMECLI,CLI.DOC_CNPJ_CPF AS INT_DOCCNPJCPF, '+
                      ' FPG.DESCRICAO AS INT_NOMEFPG, FPG.DOC_IMPRESSO AS INT_DOCIMPRESSO, '+
                      ' CTC.CEDENTE_NOM AS INT_NOMECTC '+
                      ' FROM FIN_TB_M_RCR RCR '+
                      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = RCR.ID_CLIENTE '+
                      ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = RCR.ID_FORMA_PAG '+
                      ' LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA=RCR.ID_CONTA '+
                      ' WHERE RCR.ID_CREDITO = '''+dataset.FieldByName('ID_CREDITO').AsString+'''  ';

                 BUS_DP_M_RCR := TDataSetProvider.Create(nil);
                 BUS_DP_M_RCR.DataSet := BUS_SQ_M_RCR;

                 BUS_CD_M_RCR := TClientDataSet.Create(nil);
                 BUS_CD_M_RCR.SetProvider(BUS_DP_M_RCR);
                 BUS_CD_M_RCR.Open;






                 FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
                 FIN_CD_M_CTA.Close;
                 FIN_CD_M_CTA.Data :=
                 FIN_CD_M_CTA.DataRequest(VarArrayOf([109,dataset.FieldByName('ID_CREDITO').AsInteger]));

                 FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
                 FIN_CD_M_REC.Close;
                 FIN_CD_M_REC.Data :=
                 FIN_CD_M_REC.DataRequest(VarArrayOf([99,dataset.FieldByName('ID_CREDITO').AsInteger]));



                 xTitulosRec := '';
                  while not FIN_CD_M_REC.eof do
                    begin
                       if xTitulosRec <> '' then
                          begin
                           xTitulosRec :=
                           xTitulosRec + ',' +''''+ FIN_CD_M_REC.FieldByName('ID_TITULO').AsString+'''';
                          end
                        else
                          begin
                           xTitulosRec :=
                           xTitulosRec +''''+ FIN_CD_M_REC.FieldByName('ID_TITULO').AsString+'''';
                          end;

                      FIN_CD_M_REC.Next;
                    end;


                 FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
                 FIN_CD_M_REC_PAG.Close;
                 FIN_CD_M_REC_PAG.Data :=
                 FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([90,xTitulosRec]));


                 while FIN_CD_M_REC_PAG.RecordCount >0 do
                     FIN_CD_M_REC_PAG.Delete;

                 while FIN_CD_M_REC.RecordCount >0 do
                     FIN_CD_M_REC.Delete;

                 while FIN_CD_M_CTA.RecordCount >0 do
                     FIN_CD_M_CTA.Delete;



                  BUS_CD_M_RCR.Insert;
                  // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                  BUS_CD_M_RCR.fieldByName('id_credito').AsInteger:=
                                        self.enValorChave('FIN_TB_M_RCR');

                  BUS_CD_M_RCR.FieldByName('ID_EMPRESA').AsInteger :=
                       dataset.FieldByName('ID_EMPRESA').AsInteger;
                  BUS_CD_M_RCR.FieldByName('dta_credito').AsDateTime := enDataServer;
                        dataset.FieldByName('ID_EMPRESA').AsInteger;
                  BUS_CD_M_RCR.FieldByName('DTA_VENCIMENTO').AsDateTime := enDataServer;

                  BUS_CD_M_RCR.FieldByName('HISTORICO').AsString :=
                            'Ref. cancelamento de crdito de n '+dataset.FieldByName('ID_CREDITO').AsString;

                  BUS_CD_M_RCR.FieldByName('ORIGEM').AsInteger          := 0;
                  BUS_CD_M_RCR.FieldByName('NUM_DOCUMENTO').AsInteger   := 0;
                  BUS_CD_M_RCR.FieldByName('VLR_SALDO').AsInteger       := 0;

                  BUS_CD_M_RCR.FieldByName('id_abertura').AsInteger := 0;

                  BUS_CD_M_RCR.FieldByName('PRE_BANCO').AsString        := '0';
                  BUS_CD_M_RCR.FieldByName('PRE_AGENCIA').AsString      := '0';
                  BUS_CD_M_RCR.FieldByName('PRE_CONTA').AsString        := '0';
                  BUS_CD_M_RCR.FieldByName('PRE_CHEQUE').AsString       := '0';
                  BUS_CD_M_RCR.FieldByName('CANCELADO').AsBoolean      := false;


                  BUS_CD_M_RCR.FieldByName('ID_CLIENTE').AsInteger := dataset.FieldByName('ID_CLIENTE').AsInteger;
                  BUS_CD_M_RCR.FieldByName('DEB_CRE').AsInteger := 0;

                  BUS_CD_M_RCR.FieldByName('VLR_CREDITO').AsCurrency := dataset.FieldByName('VLR_CREDITO').AsCurrency;

                  BUS_CD_M_RCR.Post;




                  if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');

                  if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                    raise Exception.Create('Erro ao tentar atualizar a tabela de ttulos.');

                  if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                    raise Exception.Create('Erro ao tentar atualizar a tabela de movimentao de contas.');


                  if not (BUS_CD_M_RCR.ApplyUpdates(0) = 0) then
                    raise Exception.Create('Erro ao tentar atualizar a tabela de crdito do cliente.');


               end;

           end;


     finally
       BUS_CD_M_RCR.Free;
       FIN_CD_M_REC.Free;
       FIN_CD_M_REC_PAG.Free;
       FIN_CD_M_CTA.Free;
       BUS_CD_C_PAR_CTR.Free;
       BUS_CD_C_FPG.Free;
     end;
   end;

end;

function TSM.FIN_DP_M_RECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRec: String;
  begin
    Result :=
      'SELECT REC.*, '+
      ' false as int_selecao, '+
      '  false as INT_TIT_VLR_ALT, '+
      '  CLI.NOME   AS INT_NOMECLI,     CLI.DOC_CNPJ_CPF AS INT_CNPJCPF,    '+
      '  CLI.COB_BAIRRO AS INT_BAIRROCOB,   CLI.COB_ENDERECO AS INT_ENDCOB, '+
      '  CLI.COB_ESTADO AS INT_ESTADOCOB,   CLI.COB_CEP AS INT_CEPCOB,      '+
      '  CLI.COB_CIDADE AS INT_CIDCOB , CLI.EMAIL AS INT_EMAILCLI,  ' +
      '  FPG.DESCRICAO AS INT_NOMEFPG, '+
      '  FPG.DOC_IMPRESSO AS INT_DOCIMPRESSO, ' +
      '  LTO.DESCRICAO AS INT_NOMELTO, '+
      '  PCT.DESCRICAO AS INT_NOMEPCT,  '+
      '  NFE.NUMERO AS INT_NUMERONF, ' +
      '  OBR.DESCRICAO AS INT_DESCOBRA '+
      'FROM FIN_TB_M_REC REC '+
      'LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = REC.ID_CLIENTE '+
      'LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
      'LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
      'LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO ' +
      'LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL = REC.ID_FISCAL '+
      'LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA = REC.ID_OBRA ';
  end;
begin
  FIN_SQ_M_REC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           FIN_SQ_M_REC.CommandText := enSqlRec + ' WHERE 1=2 '
        else
           FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' AND REC.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' AND ' +
          Format(' upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND REC.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND REC.DTA_ORIGINAL = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 4 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND REC.DTA_VENCIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   AND REC.ID_PLANO = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(FPG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 7 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(LTO.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 8 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
             '   and REC.CHE_CHEQUE = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 9 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(REC.CHE_EMITENTE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 10 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(REC.HISTORICO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 11 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and (REC.DTA_VENCIMENTO<CURRENT_DATE) AND upper(CLI.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 12 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
             ' WHERE REC.ID_CLIENTE = ''' + VarToStr(Input[1]) +''' ' +
             '   AND REC.CHE_CHEQUE = ''' + VarToStr(Input[2]) +''' ' +
             '   AND REC.CHE_CONTA = ''' + VarToStr(Input[3]) +''' ' +
             '   AND REC.CHE_BANCO = ''' + VarToStr(Input[4]) +''' ' +
             '   AND REC.CHE_AGENCIA = ''' + VarToStr(Input[5]) +''' ';
      end
   else if Input[0] = 13 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          '   AND REC.VLR_PARCELA = ''' + VarToStr(Input[2]) + ''' ';
      end
   else if Input[0] = 14 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(REC.BOL_NOSSO_NUMERO) LIKE ''%s%%'' ', [uppercase(IntToStr(StrToInt(VarToStr(Input[2]))))]);
      end
   else if Input[0] = 15 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          Format(' and upper(REC.NUM_PARCELA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 16 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
          ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) + ''' ' +
          ' and NFE.NUMERO = '''+ VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 90 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_EMPRESA IN (' + VarToStr(Input[1]) +') ';

        if VarToStr(Input[2])<>'' then
           FIN_SQ_M_REC.CommandText :=  FIN_SQ_M_REC.CommandText +
            '   AND REC.ID_CLIENTE = ''' + VarToStr(Input[2]) +''' ';
        if VarToStr(Input[5])='1' then
          begin
            FIN_SQ_M_REC.CommandText :=  FIN_SQ_M_REC.CommandText +
                '   AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ' +
                '   AND REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ' +
                '   AND FPG.DOC_IMPRESSO = 4 ';
          end;
        if VarToStr(Input[5])='0' then
          begin
            FIN_SQ_M_REC.CommandText :=  FIN_SQ_M_REC.CommandText +
                '   AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ' +
                '   AND REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[4])) ) +''' ' +
                '   AND FPG.DOC_IMPRESSO = 4 ';
          end;
      end
   else if Input[0] = 91 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_TITULO IN (' + VarToStr(Input[1]) +') ';
      end
   else if Input[0] = 92 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO = 4 ';
      end
   else if Input[0] = 93 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ' +
            '   AND FPG.DOC_IMPRESSO = 1 ';
      end
   else if Input[0] = 94 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_FISCAL = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 95 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 96 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_MCH = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 97 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_CLIENTE IN (' + VarToStr(Input[1]) +') ';
      end
   else if Input[0] = 98 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE FPG.DOC_IMPRESSO IN (3,4,6) '+
            '   and REC.ID_EMPRESA IN (' + VarToStr(Input[1]) +') ' +
            '   and REC.VLR_SALDO = REC.VLR_PARCELA   '+
            '   AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
            '   AND REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';

      end
   else if Input[0] = 99 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_CREDITO = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 100 then
      begin
        FIN_SQ_M_REC.CommandText := enSqlRec +
            ' WHERE REC.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ' +
            '   and REC.ID_FISCAL IN (' + VarToStr(Input[2]) +') ';
      end;

   FIN_SQ_M_REC.CommandText := FIN_SQ_M_REC.CommandText +
       ' ORDER BY REC.DTA_VENCIMENTO ';

   Result := FIN_DP_M_REC.Data;


   FIN_SQ_M_REC.close;
end;

procedure TSM.FIN_DP_M_RECGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.FIN_DP_M_RECUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_C_PAR_CTR,BUS_CD_C_FPG:TClientDataSet;
  vlrTituloAnt,vlrTituloNovo:currency;
begin
   BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
   BUS_CD_C_PAR_CTR.Close;
   BUS_CD_C_PAR_CTR.Data :=
      BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([Dataset.FieldByName('ID_EMPRESA').AsString]));

   BUS_CD_C_FPG := TClientDataSet.Create(nil);
   BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
   BUS_CD_C_FPG.Close;
   BUS_CD_C_FPG.Data :=
      BUS_CD_C_FPG.DataRequest(VarArrayOf([0,Dataset.FieldByName('ID_FORMA_PAG').AsString]));



   if (Dataset.FieldByName('ORIGEM').AsInteger = 0) AND  //Manual-(FIN_FM_M_REC)
       (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and         // A prazo
       (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4])  then //Dup,Nota Promissoria,Boleto,adicionei essa condio para deixar o mesmo modo
                                                                                //que acontece para titulos gerados partir da nota fiscal no metodo "enVerSldLimAtu"
    begin

     vlrTituloAnt := Dataset.FieldByName('VLR_PARCELA').AsCurrency;
     vlrTituloNovo := Dataset.FieldByName('VLR_PARCELA').AsCurrency;


     if Dataset.UpdateStatus in [usUnmodified] then
       begin
         Dataset.Next;
         if Dataset.UpdateStatus in [usmodified] then
           begin
             if Dataset.FieldByName('VLR_PARCELA').Text <> '' then
               vlrTituloNovo := Dataset.FieldByName('VLR_PARCELA').AsCurrency;
           end;
         Dataset.Prior;
       end;

      CAD_CD_C_CLI := TClientDataSet.Create(nil);
      CAD_CD_C_CLI_CRD := TClientDataSet.Create(nil);
      CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
      CAD_CD_C_CLI.Close;
      CAD_CD_C_CLI.Data :=
      CAD_CD_C_CLI.DataRequest(VarArrayOf([0, Dataset.FieldByName('ID_CLIENTE').AsString]));

      CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

      CAD_CD_C_CLI.Edit;

      if Dataset.UpdateStatus in [usDeleted]  then
        begin
          CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt;
        end
      else if Dataset.UpdateStatus in [usInserted] then
         begin
           CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency - vlrTituloAnt;
         end
      else
         begin
           CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt - vlrTituloNovo;
         end;

      if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
        begin
          if Dataset.UpdateStatus in [usDeleted]  then
            begin
              if CAD_CD_C_CLI_CRD.Locate('ID_FORMA_PAG',Dataset.FieldByName('ID_FORMA_PAG').AsString,[]) then
                begin
                  CAD_CD_C_CLI_CRD.Edit;
                   CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt;
                end
              else
                begin
                  CAD_CD_C_CLI_CRD.Insert;
                  CAD_CD_C_CLI_CRD.FieldByName('id_forma_pag').AsInteger :=
                                                       Dataset.FieldByName('ID_FORMA_PAG').AsInteger;

                  CAD_CD_C_CLI_CRD.FieldByName('lim_valor').AsCurrency := 0;
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                                                     enBusNovoSldlimCli(Dataset.FieldByname('ID_EMPRESA').AsString,
                                                                         Dataset.FieldByName('ID_CLIENTE').AsString,
                                                                             Dataset.FieldByName('id_forma_pag').AsString,0);
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                          CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt;

                end;
            end
         else if Dataset.UpdateStatus in [usInserted]  then
            begin
               if CAD_CD_C_CLI_CRD.Locate('ID_FORMA_PAG',Dataset.FieldByName('ID_FORMA_PAG').AsString,[]) then
                begin
                  CAD_CD_C_CLI_CRD.Edit;
                   CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency - vlrTituloAnt;
                end
              else
                begin
                  CAD_CD_C_CLI_CRD.Insert;
                  CAD_CD_C_CLI_CRD.FieldByName('id_forma_pag').AsInteger :=
                                                       Dataset.FieldByName('ID_FORMA_PAG').AsInteger;

                  CAD_CD_C_CLI_CRD.FieldByName('lim_valor').AsCurrency := 0;
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                                                     enBusNovoSldlimCli(Dataset.FieldByname('ID_EMPRESA').AsString,
                                                                         Dataset.FieldByName('ID_CLIENTE').AsString,
                                                                             Dataset.FieldByName('id_forma_pag').AsString,0);
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                          CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency - vlrTituloAnt;

                end;
            end
          else
            begin
               if CAD_CD_C_CLI_CRD.Locate('ID_FORMA_PAG',Dataset.FieldByName('ID_FORMA_PAG').AsString,[]) then
                begin
                  CAD_CD_C_CLI_CRD.Edit;
                   CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                      CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt - vlrTituloNovo;
                end
              else
                begin
                  CAD_CD_C_CLI_CRD.Insert;
                  CAD_CD_C_CLI_CRD.FieldByName('id_forma_pag').AsInteger :=
                                                       Dataset.FieldByName('ID_FORMA_PAG').AsInteger;

                  CAD_CD_C_CLI_CRD.FieldByName('lim_valor').AsCurrency := 0;
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                                                     enBusNovoSldlimCli(Dataset.FieldByname('ID_EMPRESA').AsString,
                                                                         Dataset.FieldByName('ID_CLIENTE').AsString,
                                                                             Dataset.FieldByName('id_forma_pag').AsString,0);
                  CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency :=
                          CAD_CD_C_CLI_CRD.FieldByName('lim_saldo').AsCurrency + vlrTituloAnt - vlrTituloNovo;

                end;
            end;

          CAD_CD_C_CLI_CRD.Post;
        end;


      CAD_CD_C_CLI.Post;

      if not (CAD_CD_C_CLI.ApplyUpdates(0) = 0) then
          raise Exception.Create('Erro ao tentar atualizar a tabela de cliente.');
   end;

  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);


end;

function TSM.FIN_DP_M_REC_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRecPag: String;
  begin
    Result :=
        ' select * from fin_tb_m_rec_pag pag';
  end;
begin

   FIN_SQ_M_REC_PAG.Close;

   if Input[0] = 0 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_BAIXA = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 1 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_BAIXA = ''' + VarToStr(Input[1]) +''' AND ' +
             '  pag.ID_TITULO = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[0] = 3 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_FISCAL = ''' + VarToStr(Input[1]) +'''  ' ;
      end;

   if Input[0] = 4 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_MCH = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 5 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_CBX = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 6 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.id_dct_bxa = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 90 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE pag.ID_TITULO IN (' + VarToStr(Input[1]) +') ';
      end;

   if Input[0] = 91 then
      begin
           FIN_SQ_M_REC_PAG.CommandText := enSqlRecPag +
             ' WHERE PAG.ORIGEM=3 AND '+
             ' pag.ID_TITULO IN (' + VarToStr(Input[1]) +') ';
      end;

   Result := FIN_DP_M_REC_PAG.Data;
end;

function TSM.FIN_DP_R_ANVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinAnv: string;
begin
  { TODO -oMaxsuel Victor : Criado no dia 30/09/2016 }
  enSqlRelFinAnv :=
          ' select' + #13#10 +
          '   substr(cast(to_char(cli.dta_nascimento , ''DD-MM-YYYY'') as varchar), 1 ,2) ,' + #13#10 +
          '   case cast( substr(cast(to_char(cli.dta_nascimento , ''DD-MM-YYYY'') as varchar), 4 ,2) as  integer)' + #13#10 +
          '     when 1 then ''Janeiro''' + #13#10 +
          '     when 2 then ''Fevereiro''' + #13#10 +
          '     when 3 then ''Maro''' + #13#10 +
          '     when 4 then ''Abril''' + #13#10 +
          '     when 5 then ''Maio''' + #13#10 +
          '     when 6 then ''Junho''' + #13#10 +
          '     when 7 then ''Julho''' + #13#10 +
          '     when 8 then ''Agosto''' + #13#10 +
          '     when 9 then ''Setembro''' + #13#10 +
          '     when 10 then ''Outubro''' + #13#10 +
          '     when 11 then ''Novembro''' + #13#10 +
          '     when 12 then ''Dezembro''' + #13#10 +
          '   else ''??????'' end int_mes_aniver,' + #13#10 +
          '   case cast( substr(cast(to_char(cli.dta_nascimento , ''DD-MM-YYYY'') as varchar), 4 ,2) as  integer)' + #13#10 +
          '     when 1 then 1' + #13#10 +
          '     when 2 then 2' + #13#10 +
          '     when 3 then 3' + #13#10 +
          '     when 4 then 4' + #13#10 +
          '     when 5 then 5' + #13#10 +
          '     when 6 then 6' + #13#10 +
          '     when 7 then 7' + #13#10 +
          '     when 8 then 8' + #13#10 +
          '     when 9 then 9' + #13#10 +
          '     when 10 then 10' + #13#10 +
          '     when 11 then 11' + #13#10 +
          '     when 12 then 12' + #13#10 +
          '   end int_ordem_aniver,' + #13#10 +
          '   cli.id_cliente, cli.nome, cli.tel_fixo,cli.tel_movel as int_celular,' + #13#10 +
          '   cli.email, cli.dta_nascimento,cli.id_perfil_cli, pec.descricao as int_nomepec ' + #13#10 +
          ' from cad_tb_c_cli cli ' + #13#10 +
          '   left outer join cad_tb_c_pec pec on pec.id_perfil_cli = cli.id_perfil_cli ';



    FIN_SQ_R_ANV.Close;
    FIN_SQ_R_ANV.CommandText := '';
    FIN_SQ_R_ANV.CommandText := enSqlRelFinAnv;

    FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
          ' WHERE extract(month from cli.dta_nascimento) = '''+VarToStr(Input[0])+''' ';

    if Input[1]<>'' then
      begin
         FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                              ' AND cli.id_cliente in ('+VarToStr(Input[1])+') ';
      end;

    if Input[2]<>'' then
       begin
          FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                              ' AND cli.situacao in ('+VarToStr(Input[2])+') ';
       end;

    if Input[3]<>'' then
       begin
          FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                              ' AND cli.id_perfil_cli in ('+VarToStr(Input[3])+') ';
       end;

    case Input[4] of
        1:
          FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                              ' AND cli.ativo = true ';
        2:
          FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                              ' AND cli.ativo = false ';
    end;

   if input[5] = 0 then
      begin
        FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                                    ' order by 3,1,cli.nome ' ;
      end;
   if input[5] = 1 then
      begin
        FIN_SQ_R_ANV.CommandText := FIN_SQ_R_ANV.CommandText  +
                                    ' order by pec.descricao,3,1,cli.nome ' ;
      end;
   Result := FIN_DP_R_ANV.Data;

   FIN_SQ_R_ANV.Close;
end;

function TSM.FIN_DP_R_BCO_CCBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelBcoCcb:string;
begin
  { TODO -oLuan : Criado no dia 22/01/2016 }
  enSqlRelBcoCcb :=
    ' SELECT CTC.ID_CONTA, TIF.ID_TIPO_FINANCEIRO, CTC.DESCRICAO AS INT_DESCRICAOCONTA, '+
                        ' CAST (CASE TIF.NATUREZA '+
                        '    WHEN 0 THEN ''Sadas'' '+
                        '    WHEN 1 THEN ''Entradas'' '+
                        ' END AS VARCHAR(15) ) AS  INT_DESCNATUREZA,  TIF.DESCRICAO AS INT_DESCTIF, '+
                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                     '    FROM FIN_TB_M_CTA CTA '+
                     '       left outer join CAD_TB_C_TIF TIF2 on (TIF2.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                     '    WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                     '    AND CTA.ID_TIPO_FINANCEIRO = TIF.ID_TIPO_FINANCEIRO '+
                     '    AND CTA.DTA_LANCAMENTO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                     '    AND CTA.DTA_LANCAMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                     '    AND TIF2.NATUREZA = ''1''),0) AS VLR_CREDITO, '+

                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO)*(-1) '+
                     ' FROM FIN_TB_M_CTA CTA '+
                     '       left outer join CAD_TB_C_TIF TIF2 on (TIF2.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                        ' WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                        ' AND CTA.ID_TIPO_FINANCEIRO = TIF.ID_TIPO_FINANCEIRO '+
                        ' AND CTA.DTA_LANCAMENTO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                        ' AND CTA.DTA_LANCAMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                        ' AND TIF2.NATUREZA = ''0''),0) AS VLR_DEBITO, '+

                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                        ' FROM FIN_TB_M_CTA CTA '+
                        '   left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                        ' WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                        '   AND CTA.CONCILIADO = true '+
                        '   AND CTA.DTA_LANCAMENTO < '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                        '   AND TIF.NATUREZA = ''1''),0) - '+

                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                     '    FROM FIN_TB_M_CTA CTA '+
                     '      left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                     '    WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                     '   AND CTA.DTA_LANCAMENTO < '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                     '    AND TIF.NATUREZA = ''0''),0) AS SALDO_ANTERIOR, '+

                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                     '    FROM FIN_TB_M_CTA CTA '+
                     '      left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                     '    WHERE CTA.ID_CONTA = CTC.ID_CONTA  '+
                     '    AND CTA.DTA_LANCAMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                     '    AND TIF.NATUREZA = ''1''),0) - '+

                     ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                     '    FROM FIN_TB_M_CTA CTA  '+
                     '      left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                     '    WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                     '    AND CTA.DTA_LANCAMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                     '    AND TIF.NATUREZA = ''0''),0) AS SALDO_ATUAL '+

                     ' FROM FIN_TB_M_CTA CTA '+
                     ' LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA = CTA.ID_CONTA '+
                     ' LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO '+
                     ' LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA = CTA.ID_EMPRESA '+
                     ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO ';


    FIN_SQ_R_BCO_CCB.Close;
    FIN_SQ_R_BCO_CCB.CommandText := '';
    FIN_SQ_R_BCO_CCB.CommandText := enSqlRelBcoCcb;

    FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
          ' WHERE '+
          ' CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
          ' CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
          ' CTA.ID_CONTA = '''+VarToStr(Input[2])+''' ';

    if Input[3]<>'' then
      begin
         FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
                              ' AND CTA.ID_EMPRESA IN ('+VarToStr(Input[3])+') ';
      end;
    if Input[4]<>'' then
      begin
          FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
                              ' AND CTA.ID_PLANO IN ('+VarToStr(Input[4])+') ';
      end;
    if Input[5]<>'' then
      begin
          FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
                              ' AND CTA.ID_TIPO_FINANCEIRO IN ('+VarToStr(Input[5])+') ';
      end;
    if Input[6]<>'' then
      begin
          FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
                              ' AND CTA.ID_OBRA = '''+VarToStr(Input[6])+''' ';
      end;

     FIN_SQ_R_BCO_CCB.CommandText := FIN_SQ_R_BCO_CCB.CommandText  +
                    ' Group by CTC.ID_CONTA, TIF.ID_TIPO_FINANCEIRO, CTC.DESCRICAO, TIF.DESCRICAO  '+
                    ' ORDER BY CTC.ID_CONTA, TIF.ID_TIPO_FINANCEIRO ';

   Result := FIN_DP_R_BCO_CCB.Data;
   FIN_SQ_R_BCO_CCB.Close;
end;

function TSM.FIN_DP_R_BCO_EXBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelBco:string;
begin
  { TODO -oLuan : Criado no dia 22/01/2016 }
  enSqlRelBco :=
    ' SELECT CTA.ID_EMPRESA,PAR.EMP_RAZAO,CTA.DTA_LANCAMENTO,CTA.DTA_CONCILIACAO,CTA.DTA_MOVIMENTO,CTA.NUM_DOC,CTA.ID_PLANO, '+
    '   CTA.HISTORICO,CTA.DEB_CRE,CTA.ID_TIPO_FINANCEIRO,CTA.ID_CONTA, '+
    '   CTC.BANCO AS INT_BANCO,CTC.DESCRICAO AS INT_CONTADESCRICAO,CTC.AGENCIA AS INT_AGENCIA, '+
    '   CTC.CONTA_CORRENTE AS INT_CONTACORRENTE, '+
    '   NFE.NUMERO AS INT_NUMERO_NF, FRN.DESCRICAO AS INT_NOMEFOR, '+
    '   CAST (CASE TIF.NATUREZA ' +
    '      WHEN 0 THEN ''Sadas'' '   +
    '      WHEN 1 THEN ''Entradas'' ' +
    '   END AS VARCHAR(15) ) AS  INT_DESCNATUREZA,TIF.DESCRICAO AS INT_DESCTIF, ' +
    '   CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END VLR_CREDITO, '+
    '   CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END VLR_DEBITO '+
    '   FROM FIN_TB_M_CTA CTA '+
    '   LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO ' +
    '   LEFT OUTER JOIN CAD_TB_C_CTC CTC ON CTC.ID_CONTA = CTA.ID_CONTA ' +
    '   LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA= CTA.ID_EMPRESA '+
    '   LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO= CTA.ID_TITULO_PAG                              ' +
    '   LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL= PAG.ID_FISCAL                                  ' +
    '   LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR=NFE.ID_EMITENTE                             ' +
    '   WHERE 1=1 ';

    FIN_SQ_R_BCO_EXB.Close;
    FIN_SQ_R_BCO_EXB.CommandText := '';
    FIN_SQ_R_BCO_EXB.CommandText := enSqlRelBco;

    if (Input[0] = 1) then
        begin
         FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
          ' AND '+
          ' CTA.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
          ' CTA.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +'''  ';
        end
     else
        begin
           if (Input[0] = 2) then
              begin
               FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                ' AND '+
                ' CTA.DTA_CONCILIACAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
                ' CTA.DTA_CONCILIACAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +'''  ';
              end
           else
              begin
                FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                  ' AND '+
                  ' CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
                  ' CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +'''  ';
              end;
        end;


    if ((Input[0] = 1) or (Input[0]=2)) then
        begin
         FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
          ' AND '+
          ' CTA.CONCILIADO = TRUE ';
        end;
    if Input[0]=3 then
        begin
           FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
          ' AND '+
          ' (CTA.CONCILIADO = false OR CTA.CONCILIADO ISNULL) ';
        end;

    FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
          ' AND '+
          ' CTA.ID_CONTA = '''+VarToStr(Input[3])+''' ';

    if Input[4]<>'' then
      begin
         FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                              ' AND CTA.ID_EMPRESA IN ('+VarToStr(Input[4])+') ';
      end;
    if Input[5]<>'' then
      begin
          FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                              ' AND CTA.ID_PLANO IN ('+VarToStr(Input[5])+') ';
      end;
    if Input[6]<>'' then
      begin
          FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                              ' AND CTA.ID_TIPO_FINANCEIRO IN ('+VarToStr(Input[6])+') ';
      end;
    if Input[7]<>'' then
      begin
          FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                              ' AND CTA.ID_OBRA ='''+VarToStr(Input[7])+''' ';
      end;

    if ((Input[0]= 0) or (Input[0]= 1))  then
      begin
          FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                                                   ' ORDER BY CTA.ID_CONTA, CTA.DTA_LANCAMENTO ';
      end;

     if Input[0]= 2  then
      begin
           FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                                                   ' ORDER BY CTA.ID_CONTA, CTA.DTA_CONCILIACAO ';
      end;

     if Input[0]= 3  then
      begin
          FIN_SQ_R_BCO_EXB.CommandText := FIN_SQ_R_BCO_EXB.CommandText  +
                                                   ' ORDER BY CTA.ID_EMPRESA,CTA.ID_CONTA, CTA.DTA_LANCAMENTO ';
      end;

  Result := FIN_DP_R_BCO_EXB.Data;

   FIN_SQ_R_BCO_EXB.Close;

end;

function TSM.FIN_DP_R_BCO_SBCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelBcoSbc:string;
begin
   { TODO -oLuan : Criado no dia 22/01/2016 }
  enSqlRelBcoSbc :=
    ' SELECT CTC.*, '+
    '   COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
    '   FROM FIN_TB_M_CTA CTA '+
         ' left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                       ' WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                       ' AND CTA.CONCILIADO = true '+
                       ' AND CTA.DTA_MOVIMENTO <  '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                       ' AND TIF.NATUREZA = ''1''),0) - '+

                       ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                       ' FROM FIN_TB_M_CTA CTA  '+
         ' left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                       '  WHERE CTA.ID_CONTA = CTC.ID_CONTA  '+
                       '  AND CTA.CONCILIADO = true '+
                       '  AND CTA.DTA_MOVIMENTO <  '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                       ' AND TIF.NATUREZA = ''0''),0) AS SALDO_ANTERIOR, '+

                       ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                       '  FROM FIN_TB_M_CTA CTA '+
          ' left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                       ' WHERE CTA.ID_CONTA = CTC.ID_CONTA  '+
                       '   AND CTA.DTA_MOVIMENTO >= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                       '   AND CTA.DTA_MOVIMENTO <= '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                       '  AND CTA.CONCILIADO = true  '+
                       '  AND TIF.NATUREZA = ''1''),0) - '+

                       ' COALESCE( (SELECT SUM(CTA.VLR_LANCAMENTO) '+
                       '  FROM FIN_TB_M_CTA CTA  '+
          ' left outer join CAD_TB_C_TIF TIF on (TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO) '+
                       '  WHERE CTA.ID_CONTA = CTC.ID_CONTA '+
                       '  AND CTA.DTA_MOVIMENTO >=  '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) )+''' '+
                       '  AND CTA.DTA_MOVIMENTO <=  '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' '+
                       '  AND CTA.CONCILIADO = true  '+
                       '  AND TIF.NATUREZA = ''0''),0) AS SALDO '+
        ' FROM CAD_TB_C_CTC CTC '+
        ' WHERE CTC.TIPO = ''1'' ';

    FIN_SQ_R_BCO_SBC.Close;
    FIN_SQ_R_BCO_SBC.CommandText := '';
    FIN_SQ_R_BCO_SBC.CommandText := enSqlRelBcoSbc;

    Result := FIN_DP_R_BCO_SBC.Data;

   FIN_SQ_R_BCO_SBC.Close;
end;

function TSM.FIN_DP_R_BCO_SLDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelBco:string;
begin

  enSqlRelBco :=
    ' SELECT COALESCE(SUM( '+
    '        CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO '+
    '        WHEN CTA.DEB_CRE=0 THEN -1*CTA.VLR_LANCAMENTO END) '+
    '         ,0)  AS SALDO_ANTERIOR  FROM FIN_TB_M_CTA CTA ';

    FIN_SQ_R_BCO_SLD.Close;
    FIN_SQ_R_BCO_SLD.CommandText := '';
    FIN_SQ_R_BCO_SLD.CommandText := enSqlRelBco;

    FIN_SQ_R_BCO_SLD.CommandText := FIN_SQ_R_BCO_SLD.CommandText  +
          ' where '+
          ' CTA.DTA_MOVIMENTO < ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
          ' CTA.ID_CONTA = '''+VarToStr(Input[1])+''' ';
    if Input[2]<>'' then
       begin
         FIN_SQ_R_BCO_SLD.CommandText := FIN_SQ_R_BCO_SLD.CommandText +
             ' and CTA.ID_EMPRESA IN ('+VarToStr(Input[2])+') ';
       end;
    Result := FIN_DP_R_BCO_SLD.Data;

    FIN_SQ_R_BCO_SLD.Close;
end;

function TSM.FIN_DP_R_COB_ACODataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinCobAco, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRelFinCobAco := '';

    {
       Input[0] - Data ini
       Input[1] - Data fin
       Input[2] - Empresa
       Input[3] - Cliente
       Input[4] - Forma de pagamento
       Input[5] - Local de Ttulo
       Input[6] - Plano de Contas
    }

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Acompanhamento de Cobrana
     enSqlRelFinCobAco :=
       ' SELECT COB.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, COB.DTA_COBRANCA, COB.OBSERVACAO,     ' +
       '        COB.ACORDO, COB.VLR_NEGOCIADO, COB.DTA_ACORDO, TIT.ID_TITULO, TIT.DIAS_ATRASO, ' +
       '        REC.VLR_SALDO,NFE.NUMERO,COB.CONTATO,FPG.DESCRICAO AS INT_NOMEFPG,             ' +
       '        LTO.DESCRICAO AS INT_NOMELTO,                                                  ' +
       '        PCT.DESCRICAO AS INT_NOMEPCT, REC.NUM_PARCELA                                  ' +
       ' FROM fin_tb_m_cob_tit TIT                                                             ' +
       ' LEFT OUTER JOIN FIN_TB_M_COB COB ON COB.ID_CONTROLE     = TIT.ID_CONTROLE             ' +
       ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE      = COB.ID_CLIENTE              ' +
       ' LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO       = TIT.ID_TITULO               ' +
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = REC.ID_FORMA_PAG            ' +
       ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO         ' +
       ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = REC.ID_PLANO                ' +
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL       = REC.ID_FISCAL               ' +
       ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA  = REC.ID_EMPRESA              ' +
       ' WHERE TIT.selecao=TRUE                                                                ' +
       '   AND cob.dta_cobranca >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
       '   AND cob.dta_cobranca <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ';

    CondicaoGroup := ' ';
    CondicaoOrder := ' ORDER BY COB.ID_CLIENTE, REC.DTA_VENCIMENTO, REC.VLR_SALDO ';

    FIN_SQ_R_COB_ACO.Close;
    FIN_SQ_R_COB_ACO.CommandText := '';
    FIN_SQ_R_COB_ACO.CommandText := enSqlRelFinCobAco;

    if Input[2] <> '' then
        begin
           FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  +
               ' AND COB.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
        end;

    if Input[3] <> '' then
        begin
           FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  +
               ' AND COB.ID_CLIENTE in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
          FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  +
               ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  +
               ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  +
               ' AND REC.ID_PLANO in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND CLI.ID_VENDEDOR in (' + VarToStr(Input[7]) +') ';
        end;

    if Input[8] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_FORMA_PAG not in (' + VarToStr(Input[8]) +') ';
        end;


   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_COB_ACO.CommandText := FIN_SQ_R_COB_ACO.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_COB_ACO.Data;

   FIN_SQ_R_COB_ACO.Close;
end;

function TSM.FIN_DP_R_COB_COBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinCob, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRelFinCob := '';

    {  Input[0]
            0 - Cobrana
            1 - Carta cobrana
       Input[1] - Data ini
       Input[2] - Data fin
       Input[3] - Empresa
       Input[4] - Cliente
       Input[5] - Forma de pagamento
       Input[6] - Local de Ttulo
       Input[7] - Plano de Contas
    }

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Cobrana e Carta
     enSqlRelFinCob :=
       '   SELECT REC.id_empresa, REC.num_parcela, REC.id_forma_pag, REC.dta_emissao, REC.dta_vencimento,    ' +
       '   REC.ID_CLIENTE, REC.id_local_titulo, REC.id_plano, NFE.NUMERO AS INT_NUMNFE,                      ' +
       '   CLI.NOME AS INT_NOMECLI, CLI.TEL_FIXO,CLI.TEL_MOVEL,                                                                         ' +
       '   CLI.COB_ENDERECO, CLI.COB_BAIRRO, CLI.COB_CIDADE, CLI.COB_ESTADO, CLI.COB_CEP,    ' +
       '   FPG.DESCRICAO AS INT_NOMEFPG,                                                                     ' +
       '   LTO.DESCRICAO AS INT_NOMELTO,                                                                     ' +
       '   PCT.DESCRICAO AS INT_NOMEPCT, REC.vlr_saldo, REC.VLR_PARCELA,                                                     ' +
       '   (CURRENT_DATE -  REC.dta_vencimento) as INT_ATRASO,                                               ' +
       '   CASE                                                                                              ' +
       '     WHEN (CURRENT_DATE -  REC.dta_vencimento)<=0 THEN REC.vlr_saldo                                 ' +
       '     WHEN (CURRENT_DATE -  REC.dta_vencimento)>0  THEN REC.vlr_saldo+((REC.vlr_saldo*(CTR.tax_juros_mensal/30)/100)*(CURRENT_DATE -  REC.dta_vencimento)) ' +
       '   END as INT_VLR_CORRIGIDO, ' +
       '   CASE                      ' +
       '     WHEN (CURRENT_DATE -  REC.dta_vencimento)<=0 THEN 0                  ' +
       '     WHEN (CURRENT_DATE -  REC.dta_vencimento)>0  THEN                    ' +
       '       (REC.vlr_saldo+((REC.vlr_saldo*(CTR.tax_juros_mensal/30)/100)*     ' +
       '       (CURRENT_DATE -  REC.dta_vencimento)))-REC.vlr_saldo               ' +
       '   END as INT_VLR_JUROS,                                                   ' +
       '   CAST(CASE                                           '+
       '     WHEN REC.situacao_chq =1 THEN ''Em Aberto''       '+
       '     WHEN REC.situacao_chq =2 THEN ''Depositado''      '+
       '     WHEN REC.situacao_chq =3 THEN ''Devolvido''       '+
       '     WHEN REC.situacao_chq =4 THEN ''Parcial''         '+
       '     WHEN REC.situacao_chq =5 THEN ''Resgatado''       '+
       '     WHEN REC.situacao_chq =6 THEN ''Compensado''      '+
       '   END as VARCHAR(20)) as INT_SIT_CHQ                  '+

       '                                                                          ' +
       ' FROM FIN_TB_M_REC REC                                                    ' +
       ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE      = REC.ID_CLIENTE ' +
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = REC.ID_FORMA_PAG  ' +
       ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO  ' +
       ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = REC.ID_PLANO         ' +
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL       = REC.ID_FISCAL        ' +
       ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA  = REC.ID_EMPRESA       ' +
       ' WHERE REC.VLR_SALDO > 0 ' +
       '   AND REC.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
       '   AND REC.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if input[0] = 0 then
       begin
         if input[9] = 0 then
            begin
               CondicaoGroup := ' ';
               CondicaoOrder := ' ORDER BY REC.ID_CLIENTE, REC.DTA_VENCIMENTO ';
            end;
         if input[9] = 1 then
            begin
               CondicaoGroup := ' ';
               CondicaoOrder := ' ORDER BY INT_NOMECLI, REC.DTA_VENCIMENTO ';
            end;
       end;

    if input[0] = 1 then
       begin
         CondicaoGroup := ' ';
         CondicaoOrder := ' ORDER BY REC.ID_CLIENTE, REC.DTA_VENCIMENTO ';
       end;

    FIN_SQ_R_COB_COB.Close;
    FIN_SQ_R_COB_COB.CommandText := '';
    FIN_SQ_R_COB_COB.CommandText := enSqlRelFinCob;

    if Input[3] <> '' then
        begin
           FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        end;

    if Input[4] <> '' then
        begin
           FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        end;

    if Input[8] <> '' then
        begin
          FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
               ' AND CLI.ID_VENDEDOR in (' + VarToStr(Input[8]) +') ';
        end;

    if input[0] = 0 then
       begin
          if Input[10] <> '' then
              begin
                FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
                     ' AND REC.ID_FORMA_PAG not in (' + VarToStr(Input[10]) +') ';
              end;
       end;

    if input[0] = 1 then
       begin
          if Input[9] <> '' then
              begin
                FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  +
                     ' AND REC.ID_FORMA_PAG not in (' + VarToStr(Input[9]) +') ';
              end;
       end;

   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_COB_COB.CommandText := FIN_SQ_R_COB_COB.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_COB_COB.Data;

   FIN_SQ_R_COB_COB.Close;
end;

function TSM.FIN_DP_R_CSCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlCsc: String;
  begin
  Result :=
    ' select distinct cli.id_vendedor, ven.nome as "Representante", ped.id_cliente "Cd. cliente", cli.nome Nome, '+
    ' cli.tel_fixo "Fixo", ' +
    '        cli.tel_movel "Celular", ' + #13#10  +
    '        cli.endereco, cli.numero, cid.nome int_nomecid, cid.uf as int_uf, cli.email, cli.ativo, ' + #13#10 +

    '  cast( case cli.situacao ' +
    '    when 0 then ''normal'' ' +
    '    when 1 then ''especial'' ' +
    '    when 2 then ''crdito encerrado'' ' +
    '  end as varchar(30) ) as int_situacao, ' +
    '  cast( case cli.sexo ' +
    '    when 0 then ''feminino'' ' +
    '    when 1 then ''masculino'' ' +
    '  end as varchar(10) ) as int_sexo, ' +
    '  cast( case tipo_cliente ' +
    '    when 0 then ''consumidor'' ' +
    '    when 1 then ''revenda'' ' +
    '  end as varchar(10) ) as int_tipocliente, ' +

    '        max(CURRENT_DATE - ors.dta_emissao ) "qtde_dias_sem_compras", ' +
    '        max(ors.dta_emissao)  "lt. venda" from pcp_tb_m_ors ors   ' +
    ' left outer join fat_tb_m_ped ped on ped.id_pedido = ors.id_pedido   ' +
    ' left outer join cad_tb_c_cli cli on cli.id_cliente = ped.id_cliente ' +
    ' left outer join cad_tb_c_fun ven on ven.id_funcionario = cli.id_vendedor ' +
    ' left outer join cad_tb_c_cid cid on cid.id_cidade = cli.id_cidade ';




   { Result := ' SELECT CLI.*, CID.UF INT_UF, CID.NOME AS INT_NOMECID, '+
              '  cast( CASE SITUACAO ' +
              '    WHEN 0 THEN ''Normal'' ' +
              '    WHEN 1 THEN ''Especial'' ' +
              '    WHEN 2 THEN ''Crdito encerrado'' ' +
              '  END AS VARCHAR(30) ) AS int_situacao, ' +
              '  cast( CASE CLI.SEXO ' +
              '    WHEN 0 THEN ''Feminino'' ' +
              '    WHEN 1 THEN ''Masculino'' ' +
              '  END AS VARCHAR(10) ) AS int_sexo, ' +
              '  cast( CASE TIPO_CLIENTE ' +
              '    WHEN 0 THEN ''Consumidor'' ' +
              '    WHEN 1 THEN ''Revenda'' ' +
              '  END AS VARCHAR(10) ) AS int_tipocliente, ' +

              '  PEC.DESCRICAO AS INT_NOMEPER, ' +
              ' FUN.NOME AS INT_NOMEVND  '+
              ' FROM CAD_TB_C_CLI CLI ' +
              ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE ' +
              ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=CLI.ID_VENDEDOR ' +
              ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON (PEC.ID_PERFIL_CLI = CLI.ID_PERFIL_CLI) ';}

  end;
begin
    //Esse filtro  utilizado pela tela FIN_FM_R_CSC(Relatorio de Clientes Sem Compras)
    //Responsavel:Luan. Data:26/04/2016

    // Atualizado por Maxsuel Victor em 03/03/2023

    // Foi alterado a estrutura do SQL

    FIN_SQ_R_CSC.Close;

    //FIN_SQ_R_CSC.CommandText := enSqlCsc +
    //   ' where ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+''' - cli.dta_ult_compra) >= '''+VarToStr(Input[2])+''' ';

    FIN_SQ_R_CSC.CommandText := enSqlCsc +
        ' where (CURRENT_DATE - ors.dta_emissao ) >= '''+VarToStr(Input[1])+''' and ' +
        '       (CURRENT_DATE - ors.dta_emissao ) <= '''+VarToStr(Input[2])+''' ';

    if Input[3] <> '' then
      begin
          FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
        ' and cli.ativo = '''+VarToStr(Input[3]) +''' ';
      end;

    if Input[4] <> '' then
      begin
          FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
         ' and cli.tipo_cliente = '''+VarToStr(Input[4]) +''' ';
      end;

    if Input[5] <> '' then
      begin
          FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
         ' and cli.situacao in ('+VarToStr(Input[5]) +') ';
      end;

    if Input[6] <> '' then
      begin
          FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
         ' and cli.id_cidade in ('+VarToStr(Input[6]) +') ';
      end;

    if Input[7] <> '' then
      begin
          FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
         ' and cli.id_vendedor in ('+VarToStr(Input[7]) +') ';
      end;

    FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
                                ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 ' ;

    if Input[0] = '0' then
      begin
         FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
         ' order by 1,2, cli.nome ';
      end;
    if Input[0] = '1' then
      begin
         FIN_SQ_R_CSC.CommandText := FIN_SQ_R_CSC.CommandText +
           ' order by int_uf, 16, cli.nome ';
      end;


     //CMServerForm.mm.Lines.Add(FIN_SQ_R_CSC.CommandText);
     Result := FIN_DP_R_CSC.Data;
     FIN_SQ_R_CSC.Close;
end;

function TSM.FIN_DP_R_CSC_EMPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlCscEmp:String;
begin
  //Responsavel:Luan. Data:29/05/2016
   enSqlCscEmp :=

           ' SELECT PAR.ID_EMPRESA,PAR.EMP_FANTASIA,CLI.*, CID.UF INT_UF, CID.NOME AS INT_NOMECID, '+
           '     cast( CASE SITUACAO                                                               '+
           '       WHEN 0 THEN ''Normal''                                                          '+
           '       WHEN 1 THEN ''Especial''                                                        '+
           '       WHEN 2 THEN ''Crdito encerrado''                                               '+
           '     END AS VARCHAR(30) ) AS int_situacao,                                             '+
           '     cast( CASE CLI.SEXO                                                               '+
           '       WHEN 0 THEN ''Feminino''                                                        '+
           '       WHEN 1 THEN ''Masculino''                                                       '+
           '     END AS VARCHAR(10) ) AS int_sexo,                                                 '+
           '     cast( CASE TIPO_CLIENTE                                                           '+
           '       WHEN 0 THEN ''Consumidor''                                                      '+
           '       WHEN 1 THEN ''Revenda''                                                         '+
           '     END AS VARCHAR(10) ) AS int_tipocliente,                                          '+
           '       PEC.DESCRICAO AS INT_NOMEPER,                                                   '+
           '    FUN.NOME AS INT_NOMEVND                                                            '+
           '    FROM CAD_TB_C_CLI CLI                                                              '+
           '    LEFT OUTER JOIN CAD_TB_C_PAR PAR ON PAR.ID_EMPRESA>0                               '+
           '    LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=CLI.ID_VENDEDOR             '+
           '    LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE                    '+
           '    LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI = CLI.ID_PERFIL_CLI          '+

           '  WHERE NOT EXISTS (SELECT * FROM FAT_TB_M_NFE NFE                                     '+
           '         left outer join cad_tb_c_cfo cfo on cfo.id_cfo=nfe.id_cfo                     '+
           '         where CFO.ID_CLASSE IN (''SP10'',''SP70'') and nfe.tipo_nf=''S'' and nfe.status=1 and nfe.faturada=true and '+
           '             nfe.nfe_cod_sit not in (''02'',''04'',''05'') and                          '+
           '             nfe.DTA_EMISSAO<=CURRENT_DATE '+
           '            AND nfe.DTA_EMISSAO>=(CURRENT_DATE -'+VarToStr(Input[2])+') AND  '+
           '             nfe.id_empresa=PAR.id_empresa and nfe.id_emitente=cli.id_cliente)          ';


   FIN_SQ_R_CSC_EMP.CommandText := enSqlCscEmp;
    if Input[3] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
        ' and cli.ativo = '''+VarToStr(Input[3]) +''' ';
      end;

    if Input[4] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' and cli.tipo_cliente = '''+VarToStr(Input[4]) +''' ';
      end;

    if Input[5] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' and cli.situacao in ('+VarToStr(Input[5]) +') ';
      end;

    if Input[6] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' and cli.id_cidade in ('+VarToStr(Input[6]) +') ';
      end;

    if Input[7] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' and cli.id_vendedor in ('+VarToStr(Input[7]) +') ';
      end;

    if Input[8] <> '' then
      begin
          FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' and par.id_empresa in ('+VarToStr(Input[8]) +') ';
      end;

    if Input[0] = '0' then
      begin
         FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' order by cli.nome ';
      end;
    if Input[0] = '1' then
      begin
         FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' order by int_nomeper,cli.nome ';
      end;
    if Input[0] = '2' then
      begin
         FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' order by PAR.ID_EMPRESA,CLI.NOME ';
      end;
    if Input[0] = '3' then
      begin
         FIN_SQ_R_CSC_EMP.CommandText := FIN_SQ_R_CSC_EMP.CommandText +
         ' order by PAR.ID_EMPRESA,INT_NOMEPER,CLI.NOME ';
      end;

   //  CMServerForm.mm.Lines.Add(FIN_SQ_R_CSC_emp.CommandText);
     Result := FIN_DP_R_CSC_EMP.Data;
     FIN_SQ_R_CSC_EMP.Close;
end;

function TSM.FIN_DP_R_CXA_DIADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDia, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDia:='';

    //  Input[0] Relatrio
                  // 00-Caixa dirio
                  // 01-Movimentao por operao
                  // 02-Movimento por Plano de Conta

    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Empresa
    //  Input[4]  Operador
    //  Input[5]  Conta Corrente
    //  Input[6]  Plano de Contas
    //  Input[7]  Tipo Financeiro

    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[0] = 0)  then
       begin
         enSqlCxaDia :=
            ' SELECT ' +
            '   CTA.ID_CONTROLE, TIF.NATUREZA, ' +
            '   CAST (CASE TIF.NATUREZA ' +
            '      WHEN 0 THEN ''Sadas'' '   +
            '      WHEN 1 THEN ''Entradas'' ' +
            '   END AS VARCHAR(15) ) AS  INT_DESCNATUREZA,    ' +
            '   NFE.NUMERO AS INT_NUMERO_NF, FRN.DESCRICAO AS INT_NOMEFOR, '+
            '   CTA.DTA_MOVIMENTO, CTA.NUM_DOC, TIF.SIGLA, TIF.DESCRICAO AS INT_NOMEFPG, CTA.ID_PLANO, ' +
            '   CTA.ID_TIPO_FINANCEIRO, CTA.HISTORICO,CTA.DEB_CRE, CTA.VLR_LANCAMENTO,          ' +
            '   COALESCE(SUM(CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_CREDITODIA, ' +
            '   COALESCE(SUM(CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_DEBITODIA,  ' +
            '   COALESCE(SUM(CTA.VLR_LANCAMENTO * (CASE WHEN CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0) VLR_SALDODIA, ' +
            '  (SELECT COALESCE(SUM(I_CTA.VLR_LANCAMENTO * (CASE WHEN I_CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0)    ' +
            '   FROM  FIN_TB_M_CTA I_CTA                                                                          ' +
            '      LEFT OUTER JOIN FIN_TB_M_CXA I_CXA ON I_CXA.ID_ABERTURA = I_CTA.ID_ABERTURA                    ' +
            '   WHERE  I_CTA.DTA_MOVIMENTO  <= CTA.DTA_MOVIMENTO AND  ';

            if Input[3] <> '' then
              begin
                 enSqlCxaDia := enSqlCxaDia + '  I_CTA.ID_EMPRESA in  ('+VarToStr(Input[3])+')   AND   ';
              end;

         enSqlCxaDia := enSqlCxaDia +
            '          I_CTA.TIPO_LANCAMENTO = 0   AND                ' +
            '          I_CTA.ID_CONTA        = ''' + VarToStr(Input[5]) + ''' AND ' +
            '          I_CXA.ID_FUNCIONARIO  = ''' + VarToStr(Input[4]) + ''' '     +

            '   order by CTA.DTA_MOVIMENTO )  VLR_ACUMULADO ' +
            ' FROM FIN_TB_M_CTA CTA                                                                               ' +
            '   LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO               ' +
            '   LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO                                   ' +
            '   LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA= CTA.ID_ABERTURA                              ' +
            '   LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO= CTA.ID_TITULO_PAG                              ' +
            '   LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL= PAG.ID_FISCAL                                  ' +
            '   LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR=NFE.ID_EMITENTE                             ' +
            ' WHERE CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
            '       CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
            '       CTA.TIPO_LANCAMENTO = 0 ';
             CondicaoGroup := ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14';
             CondicaoOrder := ' ORDER BY INT_DESCNATUREZA, CTA.ID_CONTROLE, CTA.DTA_MOVIMENTO';
       end;


  FIN_SQ_R_CXA_DIA.Close;
  FIN_SQ_R_CXA_DIA.CommandText := '';
  FIN_SQ_R_CXA_DIA.CommandText := enSqlCxaDia;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CTA.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  //if Input[4] <> '' then
  //    begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ';
  //    end;

  //if Input[5] <> '' then
  //    begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CTA.ID_CONTA = ''' + VarToStr(Input[5]) +''' ';
   //   end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CTA.ID_PLANO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CTA.ID_TIPO_FINANCEIRO in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  +
             ' AND CTA.ID_OBRA = ''' + VarToStr(Input[8]) + ''' ';
      end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA.CommandText := FIN_SQ_R_CXA_DIA.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaPag, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaPag := '';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Operador
    //  Input[4]  Conta Corrente

    CondicaoOrder := '';
    CondicaoGroup := '';


         // Pagamento
         enSqlCxaDiaPag :=
           '  SELECT PAG.NUM_PARCELA AS NUM_TITULO,                                      ' +
           '         PAG.DTA_VENCIMENTO,                                                 ' +
           '         FOC.DESCRICAO AS INT_NOMEFOR,                                       ' +
           '         PAG.VLR_PARCELA,                                                    ' +
           '         PGT.VLR_DESCONTO,                                                   ' +
           '         FPG.DESCRICAO AS NOM_FPG,                                           ' +
           '         PGT.VLR_PAGAMENTO                                                   ' +
           '  FROM FIN_TB_M_PAG_PAG PGT                                                  ' +
           '  LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO     = PGT.ID_TITULO      ' +
           '  LEFT OUTER JOIN FIN_TB_M_PBX PBX ON PBX.ID_BAIXA      = PGT.ID_BAIXA       ' +
           '  LEFT OUTER JOIN CAD_TB_C_FOR FOC ON FOC.ID_FORNECEDOR = PAG.ID_FORNECEDOR  ' +
           '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG  = PGT.ID_FORMA_PAG   ' +
           '  LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO      = PGT.ID_PLANO       ' +
           '  LEFT OUTER JOIN CAD_TB_C_CCU CCU ON CCU.ID_CCUSTO     = PGT.ID_CCUSTO      ' +
           '  WHERE 1 = 1 ';
         CondicaoGroup := ' ';
         CondicaoOrder := ' ';



    FIN_SQ_R_CXA_DIA_PAG.Close;
    FIN_SQ_R_CXA_DIA_PAG.CommandText := '';
    FIN_SQ_R_CXA_DIA_PAG.CommandText := enSqlCxaDiaPag;

    if Input[0] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  +
              ' AND PBX.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  +
              ' AND   PGT.DTA_PAGAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
              '       PGT.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          { TODO -oMaxsuel Victor -cCriao :
            Maxsuel Victor em 06/03/2015
                    No ser preciso pegar o id_funcionario da tabela do caixa, pois
                    no momento de fazer o pagamento o sistema repassa o id_funcionario do caixa para
                    o campo ID_RESPONSAVEL da tabela FIN_TB_M_PAG_PAG }

           FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  +
               ' AND PGT.ID_RESPONSAVEL = ''' + VarToStr(Input[3]) +''' ';
        end;

    if Input[4] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  +
               ' AND PBX.ID_CONTA = ''' + VarToStr(Input[4]) +''' ';
        end;

     if Input[5] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  +
               ' AND PAG.ID_OBRA = ''' + VarToStr(Input[5]) +''' ';
        end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_PAG.CommandText := FIN_SQ_R_CXA_DIA_PAG.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_PAG.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_RECDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaRec, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaRec := '';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Operador
    //  Input[4]  Conta Corrente

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Pagamento
     enSqlCxaDiaRec :=
       '  SELECT REC.NUM_PARCELA AS NUM_TITULO,                                   ' +
       '          REC.DTA_VENCIMENTO,                                             ' +
       '          CLI.NOME AS INT_NOMECLI,                                        ' +
       '          REC.VLR_PARCELA,                                                ' +
       '          RTO.VLR_DESCONTO,                                               ' +
       '          FPG.DESCRICAO AS NOM_FPG,                                       ' +
       '          RTO.VLR_PAGAMENTO                                               ' +
       '   FROM FIN_TB_M_REC_PAG RTO                                              ' +
       '   LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO    =RTO.ID_TITULO    ' +
       '   LEFT OUTER JOIN FIN_TB_M_RBX RBX ON RBX.ID_BAIXA     =RTO.ID_BAIXA     ' +
       '   LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE   =REC.ID_CLIENTE   ' +
       '   LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG =RTO.ID_FORMA_PAG ' +
       '   LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO     =RTO.ID_PLANO     ' +
       '   LEFT OUTER JOIN CAD_TB_C_CCU CCU ON CCU.ID_CCUSTO    =RTO.ID_CCUSTO    ' +
       '  WHERE 1 = 1 ';
     CondicaoGroup := ' ';
     CondicaoOrder := ' ';



    FIN_SQ_R_CXA_DIA_REC.Close;
    FIN_SQ_R_CXA_DIA_REC.CommandText := '';
    FIN_SQ_R_CXA_DIA_REC.CommandText := enSqlCxaDiaRec;

    if Input[0] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  +
              ' AND RBX.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  +
              ' AND   RTO.DTA_PAGAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
              '       RTO.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          { TODO -oMaxsuel Victor -cCriao :
            Maxsuel Victor em 06/03/2015
                    No ser preciso pegar o id_funcionario da tabela do caixa, pois
                    no momento de fazer o pagamento o sistema repassa o id_funcionario do caixa para
                    o campo ID_RESPONSAVEL da tabela FIN_TB_M_PAG_PAG }

           FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  +
               ' AND RTO.ID_RESPONSAVEL = ''' + VarToStr(Input[3]) +''' ';
        end;

     if Input[4] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  +
               ' AND RBX.ID_CONTA = ''' + VarToStr(Input[4]) +''' ';
        end;

     if Input[5] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  +
               ' AND REC.ID_OBRA = ''' + VarToStr(Input[5]) +''' ';
        end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_REC.CommandText := FIN_SQ_R_CXA_DIA_REC.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_REC.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_RVEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaRve, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaRve:='';

    { TODO -oMaxsuel -cCriao : Criado em 09/09/2015. }


    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Operador
    //  Input[4]  Conta Corrente

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Vendas do dia por forma de pagamento
     enSqlCxaDiaRve :=
       ' SELECT NTI.*, FPG.DESCRICAO AS INT_NOMEFPG,                  ' +
       '    NFE.NUMERO, NFE.DTA_EMISSAO,                                         ' +
       '    NFE.ID_PEDIDO_VENDA, NFE.ID_ORDEM,                                   ' +
       '    NFE.ID_VENDEDOR,                                                     ' +
       '    FUC.NOME AS INT_NOMEVND,                                             ' +
       '    NFE.ID_EMITENTE,                                                     ' +
       '    CLI.NOME AS INT_NOMECLI                                              ' +
       '                                                                         ' +
       ' FROM FAT_TB_M_NFE_TIT NTI                                               ' +
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NTI.ID_FISCAL         ' +
       ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA=NFE.ID_ABERTURA     ' +
       ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR  ' +
       ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE      ' +
       ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE         ' +
       ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE  ' +
       ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                   ' +
       ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG ' +
       ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI     ' +
       ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=nti.id_forma_pag       ' +
       ' WHERE NFE.TIPO_NF = ''S'' '  +
       '   AND NFE.NFE_COD_SIT NOT IN (''02'',''03'',''04'',''05'') ' +
       '   AND NFE.STATUS = 1 ' ;
     CondicaoGroup := ' ';
     CondicaoOrder := ' ORDER BY NTI.ID_FORMA_PAG, NFE.NUMERO ';



    FIN_SQ_R_CXA_DIA_RVE.Close;
    FIN_SQ_R_CXA_DIA_RVE.CommandText := '';
    FIN_SQ_R_CXA_DIA_RVE.CommandText := enSqlCxaDiaRve;

    if Input[0] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  +
               ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  +
              ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
              '     NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  +
               ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[3]) +''' ';
        end;

    if Input[4] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  +
               ' AND CXA.ID_CONTA = ''' + VarToStr(Input[4]) +''' ';
        end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_RVE.CommandText := FIN_SQ_R_CXA_DIA_RVE.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_RVE.Data;

   FIN_SQ_R_CXA_DIA_RVE.Close;
end;

function TSM.FIN_DP_R_CXA_DIA_SLADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaAnt, CondicaoOrder: String;
begin

   enSqlCxaDiaAnt := '';

   //  Input[0]  Data inicial
   //  Input[1]  Empresa
   //  Input[2]  Conta Corrente
   //  Input[3]  Operador

   CondicaoOrder := '';

   enSqlCxaDiaAnt :=
      ' SELECT COALESCE(SUM(I_CTA.VLR_LANCAMENTO * (CASE WHEN I_CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0) AS SLD_ANTERIOR ' +
      ' FROM  FIN_TB_M_CTA I_CTA                                                                       ' +
      ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA = I_CTA.ID_ABERTURA                           ' +
      ' WHERE I_CTA.TIPO_LANCAMENTO=0  AND I_CTA.DTA_MOVIMENTO < ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' ';

   CondicaoOrder := '';

   FIN_SQ_R_CXA_DIA_SLA.Close;
   FIN_SQ_R_CXA_DIA_SLA.CommandText := '';
   FIN_SQ_R_CXA_DIA_SLA.CommandText := enSqlCxaDiaAnt;

   if Input[1] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_SLA.CommandText := FIN_SQ_R_CXA_DIA_SLA.CommandText  +
             ' AND I_CTA.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';
      end;
   FIN_SQ_R_CXA_DIA_SLA.CommandText := FIN_SQ_R_CXA_DIA_SLA.CommandText  +
             ' AND I_CTA.ID_CONTA = ''' + VarToStr(Input[2])     +''' '  +
             ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[3]) +''' ';


   if Input[4] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_SLA.CommandText := FIN_SQ_R_CXA_DIA_SLA.CommandText  +
             ' AND I_CTA.ID_OBRA = ''' + VarToStr(Input[4]) +''' ';
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_SLA.CommandText := FIN_SQ_R_CXA_DIA_SLA.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_SLA.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_VNDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaVnd, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaVnd:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Operador
    //  Input[4]  Conta Corrente

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Vendas do dia
     enSqlCxaDiaVnd :=
       ' SELECT NTI.ID_FORMA_PAG, FPG.DESCRICAO AS INT_NOMEFPG,                  ' +
       '    NFE.NUMERO, NFE.DTA_EMISSAO,                                         ' +
       '    NFE.ID_PEDIDO_VENDA,                                                 ' +
       '    NFE.ID_VENDEDOR,                                                     ' +
       '    FUC.NOME AS INT_NOMEVND,                                             ' +
       '    NFE.ID_EMITENTE,                                                     ' +
       '    CLI.NOME AS INT_NOMECLI, NFE.VLR_LIQUIDO AS VLR_TOTAL_NOTA,          ' +
       '    SUM(COALESCE(NTI.VLR_TITULO,0)) AS VLR_TITULO                        ' +
       '                                                                         ' +
       ' FROM FAT_TB_M_NFE_TIT NTI                                               ' +
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL=NTI.ID_FISCAL         ' +
       ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA=NFE.ID_ABERTURA     ' +
       ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=NFE.ID_VENDEDOR  ' +
       ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=NFE.ID_EMITENTE      ' +
       ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE=CLI.ID_CIDADE         ' +
       ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=NFE.ID_TIPO_MOV_ESTOQUE  ' +
       ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                   ' +
       ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=NFE.ID_CONDICAO_PAG ' +
       ' LEFT OUTER JOIN CAD_TB_C_PEC PEC ON PEC.ID_PERFIL_CLI=CLI.ID_PERFIL_CLI     ' +
       ' left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=nti.id_forma_pag       ' +
       ' WHERE NFE.TIPO_NF = ''S'' '  +
       '   AND NFE.NFE_COD_SIT NOT IN (''02'',''04'',''05'') '+
       '   AND NFE.STATUS = 1 ' ;
     CondicaoGroup := ' GROUP BY 1,2,3,4,5,6,7,8,9,10';
     CondicaoOrder := ' ORDER BY NFE.NUMERO';



    FIN_SQ_R_CXA_DIA_VND.Close;
    FIN_SQ_R_CXA_DIA_VND.CommandText := '';
    FIN_SQ_R_CXA_DIA_VND.CommandText := enSqlCxaDiaVnd;

    if Input[0] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  +
               ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  +
              ' AND   NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
              '       NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

    if Input[3] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  +
               ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[3]) +''' ';
        end;

    if Input[4] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  +
               ' AND CXA.ID_CONTA = ''' + VarToStr(Input[4]) +''' ';
        end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_VND.CommandText := FIN_SQ_R_CXA_DIA_VND.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_VND.Data;

   FIN_SQ_R_CXA_DIA_VND.Close;
end;

function TSM.FIN_DP_R_EXT_CLI_ABEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtCli, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRelFinExtCli := '';

    {
       Input[0] - Data ini
       Input[1] - Data fin
       Input[2] - Empresa
       Input[3] - Cliente
       Input[4] - Forma de pagamento
       Input[5] - Local de Ttulo
       Input[6] - Plano de Contas


    }

    CondicaoOrder := '';
    CondicaoGroup := '';



     enSqlRelFinExtCli :=
       ' SELECT REC.num_parcela, NFE.NUMERO AS INT_NUMNFE, FPG.DESCRICAO AS INT_NOMEFPG,             '+
       '      REC.dta_emissao, REC.dta_vencimento, REC.dta_original,                                 '+
       '      REC.ID_CLIENTE, REC.id_local_titulo, REC.id_plano,                                     '+
       ' CLI.NOME AS INT_NOMECLI, cli.cob_endereco, cli.cob_bairro, cli.cob_cidade, cli.cob_estado,  '+
       ' cli.cob_cep, cli.lim_saldo, cli.doc_cnpj_cpf,                                               '+
       ' REC.vlr_parcela,   REC.vlr_original, (REC.vlr_parcela-REC.vlr_saldo) as Vlr_pago,           '+
       ' ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' -  REC.dta_vencimento) as INT_ATRASO,                                         '+

       {' CASE                                                                                        '+
       '   WHEN (CURRENT_DATE -  REC.dta_vencimento)<=0 THEN REC.vlr_saldo                           '+
       '   WHEN (CURRENT_DATE -  REC.dta_vencimento)>0  THEN REC.vlr_saldo+((REC.vlr_saldo*(CTR.tax_juros_mensal/30)/100)*(CURRENT_DATE -  REC.dta_vencimento)) '+
       ' END as INT_VLR_restante,                                                                    ';   }



       ' CASE     '+
       '   WHEN ( '''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' '+
       ' -  REC.dta_vencimento)<=0 THEN REC.vlr_saldo-                           '+
       '   (REC.vlr_saldo*('+VarToStr(Input[10])+')/100.0) '+
       '   WHEN ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+'''  -  REC.dta_vencimento)>0  THEN REC.vlr_saldo+ '+
       ' ((REC.vlr_saldo*('+VarToStr(Input[8])+'/30.0)/100.0)*('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' -  REC.dta_vencimento)) '+
       ' END as INT_VLR_restante, '+

       ' CASE                                                                                        '+
       '   WHEN ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+'''-  REC.dta_vencimento)<=0 THEN 0                                       '+
       '   WHEN ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' -  REC.dta_vencimento)>0  THEN                                         '+
       '     (REC.vlr_saldo+((REC.vlr_saldo*('+VarToStr(Input[8])+'/30.0)/100.0)*                          '+
       '     ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' -  REC.dta_vencimento)))-REC.vlr_saldo                                    '+
       ' END as INT_VLR_JUROS, '+

       ' CASE                                                                                        '+
       '   WHEN ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+'''-  REC.dta_vencimento)>0 THEN 0                                       '+
       '   WHEN ('''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[9])))+''' -  REC.dta_vencimento)<=0  THEN                                         '+
       '     (REC.vlr_saldo*('+VarToStr(Input[10])+')/100.0)                          '+
       ' END as INT_VLR_DESCONTO '+



       '  FROM FIN_TB_M_REC REC '+
       '  LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE      = REC.ID_CLIENTE      '+
       '  LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = REC.ID_FORMA_PAG    '+
       '  LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
       '  LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = REC.ID_PLANO        '+
       '  LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL       = REC.ID_FISCAL       '+
       '  LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA  = REC.ID_EMPRESA      '+
       '  where REC.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
       '   AND REC.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' '  +
       '   AND REC.vlr_saldo>0 ';

    CondicaoGroup := ' ';
    CondicaoOrder := ' ORDER BY REC.ID_CLIENTE, REC.DTA_VENCIMENTO, REC.VLR_SALDO ';

    FIN_SQ_R_EXT_CLI_ABE.Close;
    FIN_SQ_R_EXT_CLI_ABE.CommandText := '';
    FIN_SQ_R_EXT_CLI_ABE.CommandText := enSqlRelFinExtCli;

    if Input[2] <> '' then
        begin
           FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  +
               ' AND REC.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
        end;

     if Input[3] <> '' then
        begin
           FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  +
               ' AND REC.ID_CLIENTE in (' + VarToStr(Input[3]) +') ';
        end;


    if Input[4] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  +
               ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  +
               ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  +
               ' AND REC.ID_PLANO in (' + VarToStr(Input[6]) +') ';
        end;




   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_EXT_CLI_ABE.CommandText := FIN_SQ_R_EXT_CLI_ABE.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_EXT_CLI_ABE.Data;

   FIN_SQ_R_EXT_CLI_ABE.Close;

end;

function TSM.FIN_DP_R_EXT_CLI_ESTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlRelFinExiCliEst:string;
begin
    enSqlRelFinExiCliEst :=
       ' select cli.id_cliente,cli.lim_saldo,cli.dta_ult_compra,cli.dta_pri_compra, '+

       ' (select coalesce(sum(rec.vlr_saldo),0) from fin_tb_m_rec rec '+
       '  where rec.id_cliente=cli.id_cliente and rec.vlr_saldo>0) as vlr_total_tit_aberto, '+

       '  (select sum(rec.vlr_saldo) from fin_tb_m_rec rec where '+
       ' rec.id_cliente=cli.id_cliente and '+
       ' rec.dta_vencimento<CURRENT_DATE and rec.vlr_saldo>0) as vlr_total_tit_vencido, '+

       ' (select COALESCE(sum(((rec.vlr_saldo*(COALESCE(CTR.tax_juros_mensal,0)/30)/100)* '+
       '       (CURRENT_DATE -  rec.dta_vencimento))),0) '+
       '   from fin_tb_m_rec rec                         '+
       '  left outer join cad_tb_c_par_ctr ctr on ctr.id_empresa=rec.id_empresa '+
       '  where rec.id_cliente=cli.id_cliente and rec.dta_vencimento<CURRENT_DATE)  as vlr_total_tit_juros, '+


       ' (select COALESCE(sum(rec.vlr_saldo+((rec.vlr_saldo*(COALESCE(CTR.tax_juros_mensal,0)/30)/100)* '+
       '         (CURRENT_DATE -  rec.dta_vencimento))),0) from fin_tb_m_rec rec '+
       '  left outer join cad_tb_c_par_ctr ctr on ctr.id_empresa=rec.id_empresa '+
       '  where rec.id_cliente=cli.id_cliente and  rec.dta_vencimento<CURRENT_DATE) as vlr_total_tit_corrigido, '+

       ' (select COALESCE(sum(rec.vlr_saldo),0) from fin_tb_m_rec rec where rec.id_cliente=cli.id_cliente and '+
       ' rec.dta_vencimento>=CURRENT_DATE and rec.vlr_saldo>0) as vlr_total_tit_vencer, '+

       ' (select COALESCE(sum(rec.vlr_saldo),0) from fin_tb_m_rec rec '+
       '  left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=rec.id_forma_pag '+
       '  where rec.id_cliente=cli.id_cliente and fpg.doc_impresso=6 and rec.vlr_saldo>0 ) as  vlr_che_aberto, '+

       ' (select COALESCE(sum(rec.vlr_parcela),0) from fin_tb_m_rec rec where rec.id_cliente=cli.id_cliente and  rec.vlr_saldo=0) as vlr_total_tit_pagos, '+

       ' (select COALESCE(sum(nfe.vlr_liquido),0)  from fat_tb_m_nfe nfe '+
       '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
       '   WHERE nfe.id_emitente=cli.id_cliente and CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND '+
       '      NFE.FATURADA = true AND NFE.TIPO_NF=''S'')  as vlr_total_compras, '+

       '  (select COALESCE(sum(nfe.vlr_liquido),0)  from fat_tb_m_nfe nfe '+
       '  WHERE nfe.id_emitente=cli.id_cliente and  NFE.STATUS = 1 AND                                        '+
       '      NFE.FATURADA = true AND NFE.TIPO_NF=''R'') as vlr_total_dev '+

       ' from cad_tb_c_cli cli ';

    FIN_SQ_R_EXT_CLI_EST.Close;
    FIN_SQ_R_EXT_CLI_EST.CommandText := enSqlRelFinExiCliEst;


    FIN_SQ_R_EXT_CLI_EST.CommandText := FIN_SQ_R_EXT_CLI_EST.CommandText  +
      ' where cli.id_cliente = '''+VarToStr(Input[0])+''' ';

   Result := FIN_DP_R_EXT_CLI_EST.Data;

   FIN_SQ_R_EXT_CLI_EST.Close;
end;

function TSM.FIN_DP_R_EXT_CLI_NCRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtCliNcr:string;
begin
    { TODO -oLuan : Criado em 28/04/2016 }

    enSqlRelFinExtCliNcr :=
        ' SELECT RCR.ID_EMPRESA,RCR.ID_CREDITO,RCR.DTA_CREDITO,RCR.ID_CLIENTE,CLI.NOME AS INT_NOMECLI,RCR.HISTORICO, '+

        ' CAST (CASE RCR.ORIGEM '+
        '    WHEN 0 THEN ''Manual'' '+
        '    WHEN 1 THEN ''Baixa de Conta a Receber'' '+
        '    WHEN 2 THEN ''Devoluo de Vendas'' '+
        '    WHEN 3 THEN ''Nota Fiscal de Venda'' '+
        '  END AS VARCHAR(30)) AS INT_DESCORIGEM, '+

        ' (COALESCE((SELECT SUM(COALESCE(RCC.VLR_CREDITO,0)) FROM FIN_TB_M_RCR RCC '+
        '   WHERE RCC.ID_CLIENTE=RCR.ID_CLIENTE AND RCC.DEB_CRE = 1 AND RCC.ID_CREDITO < RCR.ID_CREDITO ),0) - '+
        '  COALESCE((SELECT SUM(COALESCE(RCC.VLR_CREDITO,0)) FROM FIN_TB_M_RCR RCC  '+
        '   WHERE RCC.ID_CLIENTE=RCR.ID_CLIENTE AND RCC.DEB_CRE = 0 AND RCC.ID_CREDITO < RCR.ID_CREDITO ),0)) '+
        '  AS SALDO_ANTERIOR, '+

        ' CAST (CASE RCR.DEB_CRE '+
        '    WHEN 0 THEN 0 '+
        '    WHEN 1 THEN RCR.VLR_CREDITO '+
        '  END AS NUMERIC(18,4)) AS ENTRADA, '+

        ' CAST (CASE RCR.DEB_CRE '+
        '    WHEN 0 THEN RCR.VLR_CREDITO '+
        '    WHEN 1 THEN 0 '+
        '  END AS NUMERIC(18,4)) AS SAIDA '+

        ' FROM FIN_TB_M_RCR RCR '+
        ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=RCR.ID_CLIENTE ';


    FIN_SQ_R_EXT_CLI_NCR.Close;
    FIN_SQ_R_EXT_CLI_NCR.CommandText := enSqlRelFinExtCliNcr;


    FIN_SQ_R_EXT_CLI_NCR.CommandText := FIN_SQ_R_EXT_CLI_NCR.CommandText  +
      ' where rcr.dta_credito >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])))+ ''' '+
      '  and rcr.dta_credito <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+ ''' '+
      '  and rcr.id_cliente = '''+VarToStr(Input[2])+''' ';


    if VarToStr(Input[3])<>'' then
       FIN_SQ_R_EXT_CLI_NCR.CommandText := FIN_SQ_R_EXT_CLI_NCR.CommandText  +
         ' and rcr.id_empresa in ('+VarToStr(Input[3])+') ';

    FIN_SQ_R_EXT_CLI_NCR.CommandText := FIN_SQ_R_EXT_CLI_NCR.CommandText  +
      '  order by rcr.id_credito ';

   Result := FIN_DP_R_EXT_CLI_NCR.Data;

   FIN_SQ_R_EXT_CLI_NCR.Close;
end;

function TSM.FIN_DP_R_EXT_CLI_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtCliPag, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRelFinExtCliPag := '';



    {
       Input[0] - Data ini
       Input[1] - Data fin
       Input[2] - Empresa
       Input[3] - Cliente
       Input[4] - Forma de pagamento
       Input[5] - Local de Ttulo
       Input[6] - Plano de Contas


    }

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Pagos
     enSqlRelFinExtCliPag :=
                             ' SELECT REC.num_parcela, REC.DTA_ORIGINAL,                                      '+
                             ' NFE.NUMERO AS INT_NUMNFE,                                                      '+
                             ' FPG.DESCRICAO AS INT_NOMEFPG,                                                  '+
                             ' cli.cob_endereco, cli.cob_bairro, cli.cob_cidade, cli.cob_estado,              '+
                             ' cli.cob_cep, cli.lim_saldo, cli.doc_cnpj_cpf,                                  '+
                             ' REP.DTA_PAGAMENTO,                                                             '+
                             ' REC.dta_vencimento,                                                            '+
                             ' REC.ID_CLIENTE,                                                                '+
                             ' REC.id_local_titulo,                                                           '+
                             ' REC.id_plano,                                                                  '+
                             ' CLI.NOME AS INT_NOMECLI,                                                       '+
                             ' REC.vlr_saldo,                                                                 '+
                             ' REC.vlr_original,                                                              '+
                             ' REP.VLR_PAGAMENTO as Vlr_pago,                                                 '+
                             ' (REP.DTA_PAGAMENTO -  REC.dta_vencimento) as INT_ATRASO,                       '+
                             ' REP.VLR_JUROS as INT_VLR_JUROS                                                 '+
                             '                                                                                '+
                             ' FROM FIN_TB_M_REC_PAG REP                                                      '+
                             ' LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO       = REP.ID_TITULO        '+
                             ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE      = REC.ID_CLIENTE       '+
                             ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = REP.ID_FORMA_PAG     '+
                             ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO  '+
                             ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = REP.ID_PLANO         '+
                             ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL       = REC.ID_FISCAL        '+
                             ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA  = REC.ID_EMPRESA       '+
                             ' where REP.dta_pagamento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
                             '   AND REP.dta_pagamento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ' ;

    CondicaoGroup := ' ';
    CondicaoOrder := ' ORDER BY REC.ID_CLIENTE, REP.DTA_PAGAMENTO, REP.VLR_PAGAMENTO ';

    FIN_SQ_R_EXT_CLI_PAG.Close;
    FIN_SQ_R_EXT_CLI_PAG.CommandText := '';
    FIN_SQ_R_EXT_CLI_PAG.CommandText := enSqlRelFinExtCliPag;

    if Input[2] <> '' then
        begin
           FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  +
               ' AND REC.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
        end;

     if Input[3] <> '' then
        begin
           FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  +
               ' AND REC.ID_CLIENTE in (' + VarToStr(Input[3]) +') ';
        end;


    if Input[4] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  +
               ' AND REP.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  +
               ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  +
               ' AND REP.ID_PLANO in (' + VarToStr(Input[6]) +') ';
        end;


   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_EXT_CLI_PAG.CommandText := FIN_SQ_R_EXT_CLI_PAG.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_EXT_CLI_PAG.Data;

   FIN_SQ_R_EXT_CLI_PAG.Close;
end;

function TSM.FIN_DP_R_EXT_CLI_RPCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtCliNcrRpc:string;
begin
  enSqlRelFinExtCliNcrRpc :=
  ' select '+
  ' rcr.id_cliente, '+
  ' cli.nome,       '+
  ' sum(case rcr.deb_cre '+
  '  when 0 then rcr.vlr_credito * -1  '+
  '  when 1 then rcr.vlr_credito       '+
  ' end) as saldo '+
  ' from fin_tb_m_rcr rcr '+
  ' left outer join cad_tb_c_cli cli on cli.id_cliente =  rcr.id_cliente ';

  FIN_SQ_R_EXT_CLI_RPC.Close;
  FIN_SQ_R_EXT_CLI_RPC.CommandText := enSqlRelFinExtCliNcrRpc;

  FIN_SQ_R_EXT_CLI_RPC.CommandText := FIN_SQ_R_EXT_CLI_RPC.CommandText  +
      ' where rcr.dta_credito >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])))+ ''' '+
      '  and rcr.dta_credito <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+ ''' ';

     if Input[2] <> '' then
      begin
        FIN_SQ_R_EXT_CLI_RPC.CommandText := FIN_SQ_R_EXT_CLI_RPC.CommandText  +
        '  and rcr.id_cliente = '''+VarToStr(Input[2])+''' ';
      end;

  FIN_SQ_R_EXT_CLI_RPC.CommandText := FIN_SQ_R_EXT_CLI_RPC.CommandText  +
      ' group by rcr.id_cliente, cli.nome  '+
      ' having sum(case rcr.deb_cre        '+
      '  when 0 then rcr.vlr_credito * -1  '+
      '  when 1 then rcr.vlr_credito end)  >0 '+
      ' order by cli.nome ';
  //CMServerForm.mm.Lines.Add(FIN_SQ_R_EXT_CLI_RPC.CommandText);
  Result := FIN_DP_R_EXT_CLI_RPC.Data;

  FIN_SQ_R_EXT_CLI_RPC.Close;
end;

function TSM.FIN_DP_R_EXT_FOR_ABEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtForAbe, CondicaoOrder,CondicaoGroup: String;
begin

    { TODO -oMaxsuel -cCriao : Mtodo criado em 14/04/2015 }

    enSqlRelFinExtForAbe := '';

    {
       Input[0] - Data ini
       Input[1] - Data fin
       Input[2] - Empresa
       Input[3] - Fornecedor
       Input[4] - Forma de pagamento
       Input[5] - Local de Ttulo
       Input[6] - Plano de Contas
       Input[7] - Centro de Custo

    }

    CondicaoOrder := '';
    CondicaoGroup := '';

    enSqlRelFinExtForAbe :=
       ' SELECT ' +
       ' PAG.num_parcela, NFE.NUMERO AS INT_NUMNFE, FPG.DESCRICAO AS INT_NOMEFPG,             ' +
       '        PAG.dta_emissao, PAG.dta_vencimento,                                          ' +
       '        PAG.ID_FORNECEDOR, PAG.id_local_titulo, PAG.id_plano, PAG.ID_OBRA,             ' +
       '        FRN.FANTASIA AS INT_NOMEFOR,                                                  ' +
       '        FRN.DOC_CNPJ || FRN.DOC_CPF AS DOC_CNPJ_CPF,                                                  ' +
       '   PAG.vlr_parcela,   PAG.vlr_original,(PAG.vlr_parcela-PAG.vlr_saldo) as Vlr_pago,   ' +
       ' (CURRENT_DATE -  PAG.dta_vencimento) as INT_ATRASO,                                  ' +
       '   CASE                                                                               ' +
       '     WHEN (CURRENT_DATE -  PAG.dta_vencimento)<=0 THEN PAG.vlr_saldo                  ' +
       '     WHEN (CURRENT_DATE -  PAG.dta_vencimento)>0  THEN PAG.vlr_saldo+(((PAG.vlr_saldo * PAG.per_juros)/100)/30) * (CURRENT_DATE -  PAG.dta_vencimento) ' +
       '   END as INT_VLR_restante,                                                                                                              ' +
       '   CASE                                                                                                                                  ' +
       '     WHEN (CURRENT_DATE -  PAG.dta_vencimento)<=0 THEN 0                                                                                 ' +
       '     WHEN (CURRENT_DATE -  PAG.dta_vencimento)>0  THEN (((PAG.vlr_saldo * PAG.per_juros)/100)/30) * (CURRENT_DATE -  PAG.dta_vencimento) ' +
       '   END as INT_VLR_JUROS                                                        ' +
       '                                                                               ' +
       ' FROM FIN_TB_M_PAG PAG                                                         ' +
       ' LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR   = PAG.ID_FORNECEDOR   ' +
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = PAG.ID_FORMA_PAG    ' +
       ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO ' +
       ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = PAG.ID_PLANO   ' +
       ' LEFT OUTER JOIN FAT_TB_M_NFE NFE ON NFE.ID_FISCAL       = PAG.ID_FISCAL  ' +
       ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA  = PAG.ID_EMPRESA ' +
       ' where PAG.vlr_saldo>0  ' +
       '   AND PAG.dta_vencimento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
       '   AND PAG.dta_vencimento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ';

    CondicaoGroup := ' ';
    CondicaoOrder := ' ORDER BY PAG.ID_FORNECEDOR, PAG.DTA_VENCIMENTO, PAG.VLR_SALDO ';

    FIN_SQ_R_EXT_FOR_ABE.Close;
    FIN_SQ_R_EXT_FOR_ABE.CommandText := '';
    FIN_SQ_R_EXT_FOR_ABE.CommandText := enSqlRelFinExtForAbe;

    if Input[2] <> '' then
        begin
           FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
        end;

     if Input[3] <> '' then
        begin
           FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_FORNECEDOR = ''' + VarToStr(Input[3]) +''' ';
        end;

    if Input[4] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_PLANO in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[7]) +') ';
        end;

     if Input[8] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  +
               ' AND PAG.ID_OBRA in (' + VarToStr(Input[8]) +') ';
        end;



   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_EXT_FOR_ABE.CommandText := FIN_SQ_R_EXT_FOR_ABE.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_EXT_FOR_ABE.Data;

   FIN_SQ_R_EXT_FOR_ABE.Close;
end;

function TSM.FIN_DP_R_EXT_FOR_ESTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlRelFinExiForEst:string;
begin
   enSqlRelFinExiForEst :=
       ' select "For".id_fornecedor,"For".lim_valor, '+

       ' (select coalesce(sum(pag.vlr_saldo),0) from fin_tb_m_pag pag '+
       '  where pag.id_fornecedor="For".id_fornecedor and pag.vlr_saldo>0) as vlr_total_tit_aberto, '+

       '  (select sum(pag.vlr_saldo) from fin_tb_m_pag pag where '+
       ' pag.id_fornecedor="For".id_fornecedor and '+
       ' pag.dta_vencimento<CURRENT_DATE and pag.vlr_saldo>0) as vlr_total_tit_vencido, '+

       ' (select COALESCE(sum(((pag.vlr_saldo*(COALESCE(CTR.tax_juros_mensal,0)/30)/100)* '+
       '       (CURRENT_DATE -  pag.dta_vencimento))),0) '+
       '   from fin_tb_m_pag pag                         '+
       '  left outer join cad_tb_c_par_ctr ctr on ctr.id_empresa=pag.id_empresa '+
       '  where pag.id_fornecedor="For".id_fornecedor and pag.dta_vencimento<CURRENT_DATE)  as vlr_total_tit_juros, '+


       ' (select COALESCE(sum(pag.vlr_saldo+((pag.vlr_saldo*(COALESCE(CTR.tax_juros_mensal,0)/30)/100)* '+
       '         (CURRENT_DATE -  pag.dta_vencimento))),0) from fin_tb_m_pag pag '+
       '  left outer join cad_tb_c_par_ctr ctr on ctr.id_empresa=pag.id_empresa '+
       '  where pag.id_fornecedor="For".id_fornecedor and  pag.dta_vencimento<CURRENT_DATE) as vlr_total_tit_corrigido, '+

       ' (select COALESCE(sum(pag.vlr_saldo),0) from fin_tb_m_pag pag where pag.id_fornecedor="For".id_fornecedor and '+
       ' pag.dta_vencimento>=CURRENT_DATE and pag.vlr_saldo>0) as vlr_total_tit_vencer, '+

       ' (select COALESCE(sum(pag.vlr_saldo),0) from fin_tb_m_pag pag '+
       '  left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=pag.id_forma_pag '+
       '  where pag.id_fornecedor="For".id_fornecedor and fpg.doc_impresso=6 and pag.vlr_saldo>0 ) as  vlr_che_aberto, '+

       ' (select COALESCE(sum(pag.vlr_parcela),0) from fin_tb_m_pag pag where pag.id_fornecedor="For".id_fornecedor and  pag.vlr_saldo=0) as vlr_total_tit_pagos, '+

       ' (select COALESCE(sum(nfe.vlr_liquido),0)  from fat_tb_m_nfe nfe '+
       '  LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO '+
       '   WHERE nfe.id_emitente="For".id_fornecedor and CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND '+
       '      NFE.FATURADA = true AND NFE.TIPO_NF=''S'')  as vlr_total_compras, '+

       '  (select COALESCE(sum(nfe.vlr_liquido),0)  from fat_tb_m_nfe nfe '+
       '  WHERE nfe.id_emitente="For".id_fornecedor and  NFE.STATUS = 1 AND                                        '+
       '      NFE.FATURADA = true AND NFE.TIPO_NF=''R'') as vlr_total_dev '+

       ' from cad_tb_c_for "For" ';

    FIN_SQ_R_EXT_FOR_EST.Close;
    FIN_SQ_R_EXT_FOR_EST.CommandText := enSqlRelFinExiForEst;


    FIN_SQ_R_EXT_FOR_EST.CommandText := FIN_SQ_R_EXT_FOR_EST.CommandText  +
      ' where "For".id_fornecedor = '''+VarToStr(Input[0])+''' ';

   Result := FIN_DP_R_EXT_FOR_EST.Data;

   FIN_SQ_R_EXT_FOR_EST.Close;
end;

function TSM.FIN_DP_R_EXT_FOR_NCRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtForNcr:string;
begin
  enSqlRelFinExtForNcr :=
        ' SELECT PCR.ID_EMPRESA,PCR.ID_CREDITO,PCR.DTA_CREDITO,PCR.ID_FORNECEDOR,"FOR".DESCRICAO AS INT_NOMEFOR,PCR.HISTORICO, '+

        ' CAST (CASE PCR.ORIGEM '+
        '    WHEN 0 THEN ''Manual'' '+
        '    WHEN 1 THEN ''Baixa de Conta a Pagar'' '+
        '    WHEN 2 THEN ''Devoluo ao Fornecedor'' '+
        '    WHEN 3 THEN ''Nota Fiscal de Compra'' '+
        '  END AS VARCHAR(30)) AS INT_DESCORIGEM, '+

        ' (COALESCE((SELECT SUM(COALESCE(PCC.VLR_CREDITO,0)) FROM FIN_TB_M_PCR PCC '+
        '   WHERE PCC.ID_FORNECEDOR=PCR.ID_FORNECEDOR AND PCC.DEB_CRE = 1 AND PCC.ID_CREDITO < PCR.ID_CREDITO ),0) - '+
        '  COALESCE((SELECT SUM(COALESCE(PCC.VLR_CREDITO,0)) FROM FIN_TB_M_PCR PCC  '+
        '   WHERE PCC.ID_FORNECEDOR=PCR.ID_FORNECEDOR AND PCC.DEB_CRE = 0 AND PCC.ID_CREDITO < PCR.ID_CREDITO ),0)) '+
        '  AS SALDO_ANTERIOR, '+

        ' CAST (CASE PCR.DEB_CRE '+
        '    WHEN 0 THEN 0 '+
        '    WHEN 1 THEN PCR.VLR_CREDITO '+
        '  END AS NUMERIC(18,4)) AS ENTRADA, '+

        ' CAST (CASE PCR.DEB_CRE '+
        '    WHEN 0 THEN PCR.VLR_CREDITO '+
        '    WHEN 1 THEN 0 '+
        '  END AS NUMERIC(18,4)) AS SAIDA '+

        ' FROM FIN_TB_M_PCR PCR '+
        ' LEFT OUTER JOIN CAD_TB_C_FOR "FOR" ON "FOR".ID_FORNECEDOR=PCR.ID_FORNECEDOR ';


    FIN_SQ_R_EXT_FOR_NCR.Close;
    FIN_SQ_R_EXT_FOR_NCR.CommandText := enSqlRelFinExtForNcr;


    FIN_SQ_R_EXT_FOR_NCR.CommandText := FIN_SQ_R_EXT_FOR_NCR.CommandText  +
      ' where pcr.dta_credito >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])))+ ''' '+
      '  and pcr.dta_credito <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])))+ ''' '+
      '  and pcr.id_fornecedor = '''+VarToStr(Input[2])+''' ';

    if VarToStr(Input[3])<>'' then
       FIN_SQ_R_EXT_FOR_NCR.CommandText := FIN_SQ_R_EXT_FOR_NCR.CommandText  +
         ' and pcr.id_empresa in ('+VarToStr(Input[3])+') ';

    FIN_SQ_R_EXT_FOR_NCR.CommandText := FIN_SQ_R_EXT_FOR_NCR.CommandText  +
         '  order by pcr.id_credito ';
   //CMServerForm.mm.Lines.Add(FIN_SQ_R_EXT_FOR_NCR.CommandText);
   Result := FIN_DP_R_EXT_FOR_NCR.Data;

   FIN_SQ_R_EXT_FOR_NCR.Close;

end;

function TSM.FIN_DP_R_EXT_FOR_PAGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelFinExtForPag, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlRelFinExtForPag := '';

    {
       Input[0] - Data ini
       Input[1] - Data fin
       Input[2] - Empresa
       Input[3] - Fornecedor
       Input[4] - Forma de pagamento
       Input[5] - Local de Ttulo
       Input[6] - Plano de Contas
       Input[7] - Centro de Custo
    }

    CondicaoOrder := '';
    CondicaoGroup := '';


     // Pagos
     enSqlRelFinExtForPag :=
                             ' SELECT PAG.num_parcela,                                           ' +
                             '        NFE.NUMERO AS INT_NUMNFE,                                  ' +
                             '        FPG.DESCRICAO AS INT_NOMEFPG,                              ' +
                             '        FRN.doc_cnpj ||  FRN.doc_cpf AS DOC_CNPJ_CPF,              ' +
                             '        PGT.DTA_PAGAMENTO,                                         ' +
                             '        PAG.dta_vencimento,                                        ' +
                             '        PAG.ID_FORNECEDOR,                                         ' +
                             '        PAG.id_local_titulo,                                       ' +
                             '        PAG.id_plano,                                              ' +
                             '        FRN.FANTASIA AS INT_NOMEFOR,                               ' +
                             '        PAG.vlr_saldo,                                             ' +
                             '        PAG.vlr_original,                                          ' +
                             '        PGT.VLR_PAGAMENTO as Vlr_pago,                             ' +
                             '        (PGT.DTA_PAGAMENTO -  PAG.dta_vencimento) as INT_ATRASO,   ' +
                             '        PGT.VLR_JUROS as INT_VLR_JUROS,                             ' +
                             '        PAG.ID_OBRA AS INT_ID_OBRA                                 ' +
                             '   FROM FIN_TB_M_PAG_PAG PGT                                         ' +
                             '   LEFT OUTER JOIN FIN_TB_M_PAG PAG     ON PAG.ID_TITULO       = PGT.ID_TITULO        ' +
                             '   LEFT OUTER JOIN CAD_TB_C_FOR FRN     ON FRN.ID_FORNECEDOR   = PAG.ID_FORNECEDOR    ' +
                             '   LEFT OUTER JOIN CAD_TB_C_FPG FPG     ON FPG.ID_FORMA_PAG    = PGT.ID_FORMA_PAG     ' +
                             '   LEFT OUTER JOIN CAD_TB_C_LTO LTO     ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO  ' +
                             '   LEFT OUTER JOIN CAD_TB_C_PCT PCT     ON PCT.ID_PLANO        = PGT.ID_PLANO         ' +
                             '   LEFT OUTER JOIN FAT_TB_M_NFE NFE     ON NFE.ID_FISCAL       = PAG.ID_FISCAL        ' +
                             '   LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA      = PAG.ID_EMPRESA       ' +
                             ' where PGT.dta_pagamento >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) + ''' ' +
                             '   AND PGT.dta_pagamento <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) + ''' ' ;

    CondicaoGroup := ' ';
    CondicaoOrder := ' ORDER BY PAG.ID_FORNECEDOR, PGT.DTA_PAGAMENTO, PGT.VLR_PAGAMENTO ';

    FIN_SQ_R_EXT_FOR_PAG.Close;
    FIN_SQ_R_EXT_FOR_PAG.CommandText := '';
    FIN_SQ_R_EXT_FOR_PAG.CommandText := enSqlRelFinExtForPag;

    if Input[2] <> '' then
        begin
           FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
        end;

     if Input[3] <> '' then
        begin
           FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[3]) +') ';
        end;


    if Input[4] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PGT.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[5]) +') ';
        end;

    if Input[6] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PGT.ID_PLANO in (' + VarToStr(Input[6]) +') ';
        end;

    if Input[7] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PGT.ID_CCUSTO in (' + VarToStr(Input[7]) +') ';
        end;
     if Input[8] <> '' then
        begin
          FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  +
               ' AND PAG.ID_OBRA in (' + VarToStr(Input[8]) +') ';
        end;

   if CondicaoGroup <> '' then
      begin
        FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder <> '' then
      begin
        FIN_SQ_R_EXT_FOR_PAG.CommandText := FIN_SQ_R_EXT_FOR_PAG.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_EXT_FOR_PAG.Data;

   FIN_SQ_R_EXT_FOR_PAG.Close;
end;

function TSM.FIN_DP_R_INDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
VAR
  sql:string;
  mes:integer;
  Mes_extenso: Array [1..12] of string;
begin
  { TODO -oLuan : Criado no dia 16/12/2015 }
  Mes_extenso[01] := 'JANEIRO';
  Mes_extenso[02] := 'FEVEREIRO';
  Mes_extenso[03] := 'MARCO';
  Mes_extenso[04] := 'ABRIL';
  Mes_extenso[05] := 'MAIO';
  Mes_extenso[06] := 'JUNHO';
  Mes_extenso[07] := 'JULHO';
  Mes_extenso[08] := 'AGOSTO';
  Mes_extenso[09] := 'SETEMBRO';
  Mes_extenso[10] := 'OUTUBRO';
  Mes_extenso[11] := 'NOVEMBRO';
  Mes_extenso[12] := 'DEZEMBRO';

  mes := 1;
  sql := ' select PAR.ID_EMPRESA,PAR.EMP_FANTASIA, ';
  while (mes<13) do
    begin
      if (mes<>12) then
        begin
        sql := sql +
       ' COALESCE((SELECT SUM(COALESCE(REC.VLR_PARCELA,0)+ '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_JUROS,0))-SUM(COALESCE(PAG.VLR_DESCONTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND PAG.COM_SUBSTITUICAO = true '+
       ' AND FPG.DOC_IMPRESSO <> 4),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND FPG.DOC_IMPRESSO = 4),0)) '+
       ' FROM FIN_TB_M_REC REC '+
       ' WHERE EXTRACT(YEAR FROM REC.DTA_VENCIMENTO)  = '+ VarToStr(Input[0])+
       ' AND  EXTRACT(MONTH FROM REC.DTA_VENCIMENTO) = '+inttostr(mes)+
       ' AND REC.ID_EMPRESA = par.ID_EMPRESA),0) as REC_'+Mes_extenso[mes]+', '+
       ' COALESCE((SELECT SUM((COALESCE(REC.VLR_PARCELA,0)+ '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_JUROS,0))-SUM(COALESCE(PAG.VLR_DESCONTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' WHERE (REC.ID_TITULO = PAG.ID_TITULO)),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE (REC.ID_TITULO = PAG.ID_TITULO) '+
       ' AND PAG.COM_SUBSTITUICAO = true '+
       ' AND FPG.DOC_IMPRESSO <> 4),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND FPG.DOC_IMPRESSO = 4),0)) - ' +
       ' COALESCE(rec.vlr_saldo,0)) '+
       ' FROM FIN_TB_M_REC REC '+
       ' WHERE EXTRACT(YEAR FROM REC.DTA_VENCIMENTO)  = '+ VarToStr(Input[0])+
       ' AND  EXTRACT(MONTH FROM REC.DTA_VENCIMENTO) = '+inttostr(mes)+
       ' AND REC.ID_EMPRESA = par.ID_EMPRESA),0) AS PAG_'+Mes_extenso[mes]+', ';
        end
      else
        begin
        sql := sql +
       ' COALESCE((SELECT SUM(COALESCE(REC.VLR_PARCELA,0)+ '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_JUROS,0))-SUM(COALESCE(PAG.VLR_DESCONTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND PAG.COM_SUBSTITUICAO = true '+
       ' AND FPG.DOC_IMPRESSO <> 4),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND FPG.DOC_IMPRESSO = 4),0)) '+
       ' FROM FIN_TB_M_REC REC '+
       ' WHERE EXTRACT(YEAR FROM REC.DTA_VENCIMENTO)  = '+ VarToStr(Input[0])+
       ' AND  EXTRACT(MONTH FROM REC.DTA_VENCIMENTO) = '+inttostr(mes)+
       ' AND REC.ID_EMPRESA = par.ID_EMPRESA),0) as REC_'+Mes_extenso[mes]+', '+
       ' COALESCE((SELECT SUM((COALESCE(REC.VLR_PARCELA,0)+ '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_JUROS,0))-SUM(COALESCE(PAG.VLR_DESCONTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' WHERE (REC.ID_TITULO = PAG.ID_TITULO)),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE (REC.ID_TITULO = PAG.ID_TITULO) '+
       ' AND PAG.COM_SUBSTITUICAO = true '+
       ' AND FPG.DOC_IMPRESSO <> 4),0) - '+
       ' COALESCE((SELECT SUM(COALESCE(PAG.VLR_PAGAMENTO,0)) FROM FIN_TB_M_REC_PAG PAG '+
       ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON (FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG) '+
       ' WHERE REC.ID_TITULO = PAG.ID_TITULO '+
       ' AND FPG.DOC_IMPRESSO = 4),0)) - ' +
       ' COALESCE(rec.vlr_saldo,0)) '+
       ' FROM FIN_TB_M_REC REC '+
       ' WHERE EXTRACT(YEAR FROM REC.DTA_VENCIMENTO)  = '+ VarToStr(Input[0])+
       ' AND  EXTRACT(MONTH FROM REC.DTA_VENCIMENTO) = '+inttostr(mes)+
       ' AND REC.ID_EMPRESA = par.ID_EMPRESA),0) AS PAG_'+Mes_extenso[mes];
        end;
      mes := mes + 1;
    end;
   sql := sql + ' FROM CAD_TB_C_PAR PAR ';
   if VarToStr(Input[1])<>'' then
     begin
        sql := sql + ' where par.id_empresa in ('+VarToStr(Input[1])+')';
     end;

   sql := sql +' ORDER BY PAR.ID_EMPRESA ';

   BUS_SQ_R_IND.CommandText := sql;

   Result := FIN_DP_R_IND.Data;
   BUS_SQ_R_IND.Close;

end;

function TSM.FIN_DP_R_LMF_EXTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelLmfExt: string;
begin
  { TODO -oLuan : Criado no dia 05/01/2017 }
  enSqlRelLmfExt :=
     ' select fun.id_funcionario,fun.nome as int_nomefun,lmf.id_empresa,par.emp_razao as int_emprazao,  '+
     ' lmf.id_lmf,lmf.dta_movimento,lmf.id_tipo_financeiro,tif.descricao as int_nometif, '+
     ' lmf.id_conta,ctc.descricao as int_nomectc,lmf.historico,                          '+

     ' (case cta.deb_cre                                                                 '+
     '  when 0 then cta.vlr_lancamento                                                   '+
     ' else 0 end)   as saida,                                                           '+

     ' (case cta.deb_cre                                                                 '+
     '  when 1 then cta.vlr_lancamento                                                   '+
     ' else 0 end)   as entrada,                                                         '+


     ' (select coalesce(sum((case cta2.deb_cre                                                    '+
     ' when 1 then cta2.vlr_lancamento                                                            '+
     ' else 0 end) - (case cta2.deb_cre                                                           '+
     ' when 0 then cta2.vlr_lancamento                                                            '+
     ' else 0 end)),0)  from fin_tb_m_cta cta2                                                    '+
     ' left outer join fin_tb_m_lmf lmf2 on lmf2.id_lmf=cta2.id_lmf                               '+
     ' where cta2.id_lmf>0                                                                        '+
     ' and lmf2.id_lmf<lmf.id_lmf and lmf2.id_funcionario=fun.id_funcionario                      ';



     if Input[3]<>'' then
      begin
         enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.status in ('+VarToStr(Input[3])+') ';
      end;

    if Input[4]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_empresa in ('+VarToStr(Input[4])+') ';
       end;



    if Input[6]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_plano in ('+VarToStr(Input[6])+') ';
       end;

    if Input[7]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_tipo_financeiro in ('+VarToStr(Input[7])+') ';
       end;

    if Input[8]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_conta in ('+VarToStr(Input[8])+') ';
       end;

    enSqlRelLmfExt := enSqlRelLmfExt  +

     ' ) as saldo_anterior, '+
     ' (select coalesce(sum((case cta2.deb_cre                                                       '+
     '  when 1 then cta2.vlr_lancamento                                                              '+
     '  else 0 end) - (case cta2.deb_cre                                                             '+
     '  when 0 then cta2.vlr_lancamento                                                              '+
     '  else 0 end)),0)  from fin_tb_m_cta cta2                                                      '+
     ' left outer join fin_tb_m_lmf lmf2 on lmf2.id_lmf=cta2.id_lmf                                  '+
     ' where cta2.id_lmf>0 and                                                                       '+
     ' lmf2.dta_movimento<'''+FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+'''       '+
     ' and lmf2.id_funcionario=fun.id_funcionario                                                    ';



    if Input[3]<>'' then
      begin
         enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.status in ('+VarToStr(Input[3])+') ';
      end;

    if Input[4]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_empresa in ('+VarToStr(Input[4])+') ';
       end;



    if Input[6]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_plano in ('+VarToStr(Input[6])+') ';
       end;

    if Input[7]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_tipo_financeiro in ('+VarToStr(Input[7])+') ';
       end;

    if Input[8]<>'' then
       begin
          enSqlRelLmfExt := enSqlRelLmfExt  +
                              ' AND lmf2.id_conta in ('+VarToStr(Input[8])+') ';
       end;

    enSqlRelLmfExt := enSqlRelLmfExt  +
     ' ) as saldo_ant_per '+

     ' from cad_tb_c_fun fun                                                                         '+
     ' left outer join fin_tb_m_lmf lmf on lmf.id_funcionario=fun.id_funcionario                     '+
     ' left outer join fin_tb_m_cta cta on cta.id_lmf=lmf.id_lmf                                     '+
     ' left outer join cad_tb_c_tif tif on tif.id_tipo_financeiro=lmf.id_tipo_financeiro             '+
     ' left outer join cad_tb_c_ctc ctc on ctc.id_conta=lmf.id_conta                                 '+
     ' left outer join cad_tb_c_par par on par.id_empresa=lmf.id_empresa                             '+
     '  where cta.id_lmf>0  ';




    FIN_SQ_R_LMF_EXT.Close;
    FIN_SQ_R_LMF_EXT.CommandText := '';
    FIN_SQ_R_LMF_EXT.CommandText := enSqlRelLmfExt;

    FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
          ' and lmf.dta_movimento >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
          '  and lmf.dta_movimento <='''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+ ''' ';

    if Input[3]<>'' then
      begin
         FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.status in ('+VarToStr(Input[3])+') ';
      end;

    if Input[4]<>'' then
       begin
          FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.id_empresa in ('+VarToStr(Input[4])+') ';
       end;

    if Input[5]<>'' then
       begin
          FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.id_funcionario in ('+VarToStr(Input[5])+') ';
       end;

    if Input[6]<>'' then
       begin
          FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.id_plano in ('+VarToStr(Input[6])+') ';
       end;

    if Input[7]<>'' then
       begin
          FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.id_tipo_financeiro in ('+VarToStr(Input[7])+') ';
       end;

    if Input[8]<>'' then
       begin
          FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
                              ' AND lmf.id_conta in ('+VarToStr(Input[8])+') ';
       end;

   FIN_SQ_R_LMF_EXT.CommandText := FIN_SQ_R_LMF_EXT.CommandText  +
    ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14 '+
    ' order by fun.id_funcionario,lmf.id_lmf    ';



   Result := FIN_DP_R_LMF_EXT.Data;

   FIN_SQ_R_LMF_EXT.Close;
end;

function TSM.FIN_DP_R_LMF_MOVDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelLmfMov: string;
begin
  { TODO -oLuan : Criado no dia 05/01/2017 }
  enSqlRelLmfMov :=
         ' select lmf.*,                       '+
         ' PAR.emp_razao as int_emprazao,      '+
         ' fun.nome as int_nomefun,            '+
         ' tif.descricao as int_nometif,       '+
         ' ctc.descricao as int_nomectc,       '+
         ' pct.descricao as int_nomepct        '+

        ' from fin_tb_m_lmf lmf                '+
        ' left outer join cad_tb_c_fun fun on fun.id_funcionario=lmf.id_funcionario          '+
        ' left outer join cad_tb_c_tif tif on tif.id_tipo_financeiro=lmf.id_tipo_financeiro  '+
        ' left outer join cad_tb_c_ctc ctc on ctc.id_conta=lmf.id_conta                      '+
        ' left outer join cad_tb_c_pct pct on pct.id_plano=lmf.id_plano                      '+
        ' left outer join cad_tb_c_par par on par.id_empresa=lmf.id_empresa                  ';



    FIN_SQ_R_LMF_MOV.Close;
    FIN_SQ_R_LMF_MOV.CommandText := '';
    FIN_SQ_R_LMF_MOV.CommandText := enSqlRelLmfMov;

    FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
          ' WHERE lmf.dta_movimento >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
          '  and lmf.dta_movimento <='''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) )+ ''' ';

    if Input[3]<>'' then
      begin
         FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND lmf.status in ('+VarToStr(Input[3])+') ';
      end;

    if Input[4]<>'' then
       begin
          FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND par.id_empresa in ('+VarToStr(Input[4])+') ';
       end;

    if Input[5]<>'' then
       begin
          FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND lmf.id_funcionario in ('+VarToStr(Input[5])+') ';
       end;

    if Input[6]<>'' then
       begin
          FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND lmf.id_plano in ('+VarToStr(Input[6])+') ';
       end;

    if Input[7]<>'' then
       begin
          FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND lmf.id_tipo_financeiro in ('+VarToStr(Input[7])+') ';
       end;

    if Input[8]<>'' then
       begin
          FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
                              ' AND lmf.id_conta in ('+VarToStr(Input[8])+') ';
       end;

   FIN_SQ_R_LMF_MOV.CommandText := FIN_SQ_R_LMF_MOV.CommandText  +
     ' order by lmf.id_empresa,int_nomefun,lmf.id_lmf ';


   Result := FIN_DP_R_LMF_MOV.Data;

   FIN_SQ_R_LMF_MOV.Close;
end;

function TSM.FIN_DP_R_MCHDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;

function enSqlRelMch: String;
  begin
    Result :=
        ' select mch.*, mche.*,vlt.tot_movimento,vlt.tot_ger_movimento,vlt.tot_juros, '+
        '         cli.nome as int_nomecli,    '+
        ' rec.*, hch.situacao_chq,            '+
        '   par.emp_fantasia as int_nomeemp, '+
        '   ctc.banco as int_bancoctc,       '+
        '   ctc.agencia as int_agenciactc,   '+
        '   ctc.conta_corrente as int_contcorrctc, '+
        '   ctc.descricao as int_nomectc,    '+
        '  cast(  case mch.operacao          '+
        '      when 1  then ''Depositar''    '+
        '      when 2 then ''Devolver''      '+
        '      when 3 then ''Pagar parcial'' '+
        '      when 4 then ''Resgatar''     '+
        '   end as varchar(20) ) as int_operacao, '+
        '   fci.nome as int_nomefun,              '+
        '  cast(  case hch.situacao_chq             '+
        '      when 1  then ''Em aberto''           '+
        '      when 2 then ''Depositado''           '+
        '      when 3 then ''Devolvido''            '+
       '       when 4 then ''Parcial''              '+
       '       when 5 then ''Resgatado''            '+
       '    end as varchar(20) ) as int_situacao  '+
       '   from fin_tb_m_mch_che mche             '+
       '      left outer join fin_tb_m_mch mch on  '+
       '          (mch.id_controle = mche.id_controle) '+
       '      left outer join fin_tb_m_rec rec on      '+
       '          (rec.id_titulo = mche.id_titulo)     '+
       '      left outer join fin_tb_m_rec_hch hch on  '+
       '          (hch.id_titulo = mche.id_titulo and  '+
       '            hch.id_mch = mche.id_controle)    '+
       '      left outer join cad_tb_c_cli cli on     '+
       '          (cli.id_cliente = rec.id_cliente)   '+
       '       left outer join cad_tb_c_ctc ctc on    '+
       '           (mch.id_conta = ctc.id_conta)      '+
       '      left outer join cad_tb_c_fun fci on     '+
       '         (fci.id_funcionario = mch.id_responsavel) '+
       '      left outer join cad_tb_c_par par on ' +
       '         (par.id_empresa = mch.id_empresa) '+
       '      left outer join tb_vlr_total vlt on ' +
       '         (vlt.id_empresa = par.id_empresa) ';

end;
  begin

  { TODO -oMaxsuel -cCriao :
   Criado em 13/07/2015

  Mtodo responsvel pela gerao de dados para
  o relatrio de Movimentao de cheque. }

   {Inputs:
       input[0] - Data ini
       input[1] - Data fin
       input[2] - IdTitulo
       input[3] - Nro do chque
       input[4] - Empresa
       input[5] - Cliente
   }

   FIN_SQ_R_MCH.Close;

   FIN_SQ_R_MCH.CommandText :=
            ' with tb_vlr_total '+
            ' as  ( with tb_vlr_total_por_mch as (select DISTINCT ON (mch.id_controle) mch.id_controle, mch.id_empresa,mch.vlr_movimento, '+
            '          mch.vlr_tot_movimento, mch.vlr_tot_juros '+
            ' from fin_tb_m_mch_che mche '+
            ' left outer join fin_tb_m_mch mch on mch.id_controle = mche.id_controle '+
            ' left outer join fin_tb_m_rec rec on rec.id_titulo = mche.id_titulo '+
            ' WHERE MCH.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
            '    MCH.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

    if Input[2] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and mche.id_titulo in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and rec.che_cheque in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and mch.id_empresa in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and rec.id_cliente in (' + VarToStr(Input[5]) +') ';
      end;


    FIN_SQ_R_MCH.CommandText :=  FIN_SQ_R_MCH.CommandText +
            ' )select vmch.id_empresa, sum(vmch.vlr_movimento) as tot_movimento, '+
            '  sum(vmch.vlr_tot_movimento) as tot_ger_movimento,sum(vmch.vlr_tot_juros) as tot_juros from tb_vlr_total_por_mch vmch '+
            '                   group by vmch.id_empresa) ';




   FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText + enSqlRelMch +
     ' WHERE MCH.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
     '       MCH.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and mche.id_titulo in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and rec.che_cheque in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and mch.id_empresa in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText  +
              ' and rec.id_cliente in (' + VarToStr(Input[5]) +') ';
      end;

   FIN_SQ_R_MCH.CommandText := FIN_SQ_R_MCH.CommandText +
                               ' order by mch.id_empresa, mch.id_controle, mch.dta_movimento, rec.dta_vencimento ';
   Result := FIN_DP_R_MCH.Data;
   FIN_SQ_R_MCH.Close;
end;

function TSM.FIN_DP_R_CXA_DIA_MOPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaMop, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaMop := '';

    //  Input[0] Relatrio
                  // 00-Caixa dirio
                  // 01-Movimentao por operao
                  // 02-Movimento por Plano de Conta

    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Empresa
    //  Input[4]  Operador
    //  Input[5]  Conta Corrente
    //  Input[6]  Plano de Contas
    //  Input[7]  Tipo Financeiro

    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[0] = 1)  then
       begin
         enSqlCxaDiaMop :=
            ' SELECT CTA.DEB_CRE,' +
            '  CTA.DTA_MOVIMENTO, CTA.NUM_DOC, TIF.SIGLA, CTA.ID_PLANO, CTA.ID_TIPO_FINANCEIRO, CTA.HISTORICO, ' +
            '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_CREDITODIA, ' +
            '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_DEBITODIA,  ' +
            '  COALESCE(SUM(CTA.VLR_LANCAMENTO * (CASE WHEN CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0) VLR_SALDODIA, ' +
            '  (SELECT COALESCE(SUM(I_CTA.VLR_LANCAMENTO * (CASE WHEN I_CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0)   ' +
            '   FROM  FIN_TB_M_CTA I_CTA                                                                         ' +
            '   WHERE I_CTA.DTA_MOVIMENTO <= CTA.DTA_MOVIMENTO order by CTA.DTA_MOVIMENTO  ) VLR_ACUMULADO       ' +
            ' FROM FIN_TB_M_CTA CTA                                                                              ' +
            ' LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO                    ' +
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO                                        ' +
            ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA= CTA.ID_ABERTURA                                   ' +
            ' WHERE CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
            '       CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
            '       CTA.TIPO_LANCAMENTO = 0 ';
            CondicaoGroup := ' GROUP BY 1,2,3,4,5,6,7';
            CondicaoOrder := ' ORDER BY CTA.DEB_CRE, CTA.DTA_MOVIMENTO';
       end;


  FIN_SQ_R_CXA_DIA_MOP.Close;
  FIN_SQ_R_CXA_DIA_MOP.CommandText := '';
  FIN_SQ_R_CXA_DIA_MOP.CommandText := enSqlCxaDiaMop;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CTA.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ';
      end;

  if Input[5] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CTA.ID_CONTA = ''' + VarToStr(Input[5]) +''' ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CTA.ID_PLANO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CTA.ID_TIPO_FINANCEIRO in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  +
             ' AND CTA.ID_OBRA = ''' + VarToStr(Input[8]) +''' ';
      end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MOP.CommandText := FIN_SQ_R_CXA_DIA_MOP.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_MOP.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_MPLDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaMpl, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaMpl := '';

    //  Input[0] Relatrio
                  // 00-Caixa dirio
                  // 01-Movimentao por operao
                  // 02-Movimento por Plano de Conta

    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Empresa
    //  Input[4]  Operador
    //  Input[5]  Conta Corrente
    //  Input[6]  Plano de Contas
    //  Input[7]  Tipo Financeiro

    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[0] = 2)  then
       begin
         enSqlCxaDiaMpl :=
            ' SELECT PCT.DESCRICAO AS INT_NOMEPCT,CTA.ID_PLANO,' +
            '  CTA.DTA_MOVIMENTO, CTA.NUM_DOC, TIF.SIGLA, CTA.ID_TIPO_FINANCEIRO, CTA.HISTORICO, ' +
            '  CTA.DEB_CRE, ' +
            '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_CREDITODIA, ' +
            '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_DEBITODIA,  ' +
            '  COALESCE(SUM(CTA.VLR_LANCAMENTO * (CASE WHEN CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0) VLR_SALDODIA, ' +
            '  (SELECT COALESCE(SUM(I_CTA.VLR_LANCAMENTO * (CASE WHEN I_CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0)   ' +
            '   FROM  FIN_TB_M_CTA I_CTA                                                                         ' +
            '   WHERE I_CTA.DTA_MOVIMENTO <= CTA.DTA_MOVIMENTO order by CTA.DTA_MOVIMENTO  ) VLR_ACUMULADO       ' +
            ' FROM FIN_TB_M_CTA CTA                                                                              ' +
            ' LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO                    ' +
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO                                        ' +
            ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA= CTA.ID_ABERTURA                                   ' +
            ' WHERE CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
            '       CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
            '       CTA.TIPO_LANCAMENTO = 0 ';

            CondicaoGroup := ' GROUP BY 1,2,3,4,5,6,7,8';
            CondicaoOrder := ' ORDER BY 1,2,3,4,5,6,7,8';
       end;


  FIN_SQ_R_CXA_DIA_MPL.Close;
  FIN_SQ_R_CXA_DIA_MPL.CommandText := '';
  FIN_SQ_R_CXA_DIA_MPL.CommandText := enSqlCxaDiaMpl;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CTA.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ';
      end;

  if Input[5] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CTA.ID_CONTA = ''' + VarToStr(Input[5]) +''' ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CTA.ID_PLANO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CTA.ID_TIPO_FINANCEIRO in (' + VarToStr(Input[7]) +') ';
      end;
  if Input[8] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  +
             ' AND CTA.ID_OBRA = ''' + VarToStr(Input[8]) +''' ';
      end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MPL.CommandText := FIN_SQ_R_CXA_DIA_MPL.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_MPL.Data;
end;



function TSM.FIN_DP_R_CXA_DIA_MTFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCxaDiaMtf, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaMtf := '';

    //  Input[0] Relatrio
                  // 00-Caixa dirio

    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Empresa
    //  Input[4]  Operador
    //  Input[5]  Conta Corrente
    //  Input[6]  Plano de Contas
    //  Input[7]  Tipo Financeiro

    CondicaoOrder := '';
    CondicaoGroup := '';

    if (Input[0] = 0)  then
       begin
         enSqlCxaDiaMtf :=
          ' SELECT CTA.ID_TIPO_FINANCEIRO, TIF.DESCRICAO AS INT_NOMETIF,                                  '+
          '    COALESCE(SUM(CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_CREDITO,  '+
          '    COALESCE(SUM(CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_DEBITO    '+
          '   FROM FIN_TB_M_CTA CTA                                                                       '+
          '   LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO         '+
          '   LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO                             '+
          '   LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA= CTA.ID_ABERTURA                        '+
          '   WHERE CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND  '+
          '         CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND  '+
          '         CTA.TIPO_LANCAMENTO = 0                                                               ';

         CondicaoGroup := '  GROUP BY 1,2 ';
         CondicaoOrder := ' ORDER BY INT_NOMETIF,CTA.ID_TIPO_FINANCEIRO ';
       end;


  FIN_SQ_R_CXA_DIA_MTF.Close;
  FIN_SQ_R_CXA_DIA_MTF.CommandText := '';
  FIN_SQ_R_CXA_DIA_MTF.CommandText := enSqlCxaDiaMtf;

   if Input[3] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CTA.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ';
      end;

  if Input[5] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CTA.ID_CONTA = ''' + VarToStr(Input[5]) +''' ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CTA.ID_PLANO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CTA.ID_TIPO_FINANCEIRO in (' + VarToStr(Input[7]) +') ';
      end;
  if Input[8] <> '' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  +
             ' AND CTA.ID_OBRA = ''' + VarToStr(Input[8]) +''' ';
      end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_MTF.CommandText := FIN_SQ_R_CXA_DIA_MTF.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_CXA_DIA_MTF.Data;
end;

function TSM.FIN_DP_R_CXA_DIA_NFTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlCxaDiaNft, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaNft := '';
    CondicaoOrder  := '';
    CondicaoGroup  := '';

    if (Input[0] = 0)  then
       begin
         enSqlCxaDiaNft :=
           ' select nfe.*,cli.nome as int_nomecli,cpg.descricao as int_nomecpg,tme.descricao as int_nometme, '+
           '   cast (case nfe.nfe_cod_sit ' +
           '   when ''00'' then ''Documento regular'' ' +
           '   when ''01'' then ''Escriturao extempornea de documento regular'' ' +
           '   when ''02'' then ''Documento cancelado'' ' +
           '   when ''03'' then ''Escriturao extempornea de documento cancelado'' ' +
           '   when ''04'' then ''NF-e denegada ou CT-e denegado'' ' +
           '   when ''05'' then ''NF-e ou CT-e com numerao inutilizada'' ' +
           '   when ''06'' then ''Documento fiscal complementar'' ' +
           '   when ''07'' then ''Escriturao extempornea de documento complementar'' ' +
           '   when ''08'' then ''Documento fiscal emitido com base em regime especial ou norma especfica'' ' +
           '  end as varchar(80) ) as int_descnfecodsit ' +
           ' from fat_tb_m_nfe nfe '+
           ' left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente '+
           ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA=NFE.ID_ABERTURA '+
           ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=nfe.id_condicao_pag '+
           ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=nfe.ID_TIPO_MOV_ESTOQUE '+
           ' where nfe.tipo_nf=''S'' and nfe.faturada=true ';
       end;

    CondicaoOrder := ' ORDER BY NFE.NFE_COD_SIT,NFE.DTA_EMISSAO ';

    FIN_SQ_R_CXA_DIA_NFT.Close;
    FIN_SQ_R_CXA_DIA_NFT.CommandText := '';
    FIN_SQ_R_CXA_DIA_NFT.CommandText := enSqlCxaDiaNft;


    if Input[1] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  +
               ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  +
              ' AND   NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
              '       NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';


    if Input[4] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  +
               ' AND CXA.ID_FUNCIONARIO = ''' + VarToStr(Input[4]) +''' ';
        end;

    if Input[5] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  +
               ' AND CXA.ID_CONTA = ''' + VarToStr(Input[5]) +''' ';
        end;


   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_NFT.CommandText := FIN_SQ_R_CXA_DIA_NFT.CommandText  + CondicaoOrder;
      end;

    Result := FIN_DP_R_CXA_DIA_NFT.Data;

end;

function TSM.FIN_DP_R_CXA_DIA_NPDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
   enSqlCxaDiaNpd, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlCxaDiaNpd := '';
    CondicaoOrder  := '';
    CondicaoGroup  := '';

    if (Input[0] = 0)  then
       begin
         enSqlCxaDiaNpd :=
            ' select nfe.*,cli.nome as int_nomecli,cpg.descricao as int_nomecpg,tme.descricao as int_nometme from fat_tb_m_nfe nfe '+
            ' left outer join cad_tb_c_cli cli on cli.id_cliente=nfe.id_emitente '+
            ' LEFT OUTER JOIN CAD_TB_C_CPG CPG ON CPG.ID_CONDICAO_PAG=nfe.id_condicao_pag '+
            ' LEFT OUTER JOIN CAD_TB_C_TME TME ON TME.ID_TIPO_MOV_ESTOQUE=nfe.ID_TIPO_MOV_ESTOQUE '+
            ' where nfe.tipo_nf=''S'' and nfe.nfe_cod_sit not in (''02'') and nfe.faturada=false ';
       end;

    CondicaoOrder := ' ORDER BY NFE.DTA_EMISSAO ';

    FIN_SQ_R_CXA_DIA_NPD.Close;
    FIN_SQ_R_CXA_DIA_NPD.CommandText := '';
    FIN_SQ_R_CXA_DIA_NPD.CommandText := enSqlCxaDiaNpd;


    if Input[1] <> '' then
        begin
          FIN_SQ_R_CXA_DIA_NPD.CommandText := FIN_SQ_R_CXA_DIA_NPD.CommandText  +
               ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';
        end;

     FIN_SQ_R_CXA_DIA_NPD.CommandText := FIN_SQ_R_CXA_DIA_NPD.CommandText  +
              ' AND   NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
              '       NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_CXA_DIA_NPD.CommandText := FIN_SQ_R_CXA_DIA_NPD.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_CXA_DIA_NPD.CommandText := FIN_SQ_R_CXA_DIA_NPD.CommandText  + CondicaoOrder;
      end;

    Result := FIN_DP_R_CXA_DIA_NPD.Data;

end;

function TSM.FIN_DP_R_PAG_ABEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPag, Condicao, CondicaoOrder: String;
begin

  enSqlPag      := '';
  CondicaoOrder := '';

    if (Input[11] = 0) or (Input[11] = 1) or (Input[11] = 2) or (Input[11] = 3) or (Input[11] = 7) or (Input[11] = 8) or (Input[11] = 10) then
       begin
         enSqlPag :=
           ' SELECT pag.id_empresa, pag.num_parcela, pag.id_forma_pag, pag.dta_emissao, '+
           '        pag.dta_vencimento, pag.id_fornecedor, pag.id_local_titulo, pag.vlr_parcela,'+
           '        pag.id_plano, pag.id_ccusto,pag.id_obra, '+
           '        pag.pre_conta,pag.pre_cheque,pag.pre_banco,pag.pre_emitente,pag.pre_agencia,  '+
           '        FON.DESCRICAO AS INT_NOMEFOR, '+
           '        FPG.DESCRICAO AS INT_NOMEFPG, '+
           '        LTO.DESCRICAO AS INT_NOMELTO, '+
           '        PCT.DESCRICAO AS INT_NOMEPCT, '+
           '        CCU.descricao AS INT_NOMECCU, '+
           '        OBR.descricao AS INT_NOMEOBR, '+
           '        pag.vlr_saldo, '+
           '        PAG.historico, '''+''+''' Prazo, '+
           '        (CURRENT_DATE -  pag.dta_vencimento) as INT_ATRASO, '+
           '   CASE '+
           '     WHEN (CURRENT_DATE -  pag.dta_vencimento)<=0 THEN pag.vlr_saldo '+
           '     WHEN (CURRENT_DATE -  pag.dta_vencimento)>0  THEN '+
           '          pag.vlr_saldo+((pag.vlr_saldo*(COALESCE(pag.per_juros,0)/30)/100)* '+
           '          (CURRENT_DATE -  pag.dta_vencimento)) '+
           '   END as INT_VLR_CORRIGIDO, '+
           '   CASE '+
           '     WHEN (CURRENT_DATE -  pag.dta_vencimento)<=0 THEN 0 '+
           '     WHEN (CURRENT_DATE -  pag.dta_vencimento)>0  THEN '+
           '          (pag.vlr_saldo+((pag.vlr_saldo*(coalesce(pag.per_juros,0)/30)/100)* '+
           '          (CURRENT_DATE -  pag.dta_vencimento)))-pag.vlr_saldo '+
           '   END as INT_VLR_JUROS  '+
           ' FROM FIN_TB_M_PAG PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO '+
           ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = PAG.ID_PLANO '+
           ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto= PAG.ID_CCUSTO '+
           ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA=PAG.ID_EMPRESA '+
           ' LEFT OUTER JOIN ctc_tb_c_obr OBR ON OBR.ID_OBRA=PAG.ID_OBRA ';


           case Input[11] of
               0: CondicaoOrder := ''  ;
               1: CondicaoOrder := ' PAG.ID_FORNECEDOR ';
               2: CondicaoOrder := ' PAG.ID_PLANO ';
               3: CondicaoOrder := ' PAG.ID_FORMA_PAG ';
               7: CondicaoOrder := ' PAG.DTA_VENCIMENTO ';
               8: CondicaoOrder := ' PAG.ID_OBRA ';
              10: CondicaoOrder := ' PAG.ID_FORNECEDOR ';
           end;

       end;
    if (Input[11] = 5) then
       begin
         enSqlPag :=
            ' SELECT pag.iD_PLANO, PCT.DESCRICAO AS INT_NOMEPCT, sum(COALESCE(pag.vlr_parcela,0)) as vlr_parcela, ' +
            '        sum(COALESCE(pag.vlr_saldo,0)) as vlr_saldo '+
            ' FROM FIN_TB_M_PAG PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = PAG.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto= PAG.ID_CCUSTO '+
            ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA=PAG.ID_EMPRESA ';

         CondicaoOrder := ' PAG.ID_PLANO, PCT.DESCRICAO ';
       end;
    if (Input[11] = 6) then
       begin
         enSqlPag :=
            ' SELECT pag.id_forma_pag, FPG.DESCRICAO AS INT_NOMEFPG, sum(COALESCE(pag.vlr_parcela,0)) as vlr_parcela, ' +
            '      sum(COALESCE(pag.vlr_saldo,0)) as vlr_saldo '+
            ' FROM FIN_TB_M_PAG PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = PAG.ID_LOCAL_TITULO '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = PAG.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto= PAG.ID_CCUSTO '+
            ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA=PAG.ID_EMPRESA ';

         CondicaoOrder := ' PAG.id_forma_pag, FPG.DESCRICAO ';
       end;

  FIN_SQ_R_PAG_ABE.Close;
  FIN_SQ_R_PAG_ABE.CommandText :='';

 // if (Input[10] = 0) or (Input[10] = 1) or (Input[10] = 2) or (Input[10] = 3) then
     FIN_SQ_R_PAG_ABE.CommandText := enSqlPag + ' WHERE PAG.VLR_SALDO > 0 ';
  if Input[11] = 10  then
    begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
            ' AND FPG.DOC_IMPRESSO = 6 ';
    end;

  Condicao:='';

  if Input[0] = 0 then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end
  else if Input[0] = 1 then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

  else if Input[0] = 2 then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

   else if Input[0] = 3 then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;


  if Input[3] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[4]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[8]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[8]) +') ';
      end;

  if Input[9] <> '' then
      begin
        FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText  +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[9]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[9]) +') ';
      end;



  //Define ordenao dos relatorios
  if (Input[11] = 0) or (Input[11] = 1) or (Input[11] = 2) or (Input[11] = 3) or (Input[11] = 7) or (Input[11] = 8) then
     begin
       if Input[10] = 0 then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                   ' ORDER BY PAG.DTA_EMISSAO '
            else
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                    ' ORDER BY ' + CondicaoOrder + ' , ' + ' PAG.DTA_EMISSAO ';
          end
       else if Input[10] =1  then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                   ' ORDER BY PAG.DTA_VENCIMENTO '
            else
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                   ' ORDER BY ' + CondicaoOrder + ' , ' + ' PAG.DTA_VENCIMENTO ';
          end
       else if Input[10] =2  then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                   ' ORDER BY FON.DESCRICAO '
            else
               FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
                   ' ORDER BY ' + CondicaoOrder + ' , ' + ' FON.DESCRICAO ';
          end;
     end
  else
     begin
       if (Input[11] = 5) then
          FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
               ' GROUP BY ' + CondicaoOrder +
               ' ORDER BY ' + CondicaoOrder;
       if (Input[11] = 6) then
          FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
               ' GROUP BY ' + CondicaoOrder +
               ' ORDER BY ' + CondicaoOrder;
     end;


  if (Input[11] = 4)  then
       begin
         enSqlPag :=
           ' Select '''+'MAIS DE 180 DIAS '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=181 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  91 A 120 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  61 A  90 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  31 A  60 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=31 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=60 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MENOS DE 30 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=30 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'EM ATE 29 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '       Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=29 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 30 A 60 DIAS  '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '       Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=69 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 61 A 90 DIAS  '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 91 A 120 DIAS '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MAIS DE 180 DIAS '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and  '+
           '      (current_date-Pag.DTA_VENCIMENTO)>180 '+Condicao+' ' +
           ' order by prazo ';
           FIN_SQ_R_PAG_ABE.CommandText :=  enSqlPag;
       end;

   //GerarSqlTxt(FIN_SQ_R_PAG_ABE);
   Result := FIN_DP_R_PAG_ABE.Data;
end;

function TSM.FIN_DP_R_PAG_ABE_PPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPagAbePpg, Condicao, CondicaoOrder: String;
begin

  enSqlPagAbePpg      := '';
  CondicaoOrder := '';
  { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 25-11-2014 }


  FIN_SQ_R_PAG_ABE_PPG.Close;
  FIN_SQ_R_PAG_ABE_PPG.CommandText :='';


  FIN_SQ_R_PAG_ABE.CommandText := enSqlPagAbePpg + ' WHERE 1=1 ';


  Condicao:='';

  if Input[0] = 0 then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText +
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end
  else if Input[0] = 1 then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText +
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
  else if Input[0] = 2 then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText +
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
  else if Input[0] = 3 then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText +
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

  if Input[3] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[4]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[8]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[8]) +') ';
      end;
  if Input[9] <> '' then
      begin
        FIN_SQ_R_PAG_ABE_PPG.CommandText := FIN_SQ_R_PAG_ABE_PPG.CommandText  +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[9]) +') ';
        Condicao := Condicao +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[9]) +') ';
      end;

  if (Input[11] = 4)  then
       begin
         enSqlPagAbePpg :=
           ' Select '''+'A PARTIR DE 181 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=181 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 91 A 120 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 61 A 90 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 31 A 60 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=31 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=60 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MENOS DE 30 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<30 '+Condicao+' '+
           {' Union All '+
          { ' Select '''+'EM ATE 29 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '       Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=29 '+Condicao+' '+
           ' Union All '+    }
           {' Select '''+'DE 30 A 69 DIAS  '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '       Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=69 '+Condicao+' '+
        {  ' Union All '+
            ' Select '''+'DE 61 A 90 DIAS  '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+     }
        {   ' Select '''+'DE 91 A 120 DIAS '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+ }
          { ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0)  and '+
           '      Pag.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Pag.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Pag.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MAIS DE 180 DIAS '+''' Prazo, '+
           '       Pag.ID_FORMA_PAG, Pag.NUM_PARCELA, Pag.DTA_EMISSAO, '+
           '       Pag.DTA_VENCIMENTO, Pag.ID_FORNECEDOR, FOC.DESCRICAO AS INT_NOMEFOR, '+
           '       (current_date-Pag.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Pag.VLR_SALDO, pag.vlr_parcela '+
           ' from FIN_TB_M_PAG Pag '+
           ' Left Outer Join CAD_TB_C_FOR FOC On FOC.ID_FORNECEDOR=Pag.ID_FORNECEDOR '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = PAG.ID_FORMA_PAG '+
           ' Where (Pag.VLR_SALDO>0) and '+
           '      Pag.DTA_VENCIMENTO<current_date and  '+
           '      (current_date-Pag.DTA_VENCIMENTO)>180 '+Condicao+' ' +   }
           ' order by prazo, dta_vencimento ';
           FIN_SQ_R_PAG_ABE_PPG.CommandText :=  enSqlPagAbePpg;
       end;

   //GerarSqlTxt(FIN_SQ_R_PAG_ABE_PPG);
   Result := FIN_DP_R_PAG_ABE_PPG.Data;
end;

function TSM.FIN_DP_R_PAG_BXADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPagBxa, CondicaoOrder: String;
begin
   { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlPagBxa:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Fornecedores
    //  Input[4]  Formas de pagamento
    //  Input[5]  Plano de contas
    //  Input[6]  Centro de Custo
    //  Input[7]  Ordenao
    //  Input[8]  Relatrio
    //             - 0 - > Geral
    //             - 1 - > Por fornecedor
    //             - 2 - > Por plano de contas
    //             - 3 - > Por forma de pagamento
    //             - 4 - > Resumo por plano de contas
    //             - 5 - > Resumo por foma de pagamento


    CondicaoOrder := '';

    if (Input[9] = 0) or (Input[9] = 1) or (Input[9] = 2) or (Input[9] = 3) or (Input[9] = 7) then
       begin
         enSqlPagBxa :=
           ' SELECT PGT.*, '+
           ' COALESCE(PGT.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, '+
           ' PAG.ID_FORNECEDOR, PAG.VLR_PARCELA AS VLR_TITULO,  PAG.num_parcela, ' +
           '        PAG.dta_emissao, PAG.dta_vencimento,PAG.id_obra,             ' +
           '        FON.DESCRICAO AS INT_NOMEFOR, ' +
           '        FPG.DESCRICAO AS INT_NOMEFPG, ' +
           '        PCT.DESCRICAO AS INT_NOMEPCT, ' +
           '        CCU.descricao AS INT_NOMECCU, ' +
           '        FON.DOC_CNPJ  AS INT_CNPJCPF, '+
           '        OBR.descricao AS INT_NOMEOBR  '+
           ' FROM  FIN_TB_M_PAG_PAG PGT' +
           ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO       = PGT.ID_TITULO   ' +
           ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR   = PAG.ID_FORNECEDOR '+
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = PGT.ID_FORMA_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = PGT.ID_PLANO '+
           ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto       = PGT.ID_CCUSTO '+
           ' LEFT OUTER JOIN ctc_tb_c_obr OBR ON OBR.id_obra       =   PAG.ID_OBRA ';

           case Input[9] of
              0: CondicaoOrder := '';
              1: CondicaoOrder := ' PAG.ID_FORNECEDOR ';
              2: CondicaoOrder := ' PGT.ID_PLANO ';
              3: CondicaoOrder := ' PGT.ID_FORMA_PAG ';
              7: CondicaoOrder := ' PAG.ID_OBRA ';
           end;
       end;
    if (Input[9] = 4) then
       begin
         enSqlPagBxa :=
            ' SELECT COALESCE(PGT.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, '+
            ' PGT.ID_PLANO, PCT.DESCRICAO AS INT_NOMEPCT, ' +
            '  sum(COALESCE(PGT.vlr_pagamento,0)) as vlr_pagamento ' +
            ' FROM  FIN_TB_M_PAG_PAG PGT' +
            ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO     = PGT.ID_TITULO ' +
            ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG  = PGT.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO  = PGT.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto = PGT.ID_CCUSTO ';

            CondicaoOrder := ' INT_SUBSTITUICAO,PGT.ID_PLANO,PCT.DESCRICAO ';
       end;
    if (Input[9] = 5) then
       begin
         enSqlPagBxa :=
            ' SELECT COALESCE(PGT.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, '+
            ' PGT.id_forma_pag, FPG.DESCRICAO AS INT_NOMEFPG, ' +
            '        sum(COALESCE(PGT.vlr_pagamento,0)) as vlr_pagamento '+
            ' FROM FIN_TB_M_PAG_PAG PGT ' +
            ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_TITULO     = PGT.ID_TITULO ' +
            ' LEFT OUTER JOIN CAD_TB_C_FOR FON ON FON.ID_FORNECEDOR = PAG.ID_FORNECEDOR '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG  = PGT.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = PGT.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto= PGT.ID_CCUSTO ';

            CondicaoOrder := ' INT_SUBSTITUICAO,PGT.id_forma_pag, FPG.DESCRICAO ';
       end;

  FIN_SQ_R_PAG_BXA.Close;
  FIN_SQ_R_PAG_BXA.CommandText :='';


  FIN_SQ_R_PAG_BXA.CommandText := enSqlPagBxa +
          ' WHERE PAG.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  if Input[10] = 0 then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
  else if Input[10] = 1 then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

  else if Input[10] = 2 then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

   else if Input[10] = 3 then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[10] = 4 then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
         ' AND PGT.DTA_PAGAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PGT.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

  {FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
   ' AND PGT.DTA_PAGAMENTO>= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
   '     PGT.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';}

   // Esau : Input [10] criado para atender chamado 1937.

  if Input[3] <> '' then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText  +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText  +
             ' AND PGT.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText  +
             ' AND PGT.ID_PLANO in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText  +
             ' AND PGT.ID_CCUSTO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText  +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[7]) +') ';
      end;

   // Define ordenao dos relatorios
   if strtoint(Input[9]) in [0,1,2,3,7] then //Relatorio por Forma de Pagamento
      begin
         if Input[8] =0 then
            begin
             if CondicaoOrder = '' then
                FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                   ' ORDER BY INT_SUBSTITUICAO,PAG.DTA_EMISSAO '
             else
                 FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' PAG.DTA_EMISSAO ';
            end
         else if Input[8] = 1  then
            begin
              if CondicaoOrder = '' then
                  FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO,PAG.DTA_VENCIMENTO '
              else
                 FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' PAG.DTA_VENCIMENTO ';
            end
         else if Input[8] =2 then
            begin
              if CondicaoOrder = '' then
                  FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, FON.DESCRICAO '
              else
                  FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' FON.DESCRICAO ';
            end;
      end
   else if Input[9] = 4 then //Relatorio por Forma de Pagamento
        begin
          FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
                ' GROUP BY ' + CondicaoOrder +
                ' ORDER BY ' + CondicaoOrder;
        end
   else if Input[9] = 5 then //Relatorio por Forma de Pagamento
        begin
          FIN_SQ_R_PAG_BXA.CommandText := FIN_SQ_R_PAG_BXA.CommandText +
              ' GROUP BY ' + CondicaoOrder +
              ' ORDER BY ' + CondicaoOrder;
        end;
   //CMServerForm.mm.Lines.Add(FIN_SQ_R_PAG_BXA.CommandText);
   Result := FIN_DP_R_PAG_BXA.Data;
end;

function TSM.FIN_DP_R_PAG_CXADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlPagCxa, CondicaoOrder,CondicaoGroup: String;
begin
    enSqlPagCxa := '';

    CondicaoOrder := '';
    CondicaoGroup := '';


     enSqlPagCxa :=
        ' SELECT CTA.DEB_CRE,' +
        '  CTA.DTA_MOVIMENTO, CTA.NUM_DOC, TIF.SIGLA, CTA.ID_PLANO, CTA.ID_TIPO_FINANCEIRO, CTA.HISTORICO, ' +
        '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=1 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_CREDITODIA, ' +
        '  COALESCE(SUM(CASE WHEN CTA.DEB_CRE=0 THEN CTA.VLR_LANCAMENTO ELSE 0 END), 0) VLR_DEBITODIA,  ' +
        '  COALESCE(SUM(CTA.VLR_LANCAMENTO * (CASE WHEN CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0) VLR_SALDODIA, ' +
        '  (SELECT COALESCE(SUM(I_CTA.VLR_LANCAMENTO * (CASE WHEN I_CTA.DEB_CRE=0 THEN -1 ELSE 1 END)), 0)   ' +
        '   FROM  FIN_TB_M_CTA I_CTA                                                                         ' +
        '   WHERE I_CTA.DTA_MOVIMENTO <= CTA.DTA_MOVIMENTO order by CTA.DTA_MOVIMENTO  ) VLR_ACUMULADO       ' +
        ' FROM FIN_TB_M_CTA CTA                                                                              ' +
        ' LEFT OUTER JOIN CAD_TB_C_TIF TIF ON TIF.ID_TIPO_FINANCEIRO = CTA.ID_TIPO_FINANCEIRO                    ' +
        ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = CTA.ID_PLANO                                        ' +
        ' LEFT OUTER JOIN FIN_TB_M_CXA CXA ON CXA.ID_ABERTURA= CTA.ID_ABERTURA                                   ' +
        ' WHERE CTA.DTA_MOVIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' AND ' +
        '       CTA.DTA_MOVIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND ' +
        '       CTA.TIPO_LANCAMENTO = 0 ';
        CondicaoGroup := ' GROUP BY 1,2,3,4,5,6,7';
        CondicaoOrder := ' ORDER BY CTA.DEB_CRE, CTA.DTA_MOVIMENTO';



  FIN_SQ_R_PAG_CXA.Close;
  FIN_SQ_R_PAG_CXA.CommandText := '';
  FIN_SQ_R_PAG_CXA.CommandText := enSqlPagCxa;



  if Input[2] <> '' then
      begin
        FIN_SQ_R_PAG_CXA.CommandText := FIN_SQ_R_PAG_CXA.CommandText  +
             ' AND CTA.ID_CONTA = ''' + VarToStr(Input[2]) +''' ';
      end;

   if CondicaoGroup<>'' then
      begin
        FIN_SQ_R_PAG_CXA.CommandText := FIN_SQ_R_PAG_CXA.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        FIN_SQ_R_PAG_CXA.CommandText := FIN_SQ_R_PAG_CXA.CommandText  + CondicaoOrder;
      end;

   Result := FIN_DP_R_PAG_CXA.Data;
   FIN_SQ_R_PAG_CXA.Close;

end;

function TSM.FIN_DP_R_PAG_SLDDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlPag, Condicao, CondicaoOrder: String;
begin
    { TODO -oLuan -cCriao : Criado por Luan em 30/03/2017 }
    enSqlPag :=
      ' select '+
      '  pag.id_titulo,pag.num_parcela,pag.id_empresa,par.emp_razao as int_nomeemp,pag.id_fornecedor,frn.descricao as int_nomefor, '+
      '  pag.id_forma_pag,fpg.descricao as int_nomefpg, '+
      '  pag.dta_emissao,pag.dta_vencimento,pag.vlr_parcela,pag.historico,       '+
      '  (pag.vlr_parcela+coalesce(sum(ppg.vlr_juros),0)+coalesce(sum(ppg.vlr_multa),0) -coalesce(sum(ppg.vlr_pagamento),0)-coalesce(sum(ppg.vlr_desconto),0)) as int_vlr_saldo_atual  '+
      '  from fin_tb_m_pag pag  '+
      '  left outer join fin_tb_m_pag_pag ppg on ppg.id_titulo=pag.id_titulo and '+
      '             ppg.dta_pagamento<='''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[12])) )+''' '  +
      '  left outer join cad_tb_c_fpg fpg on fpg.id_forma_pag=pag.id_forma_pag  '+
      '  left outer join cad_tb_c_par par on par.id_empresa=pag.id_empresa      '+
      '  left outer join cad_tb_c_for frn on frn.id_fornecedor=pag.id_fornecedor  ';

    CondicaoOrder := 'pag.id_empresa,int_nomefor';


    FIN_SQ_R_PAG_SLD.Close;
    FIN_SQ_R_PAG_SLD.CommandText :='';

    FIN_SQ_R_PAG_SLD.CommandText := enSqlPag + ' WHERE 1 = 1 ';


    if Input[0] = 0 then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
         ' AND PAG.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end
    else if Input[0] = 1 then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
         ' AND PAG.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        end

    else if Input[0] = 2 then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
         ' AND PAG.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        end

   else if Input[0] = 3 then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
         ' AND PAG.DTA_LANCAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       PAG.DTA_LANCAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        end;



  if Input[3] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_FORNECEDOR in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;

  if Input[8] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_CCUSTO in (' + VarToStr(Input[8]) +') ';
      end;

  if Input[9] <> '' then
      begin
        FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText  +
             ' AND PAG.ID_OBRA in (' + VarToStr(Input[9]) +') ';
      end;

  FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
               ' GROUP BY 1,2,3,4,5,6,7,8,9,10 ';

  if Input[10] = 0 then
      begin
        if CondicaoOrder = '' then
           FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
               ' ORDER BY PAG.DTA_EMISSAO '
        else
           FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
                ' ORDER BY ' + CondicaoOrder + ' , ' + ' PAG.DTA_EMISSAO ';
      end
   else if Input[10] =1  then
      begin
        if CondicaoOrder = '' then
           FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
               ' ORDER BY PAG.DTA_VENCIMENTO '
        else
           FIN_SQ_R_PAG_SLD.CommandText := FIN_SQ_R_PAG_SLD.CommandText +
               ' ORDER BY ' + CondicaoOrder + ' , ' + ' PAG.DTA_VENCIMENTO ';
      end
   else if Input[10] =2  then
      begin
       { if CondicaoOrder = '' then
           FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
               ' ORDER BY FON.DESCRICAO '
        else
           FIN_SQ_R_PAG_ABE.CommandText := FIN_SQ_R_PAG_ABE.CommandText +
               ' ORDER BY ' + CondicaoOrder + ' , ' + ' FON.DESCRICAO '; }
      end;


    //CMServerForm.mm.Lines.Add(FIN_SQ_R_PAG_SLD.CommandText );

    Result := FIN_DP_R_PAG_SLD.Data;
end;

function TSM.FIN_DP_R_PCP_FORDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPcpFor:string;
  i:Integer;
begin
   { TODO -oLuan -cCriao : Criado por Luan em 24/05/2017 }
   enSqlPcpFor :=
      ' WITH TBA AS (                       '+
      ' SELECT PAR.ID_EMPRESA,              '+
      ' PAG.ID_FORNECEDOR,                  '+
      ' SUM(PAG.VLR_SALDO) AS TOTAL_ABERTO ';

   for I := 1 to 12 do
     begin
       enSqlPcpFor := enSqlPcpFor +
        ' ,SUM(                                                               '+
        ' CASE WHEN EXTRACT(MONTH FROM PAG.DTA_EMISSAO)='''+IntToStr(i)+'''   '+
        ' THEN PAG.VLR_SALDO                                    '+
        ' ELSE 0 END) AS MES_'+IntToStr(i)+'                    ';
     end;

   enSqlPcpFor := enSqlPcpFor +
       ' FROM CAD_TB_C_PAR PAR                                                   '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA       '+
       '  WHERE  EXTRACT (YEAR FROM PAG.DTA_EMISSAO)='''+VarToStr(Input[0])+''' ';


   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;

   if VarToStr(Input[3])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;

   enSqlPcpFor := enSqlPcpFor +
     ' GROUP BY 1,2), ' +
     ' TBB AS (SELECT PAR.ID_EMPRESA,PAG.id_fornecedor,  '+
     ' SUM(PPG.VLR_PAGAMENTO) AS TOTAL_PAGO             ';

   for I := 1 to 12 do
     begin
       enSqlPcpFor := enSqlPcpFor +
        ' ,SUM(                                                 '+
        ' CASE WHEN EXTRACT(MONTH FROM PPG.DTA_PAGAMENTO)='''+IntToStr(i)+'''  '+
        '  THEN PPG.VLR_PAGAMENTO                              '+
        '  ELSE 0 END) AS MES_'+IntToStr(i)+'                  ';
     end;

   enSqlPcpFor := enSqlPcpFor +
       ' FROM CAD_TB_C_PAR PAR    '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG_PAG PPG ON PPG.ID_TITULO=PAG.ID_TITULO '+
       '  WHERE (not (PPG.COM_SUBSTITUICAO=true)) and EXTRACT (YEAR FROM PPG.DTA_PAGAMENTO)='''+VarToStr(Input[0])+''' ';

   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;


   if VarToStr(Input[3])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND ppg.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND ppg.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND ppg.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;



   enSqlPcpFor := enSqlPcpFor +
       '  GROUP BY 1,2) '+
       ' SELECT PAR.ID_EMPRESA,PAR.EMP_FANTASIA,FRN.ID_FORNECEDOR,FRN.DESCRICAO AS INT_NOMEFOR, COALESCE(TBA.TOTAL_ABERTO,0) AS TOTAL_ABERTO,COALESCE(TBB.TOTAL_PAGO,0) AS TOTAL_BAIXADO ';

   for I := 1 to 12 do
     begin
       enSqlPcpFor := enSqlPcpFor +
       ' ,COALESCE(TBA.MES_'+IntToStr(i)+',0) AS MES_ABE_'+IntToStr(i)+',COALESCE(TBB.MES_'+IntToStr(i)+',0) AS MES_BXA_'+IntToStr(i)+' ';
     end;

    enSqlPcpFor := enSqlPcpFor +
       ' FROM CAD_TB_C_PAR PAR      '+
       ' LEFT OUTER JOIN CAD_TB_C_FOR FRN ON FRN.ID_FORNECEDOR>0 '+
       ' LEFT OUTER JOIN TBA ON TBA.ID_EMPRESA=PAR.ID_EMPRESA  AND TBA.ID_FORNECEDOR = FRN.ID_FORNECEDOR '+
       ' LEFT OUTER JOIN TBB ON TBB.ID_EMPRESA=PAR.ID_EMPRESA  AND TBB.ID_FORNECEDOR = FRN.ID_FORNECEDOR '+
       ' WHERE 1=1 AND '+
       '  (TBA.MES_1>0 OR TBB.MES_1>0 OR TBA.MES_2>0 OR TBB.MES_2>0 OR TBA.MES_3>0 OR TBB.MES_3>0 OR TBA.MES_4>0 OR TBB.MES_4>0 OR TBA.MES_5>0 OR TBB.MES_5>0 OR TBA.MES_6>0 OR TBB.MES_6>0 OR '+
       '   TBA.MES_7>0 OR TBB.MES_7>0 OR TBA.MES_8>0 OR TBB.MES_8>0 OR TBA.MES_9>0 OR TBB.MES_9>0 OR TBA.MES_10>0 OR TBB.MES_10>0 OR TBA.MES_11>0 OR TBB.MES_11>0 OR TBA.MES_12>0 OR TBB.MES_12>0  ) ';


   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND par.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpFor := enSqlPcpFor +
                              ' AND frn.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;

   FIN_SQ_R_PCP_FOR.Close;
   FIN_SQ_R_PCP_FOR.CommandText := enSqlPcpFor+
                                       ' ORDER BY PAR.ID_EMPRESA,INT_NOMEFOR ';

   Result :=  FIN_DP_R_PCP_FOR.Data;

   FIN_SQ_R_PCP_FOR.Close;
end;

function TSM.FIN_DP_R_PCP_OBRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPcpObr:string;
  i:Integer;
begin
    { TODO -oLuan -cCriao : Criado por Luan em 24/05/2017 }
   enSqlPcpObr :=
      ' WITH TBA AS (                       '+
      ' SELECT PAR.ID_EMPRESA,              '+
      ' PAG.ID_OBRA,                  '+
      ' SUM(PAG.VLR_SALDO) AS TOTAL_ABERTO ';

   for I := 1 to 12 do
     begin
       enSqlPcpObr := enSqlPcpObr +
        ' ,SUM(                                                               '+
        ' CASE WHEN EXTRACT(MONTH FROM PAG.DTA_EMISSAO)='''+IntToStr(i)+'''   '+
        ' THEN PAG.VLR_SALDO                                    '+
        ' ELSE 0 END) AS MES_'+IntToStr(i)+'                    ';
     end;

   enSqlPcpObr := enSqlPcpObr +
       ' FROM CAD_TB_C_PAR PAR                                                   '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA       '+
       '  WHERE  EXTRACT (YEAR FROM PAG.DTA_EMISSAO)='''+VarToStr(Input[0])+''' ';


   if VarToStr(Input[1])<>'' then
      begin
           enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
           enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;

   if VarToStr(Input[3])<>'' then
      begin
           enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;

   enSqlPcpObr := enSqlPcpObr +
     ' GROUP BY 1,2), ' +
     ' TBB AS (SELECT PAR.ID_EMPRESA,PAG.id_obra,  '+
     ' SUM(PPG.VLR_PAGAMENTO) AS TOTAL_PAGO             ';

   for I := 1 to 12 do
     begin
        enSqlPcpObr := enSqlPcpObr +
        ' ,SUM(                                                 '+
        ' CASE WHEN EXTRACT(MONTH FROM PPG.DTA_PAGAMENTO)='''+IntToStr(i)+'''  '+
        '  THEN PPG.VLR_PAGAMENTO                              '+
        '  ELSE 0 END) AS MES_'+IntToStr(i)+'                  ';
     end;

   enSqlPcpObr := enSqlPcpObr +
       ' FROM CAD_TB_C_PAR PAR    '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG_PAG PPG ON PPG.ID_TITULO=PAG.ID_TITULO '+
       '  WHERE (not (PPG.COM_SUBSTITUICAO=true)) and EXTRACT (YEAR FROM PPG.DTA_PAGAMENTO)='''+VarToStr(Input[0])+''' ';

   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;


   if VarToStr(Input[3])<>'' then
      begin
         enSqlPcpObr := enSqlPcpObr +
                              ' AND ppg.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND ppg.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND ppg.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
          enSqlPcpObr := enSqlPcpObr +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;



   enSqlPcpObr := enSqlPcpObr +
       '  GROUP BY 1,2) '+
       ' SELECT PAR.ID_EMPRESA,PAR.EMP_FANTASIA,OBR.ID_OBRA,OBR.DESCRICAO AS INT_NOMEOBRA, COALESCE(TBA.TOTAL_ABERTO,0) AS TOTAL_ABERTO,COALESCE(TBB.TOTAL_PAGO,0) AS TOTAL_BAIXADO ';

   for I := 1 to 12 do
     begin
         enSqlPcpObr := enSqlPcpObr +
       ' ,COALESCE(TBA.MES_'+IntToStr(i)+',0) AS MES_ABE_'+IntToStr(i)+',COALESCE(TBB.MES_'+IntToStr(i)+',0) AS MES_BXA_'+IntToStr(i)+' ';
     end;

   enSqlPcpObr := enSqlPcpObr +
       ' FROM CAD_TB_C_PAR PAR      '+
       ' LEFT OUTER JOIN CTC_TB_C_OBR OBR ON OBR.ID_OBRA>0 '+
       ' LEFT OUTER JOIN TBA ON TBA.ID_EMPRESA=PAR.ID_EMPRESA  AND TBA.ID_OBRA = OBR.ID_OBRA '+
       ' LEFT OUTER JOIN TBB ON TBB.ID_EMPRESA=PAR.ID_EMPRESA  AND TBB.ID_OBRA = OBR.ID_OBRA '+
       ' WHERE 1=1 AND '+
       '  (TBA.MES_1>0 OR TBB.MES_1>0 OR TBA.MES_2>0 OR TBB.MES_2>0 OR TBA.MES_3>0 OR TBB.MES_3>0 OR TBA.MES_4>0 OR TBB.MES_4>0 OR TBA.MES_5>0 OR TBB.MES_5>0 OR TBA.MES_6>0 OR TBB.MES_6>0 OR '+
       '   TBA.MES_7>0 OR TBB.MES_7>0 OR TBA.MES_8>0 OR TBB.MES_8>0 OR TBA.MES_9>0 OR TBB.MES_9>0 OR TBA.MES_10>0 OR TBB.MES_10>0 OR TBA.MES_11>0 OR TBB.MES_11>0 OR TBA.MES_12>0 OR TBB.MES_12>0  ) ';


   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpObr := enSqlPcpObr +
                              ' AND par.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
         enSqlPcpObr := enSqlPcpObr +
                              ' AND obr.id_obra in ('+VarToStr(Input[7])+') ';
       end;

   FIN_SQ_R_PCP_OBR.Close;
   FIN_SQ_R_PCP_OBR.CommandText :=   enSqlPcpObr+
                                        ' ORDER BY PAR.ID_EMPRESA,INT_NOMEOBRA ';

   Result :=  FIN_DP_R_PCP_OBR.Data;

   FIN_SQ_R_PCP_OBR.Close;
end;

function TSM.FIN_DP_R_PCP_PCTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlPcpPct:string;
  i:Integer;
begin
   { TODO -oLuan -cCriao : Criado por Luan em 24/05/2017 }
   enSqlPcpPct :=
      ' WITH TBA AS (                       '+
      ' SELECT PAR.ID_EMPRESA,              '+
      ' PAG.ID_PLANO,                       '+
      ' SUM(PAG.VLR_SALDO) AS TOTAL_ABERTO ';

   for I := 1 to 12 do
     begin
       enSqlPcpPct := enSqlPcpPct +
        ' ,SUM(                                                               '+
        ' CASE WHEN EXTRACT(MONTH FROM PAG.DTA_EMISSAO)='''+IntToStr(i)+'''   '+
        ' THEN PAG.VLR_SALDO                                    '+
        ' ELSE 0 END) AS MES_'+IntToStr(i)+'                    ';
     end;

   enSqlPcpPct := enSqlPcpPct +
       ' FROM CAD_TB_C_PAR PAR                                                   '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA       '+
       '  WHERE  EXTRACT (YEAR FROM PAG.DTA_EMISSAO)='''+VarToStr(Input[0])+''' ';


   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;

   if VarToStr(Input[3])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;

   enSqlPcpPct := enSqlPcpPct +
     ' GROUP BY 1,2), ' +
     ' TBB AS (SELECT PAR.ID_EMPRESA,PAG.ID_PLANO,  '+
     ' SUM(PPG.VLR_PAGAMENTO) AS TOTAL_PAGO             ';

   for I := 1 to 12 do
     begin
       enSqlPcpPct := enSqlPcpPct +
        ' ,SUM(                                                 '+
        ' CASE WHEN EXTRACT(MONTH FROM PPG.DTA_PAGAMENTO)='''+IntToStr(i)+'''  '+
        '  THEN PPG.VLR_PAGAMENTO                              '+
        '  ELSE 0 END) AS MES_'+IntToStr(i)+'                  ';
     end;

   enSqlPcpPct := enSqlPcpPct +
       ' FROM CAD_TB_C_PAR PAR    '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG PAG ON PAG.ID_EMPRESA=PAR.ID_EMPRESA '+
       ' LEFT OUTER JOIN FIN_TB_M_PAG_PAG PPG ON PPG.ID_TITULO=PAG.ID_TITULO '+
       '  WHERE (not (PPG.COM_SUBSTITUICAO=true)) and EXTRACT (YEAR FROM PPG.DTA_PAGAMENTO)='''+VarToStr(Input[0])+''' ';

   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[2])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_fornecedor in ('+VarToStr(Input[2])+') ';
       end;


   if VarToStr(Input[3])<>'' then
      begin
          enSqlPcpPct := enSqlPcpPct +
                              ' AND ppg.id_forma_pag in ('+VarToStr(Input[3])+') ';
       end;

   if VarToStr(Input[4])<>'' then
      begin
          enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_local_titulo in ('+VarToStr(Input[4])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND ppg.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   if VarToStr(Input[6])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND ppg.id_ccusto in ('+VarToStr(Input[6])+') ';
       end;

   if VarToStr(Input[7])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pag.id_obra in ('+VarToStr(Input[7])+') ';
       end;



   enSqlPcpPct := enSqlPcpPct +
       '  GROUP BY 1,2) '+
       ' SELECT PAR.ID_EMPRESA,PAR.EMP_FANTASIA,PCT.ID_PLANO,PCT.DESCRICAO AS INT_NOMEPCT, COALESCE(TBA.TOTAL_ABERTO,0) AS TOTAL_ABERTO,COALESCE(TBB.TOTAL_PAGO,0) AS TOTAL_BAIXADO ';

   for I := 1 to 12 do
     begin
       enSqlPcpPct := enSqlPcpPct +
         ' ,COALESCE(TBA.MES_'+IntToStr(i)+',0) AS MES_ABE_'+IntToStr(i)+',COALESCE(TBB.MES_'+IntToStr(i)+',0) AS MES_BXA_'+IntToStr(i)+' ';
     end;

    enSqlPcpPct := enSqlPcpPct +
       ' FROM CAD_TB_C_PAR PAR    '+
       ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO<>'''' '+
       ' LEFT OUTER JOIN TBA ON TBA.ID_EMPRESA=PAR.ID_EMPRESA  AND TBA.ID_PLANO = PCT.ID_PLANO '+
       ' LEFT OUTER JOIN TBB ON TBB.ID_EMPRESA=PAR.ID_EMPRESA  AND TBB.ID_PLANO = PCT.ID_PLANO '+
       ' WHERE 1=1 AND '+
       '  (TBA.MES_1>0 OR TBB.MES_1>0 OR TBA.MES_2>0 OR TBB.MES_2>0 OR TBA.MES_3>0 OR TBB.MES_3>0 OR TBA.MES_4>0 OR TBB.MES_4>0 OR TBA.MES_5>0 OR TBB.MES_5>0 OR TBA.MES_6>0 OR TBB.MES_6>0 OR '+
       '   TBA.MES_7>0 OR TBB.MES_7>0 OR TBA.MES_8>0 OR TBB.MES_8>0 OR TBA.MES_9>0 OR TBB.MES_9>0 OR TBA.MES_10>0 OR TBB.MES_10>0 OR TBA.MES_11>0 OR TBB.MES_11>0 OR TBA.MES_12>0 OR TBB.MES_12>0  ) ';


   if VarToStr(Input[1])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND par.id_empresa in ('+VarToStr(Input[1])+') ';
       end;

   if VarToStr(Input[5])<>'' then
      begin
         enSqlPcpPct := enSqlPcpPct +
                              ' AND pct.id_plano in ('+VarToStr(Input[5])+') ';
       end;

   FIN_SQ_R_PCP_PCT.Close;
   FIN_SQ_R_PCP_PCT.CommandText := enSqlPcpPct+
                                   ' ORDER BY PAR.ID_EMPRESA,PCT.ID_PLANO ';

   Result :=  FIN_DP_R_PCP_PCT.Data;

   FIN_SQ_R_PCP_PCT.Close;
end;

function TSM.FIN_DP_R_PRCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlRelPrc: string;
begin
  { TODO -oLuan : Criado no dia 05/01/2017 }
  enSqlRelPrc :=
         ' select prc.*,                       '+
         ' lmf.dta_movimento,                  '+
         ' lmf.vlr_movimento,                  '+
         ' lmf.vlr_saldo,                      '+
         ' fun.id_funcionario,                 '+
         ' fun.nome as int_nomefun            '+

        ' from fin_tb_m_prc prc                '+
        ' left outer join fin_tb_m_lmf lmf on lmf.id_lmf=prc.id_lmf          '+
        ' left outer join cad_tb_c_fun fun on fun.id_funcionario=lmf.id_funcionario  ';



    FIN_SQ_R_PRC.Close;
    FIN_SQ_R_PRC.CommandText := '';
    FIN_SQ_R_PRC.CommandText := enSqlRelPrc;

    FIN_SQ_R_PRC.CommandText := FIN_SQ_R_PRC.CommandText  +
          ' WHERE prc.dta_prestacao >= '''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' '+
          '  and prc.dta_prestacao <='''+ FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) )+ ''' ';



    if Input[2]<>'' then
       begin
          FIN_SQ_R_PRC.CommandText := FIN_SQ_R_PRC.CommandText  +
                              ' AND prc.id_empresa in ('+VarToStr(Input[2])+') ';
       end;

    if Input[3]<>'' then
       begin
          FIN_SQ_R_PRC.CommandText := FIN_SQ_R_PRC.CommandText  +
                              ' AND lmf.id_funcionario in ('+VarToStr(Input[3])+') ';
       end;

    if Input[4]<>'' then
       begin
          FIN_SQ_R_PRC.CommandText := FIN_SQ_R_PRC.CommandText  +
                              ' AND lmf.id_plano in ('+VarToStr(Input[4])+') ';
       end;


   FIN_SQ_R_PRC.CommandText := FIN_SQ_R_PRC.CommandText  +
     ' order by prc.id_empresa,int_nomefun,prc.id_lmf,prc.id_prc ';


   Result := FIN_DP_R_PRC.Data;

   FIN_SQ_R_PRC.Close;
end;

function TSM.FIN_DP_R_REC_ABEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRec, Condicao, CondicaoOrder: String;
begin

  enSqlRec      := '';
  CondicaoOrder := '';

    if (Input[9] = 0) or (Input[9] = 1) or (Input[9] = 2) or (Input[9] = 3) or (Input[9] = 7) or (Input[9] = 8) or (Input[9] = 9) or (Input[9] = 10) then
       begin
         enSqlRec :=
           ' SELECT rec.id_titulo, rec.id_empresa, rec.num_parcela, rec.id_forma_pag, rec.dta_emissao, fpg.doc_impresso, '+
           '        rec.dta_original,rec.dta_vencimento, rec.id_cliente, rec.id_local_titulo, rec.vlr_parcela,rec.car_taxa,'+
           '        rec.id_plano, CLI.NOME AS INT_NOMECLI, CLI.TEL_FIXO AS INT_TELFIXO,CLI.TEL_MOVEL AS INT_TELMOVEL, '+
           '        CLI.ENDERECO AS INT_ENDERECO,CLI.BAIRRO AS INT_BAIRRO,CLI.NUMERO AS INT_NUMERO, '+
           '        nfe.numero as int_numeronf, '+
           '        rec.id_vendedor, fun.nome as int_nomeven, ';

         if Input[12]=0 then
           begin
            enSqlRec := enSqlRec + ' cli.id_vendedor as int_codvnd,fuc.nome as int_nomevnd, ';
           end
         else if Input[12]=1 then
           begin
             enSqlRec := enSqlRec + ' rec.id_vendedor as int_codvnd,fun.nome as int_nomevnd, ';
           end;



         enSqlRec := enSqlRec +
           '        FPG.DESCRICAO AS INT_NOMEFPG, '+
           '        LTO.DESCRICAO AS INT_NOMELTO, '+
           '        PCT.DESCRICAO AS INT_NOMEPCT, '+
           '        rec.vlr_saldo, '+
           '        rec.bol_nosso_numero, '+
           '        ctc.banco as int_banco, '+
           '        ctc.agencia as int_agencia,  '+
           '        ctc.descricao as int_descconta, '+
           '        ctc.conta_corrente as int_contacorrente, '+
           '        rec.historico, '''+''+''' Prazo, '+
           '        cid.id_cidade as int_codcidade, '+
           '        cid.nome as int_nomecid, '+
           '        cid.uf as int_nomeuf, '+
           '        (CURRENT_DATE -  rec.dta_vencimento) as INT_ATRASO, '+
           '   CASE '+
           '     WHEN (CURRENT_DATE -  rec.dta_vencimento)<=0 THEN rec.vlr_saldo '+
           '     WHEN (CURRENT_DATE -  rec.dta_vencimento)>0  THEN '+
           '          rec.vlr_saldo+((rec.vlr_saldo*(CTR.tax_juros_mensal/30)/100)* '+
           '          (CURRENT_DATE -  rec.dta_vencimento)) '+
           '   END as INT_VLR_CORRIGIDO, '+
           '   CASE '+
           '     WHEN (CURRENT_DATE -  rec.dta_vencimento)<=0 THEN 0 '+
           '     WHEN (CURRENT_DATE -  rec.dta_vencimento)>0  THEN '+
           '          (rec.vlr_saldo+((rec.vlr_saldo*(CTR.tax_juros_mensal/30)/100)* '+
           '          (CURRENT_DATE -  rec.dta_vencimento)))-rec.vlr_saldo '+
           '   END as INT_VLR_JUROS  '+
           ' FROM FIN_TB_M_REC REC '+
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = REC.ID_CLIENTE ' +
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
           ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO '+
           ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA=REC.ID_EMPRESA '+
           ' LEFT OUTER JOIN cad_tb_c_fun fun ON fun.ID_FUNCIONARIO = REC.ID_VENDEDOR '+
           ' LEFT OUTER JOIN cad_tb_c_fun fuc ON fuc.ID_FUNCIONARIO = CLI.ID_VENDEDOR '+
           ' LEFT OUTER JOIN cad_tb_c_ctc ctc ON ctc.ID_CONTA = REC.BOL_ID_CONTA '+
           ' LEFT OUTER JOIN cad_tb_c_cid cid ON cid.ID_CIDADE = CLI.ID_CIDADE '+
           ' LEFT OUTER JOIN fat_tb_m_nfe nfe ON nfe.ID_FISCAL = REC.ID_FISCAL ';
           case Input[9] of
               0: CondicaoOrder := ''  ;
               1: CondicaoOrder := ' INT_NOMECLI ';
               2: CondicaoOrder := ' REC.ID_PLANO ';
               3: CondicaoOrder := ' REC.ID_FORMA_PAG ';
               7: CondicaoOrder := ' int_codvnd ';
               8: CondicaoOrder := ' REC.ID_CLIENTE ';
               9: CondicaoOrder := ' INT_CODCIDADE ';
               10: CondicaoOrder := ' INT_NOMECLI ';
           end;

       end;
    if (Input[9] = 5) then
       begin
         enSqlRec :=
            ' SELECT rec.iD_PLANO, PCT.DESCRICAO AS INT_NOMEPCT, sum(COALESCE(rec.vlr_parcela,0)) as vlr_parcela,fpg.doc_impresso,rec.car_taxa, ' +
            '        sum(COALESCE(rec.vlr_saldo,0)) as vlr_saldo '+
            ' FROM FIN_TB_M_REC REC '+
            ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = REC.ID_CLIENTE '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA = REC.ID_EMPRESA ';

         CondicaoOrder := ' REC.ID_PLANO, PCT.DESCRICAO,fpg.doc_impresso,rec.car_taxa ';
       end;
    if (Input[9] = 6) then
       begin
         enSqlRec :=
            ' SELECT rec.id_forma_pag, FPG.DESCRICAO AS INT_NOMEFPG, sum(COALESCE(rec.vlr_parcela,0)) as vlr_parcela,fpg.doc_impresso,rec.car_taxa, ' +
            '      sum(COALESCE(rec.vlr_saldo,0)) as vlr_saldo '+
            ' FROM FIN_TB_M_REC REC '+
            ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE = REC.ID_CLIENTE '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_LTO LTO ON LTO.ID_LOCAL_TITULO = REC.ID_LOCAL_TITULO '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_par_ctr CTR ON CTR.ID_EMPRESA=REC.ID_EMPRESA ';

         CondicaoOrder := ' REC.id_forma_pag, FPG.DESCRICAO,fpg.doc_impresso,rec.car_taxa ';
       end;

  FIN_SQ_R_REC_ABE.Close;
  FIN_SQ_R_REC_ABE.CommandText :='';

  if Input[13]=0 then
     begin
         FIN_SQ_R_REC_ABE.CommandText := enSqlRec + ' WHERE 1=1 and rec.vlr_saldo>0 ';
     end;

  if Input[13]=2 then
     begin
         FIN_SQ_R_REC_ABE.CommandText := enSqlRec + ' WHERE 1=1 ';
     end;


  Condicao:='';

  if Input[9]=8 then
    begin
     FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText + ' and fpg.doc_impresso=4';
    end;


  if Input[0] = 0 then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end

  else if Input[0] = 1 then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
         ' AND REC.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

  else if Input[0] = 2 then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

  if Input[3] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;




   if Input[10] <> '' then
      begin
        if Input[12]=1 then
          begin
            FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
               ' AND REC.ID_VENDEDOR in (' + VarToStr(Input[10]) +') ';
            Condicao := Condicao +
               ' AND REC.ID_VENDEDOR in (' + VarToStr(Input[10]) +') ';
          end
        else if Input[12]=0 then
          begin
            FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
               ' AND CLI.ID_VENDEDOR in (' + VarToStr(Input[10]) +') ';
            Condicao := Condicao +
               ' AND CLI.ID_VENDEDOR in (' + VarToStr(Input[10]) +') ';
          end;
      end;


   if Input[11] <> '' then
      begin
        FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText  +
             ' AND CID.ID_CIDADE in (' + VarToStr(Input[11]) +') ';
        Condicao := Condicao +
             ' AND CID.ID_CIDADE in (' + VarToStr(Input[11]) +') ';
      end;

   if Input[14]<>'' then
      begin
        FIN_SQ_R_REC_ABE.CommandText :=  FIN_SQ_R_REC_ABE.CommandText  +
             ' AND NFE.ID_ORS =  ''' + VarToStr(Input[14]) +''' ';
      end;

  //Define ordenao dos relatorios
  if (Input[9] = 0) or (Input[9] = 1) or (Input[9] = 2) or (Input[9] = 3) or (Input[9] = 7) OR (Input[9] = 8) OR
     (Input[9] = 9) or (Input[9] = 10) then
     begin
       if Input[8] = 0 then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                   ' ORDER BY REC.DTA_EMISSAO '
            else
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                    ' ORDER BY ' + CondicaoOrder + ' , ' + ' REC.DTA_EMISSAO ';
          end
       else if Input[8] = 1  then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                   ' ORDER BY REC.DTA_VENCIMENTO '
            else
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                   ' ORDER BY ' + CondicaoOrder + ' , ' + ' REC.DTA_VENCIMENTO ';
          end
       else if Input[8] =2  then
          begin
            if CondicaoOrder = '' then
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                   ' ORDER BY CLI.NOME '
            else
               FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
                   ' ORDER BY ' + CondicaoOrder + ' , ' + ' CLI.NOME ';
          end;
     end
  else
     begin
       if (Input[9] = 5) then
          FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
               ' GROUP BY ' + CondicaoOrder +
               ' ORDER BY ' + CondicaoOrder;
       if (Input[9] = 6) then
          FIN_SQ_R_REC_ABE.CommandText := FIN_SQ_R_REC_ABE.CommandText +
               ' GROUP BY ' + CondicaoOrder +
               ' ORDER BY ' + CondicaoOrder;
     end;


  if (Input[9] = 4)  then
       begin
         enSqlRec :=
           ' Select '''+'MAIS DE 180 DIAS '+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=181 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (REC.VLR_SALDO>0)  and '+
           '      REC.DTA_VENCIMENTO<current_date and '+
           '      (current_date-REC.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-REC.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  91 A 120 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  61 A  90 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On REC.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE  31 A  60 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLINETE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '       rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=31 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=60 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MENOS DE 30 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, cli.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLINETE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=30 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'EM ATE 29 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLINETE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '       rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=29 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 30 A 60 DIAS  '+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and '+
           '       rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=69 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 61 A 90 DIAS  '+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_FORNECEDOR, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 91 A 120 DIAS '+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_FORNECEDOR, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_FORNECEDOR, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = rec.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0)  and '+
           '      rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-rec.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MAIS DE 180 DIAS '+''' Prazo,fpg.doc_impresso, '+
           '       rec.ID_FORMA_PAG, rec.NUM_PARCELA, rec.DTA_EMISSAO,rec.car_taxa, '+
           '       rec.DTA_VENCIMENTO, rec.ID_CLINETE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       rec.VLR_SALDO, rec.vlr_parcela '+
           ' from FIN_TB_M_REC rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = REC.ID_FORMA_PAG '+
           ' Where (rec.VLR_SALDO>0) and '+
           '      rec.DTA_VENCIMENTO<current_date and  '+
           '      (current_date-rec.DTA_VENCIMENTO)>180 '+Condicao+' ' +
           ' order by prazo ';
           FIN_SQ_R_REC_ABE.CommandText :=  enSqlRec;
       end;

   //GerarSqlTxt(FIN_SQ_R_REC_ABE);
   Result := FIN_DP_R_REC_ABE.Data;
end;

function TSM.FIN_DP_R_REC_ABE_PPGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlRecAbePpg, Condicao, CondicaoOrder: String;
begin

 enSqlRecAbePpg      := '';
  CondicaoOrder := '';
  { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 25-11-2014 }


  FIN_SQ_R_REC_ABE_PPG.Close;
  FIN_SQ_R_REC_ABE_PPG.CommandText :='';


  FIN_SQ_R_REC_ABE_PPG.CommandText := enSqlRecAbePpg + ' WHERE 1=1 ';


  Condicao:='';

  if Input[0] = 0 then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText +
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end

  else if Input[0] = 1 then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText +
         ' AND REC.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

  else if Input[0] = 2 then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText +
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

  if Input[3] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText  +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText  +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText  +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText  +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PPG.CommandText := FIN_SQ_R_REC_ABE_PPG.CommandText  +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;


  if (Input[8] = 4)  then
       begin
         enSqlRecAbePpg :=
           // Vencidos
            ' Select '''+'A PARTIR DE 181 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=181 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 91 A 120 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 61 A 90 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 30 A 60 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=60 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'MENOS DE 30 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<30 '+Condicao+' '+

           // A vencer

           ' Union All '+
           ' Select '''+'EM AT 29 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=29 '+Condicao+' '+

           ' Union All '+
           ' Select '''+'DE 30 A 60 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=60 '+Condicao+' '+
                    ' Union All '+
           ' Select '''+'DE 61 A 90 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=90 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 91 A 120 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=120 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 121 A 150 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=150 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'DE 151 A 180 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=180 '+Condicao+' '+
           ' Union All '+
           ' Select '''+'A PARTIR DE 181 DIAS'+''' Prazo, fpg.doc_impresso,rec.car_taxa, '+
           '       Rec.ID_FORMA_PAG, Rec.NUM_PARCELA, Rec.DTA_EMISSAO, '+
           '       rec.dta_original,Rec.DTA_VENCIMENTO, Rec.ID_CLIENTE, CLI.NOME AS INT_NOMECLI, '+
           '       (current_date-Rec.DTA_VENCIMENTO) INT_ATRASO, '+
           '       FPG.DESCRICAO AS INT_NOMEFPG, '+
           '       Rec.VLR_SALDO, Rec.vlr_parcela '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=181 '+Condicao+' '+
           ' order by prazo, dta_vencimento ';
           FIN_SQ_R_REC_ABE_PPG.CommandText :=  enSqlRecAbePpg;
       end;

   //GerarSqlTxt(FIN_SQ_R_REC_ABE_PPG);
   Result := FIN_DP_R_REC_ABE_PPG.Data;

   FIN_SQ_R_REC_ABE_PPG.Close;
end;

function TSM.FIN_DP_R_REC_ABE_PRRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  enSqlRecAbePrr, Condicao, CondicaoOrder: String;
begin

  enSqlRecAbePrr      := '';
  CondicaoOrder := '';
  { TODO -oMaxsuel -cCriao : Criado por Maxsuel em 25-11-2014 }


  FIN_SQ_R_REC_ABE_PRR.Close;
  FIN_SQ_R_REC_ABE_PRR.CommandText :='';


  FIN_SQ_R_REC_ABE_PRR.CommandText := enSqlRecAbePrr + ' WHERE 1=1 ';


  Condicao:='';

  if Input[0] = 0 then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText +
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

      end
  else if Input[0] = 1 then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText +
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
        Condicao :=
         ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
         '       REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end;

  if Input[3] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText  +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;
  if Input[4] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText  +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[4]) +') ';
      end;
  if Input[5] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText  +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText  +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_LOCAL_TITULO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[7] <> '' then
      begin
        FIN_SQ_R_REC_ABE_PRR.CommandText := FIN_SQ_R_REC_ABE_PRR.CommandText  +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
        Condicao := Condicao +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[7]) +') ';
      end;


  if (Input[8] = 4)  then
       begin
         enSqlRecAbePrr :=
           // Vencidos
           ' select ' +
           ' (Select coalesce(sum(Rec.VLR_SALDO),0) '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=181 '+Condicao+') VEN_A_PARTIR_181, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=180 '+Condicao+') VEN_DE_151_180, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=150 '+Condicao+') VEN_DE_121_150, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=120 '+Condicao+') VEN_DE_91_120, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=90 '+Condicao+') VEN_DE_61_90, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=60 '+Condicao+') VEN_DE_30_60, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO<current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<30 '+Condicao+') VEN_DE_30_60, '+

           // A vencer

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=0 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=29 '+Condicao+') AVEN_29, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=30 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=60 '+Condicao+') AVEN_30_60, '+

           ' (Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=61 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=90 '+Condicao+') AVEN_61_90, '+

           '(Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=91 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=120 '+Condicao+') AVEN_91_120, '+

           '(Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0)  and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=121 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=150 '+Condicao+') AVEN_121_150, '+

           '(Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and '+
           '      Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=151 and '+
           '      (current_date-Rec.DTA_VENCIMENTO)<=180 '+Condicao+') AVEN_151_180, '+

           '(Select coalesce(sum(Rec.VLR_SALDO,0))  '+
           ' from FIN_TB_M_REC Rec '+
           ' Left Outer Join CAD_TB_C_CLI CLI On CLI.ID_CLIENTE=Rec.ID_CLIENTE '+
           ' left outer join cad_tb_c_fpg FPG ON FPG.ID_FORMA_PAG = Rec.ID_FORMA_PAG '+
           ' Where (Rec.VLR_SALDO>0) and Rec.DTA_VENCIMENTO>current_date and '+
           '      (current_date-Rec.DTA_VENCIMENTO)>=181 '+Condicao+') AVEN_A_PARTIR_181,  '+
           ' from  ';
           FIN_SQ_R_REC_ABE_PPG.CommandText :=  enSqlRecAbePrr;
       end;

   //GerarSqlTxt(FIN_SQ_R_REC_ABE_PPG);
   Result := FIN_DP_R_REC_ABE_PPG.Data;
end;

function TSM.FIN_DP_R_REC_BXADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var enSqlRecBxa, CondicaoOrder: String;
begin
  { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 10/11/2014 }

    enSqlRecBxa:='';

    //  Input[0]  Empresa
    //  Input[1]  Data inicial
    //  Input[2]  Data final
    //  Input[3]  Clientes
    //  Input[4]  Formas de pagamento
    //  Input[5]  Plano de contas
    //  Input[6]  Centro de Custo
    //  Input[7]  Ordenao
    //  Input[8]  Relatrio
    //             - 0 - > Geral
    //             - 1 - > Por cliente
    //             - 2 - > Por plano de contas
    //             - 3 - > Por forma de pagamento
    //             - 4 - > Resumo por plano de contas
    //             - 5 - > Resumo por foma de pagamento
    //             - 6 - > Por Vendedor
    //  Input[9]  Vendedor





    CondicaoOrder := '';

    if (Input[8] = 0) or (Input[8] = 1) or (Input[8] = 2) or (Input[8] = 3) or (Input[8] = 6) or (Input[8] = 7) or (Input[8] = 8) then
       begin
         enSqlRecBxa :=
           '  SELECT REC_PAG.*, fpg.doc_impresso, rec.car_taxa, '+
           '  COALESCE(REC_PAG.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, '+
           '  case '+
           '   when REC_PAG.ORIGEM = ''0'' then CAST(''Baixa do Contas a Receber'' as VARCHAR(50)) '+
           '   when REC_PAG.ORIGEM = ''1'' then CAST(''Nota Fiscal de Sada'' as VARCHAR(50)) '+
           '   when REC_PAG.ORIGEM = ''2'' then CAST(''Movimento de Cheque'' as VARCHAR(50)) '+
           '   when REC_PAG.ORIGEM = ''3'' then CAST(''Baixa Automtica de Boleto'' as VARCHAR(50)) '+
           '   when REC_PAG.ORIGEM = ''4'' then CAST(''Baixa de Cartes de Crdito'' as VARCHAR(50)) '+
           '  end as INT_DESCORIGEM, '+
           '        REC.num_parcela, '+
           '        REC.dta_emissao,rec.dta_original, REC.dta_vencimento, '+
           '        REC.ID_VENDEDOR, fun.nome as int_nomeven, ';

         if Input[14]=0 then
           begin
             enSqlRecBxa := enSqlRecBxa + ' cli.id_vendedor as int_codvnd,fuc.nome as int_nomevnd,  ';
           end
         else if Input[14]=1 then
           begin
             enSqlRecBxa := enSqlRecBxa + ' rec.id_vendedor as int_codvnd,fun.nome as int_nomevnd, ';
           end;

         enSqlRecBxa := enSqlRecBxa +
           '        REC.VLR_PARCELA as vlr_titulo, '+
           '        REC.id_cliente, CLI.NOME      AS INT_NOMECLI, ' +
           '        REC.BOL_NOSSO_NUMERO, '+
           '        ctc.banco as int_banco, '+
           '        ctc.agencia as int_agencia,  '+
           '        ctc.descricao as int_descconta, '+
           '        ctc.conta_corrente as int_contacorrente, '+
           '        REC.id_forma_pag as int_cod_fpg_bxa, '+
           '        FPG.DESCRICAO AS INT_NOMEFPG, ' +
           '        PCT.DESCRICAO AS INT_NOMEPCT, ' +
           '        CCU.descricao AS INT_NOMECCU, ' +
           '        cid.id_cidade as int_codcidade, '+
           '        cid.nome as int_nomecid, '+
           '        cid.uf as int_nomeuf, nfe.numero as int_numeronf, nfe.id_ors as int_id_ors '+
           ' FROM  FIN_TB_M_REC_PAG REC_PAG ' +
           ' LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO       = REC_PAG.ID_TITULO   ' +
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO  = REC.ID_VENDEDOR ' +
           ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO  = REC.ID_VENDEDOR ' +
           ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE      = REC.ID_CLIENTE '+
           ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG    = REC.ID_FORMA_PAG '+
           ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO        = REC.ID_PLANO '+
           ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto       = REC_PAG.ID_CCUSTO '+
           ' LEFT OUTER JOIN cad_tb_c_ctc ctc ON ctc.ID_CONTA        = REC.BOL_ID_CONTA '+
           ' LEFT OUTER JOIN cad_tb_c_cid cid ON cid.ID_CIDADE       = CLI.ID_CIDADE '+
           ' LEFT OUTER JOIN fat_tb_m_nfe nfe ON nfe.ID_FISCAL       = REC.ID_FISCAL ';

           case Input[8] of
              0: CondicaoOrder := '';
              1: CondicaoOrder := ' INT_NOMECLI,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
              2: CondicaoOrder := ' REC.ID_PLANO,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
              3: CondicaoOrder := ' int_cod_fpg_bxa,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
              6: CondicaoOrder := ' int_codvnd,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
              7: CondicaoOrder := ' REC.ID_CLIENTE,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
              8: CondicaoOrder := ' INT_CODCIDADE,REC.CAR_TAXA, FPG.DOC_IMPRESSO ';
           end;
       end;
    if (Input[8] = 4) then
       begin
         enSqlRecBxa :=
            ' SELECT COALESCE(REC_PAG.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, fpg.doc_impresso, '+
            ' REC.ID_PLANO, PCT.DESCRICAO AS INT_NOMEPCT, rec.car_taxa, ' +
            '  sum(COALESCE(REC_PAG.vlr_pagamento,0)) as vlr_pagamento ' +
            ' FROM  FIN_TB_M_REC_PAG REC_PAG ' +
            ' LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO     = REC_PAG.ID_TITULO ' +
            ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE    = REC.ID_CLIENTE '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG  = REC.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO  = REC.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto = REC_PAG.ID_CCUSTO ';

            CondicaoOrder := 'INT_SUBSTITUICAO,REC.ID_PLANO,PCT.DESCRICAO,fpg.doc_impresso,rec.car_taxa ';
       end;
    if (Input[8] = 5) then
       begin
         enSqlRecBxa :=
            ' SELECT  COALESCE(REC_PAG.COM_SUBSTITUICAO,FALSE) AS INT_SUBSTITUICAO, fpg.doc_impresso, '+
            ' REC.id_forma_pag, FPG.DESCRICAO AS INT_NOMEFPG, rec.car_taxa, ' +
            '        sum(COALESCE(REC_PAG.vlr_pagamento,0)) as vlr_pagamento '+
            ' FROM FIN_TB_M_REC_PAG REC_PAG ' +
            ' LEFT OUTER JOIN FIN_TB_M_REC REC ON REC.ID_TITULO     = REC_PAG.ID_TITULO ' +
            ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE    = REC.ID_CLIENTE '+
            ' LEFT OUTER JOIN CAD_TB_C_FPG FPG ON FPG.ID_FORMA_PAG  = REC.ID_FORMA_PAG '+
            ' LEFT OUTER JOIN CAD_TB_C_PCT PCT ON PCT.ID_PLANO = REC.ID_PLANO '+
            ' LEFT OUTER JOIN cad_tb_c_ccu CCU ON CCU.id_ccusto= REC_PAG.ID_CCUSTO ';

            CondicaoOrder := 'INT_SUBSTITUICAO, REC.id_forma_pag, FPG.DESCRICAO,fpg.doc_impresso,rec.car_taxa ';
       end;

  FIN_SQ_R_REC_BXA.Close;
  FIN_SQ_R_REC_BXA.CommandText :='';


  FIN_SQ_R_REC_BXA.CommandText := enSqlRecBxa +
          ' WHERE REC.ID_EMPRESA in (' + VarToStr(Input[0]) +') ';

  if (Input[8] = 7) then
    begin
       FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
          ' AND FPG.DOC_IMPRESSO = 4 ';
    end;

  if (Input[10] = '0') then
    begin
       FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
       ' AND REC.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
       '     REC.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
    end;

  if (Input[10] = '1') then
    begin
      FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
       ' AND REC.DTA_ORIGINAL >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
       '     REC.DTA_ORIGINAL <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
    end;

  if (Input[10] = '2') then
    begin
      FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
       ' AND REC.DTA_VENCIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
       '     REC.DTA_VENCIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
    end;

  if (Input[10] = '3') then
    begin
      FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
       ' AND REC_PAG.DTA_PAGAMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
       '     REC_PAG.DTA_PAGAMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
    end;

  if Input[3] <> '' then
      begin
        FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
             ' AND REC.ID_CLIENTE in (' + VarToStr(Input[3]) +') ';
      end;

  if Input[4] <> '' then
      begin
        FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
             ' AND REC.ID_FORMA_PAG in (' + VarToStr(Input[4]) +') ';
      end;

  if Input[5] <> '' then
      begin
        FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
             ' AND REC.ID_PLANO in (' + VarToStr(Input[5]) +') ';
      end;

  if Input[6] <> '' then
      begin
        FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
             ' AND REC_PAG.ID_CCUSTO in (' + VarToStr(Input[6]) +') ';
      end;

  if Input[9] <> '' then
     begin
       if Input[14]=1 then
          begin
           FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
               ' AND REC.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
          end
       else if Input[14]=0 then
          begin
            FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText  +
               ' AND CLI.ID_VENDEDOR in (' + VarToStr(Input[9]) +') ';
          end;
     end;

  if Input[11] <> '' then
     begin
       FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
             ' AND REC_PAG.ID_FORMA_PAG in ('+ VarToStr(Input[11]) +') ';
     end;

  if Input[12] <> '' then
     begin
       FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
             ' AND CID.ID_CIDADE in ('+ VarToStr(Input[12]) +') ';
     end;

  if Input[15]<>'' then
      begin
        FIN_SQ_R_REC_BXA.CommandText :=  FIN_SQ_R_REC_BXA.CommandText  +
             ' AND NFE.ID_ORS =  ''' + VarToStr(Input[15]) +''' ';
      end;

   // Define ordenao dos relatorios
   if strtoint(Input[8]) in [0,1,2,3,6,7,8] then //Relatorio por Forma de Pagamento
      begin
         if Input[7] =0 then
            begin
             if CondicaoOrder = '' then
                FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                   ' ORDER BY INT_SUBSTITUICAO,REC.DTA_EMISSAO '
             else
                 FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' REC.DTA_EMISSAO ';
            end
         else if Input[7] = 1  then
            begin
              if CondicaoOrder = '' then
                  FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO,REC.DTA_VENCIMENTO '
              else
                 FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' REC.DTA_VENCIMENTO ';
            end
         else if Input[7] =2 then
            begin
              if CondicaoOrder = '' then
                  FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO,CLI.NOME '
              else
                  FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                     ' ORDER BY INT_SUBSTITUICAO, ' + CondicaoOrder + ' , ' + ' CLI.NOME ';
            end;
      end
   else if Input[8] = 4 then //Relatorio por Forma de Pagamento
        begin
          FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
                ' GROUP BY ' + CondicaoOrder +
                ' ORDER BY ' + CondicaoOrder;
        end
   else if Input[8] = 5 then //Relatorio por Forma de Pagamento
        begin
          FIN_SQ_R_REC_BXA.CommandText := FIN_SQ_R_REC_BXA.CommandText +
              ' GROUP BY ' + CondicaoOrder +
              ' ORDER BY ' + CondicaoOrder;
        end;

   //GerarSqlTxt(FIN_SQ_R_REC_BXA);

   Result := FIN_DP_R_REC_BXA.Data;

   FIN_SQ_R_REC_BXA.Close;


end;


function TSM.FIS_DP_R_LAIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelLai: String;
  begin
    Result := ' SELECT nfe.id_cfo,cfo.descricao, nfe.ind_operacao, cfo.id_classe, ' +
              '         COALESCE(sum(nfe.icm_n_base),0) as vlr_base,              ' +
              '         COALESCE(sum(nfe.vlr_liquido),0) as vlr_contabil,         ' +
              '         COALESCE(sum(nfe.icm_n_valor),0) as vlr_icms,             ' +
              '         COALESCE(sum(nfe.vlr_isenta),0) as vlr_isenta,            ' +
              '         COALESCE(sum(nfe.vlr_outras),0) as vlr_outras             ' +
              '  FROM fat_tb_m_nfe nfe                                            ' +
              '  left outer join cad_tb_c_cfo cfo on cfo.id_cfo = nfe.id_cfo      ' +
              '  where nfe.tipo_nf in (''S'',''R'',''E'',''D'') and nfe.status = 1 ';
  end;
begin
  FIS_SQ_R_LAI.Close;
  FIS_SQ_R_LAI.CommandText := enSqlRelLai + ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
       ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +
       ''' AND '+ ' NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
       '  group by 1,2,3,4   ' +
       '  order by nfe.id_cfo';
  Result := FIS_DP_R_LAI.Data;
  FIS_SQ_R_LAI.Close;

end;

function TSM.FIS_DP_R_LREDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelLre: String;
  begin
    Result := ' SELECT nfe.dta_documento as dta_entrada, ' +
              ' nfe.modelo as Esp, nfe.serie, nfe.numero, nfe.dta_emissao,  ' +
              '         nfe.id_emitente, nfe.uf_emitente as estado, nfe.id_cfo, nfe.vlr_liquido as vlr_contabil, nfe.icm_n_base, ' +
              '         nfe.icm_n_valor as Imposto_creditado, ' +
              '         case when nfe.nfe_cod_sit = ''02'' then ''**Nota Fiscal Cancelada'' end Observacao ' +
              ' FROM fat_tb_m_nfe nfe ' +
              '      left outer join cad_tb_c_for fon on fon.id_fornecedor = nfe.id_emitente ' +
              '      left outer join cad_tb_c_cid cid on cid.id_cidade = fon.id_cidade ' +
              '  where nfe.tipo_nf in (''E'',''R'') and nfe.status = 1 ';
  end;
begin
  FIS_SQ_R_LRE.Close;
  FIS_SQ_R_LRE.CommandText := enSqlRelLre + ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
       ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +
       ''' AND '+ ' NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
       ' order by nfe.dta_emissao, nfe.numero ';
  Result := FIS_DP_R_LRE.Data;
  FIS_SQ_R_LRE.Close;

end;

function TSM.FIS_DP_R_LRSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelLrs: String;
  begin
    Result := ' SELECT nfe.dta_documento as dta_entrada, nfe.modelo as Esp, nfe.serie, nfe.numero, nfe.dta_emissao,  ' +
              '         nfe.id_emitente, nfe.uf_emitente as estado, nfe.id_cfo, nfe.vlr_liquido as vlr_contabil, nfe.icm_n_base, ' +
              '         nfe.vlr_isenta,nfe.vlr_outras,        ' +
              '         nfe.icm_n_valor as Imposto_creditado, ' +
              '         case when nfe.nfe_cod_sit = ''02'' then ''**Nota Fiscal Cancelada'' end Observacao ' +
              ' FROM fat_tb_m_nfe nfe ' +
              '      left outer join cad_tb_c_cli cli on cli.id_cliente = nfe.id_emitente ' +
              '      left outer join cad_tb_c_cid cid on cid.id_cidade = cli.id_cidade ' +
              '  where nfe.tipo_nf in (''S'',''D'') and nfe.status = 1 ';
  end;
begin
  FIS_SQ_R_LRS.Close;
  FIS_SQ_R_LRS.CommandText := enSqlRelLrs + ' AND NFE.ID_EMPRESA in (' + VarToStr(Input[0]) +') ' +
       ' AND NFE.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +
       ''' AND '+ ' NFE.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
       ' order by nfe.dta_emissao, nfe.numero ';
  Result := FIS_DP_R_LRS.Data;
  FIS_SQ_R_LRS.Close;
end;

function TSM.CAD_DP_C_ALMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpAlm: String;
  begin
    Result :=
              '  select alm.*, obr.descricao as int_nomeobr from CAD_TB_C_ALM alm   ' +
              '     left outer join ctc_tb_c_obr obr on obr.id_obra = alm.id_obra  ';

  end;
begin
   CAD_SQ_C_ALM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           CAD_SQ_C_ALM.CommandText := enSqlPcpAlm + ' WHERE 1=2 '
        else
           CAD_SQ_C_ALM.CommandText := enSqlPcpAlm +
             ' WHERE ALM.ID_ALMOXARIFADO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        CAD_SQ_C_ALM.CommandText := enSqlPcpAlm +
          Format('WHERE upper(ALM.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 90 then
      begin
        CAD_SQ_C_ALM.CommandText := enSqlPcpAlm +
           ' WHERE ALM.ID_ALMOXARIFADO NOT IN (' + VarToStr(Input[1]) +') ';
      end;
    if Input[0] = 91 then
      begin
        CAD_SQ_C_ALM.CommandText := enSqlPcpAlm +
           ' WHERE ALM.ID_ALMOXARIFADO IN (' + VarToStr(Input[1]) +') ';
      end;
   Result := CAD_DP_C_ALM.Data;
end;

function TSM.CAD_DP_C_AUSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlAus: String;
  begin
    Result :=
      ' select AUS.*, fun.nome as int_nomefuncionario, fun.id_perfil_seg as int_id_perfilseg, ' +
      '        pes.descricao as int_perfilseg '+
      ' from cad_tb_c_aus AUS '+
      ' left outer join cad_tb_c_fun fun on fun.id_funcionario=aus.id_funcionario '+
      ' left outer join cad_tb_c_pes pes on pes.id_perfil_seg=fun.id_perfil_seg ';
  end;
begin
  CAD_SQ_C_AUS.Close;
  if Input[0] = 0 then
    begin
      if Trim(VarToStr(Input[1])) = '' then
         CAD_SQ_C_AUS.CommandText := enSqlAus + ' WHERE 1=2 '
      else
         CAD_SQ_C_AUS.CommandText := enSqlAus +
           ' WHERE AUS.ID_FUNCIONARIO = ''' + VarToStr(Input[2]) +''' '+
           ' AND AUS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
    end
  else if Input[0] = 1 then
    begin
      CAD_SQ_C_AUS.CommandText := enSqlAus +
        Format('WHERE upper(FUN.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))])+
        ' AND AUS.ID_EMPRESA = ''' + VarToStr(Input[1]) +''' ';
    end;
  Result := CAD_DP_C_AUS.Data;
end;

procedure TSM.CAD_DP_C_AUSGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.CAD_DP_C_AUSUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
    { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 21/03/2019 }
  enAudGravar(Sender,DataSet);
end;

function TSM.PCP_DP_C_CDPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCdp: String;
  begin
    Result :=
      'select cdp.* , ITE.DESCRICAO AS INT_NOMEITE '+
      'from PCP_TB_C_CDP CDP '+
      'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=CDP.ID_ITEM ';
  end;
begin
   PCP_SQ_C_CDP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CDP.CommandText := enSqlPcpCdp + ' WHERE 1=2 '
        else
           PCP_SQ_C_CDP.CommandText := enSqlPcpCdp +
             ' WHERE CDP.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CDP.CommandText := enSqlPcpCdp +
          Format('WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_CDP.Data;

end;

function TSM.PCP_DP_C_CDRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCdr: String;
  begin
    Result :=
      'select CDR.* , GRU.DESCRICAO AS INT_NOMEGRU, COC.DESCRICAO AS INT_NOMECOC, '+
      'COG.DESCRICAO AS INT_NOMECOG '+
      'from PCP_TB_C_CDR CDR '+
      'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = CDR.ID_GRUPO '+
      'LEFT OUTER JOIN CAD_TB_C_COR COC ON COC.ID_COR=CDR.ID_COR_CADARCO '+
      'LEFT OUTER JOIN CAD_TB_C_COR COG ON COG.ID_COR=CDR.ID_COR_GRUPO ';

  end;
begin
   PCP_SQ_C_CDR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CDR.CommandText := enSqlPcpCdr + ' WHERE 1=2 '
        else
           PCP_SQ_C_CDR.CommandText := enSqlPcpCdr +
             ' WHERE CDR.ID_CDR = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := PCP_DP_C_CDR.Data;
end;

function TSM.PCP_DP_C_CINDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCin: String;
  begin
    Result :=
      'select cin.*, '+
      '  foc.descricao as int_marca, '+
      '  inm.nro_serie as int_serie, '+
      '  inm.resolucao_menor_divisao as int_resolucao, '+
      '  inm.scala as int_scala, '+
      '  tin.descricao as int_denominacao, '+
      '  inm.sigla as int_sigla, '+
      '  mde.descricao as int_modelo '+
      'from PCP_TB_C_CIN cin '+
      'left outer join pcp_tb_c_ins inm on inm.id_ins=cin.id_ins '+
      'left outer join cad_tb_c_for foc on foc.id_fornecedor=inm.id_fabricante '+
      'left outer join pcp_tb_c_tin tin on tin.id_tin=inm.id_tin '+
      'left outer join pcp_tb_c_mde mde on mde.id_mde=inm.id_mde ';
  end;
begin
   PCP_SQ_C_CIN.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CIN.CommandText := enSqlPcpCin + ' WHERE 1=2 '
        else
           PCP_SQ_C_CIN.CommandText := enSqlPcpCin +
             ' WHERE CIN.ID_CIN = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CIN.CommandText := enSqlPcpCin +
          Format('WHERE upper(CIN.historico_instrumento) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_CIN.Data;
end;

function TSM.PCP_DP_C_CLEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlCle: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_CLE  ';
  end;
begin
   { TODO -oLuan : Criado no dia 05/11/2015 }
   PCP_SQ_C_CLE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CLE.CommandText := enSqlCle + ' WHERE 1=2 '
        else
           PCP_SQ_C_CLE.CommandText := enSqlCle +
             ' WHERE ID_CLE= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CLE.CommandText := enSqlCle +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_CLE.Data;
end;

function TSM.PCP_DP_C_CNFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCnf: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_CNF  ';
  end;
begin
   PCP_SQ_C_CNF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CNF.CommandText := enSqlPcpCnf + ' WHERE 1=2 '
        else
           PCP_SQ_C_CNF.CommandText := enSqlPcpCnf +
             ' WHERE ID_CONFORMIDADE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CNF.CommandText := enSqlPcpCnf +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_CNF.Data;
end;

function TSM.PCP_DP_C_CRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCrg: String;
  begin
    Result :=
      'select CRG.* , SEC.DESCRICAO AS INT_NOMESET '+
      'from PCP_TB_C_CRG CRG '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=CRG.ID_SETOR ';
  end;
begin
   PCP_SQ_C_CRG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CRG.CommandText := enSqlPcpCrg + ' WHERE 1=2 '
        else
           PCP_SQ_C_CRG.CommandText := enSqlPcpCrg +
             ' WHERE CRG.ID_CARGO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CRG.CommandText := enSqlPcpCrg +
          Format('WHERE upper(CRG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
        PCP_SQ_C_CRG.CommandText := PCP_SQ_C_CRG.CommandText +' ORDER BY CRG.DESCRICAO ';
      end;
   Result := PCP_DP_C_CRG.Data;
end;

function TSM.PCP_DP_C_CUEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlCue: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_CUE  ';
  end;
begin
   { TODO -oLuan : Criado no dia 05/11/2015 }
   PCP_SQ_C_CUE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_CUE.CommandText := enSqlCue + ' WHERE 1=2 '
        else
           PCP_SQ_C_CUE.CommandText := enSqlCue +
             ' WHERE ID_CUE= ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_CUE.CommandText := enSqlCue +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_CUE.Data;
end;

function TSM.PCP_DP_C_DISDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpDis: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_DIS  ';
  end;
begin
   PCP_SQ_C_DIS.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_DIS.CommandText := enSqlPcpDis + ' WHERE 1=2 '
        else
           PCP_SQ_C_DIS.CommandText := enSqlPcpDis +
             ' WHERE ID_DIS = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_DIS.CommandText := enSqlPcpDis +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_DIS.Data;
end;

function TSM.PCP_DP_C_ESPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpEsp: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_ESP  ';
  end;
begin
   PCP_SQ_C_ESP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_ESP.CommandText := enSqlPcpEsp + ' WHERE 1=2 '
        else
           PCP_SQ_C_ESP.CommandText := enSqlPcpEsp +
             ' WHERE ID_ESPECIFICACAO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_ESP.CommandText := enSqlPcpEsp +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_ESP.Data;
end;

function TSM.PCP_DP_C_FPIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlPcpFpi: String;
  begin
    Result := ' select fpi.*, ite.descricao as int_nomeite,                       ' +
              '   ite.id_und_venda as int_undvenda, cor.descricao as int_nomecor, ' +
              '   tam.descricao as int_nometam from pcp_tb_c_fpi fpi              ' +
              '    left outer join cad_tb_c_ite ite on (ite.id_item     = fpi.id_item) '+
              '    left outer join cad_tb_c_cor cor on (cor.id_cor      = fpi.id_cor) ' +
              '    left outer join cad_tb_c_tam tam on (tam.id_tamanho  = fpi.id_tamanho) ';
  end;
begin
   PCP_SQ_C_FPI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_FPI.CommandText := enSqlPcpFpi + ' WHERE 1=2 '
        else
           PCP_SQ_C_FPI.CommandText := enSqlPcpFpi +
             ' WHERE fpi.id_fpi = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        PCP_SQ_C_FPI.CommandText := enSqlPcpFpi +
            ' WHERE fpi.id_item = ''' + VarToStr(Input[1]) +''' ';
      end;

   if Input[0] = 2 then
      begin
        PCP_SQ_C_FPI.CommandText := enSqlPcpFpi +
          Format('WHERE upper(ite.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   if Input[0] = 3 then
      begin
        PCP_SQ_C_FPI.CommandText := enSqlPcpFpi +
            ' WHERE fpi.id_item = ''' + VarToStr(Input[1]) +''' ' +
            '   and fpi.id_cor  = ''' + VarToStr(Input[2]) +''' ' +
            '   and fpi.id_tamanho = ''' + VarToStr(Input[3]) +''' ';
      end;

   Result := PCP_DP_C_FPI.Data;
   PCP_SQ_C_FPI.Close;
end;

function TSM.PCP_DP_C_FTEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpFte: String;
  begin
    Result := ' select * from pcp_tb_c_fte  ';
  end;
begin
   PCP_SQ_C_FTE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_FTE.CommandText := enSqlPcpFte + ' WHERE 1=2 '
        else
           PCP_SQ_C_FTE.CommandText := enSqlPcpFte +
             ' WHERE id_fte = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_FTE.CommandText := enSqlPcpFte +
          Format('WHERE upper(requisitos) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_FTE.Data;
end;

function TSM.PCP_DP_C_INSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpIns: String;
  begin
    Result :=
      'select INS.* ,FAB.DESCRICAO AS INT_NOMEFAB, MDE.DESCRICAO AS INT_NOMEMDE, '+
      '          TIN.DESCRICAO AS INT_NOMETIN '+
      'from PCP_TB_C_INS INS '+
      'LEFT OUTER JOIN CAD_TB_C_FOR FAB ON FAB.ID_FORNECEDOR=INS.ID_FABRICANTE '+
      'LEFT OUTER JOIN PCP_TB_C_MDE MDE ON MDE.ID_MDE = INS.ID_MDE '+
      'LEFT OUTER JOIN PCP_TB_C_TIN TIN ON TIN.ID_TIN = INS.ID_TIN ';
  end;
begin
   PCP_SQ_C_INS.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_INS.CommandText := enSqlPcpIns + ' WHERE 1=2 '
        else
           PCP_SQ_C_INS.CommandText := enSqlPcpIns +
             ' WHERE INS.ID_INS = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_INS.CommandText := enSqlPcpIns +
          Format('WHERE upper(MDE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_C_INS.CommandText := enSqlPcpIns +
          Format('WHERE upper(TIN.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
           PCP_SQ_C_INS.CommandText := enSqlPcpIns +
             ' WHERE INS.NRO_SERIE = ''' + VarToStr(Input[1]) +''' ';
      end;


   Result := PCP_DP_C_INS.Data;

end;

function TSM.PCP_DP_C_LMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpLme: String;
  begin
    Result :=
    'select LME.* , FUC.NOME AS INT_NOMERES '+
    'from PCP_TB_C_LME LME '+
    'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=LME.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_C_LME.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_LME.CommandText := enSqlPcpLme + ' WHERE 1=2 '
        else
           PCP_SQ_C_LME.CommandText := enSqlPcpLme +
             ' WHERE ID_LME = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_LME.CommandText := enSqlPcpLme +
          Format('WHERE upper(OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_LME.Data;
end;

function TSM.PCP_DP_C_MDEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpMde: String;
  begin
    Result := ' select * from PCP_TB_C_MDE  ';
  end;
begin
   PCP_SQ_C_MDE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_MDE.CommandText := enSqlPcpMde + ' WHERE 1=2 '
        else
           PCP_SQ_C_MDE.CommandText := enSqlPcpMde +
             ' WHERE ID_MDE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_MDE.CommandText := enSqlPcpMde +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_MDE.Data;

end;

function TSM.PCP_DP_C_MEQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpMeq: String;
  begin
    Result :=
      'select MEQ.*, '+
      ' mde.descricao as int_nomemde, '+
      ' fon.descricao as int_nomefab, '+
      ' sto.descricao as int_nomeset, '+
      ' fuc.nome as int_nomefuc, '+
      ' cor.descricao as int_nomecor '+
      'from PCP_TB_C_MEQ MEQ '+
      ' left outer join pcp_tb_c_mde mde on mde.id_mde=MEQ.id_mde '+
      ' left outer join cad_tb_c_for fon on fon.id_fornecedor=MEQ.id_fabricante '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=MEQ.id_resp_lancto ' +
      ' left outer join cad_tb_c_set sto on sto.id_setor = meq.id_setor '+
      ' left outer join cad_tb_c_cor cor on cor.id_cor = meq.id_cor ';
  end;
begin

   { TODO -oMaxsuel -cAlterao : Tive de inserir o left do campo ID_SETOR. por Maxsuel Victor em 18/10/2014 }

   PCP_SQ_C_MEQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq + ' WHERE 1=2 '
        else
           PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
             ' WHERE MEQ.ID_MEQ = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
          Format(' WHERE upper(MEQ.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
             ' WHERE MEQ.DTA_COMPRA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
          Format(' WHERE upper(MEQ.NRO_SERIE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
           Format('WHERE upper(MEQ.id_placa) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
           ' where meq.id_empresa='''+ VarToStr(Input[1])+''' '+
           ' and MEQ.ID_MEQ = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
           ' where meq.id_empresa='''+ VarToStr(Input[1])+''' '+
            Format(' and upper(MEQ.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 7 then
      begin
        PCP_SQ_C_MEQ.CommandText := enSqlPcpMeq +
           ' where meq.id_empresa='''+ VarToStr(Input[1])+''' '+
           ' AND upper(MEQ.id_placa)='''+uppercase(VarToStr(Input[2]))+''' ';
      end;

   //GerarSqlTxt(PCP_SQ_C_MEQ);
   Result := PCP_DP_C_MEQ.Data;

end;

function TSM.PCP_DP_C_MTADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpMta: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_MTA  ';
  end;
begin
   PCP_SQ_C_MTA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_MTA.CommandText := enSqlPcpMta + ' WHERE 1=2 '
        else
           PCP_SQ_C_MTA.CommandText := enSqlPcpMta +
             ' WHERE ID_MOTORISTA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_MTA.CommandText := enSqlPcpMta +
          Format('WHERE upper(NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_MTA.Data;
end;

function TSM.PCP_DP_C_ORIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOri: String;
  begin
    Result := ' select * from pcp_tb_c_ori ';
  end;
begin
   PCP_SQ_C_ORI.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_ORI.CommandText := enSqlPcpOri + ' WHERE 1=2 '
        else
           PCP_SQ_C_ORI.CommandText := enSqlPcpOri +
             ' WHERE ID_ORI = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_ORI.CommandText := enSqlPcpOri +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_ORI.Data;
end;

function TSM.PCP_DP_C_PRPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpPrp: String;
  begin
    Result :=
      'select PRP.* , ITE.DESCRICAO AS INT_NOMEITE, GRU.DESCRICAO AS INT_NOMEGRU '+
      'from PCP_TB_C_PRP PRP '+
      'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=PRP.ID_GRUPO '+
      'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=PRP.ID_ITEM ';
  end;
begin
   PCP_SQ_C_PRP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_PRP.CommandText := enSqlPcpPrp + ' WHERE 1=2 '
        else
           PCP_SQ_C_PRP.CommandText := enSqlPcpPrp +
             ' WHERE PRP.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_PRP.CommandText := enSqlPcpPrp + ' WHERE 1=2 '
        else
           PCP_SQ_C_PRP.CommandText := enSqlPcpPrp +
                ' WHERE PRP.ID_GRUPO = ''' + VarToStr(Input[1]) +''' ';
      end;
   Result := PCP_DP_C_PRP.Data;
end;

function TSM.PCP_DP_C_PRQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpPrq: String;
  begin
    Result :=
      'select PRQ.* , ITE.DESCRICAO AS INT_NOMEITE, '+
      'GRU.DESCRICAO AS INT_NOMEGRU, FUC.NOME AS INT_NOMEFUN '+
      'from PCP_TB_C_PRQ PRQ '+
      'LEFT OUTER JOIN CAD_TB_C_ITE ITE ON ITE.ID_ITEM=PRQ.ID_ITEM '+
      'LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO=PRQ.ID_GRUPO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=PRQ.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_C_PRQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq + ' WHERE 1=2 '
        else
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq +
             ' WHERE PRQ.ID_PRQ = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq + ' WHERE 1=2 '
        else
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq +
             ' WHERE PRQ.ID_GRUPO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 2 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq + ' WHERE 1=2 '
        else
           PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq +
             ' WHERE PRQ.ID_ITEM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_C_PRQ.CommandText := enSqlPcpPrq +
          Format('WHERE upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_PRQ.Data;
end;

function TSM.PCP_DP_C_REGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpReg: String;
  begin
    Result :=
      'select REG.* , ROT.DESCRICAO AS INT_NOMEROT '+
      'from PCP_TB_C_REG REG '+
      'LEFT OUTER JOIN PCP_TB_C_ROT ROT ON ROT.ID_ROTA=REG.ID_ROTA ';
  end;
begin
   PCP_SQ_C_REG.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_REG.CommandText := enSqlPcpReg + ' WHERE 1=2 '
        else
           PCP_SQ_C_REG.CommandText := enSqlPcpReg +
             ' WHERE REG.ID_REGIAO = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_REG.CommandText := enSqlPcpReg +
          Format('WHERE upper(REG.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_REG.Data;
end;

procedure TSM.PCP_DP_C_REGGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
    { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 22/07/2019 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.PCP_DP_C_REGUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
begin
   { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 22/07/2019 }
  enAudGravar(Sender,DataSet);
end;

function TSM.PCP_DP_C_ROTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRot: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_ROT  ';
  end;
begin
   PCP_SQ_C_ROT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_ROT.CommandText := enSqlPcpRot + ' WHERE 1=2 '
        else
           PCP_SQ_C_ROT.CommandText := enSqlPcpRot +
             ' WHERE ID_ROTA = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_ROT.CommandText := enSqlPcpRot +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_ROT.Data;
end;

function TSM.PCP_DP_C_RPTDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRpt: String;
  begin
    Result := ' select * from PCP_TB_C_RPT  ';
  end;
begin
   PCP_SQ_C_RPT.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_RPT.CommandText := enSqlPcpRpt + ' WHERE 1=2 '
        else
           PCP_SQ_C_RPT.CommandText := enSqlPcpRpt +
             ' WHERE ID_RPT = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_RPT.CommandText := enSqlPcpRpt +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_RPT.Data;
end;

function TSM.PCP_DP_C_TINDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpTin: String;
  begin
    Result := ' select * from PCP_TB_C_TIN  ';
  end;
begin
   PCP_SQ_C_TIN.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_TIN.CommandText := enSqlPcpTin + ' WHERE 1=2 '
        else
           PCP_SQ_C_TIN.CommandText := enSqlPcpTin +
             ' WHERE ID_TIN = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_TIN.CommandText := enSqlPcpTin +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_TIN.Data;

end;

function TSM.PCP_DP_C_TLMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpTlm: String;
  begin
    Result := ' SELECT * FROM PCP_TB_C_TLM  ';
  end;
begin
   PCP_SQ_C_TLM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_TLM.CommandText := enSqlPcpTlm + ' WHERE 1=2 '
        else
           PCP_SQ_C_TLM.CommandText := enSqlPcpTlm +
             ' WHERE ID_TLM = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_TLM.CommandText := enSqlPcpTlm +
          Format('WHERE upper(DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_TLM.Data;
end;

function TSM.PCP_DP_C_TPPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpTpp: String;
  begin
    Result := ' select * from PCP_TB_C_TPP  ';
  end;
begin
   PCP_SQ_C_TPP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_C_TPP.CommandText := enSqlPcpTpp + ' WHERE 1=2 '
        else
           PCP_SQ_C_TPP.CommandText := enSqlPcpTpp +
             ' WHERE ID_TPP = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_C_TPP.CommandText := enSqlPcpTpp +
          Format('WHERE upper(descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_C_TPP.Data;
end;

function TSM.PCP_DP_M_ACRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpAcr: String;
  begin
    Result :=
      ' SELECT ACR.*, CLI.NOME AS INT_NOMECLI, FUC.NOME AS int_nomerep, ' +
      '  CID.NOME AS  int_nomecid,  CID.uf AS int_uf,  FCA.NOME as int_nomeate, ' +
      '  case acr.tipo_cliente                ' +
      '       when 0 then ''Distribuidor''    ' +
      '       when 1 then ''Consumidor''      ' +
      '       when 2 then ''Representante''   ' +
      '   else ''?????'' end as int_tipocli,  ' +
      ' ' +
      ' case acr.pessoa               ' +
      '  when ''0'' then ''Fsica''   ' +
      '  when ''1'' then ''Jurdica'' ' +
      '  else ''?????'' end as int_pessoa ' +
      '  ' +
      ' FROM PCP_TB_M_ACR ACR '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ACR.ID_CLIENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = ACR.ID_CIDADE ' +
      ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=ACR.ID_REPRESENTANTE ' +
      ' LEFT OUTER JOIN CAD_TB_C_FUN FCA ON FCA.ID_FUNCIONARIO=ACR.ID_ATENDENTE ';
  end;
begin


   PCP_SQ_M_ACR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_ACR.CommandText := enSqlPcpAcr + ' WHERE 1=2 '
        else
           PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
             ' WHERE ACR.ID_ACR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
             ' WHERE ACR.DATA_ATENDIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
          Format('WHERE upper(FCA.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
          Format('WHERE upper(ACR.NOME_CONSUMIDOR) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
           PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
             ' WHERE ACR.CNPJ_CPF_CONSUMIDOR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 5 then
      begin
        PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
          'WHERE ACR.NUMERO_NF = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 6 then
      begin
        PCP_SQ_M_ACR.CommandText := enSqlPcpAcr +
          'WHERE ACR.NRO_PROTOCOLO = ''' + VarToStr(Input[1]) +''' ';
      end;

   Result := PCP_DP_M_ACR.Data;

end;

function TSM.PCP_DP_M_CACDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCac: String;
  begin
    Result :=
      'select CAC.*, FUC.NOME AS INT_NOMERES '+
      'from PCP_TB_M_CAC CAC '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=CAC.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_M_CAC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_CAC.CommandText := enSqlPcpCac + ' WHERE 1=2 '
        else
           PCP_SQ_M_CAC.CommandText := enSqlPcpCac +
             ' WHERE CAC.ID_CAC = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_CAC.CommandText := enSqlPcpCac +
             ' WHERE CAC.DTA_ENTRADA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_CAC.CommandText := enSqlPcpCac +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_CAC.CommandText := enSqlPcpCac +
          Format('WHERE upper(CAC.TEXTO_NAO_CONFORMIDADE) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := PCP_DP_M_CAC.Data;
end;

function TSM.PCP_DP_M_CMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCme: String;
  begin
    Result :=
    'select CME.*,FUC.NOME AS INT_NOMEFRES, '+
    '          MEQ.DESCRICAO AS INT_NOMEMEQ '+
    'from PCP_TB_M_CME CME '+
    'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=CME.ID_RESPONSAVEL '+
    'LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ=CME.ID_MEQ ';
  end;
begin
   PCP_SQ_M_CME.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_CME.CommandText := enSqlPcpCme + ' WHERE 1=2 '
        else
           PCP_SQ_M_CME.CommandText := enSqlPcpCme +
             ' WHERE CME.id_meq = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_CME.CommandText := enSqlPcpCme +
             ' WHERE CME.DTA_LANCTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_CME.CommandText := enSqlPcpCme +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_M_CME.Data;



end;

function TSM.PCP_DP_M_CRPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCrp: String;
  begin
    Result :=
      'select CRP.*, FUC.NOME AS INT_NOMERES '+
      'from PCP_TB_M_CRP CRP '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=CRP.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_M_CRP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_CRP.CommandText := enSqlPcpCrp + ' WHERE 1=2 '
        else
           PCP_SQ_M_CRP.CommandText := enSqlPcpCrp +
             ' WHERE CRP.ID_CRP = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_CRP.CommandText := enSqlPcpCrp +
             ' WHERE CRP.DTA_EMISSAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_CRP.CommandText := enSqlPcpCrp +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_CRP.CommandText := enSqlPcpCrp +
          Format('WHERE upper(FUC.NUM_LOTE_CRP) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_M_CRP.Data;

end;

function TSM.PCP_DP_M_CRQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpCrq: String;
  begin
    Result :=
      'select CRQ.* , FUC.NOME AS INT_NOMERES '+
      'from PCP_TB_M_CRQ CRQ '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=CRQ.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_M_CRQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_CRQ.CommandText := enSqlPcpCrq + ' WHERE 1=2 '
        else
           PCP_SQ_M_CRQ.CommandText := enSqlPcpCrq +
             ' WHERE CRQ.ID_CRQ = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_CRQ.CommandText := enSqlPcpCrq +
             ' WHERE CRQ.DTA_CRIACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_CRQ.CommandText := enSqlPcpCrq +
          Format('WHERE upper(CRQ.OBSERVACAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_CRQ.CommandText := enSqlPcpCrq +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := PCP_DP_M_CRQ.Data;

end;

function TSM.PCP_DP_M_IQFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpIqf: String;
     begin
       result :=
           ' select iqf.* , ' +
           '     fun.nome as int_nomeres, frn.fantasia as int_nomefor ' +
           ' from pcp_tb_m_iqf iqf                                    ' +
           '      left outer join cad_tb_c_fun fun on fun.id_funcionario = iqf.id_responsavel ' +
           '      left outer join cad_tb_c_for frn on frn.id_fornecedor  = iqf.id_fornecedor  ';
     end;
begin
   PCP_SQ_M_IQF.Close;

   // index: 0,Ano,IdFornecedor;
   // index: 1,Ano,NomeFantasia;
   // index: 2,Ano;


   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[2])) = '' then
           PCP_SQ_M_IQF.CommandText := enSqlPcpIqf + ' WHERE 1 = 2 '
        else
           PCP_SQ_M_IQF.CommandText := enSqlPcpIqf +
             ' WHERE IQF.ANO_IQF = ''' + VarToStr(Input[1]) + ''' AND ' +
             '       IQF.ID_FORNECEDOR = ''' + VarToStr(Input[2]) + '''' ;
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_IQF.CommandText := enSqlPcpIqf +
             ' WHERE IQF.ANO_IQF = ''' + VarToStr(Input[1]) + ''' AND ' +
              Format(' upper(FRN.FANTASIA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_IQF.CommandText := enSqlPcpIqf +
             ' WHERE IQF.ANO_IQF = ''' + VarToStr(Input[1]) + ''' ';
      end;

  { else if Input[0] = 2 then
      begin
        PCP_SQ_M_IQF.CommandText := enSqlPcpIqf +
             ' where iqf.ano_iqf = ''' + VarToStr(Input[1])    + ''' and ' +
             '   AND iqf.id_empresa = ''' + VarToStr(Input[2]) + ''' and ' +
             '   and id_fornecedor in ' +
               '                   (select id_emitente from fat_tb_m_nfe nfe  ' +
               '                          left outer join cad_tb_c_tme tme on ' +
               '                                (tme.id_tipo_mov_estoque =    ' +
               '                                  nfe.id_tipo_mov_estoque)    ' +
               '                    where  nfe.id_empresa = iqf.id_empresa ' +
               '                           tme.tipo_movimento = 0 and      ' +
               '                           tme.indicador = 0 and           ' +
               '                           nfe.tipo_nf = ''E'' an          ' +
               '                           nfe.status = 1    and           ' +
               '                           nfe.ind_emitente = 1 and        ' +
               '                           nfe.nfe_cod_sit = ''00''        ' +
               '                    group by nfe.id_emitente)              ' ;
      end;}

   PCP_SQ_M_IQF.CommandText := PCP_SQ_M_IQF.CommandText +
                               ' order by frn.fantasia ';
   Result := PCP_DP_M_IQF.Data;
   PCP_SQ_M_IQF.Close;
end;

function TSM.PCP_DP_M_LBEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpLbe: String;
  begin
    Result :=
      'select LBE.*, '+
      '   case '+
      '      when LBE.TIPO = '''+'H'+''' then CAST('''+'Retangular - Mquina horizontal'+''' as VARCHAR(50)) '+
      '      when LBE.TIPO = '''+'V'+''' then CAST('''+'Retangular - Mquina vertical'+''' as VARCHAR(50)) '+
      '      when LBE.TIPO = '''+'C'+''' then CAST('''+'Cilndrico'+''' as VARCHAR(50)) '+
      '   end as INT_NOMETIP, '+
      '   SEC.DESCRICAO AS INT_NOMESET, '+
      '   ITA.DESCRICAO AS INT_NOMEACA, '+
      '   ITL.DESCRICAO AS INT_NOMELAM '+
      'from PCP_TB_M_LBE LBE '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=LBE.ID_SETOR '+
      'LEFT OUTER JOIN CAD_TB_C_ITE ITA ON ITA.ID_ITEM=LBE.ID_ITEM_ACABADO '+
      'LEFT OUTER JOIN CAD_TB_C_ITE ITL ON ITL.ID_ITEM=LBE.ID_ITEM_LAMINA ';
   end;
begin
   PCP_SQ_M_LBE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_LBE.CommandText := enSqlPcpLbe + ' WHERE 1=2 '
        else
           PCP_SQ_M_LBE.CommandText := enSqlPcpLbe +
             ' WHERE LBE.ID_LBE = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_LBE.CommandText := enSqlPcpLbe +
             ' WHERE LBE.DTA_LAMINACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_LBE.CommandText := enSqlPcpLbe +
          Format('WHERE upper(SET.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_LBE.CommandText := enSqlPcpLbe +
          Format('WHERE upper(ITA.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_LBE.CommandText := enSqlPcpLbe +
          Format('WHERE upper(ITL.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;
   Result := PCP_DP_M_LBE.Data;
end;

function TSM.PCP_DP_M_LPRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpLpr: String;
  begin
    Result :=
      'select LPR.*, FUC.NOME AS INT_NOMERES, cast(hora_fin-hora_ini as TIME ) as int_cargahora '+
      'from PCP_TB_M_LPR LPR '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=LPR.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_M_LPR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_LPR.CommandText := enSqlPcpLpr + ' WHERE 1=2 '
        else
           PCP_SQ_M_LPR.CommandText := enSqlPcpLpr +
             ' WHERE LPR.ID_LPR = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_LPR.CommandText := enSqlPcpLpr +
             ' WHERE LPR.DTA_PRESENCA = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_LPR.CommandText := enSqlPcpLpr +
          Format('WHERE upper(LPR.motivo_reuniao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_LPR.CommandText := enSqlPcpLpr +
          Format('WHERE upper(FUC.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_LPR.CommandText := enSqlPcpLpr +
          Format('WHERE upper(LPR.CONTEUDO_REUNIAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := PCP_DP_M_LPR.Data;

end;

function TSM.PCP_DP_M_MCPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpMcp: String;
  begin
    Result :=
      'select MCP.*, '+
      '  MEQ.DESCRICAO AS INT_NOMEMEQ, '+
      '  FAU.NOME AS INT_NOMERAU, '+
      '  SEC.DESCRICAO AS INT_NOMESET, '+
      '  RES.NOME AS INT_NOMERES '+
      'from PCP_TB_M_MCP MCP '+
      'LEFT OUTER JOIN PCP_TB_C_MEQ MEQ ON MEQ.ID_MEQ=MCP.ID_MEQ '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FAU ON FAU.ID_FUNCIONARIO=MCP.ID_RESP_AUTORIZOU '+
      'LEFT OUTER JOIN CAD_TB_C_FUN RES ON RES.ID_FUNCIONARIO=MCP.ID_RESPONSAVEL '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=MCP.ID_SETOR ';
  end;

begin
   PCP_SQ_M_MCP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_MCP.CommandText := enSqlPcpMcp + ' WHERE 1=2 '
        else
           PCP_SQ_M_MCP.CommandText := enSqlPcpMcp +
             ' WHERE mcp.ID_MCP = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_MCP.CommandText := enSqlPcpMcp +
             ' WHERE MCP.DTA_AUTORIZACAO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_MCP.CommandText := enSqlPcpMcp +
          Format('WHERE upper(sec.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_MCP.CommandText := enSqlPcpMcp +
          Format('WHERE upper(RES.NOME) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;

   Result := PCP_DP_M_MCP.Data;
end;

function TSM.PCP_DP_M_NCFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpNcf: String;
  begin
    Result :=
      'select ncf.*, ite.descricao as int_nomeite , fuc.nome as int_nomeres, '+
      '          sec.descricao as int_nomeset, '+
      '          cor.descricao as int_nomecor, '+
      '         tam.descricao as int_nometam '+
      'from PCP_TB_M_NCF ncf '+
      'left outer join cad_tb_c_ite ite on ite.id_item=ncf.id_item_motivo '+
      'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=ncf.id_Responsavel '+
      'left outer join cad_tb_c_set sec on sec.id_setor=ncf.id_setor_origem '+
      'left outer join cad_tb_c_cor cor on cor.id_cor=ncf.id_cor '+
      'left outer join cad_tb_c_tam tam on tam.id_tamanho=ncf.id_tamanho ';
  end;
begin
   PCP_SQ_M_NCF.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_NCF.CommandText := enSqlPcpNcf + ' WHERE 1=2 '
        else
           PCP_SQ_M_NCF.CommandText := enSqlPcpNcf +
             ' WHERE ncf.id_ncf = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_NCF.CommandText := enSqlPcpNcf +
             ' WHERE ncf.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_NCF.CommandText := enSqlPcpNcf +
          Format('WHERE upper(sec.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_NCF.CommandText := enSqlPcpNcf +
          Format('WHERE upper(ite.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_NCF.CommandText := enSqlPcpNcf +
          Format('WHERE upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;




   Result := PCP_DP_M_NCF.Data;
end;

function TSM.PCP_DP_M_OPBDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOpb: String;
  begin
    Result :=
      '  select OPB.* , FUC.NOME AS INT_NOMERES, opr.num_lote as int_numlote_opr   '+
      'from PCP_TB_M_OPB OPB '+
      '  LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=OPB.ID_RESPONSAVEL ' +
      '  LEFT OUTER JOIN PCP_TB_M_OPR OPR ON OPR.ID_OPR = OPB.ID_OPR ';
  end;
begin
   PCP_SQ_M_OPB.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_OPB.CommandText := enSqlPcpOpb + ' WHERE 1=2 '
        else
           PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
             ' WHERE OPB.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and OPB.id_opb = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
             ' WHERE OPB.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   AND OPB.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end

   else if Input[0] = 2 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
           ' WHERE  opb.id_empresa = ''' + VarToStr(Input[1]) +'''  ' +
           '        and exists (select blo.num_lote from pcp_tb_m_opb_blo blo ' +
           '                        left outer join pcp_tb_m_opb orb on orb.id_opb = blo.id_opb   ' +
           '                    where orb.id_opb = opb.id_opb and blo.num_lote =  ''' + VarToStr(Input[2]) +''' ) ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   AND OPR.NUM_LOTE = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
             ' WHERE OPR.id_empresa  =  ''' + VarToStr(Input[1]) +''' ' +
             '   AND OPR.id_opb      <> ''' + VarToStr(Input[2]) +''' ' +
             '   AND OPR.NUM_LOTE    =  ''' + VarToStr(Input[3]) +''' ';
      end;


 {  else if Input[0] = 2 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
          Format('WHERE upper(OPB.OBS_ADMINISTRATIVA) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_OPB.CommandText := enSqlPcpOpb +
          Format('WHERE upper(OPB.OBS_PRODUCAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end; }

   Result := PCP_DP_M_OPB.Data;

end;

procedure TSM.PCP_DP_M_OPBUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_TME, BUS_CD_C_PAR_CTR: TClientDataSet;
  BUS_CD_M_OPR_OPP_INT: TClientDataSet;

begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 25/07/2016 }
  try
      if (DataSet.UpdateStatus in [usInserted]) then
          begin
            if dataset.FieldByName('origem').AsInteger = 1 then
               begin

                 BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
                 BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
                 BUS_CD_C_PAR_CTR.Close;
                 BUS_CD_C_PAR_CTR.Data :=
                     BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

                 CAD_CD_C_TME := TClientDataSet.Create(nil);
                 CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
                 CAD_CD_C_TME.Close;
                 CAD_CD_C_TME.Data :=
                     CAD_CD_C_TME.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('pcp_opb_id_tipo_mov_estoque').AsString]));


                 if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and // Sada
                    (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)   then // Normal
                    begin
                       FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,15,
                                                           DataSet.FieldByName('ID_OPB').AsInteger,
                                                           DataSet,
                                                           BUS_DP_M_OPB_OBL_INT,
                                                           CAD_DP_C_TME,
                                                           BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                           EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
                    end;




                 BUS_CD_M_OPR_OPP_INT := TClientDataSet.Create(nil);
                 BUS_CD_M_OPR_OPP_INT.SetProvider(BUS_DP_M_OPR_OPP_INT);
                 BUS_CD_M_OPR_OPP_INT.Close;
                 BUS_CD_M_OPR_OPP_INT.Data :=
                 BUS_CD_M_OPR_OPP_INT.DataRequest(VarArrayOf([8, dataset.FieldByName('id_empresa').AsString,
                                      dataset.FieldByName('id_opr').AsString]));
                 BUS_CD_M_OPR_OPP_INT.First;
                 if not BUS_CD_M_OPR_OPP_INT.IsEmpty then
                    begin
                      while not BUS_CD_M_OPR_OPP_INT.eof  do
                          begin
                            BUS_CD_M_OPR_OPP_INT.edit;
                            BUS_CD_M_OPR_OPP_INT.FieldByName('bloco_gerado').AsCurrency := 2;
                            BUS_CD_M_OPR_OPP_INT.Post;
                            BUS_CD_M_OPR_OPP_INT.Next;
                          end;
                    end;
                 BUS_CD_M_OPR_OPP_INT.First;
               end;
          end;
   try
     if BUS_CD_M_OPR_OPP_INT <> nil then
        if BUS_CD_M_OPR_OPP_INT.ChangeCount > 0 then
             BUS_CD_M_OPR_OPP_INT.ApplyUpdates(0);
   except
     on e: exception do
        begin
           raise Exception.Create('Erro: ' + #13 + e.Message);
        end;
   end;


  enAudGravar(Sender,DataSet);

  finally
    FreeAndNil(BUS_CD_M_OPR_OPP_INT);
  end;

end;

function TSM.PCP_DP_M_OPRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpOpr: String;
  begin
    Result :=
      ' select opr.*, fuc.nome as int_nomeres, tpp.descricao as int_nometpp, '+
      ' alm.descricao as int_nomealm, str.descricao as int_nomestr ' +
      'from PCP_TB_M_OPR opr '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=opr.id_responsavel '+
      ' left outer join pcp_tb_c_tpp tpp on tpp.id_tpp=opr.id_tpp ' +
      ' left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = opr.id_almoxarifado) ' +
      ' left outer join cad_tb_c_set str on (str.id_setor = opr.id_setor) '  ;
  end;
begin
   PCP_SQ_M_OPR.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_OPR.CommandText := enSqlPcpOpr + ' WHERE 1=2 '
        else
           PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
              ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
              '   and OPR.id_opr = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and OPR.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and  opr.id_tpp = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
          ' where OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
          Format(' and upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
             ' WHERE OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and OPR.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ' +
             '   and OPR.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
           ' where opr.id_opr in (select opp.id_opr from pcp_tb_m_opr_ped ipp ' +
           '                        left outer join pcp_tb_m_opr opp on (opp.id_opr = ipp.id_opr) ' +
           '                       where  opp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           '                         and  ipp.id_pedido     = ''' + VarToStr(Input[2]) +''' )';
      end
   else if Input[0] = 6 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
            ' WHERE OPR.id_opr = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 7 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
          ' where OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
          Format(' and upper(opr.num_lote) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end

   else if Input[0] = 8 then
      begin
        PCP_SQ_M_OPR.CommandText := enSqlPcpOpr +
           ' where OPR.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
           ' and OPR.id_opr = (select max(id_opr) from pcp_tb_m_opr where OPR.id_empresa = ''' + VarToStr(Input[1]) +''') ';
      end;

   Result := PCP_DP_M_OPR.Data;

   PCP_SQ_M_OPR.Close;
end;

procedure TSM.PCP_DP_M_OPRGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 25/07/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.PCP_DP_M_OPRUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  PCP_CD_M_OPR_OPP: TDataSet;
  QtdeAProdAnt, QtdeAProdNovo: Currency;
  PCP_CD_M_ETQ,BUS_CD_M_OPR_OPP_INT: TClientDataSet;
  QtdeOppAntInt, QtdeOppNovo:Currency;
  QtdeRegsEtq: Currency;
  CodEtq,Seq: integer;
begin
  { TODO -oMaxsuel : Insertido por Maxsuel Victor, em 25/07/2016 }
  try




  if (dataset.UpdateStatus in [usUnmodified]) then
     begin
       PCP_CD_M_OPR_OPP := TDataSetField(Dataset.FieldByName('PCP_SQ_M_OPR_OPP')).NestedDataSet;


       if (PCP_CD_M_OPR_OPP.UpdateStatus in [usUnmodified]) then
          begin

            PCP_CD_M_OPR_OPP.Next;
            if (PCP_CD_M_OPR_OPP.UpdateStatus in [usModified]) then
                begin
                   PCP_CD_M_OPR_OPP.Prior;
                   PCP_CD_M_ETQ := TClientDataSet.Create(nil);
                   PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
                   PCP_CD_M_ETQ.close;
                   PCP_CD_M_ETQ.Data :=
                          PCP_CD_M_ETQ.DataRequest(VarArrayOf([2,dataset.FieldByName('id_opr').asinteger]));
                   QtdeOppAntInt := 0;

                   BUS_CD_M_OPR_OPP_INT := TClientDataSet.Create(nil);
                   BUS_CD_M_OPR_OPP_INT.SetProvider(BUS_DP_M_OPR_OPP_INT);
                   BUS_CD_M_OPR_OPP_INT.Close;
                   BUS_CD_M_OPR_OPP_INT.Data :=
                   BUS_CD_M_OPR_OPP_INT.DataRequest(VarArrayOf([4,
                         dataset.FieldByName('id_empresa').AsString,
                         dataset.FieldByName('id_opr').AsString,
                         PCP_CD_M_OPR_OPP.FieldByName('id_item').AsString,
                         PCP_CD_M_OPR_OPP.FieldByName('id_cor').AsString,
                         PCP_CD_M_OPR_OPP.FieldByName('id_tamanho').AsString]));
                   if not BUS_CD_M_OPR_OPP_INT.IsEmpty then
                      begin
                        while not BUS_CD_M_OPR_OPP_INT.eof  do
                            begin
                              QtdeOppAntInt := QtdeOppAntInt + BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_a_produzir').AsCurrency;
                              BUS_CD_M_OPR_OPP_INT.Next;
                            end;
                      end;
                   BUS_CD_M_OPR_OPP_INT.close;


                  QtdeAProdAnt := PCP_CD_M_OPR_OPP.FieldByName('qtde_a_produzir').AsCurrency;

                  PCP_CD_M_OPR_OPP.Next;
                  if PCP_CD_M_OPR_OPP.FieldByName('qtde_a_produzir').AsCurrency > 0 then
                     begin
                       QtdeAProdNovo := PCP_CD_M_OPR_OPP.FieldByName('qtde_a_produzir').AsCurrency;

                       QtdeOppNovo   :=  (QtdeOppAntInt - QtdeAProdAnt) +  QtdeAProdNovo;

                       if QtdeOppNovo > QtdeOppAntInt then
                          begin
                          PCP_CD_M_OPR_OPP.Prior;

                              QtdeRegsEtq     := QtdeOppNovo - QtdeOppAntInt;
                              CodEtq          := enValorChave('SEQ_OPR_ETQ');

                              seq := 0;
                              while seq < QtdeRegsEtq do
                                 begin
                                    Inc(seq);

                                    PCP_CD_M_ETQ.Insert;
                                    PCP_CD_M_ETQ.FieldByName('id_empresa').AsInteger        := dataset.FieldByName('id_empresa').AsInteger;
                                    PCP_CD_M_ETQ.FieldByName('id_opr').AsInteger            := dataset.FieldByName('id_opr').AsInteger;
                                    PCP_CD_M_ETQ.FieldByName('id_opr_origem').AsInteger     := dataset.FieldByName('id_opr').AsInteger;
                                    PCP_CD_M_ETQ.FieldByName('id_etq').AsInteger            := enValorChave('OPR_TB_M_ETQ');
                                    PCP_CD_M_ETQ.FieldByName('id_item').AsInteger           := PCP_CD_M_OPR_OPP.FieldByName('id_item').AsInteger;
                                    PCP_CD_M_ETQ.FieldByName('id_cor').AsInteger            := PCP_CD_M_OPR_OPP.FieldByName('id_cor').AsInteger;
                                    PCP_CD_M_ETQ.FieldByName('id_tamanho').AsInteger        := PCP_CD_M_OPR_OPP.FieldByName('id_tamanho').AsInteger;


                                    PCP_CD_M_ETQ.FieldByName('sequencia').AsInteger         := seq;
                                    PCP_CD_M_ETQ.FieldByName('cod_barra').AsString          := IntToStr(CodEtq) + StrZero(seq,3,0);

                                    PCP_CD_M_ETQ.FieldByName('dta_criacao').AsDateTime      := date;
                                    PCP_CD_M_ETQ.FieldByName('hor_criacao').AsDateTime      := time;

                                    PCP_CD_M_ETQ.FieldByName('impressa').AsBoolean          := false;

                                    PCP_CD_M_ETQ.Post;
                                end;
                          end;
                     end;

                end;

          end;
     end;

   try
     if PCP_CD_M_ETQ <> nil then
        if PCP_CD_M_ETQ.ChangeCount > 0 then
             PCP_CD_M_ETQ.ApplyUpdates(0);
   except
     on e: exception do
        begin
           raise Exception.Create('Erro: ' + #13 + e.Message);
        end;
   end;


  enAudGravar(Sender,DataSet);

  finally
    FreeAndNil(BUS_CD_M_OPR_OPP_INT);
    FreeAndNil(PCP_CD_M_ETQ);
  end;
end;

function TSM.PCP_DP_M_EPPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlEpp: String;
  begin
    Result :=
     ' select epp.*, ' +
     '       fun.nome as int_nomefun, ' +
     '       alm.descricao as int_nomealm '  +
     '    from pcp_tb_m_epp epp           ' +
     '      left outer join cad_tb_c_fun fun on (fun.id_funcionario = epp.id_responsavel)  ' +
     '      left outer join cad_tb_c_alm alm on (alm.id_almoxarifado = epp.id_almoxarifado) ' ;


  end;
begin
   PCP_SQ_M_EPP.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_EPP.CommandText := enSqlEpp + ' where 1 = 2 '
        else
           PCP_SQ_M_EPP.CommandText := enSqlEpp +
              ' where epp.id_epp = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           PCP_SQ_M_EPP.CommandText := enSqlEpp +
             ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and epp.id_responsavel = ''' + VarToStr(Input[2]) +''' ';
      end

   else if Input[0] = 2 then
      begin
           PCP_SQ_M_EPP.CommandText := enSqlEpp +
             ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             Format(' and upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 3 then
      begin
           PCP_SQ_M_EPP.CommandText := enSqlEpp +
             ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             '   and epp.id_almoxarifado = ''' + VarToStr(Input[2]) +''' ';

      end
   else if Input[0] = 4 then
      begin
           PCP_SQ_M_EPP.CommandText := enSqlEpp +
             ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
             Format(' and upper(alm.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 5 then
      begin
        PCP_SQ_M_EPP.CommandText := enSqlEpp +
            ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
            '   and exists  ' +
            '                (select ppp.id_epp from pcp_tb_m_epp_ite ppi ' + #13#10 +
            '                   left outer join pcp_tb_m_epp ppp on ppp.id_epp = ppi.id_epp ' + #13#10 +
            '                 where ppp.ID_EMPRESA = epp.id_empresa ' + #13#10 +
            '                   and ppp.id_epp = epp.id_epp  ' + #13#10 +
            '                   and ppi.cod_barra  = ''' + VarToStr(Input[2]) +''' '+
            '                )';

            {'   and epp.id_epp in  ' +
            '                (select ppp.id_epp from pcp_tb_m_epp_ite ppi ' + #13#10 +
            '                   left outer join pcp_tb_m_epp ppp on ppp.id_epp = ppi.id_epp ' + #13#10 +
            '                 where ppp.ID_EMPRESA = epp.id_empresa ' + #13#10 +
            '                   and ppi.cod_barra  = ''' + VarToStr(Input[2]) +''' '+
            '                )';}
      end
   else if Input[0] = 6 then
      begin
         PCP_SQ_M_EPP.CommandText := enSqlEpp +
         ' where epp.id_empresa = ''' + VarToStr(Input[1]) +''' ' +
         ' and  epp.dta_entrada = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' '
      end;

   Result := PCP_DP_M_EPP.Data;
   PCP_SQ_M_EPP.Close;

end;

procedure TSM.PCP_DP_M_EPPUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  CAD_CD_C_TME, BUS_CD_C_PAR_CTR, PCP_CD_M_ETQ, BUS_CD_M_OPR_OPP_INT: TClientDataSet;
  cds_epp_ite: TDataSet;
  Itens_epp, N_Opr: String;
  path_arq: string;
begin


  {BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
  BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
  BUS_CD_C_PAR_CTR.Close;
  BUS_CD_C_PAR_CTR.Data :=
      BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([0,DataSet.FieldByName('id_empresa').AsString]));


  {CAD_CD_C_TME := TClientDataSet.Create(nil);
  CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
  CAD_CD_C_TME.Close;
  CAD_CD_C_TME.Data :=
      CAD_CD_C_TME.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('pcp_epp_id_tipo_mov_estoque').AsString]));
   }

  //if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 0) and  // Entrada
  //   (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)  then // Normal
  //   begin



  path_arq := ExtractFilePath(Application.ExeName)+'logs\processo_pcp_epp.txt';
  if FileExists(pchar(path_arq)) then
     begin
       DeleteFile(pchar(path_arq));
     end;

  //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 1 - Cd. EPP: ' + DataSet.FieldByName('ID_EPP').AsString);

  if (dataset.UpdateStatus in [usInserted]) then
     begin
       try
          //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 2');
          FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,14,
                                                   DataSet.FieldByName('ID_EPP').AsInteger,
                                                   DataSet,
                                                   BUS_DP_M_EPP_ITE_INT,
                                                   CAD_DP_C_TME,
                                                   BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                   EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);

          cds_epp_ite := TDataSetField(Dataset.FieldByName('PCP_SQ_M_EPP_ITE')).NestedDataSet;

          Itens_epp := '';
          cds_epp_ite.First;
          while not (cds_epp_ite.Eof)  do
             begin
               if Itens_epp <> '' then
                  begin
                    Itens_epp :=
                    Itens_epp + ',' +''''+ cds_epp_ite.FieldByName('cod_barra').AsString+'''';
                  end;
               if Itens_epp = '' then
                  begin
                    Itens_epp :=
                    Itens_epp +''''+cds_epp_ite.FieldByName('cod_barra').AsString+'''';
                  end;

               if N_Opr <> '' then
                  begin
                    N_Opr :=
                         N_Opr + ',' +''''+ cds_epp_ite.FieldByName('int_opr').AsString+'''';
                  end;
               if N_Opr = '' then
                  begin
                    N_Opr :=
                         N_Opr +''''+cds_epp_ite.FieldByName('int_opr').AsString+'''';
                  end;

               cds_epp_ite.Next;
             end;
          //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 3');

          PCP_CD_M_ETQ := TClientDataSet.Create(nil);
          PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
          PCP_CD_M_ETQ.Close;
          PCP_CD_M_ETQ.Data :=
              PCP_CD_M_ETQ.DataRequest(VarArrayOf([3,Itens_epp,DataSet.FieldByName('id_empresa').AsString]));

          if not PCP_CD_M_ETQ.IsEmpty then
             begin
               while not PCP_CD_M_ETQ.eof do
                  begin
                     PCP_CD_M_ETQ.Edit;


                     if dataset.FieldByName('tipo_entrada').AsInteger = 1 then    // Entrada por Contagem
                        begin
                          PCP_CD_M_ETQ.FieldByName('contagem').AsBoolean := true;
                          PCP_CD_M_ETQ.FieldByName('dta_entrada_antes_contagem').AsDateTime     :=
                                  PCP_CD_M_ETQ.FieldByName('dta_entrada_est').AsDateTime;
                          PCP_CD_M_ETQ.FieldByName('hor_entrada_antes_contagem').AsDateTime    :=
                                  PCP_CD_M_ETQ.FieldByName('hor_entrada_est').AsDateTime;
                        end;

                     PCP_CD_M_ETQ.FieldByName('id_epp').AsInteger     :=
                                  DataSet.FieldByName('id_epp').AsInteger;
                     PCP_CD_M_ETQ.FieldByName('dta_entrada_est').AsDateTime     := date;
                                  //DataSet.FieldByName('dta_entrada').AsDateTime;
                     PCP_CD_M_ETQ.FieldByName('hor_entrada_est').AsDateTime    := time;
//                                  DataSet.FieldByName('hor_entrada').AsDateTime;
                     PCP_CD_M_ETQ.FieldByName('id_funcionario_est').AsInteger  :=
                                  DataSet.FieldByName('id_responsavel').AsInteger;
                     PCP_CD_M_ETQ.Post;

                     PCP_CD_M_ETQ.Next;
                  end;
             end;

           //try
             if PCP_CD_M_ETQ <> nil then
                if PCP_CD_M_ETQ.ChangeCount > 0 then
                   if PCP_CD_M_ETQ.ApplyUpdates(0) <> 0 then
                      begin
                        Showmessage('Erro ao tentar atualizar os dados da etiqueta');
                        abort;
                      end;
           {except
             on e: exception do
                begin
                   raise Exception.Create('Erro: ' + #13 + e.Message);
                end;
           end;}

           //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 4');
           BUS_CD_M_OPR_OPP_INT := TClientDataSet.Create(nil);
           BUS_CD_M_OPR_OPP_INT.SetProvider(BUS_DP_M_OPR_OPP_INT);
           BUS_CD_M_OPR_OPP_INT.Close;
           BUS_CD_M_OPR_OPP_INT.Data :=
               BUS_CD_M_OPR_OPP_INT.DataRequest(VarArrayOf([3,DataSet.FieldByName('id_empresa').AsInteger,
                                                              N_Opr]));

           cds_epp_ite.First;
           while not (cds_epp_ite.Eof)  do
             begin
               BUS_CD_M_OPR_OPP_INT.Filtered := true;

               if cds_epp_ite.FieldByName('int_ite_sgq_personalizado').AsBoolean = true then
                  begin
                    BUS_CD_M_OPR_OPP_INT.Filter := ' id_opr = ' + cds_epp_ite.FieldByName('int_opr').AsString +
                                                   ' and id_item = ' + cds_epp_ite.FieldByName('id_item').AsString +
                                                   ' and id_cor  = ' + cds_epp_ite.FieldByName('id_cor').AsString +
                                                   ' and id_tamanho  = ' + cds_epp_ite.FieldByName('id_tamanho').AsString +
                                                   ' and int_nomeite = ''' + cds_epp_ite.FieldByName('int_nomeite').AsString + ''' '+
                                                   ' and qtde_a_produzir <> qtde_produzida ';
                  end
               else
                  begin
                    BUS_CD_M_OPR_OPP_INT.Filter := ' id_opr = ' + cds_epp_ite.FieldByName('int_opr').AsString +
                                                   ' and id_item = ' + cds_epp_ite.FieldByName('id_item').AsString +
                                                   ' and id_cor  = ' + cds_epp_ite.FieldByName('id_cor').AsString +
                                                   ' and id_tamanho  = ' + cds_epp_ite.FieldByName('id_tamanho').AsString +
                                                   ' and qtde_a_produzir <> qtde_produzida ';
                  end;

               if not BUS_CD_M_OPR_OPP_INT.IsEmpty  then
                  begin
                    BUS_CD_M_OPR_OPP_INT.edit;
                    BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_produzida').AsInteger :=
                        BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_produzida').AsInteger + 1;
                    BUS_CD_M_OPR_OPP_INT.Post;
                  end;
               cds_epp_ite.Next;
             end;

           //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 5');
           //try
             if BUS_CD_M_OPR_OPP_INT <> nil then
                if BUS_CD_M_OPR_OPP_INT.ChangeCount > 0 then
                   if BUS_CD_M_OPR_OPP_INT.ApplyUpdates(0) <> 0 then
                      begin
                        Showmessage('Erro ao tentar atualizar os dados da produo do item da etiqueta');
                        abort;
                      end;
           {except
             on e: exception do
                begin
                   raise Exception.Create('Erro: ' + #13 + e.Message);
                end;
           end;}

        finally
           FreeAndNil(PCP_CD_M_ETQ);
        end;
     end;

  // Maxsuel Victor - 25/08/18 - Essa alterao far com que no momento de pistolar
  // o sistema j ir registrar a entrada no estoque.
  if (dataset.UpdateStatus in [usUnmodified]) then
      begin
        try
            FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,14,
                                                       DataSet.FieldByName('ID_EPP').AsInteger,
                                                       DataSet,
                                                       BUS_DP_M_EPP_ITE_INT,
                                                       CAD_DP_C_TME,
                                                       BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                       EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);

            cds_epp_ite := TDataSetField(Dataset.FieldByName('PCP_SQ_M_EPP_ITE')).NestedDataSet;

            if (DataSet.UpdateStatus in [usUnmodified]) then  // Se o registro pai foi modificado
                begin
                   DataSet.Next;
                   if (DataSet.UpdateStatus in [usmodified]) then  // Se o registro pai foi modificado
                       begin

                       end;
                end;

            Itens_epp := '';
            cds_epp_ite.First;

            while not (cds_epp_ite.Eof) do
               begin
                 if (cds_epp_ite.UpdateStatus in [usInserted]) then
                     begin
                       if Itens_epp <> '' then
                          begin
                            Itens_epp :=
                            Itens_epp + ',' +''''+ cds_epp_ite.FieldByName('cod_barra').AsString+'''';
                          end;
                       if Itens_epp = '' then
                          begin
                            Itens_epp :=
                            Itens_epp +''''+cds_epp_ite.FieldByName('cod_barra').AsString+'''';
                          end;

                       if N_Opr <> '' then
                          begin
                            N_Opr :=
                                 N_Opr + ',' +''''+ cds_epp_ite.FieldByName('int_opr').AsString+'''';
                          end;
                       if N_Opr = '' then
                          begin
                            N_Opr :=
                                 N_Opr +''''+cds_epp_ite.FieldByName('int_opr').AsString+'''';
                          end;
                     end;
                 cds_epp_ite.Next;
               end;
              //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 3');

              PCP_CD_M_ETQ := TClientDataSet.Create(nil);
              PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
              PCP_CD_M_ETQ.Close;
              PCP_CD_M_ETQ.Data :=
                  PCP_CD_M_ETQ.DataRequest(VarArrayOf([3,Itens_epp,DataSet.FieldByName('id_empresa').AsString]));

              if not PCP_CD_M_ETQ.IsEmpty then
                 begin
                   while not PCP_CD_M_ETQ.eof do
                      begin
                         PCP_CD_M_ETQ.Edit;

                         if dataset.FieldByName('tipo_entrada').AsInteger = 1 then    // Entrada por Contagem
                            begin
                              PCP_CD_M_ETQ.FieldByName('contagem').AsBoolean := true;
                              PCP_CD_M_ETQ.FieldByName('dta_entrada_antes_contagem').AsDateTime     :=
                                      PCP_CD_M_ETQ.FieldByName('dta_entrada_est').AsDateTime;
                              PCP_CD_M_ETQ.FieldByName('hor_entrada_antes_contagem').AsDateTime    :=
                                      PCP_CD_M_ETQ.FieldByName('hor_entrada_est').AsDateTime;
                            end;

                         PCP_CD_M_ETQ.FieldByName('id_epp').AsInteger     :=
                                      DataSet.FieldByName('id_epp').AsInteger;
                         PCP_CD_M_ETQ.FieldByName('dta_entrada_est').AsDateTime     := date;
                                     // DataSet.FieldByName('dta_entrada').AsDateTime;
                         PCP_CD_M_ETQ.FieldByName('hor_entrada_est').AsDateTime    := time;
                                      //DataSet.FieldByName('hor_entrada').AsDateTime;
                         PCP_CD_M_ETQ.FieldByName('id_funcionario_est').AsInteger  :=
                                      DataSet.FieldByName('id_responsavel').AsInteger;
                         PCP_CD_M_ETQ.Post;

                         PCP_CD_M_ETQ.Next;
                      end;
                 end;


               if PCP_CD_M_ETQ <> nil then
                  if PCP_CD_M_ETQ.ChangeCount > 0 then
                     if PCP_CD_M_ETQ.ApplyUpdates(0) <> 0 then
                        begin
                           Showmessage('Erro ao tentar atualizar os dados da etiqueta');
                           abort;
                        end;


               //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 4');
               BUS_CD_M_OPR_OPP_INT := TClientDataSet.Create(nil);
               BUS_CD_M_OPR_OPP_INT.SetProvider(BUS_DP_M_OPR_OPP_INT);
               BUS_CD_M_OPR_OPP_INT.Close;
               BUS_CD_M_OPR_OPP_INT.Data :=
                   BUS_CD_M_OPR_OPP_INT.DataRequest(VarArrayOf([3,DataSet.FieldByName('id_empresa').AsInteger,
                                                                  N_Opr]));

               cds_epp_ite.First;
               while not (cds_epp_ite.Eof)  do
                 begin
                   if (cds_epp_ite.UpdateStatus in [usInserted]) then
                       begin
                         BUS_CD_M_OPR_OPP_INT.Filtered := true;

                         if cds_epp_ite.FieldByName('int_ite_sgq_personalizado').AsBoolean = true then
                            begin
                              BUS_CD_M_OPR_OPP_INT.Filter := ' id_opr = ' + cds_epp_ite.FieldByName('int_opr').AsString +
                                                             ' and id_item = ' + cds_epp_ite.FieldByName('id_item').AsString +
                                                             ' and id_cor  = ' + cds_epp_ite.FieldByName('id_cor').AsString +
                                                             ' and id_tamanho  = ' + cds_epp_ite.FieldByName('id_tamanho').AsString +
                                                             ' and int_nomeite = ''' + cds_epp_ite.FieldByName('int_nomeite').AsString + ''' '+
                                                             ' and qtde_a_produzir <> qtde_produzida ';
                            end
                         else
                            begin
                               BUS_CD_M_OPR_OPP_INT.Filter := ' id_opr = ' + cds_epp_ite.FieldByName('int_opr').AsString +
                                                              ' and id_item = ' + cds_epp_ite.FieldByName('id_item').AsString +
                                                              ' and id_cor  = ' + cds_epp_ite.FieldByName('id_cor').AsString +
                                                              ' and id_tamanho  = ' + cds_epp_ite.FieldByName('id_tamanho').AsString +
                                                              ' and qtde_a_produzir <> qtde_produzida ';
                            end;



                         if not BUS_CD_M_OPR_OPP_INT.IsEmpty  then
                            begin
                              BUS_CD_M_OPR_OPP_INT.edit;
                              BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_produzida').AsInteger :=
                                  BUS_CD_M_OPR_OPP_INT.FieldByName('qtde_produzida').AsInteger + 1;
                              BUS_CD_M_OPR_OPP_INT.Post;
                            end;
                       end;
                   cds_epp_ite.Next;
                 end;

               //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase 5');
               //try
               if BUS_CD_M_OPR_OPP_INT <> nil then
                  if BUS_CD_M_OPR_OPP_INT.ChangeCount > 0 then
                     if BUS_CD_M_OPR_OPP_INT.ApplyUpdates(0) <> 0 then
                        begin
                          Showmessage('Erro ao tentar atualizar os dados da produo do item da etiqueta');
                          abort;
                        end;
              { except
                 on e: exception do
                    begin
                       raise Exception.Create('Erro: ' + #13 + e.Message);
                    end;
               end;}
         finally
           FreeAndNil(PCP_CD_M_ETQ);
         end;
      end;


  //GerarTxt(path_arq,'PCP_DP_M_EPP: Fase encerrada');
 
end;

function TSM.PCP_DP_M_ETQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlOprEtq: String;
  begin
    Result :=
     ' select false as int_selecao, etq.*, ' +
     '  cast( case                                '+
     '          when  coalesce(etq.pcp_obs_item,'''') <> '''' then etq.pcp_obs_item   ' +
     '      else ite.descricao end as varchar(150)) as int_nomeite,  ' +
     ' ite.id_und_venda as int_und_venda, ite.cod_barra as int_cod_barra_gtin, '+
     '        cor.descricao as int_nomecor,tam.descricao as int_nometam, ' +
     '  ite.ETIQ_MEDIDAS as int_medidaite, ite.ETIQ_ESPUMA1 as int_etiq_espuma1ite,                                     ' +
     '  ite.ETIQ_ESPUMA2 as int_etiq_espuma2ite, ite.ETIQ_ESPUMA3 as int_etiq_espuma3ite,                               ' +
     '  ite.ETIQ_ESPUMA4 as int_etiq_espuma4ite, ite.ETIQ_ESPUMA5 as int_etiq_espuma5ite,                               ' +
     '  ite.ETIQ_ESPUMA6 as int_etiq_espuma6ite,  ite.etiq_marca as int_etiq_marca, ite.ETIQ_MADEIRA as int_etiq_madeiraite,                               ' +
     '  ite.ETIQ_REVESTIMENTO1 as int_etiq_revestimento1ite,ite.ETIQ_REVESTIMENTO2 as int_etiq_revestimento2ite,        ' +
     '  ite.ETIQ_REVESTIMENTO3 as int_etiq_revestimento3ite,                                                            ' +
     '  ite.ETIQ_REVESTIMENTO4 as int_etiq_revestimento4ite,ite.ETIQ_REVESTIMENTO5 as int_etiq_revestimento5ite,        ' +
     '  ite.ETIQ_REVESTIMENTO6 as int_etiq_revestimento6ite, ite.ETIQ_RECOMENDACOES_1 as int_etiq_recomendacoes1ite,    ' +
     '  ite.ETIQ_RECOMENDACOES_2 as int_etiq_recomendacoes2ite, ' +
     '  cue.descricao as int_nomecue, cle.descricao as int_nomecle, ' +
     '  gru.nome_selo_etq as int_nomeseloetq, gru.id_fte_etq AS int_fteetq, GRU.imprime_selo_etq AS int_impselo,  ' +
     '  GRU.imprime_msq_etq AS int_impmsgetq,ite.etiq_modelo as int_etiq_modelo, ett.MODELO_ETQ as int_modeloftq_etq,  ' +
     '  gru.imp_etq_simples as int_impetqsimples, cast(gru.path_etq_simples as varchar(100)) as int_pathetqsimples, ' +
     '  cast( case  ett.MODELO_ETQ                                         ' +
     '      when 1 then  ''Etiquetas - Colcho padro'' ' +
     '      when 2 then  ''Etiquetas - Colcho baby''   ' +
     '      when 3 then  ''Etiquetas - Colcho bordado''    ' +
     '      when 4 then  ''Etiquetas - Colcho colchonete'' ' +
     '      when 5 then  ''Etiquetas - Bobina'' ' +
     '      when 6 then  ''Etiquetas - Travesseiro'' ' +
     '      when 7 then  ''Etiquetas - Suave Encosto'' ' +
     '      when 8 then  ''Etiquetas - Base Box'' ' +
     '      when 9 then  ''Etiquetas - Colcho de molas'' ' +
     '  end as varchar(50)) as int_nome_layout_etq,        ' +
     ' ett.cod_int_etq, ett.cod_int_etq_rev, ett.descricao,ett.etq_tecnica,    ' +
     ' ett.especificacoes, ett.texto_livre1, ett.texto_livre2, ett.id_fte_etq, ' +
     ' gru.nome_selo_inmetro_etq as int_nome_selo_inmetro_etq, ' +
     ' ett.modelo_etq, fte.*, ' +
     ' cast( case ' +
     '    when  coalesce(etq.pcp_obs_item,'''') <> '''' then etq.pcp_obs_item ' +
     ' else ite.descricao end as varchar(150)) as int_nomeite_pers, opr.num_lote as int_num_lote_opr,  ' +
     '   frn.nome as int_nome_func_reimp,  ' +
     '     cast( case ite.etiq_tipo_produto' + #13#10 +
     '       when 0 then ''COLCHO DE ESPUMA''' + #13#10 +
     '       when 1 then ''COLCHO BOX CONJUGADO''' + #13#10 +
     '       when 2 then ''COLCHO AUXILIAR''' + #13#10 +
     '       when 3 then ''COLCHO MISTO''' + #13#10 +
     '     else ''?????'' end  as varchar(50) ) as int_etiq_tipo_produto ' +
     ' from pcp_tb_m_etq etq '+
     ' left outer join cad_tb_c_ite ite on ite.id_item=etq.id_item '+
     ' left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo '+
     ' left outer join cad_tb_c_cor cor on cor.id_cor=etq.id_cor   '+
     ' left outer join cad_tb_c_tam tam on tam.id_tamanho=etq.id_tamanho '+
     ' left outer join pcp_tb_c_cle cle on cle.id_cle = ite.ETIQ_CLASSIFICACAO_PRO '+
     ' left outer join pcp_tb_c_cue cue on cue.id_cue = ite.etiq_id_cue ' +
     ' left outer join pcp_tb_m_opr opr on opr.id_opr = etq.id_opr   ' +
     ' left outer join cad_tb_c_fun frn on frn.id_funcionario =  etq.id_func_reimpressa ' +
     ' inner join pcp_tb_c_fte_etq ett on ett.id_fte_etq = gru.id_fte_etq ' +
     ' inner join pcp_tb_c_fte fte     on fte.id_fte  = ett.id_fte ';

  end;
var
  sqlUnion: String;
begin

   if (Input[0] = 21) or (Input[0] = 22) then
      sqlUnion := enSqlOprEtq ;

   PCP_SQ_M_ETQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq + ' WHERE 1 = 2 '
        else
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
              ' WHERE etq.cod_barra = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE etq.id_item = ''' + VarToStr(Input[1]) +''' '+
             '   and etq.id_cor = '''+VarToStr(Input[2])+''' '+
             '   and etq.id_tamanho = '''+VarToStr(Input[3])+''' ';
      end
   else if Input[0] = 2 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE etq.id_opr = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE etq.cod_barra in (' + VarToStr(Input[1]) +') ' +
             '   and etq.id_empresa = '''+VarToStr(Input[2])+''' ';
      end
   else if Input[0] = 4 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE etq.cod_barra  = '''+VarToStr(Input[1])+''' ' +
             '   and etq.id_empresa = '''+VarToStr(Input[2])+''' ';
      end
  else if Input[0] = 5 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.cod_barra  = '''+VarToStr(Input[2])+''' '+
             ' and    coalesce(etq.id_ors_saida,0) = 0 and  etq.id_epp > 0 ' ;
      end
   else if Input[0] = 6 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' ;
      end
   else if Input[0] = 7 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
           ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
           ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' +
             Format('and upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 8 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             '  and   etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             '  and   coalesce(etq.id_ors_saida,0) = 0 ' +
             '  and   dta_entrada_est is null ' +
             ' order by etq.id_opr, etq.cod_barra ' ;
      end
   else if Input[0] = 9 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.cod_barra  = '''+VarToStr(Input[2])+''' '+
             ' and    coalesce(etq.id_ors_saida,0) = 0 ' ;
             if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
             if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est not is null ';
      end
   else if Input[0] = 10 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 ' ;
             if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
             if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est not is null ';
      end
   else if Input[0] = 11 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
           ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
           ' and    coalesce(etq.id_ors_saida,0) = 0 ' +
             Format('and upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
           if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
           if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est not is null ';
      end
   else if Input[0] = 12 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             '  and   etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             '  and   etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
             '  and   etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
             '  and   coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
             '  and   coalesce(etq.id_ors_saida,0) = 0 ' +
             '  and   dta_entrada_est is null ' +
             ' order by etq.id_opr, etq.cod_barra ' ;
      end
   else if Input[0] = 13 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             ' and    etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
             ' and    etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
             ' and    coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
             ' and    etq.id_opr  = '''+VarToStr(Input[6])+''' ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' ;
      end
   else if Input[0] = 14 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.cod_barra  = '''+VarToStr(Input[2])+''' '+
             ' and    contagem = false ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0' ;
             if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
             if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is not null ';
      end
   else if Input[0] = 15 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             ' and    contagem = false ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' ;
             if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
             if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is not null ';
      end
   else if Input[0] = 16 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
           ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
           ' and    contagem = false ' +
           ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' +
             Format('and upper(ITE.DESCRICAO) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
           if Input[3] = '0' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is null ';
           if Input[3] = '1' then
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' and   dta_entrada_est is not null ';
      end
   else if Input[0] = 17 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             '  and   etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             '  and   etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
             '  and   etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
             '  and   coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
             '  and   coalesce(etq.id_ors_saida,0) = 0 ' +
             ' order by etq.id_opr, etq.cod_barra ' ;
      end
   else if Input[0] = 18 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             '  and   etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             '  and   etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
             '  and   etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
             '  and   coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
             '  and   coalesce(etq.id_ors_saida,0) = 0 ' +
             '  and   dta_entrada_est is not null ' +
             '  and   contagem = false ' +
             ' order by etq.id_opr, etq.cod_barra ' ;
      end

   else if Input[0] = 19 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             '  and   etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             '  and   etq.id_cor   = '''+VarToStr(Input[3])+''' ';

           if Input[4] = 'S' then // se inclui periodo
              begin
                 { 0 - Data de entrada no estoque
                   1 - Data de sada do estoque
                   2 - Data de criao
                   3 - Data de impresso }

                 if Input[5] = '0' then
                    PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    ' and etq.dta_entrada_est >= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[6])) )  +
                    ''' and ' + ' etq.dta_entrada_est <= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[7])) ) + ''' ';
                 if Input[5] = '1' then
                    PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    ' and etq.dta_saida >= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[6])) )  +
                    ''' and ' + ' etq.dta_saida <= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[7])) ) + ''' ';
                 if Input[5] = '2' then
                    PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    ' and etq.dta_criacao >= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[6])) )  +
                    ''' and ' + ' etq.dta_criacao <= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[7])) ) + ''' ' ;
                 if Input[5] = '3' then
                    PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    ' and etq.dta_impressa >= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[6])) )  +
                    ''' and ' + ' etq.dta_impressa <= ''' +
                      FormatDateTime(CFormatoData, strToDate( VarToStr(Input[7])) )+ ''' ';
              end;

           if Input[8] = 'S' then // se inclui O.P
              begin
                PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  opr.num_lote  = '''+VarToStr(Input[9])+''' ';
              end;

           if Input[10] <> '0' then
              begin
               // 0-Todas as situaes
               // 1-Etiquetas em produo(apenas gerada)
               // 2-Etiquetas com entrada
               // 3-Etiquetas com sada
               if Input[10] = '1' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = false and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[10] = '2' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = true and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[10] = '3' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_entrada_est is not null  and etq.dta_saida is null ' ;

               if Input[10] = '4' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is not null ' ;

               if Input[10] = '5' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is null ' ;
               if Input[10] = '6' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_entrada_est is not null  and etq.dta_saida is null ' +
                    '  and not exists (SELECT RIT.COD_BARRA FROM PCP_TB_M_ROM_ICF RIT ' + #13#10 +
                    '                  where RIT.COD_BARRA = etq.cod_barra )' + #13#10 ;

              end;

           PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
               ' order by etq.dta_criacao desc, etq.cod_barra ' ;
      end

   else if Input[0] = 20 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
             ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
             ' and    etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
             ' and    etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
             ' and    coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
             ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' ;
      end
   else if Input[0] = 21 then
      begin
         PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
              ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
              ' and    etq.cod_barra  = '''+VarToStr(Input[7])+''' ';

         PCP_SQ_M_ETQ.CommandText :=  PCP_SQ_M_ETQ.CommandText +
             ' union all ' +
              sqlUnion +
              ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
              ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
              ' and    etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
              ' and    etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
              ' and    coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
              ' and    etq.id_opr  = '''+VarToStr(Input[6])+''' ' +
              ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' +
              ' and    etq.cod_barra  <> '''+VarToStr(Input[7])+''' ' +
              ' limit '''+VarToStr(Input[8])+''' ';
      end

   else if Input[0] = 22 then
      begin
         PCP_SQ_M_ETQ.CommandText :=  enSqlOprEtq +
              ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
              ' and    etq.cod_barra  = '''+VarToStr(Input[6])+''' ';

         PCP_SQ_M_ETQ.CommandText :=  PCP_SQ_M_ETQ.CommandText +
               ' union all ' +
              sqlUnion +
               ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' '+
               ' and    etq.id_item  = '''+VarToStr(Input[2])+''' ' +
               ' and    etq.id_cor   = '''+VarToStr(Input[3])+''' ' +
               ' and    etq.id_tamanho  = '''+VarToStr(Input[4])+''' ' +
               ' and    coalesce(etq.pcp_obs_item,'''') = '''+VarToStr(Input[5])+''' ' +
               ' and    etq.cod_barra  <> '''+VarToStr(Input[6])+''' ' +
               ' and    coalesce(etq.id_ors_saida,0) = 0 and etq.id_epp > 0 ' +
               ' limit '''+VarToStr(Input[7])+''' ';
      end


    else if Input[0] = 23 then
      begin
           PCP_SQ_M_ETQ.CommandText := enSqlOprEtq +
             ' WHERE  etq.id_empresa = '''+VarToStr(Input[1])+''' ';

           if Input[2] = 'N' then
              begin
                 if Input[3] <> '' then
                    begin
                      PCP_SQ_M_ETQ.CommandText := enSqlOprEtq + '  and   etq.id_item   = '''+VarToStr(Input[3])+''' ';
                    end;

                 if Input[4] <> '' then
                    begin
                      PCP_SQ_M_ETQ.CommandText := enSqlOprEtq + '  and   etq.id_cor   = '''+VarToStr(Input[4])+''' ';
                    end;
              end;


           if Input[5] <> '0' then
              begin
               // 0-Todas as situaes
               // 1-Etiquetas em produo(apenas gerada)
               // 2-Etiquetas com entrada
               // 3-Etiquetas com sada
               if Input[5] = '1' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = false and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[5] = '2' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_criacao is not null and impressa = true and etq.dta_entrada_est is null  and etq.dta_saida is null ' ;

               if Input[5] = '3' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_entrada_est is not null  and etq.dta_saida is null ' ;

               if Input[5] = '4' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is not null ' ;

               if Input[5] = '5' then
                  PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
                    '  and  etq.dta_saida is null ' ;
              end;

           PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +
               ' order by etq.dta_criacao desc, etq.cod_barra ' ;
      end;



   if (Input[0] = 14) or (Input[0] = 15) or (Input[0] = 16) then
      begin
        PCP_SQ_M_ETQ.CommandText := PCP_SQ_M_ETQ.CommandText +  ' order by etq.cod_barra ';
      end;

   //CMServerForm.mm.Lines.Clear;
   //CMServerForm.mm.Lines.Add(PCP_SQ_M_ETQ.CommandText);

   Result := PCP_DP_M_ETQ.Data;
   PCP_SQ_M_ETQ.Close;
end;

function TSM.PCP_DP_M_OPR_REQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpReq: String;
  begin
    Result :=
             ' select req.* ,                   ' +
             '    fun.nome as int_nomefuncanc,  ' +
             '    ffa.nome as int_nomeresp      ' +
             '                                  ' +
             ' from pcp_tb_m_opr_req req        ' +
             '    left outer join  cad_tb_c_fun fun on (fun.id_funcionario = req.id_funcionario_canc) ' +
             '    left outer join  cad_tb_c_fun ffa on (ffa.id_funcionario = req.id_responsavel)      ';
  end;
begin
   PCP_SQ_M_OPR_REQ.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_OPR_REQ.CommandText := enSqlPcpReq + ' WHERE 1=2 '
        else
           PCP_SQ_M_OPR_REQ.CommandText := enSqlPcpReq +
             ' WHERE req.id_opr = ''' + VarToStr(Input[1]) + ''' ' +
             '   and req.id_opr_req = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_OPR_REQ.CommandText := enSqlPcpReq +
             ' WHERE  req.id_opr = ''' + VarToStr(Input[1]) + ''' ' +
             '   and  req.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_OPR_REQ.CommandText := enSqlPcpReq +
             ' WHERE req.id_opr = ''' + VarToStr(Input[1]) + ''' ' +
             '   and req.id_responsavel = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_OPR_REQ.CommandText := enSqlPcpReq +
          Format(' WHERE req.id_opr = ''' + VarToStr(Input[1]) + ''' ' +
                 '   and upper(ffa.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end;

   PCP_SQ_M_OPR_REQ.CommandText := PCP_SQ_M_OPR_REQ.CommandText + ' order by req.dta_emissao, req.id_opr_req ';

   Result := PCP_DP_M_OPR_REQ.Data;

   PCP_SQ_M_OPR_REQ.Close;
end;

function TSM.PCP_DP_M_ORSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlOrs: String;
  begin
    Result :=
         ' select ors.* , fuc.nome as int_nomeres,                                 ' +
         ' mta.nome as int_nomemta, ped.id_cliente as int_id_cliente,              ' +
         ' cli.nome as int_nomecli, cli.tel_fixo as int_telfixo, fnc.nome as int_nomeven,                  ' +
         ' rom.dta_emissao as int_dta_rom,fuc2.nome as int_nomeresp_rom, ped.pcp_id_opr as int_id_opr, ' +
         ' ped.id_condicao_pag as int_id_condicao_pag, ' +
         ' cpg.descricao as int_desc_cpg, opr.num_lote as int_numloteopr, nfe.id_fiscal ' +
         '                                                                         ' +
         ' from pcp_tb_m_ors ors                                                   ' +
         ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=id_responsavel   ' +
         ' left outer join fat_tb_m_ped ped on ped.id_pedido = ors.id_pedido       ' +
         ' left outer join pcp_tb_m_opr opr on opr.id_empresa = ped.id_empresa and ' +
         '                                     opr.id_opr = ped.pcp_id_opr         ' +
         ' left outer join cad_tb_c_cpg cpg on cpg.id_condicao_pag = ped.id_condicao_pag ' +
         ' left outer join cad_tb_c_cli cli on cli.id_cliente = ped.id_cliente     ' +
         ' left outer join pcp_tb_c_mta mta on mta.id_motorista = ors.id_motorista ' +
         ' left outer join pcp_tb_m_rom rom on rom.id_rom = ors.id_rom             ' +
         ' left outer join cad_tb_c_fun fuc2 on fuc2.id_funcionario = rom.id_responsavel ' +
         ' left outer join cad_tb_c_fun fnc  on fnc.id_funcionario = ped.id_vendedor  ' +
         ' left outer join fat_tb_m_nfe nfe on nfe.id_ors = ors.id_ors  ';


  end;
begin
   PCP_SQ_M_ORS.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_ORS.CommandText := enSqlOrs + ' WHERE 1=2 '
        else
           PCP_SQ_M_ORS.CommandText := enSqlOrs +
             ' WHERE ors.id_ors = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_ORS.CommandText := enSqlOrs +
          ' WHERE ors.id_empresa = ''' + VarToStr(Input[1]) +''' '+
          Format(' and upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_ORS.CommandText := enSqlOrs +
             ' WHERE ors.id_empresa = ''' + VarToStr(Input[1]) +''' '+
             ' and ors.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_ORS.CommandText := enSqlOrs +
          ' WHERE ors.id_empresa = ''' + VarToStr(Input[1]) +''' '+
          Format(' and upper(ors.observacao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_ORS.CommandText := enSqlOrs +
                                    ' WHERE ors.id_empresa = ''' + VarToStr(Input[1]) +''' '+
                                    '    and ors.id_pedido = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 90 then
      begin
        PCP_SQ_M_ORS.CommandText := enSqlOrs +
                    ' WHERE ors.id_empresa = ''' + VarToStr(Input[1]) +''' '+
                    '    and ors.id_ors in ( ' +
                                ' select nfe.id_ors from fin_tb_m_rbx_ger gbx' + #13#10 +
                                '   left outer join fin_tb_m_rbx rbx on rbx.id_baixa = gbx.id_baixa' + #13#10 +
                                '   left outer join fin_tb_m_rbx_tit tbx on tbx.id_baixa = rbx.id_baixa' + #13#10 +
                                '   left outer join fin_tb_m_rec rec on rec.id_titulo = tbx.id_titulo' + #13#10 +
                                '   left outer join fat_tb_m_nfe nfe on nfe.id_fiscal = rec.id_fiscal' + #13#10 +
                                ' where ' + #13#10 +
                                '   rbx.id_cliente = ''' + VarToStr(Input[2])     + ''' ' +
                                '   and gbx.che_cheque = ''' + VarToStr(Input[3]) + ''' ' +
                                ' group by 1  )';
      end;

   PCP_SQ_M_ORS.CommandText := PCP_SQ_M_ORS.CommandText
                                + ' order by  ors.id_ors ';

   Result := PCP_DP_M_ORS.Data;
   PCP_SQ_M_ORS.Close;
end;

procedure TSM.PCP_DP_M_ORSGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  //enAudInserirCampoPacote(Properties);
end;

procedure TSM.PCP_DP_M_ORSUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  BBB_CD_M_PED,CAD_CD_C_TME: TClientDataSet;
  BUS_SQ_M_ROM_PDD_ICF:TSQlDataSet;
  BUS_CD_M_ROM_PDD_ICF, PCP_CD_M_ETQ: TClientDataSet;
  BUS_DP_M_ROM_PDD_ICF: TDataSetProvider;
  CodBarras: String;
  path_arq: string;
begin

  try
  // try
  path_arq :=  ExtractFilePath(Application.ExeName)+'logs\processo_pcp_ors.txt';
  if FileExists(pchar(path_arq)) then
     begin
       DeleteFile(pchar(path_arq));
     end;

  //GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 1 - O.F: ' + DataSet.FieldByName('ID_ORS').AsString);
 // Cdigo colocado mais abaixo por maxsuel victor, em 18/07/2019
 { if (dataset.UpdateStatus in [usInserted]) then
     begin
        FAT_CD_M_PED := TClientDataSet.Create(self);
        FAT_CD_M_PED.SetProvider(BUS_DP_M_PED_ORS);
        FAT_CD_M_PED.Close;
        FAT_CD_M_PED.Data :=
           FAT_CD_M_PED.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_EMPRESA').AsInteger,
                                                  DataSet.FieldByName('ID_PEDIDO').AsInteger]));
        if not FAT_CD_M_PED.IsEmpty then
           begin
             FAT_CD_M_PED.Edit;
             FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 3; // Faturado
             FAT_CD_M_PED.Post;
           end;
     end;  }


  if (dataset.UpdateStatus in [usDeleted]) then
     begin
        BBB_CD_M_PED := TClientDataSet.Create(self);
        BBB_CD_M_PED.SetProvider(BUS_DP_M_PED);
        BBB_CD_M_PED.Close;
        BBB_CD_M_PED.Data :=
           BBB_CD_M_PED.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_EMPRESA').AsInteger,
                                                  DataSet.FieldByName('ID_PEDIDO').AsInteger]));
        if not BBB_CD_M_PED.IsEmpty then
           begin
             BBB_CD_M_PED.Edit;
             if BBB_CD_M_PED.FieldByName('pcp_id_opr').AsInteger = 0 then
                BBB_CD_M_PED.FieldByName('SITUACAO').AsInteger := 0; // Em aberto

             if BBB_CD_M_PED.FieldByName('pcp_id_opr').AsInteger <> 0 then
                BBB_CD_M_PED.FieldByName('SITUACAO').AsInteger := 2; // Em produo
             BBB_CD_M_PED.Post;
           end;
     end;

  // GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 2');
   FAT_RN_M_EST.FatGerNfs(5,DataSet,CAD_DP_C_PAR, BUS_DP_C_PAR_CTR,CAD_DP_C_ITE,CAD_DP_C_TME,CAD_DP_C_FPG,
                FAT_DP_M_NFE,BUS_DP_M_NFE_ITE_INT, BUS_DP_M_NFE_TIT_INT,
                BUS_DP_M_ORV_ITE_INT,BUS_DP_M_ORV_TIT_INT,BUS_DP_M_ORV_TIT_SER_INT,BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,
                CAD_DP_C_CLI, CAD_DP_C_RAM, BUS_DP_C_TRI_REG,DP_BR_CUPOM_MESTRE,BuscarConnBanco,self);

  // GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 3');
   if (dataset.UpdateStatus in [usInserted]) then
     begin
         CAD_CD_C_TME := TClientDataSet.Create(nil);
         CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
         CAD_CD_C_TME.Close;
         CAD_CD_C_TME.Data :=
                CAD_CD_C_TME.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString]));

         if (CAD_CD_C_TME.FieldByName('TIPO_MOVIMENTO').AsInteger = 1) and // Sada
            (CAD_CD_C_TME.FieldByName('INDICADOR').AsInteger = 0)   then // Normal
            begin
               //GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 4');
               FAT_RN_M_EST.FAT_DP_M_NFEUpdateData(sender,2,
                                                   DataSet.FieldByName('ID_ORS').AsInteger,
                                                   DataSet,
                                                   BUS_DP_M_ORS_ICO_INT,
                                                   CAD_DP_C_TME,
                                                   BUS_DP_C_PAR_CTR,EST_DP_M_FEA,EST_DP_M_FES,
                                                   EST_DP_M_FES_ALM,EST_DP_M_LOT,BUS_DP_M_FAT_NFE_CUS,BUS_DP_M_PED_ITE_INT,false,Self);
            end;

         CodBarras := '';

         //GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 5');
         BUS_SQ_M_ROM_PDD_ICF := TSQLDataSet.Create(nil);
         BUS_SQ_M_ROM_PDD_ICF.SQLConnection := BuscarConnBanco;
         BUS_SQ_M_ROM_PDD_ICF.CommandType   := ctQuery;
         BUS_SQ_M_ROM_PDD_ICF.CommandText   := ' SELECT * FROM PCP_TB_M_ROM_PED_ICF ' +
                                               ' WHERE ID_ROM    = ' + DataSet.FieldByName('id_rom').AsString +
                                               '   AND ID_PEDIDO = ' + DataSet.FieldByName('id_pedido').AsString;

         BUS_DP_M_ROM_PDD_ICF := TDataSetProvider.Create(nil);
         BUS_DP_M_ROM_PDD_ICF.DataSet := BUS_SQ_M_ROM_PDD_ICF;

         BUS_CD_M_ROM_PDD_ICF := TClientDataSet.Create(nil);
         BUS_CD_M_ROM_PDD_ICF.SetProvider(BUS_DP_M_ROM_PDD_ICF);
         BUS_CD_M_ROM_PDD_ICF.Open;

         if not BUS_CD_M_ROM_PDD_ICF.IsEmpty then
            begin
              // GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 6');
               while not BUS_CD_M_ROM_PDD_ICF.eof DO
                   begin
                      if CodBarras <> '' then
                         begin
                          CodBarras :=
                          CodBarras + ',' +''''+ BUS_CD_M_ROM_PDD_ICF.FieldByName('cod_barra').AsString+'''';
                         end;
                      if CodBarras = '' then
                         begin
                           CodBarras :=
                           CodBarras +'''' + BUS_CD_M_ROM_PDD_ICF.FieldByName('cod_barra').AsString+'''';
                         end;

                      BUS_CD_M_ROM_PDD_ICF.Next;
                   end;

              // GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 7');
               BUS_CD_M_ROM_PDD_ICF.Close;

               PCP_CD_M_ETQ := TClientDataSet.Create(nil);
               PCP_CD_M_ETQ.SetProvider(PCP_DP_M_ETQ);
               PCP_CD_M_ETQ.Close;
               PCP_CD_M_ETQ.Data :=
                      PCP_CD_M_ETQ.DataRequest(VarArrayOf([3,CodBarras,
                                                            DataSet.FieldByName('id_empresa').AsString ]));
               if not PCP_CD_M_ETQ.IsEmpty then
                  begin
                     while not PCP_CD_M_ETQ.eof do
                         begin
                           PCP_CD_M_ETQ.Edit;
                           PCP_CD_M_ETQ.FieldByName('dta_saida').AsDateTime :=  DataSet.FieldByName('dta_emissao').AsDateTime;
                           PCP_CD_M_ETQ.FieldByName('hor_saida').AsDateTime :=  time;
                           PCP_CD_M_ETQ.FieldByName('id_ors_saida').AsInteger := DataSet.FieldByName('id_ors').AsInteger;
                           PCP_CD_M_ETQ.FieldByName('id_rom_saida').AsInteger := DataSet.FieldByName('id_rom').AsInteger;
                           PCP_CD_M_ETQ.FieldByName('id_funcionario_sai').AsInteger := DataSet.FieldByName('id_responsavel').AsInteger;
                           PCP_CD_M_ETQ.Post;
                           PCP_CD_M_ETQ.Next;
                         end;
                  end;
            end;

        BBB_CD_M_PED := TClientDataSet.Create(self);
        BBB_CD_M_PED.SetProvider(BUS_DP_M_PED);
        BBB_CD_M_PED.Close;
        BBB_CD_M_PED.Data :=
           BBB_CD_M_PED.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_EMPRESA').AsInteger,
                                                  DataSet.FieldByName('ID_PEDIDO').AsInteger]));
        if not BBB_CD_M_PED.IsEmpty then
           begin
             BBB_CD_M_PED.Edit;
             BBB_CD_M_PED.FieldByName('SITUACAO').AsInteger := 3; // Faturado
             BBB_CD_M_PED.Post;
           end;
     end;
   //GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 8');
   if BBB_CD_M_PED <> nil then
       if BBB_CD_M_PED.ChangeCount > 0 then
          //try
            if BBB_CD_M_PED.ApplyUpdates(0) <> 0 then
               begin
                 abort;
               end;
          {except
             on E:Exception do
               raise Exception.Create('Erro ao tentar atualizar a situao do pedido de venda da ordem de faturamento.' + #13 +
                                      e.Message);
          end; }
 // GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 9');
   if PCP_CD_M_ETQ <> nil then
       if PCP_CD_M_ETQ.ChangeCount > 0 then
          //try
          if  PCP_CD_M_ETQ.ApplyUpdates(0) <> 0 then
              begin
                abort;
              end;
         { except
             on E:Exception do
               raise Exception.Create('Erro ao tentar atualizar dados da sada na etiqueta do produto.' + #13 +
                                      e.Message);
          end;}
 //  GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 10');

 {
   except
     on e: exception do
        GerarTxt(path_arq,'PCP_DP_M_ORS: Fase 10 com erro: ' + #13 +
                          e.message);

   end;   }


   finally
     FreeAndNil(BBB_CD_M_PED);
     FreeAndNil(CAD_CD_C_TME);

     if BUS_CD_M_ROM_PDD_ICF <> nil then
        FreeAndNil(BUS_CD_M_ROM_PDD_ICF);

     if BUS_SQ_M_ROM_PDD_ICF <> nil then
        FreeAndNil(BUS_SQ_M_ROM_PDD_ICF);

     if BUS_DP_M_ROM_PDD_ICF <> nil then
        FreeAndNil(BUS_DP_M_ROM_PDD_ICF);

     if PCP_CD_M_ETQ <> nil then
        FreeAndNil(PCP_CD_M_ETQ);

     //dspUpdateData(Sender, DataSet);
   end;
   //GerarTxt(path_arq,'PCP_DP_M_ORS: Fase encerrada');
  { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }

  // O cdigo abaixo foi comentado para verificar se o servidor est travando por motivo da linha de baixo
     //enAudGravar(Sender,DataSet);
end;


function TSM.PCP_DP_R_POPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin

   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel - 18/12/2018 }


   // input[0] - Tipo do relatrio
      // 0 - Produo dos Itens detalhado por O.P
      // 1 - Produo resumido por Itens
      // 2 - Ordens de Produo em Aberto

   // input[1]  - Data inicial
   // input[2]  - Data final
   // input[3]  - Empresa
   // input[4]  - Itens
   // input[5]  - Cor
   // input[6]  - Grupo
   // input[7]  - Nro de Lote da O.P
   // input[8]  - Situao da O.P
       // 0 - Todos
       // 1 - Itens que faltam produzir
       // 2 - Itens que no precisaram produzir
       // 3 - Itens que no iniciaram a produo
       // 4 - Itens que finalizaram a produo



   PCP_SQ_R_POP.Close;
   PCP_SQ_R_POP.CommandText :=
          ' select false as int_selecao, opr.id_opr,opr.num_lote,opr.dta_emissao,' + #13#10 +
          '   opp.*,' + #13#10 +
          '   cast( case' + #13#10 +
          '      when rtrim(pcp_desc_item_person) <>'''' then  pcp_desc_item_person' + #13#10 +
          '   else' + #13#10 +
          '      ite.descricao end as varchar(150) ) as int_nomeite,   ' + #13#10 +
          '   ite.id_und_venda  as int_undvenda, ' + #13#10 +
          '   cor.descricao as int_nomecor,' + #13#10 +
          '   tam.descricao as int_nometam,' + #13#10 +
          '   fun.nome as int_nomeresp, ite.id_grupo as int_id_grupo, gru.descricao as int_nomegru,' + #13#10 +
          '   fnn.nome as int_nomeresp_man,' + #13#10 +
          '   fff.nome as int_nomeresp_opr,' + #13#10 +
          '   ( opp.qtde_a_produzir - opp.qtde_produzida ) as int_rest_a_produzir' + #13#10 +
          ' from pcp_tb_m_opr_opp opp' + #13#10 +
          '   left outer join pcp_tb_m_opr opr on opr.id_opr = opp.id_opr' + #13#10 +
          '   left outer join cad_tb_c_ite ite on ite.id_item = opp.id_item' + #13#10 +
          '   left outer join cad_tb_c_gru gru on ite.id_grupo = gru.id_grupo' + #13#10 +
          '   left outer join CAD_TB_C_GRU GR1 ON GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1) or '+
          '                                           GR1.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 1)||''.00.000'' ' +

          '   left outer join CAD_TB_C_GRU GR2 ON GR2.ID_GRUPO= substring(ITE.ID_GRUPO from 1 for 4) or  '+
          '                                           GR2.ID_GRUPO= substring( ITE.ID_GRUPO from 1 for 4)||''.000'' ' +
          '   left outer join cad_tb_c_cor cor on cor.id_cor = opp.id_cor' + #13#10 +
          '   left outer join cad_tb_c_tam tam on tam.id_tamanho = opp.id_tamanho' + #13#10 +
          '   left outer join cad_tb_c_fun fun on fun.id_funcionario = opp.id_resp_alt' + #13#10 +
          '   left outer join cad_tb_c_fun fnn on fnn.id_funcionario = opp.id_resp_man' + #13#10 +
          '   left outer join cad_tb_c_fun fff on fff.id_funcionario = opr.id_responsavel' + #13#10;

   if Input[7] = '' then
      begin
        PCP_SQ_R_POP.CommandText :=
            PCP_SQ_R_POP.CommandText +
                ' where ' + #13#10 +
                '   opr.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[1])) ) + ''' and ' +
                '   opr.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ';
      end;

   if Input[7] <> '' then
      begin
        PCP_SQ_R_POP.CommandText :=
            PCP_SQ_R_POP.CommandText +  ' where opr.num_lote = ''' + VarToStr(Input[7]) +''' ';

      end;

   PCP_SQ_R_POP.CommandText :=
          PCP_SQ_R_POP.CommandText +  ' and opr.id_empresa in (' + VarToStr(Input[3]) +') ';


   if Input[4] <> '' then
      begin
        PCP_SQ_R_POP.CommandText :=
          PCP_SQ_R_POP.CommandText +
          ' and opp.id_item in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        PCP_SQ_R_POP.CommandText :=
          PCP_SQ_R_POP.CommandText +
          ' and opp.id_cor in (' + VarToStr(Input[5]) +') ';
      end;


   if Input[6] <> '' then
      begin
        PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[6]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText + ' OR ';
              end;

           PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText + ' ) ';
      end;


   if Input[8] <> '0' then
      begin
         // 1 - Itens que faltam produzir
         // 2 - Itens que no precisaram produzir
         // 3 - Itens que no iniciaram a produo
         // 4 - Itens que finalizaram a produo

         if Input[8] = '1' then
            begin
               PCP_SQ_R_POP.CommandText :=
                   PCP_SQ_R_POP.CommandText +  ' and (opp.qtde_a_produzir - opp.qtde_produzida) > 0 ';
            end;

         if Input[8] = '2' then
            begin
               PCP_SQ_R_POP.CommandText :=
                   PCP_SQ_R_POP.CommandText +  ' and opp.qtde_a_produzir = 0 '
            end;

         if Input[8] = '3' then
            begin
               PCP_SQ_R_POP.CommandText :=
                   PCP_SQ_R_POP.CommandText +  ' and opp.qtde_a_produzir > 0 and opp.qtde_produzida = 0 ';
            end;

         if Input[8] = '4' then
            begin
               PCP_SQ_R_POP.CommandText :=
                   PCP_SQ_R_POP.CommandText +  ' and opp.qtde_a_produzir > 0 and (opp.qtde_a_produzir = opp.qtde_produzida) ';
            end;
      end;


   PCP_SQ_R_POP.CommandText := PCP_SQ_R_POP.CommandText +
    ' order by opr.id_opr, ite.id_grupo,opp.id_item,opp.id_cor, opp.qtde_a_produzir';

   Result := PCP_DP_R_POP.Data;

end;

function TSM.PCP_DP_M_PSCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpPsc: String;
  begin
    Result :=
      'select psc.* , fuc.nome as int_nomeres '+
      'from pcp_tb_m_psc psc '+
      'left outer join cad_tb_c_fun fuc on fuc.id_funcionario=psc.id_responsavel ';
  end;
begin
   PCP_SQ_M_PSC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_PSC.CommandText := enSqlPcpPsc + ' WHERE 1=2 '
        else
           PCP_SQ_M_PSC.CommandText := enSqlPcpPsc +
             ' WHERE psc.id_psc = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_PSC.CommandText := enSqlPcpPsc +
             ' WHERE psc.data = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_PSC.CommandText := enSqlPcpPsc +
          Format('WHERE upper(psc.nome_cliente) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end;



   Result := PCP_DP_M_PSC.Data;

end;

function TSM.PCP_DP_M_RAADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRaa: String;
  begin
    Result :=
      'select raa.*, ana.nome as int_nomeana,  fab.descricao as int_nomefab, '+
      '          fon.descricao as int_nomefor, ite.descricao as int_nomeite, '+
      '          sec.descricao as int_nomeset, cor.descricao as int_nomecor, '+
      '          tam.descricao as int_nometam, '+
      '          ITE.id_grupo  as int_codigru, gru.descricao as int_nomegru '+
      'from pcp_tb_m_raa raa '+
      'left outer join cad_tb_c_fun ana on ana.id_funcionario=raa.id_analista '+
      'left outer join cad_tb_c_for fab on fab.id_fornecedor=raa.id_fabricante '+
      'left outer join cad_tb_c_for fon on fon.id_fornecedor=raa.id_fornecedor '+
      'left outer join cad_tb_c_ite ite on ite.id_item=raa.id_item '+
      'left outer join cad_tb_c_set sec on sec.id_setor=raa.id_setor '+
      'left outer join cad_tb_c_cor cor on cor.id_cor=raa.id_cor '+
      'left outer join cad_tb_c_tam tam on tam.id_tamanho=raa.id_tamanho '+
      'LEFT OUTER JOIN cad_tb_c_gru gru on gru.id_grupo=substr(ite.id_grupo,1,4)||'''+'000'+''' ';
  end;
begin
   PCP_SQ_M_RAA.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_RAA.CommandText := enSqlPcpRaa + ' WHERE 1=2 '
        else
           PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
             ' WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and  raa.nro_raa = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 1 then
      begin
           PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
               ' WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and ite.cod_fabrica = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 2 then
      begin
           PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
             ' WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and  raa.id_item = ''' + VarToStr(Input[2]) +''' ';
      end
   else if Input[0] = 3 then
      begin
           PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
             Format('WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and  upper(fon.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[2]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
             ' WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and  raa.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';
      end
   else if Input[0] = 5 then
      begin
        PCP_SQ_M_RAA.CommandText := enSqlPcpRaa +
             ' WHERE raa.id_empresa = ''' + VarToStr(Input[1]) +''' and  raa.id_raa = ''' + VarToStr(Input[2]) +''' ';
      end;

   Result := PCP_DP_M_RAA.Data;
end;

function TSM.PCP_DP_M_ROMDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRom: String;
  begin
    Result :=
      'select rom.* , mta.nome as int_nomemta, fuc.nome as int_nomeres, '+
      '             mta.fone as int_fonemta, ' +
      '    mta.celular as int_celuar, '+
      '    mta.email as int_email, ' +
      '    fal.nome as int_nomeres_alt,  ' +
      '    fin.nome as int_nomeres_fin  ' +
      ' from pcp_tb_m_rom rom '+
      ' left outer join pcp_tb_c_mta mta on mta.id_motorista=rom.id_motorista '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=rom.id_responsavel '+
      ' left outer join cad_tb_c_fun fal on fal.id_funcionario=rom.id_resp_alt ' +
      ' left outer join cad_tb_c_fun fin on fin.id_funcionario=rom.id_resp_fin ' ;
  end;
begin
   PCP_SQ_M_ROM.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_ROM.CommandText := enSqlPcpRom + ' WHERE 1=2 '
        else
           PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
             ' WHERE rom.id_rom = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
          Format('WHERE upper(fuc.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
             ' WHERE rom.dta_emissao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end
   else if Input[0] = 3 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
          Format('WHERE upper(mta.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 4 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
          Format('WHERE upper(rom.observacao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 5 then
      begin
         PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
            ' where rom.DTA_EMISSAO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' AND '+
             '       rom.DTA_EMISSAO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ';

         if Trim(VarToStr(Input[3])) <> '' then // Responsvel
            begin
              PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_RESPONSAVEL in (' + VarToStr(Input[3]) +') ';
            end;

         if Trim(VarToStr(Input[4])) <> '' then // Motorista
            begin
              PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_MOTORISTA in (' + VarToStr(Input[4]) +') ';
            end;
          PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_EMPRESA in (' + VarToStr(Input[5]) +') ';
      end
   else if Input[0] = 6 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
          ' WHERE exists (select id_pedido from pcp_tb_m_rom_ped where id_rom = rom.id_rom and  id_pedido =  ''' + VarToStr(Input[1]) +''' ) ';
      end

   else if Input[0] = 7 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
           ' WHERE rom.id_pca = ''' + VarToStr(Input[1]) +''' ';
      end

   else if Input[0] = 8 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
           ' WHERE  rom.id_empresa = ''' + VarToStr(Input[1]) +'''  ' +
           '        and exists (select id_pedido from pcp_tb_m_rom_icf icf ' +
           '                        left outer join pcp_tb_m_rom rrr on rrr.id_rom = icf.id_rom   ' +
           '                    where rrr.id_rom = rom.id_rom and icf.cod_barra =  ''' + VarToStr(Input[2]) +''' ) ';
      end

   else if Input[0] = 9 then
      begin
         PCP_SQ_M_ROM.CommandText := enSqlPcpRom +

           ' where  exists (select rpd.id_pedido from pcp_tb_m_rom_ped rpd ' +
           '                   left outer join pcp_tb_m_rom rrr on rrr.id_rom = rpd.id_rom   ' +
           '                   left outer join pcp_tb_m_ors ors on ors.id_pedido = rpd.id_pedido ' +
           '                where rrr.id_rom = rom.id_rom  ' +
           '                  and ors.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' '+
           '                  and ors.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' ) ';

         if Trim(VarToStr(Input[3])) <> '' then // Responsvel
            begin
              PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_RESPONSAVEL in (' + VarToStr(Input[3]) +') ';
            end;

         if Trim(VarToStr(Input[4])) <> '' then // Motorista
            begin
              PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_MOTORISTA in (' + VarToStr(Input[4]) +') ';
            end;
          PCP_SQ_M_ROM.CommandText := PCP_SQ_M_ROM.CommandText +  ' AND ROM.ID_EMPRESA in (' + VarToStr(Input[5]) +') ';
      end
   else if Input[0] = 10 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
           ' WHERE rom.seq_pca_carreg_anual = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 11 then
      begin
        PCP_SQ_M_ROM.CommandText := enSqlPcpRom +
           ' WHERE rom.id_empresa = ''' + VarToStr(Input[1]) +''' '+
           '   and extract(year from rom.dta_emissao) = ''' + VarToStr(Input[2]) + '''  ' +
           '   and rom.seq_pca_carreg_anual = ''' + VarToStr(Input[3]) +''' ';
      end;

   Result := PCP_DP_M_ROM.Data;

   PCP_SQ_M_ROM.close;
end;

procedure TSM.PCP_DP_M_ROMGetDataSetProperties(Sender: TObject;
  DataSet: TDataSet; out Properties: OleVariant);
begin
 { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudInserirCampoPacote(Properties);
end;

procedure TSM.PCP_DP_M_ROMUpdateData(Sender: TObject;
  DataSet: TCustomClientDataSet);
var
  FAT_CD_M_PCA_ANT, FAT_CD_M_PCA_ATU : TClientDataSet;
  IdCarrAnt,IdCarrAtual: Integer;
begin

  FAT_CD_M_PCA_ANT := TClientDataSet.Create(nil);
  FAT_CD_M_PCA_ANT.SetProvider(FAT_DP_M_PCA);
  FAT_CD_M_PCA_ATU := TClientDataSet.Create(nil);
  FAT_CD_M_PCA_ATU.SetProvider(BUS_DP_M_PCA);

  IdCarrAnt   := dataset.FieldByName('id_pca').AsInteger;
  IdCarrAtual := dataset.FieldByName('id_pca').AsInteger;

  if not (dataset.UpdateStatus in [usDeleted]) then
     begin
       if (dataset.UpdateStatus in [usInserted]) then
           begin
             if IdCarrAtual > 0 then
                 begin
                   FAT_CD_M_PCA_ATU.Close;
                   FAT_CD_M_PCA_ATU.Data :=
                       FAT_CD_M_PCA_ATU.DataRequest(VarArrayOf([0, IdCarrAtual]));
                   if not FAT_CD_M_PCA_ATU.IsEmpty then
                      begin
                        FAT_CD_M_PCA_ATU.Edit;
                        FAT_CD_M_PCA_ATU.FieldByName('status').AsInteger := 1;
                        FAT_CD_M_PCA_ATU.Post;
                      end;
                 end;
           end;

       if (dataset.UpdateStatus in [usUnmodified]) then
           begin
             if (dataset.UpdateStatus in [usModified]) then
                begin
                  dataset.Next;
                  IdCarrAtual := dataset.FieldByName('id_pca').AsInteger;
                end;
             dataset.Prior;

             if IdCarrAnt <> IdCarrAtual then
                begin
                  if IdCarrAnt > 0 then
                     begin
                       FAT_CD_M_PCA_ANT.Close;
                       FAT_CD_M_PCA_ANT.Data :=
                           FAT_CD_M_PCA_ANT.DataRequest(VarArrayOf([0, IdCarrAnt]));
                       if not FAT_CD_M_PCA_ANT.IsEmpty then
                          begin
                            FAT_CD_M_PCA_ANT.Edit;
                            FAT_CD_M_PCA_ANT.FieldByName('status').AsInteger := 0;
                            FAT_CD_M_PCA_ANT.Post;
                          end;
                     end;

                  if IdCarrAtual > 0 then
                     begin
                       FAT_CD_M_PCA_ATU.Close;
                       FAT_CD_M_PCA_ATU.Data :=
                           FAT_CD_M_PCA_ATU.DataRequest(VarArrayOf([0, IdCarrAtual]));
                       if not FAT_CD_M_PCA_ATU.IsEmpty then
                          begin
                            FAT_CD_M_PCA_ATU.Edit;
                            FAT_CD_M_PCA_ATU.FieldByName('status').AsInteger := 1;
                            FAT_CD_M_PCA_ATU.Post;
                          end;
                     end;
                end;
           end;
     end
  else
     begin
        if IdCarrAtual > 0 then
           begin
             FAT_CD_M_PCA_ATU.Close;
             FAT_CD_M_PCA_ATU.Data :=
                 FAT_CD_M_PCA_ATU.DataRequest(VarArrayOf([0, IdCarrAtual]));
             if not FAT_CD_M_PCA_ATU.IsEmpty then
                begin
                  FAT_CD_M_PCA_ATU.Edit;
                  FAT_CD_M_PCA_ATU.FieldByName('status').AsInteger := 0;
                  FAT_CD_M_PCA_ATU.Post;
                end;
           end;
     end;


  if FAT_CD_M_PCA_ANT <> nil then
     if FAT_CD_M_PCA_ANT.ChangeCount > 0 then
        if not (FAT_CD_M_PCA_ANT.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar o carregamento.');
           end;

  if FAT_CD_M_PCA_ATU <> nil then
     if FAT_CD_M_PCA_ATU.ChangeCount > 0 then
        if not (FAT_CD_M_PCA_ATU.ApplyUpdates(0) = 0) then
           begin
             raise Exception.Create('Erro ao tentar atualizar o carregamento.');
           end;

    { TODO -oMaxsuel : Inserido por Maxsuel Victor, em 05/09/2016 }
  enAudGravar(Sender,DataSet);

end;

function TSM.PCP_DP_M_RVCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRvc: String;
  begin
    Result :=
      'select * from PCP_TB_M_RVC ';
  end;
begin
   PCP_SQ_M_RVC.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_RVC.CommandText := enSqlPcpRvc + ' WHERE 1=2 '
        else
           PCP_SQ_M_RVC.CommandText := enSqlPcpRvc +
             ' where id_rvc = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_RVC.CommandText := enSqlPcpRvc +
             ' WHERE dta_revisao = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
      end;
   Result := PCP_DP_M_RVC.Data;
end;

function TSM.PCP_DP_M_VVEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpVve: String;
  begin
    Result :=
      'select VVE.* ,VEI.DESCRICAO AS INT_NOMEVEI, FUN.NOME AS INT_NOMEFUN '+
      'from PCP_TB_M_VVE VVE '+
      'LEFT OUTER JOIN CAD_TB_C_VEI VEI ON VEI.ID_VEICULO=VVE.ID_VEICULO '+
      'LEFT OUTER JOIN CAD_TB_C_FUN FUN ON FUN.ID_FUNCIONARIO=VVE.ID_RESPONSAVEL ';
  end;
begin
   PCP_SQ_M_VVE.Close;
   if Input[0] = 0 then
      begin
        if Trim(VarToStr(Input[1])) = '' then
           PCP_SQ_M_VVE.CommandText := enSqlPcpVve + ' WHERE 1=2 '
        else
           PCP_SQ_M_VVE.CommandText := enSqlPcpVve +
             ' WHERE vve.id_vve = ''' + VarToStr(Input[1]) +''' ';
      end
   else if Input[0] = 1 then
      begin
        PCP_SQ_M_VVE.CommandText := enSqlPcpVve +
          Format('WHERE upper(vei.descricao) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);
      end
   else if Input[0] = 2 then
      begin
        PCP_SQ_M_VVE.CommandText := enSqlPcpVve +
          Format('WHERE upper(fun.nome) LIKE ''%s%%'' ', [uppercase(VarToStr(Input[1]))]);

      end;
   Result := PCP_DP_M_VVE.Data;

end;

function TSM.PCP_DP_R_ACRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelPcpAcr: String;
  begin
    Result :=
      ' SELECT ACR.*, CLI.NOME AS INT_NOMECLI, FUC.NOME AS int_nomerep, ' +
      '  CID.NOME AS  int_nomecid,  CID.uf AS int_uf,  FCA.NOME as int_nomeate,' +
      '  case acr.tipo_cliente                ' +
      '       when 0 then ''Distribuidor''    ' +
      '       when 1 then ''Consumidor''      ' +
      '       when 2 then ''Representante''   ' +
      '   else ''?????'' end as int_tipocli,  ' +
      ' ' +
      ' case acr.pessoa               ' +
      '  when ''0'' then ''Fsica''   ' +
      '  when ''1'' then ''Jurdica'' ' +
      '  else ''?????'' end as int_pessoa ' +
      '  ' +
      ' FROM PCP_TB_M_ACR ACR '+
      ' LEFT OUTER JOIN CAD_TB_C_CLI CLI ON CLI.ID_CLIENTE=ACR.ID_CLIENTE '+
      ' LEFT OUTER JOIN CAD_TB_C_CID CID ON CID.ID_CIDADE = ACR.ID_CIDADE ' +
      ' LEFT OUTER JOIN CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=ACR.ID_REPRESENTANTE '+
      ' LEFT OUTER JOIN CAD_TB_C_FUN FCA ON FCA.ID_FUNCIONARIO=ACR.ID_ATENDENTE ' ;
  end;

begin
   // Input[0] -  0 - Rel. Reclamao de Cliente
   //             1 - Rel. Reclamao de Cliente - Formulrio
   // Input[0] -  Nro do protocolo
   // Input[1] -  Data ini
   // Input[2] -  Data fin

   PCP_SQ_R_ACR.Close;
   PCP_SQ_R_ACR.CommandText := enSqlRelPcpAcr + ' WHERE ACR.ID_EMPRESA = ''' +
                                                VarToStr(Input[0]) +''' ';;

   if Input[1] <> '' then
      begin
        PCP_SQ_R_ACR.CommandText := PCP_SQ_R_ACR.CommandText +
             ' and ACR.NRO_PROTOCOLO = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[2] <> '' then
      begin
        PCP_SQ_R_ACR.CommandText := PCP_SQ_R_ACR.CommandText +
              ' and acr.DATA_ATENDIMENTO >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' and '+
              '       acr.DATA_ATENDIMENTO <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';
      end;
   PCP_SQ_R_ACR.CommandText := PCP_SQ_R_ACR.CommandText + 'order by ACR.ID_EMPRESA, ACR.DATA_ATENDIMENTO';

   //GerarSqlTxt(PCP_SQ_R_ACR);
   Result := PCP_DP_R_ACR.Data;
end;

function TSM.PCP_DP_R_CDPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor - Em 16/10/2014 }
  PCP_SQ_R_CDP.Close;

  PCP_SQ_R_CDP.CommandText :=
     ' select cdp.* , ITE.DESCRICAO AS INT_NOMEITE ' +
     ' from PCP_TB_C_CDP CDP                       ' +
     ' LEFT OUTER JOIN CAD_TB_C_ITE ITE ON         ' +
     '                ITE.ID_ITEM=CDP.ID_ITEM      ' +
     ' where 1 = 1 ' ;

  if input[0] <> '' then
     begin
       PCP_SQ_R_CDP.CommandText :=  PCP_SQ_R_CDP.CommandText +
                    ' and cdp.id_item in (' + VarToStr(Input[0]) +') ';

     end;

  if input[1] = '0' then
     PCP_SQ_R_CDP.CommandText := PCP_SQ_R_CDP.CommandText +
                                 ' order by cdp.id_item '
  else if input[1] = '1' then
     PCP_SQ_R_CDP.CommandText := PCP_SQ_R_CDP.CommandText +
                                 ' order by ite.descricao ';

  Result := PCP_DP_R_CDP.Data;
end;

function TSM.PCP_DP_R_CDRDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
begin
  PCP_SQ_R_CDR.Close;

  PCP_SQ_R_CDR.CommandText :=
      '  select CDR.* , GRU.DESCRICAO AS INT_NOMEGRU, COC.DESCRICAO AS INT_NOMECOC, ' +
      '  COG.DESCRICAO AS INT_NOMECOG                                               ' +
      '  from PCP_TB_C_CDR CDR                                                      ' +
      '  LEFT OUTER JOIN CAD_TB_C_GRU GRU ON GRU.ID_GRUPO = CDR.ID_GRUPO            ' +
      '  LEFT OUTER JOIN CAD_TB_C_COR COC ON COC.ID_COR   = CDR.ID_COR_CADARCO      ' +
      '  LEFT OUTER JOIN CAD_TB_C_COR COG ON COG.ID_COR   = CDR.ID_COR_GRUPO        ' +
      ' where 1 = 1 ' ;
  if input[0] <> '' then
     begin
       PCP_SQ_R_CDR.CommandText :=  PCP_SQ_R_CDR.CommandText +
                    ' and cdr.id_grupo in (' + VarToStr(Input[0]) +') ';
     end;
  if input[1] <> '' then
     begin
       PCP_SQ_R_CDR.CommandText :=  PCP_SQ_R_CDR.CommandText +
                    ' and cdr.id_cor_grupo in (' + VarToStr(Input[1]) +') ';
     end;
  if input[2] <> '' then
     begin
       PCP_SQ_R_CDR.CommandText :=  PCP_SQ_R_CDR.CommandText +
                    ' and cdr.id_cor_cadarco in (' + VarToStr(Input[2]) +') ';
     end;

  if input[3] = '0' then
     PCP_SQ_R_CDR.CommandText := PCP_SQ_R_CDR.CommandText +
                                 ' order by cdr.id_grupo '
  else if input[3] = '1' then
     PCP_SQ_R_CDR.CommandText := PCP_SQ_R_CDR.CommandText +
                                 ' order by gru.descricao ';

  Result := PCP_DP_R_CDR.Data;
end;

function TSM.PCP_DP_R_CRGDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelPcpCrg: String;
  begin
    Result :=
      'select CRG.* , SEC.DESCRICAO AS INT_NOMESET, '+
      ' case crg.tipo                  ' +
      '  when 0 then ''Vendedor''      ' +
      '  when 1 then ''Representante'' ' +
      '  when 2 then ''Outros''        ' +
      ' else ''?????'' end as int_tipo ' +
      'from PCP_TB_C_CRG CRG '+
      'LEFT OUTER JOIN CAD_TB_C_SET SEC ON SEC.ID_SETOR=CRG.ID_SETOR ';
  end;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 21/10/2014. }


   PCP_SQ_R_CRG.Close;
   PCP_SQ_R_CRG.CommandText := enSqlRelPcpCrg + ' WHERE 1=1 ';

   if Input[0] <> '' then
      begin
        PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
            ' and CRG.TIPO = ''' + VarToStr(Input[0]) +''' ';
      end;

   if Input[1] <> '' then
      begin
        PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
            ' and CRG.ID_SETOR in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[2] = 0 then  // Geral
      begin
        if Input[3] = 0 then
           PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
                                      ' order by crg.id_cargo '
        else if Input[3] = 1 then
             PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
                                      ' order by crg.descricao ';
      end
   else if Input[2] = 1 then  // por Setor
      begin
        if Input[3] = 0 then
           PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
                                      ' order by crg.id_setor, crg.id_cargo '
        else if Input[3] = 1 then
             PCP_SQ_R_CRG.CommandText := PCP_SQ_R_CRG.CommandText +
                                      ' order by crg.id_setor, crg.descricao ';
      end;
   Result := PCP_DP_R_CRG.Data;
end;

function TSM.PCP_DP_R_CRP_ITEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCrpIte, CondicaoOrder,CondicaoHaving,CondicaoGroup: String;
begin
    enSqlCrpIte := '';

    //  Input[0]  Relatrios
             //   0 - Geral
             //   1 - Por item
    //  Input[1]  Empresa
    //  Input[2]  Data inicial
    //  Input[3]  Data final
    //  Input[4]  Recipiente
    //  Input[5]  id_almoxarifado
    //  input[6]  Itens
    //  input[7]  Itens com saldo > 0
              // 0 - No
              // 1 - Sim

    CondicaoOrder := '';
    CondicaoGroup := '';


    enSqlCrpIte :=
       'select cit.id_crp, cit.id_sequencia, CIT.id_item, cit.id_cor, cit.id_tamanho,  ' +
       '  cit.num_lote,cit.qtde,cit.qtde_baixada, crp.dta_emissao, ' +
       '  crp.id_almoxarifado,crp.num_lote_crp,                    ' +
       '  ITE.DESCRICAO AS INT_NOMEITE,                            ' +
       '  ITE.ID_UND_VENDA AS INT_NOMEUND,                         ' +
       '  COR.DESCRICAO AS INT_NOMECOR,                            ' +
       '  TAM.DESCRICAO AS INT_NOMETAM,                            ' +
       '  fun.nome as int_nomefun,                                 ' +
       '  rpt.descricao as int_nomerpt,                                ' +
       '  alm.descricao as int_nomealm, (QTDE - QTDE_BAIXADA) AS SALDO ' +
       ' from PCP_TB_M_CRP_ITE CIT                                                     ' +
       ' left outer join pcp_tb_m_crp crp  on crp.id_crp = cit.id_crp                  ' +
       ' left outer join pcp_tb_c_rpt rpt on rpt.id_rpt = crp.id_rpt                   ' +
       ' left outer join cad_tb_c_ite   ite   on ite.id_item    = cit.id_item          ' +
       ' left outer join cad_tb_c_cor  cor  on cor.id_cor   = CIT.id_cor               ' +
       ' left outer join cad_tb_c_tam tam on tam.id_tamanho = CIT.id_tamanho           ' +
       ' left outer join cad_tb_c_fun fun on fun.id_funcionario = crp.id_responsavel   ' +
       ' left outer join cad_tb_c_alm alm on alm.id_almoxarifado = crp.id_almoxarifado ' +
       ' WHERE CRP.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';

    //CondicaoGroup  := ' GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14 ';
    // CondicaoHaving := ' HAVING (QTDE - QTDE_BAIXADA) > 0 ';
    if Input[0] = 0 then
       begin
         CondicaoOrder :=  'ORDER BY CRP.ID_EMPRESA, CRP.ID_ALMOXARIFADO,  CRP.NUM_LOTE_CRP, CIT.ID_ITEM, CIT.ID_SEQUENCIA  ';
       end;
    if Input[0] = 1 then
       begin
         CondicaoOrder :=  'ORDER BY CRP.ID_EMPRESA, CRP.ID_ALMOXARIFADO,  CIT.ID_ITEM, CRP.DTA_EMISSAO, CRP.NUM_LOTE_CRP  ';
       end;

    PCP_SQ_R_CRP_ITE.Close;
    PCP_SQ_R_CRP_ITE.CommandText := '';
    PCP_SQ_R_CRP_ITE.CommandText := enSqlCrpIte;

    PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  +
              ' AND   crp.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
              '       crp.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';

    if Input[4] <> '' then
        begin
           PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  +
               ' AND crp.id_rpt in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  +
               ' AND crp.id_almoxarifado = ''' + VarToStr(Input[5]) +''' ';
        end;

    if Input[6] <> '' then
       begin
          PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  +
              ' AND cit.id_item in (' + VarToStr(Input[6]) +') ';
       end;

    if Input[7] > 0 then
       begin
           PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  +
           ' AND ((cit.QTDE - cit.QTDE_BAIXADA) > 0) ';
       end;

   if CondicaoGroup<>'' then
      begin
        PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        PCP_SQ_R_CRP_ITE.CommandText := PCP_SQ_R_CRP_ITE.CommandText  + CondicaoOrder;
      end;

   Result := PCP_DP_R_CRP_ITE.Data;

   PCP_SQ_R_CRP_ITE.Close;
end;


function TSM.PCP_DP_R_CRP_ITE_BXIDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
var
    enSqlCrpIteBxi, CondicaoOrder,CondicaoHaving,CondicaoGroup: String;
begin
    enSqlCrpIteBxi := '';

    //  Input[0]  Relatrios
             //   2 - Baixas por item
             //   3 - Baixas por recipientes
    //  Input[1]  Empresa
    //  Input[2]  Data inicial
    //  Input[3]  Data final
    //  Input[4]  Recipiente
    //  Input[5]  id_almoxarifado
    //  input[6]  Itens

    CondicaoOrder := '';
    CondicaoGroup := '';


    enSqlCrpIteBxi :=
       'select bxi.id_crp_bxi, bxi.dta_baixa, bxi.id_item, bxi.id_cor, bxi.id_tamanho,bxi.id_sequencia,  ' +
       '  ite.id_und_compra, bxi.num_lote,bxi.qtde as qtde_bxa, bxi.id_opb,bxi.id_opb_ope, ' +
       ' (cast(bxi.id_item as char)||cast(bxi.id_cor as char)||cast(bxi.id_tamanho as char)) as ITEM, ' +
       '  cte.num_lote as num_lote_crp_ite,cte.qtde as qtde_cpr_ite, crp.dta_emissao, ' +
       '  crp.id_almoxarifado,crp.num_lote_crp,                    ' +
       '  ITE.DESCRICAO AS INT_NOMEITE,                            ' +
       '  ITE.ID_UND_VENDA AS INT_NOMEUND,                         ' +
       '  COR.DESCRICAO AS INT_NOMECOR,                            ' +
       '  TAM.DESCRICAO AS INT_NOMETAM,                            ' +
       '  fun.nome as int_nomefun,                                 ' +
       '  rpt.descricao as int_nomerpt,                            ' +
       '  alm.descricao as int_nomealm ' +
       ' from PCP_TB_M_CRP_ITE_BXI BXI                                                     ' +
       ' left outer join pcp_tb_m_crp_ite cte on  bxi.id_crp = cte.id_crp     ' +
       '                                      and bxi.id_sequencia = cte.id_sequencia ' +
       ' left outer join pcp_tb_m_crp crp     on crp.id_crp = cte.id_crp        ' +
       ' left outer join pcp_tb_c_rpt rpt on rpt.id_rpt = crp.id_rpt            ' +
       ' left outer join cad_tb_c_ite ite on ite.id_item  = bxi.id_item         ' +
       ' left outer join cad_tb_c_cor cor on cor.id_cor   = bxi.id_cor               ' +
       ' left outer join cad_tb_c_tam tam on tam.id_tamanho = bxi.id_tamanho           ' +
       ' left outer join cad_tb_c_fun fun on fun.id_funcionario = crp.id_responsavel   ' +
       ' left outer join cad_tb_c_alm alm on alm.id_almoxarifado = crp.id_almoxarifado ' +
       ' WHERE CRP.ID_EMPRESA in (' + VarToStr(Input[1]) +') ';

    if Input[0] = 2 then
       begin
         CondicaoOrder :=  'ORDER BY CRP.ID_EMPRESA, CRP.ID_ALMOXARIFADO,  BXI.ID_SEQUENCIA  ';
       end;
    if Input[0] = 3 then
       begin
         CondicaoOrder :=  'ORDER BY CRP.ID_EMPRESA, CRP.ID_ALMOXARIFADO,  CRP.NUM_LOTE_CRP, BXI.DTA_BAIXA, num_lote_crp_ite ';
       end;

    PCP_SQ_R_CRP_ITE_BXI.Close;
    PCP_SQ_R_CRP_ITE_BXI.CommandText := '';
    PCP_SQ_R_CRP_ITE_BXI.CommandText := enSqlCrpIteBxi;

    PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  +
              ' AND   bxi.dta_baixa >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' AND ' +
              '       bxi.dta_baixa <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[3])) ) +''' ';

    if Input[4] <> '' then
        begin
           PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  +
               ' AND crp.id_rpt in (' + VarToStr(Input[4]) +') ';
        end;

    if Input[5] <> '' then
        begin
          PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  +
               ' AND crp.id_almoxarifado = ''' + VarToStr(Input[5]) +''' ';
        end;

    if Input[6] <> '' then
       begin
          PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  +
              ' AND bxi.id_item in (' + VarToStr(Input[6]) +') ';
       end;

   if CondicaoGroup<>'' then
      begin
        PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  + CondicaoGroup;
      end;

   if CondicaoOrder<>'' then
      begin
        PCP_SQ_R_CRP_ITE_BXI.CommandText := PCP_SQ_R_CRP_ITE_BXI.CommandText  + CondicaoOrder;
      end;

   Result := PCP_DP_R_CRP_ITE_BXI.Data;

   PCP_SQ_R_CRP_ITE_BXI.Close;
end;

function TSM.PCP_DP_R_EPPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpEpp: String;
  begin
    Result :=
      ' select epp.id_empresa, par.emp_fantasia, ' + #13#10 +
      '       epp.id_almoxarifado, alm.descricao as int_nomealm, epp.dta_entrada,epp.tipo_entrada,' + #13#10 +
      '       epi.id_item, ' +
      ' case   ' +
      '   when etq.pcp_obs_item <> '''' then etq.pcp_obs_item  ' +
      ' else     ' +
      '   ite.descricao end as int_nomeite,  ' +
      ' ite.id_und_venda, epi.id_cor,' + #13#10 +
      '       cor.descricao as int_nomecor, epi.id_tamanho, tam.descricao as int_nometam, ' +
      '       sum(coalesce(epi.qtde,0)) as qtde, ' + #13#10 +
      '       sum(case                           ' + #13#10 +
      '           when coalesce(ite.sgq_tamanho_ite_epp,0) > 0  ' + #13#10 +
      '              then coalesce(epi.qtde,0) * coalesce(ite.sgq_tamanho_ite_epp,0)  ' + #13#10 +
      '       else 0 end) as total_metro  ' + #13#10 +
      'from pcp_tb_m_epp_ite epi  ' + #13#10 +
      '   left outer join cad_tb_c_ite ite on ite.id_item = epi.id_item' + #13#10 +
      '   left outer join cad_tb_c_cor cor on cor.id_cor = epi.id_cor' + #13#10 +
      '   left outer join cad_tb_c_tam tam on tam.id_tamanho = epi.id_tamanho' + #13#10 +
      '   left outer join pcp_tb_m_etq etq on etq.cod_barra = epi.cod_barra ' +
      '   left outer join pcp_tb_m_epp epp on epp.id_epp = epi.id_epp' + #13#10 +
      '   left outer join cad_tb_c_par par on par.id_empresa = epp.id_empresa   ' + #13#10 +
      '   left outer join cad_tb_c_alm alm on alm.id_almoxarifado = epp.id_almoxarifado' + #13#10 +
      '   left outer join cad_tb_c_fun fun on fun.id_funcionario = epp.id_responsavel' + #13#10 ;

  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 03/10/2017. }
   

   PCP_SQ_R_EPP.Close;
   PCP_SQ_R_EPP.CommandText := enSqlRelPcpEpp ;

   PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
              ' where epp.dta_entrada >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' and '+
              '       epp.dta_entrada <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' and '+
              '       epp.tipo_entrada = ' + VarToStr(Input[7]) +' ';;

   if Input[3] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end;

   {if Input[5] <> '' then
        begin
          PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
               ' and EPP.id_tipo_mov_estoque in (' + VarToStr(Input[5]) +') ';
        end;}

   if Input[5] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_RESPONSAVEL in (' + VarToStr(Input[5]) +') ';
      end;


   if Input[6] <> '' then
        begin
           PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[6]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText + ' OR ';
              end;

           PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText + ' ) ';

        end;

   PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
                                ' group by 1,2,3,4,5,6,7,8,9,10,11,12,13' +
                                ' order by epp.id_empresa, epp.id_almoxarifado, epp.dta_entrada, epi.id_item,cor.descricao ';
   Result := PCP_DP_R_EPP.Data;

   PCP_SQ_R_EPP.close;
end;

function TSM.PCP_DP_R_EPP_FUNDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpEppFun: String;
  begin
    Result :=
       { ' select epp.id_empresa, par.emp_fantasia,   ' + #13#10 +
        '       epp.id_almoxarifado, alm.descricao as int_nomealm,' + #13#10 +
        '       epp.dta_entrada, ite.id_grupo,' +
        '       epi.id_func_colchoaria, fun.nome as int_nomefun,   ' + #13#10 +
        ' sum(coalesce(epi.qtde,0)) as qtde' + #13#10 +   }

        ' select epp.id_empresa, par.emp_fantasia, ' + #13#10 +
        '       epp.id_almoxarifado, alm.descricao as int_nomealm,' + #13#10 +
        '       coalesce(epi.id_func_colchoaria,0) id_func_colchoaria, fun.nome as int_nomefun,        ' + #13#10 +
        '       ite.id_grupo, gru.descricao, sum(coalesce(epi.qtde,0)) as qtde' +
        ' from pcp_tb_m_epp_ite epi  ' + #13#10 +
        '   left outer join pcp_tb_m_epp epp on epp.id_epp = epi.id_epp' + #13#10 +
        '   left outer join cad_tb_c_ite ite on ite.id_item = epi.id_item' + #13#10 +
        '   left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo' + #13#10 +
        '   left outer join cad_tb_c_par par on par.id_empresa = epp.id_empresa   ' + #13#10 +
        '   left outer join cad_tb_c_alm alm on alm.id_almoxarifado = epp.id_almoxarifado' + #13#10 +
        '   left outer join cad_tb_c_fun fun on fun.id_funcionario = epi.id_func_colchoaria' + #13#10 ;
  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 03/12/2021. }


   PCP_SQ_R_EPP_FUN.Close;
   PCP_SQ_R_EPP_FUN.CommandText := enSqlRelPcpEppFun ;

   PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText  +
              ' where epp.dta_entrada >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' and '+
              '       epp.dta_entrada <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' and ' +
              '       epp.tipo_entrada = ' + VarToStr(Input[7]);
             // '       coalesce(epi.id_func_colchoaria,0) > 0 ';
              //'       epp.tipo_entrada = ' + VarToStr(Input[7]) +' ';;

   if Input[3] <> '' then
      begin
        PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText +
            ' and EPP.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText +
            ' and EPP.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end;

   {if Input[5] <> '' then
        begin
          PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
               ' and EPP.id_tipo_mov_estoque in (' + VarToStr(Input[5]) +') ';
        end;}

   if Input[5] <> '' then
      begin
        PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText +
            ' and EPP.ID_RESPONSAVEL in (' + VarToStr(Input[5]) +') ';
      end;


   if Input[6] <> '' then
        begin
           PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[6]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText + ' OR ';
              end;

           PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText + ' ) ';

        end;

   PCP_SQ_R_EPP_FUN.CommandText := PCP_SQ_R_EPP_FUN.CommandText +
                                ' group by 1,2,3,4,5,6,7,8' +
                                ' order by 1,5,6,7 ';
   Result := PCP_DP_R_EPP_FUN.Data;



end;

function TSM.PCP_DP_R_EPP_FUN_DETDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpEppFunDet: String;
  begin
    Result :=
      ' select epp.id_empresa, par.emp_fantasia, ' + #13#10 +
      '       epp.id_almoxarifado, alm.descricao as int_nomealm,' + #13#10 +
      '       coalesce(epi.id_func_colchoaria,0) id_func_colchoaria, fun.nome as int_nomefun,        ' + #13#10 +
      '       ite.id_grupo,gru.descricao, ' + #13#10 +
      '       ite.id_item, ' + #13#10 +
      '       cast(' + #13#10 +
      '          case ' + #13#10 +
      '             when rtrim(etq.pcp_obs_item) <> '''' then pcp_obs_item' + #13#10 +
      '          else ite.descricao end as varchar(50)) as int_nomeite, ' + #13#10 +
      '          ' + #13#10 +
      '       sum(coalesce(epi.qtde,0)) as qtde' +
      ' from pcp_tb_m_epp_ite epi  ' + #13#10 +
      '   left outer join pcp_tb_m_epp epp on epp.id_epp = epi.id_epp' + #13#10 +
      '   left outer join pcp_tb_m_etq etq on etq.cod_barra = epi.cod_barra  ' +
      '   left outer join cad_tb_c_ite ite on ite.id_item = epi.id_item' + #13#10 +
      '   left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo' + #13#10 +
      '   left outer join cad_tb_c_par par on par.id_empresa = epp.id_empresa   ' + #13#10 +
      '   left outer join cad_tb_c_alm alm on alm.id_almoxarifado = epp.id_almoxarifado' + #13#10 +
      '   left outer join cad_tb_c_fun fun on fun.id_funcionario = epi.id_func_colchoaria';
  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 15/12/2021. }


   PCP_SQ_R_EPP_FUN_DET.Close;
   PCP_SQ_R_EPP_FUN_DET.CommandText := enSqlRelPcpEppFunDet ;

   PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText  +
              ' where epp.dta_entrada >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' and '+
              '       epp.dta_entrada <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' and ' +
              '       epp.tipo_entrada = ''' + VarToStr(Input[7]) +''' and ' +
              '       coalesce(epi.id_func_colchoaria,0) = 0 ';


   if Input[3] <> '' then
      begin
        PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText +
            ' and EPP.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText +
            ' and EPP.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
        PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText +
            ' and EPP.ID_RESPONSAVEL in (' + VarToStr(Input[5]) +') ';
      end;


   if Input[6] <> '' then
        begin
           PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[6]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText + ' OR ';
              end;

           PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText + ' ) ';

        end;

   PCP_SQ_R_EPP_FUN_DET.CommandText := PCP_SQ_R_EPP_FUN_DET.CommandText +
                                ' group by 1,2,3,4,5,6,7,8,9,10' +
                                ' order by 1,5,6,7 ';
   Result := PCP_DP_R_EPP_FUN_DET.Data;



end;

function TSM.PCP_DP_R_EPP_GRUDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpEpp: String;
  begin
    Result :=
      ' select epp.id_empresa, par.emp_fantasia, ' + #13#10 +
      '       epp.id_almoxarifado, alm.descricao as int_nomealm, ' + #13#10 +
      '       ite.id_grupo, gru.descricao as int_nomegru,epp.tipo_entrada,  ' +
      '       sum(coalesce(epi.qtde,0)) as qtde, ' + #13#10 +
      '       sum(case                           ' + #13#10 +
      '           when coalesce(ite.sgq_tamanho_ite_epp,0) > 0  ' + #13#10 +
      '              then coalesce(epi.qtde,0) * coalesce(ite.sgq_tamanho_ite_epp,0)  ' + #13#10 +
      '       else 0 end) as total_metro  ' + #13#10 +
      'from pcp_tb_m_epp_ite epi  ' + #13#10 +
      '   left outer join cad_tb_c_ite ite on ite.id_item = epi.id_item ' + #13#10 +
      '   left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ' + #13#10 +
      '   left outer join cad_tb_c_cor cor on cor.id_cor = epi.id_cor' + #13#10 +
      '   left outer join cad_tb_c_tam tam on tam.id_tamanho = epi.id_tamanho' + #13#10 +
      '   left outer join pcp_tb_m_etq etq on etq.cod_barra = epi.cod_barra ' +
      '   left outer join pcp_tb_m_epp epp on epp.id_epp = epi.id_epp' + #13#10 +
      '   left outer join cad_tb_c_par par on par.id_empresa = epp.id_empresa   ' + #13#10 +
      '   left outer join cad_tb_c_alm alm on alm.id_almoxarifado = epp.id_almoxarifado' + #13#10 +
      '   left outer join cad_tb_c_fun fun on fun.id_funcionario = epp.id_responsavel' + #13#10 ;

  end;
var
  ListaCodGrupo:TStrings;
  i:Integer;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 03/10/2017. }


   PCP_SQ_R_EPP.Close;
   PCP_SQ_R_EPP.CommandText := enSqlRelPcpEpp ;

   PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
              ' where epp.dta_entrada >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' and '+
              '       epp.dta_entrada <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[2])) ) +''' and ' +
              '       epp.tipo_entrada = ' + VarToStr(Input[7]) +' ';;

   if Input[3] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_EMPRESA in (' + VarToStr(Input[3]) +') ';
      end;

   if Input[4] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_ALMOXARIFADO in (' + VarToStr(Input[4]) +') ';
      end;

   {if Input[5] <> '' then
        begin
          PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
               ' and EPP.id_tipo_mov_estoque in (' + VarToStr(Input[5]) +') ';
        end;}

   if Input[5] <> '' then
      begin
        PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
            ' and EPP.ID_RESPONSAVEL in (' + VarToStr(Input[5]) +') ';
      end;


   if Input[6] <> '' then
        begin
           PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
              ' AND ( ';

            ListaCodGrupo := TStringList.Create;
            LIstaCodGrupo.Delimiter:=',';
            LIstaCodGrupo.StrictDelimiter:=True;
            ListaCodGrupo.DelimitedText :=  VarToStr(Input[6]);

            for i := 0 to ListaCodGrupo.Count-1 do
              begin
                if (copy(ListaCodGrupo[i],2,7)='') or (copy(ListaCodGrupo[i],2,7)='.00.000') then
                  begin
                      PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,1)+'.00.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,1)+'.99.999'' ) ';
                  end
                else if (copy(ListaCodGrupo[i],5,4)='') or (copy(ListaCodGrupo[i],5,4)='.000') then
                  begin
                      PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo > '''+copy(ListaCodGrupo[i],1,4)+'.000'' and '+
                        '  ite.id_grupo <='''+copy(ListaCodGrupo[i],1,4)+'.999'' ) ';
                  end
                else
                  begin
                     PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText  +
                        ' (ite.id_grupo = '''+ListaCodGrupo[i]+''' ) ';
                  end;

                if i < (ListaCodGrupo.Count-1) then
                  PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText + ' OR ';
              end;

           PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText + ' ) ';

        end;

   PCP_SQ_R_EPP.CommandText := PCP_SQ_R_EPP.CommandText +
                                ' group by 1,2,3,4,5,6,7' +
                                ' order by epp.id_empresa, epp.id_almoxarifado,  ite.id_grupo ';
   Result := PCP_DP_R_EPP.Data;

   PCP_SQ_R_EPP.close;
end;

function TSM.PCP_DP_R_IQFDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpIqf: String;
     begin
       result :=
           ' select iqf.* , ' +
           ' ' +
           '   case status_semestre1 ' +
           '     when 1 then ''Sem Fornecimento'' ' +
           '     when 2 then ''Ruim - Desqualificar Fornecedor'' '+
           '     when 3 then ''Regular - Enviar Plano de Ao'' ' +
           '     when 4 then ''Bom'' ' +
           '   end as int_status_semestre1, ' +
           '   ' +
           '   case status_semestre2 ' +
           '     when 1 then ''Sem Fornecimento'' ' +
           '     when 2 then ''Ruim - Desqualificar Fornecedor'' ' +
           '     when 3 then ''Regular - Enviar Plano de Ao''  ' +
           '     when 4 then ''Bom''        ' +
           '   end as int_status_semestre2, ' +
           ' ' +
           '   case ra_metodo1_status ' +
           '   when ''0'' then ''Requalificado'' ' +
           '   when ''1'' then ''Requer Plano de Ao'' ' +
           '   when ''2'' then ''Desqualificado'' ' +
           '   end as int_ra_metodo1status, coalesce(frn.doc_cnpj,'''')||coalesce(frn.doc_cpf,'''') as int_cnpjcpf, ' +
           '     fun.nome as int_nomeres, frn.fantasia as int_nomefor ' +
           ' from pcp_tb_m_iqf iqf                                    ' +
           '      left outer join cad_tb_c_fun fun on fun.id_funcionario = iqf.id_responsavel ' +
           '      left outer join cad_tb_c_for frn on frn.id_fornecedor  = iqf.id_fornecedor  ';
     end;
begin
   PCP_SQ_R_IQF.Close;

   // index: 0,Ano;

   PCP_SQ_R_IQF.CommandText := enSqlRelPcpIqf +
          ' WHERE IQF.ANO_IQF = ''' + VarToStr(Input[0]) + ''' ';

   if Input[1] <> '' then
      begin
        PCP_SQ_R_IQF.CommandText :=  PCP_SQ_R_IQF.CommandText +
          ' and IQF.id_fornecedor in (' + VarToStr(Input[1]) +') ';
      end;

   PCP_SQ_R_IQF.CommandText := PCP_SQ_R_IQF.CommandText +
          ' order by IQF.id_fornecedor ';

   Result := PCP_DP_R_IQF.Data;
end;

function TSM.PCP_DP_R_LMEDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpLme: String;
  begin
     Result :=
        '  select LME.* , FUC.NOME AS INT_NOMERES ' +
        '  from PCP_TB_C_LME LME ' +
        '  left outer join CAD_TB_C_FUN FUC ON FUC.ID_FUNCIONARIO=LME.ID_RESPONSAVEL ';
  end;
begin

   PCP_SQ_R_LME.Close;

   PCP_SQ_R_LME.Close;
   PCP_SQ_R_LME.CommandText := enSqlRelPcpLme + ' WHERE 1=1 ';

   if Input[0]  <> '' then
      begin
        PCP_SQ_R_LME.CommandText :=
          PCP_SQ_R_LME.CommandText +
          ' and lme.id_lme in (' + VarToStr(Input[0]) +') ';
      end;

   PCP_SQ_R_LME.CommandText :=
          PCP_SQ_R_LME.CommandText + ' order by id_lme ';


   Result := PCP_DP_R_LME.Data;
end;

function TSM.PCP_DP_R_MEQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlRelPcpMeq: String;
  begin
    Result :=
      'select MEQ.*, '+
      ' mde.descricao as int_nomemde, '+
      ' fon.descricao as int_nomefab, '+
      ' sto.descricao as int_nomeset, '+
      ' fuc.nome as int_nomefuc, '+
      ' case meq.tipo_mei       ' +
      '  when 0 then ''Mquina'' '+
      '  when 1 then ''Equipamento'' '+
      '  when 2 then ''Outros'' ' +
      '  else ''?????'' end as int_tipo ' +
      'from PCP_TB_C_MEQ MEQ '+
      ' left outer join pcp_tb_c_mde mde on mde.id_mde=MEQ.id_mde '+
      ' left outer join cad_tb_c_for fon on fon.id_fornecedor=MEQ.id_fabricante '+
      ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=MEQ.id_resp_lancto ' +
      ' left outer join cad_tb_c_set sto on sto.id_setor = meq.id_setor ';
  end;
begin

   { TODO -oMaxsuel -cCriao : Mtodo criado por Maxsuel Victor em 21/10/2014. }

   PCP_SQ_R_MEQ.Close;
   PCP_SQ_R_MEQ.CommandText := enSqlRelPcpMeq + ' WHERE 1=1 ';
   if Input[0] <> '' then
      begin
         PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText +
             ' and MEQ.TIPO_MEI = ''' + VarToStr(Input[0]) +''' ';
      end;
   if Input[1] <> '' then
      begin
        PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText +
            ' and MEQ.ID_SETOR in (' + VarToStr(Input[1]) +') ';
      end;

   if Input[2] = 0 then // Listagem Geral
      begin
         if Input[3] = 0 then
            PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText + ' order by meq.id_meq '
         else if Input[3] = 1 then
              PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText + ' order by meq.descricao ';
      end;

   if Input[2] = 1 then // Listagem por Setor
      begin
         if Input[3] = 0 then
            PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText + ' order by meq.id_setor, meq.id_meq '
         else if Input[3] = 1 then
              PCP_SQ_R_MEQ.CommandText := PCP_SQ_R_MEQ.CommandText + ' order by meq.id_setor, meq.descricao ';
      end;


   Result := PCP_DP_R_MEQ.Data;
end;

function TSM.PCP_DP_R_ORSDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
 function enSqlRelOrs: String;
  begin
    Result :=
         ' select ors.* , fuc.nome as int_nomeres,                                 ' +
         ' mta.nome as int_nomemta,                                                ' +
         ' cli.nome as int_nomecli, cli.tel_fixo as int_telfixo, fnc.nome as int_nomeven,                  ' +
         ' rom.dta_emissao as int_dta_rom,fuc2.nome as int_nomeresp_rom, ped.pcp_id_opr as int_id_opr ' +
         '                                                                         ' +
         ' from pcp_tb_m_ors ors                                                   ' +
         ' left outer join cad_tb_c_fun fuc on fuc.id_funcionario=id_responsavel   ' +
         ' left outer join fat_tb_m_ped ped on ped.id_pedido = ors.id_pedido       ' +
         ' left outer join cad_tb_c_cli cli on cli.id_cliente = ped.id_cliente     ' +
         ' left outer join pcp_tb_c_mta mta on mta.id_motorista = ors.id_motorista ' +
         ' left outer join pcp_tb_m_rom rom on rom.id_rom = ors.id_rom             ' +
         ' left outer join cad_tb_c_fun fuc2 on fuc2.id_funcionario = rom.id_responsavel ' +
         ' left outer join cad_tb_c_fun fnc  on fnc.id_funcionario = ped.id_vendedor  ';
  end;
begin

{ TODO -oMaxsuel -cCriao :
Criado em 21/03/2016
Mtodo responsvel de gerar o relatrio de Ordens de Faturamento }
   PCP_SQ_R_ORS.Close;

   PCP_SQ_R_ORS.CommandText := enSqlRelOrs +
          ' WHERE ors.id_empresa in (' + VarToStr(Input[1]) +') ' +
          ' AND ors.dta_emissao >= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[2])) ) + ''' ' +
          ' AND ors.dta_emissao <= ''' + FormatDateTime(CFormatoData, strToDate( VarToStr(Input[3])) ) + ''' ';

   if Input[4] <> '' then
      begin
         PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
             ' and ors.id_motorista in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5] <> '' then
      begin
         PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
             ' and ors.id_almoxarifado in (' + VarToStr(Input[5]) +') ';
      end;

   if Input[6] <> '' then
      begin
         PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
             ' and ors.id_responsavel in (' + VarToStr(Input[6]) +') ';
      end;


   if Input[0] = 0 then // Ordem de Faturamento - Geral
      begin
         if Input[7] <> '1' then // Ordenar por emisso da ors
            begin
               PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
                   ' order by ors.id_empresa, ors.dta_emissao, cli.nome ';
            end;

         if Input[7] <> '2' then // Ordenar por romaneio
            begin
               PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
                   ' order by ors.id_empresa, ors.id_rom, ors.dta_emissao, cli.nome ';
            end;
      end;

   if Input[0] = 1 then  // Ordem de Faturamento - Por romaneio
      begin
         if Input[7] <> '1' then // Ordenar por emisso da ors
            begin
               PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
                   ' order by ors.id_empresa, ors.id_rom, ors.dta_emissao, cli.nome ';
            end;

         if Input[7] <> '2' then // Ordenar por romaneio
            begin
               PCP_SQ_R_ORS.CommandText := PCP_SQ_R_ORS.CommandText +
                   ' order by ors.id_empresa, ors.id_rom, cli.nome ';
            end;
      end;

   Result := PCP_DP_R_ORS.Data;

   PCP_SQ_R_ORS.Close;
end;

function TSM.PCP_DP_R_PRPDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpPrp: String;
  begin
     Result :=
         ' select prp.*, ' +
         '   prp.id_grupo, prp.id_item,  ' +
         '   gru.descricao as int_descgru, ite.descricao as int_descite ' +
         ' ' +
         ' from pcp_tb_c_prp prp ' +
         '   left outer join cad_tb_c_gru gru on gru.id_grupo = prp.id_grupo ' +
         '   left outer join cad_tb_c_ite ite on ite.id_item  = prp.id_item  ' ;

  end;

begin

   PCP_SQ_R_PRP.Close;

   PCP_SQ_R_PRP.Close;
   PCP_SQ_R_PRP.CommandText := enSqlRelPcpPrp + ' WHERE 1=1 ';

   if Input[0]  <> '' then
      begin
        PCP_SQ_R_PRP.CommandText :=
          PCP_SQ_R_PRP.CommandText +
          ' and prp.id_grupo in (' + VarToStr(Input[0]) +') ';
      end;

   if Input[1]  <> '' then
      begin
        PCP_SQ_R_PRP.CommandText :=
          PCP_SQ_R_PRP.CommandText +
          ' and prp.id_item in (' + VarToStr(Input[1]) +') ';
      end;

   PCP_SQ_R_PRP.CommandText :=
          PCP_SQ_R_PRP.CommandText + ' order by prp.id_grupo, prp.id_item ';


   Result := PCP_DP_R_PRP.Data;
end;

function TSM.PCP_DP_R_PRQDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlRelPcpPrq: String;
  begin
     Result :=
         '  select pes.*, ' +
         '     esp.descricao as int_descesp, ' +
         '     prq.id_grupo, prq.id_item, ' +
         '     gru.descricao as int_descgru, ite.descricao as int_descite ' +
         '  from pcp_tb_c_prq_esp pes       ' +
         '    left outer join pcp_tb_c_prq prq on prq.id_prq           = pes.id_prq  ' +
         '    left outer join pcp_tb_c_esp esp on esp.id_especificacao = pes.id_especificacao ' +
         '    left outer join cad_tb_c_gru gru on gru.id_grupo         = prq.id_grupo  ' +
         '    left outer join cad_tb_c_ite ite   on ite.id_item        = prq.id_item ';
  end;

begin

   PCP_SQ_R_PRQ.Close;

   PCP_SQ_R_PRQ.Close;
   PCP_SQ_R_PRQ.CommandText := enSqlRelPcpPrq + ' WHERE 1=1 ';

   if Input[0]  <> '' then
      begin
        PCP_SQ_R_PRQ.CommandText :=
          PCP_SQ_R_PRQ.CommandText +
          ' and prq.id_grupo in (' + VarToStr(Input[0]) +') ';
      end;

   if Input[1]  <> '' then
      begin
        PCP_SQ_R_PRQ.CommandText :=
          PCP_SQ_R_PRQ.CommandText +
          ' and prq.id_item in (' + VarToStr(Input[1]) +') ';
      end;

   PCP_SQ_R_PRQ.CommandText :=
          PCP_SQ_R_PRQ.CommandText + ' order by prq.id_grupo, prq.id_item ';

   Result := PCP_DP_R_PRQ.Data;
end;

function TSM.PCP_DP_R_PSCDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpPsc: String;
  begin
    Result :=
      'select  *, '+
      ' case pergunta_1 '+
      '  WHEN '''+'0'+''' THEN ('''+'No - '+''' || pergunta_1_resposta) '+
      '  WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
      ' END PERG_1, '+
      ' CASE PERGUNTA_2 '+
      '  WHEN '''+'0'+''' THEN ('''+'No - '+''' || PERGUNTA_2_RESPOSTA) '+
      '  WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
      ' END PERG_2, '+
      ' CASE PERGUNTA_3 '+
      '  WHEN '''+'0'+''' THEN '''+'Menos de 1 ano'+''' '+
      '  WHEN '''+'1'+''' THEN '''+'Mais de 1 ano'+''' '+
      ' END PERG_3, '+
      ' CASE PERGUNTA_4 '+
      '  WHEN '''+'0'+''' THEN '''+'Melhor'+''' '+
      '  WHEN '''+'1'+''' THEN '''+'Igual'+''' '+
      '  WHEN '''+'2'+''' THEN '''+'Pior'+''' '+
      ' END PERG_4, '+
      ' CASE PERGUNTA_5 '+
      '  WHEN '''+'0'+''' THEN '''+'Excelente'+''' '+
      '  WHEN '''+'1'+''' THEN '''+'Bom'+''' '+
      '  WHEN '''+'2'+''' THEN '''+'Razovel'+''' '+
      '  WHEN '''+'3'+''' THEN '''+'Ruim'+''' '+
      ' END PERG_5 '+
      ' FROM PCP_TB_M_PSC ';
end;

begin

   //parametros
   // 0 - data inicial
   // 1 - data final
   // 2 - 0 por id_psc, 1 - por nom_cliente


   PCP_SQ_R_PSC.Close;
   PCP_SQ_R_PSC.CommandText := enSqlPcpPsc +
   ' WHERE DATA >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
   '       DATA <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';

   if Input[2] <> '' then
      begin
        PCP_SQ_R_PSC.CommandText := PCP_SQ_R_PSC.CommandText  +
              ' AND ID_EMPRESA in (' + VarToStr(Input[2]) +') ';
      end;

   if Input[3] = 0 then
      begin
        PCP_SQ_R_PSC.CommandText := PCP_SQ_R_PSC.CommandText +' order by id_psc ';
      end
   else if Input[3] = 1 then
      begin
        PCP_SQ_R_PSC.CommandText := PCP_SQ_R_PSC.CommandText +' order by nome_cliente ';
      end;

   Result := PCP_DP_R_PSC.Data;
end;

function TSM.PCP_DP_R_RAADataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
  function enSqlPcpRaa: String;
  begin
    Result :=
'select raa.*, fil.emp_fantasia, fil.emp_endereco, fil.emp_numero, fil.emp_bairro, '+
'      fil.id_cidade, cid.uf as int_uf, fil.emp_cep, fil.emp_telefone, '+
'      frn.descricao fornecedor, str.descricao setor, '+
'      fab.descricao fabricante, ana.nome analista, gru.descricao as int_nomegru, '+
'      cast(raa.id_item as varchar) || '''+' - '+''' || ite.descricao desc_item, '+
'      CASE RAA.PERGUNTA_1 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_1, '+
'      CASE RAA.PERGUNTA_2 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_2, '+
'      CASE RAA.PERGUNTA_3 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_3, '+
'      CASE RAA.PERGUNTA_4 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_4, '+
'      CASE RAA.PERGUNTA_5 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_5, '+
'      CASE RAA.PERGUNTA_6 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_6, '+
'      CASE RAA.PERGUNTA_7 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_7, '+
'      CASE RAA.PERGUNTA_8 '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      WHEN '''+'2'+''' THEN '''+'No aplicvel'+''' '+
'      END DESC_PERGUNTA_8, '+
'      CASE RAA.RESULTADO '+
'      WHEN '''+'0'+''' THEN '''+'Reprovado'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Aprovado'+''' '+
'      END DESC_RESULTADO, '+
'      CASE RAA.INCORPORA_ITEM '+
'      WHEN '''+'0'+''' THEN '''+'No'+''' '+
'      WHEN '''+'1'+''' THEN '''+'Sim'+''' '+
'      END DESC_INCORPORA_ITEM '+
'      from pcp_tb_m_raa raa '+
'      left outer join cad_tb_c_ite ite on (ite.id_item = raa.id_item) '+
'      left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo) '+
'      left outer join cad_tb_c_cor cor on (cor.id_cor = raa.id_cor) '+
'      left outer join cad_tb_c_tam tam on (tam.id_tamanho = raa.id_tamanho) '+
'      left outer join cad_tb_c_par fil on (raa.id_empresa = fil.id_empresa) '+
'      left outer join cad_tb_c_for frn on (raa.id_fornecedor = frn.id_fornecedor) '+
'      left outer join cad_tb_c_for fab on (raa.id_fabricante = fab.id_fornecedor) '+
'      left outer join cad_tb_c_set str on (raa.id_setor = str.id_setor) '+
'      left outer join cad_tb_c_fun ana on (raa.id_analista = ana.id_funcionario) '+
'      left outer join cad_tb_c_cid cid on (fil.id_cidade = cid.id_cidade) ';
  end;
begin
   //parametros
   // 0 - data inicial
   // 1 - data final
   // 2 - empresa

   // 3 - fornecedor
   // 4 - fabricante
   // 5 - 0 - raa.id_raa, raa.dta_emissao,
   //     1 - raa.dta_emissao, raa.id_raa

   PCP_SQ_R_RAA.Close;
   PCP_SQ_R_RAA.CommandText := enSqlPcpRaa +
   ' WHERE raa.dta_emissao >= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[0])) ) +''' and '+
   '       raa.dta_emissao <= ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ';
   if Input[2]  <> '' then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' and raa.id_empresa = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[3]  <> '' then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' and raa.id_fornecedor in (' + VarToStr(Input[3]) +') ';
      end;
   if Input[4]  <> '' then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' and raa.id_fabricante in (' + VarToStr(Input[4]) +') ';
      end;

   if Input[5]  <> '' then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' and raa.nro_raa = ''' + VarToStr(Input[5]) +''' ';
      end;

   if Input[6] = 0 then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' order by raa.id_raa, raa.dta_emissao ';
      end
   else if Input[6] = 1 then
      begin
        PCP_SQ_R_RAA.CommandText :=
          PCP_SQ_R_RAA.CommandText +
          ' order by raa.dta_emissao, raa.id_raa ';
      end;

   Result := PCP_DP_R_RAA.Data;
end;

function TSM.enDataServer: TDateTime;
begin
  result := Date;
end;

procedure TSM.enDesfazerFat(IdFiscal: integer; BUS_CD_M_NFE:TClientDataSet;
  var FIN_CD_M_CTA,FIN_CD_M_REC,FIN_CD_M_REC_PAG, FIN_CD_M_RCR, FIN_CD_M_CTA_RCR,
      FAT_CD_M_PED, OFI_CD_M_ORV,EST_CD_M_FES: TClientDataSet; ReabrePed:String;IdAbertura:String='');
var
  xIdCreditos: string;
  BUS_CD_M_NFE_INT,FAT_CD_M_PED_ITE: TClientDataSet;
  PermCancelar: Boolean;

  //CAD_CD_C_TME,BUS_CD_M_NFE_ITE_INT: TClientDataSet;
begin

  { TODO -oMaxsuel Victor -cCriao : Mtodo criado em 06/04/2015 }

  try

  // Verifica se h ttulos a serem excludos
  FIN_CD_M_REC := TClientDataSet.Create(self);
  FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
  FIN_CD_M_REC.Close;
  FIN_CD_M_REC.Data :=
      FIN_CD_M_REC.DataRequest(VarArrayOf([94, IdFiscal]));
  if not (FIN_CD_M_REC.IsEmpty) then
     begin
       while not (FIN_CD_M_REC.Eof)  do
          begin
            FIN_CD_M_REC.Delete;
          end;
     end;

  // Verifica se h registro de pagamento dos ttulos que so avistas a serem excludos
  FIN_CD_M_REC_PAG := TClientDataSet.Create(nil);
  FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
  FIN_CD_M_REC_PAG.Close;
  FIN_CD_M_REC_PAG.Data :=
      FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([3,IdFiscal]));
  if not (FIN_CD_M_REC_PAG.IsEmpty) then
     begin
       while not (FIN_CD_M_REC_PAG.Eof) do
          begin
            FIN_CD_M_REC_PAG.Delete;
          end;
     end;

  // Busca as movimentaes de caixa/banco gerado pela nota fiscal para ser excludo
  //Exceto para cancelamento de nota dia anterior
  if (not ((trim(IdAbertura)<>'') and
      (BUS_CD_M_NFE.FieldByname('DTA_EMISSAO').AsDateTime<Date))) then
     begin
        FIN_CD_M_CTA := TClientDataSet.Create(nil);
        FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA.Close;
        FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([96,IdFiscal]));
        if not (FIN_CD_M_CTA.IsEmpty) then
           begin
             while not (FIN_CD_M_CTA.Eof) do
               begin
                 FIN_CD_M_CTA.Delete;
               end;
           end;
     end;

  // Busca todas as notas de crdito gerada pela nota fiscal para ser excludas
  FIN_CD_M_RCR := TClientDataSet.Create(nil);
  FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
  FIN_CD_M_RCR.Close;
  FIN_CD_M_RCR.Data :=
      FIN_CD_M_RCR.DataRequest(VarArrayOf([90,IdFiscal]));

  xIdCreditos := '';

  FIN_CD_M_RCR.First;
  while not (FIN_CD_M_RCR.Eof)  do
      begin
        if xIdCreditos <> '' then
           begin
             xIdCreditos :=
             xIdCreditos + ',' +''''+ FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
           end;
        if xIdCreditos = '' then
           begin
             xIdCreditos :=
             xIdCreditos +''''+FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
           end;
        FIN_CD_M_RCR.Next;
      end;

  if not (FIN_CD_M_RCR.IsEmpty) then
     begin
       FIN_CD_M_RCR.First;
       while not (FIN_CD_M_RCR.Eof) do
          begin
            FIN_CD_M_RCR.Delete;
          end;
     end;
  if trim(xIdCreditos) <> '' then
     begin
        // Apaga todo o movimento de caixa/banco gerada pelas notas de crdito da nota fiscal
        FIN_CD_M_CTA_RCR := TClientDataSet.Create(nil);
        FIN_CD_M_CTA_RCR.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA_RCR.Close;
        FIN_CD_M_CTA_RCR.Data :=
             FIN_CD_M_CTA_RCR.DataRequest(VarArrayOf([95,xIdCreditos]));
        if not (FIN_CD_M_CTA_RCR.IsEmpty) then
           begin
             while not (FIN_CD_M_CTA_RCR.Eof) do
               begin
                 FIN_CD_M_CTA_RCR.Delete;
               end;
           end;
     end;


  {CAD_CD_C_TME := TClientDataSet.Create(nil);
  CAD_CD_C_TME.SetProvider(CAD_DP_C_TME);
  CAD_CD_C_TME.Close;
  CAD_CD_C_TME.Data :=
       CAD_CD_C_TME.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('id_tipo_mov_estoque').AsString]));}


  if BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger > 0 then
     begin

        PermCancelar := true;
        BUS_CD_M_NFE_INT := TClientDataSet.Create(nil);
        BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
        BUS_CD_M_NFE_INT.Close;
        BUS_CD_M_NFE_INT.Data :=
             BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([93,BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger]));
        if not BUS_CD_M_NFE_INT.IsEmpty then
           begin
             if BUS_CD_M_NFE_INT.RecordCount > 1 then
                begin
                  while not BUS_CD_M_NFE_INT.Eof do
                     begin
                       if BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> IdFiscal then
                          begin
                            if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '02') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '04') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '05') and
                               (not((BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger =0) and
                               (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger =0))) then
                                PermCancelar := false;
                          end;
                       BUS_CD_M_NFE_INT.Next;
                     end;
                end;
              BUS_CD_M_NFE_INT.close;

            if PermCancelar then
              begin
                // Busca o pedido de venda para ser cancelado
                FAT_CD_M_PED := TClientDataSet.Create(nil);
                FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
                FAT_CD_M_PED.Close;
                FAT_CD_M_PED.Data :=
                     FAT_CD_M_PED.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,
                                                            BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger ]));

                FAT_CD_M_PED_ITE := TClientDataSet.Create(nil);
                FAT_CD_M_PED_ITE.DataSetField := TDataSetField(FAT_CD_M_PED.FieldByName('FAT_SQ_M_PED_ITE'));

                if not (FAT_CD_M_PED.IsEmpty) then
                   begin
                     FAT_CD_M_PED.Edit;
                     if ReabrePed = 'S' then
                        begin
                          // Maxsuel Victor , em 01/12/2015
                          // Procedimento quando Cancela a nota fiscal:
                          FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger           := 0; // Em aberto;
                          if FAT_CD_M_PED.FieldByName('pcp_id_opr').AsInteger > 0 then
                             FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger        := 2; // Em produo;

                          FAT_CD_M_PED.FieldByName('SITUACAO_APROVACAO').AsInteger := 0; // Em espera;

                          FAT_CD_M_PED.FieldByName('CONFERIDO').AsBoolean := false;
                          FAT_CD_M_PED.FieldByName('RESULTADO_CONF').AsInteger := 0;
                          FAT_CD_M_PED.FieldByName('ID_RESP_CONF').AsString := '';
                          FAT_CD_M_PED.FieldByName('DTA_CONF').AsString := '';
                          FAT_CD_M_PED.FieldByName('HOR_CONF').AsString := '';

                          if not (pos('G',FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text) <> 0) then
                             begin
                               FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text :=
                                   FAT_CD_M_PED.FieldByName('TIPO_RESTRICAO').text + 'G';
                             end;

                          FAT_CD_M_PED_ITE.First;

                          while not FAT_CD_M_PED_ITE.EOF  do
                            BEGIN
                              FAT_CD_M_PED_ITE.Edit;

                              FAT_CD_M_PED_ITE.FieldByName('QTDE_CONFERIDA').AsInteger := 0;

                              FAT_CD_M_PED_ITE.Post;
                              FAT_CD_M_PED_ITE.Next;
                            END;

                        end;

                     if ReabrePed = 'N' then
                        begin
                          FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 4; // cancelado;


                        end;

                     FAT_CD_M_PED.Post;
                   end;
              end;
        end;
     end;

  if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger > 0 then
     begin
       PermCancelar := true;

        // Busca as notas fiscais da ordem de servio
        BUS_CD_M_NFE_INT := TClientDataSet.Create(nil);
        BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
        BUS_CD_M_NFE_INT.Close;
        BUS_CD_M_NFE_INT.Data :=
             BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger]));
        if not BUS_CD_M_NFE_INT.IsEmpty then
           begin
             if BUS_CD_M_NFE_INT.RecordCount > 1 then
                begin
                  while not BUS_CD_M_NFE_INT.Eof do
                     begin
                       if BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> IdFiscal then
                          begin
                            if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '02') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '04') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '05') and
                               (not((BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger =0) and
                               (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger =0))) then
                                PermCancelar := false;
                          end;
                       BUS_CD_M_NFE_INT.Next;
                     end;
                end;
             BUS_CD_M_NFE_INT.close;

             if PermCancelar then
                begin
                  // Busca a ordem de sada para ser cancelado
                  OFI_CD_M_ORV := TClientDataSet.Create(nil);
                  OFI_CD_M_ORV.SetProvider(OFI_DP_M_ORV);
                  OFI_CD_M_ORV.Close;
                     OFI_CD_M_ORV.Data :=
                         OFI_CD_M_ORV.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger,
                                                                BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,'1','']));
                  if not (OFI_CD_M_ORV.IsEmpty) then
                     begin
                       OFI_CD_M_ORV.Edit;
                       if ReabrePed='N' then
                         begin
                          OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 4; // cancelado;
                         end;
                       if ReabrePed='S' then
                         begin
                          OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 0; // em aberto;
                         end;
                       OFI_CD_M_ORV.Post;

                       {if CAD_CD_C_TME.FieldByName('esto_movimenta').AsBoolean then
                          begin
                             BUS_CD_M_NFE_ITE_INT := TClientDataSet.Create(self);
                             BUS_CD_M_NFE_ITE_INT.SetProvider(BUS_DP_M_NFE_ITE_INT);
                             BUS_CD_M_NFE_ITE_INT.Close;
                             BUS_CD_M_NFE_ITE_INT.Data :=
                               BUS_CD_M_NFE_ITE_INT.DataRequest(VarArrayOf([IdFiscal]));

                             FatAtuCustoMedItens(BUS_CD_M_NFE.FieldByName('id_empresa').AsString,EST_CD_M_FES, BUS_CD_M_NFE_ITE_INT, BUS_DP_M_FES_INT, conexao);
                          end;}
                     end;
                end;
           end;
     end;


  if BUS_CD_M_NFE.FieldByName('ID_ORDEM_GAR').AsInteger > 0 then
     begin
        PermCancelar := true;

        // Busca as notas fiscais da ordem de servio
        BUS_CD_M_NFE_INT := TClientDataSet.Create(nil);
        BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
        BUS_CD_M_NFE_INT.Close;
        BUS_CD_M_NFE_INT.Data :=
             BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([92,BUS_CD_M_NFE.FieldByName('ID_ORDEM_GAR').AsInteger]));



        if not BUS_CD_M_NFE_INT.IsEmpty then
           begin
             if BUS_CD_M_NFE_INT.RecordCount > 1 then
                begin
                  while not BUS_CD_M_NFE_INT.Eof do
                     begin
                       if BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> IdFiscal then
                          begin
                            if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '02') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '04') and
                               (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString <> '05') and
                               (not((BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger =0) and
                               (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger =0))) then
                                PermCancelar := false;
                          end;
                       BUS_CD_M_NFE_INT.Next;
                     end;
                end;
             BUS_CD_M_NFE_INT.close;

             if PermCancelar then
                begin
                  // Busca a ordem de sada para ser cancelado
                  OFI_CD_M_ORV := TClientDataSet.Create(nil);
                  OFI_CD_M_ORV.SetProvider(OFI_DP_M_ORV);
                  OFI_CD_M_ORV.Close;
                     OFI_CD_M_ORV.Data :=
                         OFI_CD_M_ORV.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ORDEM_GAR').AsInteger,
                                                                BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,'1','']));
                  if not (OFI_CD_M_ORV.IsEmpty) then
                     begin
                       OFI_CD_M_ORV.Edit;
                       OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 4; // cancelado;
                       OFI_CD_M_ORV.Post;
                     end;
                end;
           end;
     end;

  finally
     BUS_CD_M_NFE_INT.Free;
     //CAD_CD_C_TME.Free;
  end;
end;


function TSM.enDesfPeqDesp(IdTituloPag: String): String;
var
  FIN_CD_M_CTA,FIN_CD_M_PAG,FIN_CD_M_PAG_PAG: TClientDataSet;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin

  { TODO -oCriao -cMaxsuel :
    Criado em 18/11/2016
    Tem a funo de desfazer a pequena de despesa gerada pelo controle de caixa. }

  try

      FIN_CD_M_PAG := TClientDataSet.Create(nil);
      FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
      FIN_CD_M_PAG.Data :=
                  FIN_CD_M_PAG.DataRequest(VarArrayOf([10,IdTituloPag]));

      FIN_CD_M_PAG_PAG := TClientDataSet.Create(nil);
      FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
      FIN_CD_M_PAG_PAG.Data :=
                 FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([11,
                 IdTituloPag, FIN_CD_M_PAG.FieldByName('id_abertura').AsString]));

      FIN_CD_M_CTA  := TClientDataSet.Create(self);
      FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
      FIN_CD_M_CTA.Close;
      FIN_CD_M_CTA.Data :=
           FIN_CD_M_CTA.DataRequest(VarArrayOf([104,
              FIN_CD_M_PAG.FieldByName('id_empresa').AsString,
              FIN_CD_M_PAG.FieldByName('id_titulo').AsString,
              FIN_CD_M_PAG.FieldByName('id_abertura').AsString]));

      if not FIN_CD_M_CTA.IsEmpty then
         FIN_CD_M_CTA.delete;

      if not FIN_CD_M_PAG_PAG.IsEmpty then
         FIN_CD_M_PAG_PAG.delete;

      if not FIN_CD_M_PAG.IsEmpty then
         FIN_CD_M_PAG.delete;


      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      result := 'OK';

      try
        if FIN_CD_M_CTA <> nil then
           if FIN_CD_M_CTA.ChangeCount > 0 then
              if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                 begin
                   result := 'Erro ao tentar apagar a movimentao do caixa da pequena despesa.';
                 end;


        if FIN_CD_M_PAG_PAG <> nil then
           if FIN_CD_M_PAG_PAG.ChangeCount > 0 then
              if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
                 begin
                   result := 'Erro ao tentar apagar o registro de pagamento da pequena despesa.';
                 end;

        if FIN_CD_M_PAG <> nil then
           if FIN_CD_M_PAG.ChangeCount > 0 then
              if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                 begin
                   result := 'Erro ao tentar apagar este ttulo.';
                 end;

      except
         on e: exception do
            begin
               raise Exception.Create(result + #13 + e.Message);
            end;
      end;

      Conn.CommitFreeAndNil(Vtran);
  finally
     Conn.RollbackIncompleteFreeAndNil(Vtran);

     FreeAndNil(FIN_CD_M_CTA);
     FreeAndNil(FIN_CD_M_PAG_PAG);
     FreeAndNil(FIN_CD_M_PAG);
  end;
end;


function TSM.enAproReprPed(IdEmpresa, IdPedidos, TipoAcao, IdFuncionario, msgJustificativa: String): String;
var
  FAT_CD_M_PED,FAT_CD_M_PED_TIT: TClientDataSet;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
  Pedido: Array of integer;
  i: integer;
begin
  FAT_CD_M_PED := TClientDataSet.Create(self);
  FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
  FAT_CD_M_PED.Close;
  FAT_CD_M_PED.Data :=
      FAT_CD_M_PED.DataRequest(VarArrayOf([100,IdEmpresa,IdPedidos]));

  FAT_CD_M_PED_TIT := TClientDataSet.Create(nil);
  FAT_CD_M_PED_TIT.DataSetField := TDataSetField(FAT_CD_M_PED.FieldByName('FAT_SQ_M_PED_TIT'));

  SetLength(Pedido,FAT_CD_M_PED.RecordCount);

  try
      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      //for i := Low(Pedido) to High(pedido) do
      //    begin
            {FAT_CD_M_PED := TClientDataSet.Create(self);
            FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
            FAT_CD_M_PED.Close;
            FAT_CD_M_PED.Data :=
                FAT_CD_M_PED.DataRequest(VarArrayOf([0,IdEmpresa,Pedido[i]]));

            FAT_CD_M_PED_TIT := TClientDataSet.Create(nil);
            FAT_CD_M_PED_TIT.DataSetField := TDataSetField(FAT_CD_M_PED.FieldByName('FAT_SQ_M_PED_TIT'));}

            //showmessage(FAT_CD_M_PED.FieldByName('id_pedido').AsString);

            if TipoAcao = 'A' then
               begin
                 result := 'OK';
                 FAT_CD_M_PED.First;
                 while not FAT_CD_M_PED.eof do
                    begin
                       FAT_CD_M_PED.Edit;
                       FAT_CD_M_PED.FieldByName('SITUACAO_APROVACAO').AsInteger := 1;
                       if (pos('F',FAT_CD_M_PED.FieldByName('tipo_restricao').text) <> 0) then
                          begin
                            FAT_CD_M_PED_TIT.First;
                            while(not FAT_CD_M_PED_TIT.EOF) do
                                begin
                                  FAT_CD_M_PED_TIT.Edit;
                                  FAT_CD_M_PED_TIT.FieldByName('DTA_VENCIMENTO').AsDateTime :=
                                  FAT_CD_M_PED_TIT.FieldByName('DTA_VENCIMENTO').AsDateTime +
                                   (Date-FAT_CD_M_PED.FieldByName('DTA_PEDIDO').AsDateTime);

                                  FAT_CD_M_PED_TIT.Post;
                                  FAT_CD_M_PED_TIT.Next;
                                end;
                             FAT_CD_M_PED.FieldByName('DTA_PEDIDO').AsDateTime := date;
                         end;
                       FAT_CD_M_PED.FieldByName('ID_USUARIO_LIB').AsString := IdFuncionario;
                       FAT_CD_M_PED.FieldByName('DTA_LIBERACAO').AsDateTime := date;
                       FAT_CD_M_PED.FieldByName('JUSTIFICATIVA').AsString   := msgJustificativa;
                       FAT_CD_M_PED.Post;
                       if FAT_CD_M_PED.ApplyUpdates(0) <> 0 then
                          result := 'Erro ao tentar atualizar o pedido';
                       FAT_CD_M_PED.Next;
                    end;
               end;
            if TipoAcao = 'R' then
               begin
                 result := 'OK';
                 FAT_CD_M_PED.First;
                 while not FAT_CD_M_PED.eof do
                    begin
                       FAT_CD_M_PED.Edit;
                       FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 1;
                       FAT_CD_M_PED.FieldByName('SITUACAO_APROVACAO').AsInteger := 2;
                       FAT_CD_M_PED.FieldByName('ID_USUARIO_LIB').AsString  := IdFuncionario;
                       FAT_CD_M_PED.FieldByName('JUSTIFICATIVA').AsString   := msgJustificativa;
                       FAT_CD_M_PED.Post;
                       if FAT_CD_M_PED.ApplyUpdates(0) <> 0 then
                          result := 'Erro ao tentar atualizar o pedido';
                       FAT_CD_M_PED.Next;
                    end;
               end;
         // end;

      Conn.CommitFreeAndNil(Vtran);
  finally
    Conn.RollbackIncompleteFreeAndNil(Vtran);
    FreeAndNil(FAT_CD_M_PED);
  end;

end;

function TSM.enAtualMaqNfsTit(IdEmpresa,IdFiscal: Integer;
  Data: OleVariant): String;
var
  BUS_CD_M_NFE, BUS_CD_M_NFE_TIT_INT: TClientDataSet;
  FIN_CD_M_REC,cdsTemp: TClientDataSet;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin
  { TODO -oMaxsuel -cCriao : Mtodo criado em 03/09/2015; }
  result := 'OK';

  BUS_CD_M_NFE := TClientDataSet.Create(self);
  BUS_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
  BUS_CD_M_NFE.Close;
  BUS_CD_M_NFE.Data :=
      BUS_CD_M_NFE.DataRequest(VarArrayOf([0,IdEmpresa,'S',IdFiscal]));

  if not BUS_CD_M_NFE.IsEmpty then
     begin

        cdsTemp := TClientDataSet.Create(self);
        cdsTemp.Data := data;

        BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
        BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
        BUS_CD_M_NFE_TIT_INT.Close;
        BUS_CD_M_NFE_TIT_INT.Data :=
            BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([IdFiscal]));

        if not BUS_CD_M_NFE_TIT_INT.IsEmpty then
           begin
             cdsTemp.First;
             while not cdsTemp.Eof do
                begin
                  BUS_CD_M_NFE_TIT_INT.First;
                  while not BUS_CD_M_NFE_TIT_INT.Eof do
                     begin
                       if BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsInteger = cdsTemp.FieldByName('ID_FORMA_PAG').AsInteger then
                          begin
                            BUS_CD_M_NFE_TIT_INT.Edit;
                            BUS_CD_M_NFE_TIT_INT.FieldByName('ID_MAQUINETA').AsInteger :=
                                cdsTemp.FieldByName('ID_MAQUINETA').AsInteger;
                            BUS_CD_M_NFE_TIT_INT.Post;
                          end;
                       BUS_CD_M_NFE_TIT_INT.Next;
                     end;
                  cdsTemp.Next;
                end;
           end;
        if (BUS_CD_M_NFE.FieldByName('STATUS').AsInteger  = 1)  and   // Encerra
           (BUS_CD_M_NFE.FieldByName('prevenda').AsBoolean ) then    //  uma prevenda
            begin
              FIN_CD_M_REC := TClientDataSet.Create(self);
              FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
              FIN_CD_M_REC.Close;
              FIN_CD_M_REC.Data :=
                  FIN_CD_M_REC.DataRequest(VarArrayOf([94,IdFiscal]));
              begin
                cdsTemp.First;
                while not cdsTemp.Eof do
                   begin
                     while not FIN_CD_M_REC.eof  do
                        begin
                           if FIN_CD_M_REC.FieldByName('ID_FORMA_PAG').AsInteger = cdsTemp.FieldByName('ID_FORMA_PAG').AsInteger then
                              begin
                                FIN_CD_M_REC.Edit;
                                FIN_CD_M_REC.FieldByName('CAR_ID_MAQUINETA').AsInteger :=
                                    cdsTemp.FieldByName('ID_MAQUINETA').AsInteger;
                                FIN_CD_M_REC.Post;
                              end;
                           FIN_CD_M_REC.Next;
                        end;
                     cdsTemp.Next;
                   end;
              end;
            end;

        try
          Conn  := BuscarConnBanco;
          Vtran := Conn.BeginTransaction;

          if BUS_CD_M_NFE_TIT_INT <> nil then
             if BUS_CD_M_NFE_TIT_INT.ChangeCount > 0 then
                if not (BUS_CD_M_NFE_TIT_INT.ApplyUpdates(0) = 0) then
                   begin
                      result := 'Erro ao tentar atualizar os ttulos da nota fiscal.'+#13+
                          BUS_CD_M_NFE_TIT_INT.enErro;
                   end;

          if FIN_CD_M_REC <> nil then
             if FIN_CD_M_REC.ChangeCount > 0 then
                if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                   begin
                      result := 'Erro ao tentar atualizar os ttulos no financeiro desta nota fiscal.'+#13+
                          FIN_CD_M_REC.enErro;
                   end;


          Conn.CommitFreeAndNil(Vtran);
        finally
          Conn.RollbackIncompleteFreeAndNil(Vtran);

          BUS_CD_M_NFE.free;
          BUS_CD_M_NFE_TIT_INT.free;
          FIN_CD_M_REC.free;

        end;
     end;
end;

function TSM.enAtualPedF11(id_empresa,id_pedido: integer): Boolean;
var
  FAT_CD_M_PED: TClientDataSet;
begin

  // Maxsuel Victor , 16/03/2016
  // Esse cdigo no contempla quando  uma nota fiscal de uma Ordem de Fatuarmento PCP_TB_M_ORS
  // por isso esse cdigo abaixo existe tambm no OnUpdateData do PCP_DP_M_ORS.

  FAT_CD_M_PED := TClientDataSet.Create(self);
  FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
  FAT_CD_M_PED.Close;
  FAT_CD_M_PED.Data :=
     FAT_CD_M_PED.DataRequest(VarArrayOf([0,id_empresa, id_pedido]));
  if not FAT_CD_M_PED.IsEmpty then
     begin
       FAT_CD_M_PED.Edit;
       FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 3;
       FAT_CD_M_PED.Post;
     end;

   if FAT_CD_M_PED.ChangeCount > 0 then
      if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
         begin
            raise Exception.Create('Error ao tentar atualizar o pedido de venda');
         end;
end;

function TSM.enAtuDadosNF(id_fiscal, id_abertura, tipo_doc: String): String;
var
  BUS_CD_C_PAR_SER: TClientDataSet;
  BUS_CD_C_PAR_CTR: TClientDataSet;
  BUS_CD_C_PAR_NFE: TClientDataSet;
  FAT_CD_M_NFE: TClientDataSet;
  BUS_CD_M_NFE_TIT_INT: TClientDataSet;
  FAT_CD_M_PED, OFI_CD_M_ORV: TClientDataSet;
  FIN_CD_M_CXA: TClientDataSet;

  id_empresa,QtdeReg: String;
  NovoNumero,i: Integer;

  diff_dias:integer;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin

  { TODO -oMaxsuel -cCriao :
   Mtodo criado por Maxsuel Victor
   Tem a funo de atualizar alguns campo da tabela FAT_TB_M_NFE.
   Atualiza tambm a tabela CAD_TB_C_PAR_SER. }


  // tipo_doc
    // 1 - NFe
    // 2 - NFCe
    // 3 - NFSe

  RESULT := 'OK';


  FAT_CD_M_NFE     := TClientDataSet.Create(self);

  FAT_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
  FAT_CD_M_NFE.Close;
  FAT_CD_M_NFE.Data :=
      FAT_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));

  if not FAT_CD_M_NFE.IsEmpty then
     begin
       id_empresa := FAT_CD_M_NFE.FieldByName('ID_EMPRESA').AsString;

       FIN_CD_M_CXA  := TClientDataSet.Create(nil);
       FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
       FIN_CD_M_CXA.Close;
       FIN_CD_M_CXA.Data :=
       FIN_CD_M_CXA.DataRequest(VarArrayOf([0,id_abertura]));


       BUS_CD_C_PAR_NFE := TClientDataSet.Create(self);
       BUS_CD_C_PAR_NFE.SetProvider(BUS_DP_C_PAR_NFE);
       BUS_CD_C_PAR_NFE.Close;
       BUS_CD_C_PAR_NFE.Data :=
           BUS_CD_C_PAR_NFE.DataRequest(VarArrayOf([id_empresa]));


       BUS_CD_C_PAR_CTR := TClientDataSet.Create(self);
       BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
       BUS_CD_C_PAR_CTR.Close;
       BUS_CD_C_PAR_CTR.Data :=
           BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([id_empresa]));

       BUS_CD_C_PAR_SER := TClientDataSet.Create(self);
       BUS_CD_C_PAR_SER.SetProvider(BUS_DP_C_PAR_SER);
       if tipo_doc = '1' then // NFe
          begin
             if FAT_CD_M_NFE.FieldByName('TIPO_NF').text[1] in ['R','D'] then
                begin
                   if BUS_CD_C_PAR_NFE.FieldByName('NFE_SEQ_DEVOLUCAO').AsBoolean then
                      begin
                        BUS_CD_C_PAR_SER.Close;
                        BUS_CD_C_PAR_SER.Data :=
                            BUS_CD_C_PAR_SER.DataRequest(
                                VarArrayOf([id_empresa,'D']));
                      end
                   else
                      begin
                        BUS_CD_C_PAR_SER.Close;
                        BUS_CD_C_PAR_SER.Data :=
                            BUS_CD_C_PAR_SER.DataRequest(
                                VarArrayOf([id_empresa,'N']));
                      end;
                end
             else
                begin
                  BUS_CD_C_PAR_SER.Close;
                  BUS_CD_C_PAR_SER.Data :=
                      BUS_CD_C_PAR_SER.DataRequest(
                             VarArrayOf([id_empresa,'N']));
                end;
          end;

       if tipo_doc = '2' then // NFCe
          begin
             BUS_CD_C_PAR_SER.Close;
                  BUS_CD_C_PAR_SER.Data :=
                      BUS_CD_C_PAR_SER.DataRequest(
                             VarArrayOf([id_empresa,'C']));
          end;

       if tipo_doc = '3' then // NFSe
          begin
             BUS_CD_C_PAR_SER.Close;
                  BUS_CD_C_PAR_SER.Data :=
                      BUS_CD_C_PAR_SER.DataRequest(
                             VarArrayOf([id_empresa,'S']));
          end;


       if BUS_CD_C_PAR_SER.RecordCount = 0 then
          begin
            if tipo_doc = '1'  then
               Result := 'No foi encontrado a sequncia de numerao para a nota fiscal(NF-e).';

            if tipo_doc = '2'  then
               Result := 'No foi encontrado a sequncia de numerao para a nota fiscal(NFC-e).';

            if tipo_doc = '3'  then
               Result := 'No foi encontrado a sequncia de numerao para a nota fiscal(NFS-e).';

            exit;
          end;

       // Busca os ttulos da nota fiscal que est na tela do controle de caixa
       BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
       BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
       BUS_CD_M_NFE_TIT_INT.Close;
       BUS_CD_M_NFE_TIT_INT.Data :=
           BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([id_fiscal]));

       NovoNumero := BUS_CD_C_PAR_SER.FieldByName('NFE_NUMERO').AsInteger + 1;

       // Atualizando tabela de sequncia do nmero da nota fiscal
       BUS_CD_C_PAR_SER.Edit;
       BUS_CD_C_PAR_SER.FieldByName('NFE_NUMERO').AsInteger := NovoNumero;
       BUS_CD_C_PAR_SER.Post;
       // --------------------------------------------------------



       // Atualizando campos da nota fiscal a ser faturada
       FAT_CD_M_NFE.edit;

       FAT_CD_M_NFE.FieldByName('ID_ABERTURA').AsString := id_abertura;
       FAT_CD_M_NFE.FieldByName('NUMERO').AsInteger     := NovoNumero;
       {if trim(FAT_CD_M_NFE.FieldByName('SERIE').AsString) = '' then
          begin
            FAT_CD_M_NFE.FieldByName('SERIE').AsString :=
                BUS_CD_C_PAR_CTR.FieldByName('SERIE_NF').AsString;
          end;}
       if tipo_doc = '1'  then
          begin
             FAT_CD_M_NFE.FieldByName('MODELO').AsString     := '55';
             FAT_CD_M_NFE.FieldByName('NFE_ECF').AsInteger   := 0;
          end;
       if tipo_doc = '2'  then
          begin
            FAT_CD_M_NFE.FieldByName('MODELO').AsString      := '65';
            FAT_CD_M_NFE.FieldByName('NFE_ECF').AsInteger    := 2;
          end;

       if tipo_doc = '3'  then
          begin
            FAT_CD_M_NFE.FieldByName('MODELO').AsString      := ' ';
            FAT_CD_M_NFE.FieldByName('NFE_ECF').AsInteger    := 3;
          end;


       FAT_CD_M_NFE.FieldByName('NFE_TIPO_EMISSAO').AsString  :=
               BUS_CD_C_PAR_NFE.FieldByName('danf_tipo_emissao').AsString;
       FAT_CD_M_NFE.FieldByName('NFE_TIPO_AMBIENTE').AsString :=
               BUS_CD_C_PAR_NFE.FieldByName('situacao_emissor').AsString;


       diff_dias := DaysBetween(FAT_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime,FIN_CD_M_CXA.FieldByName('DTA_ABERTURA').AsDateTime);
       if not BUS_CD_M_NFE_TIT_INT.IsEmpty then
          begin
            i:= 0;
            QtdeReg := IntToStr(BUS_CD_M_NFE_TIT_INT.RecordCount);
            BUS_CD_M_NFE_TIT_INT.IndexFieldNames := 'DIAS';
            BUS_CD_M_NFE_TIT_INT.First;


            while not BUS_CD_M_NFE_TIT_INT.eof do
               begin
                 inc(i);
                 BUS_CD_M_NFE_TIT_INT.edit;
                 BUS_CD_M_NFE_TIT_INT.FieldByName('NUM_PARCELA').AsString :=
                         FAT_CD_M_NFE.FieldByName('NUMERO').AsString + '-' +
                         inttostr(i) + '/' + QtdeReg;
                 BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime :=
                    BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime + diff_dias;
                 BUS_CD_M_NFE_TIT_INT.Post;
                 BUS_CD_M_NFE_TIT_INT.Next;
               end;
          end;

       if FAT_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger > 0 then
          begin
            FAT_CD_M_PED := TClientDataSet.Create(self);
            FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
            FAT_CD_M_PED.Close;
            FAT_CD_M_PED.Data :=
               FAT_CD_M_PED.DataRequest(VarArrayOf([0,FAT_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,
                                                      FAT_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger]));
            if not FAT_CD_M_PED.IsEmpty then
               begin
                 FAT_CD_M_PED.Edit;
                 FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 3;
                 FAT_CD_M_PED.Post;
               end;
          end;

       if FAT_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger > 0 then
          begin
             OFI_CD_M_ORV := TClientDataSet.Create(self);
             OFI_CD_M_ORV.SetProvider(OFI_DP_M_ORV);
             OFI_CD_M_ORV.Close;
             OFI_CD_M_ORV.Data :=
                 OFI_CD_M_ORV.DataRequest(VarArrayOf([0,FAT_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger,
                                                        FAT_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,'1','']));
             if not OFI_CD_M_ORV.IsEmpty then
               begin
                 OFI_CD_M_ORV.Edit;
                 OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 3;
                 OFI_CD_M_ORV.Post;
               end;
          end;


       FAT_CD_M_NFE.Post;


       // --------------------------------------------------------

       try
          Conn  := BuscarConnBanco;
          Vtran := Conn.BeginTransaction;

          if FAT_CD_M_PED <> nil then
             if FAT_CD_M_PED.ChangeCount > 0 then
                if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
                   begin
                      result := 'Erro ao tentar atualizar a situao do pedido de venda da nota fiscal.'+#13+
                          FAT_CD_M_PED.enErro;
                   end;

           if OFI_CD_M_ORV <> nil then
             if OFI_CD_M_ORV.ChangeCount > 0 then
                if not (OFI_CD_M_ORV.ApplyUpdates(0) = 0) then
                   begin
                      result := 'Erro ao tentar atualizar o status da ordem de servio da nota fiscal.'+#13+
                          OFI_CD_M_ORV.enErro;
                   end;

          if not (BUS_CD_M_NFE_TIT_INT.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar o nmero da parcela dos ttulos da nota fiscal.'+#13+
                          BUS_CD_M_NFE_TIT_INT.enErro;
             end;


          if not (BUS_CD_M_NFE_TIT_INT.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar o nmero da parcela dos ttulos da nota fiscal.'+#13+
                          BUS_CD_M_NFE_TIT_INT.enErro;
             end;

          if not (BUS_CD_C_PAR_SER.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar tabela de sequncia de nmero de nota.'+#13+
                          BUS_CD_C_PAR_SER.enErro;
             end;

          if not (FAT_CD_M_NFE.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar o nmero da nota fiscal.'+#13+
                          FAT_CD_M_NFE.enErro;
             end;
          Conn.CommitFreeAndNil(Vtran);
       finally
          Conn.RollbackIncompleteFreeAndNil(Vtran);
          BUS_CD_C_PAR_SER.Free;
          BUS_CD_C_PAR_CTR.Free;
          BUS_CD_C_PAR_NFE.Free;
          FAT_CD_M_NFE.Free;
          FAT_CD_M_PED.Free;
          OFI_CD_M_ORV.Free;
          BUS_CD_M_NFE_TIT_INT.Free;
          FIN_CD_M_CXA.Free;
       end;
     end
  else
     begin
       Result := 'Nota fiscal no encontrada para a gerao da nmerao.';
     end;
end;

function TSM.enAtuPrcIte(IdFiscal,IdSeqItem, IdItem: String;
             fp_vlr_tot_custo_fix_mens,fp_vlr_ven_med_mens,
             fp_per_cust_ven_mens, fp_per_icms_ven,
             fp_per_simples, fp_per_comissao, fp_per_frete_ven,
             fp_per_cust_fin_ven, fp_per_lucro_ven, fp_per_total_incid,
             fp_per_markup_div, fp_per_markup_mult,fp_per_prc_prz_ven_prat, PrcIteCalc,
             PrcItePrat, PrcPrazoItePrat: Currency): String;
var
  CAD_CD_C_ITE: TClientDataSet;
  BUS_CD_M_NFE_ITE: TClientDataSet;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 13/04/2016
    Tem a funo de atualizar o preo do item partindo da tela de Formao de preo
    FAT_FM_M_FPR. }

  result := 'OK';




  BUS_CD_M_NFE_ITE := TClientDataSet.Create(self);
  BUS_CD_M_NFE_ITE.SetProvider(BUS_DP_M_NFE_ITE_INT);
  BUS_CD_M_NFE_ITE.Close;
      BUS_CD_M_NFE_ITE.Data :=
          BUS_CD_M_NFE_ITE.DataRequest(VarArrayOf([IdFiscal]));

  if not BUS_CD_M_NFE_ITE.IsEmpty then
     begin
       if BUS_CD_M_NFE_ITE.Locate('id_sequencia',IdSeqItem,[]) then
          begin
            BUS_CD_M_NFE_ITE.Edit;
            BUS_CD_M_NFE_ITE.FieldByName('fp_vlr_tot_custo_fix_mens').AsCurrency := fp_vlr_tot_custo_fix_mens;
            BUS_CD_M_NFE_ITE.FieldByName('fp_vlr_ven_med_mens').AsCurrency :=     fp_vlr_ven_med_mens;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_cust_ven_mens').AsCurrency :=    fp_per_cust_ven_mens;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_icms_ven').AsCurrency :=         fp_per_icms_ven;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_simples').AsCurrency :=          fp_per_simples;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_comissao').AsCurrency :=         fp_per_comissao;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_frete_ven').AsCurrency :=        fp_per_frete_ven;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_cust_fin_ven').AsCurrency :=     fp_per_cust_fin_ven;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_lucro_ven').AsCurrency :=        fp_per_lucro_ven;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_total_incid').AsCurrency :=      fp_per_total_incid;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_markup_div').AsCurrency :=       fp_per_markup_div;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_markup_mult').AsCurrency :=      fp_per_markup_mult;
            BUS_CD_M_NFE_ITE.FieldByName('fp_vlr_prc_ven_calc').AsCurrency :=     PrcIteCalc;
            BUS_CD_M_NFE_ITE.FieldByName('fp_vlr_prc_ven_prat').AsCurrency :=     PrcItePrat;
            BUS_CD_M_NFE_ITE.FieldByName('fp_per_prc_prz_ven_prat').AsCurrency := fp_per_prc_prz_ven_prat;
            BUS_CD_M_NFE_ITE.FieldByName('fp_vlr_prc_prz_ven_prat').AsCurrency := PrcPrazoItePrat;
            BUS_CD_M_NFE_ITE.FieldByName('fp_calculado').AsBoolean := true;
            BUS_CD_M_NFE_ITE.Post;


            CAD_CD_C_ITE := TClientDataSet.Create(self);
            CAD_CD_C_ITE.SetProvider(CAD_DP_C_ITE);
            CAD_CD_C_ITE.Close;
                CAD_CD_C_ITE.Data :=
                    CAD_CD_C_ITE.DataRequest(VarArrayOf([0,IdItem]));
            if not CAD_CD_C_ITE.IsEmpty then
               begin
                 CAD_CD_C_ITE.Edit;
                 CAD_CD_C_ITE.FieldByName('preco_avista_ant_reajuste').AsCurrency :=
                         CAD_CD_C_ITE.FieldByName('preco_avista').AsCurrency;
                 CAD_CD_C_ITE.FieldByName('preco_aprazo_ant_reajuste').AsCurrency :=
                         CAD_CD_C_ITE.FieldByName('preco_aprazo').AsCurrency;

                 CAD_CD_C_ITE.FieldByName('preco_avista').AsCurrency := PrcItePrat;
                 CAD_CD_C_ITE.FieldByName('preco_aprazo').AsCurrency := PrcPrazoItePrat;

                 CAD_CD_C_ITE.FieldByName('dta_ult_reajuste').AsDateTime := Date;

                 CAD_CD_C_ITE.Post;

               end;

          end;
     end;

  try
    Conn  := BuscarConnBanco;
    Vtran := Conn.BeginTransaction;

    if CAD_CD_C_ITE <> nil then
       if CAD_CD_C_ITE.ChangeCount > 0 then
          if not (CAD_CD_C_ITE.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar o preo no item.';
             end;

    if BUS_CD_M_NFE_ITE <> nil then
       if BUS_CD_M_NFE_ITE.ChangeCount > 0 then
          if not (BUS_CD_M_NFE_ITE.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar os dados da formao de preo no item da nota.';
             end;

    Conn.CommitFreeAndNil(Vtran);
  finally
      FreeAndNil(CAD_CD_C_ITE);
      FreeAndNil(BUS_CD_M_NFE_ITE);
      Conn.RollbackIncompleteFreeAndNil(Vtran);
  end;
end;

function TSM.enBuscaMenu(Perfil:Integer; Formulario:String; Acao:integer):boolean;
var xChave:string;
begin
{
0-Verifica se existe
1-Verifica se esta ativo e se chave  valida
}
  result:=false;
  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
    ' SELECT * FROM CAD_TB_C_PES_MOD PMO ' +
    ' WHERE PMO.ID_PERFIL_SEG = ''' + inttoStr(Perfil) +''' '+
    '   AND PMO.FORMULARIO  = ''' + Formulario + ''' ');
  qryBusca.Open;
  if acao=0 then
     begin
       if not qryBusca.IsEmpty then
          begin
            result := true;
          end;
     end;
  if acao=1 then
     begin
       if not qryBusca.IsEmpty then
          begin
            xChave:=enMD5(qryBusca.FieldByName('formulario').AsString+
                          qryBusca.FieldByName('modulo').AsString+'mof');
            //if (qryBusca.FieldByName('Ativo').AsBoolean=false) or
            //   (qryBusca.FieldByName('chave').AsString<>xChave) then
            if (qryBusca.FieldByName('Ativo').AsBoolean=true) then
               result := true;
          end;
     end;
  qryBusca.Close;
end;

function TSM.enBuscarEstatVendProdutor(tipo, vendedor, Ano, ParIni, ParFim: String; var QtdeVisitas, QtdePedidos,
  TotalDescPed, TotalPed, QtdeCliVisProg, QtdeCliExtVis: Currency; var CliVisitados, CliVisitadosExt, Pedidos: String): OleVariant;
var
  qry: TSqlQuery;
  sql: String;
  sqlCliVis,sqlCliVisExt: TSQLDataSet;
  dpCliVis,dpCliVisExt:  TDataSetProvider;
  cdsCliVis,cdsCliVisExt:  TClientDataSet;
begin

 { tipo = 0 -> Por perodo de datas
           1 -> Por perodo de semanas
  }

  try

  qry := TSqlQuery.Create(self);
  qry.SQLConnection := self.conexao;

  // selec qtde de visitas
  qry.Close;
  qry.SQL.Clear;

  sql :=
    '  select count(*) as qtde_visitas  from cad_tb_c_vit vit ' +
    '   left outer join cad_tb_c_vit_fot fot on (fot.id_visita     = vit.id_visita)       ' +
    '    left outer join cad_tb_c_vit_kmt kmt on (kmt.id_visita    = vit.id_visita)      ' +
    '    left outer join cad_tb_c_cli cli     on (cli.id_cliente   = vit.id_cliente)   ' +
    '    left outer join cad_tb_c_vei vei     on (vei.id_veiculo   = vit.id_veiculo)     ' +
    '    left outer join cad_tb_c_fun ven     on (ven.id_funcionario  = vit.id_vendedor) ';

  if tipo = '0' then
     begin
        sql := sql +
            '  where vit.tipo_mobile in (0,3) ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ' +
            '    and vit.id_vendedor =  '''+vendedor+''' ' ;;
     end;

  if tipo = '1' then
     begin
        sql := sql +
            '  where vit.tipo_mobile in (0,3) ' +
            '    and extract(year from vit.dta_visita) = '''+ ano+''' ' +
            '    and vit.semana >=  '''+ ParIni + '''  and vit.semana <=  '''+ParFim+''' ' +
            '    and vit.id_vendedor =  '''+vendedor+''' ' ;
     end;

  QtdeVisitas := 0;

  qry.SQL.Add(sql);
  qry.Open;
  if not qry.IsEmpty then
     begin
       QtdeVisitas := qry.FieldByName('qtde_visitas').AsInteger;
     end;


  // selec qtde de pedidos, totais
  qry.Close;
  qry.SQL.Clear;

  sql :=
        '  select sum(vlr_desconto) as total_desconto, sum(vlr_liquido) as total_liquido, count(*) as qtde_pedidos ' +
        '  from fat_tb_m_ped ped ' +
        '    left outer join cad_tb_c_cli cli on (ped.id_cliente = cli.id_cliente)          ' +
        '    left outer join cad_tb_c_fun ven on (ven.id_funcionario  = ped.id_responsavel) ';
   if tipo = '0' then
       begin
          sql := sql +
              '  where                                       ' +
              '        ped.id_pedido_mob > 0 ' +
              '    and ped.dta_pedido >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
              '    and ped.dta_pedido <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ' +
              '    and ped.id_vendedor =  '''+vendedor+''' ' ;;
       end;

    if tipo = '1' then
       begin
          sql := sql +
              '  where                                      ' +
              '        ped.id_pedido_mob > 0 ' +
              '    and extract(year from ped.dta_pedido) = '''+ ano+''' ' +
              '    and ped.semana >= '''+ ParIni + '''  and ped.semana <=  '''+ParFim+''' ' +
              '    and ped.id_vendedor = '''+vendedor+''' ' ;
       end;

  QtdePedidos  := 0;
  TotalDescPed := 0;
  TotalPed     := 0;

  qry.SQL.Add(sql);
  qry.Open;
  if not qry.IsEmpty then
     begin
       QtdePedidos  := qry.FieldByName('qtde_pedidos').AsCurrency;
       TotalDescPed := qry.FieldByName('total_desconto').AsCurrency;
       TotalPed     := qry.FieldByName('total_liquido').AsCurrency;
     end;


  // Pedidos

  qry.Close;
  qry.SQL.Clear;

  sql :=
        '  select ped.id_pedido  ' +
        '  from fat_tb_m_ped ped ' +
        '    left outer join cad_tb_c_cli cli on (ped.id_cliente = cli.id_cliente)          ' +
        '    left outer join cad_tb_c_fun ven on (ven.id_funcionario  = ped.id_responsavel) ';
   if tipo = '0' then
       begin
          sql := sql +
              '  where                                       ' +
              '        ped.id_pedido_mob > 0 ' +
              '    and ped.dta_pedido >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
              '    and ped.dta_pedido <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ' +
              '    and ped.id_vendedor =  '''+vendedor+''' ' ;;
       end;

    if tipo = '1' then
       begin
          sql := sql +
              '  where                                      ' +
              '        ped.id_pedido_mob > 0 ' +
              '    and extract(year from ped.dta_pedido) = '''+ ano+''' ' +
              '    and ped.semana >= '''+ ParIni + '''  and ped.semana <=  '''+ParFim+''' ' +
              '    and ped.id_vendedor = '''+vendedor+''' ' ;
       end;

  qry.SQL.Add(sql);

  Pedidos := '''0''';

  qry.Open;
  if not qry.IsEmpty then
     begin
        if not (qry.IsEmpty) then
           begin
             while not qry.eof do
                begin
                    if Pedidos <> '' then
                       begin
                        Pedidos :=
                        Pedidos + ',' +''''+ qry.FieldByName('id_pedido').AsString+'''';
                       end;
                    if Pedidos = '' then
                       begin
                         Pedidos :=
                         Pedidos +'''' + qry.FieldByName('id_pedido').AsString+'''';
                       end;
                    qry.Next;
                end;
           end;
     end;

  //---------------



  // Qtde de clietnes programados
  qry.Close;
  qry.SQL.Clear;

  sql :=
       ' select count(*) as qtde_cli_prog from pro_tb_m_vis_cli vcl ' +
       '   left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ';

  if tipo = '0' then
     begin
        sql := sql +
            '  where                                       ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ' +
            '    and vis.id_vendedor =  '''+vendedor+''' ' ;;
     end;

  if tipo = '1' then
     begin
        sql := sql +
            '  where                                      ' +
            '    extract(year from vcl.dta_visita) = '''+ ano+''' ' +
            '    and vis.semana >= '''+ ParIni + '''  and vis.semana <=  '''+ParFim+''' ' +
            '    and vis.id_vendedor = '''+vendedor+''' ' ;
     end;

  QtdeCliVisProg := 0;

  qry.SQL.Add(sql);
  qry.Open;
  if not qry.IsEmpty then
     begin
       QtdeCliVisProg  := qry.FieldByName('qtde_cli_prog').AsCurrency;
     end;

  // Qtde de clietnes visitados fora da programao
  qry.Close;
  qry.SQL.Clear;

  sql :=
        '  select count(*) as qtde_cli_extra from cad_tb_c_vit vit ' +
        '  where                                                   ' +
        '        vit.id_vendedor = '''+vendedor+ ''' ' +
        '    and tipo_mobile in (0,3) and  vit.id_cliente not in      ';

  if tipo = '0' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  '+
            '    and vis.id_vendedor = '''+vendedor+''')  ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  ' +
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ';
     end;

  if tipo = '1' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '  extract(year from vcl.dta_visita) = '''+ ano+''' ' +
            '    and vis.semana >= '''+ ParIni + '''  and vis.semana <=  '''+ParFim+''' ' +
            '    and vis.id_vendedor = '''+vendedor+''') ' +
            '    and vit.semana >= '''+ ParIni + '''  and vit.semana <=  '''+ParFim+''' ';
     end;

  QtdeCliExtVis := 0;

  qry.SQL.Add(sql);
  qry.Open;
  if not qry.IsEmpty then
     begin
       QtdeCliExtVis  := qry.FieldByName('qtde_cli_extra').AsCurrency;
     end;

  sqlCliVis    := TSQLDataSet.create(self);
  sqlCliVis.SQLConnection := self.Conexao;
  sqlCliVis.CommandType   := ctQuery;

  dpCliVis     := TDataSetProvider.create(self);
  dpCliVis.DataSet := sqlCliVis;

  cdsCliVis    := TClientDataSet.create(self);
  cdsCliVis.SetProvider(dpCliVis);


 { sql :=
    '  select cli.id_cliente, cli.nome  from cad_tb_c_vit vit ' +
    '   left outer join cad_tb_c_vit_fot fot on (fot.id_visita     = vit.id_visita)       ' +
    '    left outer join cad_tb_c_vit_kmt kmt on (kmt.id_visita    = vit.id_visita)      ' +
    '    left outer join cad_tb_c_cli cli     on (cli.id_cliente = vit.id_cliente)   ' +
    '    left outer join cad_tb_c_vei vei     on (vei.id_veiculo   = vit.id_veiculo)     ' +
    '    left outer join cad_tb_c_fun ven     on (ven.id_funcionario  = vit.id_vendedor) ';

  if tipo = '0' then
     begin
        sql := sql +
            '  where vit.tipo_mobile in (0,3)      ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ' +
            '    and vit.id_vendedor =  '''+vendedor+''' ' ;;
     end;

  if tipo = '1' then
     begin
        sql := sql +
            '  where vit.tipo_mobile in (0,3)      ' +
            '    and extract(year from vit.dta_visita) = '''+ ano+''' ' +
            '    and vit.semana >=  '''+ ParIni + '''  and vit.semana <=  '''+ParFim+''' ' +
            '    and vit.id_vendedor =  '''+vendedor+''' ' ;
     end; }

  sql :=
        '  select cli.id_cliente, cli.nome  from cad_tb_c_vit vit ' +
        '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) ' +
        '  where                                                   ' +
        '     vit.id_vendedor = '''+vendedor+'''  and tipo_mobile in (0,3) and  vit.id_cliente in  ';

  if tipo = '0' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  '+
            '    and vis.id_vendedor = '''+vendedor+''') ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ';

     end;

  if tipo = '1' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '  extract(year from vcl.dta_visita) = '''+ ano+''' ' +
            '    and vis.semana >= '''+ ParIni + '''  and vis.semana <=  '''+ParFim+''' ' +
            '    and vis.id_vendedor = '''+vendedor+''') ' +
            '    and vit.semana >= '''+ ParIni + '''  and vit.semana <=  '''+ParFim+''' ';
     end;


  sqlCliVis.commandText := sql;
  cdsCliVis.Open;

  CliVisitados := '''0''';

  if not (cdsCliVis.IsEmpty) then
     begin
       while not cdsCliVis.eof do
          begin
            if cdsCliVis.FieldByName('id_cliente').AsString <> '' then
               begin
                  if CliVisitados <> '' then
                     begin
                      CliVisitados :=
                      CliVisitados + ',' +''''+ cdsCliVis.FieldByName('id_cliente').AsString+'''';
                     end;
                  if CliVisitados = '' then
                     begin
                       CliVisitados :=
                       CliVisitados +'''' + cdsCliVis.FieldByName('id_cliente').AsString+'''';
                     end;
               end;
            cdsCliVis.Next;
          end;
     end;

  sql := '';

  sqlCliVisExt := TSQLDataSet.create(self);
  sqlCliVisExt.SQLConnection := self.Conexao;
  sqlCliVisExt.CommandType   := ctQuery;

  dpCliVisExt  := TDataSetProvider.create(self);
  dpCliVisExt.DataSet := sqlCliVisExt;

  cdsCliVisExt := TClientDataSet.create(self);
  cdsCliVisExt.SetProvider(dpCliVisExt);

  sql :=
        '  select cli.id_cliente, cli.nome  from cad_tb_c_vit vit ' +
        '    left outer join cad_tb_c_cli cli on (cli.id_cliente = vit.id_cliente) ' +
        '  where                                                   ' +
        '     vit.id_vendedor = '''+vendedor+'''  and tipo_mobile in (0,3) and  vit.id_cliente not in  ';

  if tipo = '0' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '        vcl.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vcl.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  '+
            '    and vis.id_vendedor = '''+vendedor+''') ' +
            '    and vit.dta_visita >= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParIni)) +'''  '+
            '    and vit.dta_visita <= ''' + FormatDateTime('dd/mm/yyyy', strToDate(ParFim)) +'''  ';

     end;

  if tipo = '1' then
     begin
        sql := sql +
            '          (                                                       ' +
            '  select vcl.id_cliente from pro_tb_m_vis_cli vcl               ' +
            '    left outer join pro_tb_m_vis vis on (vis.id_vis = vcl.id_vis) ' +
            '  where                                     ' +
            '  extract(year from vcl.dta_visita) = '''+ ano+''' ' +
            '    and vis.semana >= '''+ ParIni + '''  and vis.semana <=  '''+ParFim+''' ' +
            '    and vis.id_vendedor = '''+vendedor+''') ' +
            '    and vit.semana >= '''+ ParIni + '''  and vit.semana <=  '''+ParFim+''' ';
     end;
  sqlCliVisExt.commandText := sql;
  cdsCliVisExt.Open;

  CliVisitadosExt := '''0''';

  if not (cdsCliVisExt.IsEmpty) then
     begin
       while not cdsCliVisExt.eof do
          begin
            if cdsCliVisExt.FieldByName('id_cliente').AsString <> '' then
               begin
                  if CliVisitadosExt <> '' then
                     begin
                      CliVisitadosExt :=
                      CliVisitadosExt + ',' +''''+ cdsCliVisExt.FieldByName('id_cliente').AsString+'''';
                     end;
                  if CliVisitadosExt = '' then
                     begin
                       CliVisitadosExt :=
                       CliVisitadosExt +'''' + cdsCliVisExt.FieldByName('id_cliente').AsString+'''';
                     end;
               end;
            cdsCliVisExt.Next;
          end;
     end;

  cdsCliVis.Close;
  cdsCliVisExt.Close;

  finally
    FreeAndNil(dpCliVis);
    FreeAndNil(sqlCliVis);
    FreeAndNil(cdsCliVis);

    FreeAndNil(dpCliVisExt);
    FreeAndNil(sqlCliVisExt);
    FreeAndNil(cdsCliVisExt);

    FreeAndNil(qry);
  end;
end;




function TSM.enBusNovoSldlimCli(IdEmpresa,IdCliente,IdFormaPag: String; VlrLimiteCli:Currency): Currency;
var
  Conn: TSQLConnection;
begin

  Conn := BuscarConnBanco;
  result := CAD_RN_C_CAD.CadNovoSldLimCli(IdEmpresa,IdCliente,IdFormaPag,VlrLimiteCli,Conn);
end;

function TSM.enBusTotPagMed(IdEmpresa, PctTipMov: String): Currency;
var
  qry: TSQLQuery;
  sql: String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado por Maxsuel Victor, em 11/04/2016
    Tem a funo de buscar o total de despesas em aberto; }

  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:=self.conexao;

  qry.Close;
  qry.SQL.Clear;

  sql :=
          ' select                                 ' +
          '    ( sum(pag.vlr_parcela) /            ' +
          '                                        ' +
          '       (select count(*) from            ' +
          '	        	(select extract(month from pag.dta_vencimento) from fin_tb_m_pag pag   ' +
          '               left outer join cad_tb_c_pct pct on (pct.id_plano = pag.id_plano)  ' +
          '	        		where                                                                ' +
          '         			  	extract(year from pag.dta_vencimento) = 2016                   ';
                          if IdEmpresa <> '' then
                             begin
                               sql := sql + ' and PAG.ID_EMPRESA in (' + IdEmpresa + ') ';
                             end;

                          if PctTipMov <> '' then
                             begin
                               sql := sql + ' and pct.tipo_mov in (' + PctTipMov + ') ';
                             end;
  sql := sql +
          '       group by 1                                                         ' +
          '		   	order by 1)ttt )                                                   ' +
          '    )  as vlr_med_pag from fin_tb_m_pag pag ' +
          '          left outer join cad_tb_c_pct pct on (pct.id_plano = pag.id_plano)  ' +
          ' where                                ' +
          '    extract(year from pag.dta_vencimento) = 2016 ' ;

  if IdEmpresa <> '' then
     begin
       sql := sql + ' AND PAG.ID_EMPRESA in (' + IdEmpresa + ') ';
     end;

  if PctTipMov <> '' then
     begin
       sql := sql + ' AND pct.tipo_mov in (' + PctTipMov + ') ';
     end;
  qry.SQL.Add(sql);
  qry.Open;

  result := qry.FieldByName('vlr_med_pag').AsCurrency;

  qry.Close;
  qry.Destroy();
  //FreeAndNil(SM);
end;

function TSM.enBusTotVendMed(Ano,MesAtual,IdEmpresa: String): Currency;
var
  qry: TSQLQuery;
  sql: String;
begin

  { TODO -oMaxsuel -cCriao :
    Criado por Maxsuel Victor, em 11/04/2016
    Tem a funo de buscar a venda meida do item no ano}

  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:=self.conexao;


  qry.Close;
  qry.SQL.Clear;

  sql :=
          ' select                                 ' +
          '    ( sum(  (nfi.vlr_unitario * (nfi.qtde-nfi.qtde_devolvida)) - ' +
          '                              ( (nfi.vlr_desconto / nfi.qtde) * (nfi.qtde-nfi.qtde_devolvida) ) ' +
          '         )        /                      ' +
          '       (select count(*) from            ' +
          '	        	(select extract(month from nff.dta_emissao) from fat_tb_m_nfe_ite nti  ' +
          '                 left outer join fat_tb_m_nfe nff on (nff.id_fiscal = nti.id_fiscal) ' +
          '	        		where                                                                   ' +
          '         			  	extract(year  from nff.dta_emissao) = '  + Ano +
          '               and extract(month from nff.dta_emissao) <= ' + MesAtual;
                          if IdEmpresa <> '' then
                             begin
                               sql := sql + ' and nff.id_empresa in (' + IdEmpresa + ') ';
                             end;

  sql := sql +
          '       group by 1                                                         ' +
          '		   	order by 1)ttt )                                                   ' +
          '    )  as vlr_med_ite from fat_tb_m_nfe_ite nfi ' +
          ' left outer join fat_tb_m_nfe nfe on (nfe.id_fiscal = nfi.id_fiscal) ' +
          ' where                                      ' +
          '	  	extract(year from nfe.dta_emissao) =       ' + Ano     +
          '     and extract(month from nfe.dta_emissao) <= ' + MesAtual;
  if IdEmpresa <> '' then
     begin
       sql := sql + ' and nfe.id_empresa in (' + IdEmpresa + ') ';
     end;

  qry.SQL.Add(sql);
  qry.Open;

  result := qry.FieldByName('vlr_med_ite').AsCurrency;

  qry.Close;
  qry.Destroy();
  //FreeAndNil(SM);
end;

function TSM.enBxaTitRetBco(DataSet_Tit: TDataSet;id_empresa:Integer; IdTitulos, IdPlano: String;IdConta, IdResponsavel, IdFormaPag,IdCCusto,IdTipoFinanceiro: integer): String;
var
  FIN_CD_M_REC, FIN_CD_M_REC_PAG, FIN_CD_M_CTA, CAD_CD_C_FPG,
  CAD_CD_C_TIF, CAD_CD_C_CTC,BUS_CD_C_PAR_CTR : TClientDataSet;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
  IdBaixa: Integer;
begin
   { TODO -oMaxsuel -cCriao :
     Mtodo criado em 12/01/2015
     Tem a funo de fazer as baixas nos ttulos(boleto) dos clientes atravs
     do arquivo retorno do banco. }
    result  := '';


   FIN_CD_M_REC     :=TClientDataSet.Create(nil);
   FIN_CD_M_REC_PAG :=TClientDataSet.Create(nil);
   FIN_CD_M_CTA     :=TClientDataSet.Create(nil);
   CAD_CD_C_FPG     :=TClientDataSet.Create(nil);
   CAD_CD_C_TIF     :=TClientDataSet.Create(nil);
   CAD_CD_C_CTC     :=TClientDataSet.Create(nil);
   BUS_CD_C_PAR_CTR :=TClientDataSet.Create(nil);

   FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
   FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
   FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
   CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
   CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
   CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
   BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);



   BUS_CD_C_PAR_CTR.Close;
   BUS_CD_C_PAR_CTR.Data :=
       BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([id_empresa]));


   // Busca os boletos
   FIN_CD_M_REC.Close;
   FIN_CD_M_REC.Data :=
       FIN_CD_M_REC.DataRequest(VarArrayOf([91, IdTitulos]));

   CAD_CD_C_FPG.Close;
   CAD_CD_C_FPG.Data :=
       CAD_CD_C_FPG.DataRequest(VarArrayOf([0, IdFormaPag]));

   CAD_CD_C_CTC.Close;
   CAD_CD_C_CTC.Data :=
       CAD_CD_C_CTC.DataRequest(VarArrayOf([0, IdConta]));

   CAD_CD_C_TIF.Close;
   CAD_CD_C_TIF.Data :=
       CAD_CD_C_TIF.DataRequest(VarArrayOf([0, IdTipoFinanceiro]));

   FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
   FIN_CD_M_REC_PAG.Close;
   FIN_CD_M_REC_PAG.Data :=
         FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([2]));


   FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
   FIN_CD_M_CTA.Close;
   FIN_CD_M_CTA.Data :=
       FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));

   // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
   IdBaixa := self.enValorChave('FIN_TB_M_RBX');
   // Este while refere-se ao boletos baixado no banco da empresa
   DataSet_Tit.First;
   while not (DataSet_Tit.Eof)  do
     begin
       if FIN_CD_M_REC.Locate('ID_TITULO',DataSet_Tit.FieldByName('ID_TITULO').AsInteger,[]) then
          begin

             if FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency = 0 then
                begin
                  raise Exception.Create(#13 +'Baixa de boleto(s) interrompida!' + #13 +
                                         'O boleto de nosso nmero: ' +
                          DataSet_Tit.FieldByName('BOL_NOSSO_NUMERO').AsString + ', j foi baixado em outro momento.');
                end;

             if FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency < 0 then
                begin
                  raise Exception.Create(#13 +'Baixa de boleto(s) interrompida!' + #13 + 'O boleto de nosso nmero: ' +
                        DataSet_Tit.FieldByName('BOL_NOSSO_NUMERO').AsString +
                        ', j foi baixado em outro momento mas o valor do saldo precisa ser corrido pois est negativo.');
                end;

             // Cria o registro de pagamento de cada boleto
             FIN_CD_M_REC_PAG.Append;
             FIN_CD_M_REC_PAG.FieldByName('ID_TITULO').AsInteger       :=
                   DataSet_Tit.FieldByName('ID_TITULO').AsInteger;
             FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger        := IdBaixa;

             FIN_CD_M_REC_PAG.FieldByName('ID_ABERTURA').AsInteger     := 0;

             FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime  :=
                   DataSet_Tit.FieldByName('DATA').AsDateTime;

             FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency  :=
                   DataSet_Tit.FieldByName('VLR_PAGAMENTO').asCurrency;

             FIN_CD_M_REC_PAG.FieldByName('PER_JUROS').AsFloat         := 0;

             FIN_CD_M_REC_PAG.FieldByName('VLR_ACRESCIMO').AsCurrency      :=
                   DataSet_Tit.FieldByName('VLR_ACRESCIMO').AsCurrency;

             FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency      :=
                   DataSet_Tit.FieldByName('VLR_JUROS').AsCurrency;

             FIN_CD_M_REC_PAG.FieldByName('VLR_TARIFA').AsCurrency   :=
                   DataSet_Tit.FieldByName('VLR_TARIFA').AsCurrency;

             FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency   :=
                   DataSet_Tit.FieldByName('VLR_DESCONTO').AsCurrency;

             FIN_CD_M_REC_PAG.FieldByName('VLR_CRED_UTILIZADO').AsCurrency := 0;
             FIN_CD_M_REC_PAG.FieldByName('HISTORICO').AsString        :=
                      'Recebimento baixa automtica: '+ FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsString +', do cliente: ' +
                       DataSet_Tit.FieldByName('int_nomecli').AsString;

             FIN_CD_M_REC_PAG.FieldByName('bol_nome_arq_ret').AsString   :=
                   DataSet_Tit.FieldByName('bol_nome_arq_ret').AsString;



             FIN_CD_M_REC_PAG.FieldByName('ID_FORMA_PAG').AsInteger    :=
                   IdFormaPag;

             FIN_CD_M_REC_PAG.FieldByName('ID_PLANO').AsString         :=
                  IdPlano;

             if FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency>0 then
                    FIN_CD_M_REC_PAG.FieldByName('ID_PLANO_JUROS').AsString   :=
                         CAD_CD_C_FPG.FieldByName('pag_id_plano_juros').AsString;

             if FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency>0 then
                FIN_CD_M_REC_PAG.FieldByName('ID_PLANO_DESCONTO').AsString:=
                       CAD_CD_C_FPG.FieldByName('pag_id_plano_desconto').AsString;

             FIN_CD_M_REC_PAG.FieldByName('ID_RESPONSAVEL').AsInteger  := IdResponsavel;

             FIN_CD_M_REC_PAG.FieldByName('ID_CCUSTO').AsInteger       := IdCCusto;

             FIN_CD_M_REC_PAG.FieldByName('ORIGEM').AsInteger  := 3; // 3 - Baixa automtica de boleto (Rec);

             FIN_CD_M_REC_PAG.FieldByName('com_substituicao').AsBoolean := false;
             FIN_CD_M_REC_PAG.FieldByName('id_cbx').AsInteger := 0;

             FIN_CD_M_REC_PAG.Post;

             // Ir criar a movimentao no banco
             FIN_CD_M_CTA.Append;
             // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
             FIN_CD_M_CTA.FieldByName('id_controle').AsInteger       :=
                    self.enValorChave('FIN_TB_M_CTA');
                   //DmApoio.enBusValorChave('FIN_TB_M_CTA');
             FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger       := 0;
             FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger        := FIN_CD_M_REC.FieldByName('id_empresa').AsInteger;
             FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger   := CAD_CD_C_CTC.FieldByName('TIPO').AsInteger;   //0-caixa 1-banco

             if (BUS_CD_C_PAR_CTR.FieldByName('dta_pag_ret_banco').AsInteger = 0) then
               begin
                 FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime   := FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime;
                 FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime    := FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime;
               end
             else if (BUS_CD_C_PAR_CTR.FieldByName('dta_pag_ret_banco').AsInteger = 1) then
               begin
                 FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime  := DataSet_Tit.FieldByName('data_credito').AsDateTime;
                 FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime   := DataSet_Tit.FieldByName('data_credito').AsDateTime;
               end;

             FIN_CD_M_CTA.FieldByName('num_doc').AsInteger           := FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger;
             FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger           := CAD_CD_C_TIF.FieldByName('natureza').AsInteger;
             FIN_CD_M_CTA.FieldByName('historico').AsString          := FIN_CD_M_REC_PAG.FieldByName('HISTORICO').AsString;
             FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency   := FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').AsCurrency;
             FIN_CD_M_CTA.FieldByName('origem').AsInteger            := 11; // 11 - Baixa automtica de boletos (Rec);
             FIN_CD_M_CTA.FieldByName('id_conta').AsInteger          :=
                 IdConta;
             FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger:=
                 IdTipoFinanceiro;
             FIN_CD_M_CTA.FieldByName('id_plano').AsString           :=
                 IdPlano;
             FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger      := FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger;
             FIN_CD_M_CTA.FieldByName('id_cbx').AsInteger            := 0;

             FIN_CD_M_CTA.FieldByName('id_conciliacao').AsInteger    := 0;
             FIN_CD_M_CTA.FieldByName('dta_conciliacao').AsDateTime  := DataSet_Tit.FieldByName('data_credito').AsDateTime;
             FIN_CD_M_CTA.FieldByName('conciliado').Asboolean        := true;
             FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger     := DataSet_Tit.FieldByName('id_titulo').AsInteger;
             FIN_CD_M_CTA.Post;


             // r atualizar o saldo do ttulo.
             if not FIN_CD_M_REC.IsEmpty then
                begin
                   FIN_CD_M_REC.Edit;
                   FIN_CD_M_REC.FieldByName('VLR_SALDO_ANTERIOR').asCurrency :=
                         FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency;

                   FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency  :=
                       FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency
                            - ( (DataSet_Tit.FieldByName('VLR_PAGAMENTO').asCurrency +
                                 DataSet_Tit.FieldByName('VLR_DESCONTO').asCurrency) -

                                (DataSet_Tit.FieldByName('VLR_JUROS').asCurrency +
                                 DataSet_Tit.FieldByName('VLR_ACRESCIMO').asCurrency )
                              );


                   FIN_CD_M_REC.Post;
                end;
          end;
       DataSet_Tit.Next;
     end;


   try
      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao tentar atualizar o saldo do boleto do cliente.');
         end;

      if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao criar o registro de pagamento do boleto.');
         end;

      if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao criar o registro de movimento bancrio.');
         end;
      Conn.CommitFreeAndNil(Vtran);

      result := 'Boleto(s) baixado(s) com sucesso! ' + #13 +
                'Cdigo da baixa dos boletos: ' + IntToStr(IdBaixa);
   finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
      FreeAndNil(FIN_CD_M_REC);
      FreeAndNil(FIN_CD_M_REC_PAG);
      FreeAndNil(FIN_CD_M_CTA);
      FreeAndNil(CAD_CD_C_FPG);
      FreeAndNil(CAD_CD_C_TIF);
      FreeAndNil(CAD_CD_C_CTC);
      FreeAndNil(BUS_CD_C_PAR_CTR);
   end;
end;


function TSM.enCancBxaTitRetBco(DataSet_Tit: TDataSet; IdTitulos:String): String;
var
  FIN_CD_M_REC, FIN_CD_M_REC_PAG, FIN_CD_M_CTA : TClientDataSet;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin
   { TODO -oLuan -cCriao :
     Mtodo criado em 02/06/2017
     Tem a funo de fazer cancelamento das baixas nos ttulos(boleto) dos clientes atravs
     do arquivo retorno do banco. }
   result  := '';


   FIN_CD_M_REC     :=TClientDataSet.Create(nil);
   FIN_CD_M_REC_PAG :=TClientDataSet.Create(nil);
   FIN_CD_M_CTA     :=TClientDataSet.Create(nil);

   FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
   FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
   FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);


   // Busca os boletos
   FIN_CD_M_REC.Close;
   FIN_CD_M_REC.Data :=
       FIN_CD_M_REC.DataRequest(VarArrayOf([91, IdTitulos]));


   FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
   FIN_CD_M_REC_PAG.Close;
   FIN_CD_M_REC_PAG.Data :=
         FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([91,IdTitulos]));


   FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
   FIN_CD_M_CTA.Close;
   FIN_CD_M_CTA.Data :=
       FIN_CD_M_CTA.DataRequest(VarArrayOf([112,IdTitulos]));



   // Este while refere-se ao boletos baixado no banco da empresa
   DataSet_Tit.First;
   while not (DataSet_Tit.Eof)  do
     begin
       if FIN_CD_M_REC.Locate('ID_TITULO',DataSet_Tit.FieldByName('ID_TITULO').AsInteger,[]) then
          begin
             if FIN_CD_M_REC_PAG.Locate('ID_TITULO',DataSet_Tit.FieldByName('ID_TITULO').AsInteger,[]) then
                begin
                  FIN_CD_M_REC.Edit;

                  FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency  :=
                       FIN_CD_M_REC.FieldByName('VLR_SALDO').asCurrency
                            - (FIN_CD_M_REC.FieldByName('VLR_PARCELA').asCurrency -
                                       FIN_CD_M_REC.FieldByName('VLR_SALDO_ANTERIOR').asCurrency)

                            + ( (FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency +
                                 //FIN_CD_M_REC_PAG.FieldByName('VLR_TARIFA').asCurrency +
                                 FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').asCurrency) -

                                (FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').asCurrency +
                                 FIN_CD_M_REC_PAG.FieldByName('VLR_ACRESCIMO').asCurrency )
                              );
                  FIN_CD_M_REC.Post;
                  FIN_CD_M_REC_PAG.Delete;
                end
             else
                begin
                   raise Exception.Create('No foi encontrado o registro de pagamento ref. ttulo de N '+DataSet_Tit.FieldByName('ID_TITULO').AsString);
                end;

             if FIN_CD_M_CTA.Locate('ID_TITULO_REC',DataSet_Tit.FieldByName('ID_TITULO').AsInteger,[]) then
                begin
                   FIN_CD_M_CTA.Delete;
                end
             else
                begin
                   raise Exception.Create('No foi encontrado o registro de movimento bancrio ref. ttulo de N '+DataSet_Tit.FieldByName('ID_TITULO').AsString);
                end;
          end;
        DataSet_Tit.Next;
     end;


   try
      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao tentar atualizar o saldo do boleto do cliente.');
         end;

      if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao excluir o registro de pagamento do boleto.');
         end;

      if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
         begin
           raise Exception.Create('Erro ao excluir o registro de movimento bancrio.');
         end;
      Conn.CommitFreeAndNil(Vtran);

      result := 'Cancelado as baixas dos boletos com sucesso!';
   finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
      FreeAndNil(FIN_CD_M_REC);
      FreeAndNil(FIN_CD_M_REC_PAG);
      FreeAndNil(FIN_CD_M_CTA);

   end;
end;


function TSM.enCancelCupom(id_fiscal: integer; DataSet: TCustomClientDataSet;
  var CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_C_PAR_CTR,FAT_CD_M_NFE: TClientDataSet): String;
var
  BUS_CD_M_NFE_TIT_INT,FIN_CD_M_CXA: TClientDataSet;


  FIN_CD_M_REC, FIN_CD_M_REC_PAG,
  FIN_CD_M_RCR, FIN_CD_M_CTA, FIN_CD_M_CTA_RCR:TClientdataset;

  Vtran: TDBXTransaction;

  vlrSldAcres: Currency;
begin
   { TODO -oMaxsuel Victor -cCriao :
     Criado em 02/04/2015

     Este mtodo tem a funo de deixar a (cupom) cancelado e desfazer tudo o
     que foi feito no momento do faturamento. }


    vlrSldAcres := 0;

    // Canelamento do cupom fiscal
    FIN_CD_M_CXA     := TClientDataSet.Create(nil);
    FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
    FIN_CD_M_CXA.Close;
    FIN_CD_M_CXA.Data :=
        FIN_CD_M_CXA.DataRequest(VarArrayOf([0,FAT_CD_M_NFE.FieldByName('ID_ABERTURA').AsString]));

    if (FAT_CD_M_NFE.FieldByName('NUMERO').AsInteger > 0) and
       (FAT_CD_M_NFE.FieldByName('STATUS').AsInteger = 1) then  // Status = 1 encerrado
         begin
           BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
           BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
           BUS_CD_M_NFE_TIT_INT.Close;
           BUS_CD_M_NFE_TIT_INT.Data :=
             BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([id_fiscal]));

           vlrSldAcres :=  enVerSldLimAtu(0,DataSet,BUS_CD_M_NFE_TIT_INT,0);

           // Como o cupom foi cancelado ento o sistema dever atualizar o saldo limite do cliente para +;
           CAD_CD_C_CLI.Edit;

           if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                  enVerSldLimFpgAtu(0, DataSet, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);

           CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + vlrSldAcres;
           CAD_CD_C_CLI.Post;
         end;

    FAT_CD_M_NFE.FieldByName('NFE_COD_SIT').AsString       := '02';
    if (FAT_CD_M_NFE.FieldByName('NUMERO').AsInteger > 0) then
        FAT_CD_M_NFE.FieldByName('CANC_MOTIVO').AsString := 'Ref. ao cancelamento do cupom fiscal: ' +
                                                            FAT_CD_M_NFE.FieldByName('NUMERO').AsString
    else
        FAT_CD_M_NFE.FieldByName('CANC_MOTIVO').AsString := 'Ref. a cancelamento de cupom fiscal mas a NF no chegou a ser faturada.';
    FAT_CD_M_NFE.FieldByName('CANC_USUARIO').AsInteger     := FIN_CD_M_CXA.FieldByName('ID_FUNCIONARIO').AsInteger;
    FAT_CD_M_NFE.FieldByName('CANC_DATA').AsDateTime       := Date;

    FIN_CD_M_CXA.free;
end;

function TSM.enCancelNfe(id_fiscal: integer;CanStatus,CanProtocolo,ReabrePed,IdAbertura:String): String;
var
  CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_C_PAR_CTR, BUS_CD_M_NFE,BUS_CD_M_NFE_TIT_INT, FIN_CD_M_CXA,BUS_CD_M_NFE_INT: TClientDataSet;


  FIN_CD_M_REC, FIN_CD_M_REC_PAG,
  FIN_CD_M_PAG,
  FIN_CD_M_RCR, FIN_CD_M_CTA, FIN_CD_M_CTA_RCR,FIN_CD_M_PCR,
  FAT_CD_M_PED, OFI_CD_M_ORV, EST_CD_M_FES: TClientdataset;

  Vtran: TDBXTransaction;
  vlrSldAcres: Currency;
  Conn: TSQLConnection;
begin
   { TODO -oMaxsuel Victor -cCriao :
     Criado em 02/04/2015

     Este mtodo tem a funo de deixar a (nota fiscal(nfe)) cancelado e desfazer tudo o
     que foi feito no momento do faturamento. }

    // Cancelamento de uma Nfe
        CAD_CD_C_CLI_CRD := TClientDataSet.Create(self);
        BUS_CD_M_NFE := TClientDataSet.Create(self);
        BUS_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
        BUS_CD_M_NFE.Close;
        BUS_CD_M_NFE.Data :=
            BUS_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));

        BUS_CD_C_PAR_CTR := TClientDataSet.Create(self);
        BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
            BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsString]));

        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
            FIN_CD_M_CXA.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsString]));


        FIN_CD_M_CTA     := TClientDataSet.Create(nil);
        FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA.Data :=
            FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));


        BUS_CD_M_NFE.Edit;

        BUS_CD_M_NFE.FieldByName('NFE_COD_SIT').AsString        := '02';
        BUS_CD_M_NFE.FieldByName('nfe_canc_status').AsString    := CanStatus;
        BUS_CD_M_NFE.FieldByName('nfe_canc_protocolo').AsString := CanProtocolo;

        if (BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger > 0) then
            begin
              if BUS_CD_M_NFE.FieldByName('PREVENDA').AsBoolean then
                 begin
                   BUS_CD_M_NFE.FieldByName('CANC_MOTIVO').AsString := 'Ref. ao cancelamento de cupom fiscal: ' +
                                                                BUS_CD_M_NFE.FieldByName('NUMERO').AsString;
                 end
              else
                 begin
                   BUS_CD_M_NFE.FieldByName('CANC_MOTIVO').AsString := 'Ref. ao cancelamento da nota fiscal: ' +
                                                                BUS_CD_M_NFE.FieldByName('NUMERO').AsString;
                 end;
            end
        else
            BUS_CD_M_NFE.FieldByName('CANC_MOTIVO').AsString  := 'Ref. a cancelamento da nota fiscal(No faturada).';

        BUS_CD_M_NFE.FieldByName('CANC_USUARIO').AsInteger    := FIN_CD_M_CXA.FieldByName('ID_FUNCIONARIO').AsInteger;
        BUS_CD_M_NFE.FieldByName('CANC_DATA').AsDateTime      := Date;

        // Atualiza o saldo limite do cliente
        if ((BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'E') and
             (BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'D')) then
            begin

            if (BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger > 0) and
               (BUS_CD_M_NFE.FieldByName('STATUS').AsInteger = 1) then  // Status = 1 encerrado
                 begin
                   BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
                   BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
                   BUS_CD_M_NFE_TIT_INT.Close;
                   BUS_CD_M_NFE_TIT_INT.Data :=
                     BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([id_fiscal]));

                   vlrSldAcres :=  enVerSldLimAtu(0,BUS_CD_M_NFE,BUS_CD_M_NFE_TIT_INT,0);

                   // Busca o cliente da nota fiscal
                   CAD_CD_C_CLI := TClientDataSet.Create(self);
                   CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
                   CAD_CD_C_CLI.Close;
                   CAD_CD_C_CLI.Data :=
                        CAD_CD_C_CLI.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('id_emitente').AsString]));

                   CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

                   // Como a nota fiscal foi cancelada ento o sistema dever atualizar o saldo limite do cliente para +;
                   CAD_CD_C_CLI.Edit;


                   if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                        enVerSldLimFpgAtu(0, BUS_CD_M_NFE, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);

                   CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
                        CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency + vlrSldAcres;
                   CAD_CD_C_CLI.Post;
                 end;
          end;

        EST_CD_M_FES := TClientDataSet.Create(nil);

        if ((BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'E') and
            (BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'D')) then
          begin
            enDesfazerFat(BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger,BUS_CD_M_NFE,FIN_CD_M_CTA,FIN_CD_M_REC,
                                                                      FIN_CD_M_REC_PAG,FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,
                                                                      FAT_CD_M_PED, OFI_CD_M_ORV,EST_CD_M_FES,ReabrePed,IdAbertura);
          end;

        FIN_CD_M_PAG := TClientDataSet.Create(nil);
        FIN_CD_M_PCR := TClientDataSet.Create(nil);
         if ((BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString = 'E') or
            (BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString = 'D')) then
           begin

            FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
            FIN_CD_M_PAG.Close;
            FIN_CD_M_PAG.Data :=
                FIN_CD_M_PAG.DataRequest(VarArrayOf([90, BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger]));
            if not (FIN_CD_M_PAG.IsEmpty) then
               begin
                 while not (FIN_CD_M_PAG.Eof)  do
                    begin
                      FIN_CD_M_PAG.Delete;
                    end;
               end;


            FIN_CD_M_PCR.SetProvider(FIN_DP_M_PCR);
            FIN_CD_M_PCR.Close;
            FIN_CD_M_PCR.Data :=
            FIN_CD_M_PCR.DataRequest(VarArrayOf([92,BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger]));

             while (FIN_CD_M_PCR.RecordCount>0) do
                begin
                  FIN_CD_M_PCR.Delete;
                end;
          end;

        if ((BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'E') and
            (BUS_CD_M_NFE.FieldByName('TIPO_NF').AsString <> 'D')) then
          begin
            if (BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger > 0) and
               (BUS_CD_M_NFE.FieldByName('STATUS').AsInteger = 1) then  // Status = 1 encerrado
                 begin
                    if BUS_CD_M_NFE.FieldByName('dta_emissao').AsDateTime < Date then
                       begin
                         if trim(IdAbertura) <> '' then
                            enGerFinCxaBco(self,6,BUS_CD_M_NFE,BUS_CD_M_NFE_TIT_INT,FIN_CD_M_CTA,StrToInt(IdAbertura));
                       end;
                 end;
          end;
        // Maxsuel Victor
        // Essa linha de cdigo tem que ser aqui mesmo pois no mtodo acima "enDesfazerFat" precisa do valor do
        // ID_PEDIDO_VENDA

        if (ReabrePed = 'S') then
          begin

           BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger := 0;

           if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger >0 then
             begin
               BUS_CD_M_NFE_INT := TClientDataSet.Create(self);
               BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
               BUS_CD_M_NFE_INT.Close;
               BUS_CD_M_NFE_INT.Data :=
               BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger]));
               BUS_CD_M_NFE_INT.First;


               while not BUS_CD_M_NFE_INT.EOF do
                 begin
                   if  BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> id_fiscal then
                      begin
                         if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '02') or
                            (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '05') then
                            begin
                               BUS_CD_M_NFE_INT.Edit;
                               BUS_CD_M_NFE_INT.FieldByName('ID_ORDEM').AsInteger := 0;
                               BUS_CD_M_NFE_INT.Post;
                            end;

                         if (BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger = 0) and
                            (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger = 0) then
                            begin
                               BUS_CD_M_NFE_INT.Delete;
                            end;

                      end;

                   BUS_CD_M_NFE_INT.Next;
                 end;

               BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger := 0;
             end;
          end;


        result := 'OK';
      try
          try
            Conn  := BuscarConnBanco;
            Vtran := Conn.BeginTransaction;

            if CAD_CD_C_CLI <> nil then
               if CAD_CD_C_CLI.ChangeCount > 0 then
                  if not (CAD_CD_C_CLI.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar o saldo limite do cliente.'+#13+
                                  CAD_CD_C_CLI.enErro;
                       abort;
                     end;

            if FIN_CD_M_CTA <> nil then
               if FIN_CD_M_CTA.ChangeCount > 0 then
                  if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir a movimentao de caixa/banco.'+#13+
                                  FIN_CD_M_CTA.enErro;
                       abort;
                     end;

             if FIN_CD_M_PAG <> nil then
               if FIN_CD_M_PAG.ChangeCount > 0 then
                  if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir os pagamentos dos ttulos da nota fiscal de entrada.'+#13+
                                  FIN_CD_M_PAG.enErro;
                       abort;
                     end;

            if FIN_CD_M_REC_PAG <> nil then
               if FIN_CD_M_REC_PAG.ChangeCount > 0 then
                  if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir os pagamentos dos ttulos a vista da nota fiscal.'+#13+
                                  FIN_CD_M_REC_PAG.enErro;
                       abort;
                     end;

            if FIN_CD_M_REC <> nil then
               if FIN_CD_M_REC.ChangeCount > 0 then
                  if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir os ttulos da nota fiscal.'+#13+
                                  FIN_CD_M_REC.enErro;
                       abort;
                     end;

            if FIN_CD_M_CTA_RCR <> nil then
               if FIN_CD_M_CTA_RCR.ChangeCount > 0 then
                  if not (FIN_CD_M_CTA_RCR.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir a movimentao de caixa/banco da nota de crdito da nota fiscal.'+#13+
                                  FIN_CD_M_CTA_RCR.enErro;
                       abort;
                     end;

            if FIN_CD_M_RCR <> nil then
               if FIN_CD_M_RCR.ChangeCount > 0 then
                  if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir as notas de crdito da nota fiscal.'+#13+
                                  FIN_CD_M_RCR.enErro;
                       abort;
                     end;

           if FIN_CD_M_PCR <> nil then
               if FIN_CD_M_PCR.ChangeCount > 0 then
                  if not (FIN_CD_M_PCR.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir as notas de crdito da nota fiscal de devoluo do fornecedor.'+#13+
                                  FIN_CD_M_PCR.enErro;
                       abort;
                     end;


            if FAT_CD_M_PED <> nil then
               if FAT_CD_M_PED.ChangeCount > 0 then
                  if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar o pedido de venda.'+#13+
                                  FAT_CD_M_PED.enErro;
                       abort;
                     end;

            if OFI_CD_M_ORV <> nil then
               if OFI_CD_M_ORV.ChangeCount > 0 then
                  if not (OFI_CD_M_ORV.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar a ordem de servio.'+#13+
                                  OFI_CD_M_ORV.enErro;
                       abort;
                     end;

            if BUS_CD_M_NFE_INT <> nil then
               if BUS_CD_M_NFE_INT.ChangeCount > 0 then
                  if not (BUS_CD_M_NFE_INT.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar dados de outras notas fiscais.'+#13+
                                  BUS_CD_M_NFE_INT.enErro;
                       abort;
                     end;

            if not (BUS_CD_M_NFE.ApplyUpdates(0) = 0) then
               begin
                 result := 'Erro ao tentar atualizar dados da nota fiscal.'+#13+
                            BUS_CD_M_NFE.enErro;
                 abort;
               end;

            if EST_CD_M_FES <> nil then
               if EST_CD_M_FES.ChangeCount > 0 then
                  if not (EST_CD_M_FES.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar o custo mdio do item.'+#13+
                                  OFI_CD_M_ORV.enErro;
                       abort;
                     end;
            {Conn.CommitFreeAndNil(Vtran);
            except
               on e: exception do
                  begin
                    Conn.RollbackIncompleteFreeAndNil(Vtran);
                  end;
            end;}
         except
           on e: exception do
              begin
                 raise Exception.Create(result + #13 + e.Message);
              end;
         end;

         Conn.CommitFreeAndNil(Vtran);
      finally
          Conn.RollbackIncompleteFreeAndNil(Vtran);
          FIN_CD_M_CTA.Free;
          FIN_CD_M_REC_PAG.Free;
          FIN_CD_M_REC.Free;
          FIN_CD_M_CTA_RCR.Free;
          FIN_CD_M_RCR.Free;
          FIN_CD_M_PCR.Free;
          CAD_CD_C_CLI.Free;
          CAD_CD_C_CLI_CRD.Free;
          BUS_CD_M_NFE.Free;
          FAT_CD_M_PED.Free;
          OFI_CD_M_ORV.Free;
          EST_CD_M_FES.Free;
      end;
end;

function TSM.enChaveNItens(NomeSeq: String; QtdeItens: integer): Integer;
var
  qry:TSqlQuery;
  qryNova:TSqlQuery;
  xSeq:Integer;
begin
    { TODO -oMaxsuel -cCriao :
      Criado em 28/02/2016
      Mtodo tem a funo de atualizar a sequncia de itens j especificando um intervalo maior. }

  qry:=TSqlQuery.Create(nil);
  //SM := TSM.Create(nil);
  qry.SQLConnection:= self.conexao;

  //qry.SQLConnection := BuscarConnBanco;

  qryNova:=TSqlQuery.Create(nil);
  qryNova.SQLConnection:=self.conexao;

  xSeq:=0;
  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add('Select SEQUENCIA from CAD_TB_C_SEQ where ID_TABELA='''+NomeSeq+''' ');
  qry.Open;

  if not qry.IsEmpty then
     begin
       xSeq:=qry.FieldByName('Sequencia').AsInteger;
       result :=xSeq+1;
       xSeq   := xSeq + QtdeItens;
       qry.Close;
       qry.SQL.Clear;
       qry.SQL.Add('update CAD_TB_C_SEQ set SEQUENCIA='''+inttostr(xSeq)+''' ');
       qry.SQL.Add('where ID_TABELA='''+NomeSeq+''' ');
       qry.ExecSQL;
     end
   else
     begin
       qryNova.Close;
       qryNova.SQL.Clear;
       qryNova.SQL.Add('INSERT INTO CAD_TB_C_SEQ (ID_TABELA, SEQUENCIA) VALUES ('''+NomeSeq+''', '''+inttostr(QtdeItens)+''' ) ');
       qryNova.ExecSQL;
       result := 1;
     end;
  qry.Destroy();
  qryNova.Destroy();
  //FreeAndNil(SM);
end;



function TSM.enCorrigirEstoque(id_empresa, tipo_item: String): Boolean;
var
  qry:TSqlQuery;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin
  { TODO -oMaxsuel Victor -cCriao : Este mtodo tem a funo de corrigir o saldo do estoque }

  result := false;

  qry:=TSqlQuery.Create(self);
  qry.SQLConnection:=self.conexao;
  try
      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      // Zera o saldo dos itens na tabela EST_TB_M_FES
   {   qry.Close;
      qry.SQL.Clear;
      qry.SQL.Add(
              ' update est_tb_m_fes' + #13#10 +
              '  set                ' + #13#10 +
              '      qtde_entrada = 0, ' + #13#10 +
              '      saldo_fisico = 0,' + #13#10 +
              '      qtde_saida   = 0' + #13#10 +
              ' from (select ite.id_item from cad_tb_c_ite ite' + #13#10 +
              '        left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ');
              if tipo_item <> '' then
                 begin
                   qry.SQL.Add(' where gru.tipo_item = ''' + VarToStr(tipo_item) +''' ');
                 end;
              qry.SQL.Add(
              '     )  ggg' + #13#10 +
              ' where  est_tb_m_fes.id_item = ggg.id_item ');
      qry.ExecSQL;  }

      // Corrige o saldo dos itens na tabela EST_TB_M_FES
      qry.Close;
      qry.SQL.Clear;
      qry.SQL.Add(
                ' update est_tb_m_fes' + #13#10 +
                '  set' + #13#10 +
                '    qtde_entrada = ttt.entradas,                        ' + #13#10 +
                '    qtde_saida   = ttt.saidas,' + #13#10 +
                '    saldo_fisico = ttt.saldo_fisico ' + #13#10 +
                ' from ' + #13#10 +

                ' ( select ccc.*, ccc.entradas - ccc.saidas saldo_fisico from       ' + #13#10 +

                '     (select sss.id_empresa,sss.id_item,sss.id_cor,sss.id_tamanho,' + #13#10 +
                '              coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea ' + #13#10 +
                '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
                '                   where fea.id_empresa  = sss.id_empresa and' + #13#10 +
                '                         fea.id_item     = sss.id_item    and' + #13#10 +
                '                         fea.id_cor      = sss.id_cor     and' + #13#10 +
                '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
                '                         tme.tipo_movimento = 0      ' + #13#10 +
                '                        ),0) as entradas ,' + #13#10 +
                '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea ' + #13#10 +
                '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
                '                   where fea.id_empresa = sss.id_empresa and' + #13#10 +
                '                         fea.id_item    = sss.id_item    and' + #13#10 +
                '                         fea.id_cor     = sss.id_cor     and' + #13#10 +
                '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
                '                         tme.tipo_movimento = 1),0) as Saidas ' + #13#10 +

              {  '              (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea ' + #13#10 +
                '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
                '                   where fea.id_empresa  = sss.id_empresa and' + #13#10 +
                '                         fea.id_item     = sss.id_item    and' + #13#10 +
                '                         fea.id_cor      = sss.id_cor     and' + #13#10 +
                '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
                '                         tme.tipo_movimento = 0' + #13#10 +
                '                   group by id_empresa,id_item,id_cor      ' + #13#10 +
                '                        ),0) - ' + #13#10 +
                '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea ' + #13#10 +
                '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
                '                   where fea.id_empresa = sss.id_empresa and' + #13#10 +
                '                         fea.id_item    = sss.id_item    and' + #13#10 +
                '                         fea.id_cor     = sss.id_cor     and' + #13#10 +
                '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
                '                         tme.tipo_movimento = 1),0) ) as saldo_fisico' + #13#10 + }



                '      from est_tb_m_fes sss            ' + #13#10 +
                '          left outer join cad_tb_c_ite ite on (ite.id_item  = sss.id_item)                        '+
                '          left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                       '+
                '      where ite.ativo = true                                                                      ');

                if tipo_item <> '' then
                   begin
                     qry.SQL.Add(' and gru.tipo_item = ''' + VarToStr(tipo_item) +''' ');
                   end;
                qry.SQL.Add(
                '      group by 1,2,3,4' + #13#10 +
                '      order by sss.id_empresa,sss.id_item,sss.id_cor,sss.id_tamanho' + #13#10 +
                '      ) ccc ' + #13#10 +
                '  where (ccc.entradas - ccc.saidas) > 0 ) ttt ' +

                'where est_tb_m_fes.id_empresa    = ttt.id_empresa and' + #13#10 +
                '      est_tb_m_fes.id_item       = ttt.id_item and ' + #13#10 +
                '      est_tb_m_fes.id_cor        = ttt.id_cor and' + #13#10 +
                '      est_tb_m_fes.id_tamanho    = ttt.id_tamanho and' + #13#10 +
                '      est_tb_m_fes.saldo_fisico <> ttt.saldo_fisico;' );
      qry.ExecSQL;


      // Zera o saldo dos itens na tabela EST_TB_M_FES_ALM
     { qry.Close;
      qry.SQL.Clear;
      qry.SQL.Add(
              ' update est_tb_m_fes_alm ' + #13#10 +
              '  set                ' + #13#10 +
              '      qtde_entrada = 0, ' + #13#10 +
              '      saldo_fisico = 0,' + #13#10 +
              '      qtde_saida   = 0' + #13#10 +
              ' from (select ite.id_item from cad_tb_c_ite ite' + #13#10 +
              '        left outer join cad_tb_c_gru gru on gru.id_grupo = ite.id_grupo ');
              if tipo_item <> '' then
                 begin
                   qry.SQL.Add(' where gru.tipo_item = ''' + VarToStr(tipo_item) +''' ');
                 end;
              qry.SQL.Add(
              '     )  ggg' + #13#10 +
              ' where  est_tb_m_fes_alm.id_item = ggg.id_item ');
      qry.ExecSQL; }

      // Corrige o saldo na tabela EST_TB_M_FES_ALM
      qry.Close;
      qry.SQL.Clear;
      qry.SQL.Add(
            ' update est_tb_m_fes_alm' + #13#10 +
            '  set' + #13#10 +
            '    qtde_entrada = ttt.entradas,                          ' + #13#10 +
            '                                                                 ' + #13#10 +
            '    qtde_saida   = ttt.saidas,' + #13#10 +
            '    ' + #13#10 +
            '    saldo_fisico = ttt.saldo_fisico ' + #13#10 +
            ' from ' + #13#10 +

            '  (select ccc.*, ccc.entradas - ccc.saidas saldo_fisico from  ' +
            '     (select sss.id_empresa,sss.id_almoxarifado, sss.id_item,sss.id_cor,sss.id_tamanho,' + #13#10 +
            '              coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea ' + #13#10 +
            '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
            '                   where fea.id_empresa  = sss.id_empresa and' + #13#10 +
            '                         fea.id_almoxarifado  = sss.id_almoxarifado and' + #13#10 +
            '                         fea.id_item     = sss.id_item    and' + #13#10 +
            '                         fea.id_cor      = sss.id_cor     and' + #13#10 +
            '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
            '                         tme.tipo_movimento = 0' + #13#10 +
            '                        ),0) as entradas ,' + #13#10 +
            '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea ' + #13#10 +
            '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
            '                   where fea.id_empresa = sss.id_empresa and' + #13#10 +
            '                         fea.id_almoxarifado  = sss.id_almoxarifado and' + #13#10 +
            '                         fea.id_item    = sss.id_item    and' + #13#10 +
            '                         fea.id_cor     = sss.id_cor     and' + #13#10 +
            '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
            '                         tme.tipo_movimento = 1),0) as Saidas ' + #13#10 +
            {
            '              (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea ' + #13#10 +
            '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
            '                   where fea.id_empresa  = sss.id_empresa and' + #13#10 +
            '                         fea.id_almoxarifado  = sss.id_almoxarifado and' + #13#10 +
            '                         fea.id_item     = sss.id_item    and' + #13#10 +
            '                         fea.id_cor      = sss.id_cor     and' + #13#10 +
            '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
            '                         tme.tipo_movimento = 0' + #13#10 +
            '                   group by id_empresa,id_item,id_cor      ' + #13#10 +
            '                        ),0) - ' + #13#10 +
            '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea ' + #13#10 +
            '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)' + #13#10 +
            '                   where fea.id_empresa = sss.id_empresa and' + #13#10 +
            '                         fea.id_almoxarifado  = sss.id_almoxarifado and' + #13#10 +
            '                         fea.id_item    = sss.id_item    and' + #13#10 +
            '                         fea.id_cor     = sss.id_cor     and' + #13#10 +
            '                         fea.id_tamanho  = sss.id_tamanho and' + #13#10 +
            '                         tme.tipo_movimento = 1),0) ) as saldo_fisico' + #13#10 + }
            '      from est_tb_m_fes_alm sss            ' + #13#10 +
            '          left outer join cad_tb_c_ite ite on (ite.id_item  = sss.id_item)         '+
            '          left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)        '+
            '      where ite.ativo = true                                                       ');
            if tipo_item <> '' then
               begin
                 qry.SQL.Add(' and gru.tipo_item = ''' + VarToStr(tipo_item) +''' ');
               end;
            qry.SQL.Add(
            '      group by 1,2,3,4,5' + #13#10 +
            '      order by sss.id_empresa,sss.id_item,sss.id_cor,sss.id_tamanho' + #13#10 +
            '      ) ccc ' + #13#10 +
            '  where (ccc.entradas - ccc.saidas) > 0 ) ttt ' +
            ' where est_tb_m_fes_alm.id_empresa        = ttt.id_empresa and' + #13#10 +
            '      est_tb_m_fes_alm.id_almoxarifado   = ttt.id_almoxarifado and      ' + #13#10 +
            '      est_tb_m_fes_alm.id_item      = ttt.id_item and ' + #13#10 +
            '      est_tb_m_fes_alm.id_cor       = ttt.id_cor and' + #13#10 +
            '      est_tb_m_fes_alm.id_tamanho    = ttt.id_tamanho and' + #13#10 +
            '      est_tb_m_fes_alm.saldo_fisico <> ttt.saldo_fisico;' );
      qry.ExecSQL;


      result := true;
      Conn.CommitFreeAndNil(Vtran);

  finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
      qry.Destroy();
      Result := true;
  end;
end;

function TSM.enZerarContagem(id_empresa,tipo_item:String; usa_sgq,zera_lote:Boolean): Boolean;
var
  qry:TSqlQuery;
  qryNova:TSqlQuery;
  CodFeaIni:Integer;
  id_tme_ent,id_tme_saida:String;
  BUS_CD_C_PAR_CTR:TClientDataSet;

  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
  mm: variant;
begin
    { TODO -oLuan -cCriao :
      Criado em 19/11/2016
      Mtodo tem a funo de zerar o estoque dos itens. }
  Result := false;
  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:=self.conexao;

  qryNova:=TSqlQuery.Create(self);
  qryNova.SQLConnection:=self.conexao;

  //qry.SQLConnection := BuscarConnBanco;
  try
       Conn  := BuscarConnBanco;
       Vtran := Conn.BeginTransaction;

       BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
       BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
       BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
           BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([id_empresa]));


      id_tme_ent := BUS_CD_C_PAR_CTR.FieldByName('cte_tipo_estoque_ent').AsString;
      id_tme_saida := BUS_CD_C_PAR_CTR.FieldByName('cte_tipo_estoque_sai').AsString;



      qryNova.Close;
      qryNova.SQL.Clear;
      qryNova.SQL.Add('Select SEQUENCIA from CAD_TB_C_SEQ where ID_TABELA=''EST_TB_M_FEA''');
      qryNova.Open;

      CodFeaIni:=qryNova.FieldByName('Sequencia').AsInteger;
      CodFeaIni:=CodFeaIni+1;


      qry.Close;
      qry.SQL.Clear;
      qry.SQL.Add('SELECT setval(''_seq'','+IntToStr(CodFeaIni)+',false)');
      qry.Open;

      // Inserido o IF para por Maxsuel Victor, em 19/11/2018
      // Ir preparar o estoque de LOT para poder zerar
      if zera_lote then
         begin
            qry.Close;
            qry.SQL.Clear;
            qry.SQL.Add(
             ' insert into EST_TB_M_FEA (                                           '+
             ' ID_FEA, ID_EMPRESA,ID_ALMOXARIFADO,ID_ITEM, ID_COR , ID_TAMANHO,ID_SEQ_ITEM, DATA, '+
             ' ID_TIPO_MOV_ESTOQUE,DOCUMENTO,ID_CONTROLE,ID_PEDIDO,ID_MAL ,         '+
             ' ORIGEM , ID_FISCAL,  PER_DESCONTO , PER_FRETE, VLR_FRETE ,           '+
             ' VLR_DESCONTO , NUM_LOTE , QTDE , VLR_CUSTO ,                         '+
             ' VLR_BRUTO, VLR_MOVIMENTO)                                            '+
             ' SELECT  nextval(''_seq'') AS ROWNUM, lot.id_empresa,lot.id_almoxarifado, ' +
             '      lot.id_item, lot.id_cor,lot.id_tamanho,1,CURRENT_DATE, '+
             '      case                                                                                                  '+
             '         when lot.qtde_atual > 0  then '+id_tme_saida+'                                                 '+
             '         when lot.qtde_atual < 0  then '+id_tme_ent+'                                                   '+
             '      end as id_tipo_mov_estoque,                                                                           '+
             '      currval(''_seq''),0,0,0,4,0,0,0,0,0,lot.num_lote,                                                 '+
             '      case                                                                                                  '+
             '         when lot.qtde_atual < 0 then lot.qtde_atual * -1                                               '+
             '         when lot.qtde_atual > 0 then lot.qtde_atual                                                    '+
             '      end as saldo_fisico,                                                                                  '+
             '      fes.vlr_custo_medio,                                                                                  '+
             '      round(cast(lot.qtde_atual as numeric(18,4))*fes.vlr_custo_medio,4),                                   '+
             '      round(cast(lot.qtde_atual as numeric(18,4))*fes.vlr_custo_medio,4)  from est_tb_m_lot lot             '+
             '      left outer join est_tb_m_fes fes on (fes.id_empresa=lot.id_empresa and                                '+
             '                                           fes.id_item=lot.id_item and                                      '+
             '                                           fes.id_cor=lot.id_cor and                                        '+
             '                                           fes.id_tamanho=lot.id_tamanho)                                   '+
             '      left outer join est_tb_m_fes_alm fam on (fam.id_empresa=lot.id_empresa and                            '+
             '                                               fam.id_almoxarifado=lot.id_almoxarifado and                  '+
             '                                               fam.id_item=lot.id_item and                                  '+
             '                                               fam.id_cor=lot.id_cor and                                    '+
             '                                               fam.id_tamanho=lot.id_tamanho)                               '+
             '      where lot.qtde_atual <> 0 and lot.id_empresa = '''+id_empresa+''' ');
             //CMServerForm.mm.Lines.Add(qry.SQL.text);
             //abort;
             qry.ExecSQL;
         end;


       // Inserido por Maxsuel Victor, em 19/11/2018
       // Ir preparar o estoque de FES_ALM para poder zerar
       if usa_sgq then
          begin
             qry.Close;
             qry.SQL.Clear;
             qry.SQL.Add(
             ' insert into EST_TB_M_FEA (                                            '+

             ' ID_FEA, ID_EMPRESA ,ID_ALMOXARIFADO, ID_ITEM, ID_COR , ID_TAMANHO,ID_SEQ_ITEM, DATA,  '+
             ' ID_TIPO_MOV_ESTOQUE,DOCUMENTO,ID_CONTROLE,ID_PEDIDO,ID_MAL ,          '+
             ' ORIGEM , ID_FISCAL,  PER_DESCONTO , PER_FRETE, VLR_FRETE ,            '+
             ' VLR_DESCONTO , NUM_LOTE , QTDE , VLR_CUSTO ,                          '+
             ' VLR_BRUTO, VLR_MOVIMENTO)                                             '+

             ' SELECT  nextval(''_seq'') AS ROWNUM, fam.id_empresa,fam.id_almoxarifado,fam.id_item, fam.id_cor,fam.id_tamanho,1,CURRENT_DATE, '+
             '      case                                                                                                  '+
             '         when fam.saldo_fisico > 0  then '+id_tme_saida+'                                                 '+
             '         when fam.saldo_fisico < 0  then '+id_tme_ent+'                                                   '+
             '      end as id_tipo_mov_estoque,                                                                           '+
             '      currval(''_seq''),0,0,0,4,0,0,0,0,0,'''',                                                         '+
             '      case                                                                                                  '+
             '         when fam.saldo_fisico < 0 then fam.saldo_fisico * -1                                               '+
             '         when fam.saldo_fisico > 0 then fam.saldo_fisico                                                    '+
             '      end as saldo_fisico,                                                                                  '+
             '      fes.vlr_custo_medio,                                                                                  '+
             '      round(cast(fam.saldo_fisico as numeric(18,4))*fes.vlr_custo_medio,4),                                 '+
             '      round(cast(fam.saldo_fisico as numeric(18,4))*fes.vlr_custo_medio,4)  from est_tb_m_fes_alm fam       '+
             '      left outer join est_tb_m_fes fes on (fes.id_empresa=fam.id_empresa and                                '+
             '                                           fes.id_item=fam.id_item and                                      '+
             '                                           fes.id_cor=fam.id_cor and                                        '+
             '                                           fes.id_tamanho=fam.id_tamanho)                                   '+
             '      left outer join cad_tb_c_ite ite on (ite.id_item  = fam.id_item)                                       '+
             '      left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                                     '+
             '      WHERE NOT EXISTS (select * from est_tb_m_fea fea WHERE                                                '+
             '                             fea.id_fea>='''+IntToStr(CodFeaIni)+'''   and                                  '+
             '                             fea.id_almoxarifado=fam.id_almoxarifado and                                    '+
             '                             fea.id_item=fam.id_item and                                                    '+
             '                             fea.id_cor=fam.id_cor and                                                      '+
             '                             fea.id_tamanho=fam.id_tamanho  ) ' );

             if tipo_item <> '' then
                begin
                  qry.SQL.Add(' and gru.tipo_item in (''' + VarToStr(tipo_item) +''') ');
                end;

             qry.SQL.Add('      and fam.saldo_fisico <> 0 and fam.id_empresa = '''+id_empresa+''' ');

          //   qry.ExecSQL;
          end
       else
          begin
             // Inserido por Maxsuel Victor, em 19/11/2018
             // Ir preparar o estoque do FES para poder zerar

             qry.Close;
             qry.SQL.Clear;
             qry.SQL.Add(

             ' insert into EST_TB_M_FEA (                                               '+
             ' ID_FEA, ID_EMPRESA , ID_ITEM, ID_COR , ID_TAMANHO,ID_SEQ_ITEM, DATA,     '+
             ' ID_TIPO_MOV_ESTOQUE,DOCUMENTO,ID_CONTROLE,ID_PEDIDO,ID_MAL ,             '+
             ' ORIGEM , ID_FISCAL,  PER_DESCONTO , PER_FRETE, VLR_FRETE ,               '+
             ' VLR_DESCONTO , NUM_LOTE , QTDE , VLR_CUSTO ,                             '+
             ' VLR_BRUTO, VLR_MOVIMENTO)                                                '+

             ' SELECT  nextval(''_seq'') AS ROWNUM, fes.id_empresa,fes.id_item, fes.id_cor,fes.id_tamanho,1,CURRENT_DATE, '+
             '      case                                                                                                '+
             '         when fes.saldo_fisico > 0  then '+id_tme_saida+'                                                 '+
             '         when fes.saldo_fisico < 0  then '+id_tme_ent+'                                                  '+
             '      end as id_tipo_mov_estoque,                                                                         '+
             '      currval(''_seq''),0,0,0,4,0,0,0,0,0,'''',                                                         '+
             '      case                                                                                                '+
             '         when fes.saldo_fisico < 0 then fes.saldo_fisico * -1                                             '+
             '         when fes.saldo_fisico > 0 then fes.saldo_fisico                                                  '+
             '      end as saldo_fisico,                                                                                '+
             '      fes.vlr_custo_medio,                                                                                '+
             '      round(cast(fes.saldo_fisico as numeric(18,4))*fes.vlr_custo_medio,4),                               '+
             '      round(cast(fes.saldo_fisico as numeric(18,4))*fes.vlr_custo_medio,4)  from est_tb_m_fes fes         '+
             '      left outer join cad_tb_c_ite ite on (ite.id_item  = fes.id_item)                                    '+
             '      left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                                   '+
             '      WHERE NOT EXISTS (select * from est_tb_m_fea fea WHERE                                              '+
             '                             fea.id_fea>='''+IntToStr(CodFeaIni)+'''   and                                '+
             '                             fea.id_item=fes.id_item and                                                  '+
             '                             fea.id_cor=fes.id_cor and                                                    '+
             '                             fea.id_tamanho=fes.id_tamanho  )     ');
             if tipo_item <> '' then
                begin
                  qry.SQL.Add(' and gru.tipo_item in (''' + VarToStr(tipo_item) +''') ');
                end;

             qry.SQL.Add('      and fes.saldo_fisico <> 0 and fes.id_empresa = '''+id_empresa+''' ');

             qry.ExecSQL;
          end;

      // Inserido por Maxsuel Victor, em 19/11/2018
      // Ir zerar o estoque
       qry.Close;
       qry.SQL.Clear;
       qry.SQL.Add(

       ' update est_tb_m_fes                   '+
       ' set                                   '+
       '    qtde_entrada = ttt.entradas,          '+
       '    qtde_saida   = ttt.saidas,            '+
       '    saldo_fisico = ttt.saldo_fisico,      '+
       '    data_ult_movimento = CURRENT_DATE     '+
       ' from                                  '+
       ' ( select ccc.*, ccc.entradas - ccc.saidas saldo_fisico from       ' + #13#10 +
       '  (select sss.id_empresa,sss.id_item,sss.id_cor,sss.id_tamanho,  '+
       '           coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea   '+
       '                   left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
       '                   left outer join cad_tb_c_ite ite on (ite.id_item = fea.id_item)                         '+
       '                   left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                       '+
       '                where fea.id_empresa  = sss.id_empresa and                                                 '+
       '                      fea.id_item     = sss.id_item    and                                                 '+
       '                      fea.id_cor      = sss.id_cor     and                                                 '+
       '                      fea.id_tamanho  = sss.id_tamanho and                                                 ');
       if tipo_item <> '' then
          begin
            qry.SQL.Add('     gru.tipo_item in (''' + VarToStr(tipo_item) +''') and ');
          end;
       qry.SQL.Add('          tme.tipo_movimento = 0  and fea.id_empresa = '''+id_empresa+'''                      '+
       '                     ),0) as entradas ,                                                                    '+

       '           coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                   '+
       '                   left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
       '                   left outer join cad_tb_c_ite ite on (ite.id_item = fea.id_item)                         '+
       '                   left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                       '+
       '                where fea.id_empresa = sss.id_empresa and                                                  '+
       '                      fea.id_item    = sss.id_item    and                                                  '+
       '                      fea.id_cor     = sss.id_cor     and                                                  '+
       '                      fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and  ');
       if tipo_item <> '' then
          begin
            qry.SQL.Add('     gru.tipo_item in (''' + VarToStr(tipo_item) +''') and ');
          end;
       qry.SQL.Add('          tme.tipo_movimento = 1),0) as Saidas                                                '+

     {  '           (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea                 '+
       '                   left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
       '                   left outer join cad_tb_c_ite ite on (ite.id_item = fea.id_item)                         '+
       '                   left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                       '+
       '                where fea.id_empresa  = sss.id_empresa and                                                 '+
       '                      fea.id_item     = sss.id_item    and                                                 '+
       '                      fea.id_cor      = sss.id_cor     and                                                 '+
       '                      fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and  ');
       if tipo_item <> '' then
          begin
            qry.SQL.Add('     gru.tipo_item in (''' + VarToStr(tipo_item) +''') and ');
          end;
       qry.SQL.Add('          tme.tipo_movimento = 0                                                               '+
       '                     ),0) -                                                                                '+

       '           coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                   '+
       '                   left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque) '+
       '                   left outer join cad_tb_c_ite ite on (ite.id_item = fea.id_item)                         '+
       '                   left outer join cad_tb_c_gru gru on (gru.id_grupo = ite.id_grupo)                       '+
       '                where fea.id_empresa = sss.id_empresa and                                                  '+
       '                      fea.id_item    = sss.id_item    and                                                  '+
       '                      fea.id_cor     = sss.id_cor     and                                                  '+
       '                      fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and ');
       if tipo_item <> '' then
          begin
            qry.SQL.Add('     gru.tipo_item in (''' + VarToStr(tipo_item) +''') and ');
          end;
       qry.SQL.Add('          tme.tipo_movimento = 1),0) ) as saldo_fisico                                         '+
       }
       '   from est_tb_m_fes sss                                                                                   '+
       '         left outer join cad_tb_c_ite itt on (itt.id_item  = sss.id_item)  ' +
       '         left outer join cad_tb_c_gru ggg on (ggg.id_grupo = itt.id_grupo) ' +
       '     where sss.id_empresa = '''+id_empresa+'''                      ' +
       '           and itt.ativo = true                                     ');
       if tipo_item <> '' then
          begin
            qry.SQL.Add(' and ggg.tipo_item in (''' + VarToStr(tipo_item) +''')  ');
          end;
       qry.SQL.Add(
       '   group by 1,2,3,4                                                                                        '+
       '   order by sss.id_empresa,sss.id_item,sss.id_cor,sss.id_tamanho                                           '+
       '      ) ccc ' + #13#10 +
       '   ) ttt ' +

       ' where est_tb_m_fes.id_empresa = ttt.id_empresa and                                                        '+
       '   est_tb_m_fes.id_item    = ttt.id_item and                                                               '+
       '   est_tb_m_fes.id_cor    = ttt.id_cor and                                                                 '+
       '   est_tb_m_fes.id_tamanho    = ttt.id_tamanho and                                                         '+
       '   ttt.id_empresa = '''+id_empresa+''' ');
       qry.ExecSQL;

       // Inserido por Maxsuel Victor, em 19/11/2018
       // Ir zerar o estoque
       qry.Close;
       qry.SQL.Clear;
       qry.SQL.Add(
          ' update est_tb_m_fes_alm                 '+
          '    set                                  '+
          '       qtde_entrada = ttt.entradas,         '+
          '       qtde_saida   = ttt.saidas,           '+
          '       saldo_fisico = ttt.saldo_fisico      '+
          '    from                                 '+

          '  (select ccc.*, ccc.entradas - ccc.saidas saldo_fisico from  ' +
          '     (select sss.id_empresa,sss.id_almoxarifado,sss.id_item,sss.id_cor,sss.id_tamanho,                         '+
          '              coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea                   '+
          '                   left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
          '                   where fea.id_empresa  = sss.id_empresa and                                                  '+
          '                         fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
          '                         fea.id_item     = sss.id_item    and                                                  '+
          '                         fea.id_cor      = sss.id_cor     and                                                  '+
          '                         fea.id_tamanho  = sss.id_tamanho and                                                  '+
          '                         tme.tipo_movimento = 0  and fea.id_empresa = '''+id_empresa+'''                                      '+
          '                        ),0) as entradas ,                                                                     '+

          '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                    '+
          '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
          '                   where fea.id_empresa = sss.id_empresa and                                                   '+
          '                         fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
          '                         fea.id_item    = sss.id_item    and                                                   '+
          '                         fea.id_cor     = sss.id_cor     and                                                   '+
          '                         fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and                         '+
          '                         tme.tipo_movimento = 1),0) as Saidas                                                 '+

        {  '              (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea                  '+
          '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
          '                   where fea.id_empresa  = sss.id_empresa and                                                  '+
          '                         fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
          '                         fea.id_item     = sss.id_item    and                                                  '+
          '                         fea.id_cor      = sss.id_cor     and                                                  '+
          '                         fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and                         '+
          '                         tme.tipo_movimento = 0                                                                '+
          '                        ),0) -                                                                                 '+

          '              coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                    '+
          '                      left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
          '                   where fea.id_empresa = sss.id_empresa and                                                   '+
          '                         fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
          '                         fea.id_item    = sss.id_item    and                                                   '+
          '                         fea.id_cor     = sss.id_cor     and                                                   '+
          '                         fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and                         '+
          '                         tme.tipo_movimento = 1),0) ) as saldo_fisico                                          '+
          }
          '      from est_tb_m_fes_alm sss                                                                          '+
          '         left outer join cad_tb_c_ite itt on (itt.id_item  = sss.id_item)  ' +
          '         left outer join cad_tb_c_gru ggg on (ggg.id_grupo = itt.id_grupo) ' +
          '      where sss.id_empresa = '''+id_empresa+'''                                                 '+
          '           and itt.ativo = true                                     ');
          if tipo_item <> '' then
             begin
                qry.SQL.Add(' and ggg.tipo_item in (''' + VarToStr(tipo_item) +''')  ');
             end;
          qry.SQL.Add(
          '      group by 1,2,3,4,5                                                                                       '+
          '      order by sss.id_empresa,sss.id_almoxarifado,sss.id_item,sss.id_cor,sss.id_tamanho                        '+
          '      ) ccc ' + #13#10 +
          '  ) ttt ' +

          '    where est_tb_m_fes_alm.id_empresa = ttt.id_empresa and                                                     '+
          '      est_tb_m_fes_alm.id_almoxarifado    = ttt.id_almoxarifado and                                            '+
          '      est_tb_m_fes_alm.id_item    = ttt.id_item and                                                            '+
          '      est_tb_m_fes_alm.id_cor    = ttt.id_cor and                                                              '+
          '      est_tb_m_fes_alm.id_tamanho    = ttt.id_tamanho and                                                      '+
          '      ttt.id_empresa = '''+id_empresa+'''' );


       qry.ExecSQL;


      // Inserido o IF por Maxsuel Victor, em 19/11/2018
      // Ir zerar o estoque
      if zera_lote then
         begin
           qry.Close;
           qry.SQL.Clear;
           qry.SQL.Add(

               ' update est_tb_m_lot                         '+
               '   set                                       '+
               '      qtde_entrada = ttt.entradas,           '+
               '      qtde_saida   = ttt.saidas,             '+
               '      qtde_atual = ttt.saldo_fisico          '+
               '   from                                   '+
               '    (select sss.id_empresa,sss.id_almoxarifado,sss.num_lote,sss.id_item,sss.id_cor,sss.id_tamanho,            '+
               '             coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea                   '+
               '                     left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
               '                  where fea.id_empresa  = sss.id_empresa and                                                  '+
               '                        fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
               '                        fea.num_lote  = sss.num_lote and                                                      '+
               '                        fea.id_item     = sss.id_item    and                                                  '+
               '                        fea.id_cor      = sss.id_cor     and                                                  '+
               '                        fea.id_tamanho  = sss.id_tamanho and                                                  '+
               '                        tme.tipo_movimento = 0  and fea.id_empresa = '''+id_empresa+'''                       '+
               '                       ),0) as entradas ,                                                                     '+

               '             coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                    '+
               '                     left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
               '                  where fea.id_empresa = sss.id_empresa and                                                   '+
               '                        fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
               '                        fea.num_lote  = sss.num_lote and                                                      '+
               '                        fea.id_item    = sss.id_item    and                                                   '+
               '                        fea.id_cor     = sss.id_cor     and                                                   '+
               '                        fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and          '+
               '                        tme.tipo_movimento = 1),0) as Saidas,                                                 '+

               '             (coalesce( (select  coalesce(sum(qtde),0) as qtde_entrada from est_tb_m_fea fea                  '+
               '                    left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)   '+
               '                  where fea.id_empresa  = sss.id_empresa and                                                  '+
               '                        fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
               '                        fea.num_lote  = sss.num_lote and                                                      '+
               '                        fea.id_item     = sss.id_item    and                                                  '+
               '                        fea.id_cor      = sss.id_cor     and                                                  '+
               '                        fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and          '+
               '                        tme.tipo_movimento = 0                                                                '+
               '                       ),0) -                                                                                 '+

               '             coalesce( (select coalesce(sum(qtde),0) from est_tb_m_fea fea                                    '+
               '                     left outer join cad_tb_c_tme tme on (fea.id_tipo_mov_estoque = tme.id_tipo_mov_estoque)  '+
               '                  where fea.id_empresa = sss.id_empresa and                                                   '+
               '                        fea.id_almoxarifado  = sss.id_almoxarifado and                                        '+
               '                        fea.num_lote  = sss.num_lote and                                                      '+
               '                        fea.id_item    = sss.id_item    and                                                   '+
               '                        fea.id_cor     = sss.id_cor     and                                                   '+
               '                        fea.id_tamanho  = sss.id_tamanho and fea.id_empresa = '''+id_empresa+''' and          '+
               '                        tme.tipo_movimento = 1),0) ) as saldo_fisico                                          '+

               '     from est_tb_m_lot sss                                                                                    '+
               '         left outer join cad_tb_c_ite itt on (itt.id_item  = sss.id_item)  ' +
               '         left outer join cad_tb_c_gru ggg on (ggg.id_grupo = itt.id_grupo) ' +
               '       where sss.id_empresa = '''+id_empresa+'''     ' +
               '             and itt.ativo = true                                     ');

           if tipo_item <> '' then
              begin
                qry.SQL.Add(' and gru.tipo_item in (''' + VarToStr(tipo_item) +''')  ');
              end;
           qry.SQL.Add(

               '     group by 1,2,3,4,5,6                                                                                     '+
               '     order by sss.id_empresa,sss.id_almoxarifado,sss.num_lote,sss.id_item,sss.id_cor,sss.id_tamanho           '+
               '     ) ttt                                                                                                    '+

               '   where est_tb_m_lot.id_empresa = ttt.id_empresa and                                                         '+
               '     est_tb_m_lot.id_almoxarifado    = ttt.id_almoxarifado and                                                '+
               '     est_tb_m_lot.num_lote    = ttt.num_lote and                                                              '+
               '     est_tb_m_lot.id_item    = ttt.id_item and                                                                '+
               '     est_tb_m_lot.id_cor    = ttt.id_cor and                                                                  '+
               '     est_tb_m_lot.id_tamanho    = ttt.id_tamanho and                                                          '+

               '     ttt.id_empresa = '''+id_empresa+''' ');

           qry.ExecSQL;
         end;

       if usa_sgq then
          begin
             // caso a contagem acontea novamente ser preciso deixar o campo contagem com valor FALSE
             qry.Close;
             qry.SQL.Clear;
             qry.SQL.Add('update pcp_tb_m_etq set contagem = false where dta_saida is null and coalesce(contagem,true) and id_empresa = '''+id_empresa+''' ');
             qry.ExecSQL;
          end;


       qryNova.Close;
       qryNova.SQL.Clear;
       qryNova.SQL.Add('Select coalesce(max(ID_FEA),0) as ult_cod_fea from EST_TB_M_FEA where ID_FEA>='''+IntToStr(CodFeaIni)+''' ');
       qryNova.Open;

       if qryNova.FieldByName('ULT_COD_FEA').AsInteger >0 then
         begin
           qry.Close;
           qry.SQL.Clear;
           qry.SQL.Add('update CAD_TB_C_SEQ set SEQUENCIA='''+IntToStr(qryNova.FieldByName('ULT_COD_FEA').AsInteger)+''' ');
           qry.SQL.Add('where ID_TABELA=''EST_TB_M_FEA''');
           qry.ExecSQL;
         end;


      Conn.CommitFreeAndNil(Vtran);

   finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
      BUS_CD_C_PAR_CTR.Free;
      qry.Destroy();
      qryNova.Destroy();
      //FreeAndNil(SM);
      Result := true;
   end;



end;




function TSM.enExiTitulosBaixado(Empresa:string; ID:String; Rotina:string):boolean;
begin
  result:=false;
   if Rotina = 'PAG' then
      begin
        qryBusca.Close;
        qryBusca.SQL.Clear;
        qryBusca.SQL.Add (
          ' SELECT COUNT(*) AS QTDE FROM FIN_TB_M_PAG PAG ' +
          ' WHERE PAG.ID_EMPRESA = ''' + Empresa +''' '+
          '   AND PAG.ID_FISCAL  = ''' + ID + ''' '+
          '   AND ISNULL(PAG.VLR_PARCELA,0) <> ISNULL(PAG.VLR_SALDO,0) ' );
        qryBusca.Open;
        if not qryBusca.IsEmpty then
           begin
             if qryBusca.FieldByName('QTDE').AsInteger > 0 then
                begin
                  result := true;
                end;
           end;
        qryBusca.Close;
      end;
end;

function TSM.enFecharCaixa(aud_cod_empresa,aud_cod_funcionario,aud_programa:String;IdAbertura, Status: integer; ExisteCar: Boolean; IdTitulos: String; DataSetCar: TDataSet): String;
var
  FIN_CD_M_CXA, FIN_CD_M_REC: TClientDataSet;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin
  { TODO -oMaxsuel -cCriao :
  Criado em 08/07/2015;
  Este mtodo tem a funo de fazer o fechamento de caixa e
  gravar as informaes dos cartes de crdito se existir }


  // Verifica se as formas de pagamento da ECF est relacionada com o cadastro de tipo de ttulo do enLoja
  FIN_CD_M_CXA := TClientDataSet.Create(self);
  FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
  FIN_CD_M_CXA.Close;
  FIN_CD_M_CXA.Data :=
         FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

  FIN_CD_M_CXA.Edit;
  FIN_CD_M_CXA.FieldByName('STATUS').AsInteger           := 1;
  FIN_CD_M_CXA.FieldByName('DTA_FECHAMENTO').AsDateTime  := Date;  // Deve ser Date mesmo - Maxsuel;
  FIN_CD_M_CXA.FieldByName('HOR_FECHAMENTO').AsDateTime  := Time;  // Deve ser Time mesmo - Maxsuel;
  FIN_CD_M_CXA.Post;

  enAudRegistrarInfo(FIN_CD_M_CXA,aud_cod_empresa,aud_cod_funcionario,aud_programa);


  if ExisteCar then
     begin
        FIN_CD_M_REC := TClientDataSet.Create(self);
        FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
        FIN_CD_M_REC.Close;
        FIN_CD_M_REC.Data :=
               FIN_CD_M_REC.DataRequest(VarArrayOf([91,IdTitulos]));

        while not DataSetCar.eof do
           begin
             if FIN_CD_M_REC.Locate('ID_TITULO',DataSetCar.FieldByName('id_titulo').AsInteger,[]) then
                begin
                  FIN_CD_M_REC.Edit;
                  FIN_CD_M_REC.FieldByName('car_taxa_ope').AsFloat          := DataSetCar.FieldByName('car_taxa_ope').AsFloat;
                  FIN_CD_M_REC.FieldByName('car_n_lote').AsString           := DataSetCar.FieldByName('car_n_lote').AsString;
                  FIN_CD_M_REC.FieldByName('car_n_lote_id_resp').AsInteger  := DataSetCar.FieldByName('car_n_lote_id_resp').AsInteger;
                  FIN_CD_M_REC.FieldByName('car_n_lote_id_conta').AsInteger := DataSetCar.FieldByName('car_n_lote_id_conta').AsInteger;
                  FIN_CD_M_REC.Post;
                end;
             DataSetCar.next;
           end;
     end;

    result := 'OK';
    try
      Conn  := BuscarConnBanco;
      Vtran := Conn.BeginTransaction;

      if FIN_CD_M_CXA <> nil then
         if FIN_CD_M_CXA.ChangeCount > 0 then
            if not (FIN_CD_M_CXA.ApplyUpdates(0) = 0) then
               begin
                 result := 'Erro ao tentar fechar o caixa.'+#13+
                            FIN_CD_M_CXA.enErro;
               end;

      if FIN_CD_M_REC <> nil then
         if FIN_CD_M_REC.ChangeCount > 0 then
            if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
               begin
                 result := 'Erro ao tentar atualizar os cartes.'+#13+
                            FIN_CD_M_REC.enErro;
               end;

      Conn.CommitFreeAndNil(Vtran);
   finally
      FIN_CD_M_CXA.Free;
      FIN_CD_M_REC.Free;
      Conn.RollbackIncompleteFreeAndNil(Vtran);
   end;
end;

function TSM.enFinalizarCupomCxa(id_fiscal,NroCupom:integer; CupomCancelado: Boolean; ecf_prevenda, ecf_serial_impressora: String; DtaCaixa: TDateTime;
                                 ReabrePed:String ): String;
var
   CAD_CD_C_CLI,CAD_CD_C_CLI_CRD, BUS_CD_C_ITE, CdsNfeTitGrp, cdsCupom,cdsPreVenda,cdsCupomDetalhe,cdsPreVendaDetalhe, BUS_CD_C_ECF_FPG,
   BUS_CD_M_NFE, BUS_CD_M_NFE_TIT_INT, BUS_CD_C_PAR_CTR,BUS_CD_M_NFE_INT: TClientDataSet;

   BUS_CD_M_PED_TIT_INT: TClientDataSet;
   FAT_CD_M_PED,OFI_CD_M_ORV: TClientDataSet;


   FIN_CD_M_REC, FIN_CD_M_REC_PAG,
   FIN_CD_M_RCR, FIN_CD_M_CTA, FIN_CD_M_CTA_RCR:TClientdataset;

   FIN_CD_M_CXA,CAD_CD_C_FPG,CAD_CD_C_TIF:TClientdataset;


   EST_CD_M_FES: TClientDataSet;

   VenctosOrigem, QtdeReg: String;
   DtaVencto: String;
   xIdCreditos: String;
   Dias, i,j, qtde, id_pedido: Integer;
   valor_x, vlr_acumulado, vlrSldAcres,vlrSldRet: Currency;
   VenctosAlt: Boolean;
   Vtran: TDBXTransaction;
   existeFpgEcfNoCupom: Boolean;
   Conn: TSQLConnection;



  FormaPagAnt,xListaCodFormaPag,xListaVlrFormaPag:String;
  ListaCodFormaPag,ListaVlrFormaPag:TStringList;
  valor,valor_parcela,valor_restante:Currency;
  status:Integer;
  HouveAlt: Boolean;
 // QtdeReg: String;
begin

   { TODO -oMaxsuel -cCriao : Criado por Maxsuel Victor em 13/03/2015. }


   // Busca as formas de pagamento do cupom fiscal em questo
   // agrupando por cdigo de forma de pagemento da ECF
   cdsCupom := TClientDataSet.Create(self);
   cdsCupom.SetProvider(BUS_DP_BR_PREVENDA);
   cdsCupom.Close;
   cdsCupom.Data :=
      cdsCupom.DataRequest(VarArrayOf([ecf_prevenda]));


   cdsPreVenda := TClientDataSet.Create(self);
   cdsPreVenda.SetProvider(DP_BR_PREVENDA);
   cdsPreVenda.Close;
   cdsPreVenda.Data :=
      cdsPreVenda.DataRequest(VarArrayOf([1,ecf_prevenda]));

   cdsPreVendaDetalhe := TClientDataSet.Create(self);
   cdsPreVendaDetalhe.SetProvider(BUS_DP_BR_PREVENDA_DETALHE);
   cdsPreVendaDetalhe.Close;
   cdsPreVendaDetalhe.Data :=
      cdsPreVendaDetalhe.DataRequest(VarArrayOf([ecf_prevenda]));





   // Verifica se as formas de pagamento da ECF est relacionada com o cadastro de tipo de ttulo do enLoja
   BUS_CD_C_ECF_FPG := TClientDataSet.Create(self);
   BUS_CD_C_ECF_FPG.SetProvider(BUS_DP_C_ECF_FPG);
   BUS_CD_C_ECF_FPG.Close;
   BUS_CD_C_ECF_FPG.Data :=
         BUS_CD_C_ECF_FPG.DataRequest(VarArrayOf([0,ecf_serial_impressora]));

   // Busca as formas de pagamento da NF agrupando por cdigo de forma de pagemento da ECF
   CdsNfeTitGrp := TClientDataSet.Create(self);
   CdsNfeTitGrp.SetProvider(BUS_DP_M_NFE_TIT_GRP);
   CdsNfeTitGrp.Close;
   CdsNfeTitGrp.Data :=
          CdsNfeTitGrp.DataRequest(VarArrayOf([ecf_serial_impressora,id_fiscal]));

   // Busca os ttulos da nota fiscal.
   BUS_CD_M_NFE := TClientDataSet.Create(self);
   BUS_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
   BUS_CD_M_NFE.Close;
   BUS_CD_M_NFE.Data :=
      BUS_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));

   // Busca dados da empresa
   BUS_CD_C_PAR_CTR := TClientDataSet.Create(self);
   BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
   BUS_CD_C_PAR_CTR.Close;
   BUS_CD_C_PAR_CTR.Data :=
       BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger]));

   BUS_CD_M_NFE.edit;
   BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime     := DtaCaixa;
   BUS_CD_M_NFE.FieldByName('NFE_ECF').AsInteger          := 1; // 0 - NFE  1 - ECF
   BUS_CD_M_NFE.FieldByName('STATUS').AsInteger           := 1; // Encerrado
   BUS_CD_M_NFE.FieldByName('FATURADA').AsBoolean         := true;
   BUS_CD_M_NFE.FieldByName('NFE_TIPO_EMISSAO').AsString  := '';
   BUS_CD_M_NFE.FieldByName('NFE_TIPO_AMBIENTE').AsString := '';
   BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger           := NroCupom;
   BUS_CD_M_NFE.FieldByName('SERIE').AsString             := BUS_CD_C_PAR_CTR.FieldByName('serie_nf').AsString;

   // Busca o cliente da nota fiscal
   CAD_CD_C_CLI := TClientDataSet.Create(self);
   CAD_CD_C_CLI_CRD := TClientDataSet.Create(self);
   CAD_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
   CAD_CD_C_CLI.Close;
   CAD_CD_C_CLI.Data :=
   CAD_CD_C_CLI.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('id_emitente').AsString]));

   CAD_CD_C_CLI_CRD.DataSetField     := TDataSetField(CAD_CD_C_CLI.FieldByName('CAD_SQ_C_CLI_CRD'));

   vlrSldAcres := 0;
   vlrSldRet   := 0;

   if not CupomCancelado then
      begin
         // Busca os ttulos da nota fiscal.
         BUS_CD_M_NFE_TIT_INT := TClientDataSet.Create(self);
         BUS_CD_M_NFE_TIT_INT.SetProvider(BUS_DP_M_NFE_TIT_INT);
         BUS_CD_M_NFE_TIT_INT.Close;
         BUS_CD_M_NFE_TIT_INT.Data :=
            BUS_CD_M_NFE_TIT_INT.DataRequest(VarArrayOf([id_fiscal]));

         BUS_CD_M_NFE_TIT_INT.First;
         while not BUS_CD_M_NFE_TIT_INT.Eof do
             begin
               VenctosOrigem := VenctosOrigem +  BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').text    + ' - ' +
                                                 BUS_CD_M_NFE_TIT_INT.FieldByName('INT_NOMEFPG').text + ' - ' +
                                                 BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text  + ' - ' +
                                                 BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').text      + '; ' + #13;
               BUS_CD_M_NFE_TIT_INT.Next;
             end;
         BUS_CD_M_NFE_TIT_INT.first;

         valor_x    := 0;
         VenctosAlt := false;

         DtaVencto  := '';

         cdsCupom.First;
         while not cdsCupom.eof do
             begin
               if CdsNfeTitGrp.Locate('ID_FORMA_PAG_ECF',cdsCupom.FieldByName('COD_FORMA_PAG').text,[]) then
                  begin
                    if (CdsNfeTitGrp.FieldByName('VLR_TITULO').AsCurrency <>
                        cdsCupom.FieldByName('VALOR').AsCurrency) or

                       (CdsNfeTitGrp.FieldByName('QTDE_TITULO').AsInteger <>
                        cdsCupom.FieldByName('QTD_PARCELA').AsInteger) then
                       begin

                         BUS_CD_M_NFE_TIT_INT.Filtered        := true;
                         BUS_CD_M_NFE_TIT_INT.Filter          := ' ID_FORMA_PAG = ' + CdsNfeTitGrp.FieldByName('ID_FORMA_PAG').Text;
                         BUS_CD_M_NFE_TIT_INT.IndexFieldNames := 'DTA_VENCIMENTO';

                         // Pega o primeiro vencimento
                         DtaVencto                     := DateToStr(BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime);
                         Dias                          := BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger;


                         valor_x := cdsCupom.FieldByName('VALOR').AsCurrency / cdsCupom.FieldByName('QTD_PARCELA').AsInteger;
                         vlr_acumulado := 0;
                         i := 0;

                         // Apaga os vencimentos com o Tipo de Ttulo do filtro acima.
                         while not BUS_CD_M_NFE_TIT_INT.eof do
                            begin
                              BUS_CD_M_NFE_TIT_INT.delete;
                            end;

                         while not (i = cdsCupom.FieldByName('QTD_PARCELA').AsInteger) do
                             begin

                               VenctosAlt := true;
                               inc(i);

                               BUS_CD_M_NFE_TIT_INT.Insert;

                               BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FISCAL').AsInteger :=
                                       BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                               BUS_CD_M_NFE_TIT_INT.FieldByName('id_nfe_tit').AsInteger :=
                                      enValorChave('FAT_TB_M_NFE_TIT');

                               BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').text   := CdsNfeTitGrp.FieldByName('ID_FORMA_PAG').Text;



                               BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime :=
                                          strtodatetime(DtaVencto) + (30* (i-1));

                              { if i = 1 then
                                  BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text :=
                                          DtaVencto
                               else
                                  BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text :=
                                        DateToStr((BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime + (Dias * i)));}


                              // Comentado por Maxsuel Victor, 21/07/2016
                              // BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_EMISSAO').text    := BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').text;


                               BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger      := Dias+(30*(i-1));


                               {if i = 1 then
                                  BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger      := Dias
                               else
                                  BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger      := Dias * i; }


                               if i = cdsCupom.FieldByName('QTD_PARCELA').AsInteger then
                                 begin
                                   BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency :=
                                     cdsCupom.FieldByName('VALOR').AsCurrency - vlr_acumulado;
                                 end
                               else
                                 begin
                                    BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency := roundTo(valor_x,-2);
                                 end;

                               vlr_acumulado := vlr_acumulado + roundTo(valor_x,-2);


                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_BANCO').text     := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_AGENCIA').text   := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_CONTA').text     := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_NUMERO').text    := '0';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_EMITENTE').text  := '';

                               BUS_CD_M_NFE_TIT_INT.Post;
                             end;
                         BUS_CD_M_NFE_TIT_INT.Filtered  := false;
                       end
                  end
               else
                  begin
                    if BUS_CD_C_ECF_FPG.Locate('ID_FORMA_PAG_ECF',cdsCupom.FieldByName('COD_FORMA_PAG').text,[]) then
                       begin
                         valor_x := cdsCupom.FieldByName('VALOR').AsCurrency / cdsCupom.FieldByName('QTD_PARCELA').AsInteger;
                         vlr_acumulado := 0;
                         i := 0;

                         while not (i = cdsCupom.FieldByName('QTD_PARCELA').AsInteger) do
                            begin
                               VenctosAlt := true;
                               inc(i);

                               BUS_CD_M_NFE_TIT_INT.Insert;

                               BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FISCAL').AsInteger :=
                                       BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                               BUS_CD_M_NFE_TIT_INT.FieldByName('id_nfe_tit').AsInteger := enValorChave('FAT_TB_M_NFE_TIT');
                               BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').text    := BUS_CD_C_ECF_FPG.FieldByName('ID_FORMA_PAG').text;
                               if BUS_CD_C_ECF_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,3,4,6] then //Duplicata, Promissoria,Cartao,Boleto,Cheque
                                  begin
                                    BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text  :=
                                                DateToStr((BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime + (i*30)));
                                    BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger  := i * 30;
                                  end
                               else
                                  begin

                                    BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text :=
                                            DateToStr((BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime));
                                    BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').AsInteger      := 0;
                                  end;

                               if i = cdsCupom.FieldByName('QTD_PARCELA').AsInteger  then
                                 begin
                                   BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency :=
                                     cdsCupom.FieldByName('VALOR').AsCurrency - vlr_acumulado;
                                 end
                               else
                                 begin
                                    BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency := roundTo(valor_x,-2);
                                 end;
                               vlr_acumulado := vlr_acumulado + roundTo(valor_x,-2);

                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_BANCO').text     := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_AGENCIA').text   := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_CONTA').text     := '';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_NUMERO').text    := '0';
                               BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_EMITENTE').text  := '';

                               BUS_CD_M_NFE_TIT_INT.Post;
                            end;
                       end;
                  end;
               cdsCupom.Next;
             end;


        // Caso a nota fiscal tenha alguma forma de pagamento que no consta nos PAGAMENTOS do GERCONWIN o sistema ir deletar.
        CdsNfeTitGrp.First;
        while not CdsNfeTitGrp.eof do
           begin
             existeFpgEcfNoCupom := false;
             cdsCupom.First;
             while ((existeFpgEcfNoCupom = false)  and (not cdsCupom.eof)) do
               begin
                 if StrToInt(Trim(cdsCupom.FieldByName('COD_FORMA_PAG').AsString)) =
                      CdsNfeTitGrp.FieldByName('ID_FORMA_PAG_ECF').AsInteger then
                   begin
                      existeFpgEcfNoCupom := true;
                   end;
                 cdsCupom.Next;
               end;

             if existeFpgEcfNoCupom = false then
               begin
                  BUS_CD_M_NFE_TIT_INT.Filtered := true;
                  BUS_CD_M_NFE_TIT_INT.Filter   := ' ID_FORMA_PAG = ' + CdsNfeTitGrp.FieldByName('ID_FORMA_PAG').text;
                  while not BUS_CD_M_NFE_TIT_INT.eof do
                     begin
                       BUS_CD_M_NFE_TIT_INT.delete;
                     end;
                  BUS_CD_M_NFE_TIT_INT.Filtered := false;
               end;

             {if not cdsCupom.Locate('COD_FORMA_PAG','0'+CdsNfeTitGrp.FieldByName('ID_FORMA_PAG_ECF').text,[]) then
                begin
                  BUS_CD_M_NFE_TIT_INT.Filtered := true;
                  BUS_CD_M_NFE_TIT_INT.Filter   := ' ID_FORMA_PAG = ' + CdsNfeTitGrp.FieldByName('ID_FORMA_PAG').text;
                  while not BUS_CD_M_NFE_TIT_INT.eof do
                     begin
                       BUS_CD_M_NFE_TIT_INT.delete;
                     end;
                  BUS_CD_M_NFE_TIT_INT.Filtered := false;
                end;}
             CdsNfeTitGrp.Next;
           end;

        BUS_CD_M_NFE.FieldByName('VENCTOS_ORIGEM').text := '';

        id_pedido := 0;
        if VenctosAlt = true then
           begin
              id_pedido := BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger;
              if id_pedido > 0 then
                 begin

                   // Busca os ttulos do pedido de venda
                   BUS_CD_M_PED_TIT_INT := TClientDataSet.Create(self);
                   BUS_CD_M_PED_TIT_INT.SetProvider(BUS_DP_M_PED_TIT_INT);
                   BUS_CD_M_PED_TIT_INT.Close;
                   BUS_CD_M_PED_TIT_INT.Data :=
                          BUS_CD_M_PED_TIT_INT.DataRequest(VarArrayOf([id_pedido]));
                   while not BUS_CD_M_PED_TIT_INT.EOF do
                      begin
                        BUS_CD_M_PED_TIT_INT.delete;
                      end;
                 end;

                 {Esse codigo foi removida para dentro do if acima.Pois gerava erro
                  na finalizao do cupom com id_pedido=0.
                 while not BUS_CD_M_PED_TIT_INT.EOF do
                   begin
                     BUS_CD_M_PED_TIT_INT.delete;
                   end; }

              // Grava os vencimentos originais da NF.
              BUS_CD_M_NFE.FieldByName('VENCTOS_ORIGEM').text := VenctosOrigem;


              qtde := BUS_CD_M_NFE_TIT_INT.RecordCount;
              i:= 0;
              BUS_CD_M_NFE_TIT_INT.first;
              while not BUS_CD_M_NFE_TIT_INT.eof do
                 begin
                   inc(i);
                   BUS_CD_M_NFE_TIT_INT.edit;

                   { No precisa mais executar a linha abaixo, pois mais a frente o sistema ir atualizar
                     o NUM_PARCELA dos vencimentos da nota
                     BUS_CD_M_NFE_TIT_INT.FieldByName('NUM_PARCELA').AsString :=
                                         inttostr(NroCupom) +'-'+inttostr(i)+'/'+ inttostr(qtde);
                   }

                   if BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger > 0 then
                      begin
                        BUS_CD_M_PED_TIT_INT.Insert;
                        BUS_CD_M_PED_TIT_INT.FieldByName('ID_PEDIDO').AsInteger    :=  id_pedido;
                        BUS_CD_M_PED_TIT_INT.FieldByName('ID_TITULO').text         :=  BUS_CD_M_NFE_TIT_INT.FieldByName('id_nfe_tit').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('DIAS').text              :=  BUS_CD_M_NFE_TIT_INT.FieldByName('DIAS').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('DTA_VENCIMENTO').text    :=  BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('VLR_TITULO').AsCurrency  :=  BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;
                        BUS_CD_M_PED_TIT_INT.FieldByName('CHE_BANCO').text         :=  BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_BANCO').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('CHE_AGENCIA').text       :=  BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_AGENCIA').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('CHE_CONTA').Text         :=  BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_CONTA').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('CHE_NUMERO').text        :=  BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_NUMERO').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('CHE_EMITENTE').text      :=  BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_EMITENTE').text;
                        BUS_CD_M_PED_TIT_INT.FieldByName('ID_FORMA_PAG').AsInteger :=  BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsInteger;
                        BUS_CD_M_PED_TIT_INT.Post;
                      end;
                   BUS_CD_M_NFE_TIT_INT.Next;
                 end;
             { if id_pedido > 0 then
                 begin
                   BUS_CD_M_PED_TIT_INT.ApplyUpdates(0);
                 end;}
           end;
        BUS_CD_M_NFE_TIT_INT.First;

        // Como o cupom foi emitido com sucesso o sistema ir atualizar o saldo limite do cliente;
        vlrSldRet :=  enVerSldLimAtu(2,BUS_CD_M_NFE, BUS_CD_M_NFE_TIT_INT,0);
        CAD_CD_C_CLI.Edit;

        if (BUS_CD_C_PAR_CTR.FieldByName('limite_cred_fpg').AsBoolean=true) then
                  enVerSldLimFpgAtu(2, BUS_CD_M_NFE, BUS_CD_M_NFE_TIT_INT,CAD_CD_C_CLI_CRD,0);

        CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency :=
             CAD_CD_C_CLI.FieldByName('lim_saldo').AsCurrency - vlrSldRet;
        CAD_CD_C_CLI.Post;


         if not BUS_CD_M_NFE_TIT_INT.IsEmpty then
            begin
              i:= 0;
              BUS_CD_M_NFE_TIT_INT.IndexFieldNames := 'DTA_VENCIMENTO';
              BUS_CD_M_NFE_TIT_INT.First;

              QtdeReg := IntToStr(BUS_CD_M_NFE_TIT_INT.RecordCount);
              while not BUS_CD_M_NFE_TIT_INT.eof do
                 begin
                   inc(i);
                   BUS_CD_M_NFE_TIT_INT.edit;
                   BUS_CD_M_NFE_TIT_INT.FieldByName('NUM_PARCELA').AsString :=
                         BUS_CD_M_NFE.FieldByName('NUMERO').AsString + '-' +
                         inttostr(i) + '/' + QtdeReg;
                   BUS_CD_M_NFE_TIT_INT.Post;
                   BUS_CD_M_NFE_TIT_INT.Next;
                 end;
            end;
        // O Financeiro  gerado no evento OnUpdateData do FAT_DP_M_NFE.

        BUS_CD_C_ECF_FPG.close;
        CdsNfeTitGrp.Close;
        cdsCupom.Close;




        ///Alteracao do Financeiro

        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsString]));

        FIN_CD_M_REC := TClientDataSet.Create(nil);
        FIN_CD_M_REC.SetProvider(FIN_DP_M_REC);
        FIN_CD_M_REC.Close;
        FIN_CD_M_REC.Data :=
             FIN_CD_M_REC.DataRequest(VarArrayOf([94, BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsString]));

        if not (FIN_CD_M_REC.IsEmpty) then
           begin
             FIN_CD_M_REC.First;
             while not (FIN_CD_M_REC.Eof) do
               begin
                 FIN_CD_M_REC.Delete;
               end;
           end;


        FIN_CD_M_REC_PAG := TClientDataSet.Create(nil);
        FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
        FIN_CD_M_REC_PAG.Close;
        FIN_CD_M_REC_PAG.Data :=
            FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([3,BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsString]));
        if not (FIN_CD_M_REC_PAG.IsEmpty) then
           begin
             FIN_CD_M_REC_PAG.First;
             while not (FIN_CD_M_REC_PAG.Eof) do
                begin
                  FIN_CD_M_REC_PAG.Delete;
                end;
           end;

        FIN_CD_M_CTA := TClientDataSet.Create(nil);
        FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA.Close;
        FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([94,BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsString]));

        if not (FIN_CD_M_CTA.IsEmpty) then
           begin
             FIN_CD_M_CTA.First;
             while not (FIN_CD_M_CTA.Eof) do
               begin
                 FIN_CD_M_CTA.Delete;
               end;
           end;


        FIN_CD_M_RCR := TClientDataSet.Create(nil);
        FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
        FIN_CD_M_RCR.Close;
        FIN_CD_M_RCR.Data :=
            FIN_CD_M_RCR.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('id_fiscal').AsInteger]));


        xIdCreditos := '';

        FIN_CD_M_RCR.First;
        while not (FIN_CD_M_RCR.Eof)  do
            begin
              if xIdCreditos <> '' then
                 begin
                   xIdCreditos :=
                   xIdCreditos + ',' +''''+ FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
                 end;
              if xIdCreditos = '' then
                 begin
                   xIdCreditos :=
                   xIdCreditos +''''+FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
                 end;
              FIN_CD_M_RCR.Next;
            end;

        if not (FIN_CD_M_RCR.IsEmpty) then
           begin
             FIN_CD_M_RCR.First;
             while not (FIN_CD_M_RCR.Eof) do
                begin
                  FIN_CD_M_RCR.Delete;
                end;
           end;


        FIN_CD_M_CTA_RCR := TClientDataSet.Create(nil);
        FIN_CD_M_CTA_RCR.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA_RCR.Close;

        if trim(xIdCreditos) <> '' then
           begin
             FIN_CD_M_CTA_RCR.Data :=
                FIN_CD_M_CTA_RCR.DataRequest(VarArrayOf([95,xIdCreditos]));
             if not (FIN_CD_M_CTA_RCR.IsEmpty) then
                begin
                  FIN_CD_M_CTA_RCR.First;
                  while not (FIN_CD_M_CTA_RCR.Eof) do
                     begin
                       FIN_CD_M_CTA_RCR.Delete;
                     end;
                end;
           end
        else
           begin
             FIN_CD_M_CTA_RCR.Data :=
                FIN_CD_M_CTA_RCR.DataRequest(VarArrayOf([0,'']));
           end;

        FormaPagAnt := '';
        valor := 0;
        xListaCodFormaPag := '';
        xListaVlrFormaPag := '';
        BUS_CD_M_NFE_TIT_INT.IndexFieldNames := 'ID_FORMA_PAG';

        BUS_CD_M_NFE_TIT_INT.First;
        while not (BUS_CD_M_NFE_TIT_INT.Eof)  do
           begin
              if formaPagAnt <> BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsString then
               begin
                 if xListaCodFormaPag <> '' then
                  begin
                   if xListaVlrFormaPag <> '' then
                     begin
                      xListaVlrFormaPag := xListaVlrFormaPag +';'+ CurrToStr(valor);
                     end
                   else
                     begin
                      xListaVlrFormaPag := CurrToStr(valor);
                     end;
                  end;

                 if xListaCodFormaPag <> '' then
                   begin
                     xListaCodFormaPag := xListaCodFormaPag +';'+ BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsString;
                   end
                 else
                   begin
                    xListaCodFormaPag := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsString;
                   end;

                 formaPagAnt := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsString;
                 valor := 0;
               end;
              valor := valor + BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;



              CAD_CD_C_FPG :=TClientDataSet.Create(nil);
              CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
              CAD_CD_C_FPG.Data :=
              CAD_CD_C_FPG.DataRequest(VarArrayOf([0,BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsString]));

              if not (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [0,7]) then //0 - Nenhum  7 - Crdito
                begin
                  FIN_CD_M_REC.Insert;
                  FIN_CD_M_REC.FieldByName('id_empresa').AsInteger      := BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger;
                  FIN_CD_M_REC.FieldByName('ID_TITULO').AsInteger       := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsInteger;
                  FIN_CD_M_REC.FieldByName('id_fiscal').AsInteger       := BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                  FIN_CD_M_REC.FieldByName('id_plano').AsString         := CAD_CD_C_FPG.FieldByName('VEN_ID_PLANO').AsString;
                  FIN_CD_M_REC.FieldByName('id_cliente').AsInteger      := BUS_CD_M_NFE.FieldByName('ID_EMITENTE').AsInteger;
                  FIN_CD_M_REC.FieldByName('num_parcela').AsString      := BUS_CD_M_NFE_TIT_INT.FieldByName('NUM_PARCELA').AsString;
                  FIN_CD_M_REC.FieldByName('dta_emissao').AsDateTime    := BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime;
                  FIN_CD_M_REC.FieldByName('vlr_original').AsCurrency   := BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;
                  FIN_CD_M_REC.FieldByName('dta_vencimento').AsDateTime := BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime;
                  FIN_CD_M_REC.FieldByName('dta_original').AsDateTime   := BUS_CD_M_NFE_TIT_INT.FieldByName('DTA_VENCIMENTO').AsDateTime;
                  FIN_CD_M_REC.FieldByName('vlr_parcela').AsCurrency    := BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;
                  FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency      := BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;

                  if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
                     (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
                    FIN_CD_M_REC.FieldByName('vlr_saldo').AsCurrency  := 0;

                  if trim(BUS_CD_M_NFE_TIT_INT.FieldByName('HISTORICO_PAG').AsString) <> '' then
                    FIN_CD_M_REC.FieldByName('historico').AsString     := trim(BUS_CD_M_NFE_TIT_INT.FieldByName('HISTORICO_PAG').AsString)
                  else
                    FIN_CD_M_REC.FieldByName('historico').AsString     := 'Gerado pela NF: ' + BUS_CD_M_NFE.FieldByName('NUMERO').AsString;

                  // Origem
                     // 0 - Manual
                     // 1 - Baixa do contas a receber
                     // 2 - Nota Fiscal de Sada
                  FIN_CD_M_REC.FieldByName('origem').AsInteger          := 2;
                  FIN_CD_M_REC.FieldByName('id_forma_pag').AsInteger    := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsInteger;
                  FIN_CD_M_REC.FieldByName('id_local_titulo').AsString  := CAD_CD_C_FPG.FieldByName('id_local_titulo').AsString;
                  // Tipo lanamento
                     // 0 - Manual
                     // 1 - Automtica
                  FIN_CD_M_REC.FieldByName('tipo_lancamento').AsInteger := 1;
                  FIN_CD_M_REC.FieldByName('che_banco').AsString        := BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_BANCO').AsString;
                  FIN_CD_M_REC.FieldByName('che_agencia').AsString      := BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_AGENCIA').AsString;
                  FIN_CD_M_REC.FieldByName('che_conta').AsInteger       := BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_CONTA').AsInteger;
                  FIN_CD_M_REC.FieldByName('che_cheque').AsInteger      := BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_NUMERO').AsInteger;
                  FIN_CD_M_REC.FieldByName('che_emitente').AsString     := BUS_CD_M_NFE_TIT_INT.FieldByName('CHE_EMITENTE').AsString;
                  FIN_CD_M_REC.FieldByName('id_vendedor').AsInteger     := BUS_CD_M_NFE.FieldByName('id_vendedor').AsInteger;;

                  if (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [6]) then // 6 - Cheque
                     FIN_CD_M_REC.FieldByName('situacao_chq').AsInteger  :=   1;


                  if trim(BUS_CD_M_NFE_TIT_INT.FieldByName('id_maquineta').AsString) <> '' then
                      begin
                        FIN_CD_M_REC.FieldByName('car_id_maquineta').AsInteger :=
                                     BUS_CD_M_NFE_TIT_INT.FieldByName('id_maquineta').AsInteger;
                      end;


                  FIN_CD_M_REC.Post;
                end;

              if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
                 (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
                  begin
                    FIN_CD_M_REC_PAG.Insert;
                    FIN_CD_M_REC_PAG.FieldByName('ID_TITULO').AsInteger      :=
                       BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsInteger;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger       :=
                            self.enValorChave('FIN_TB_M_RBX');
                       //DmApoio.enBusValorChave('FIN_TB_M_RBX');
                    FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime :=
                       FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                    FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency :=
                       BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;
                    FIN_CD_M_REC_PAG.FieldByName('PER_JUROS').AsFloat        := 0;
                    FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency     := 0;
                    FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency  := 0;
                    FIN_CD_M_REC_PAG.FieldByName('HISTORICO').AsString       :=
                       'Ref. ao Tt: ' + BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsString +
                           ', da NF de sada: ' + BUS_CD_M_NFE.FieldByName('NUMERO').AsString;

                    FIN_CD_M_REC_PAG.FieldByName('ID_FORMA_PAG').AsInteger   :=
                       BUS_CD_M_NFE_TIT_INT.FieldByName('ID_FORMA_PAG').AsInteger;
                    FIN_CD_M_REC_PAG.FieldByName('ID_PLANO').AsString        :=
                       CAD_CD_C_FPG.FieldByName('VEN_ID_PLANO').AsString;

                    FIN_CD_M_REC_PAG.FieldByName('ID_RESPONSAVEL').AsInteger :=
                        FIN_CD_M_CXA.FieldByName('id_funcionario').AsInteger;

                    FIN_CD_M_REC_PAG.FieldByName('ID_CCUSTO').AsInteger      :=
                       CAD_CD_C_FPG.FieldByName('ID_CCUSTO').AsInteger;

                    FIN_CD_M_REC_PAG.FieldByName('ID_FISCAL').AsInteger      := BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                    FIN_CD_M_REC_PAG.FieldByName('ID_ABERTURA').AsInteger    := BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger;
                    FIN_CD_M_REC_PAG.FieldByName('ORIGEM').AsInteger         := 1;

                    FIN_CD_M_REC_PAG.Post;
                 end;


              if (not (CAD_CD_C_FPG.FieldByName('doc_impresso').AsInteger in [0,7])) and
                      (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean) then
                 begin
                   FIN_CD_M_CTA.Insert;
                   // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                   FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=
                           self.enValorChave('FIN_TB_M_CTA');
                           //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                   FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger;
                   FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := BUS_CD_M_NFE.FieldByName('id_empresa').AsInteger;
                   FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                   FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := BUS_CD_M_NFE.FieldByName('dta_emissao').AsDateTime;
                   FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := BUS_CD_M_NFE.FieldByName('dta_emissao').AsDateTime;
                   FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := BUS_CD_M_NFE_TIT_INT.FieldByName('id_nfe_tit').AsInteger;
                   FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' + IntToStr(BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsInteger) + ', da NF de sada: ' +
                                                                               BUS_CD_M_NFE.FieldByName('NUMERO').AsString;
                   FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := BUS_CD_M_NFE_TIT_INT.FieldByName('VLR_TITULO').AsCurrency;
                   FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 5; // 5-Nota Fiscal de Sada
                   FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                   FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := CAD_CD_C_FPG.FieldByName('id_tipo_financeiro').AsInteger;
                   FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_FPG.FieldByName('INT_NATUREZATIF').AsInteger;
                   FIN_CD_M_CTA.FieldByName('id_plano').AsString            := CAD_CD_C_FPG.FieldByName('VEN_ID_PLANO').AsString;;
                   FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                   FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                   // Corresponde ao mesmo id_titulo do (FIN_TB_M_REC) criado
                   FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsInteger;
                   // -------------------------------------------------------
                   FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                   FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                   FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                   FIN_CD_M_CTA.Post;
                 end;





             if (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 7)   then // Crdito
              begin
                BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
                BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
                BUS_CD_C_PAR_CTR.Close;
                BUS_CD_C_PAR_CTR.Data :=
                BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsString]));




                FIN_CD_M_RCR.Insert;
                FIN_CD_M_RCR.FieldByName('ID_EMPRESA').AsInteger     := BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger;
                FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger     := DmApoio.enBusValorChave('FIN_TB_M_RCR');
                FIN_CD_M_RCR.FieldByName('ID_CLIENTE').AsInteger     := BUS_CD_M_NFE.FieldByName('ID_EMITENTE').AsInteger;
                FIN_CD_M_RCR.FieldByName('ID_TITULO').AsInteger      := BUS_CD_M_NFE_TIT_INT.FieldByName('ID_NFE_TIT').AsInteger;
                FIN_CD_M_RCR.FieldByName('DTA_CREDITO').AsDateTime   := FIN_CD_M_CXA.FieldByName('DTA_ABERTURA').AsDateTime;
                FIN_CD_M_RCR.FieldByName('ORIGEM').AsInteger         := 3;
                FIN_CD_M_RCR.FieldByName('NUM_DOCUMENTO').AsString   := BUS_CD_M_NFE_TIT_INT.FieldByName('num_parcela').AsString;
                FIN_CD_M_RCR.FieldByName('VLR_CREDITO').AsCurrency   := BUS_CD_M_NFE_TIT_INT.FieldByName('vlr_titulo').AsCurrency;
                FIN_CD_M_RCR.FieldByName('HISTORICO').AsString       :=
                     'Crdito utilizado pela nota fiscal de n ' + BUS_CD_M_NFE.FieldByName('NUMERO').AsString;
                FIN_CD_M_RCR.FieldByName('DEB_CRE').AsInteger        := 0;
                FIN_CD_M_RCR.FieldByName('ID_FISCAL').AsInteger     := BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger;
                FIN_CD_M_RCR.Post;

                // Ao ser utilizado o crdito do cliente o sistema tem que criar dois registroa
                // na tabela de movimento de caixa (FIN_TB_M_CTA), um dbito e um crdito.

                // Inserindo o movimento de dbito
                FIN_CD_M_CTA_RCR.Insert;
                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                FIN_CD_M_CTA_RCR.FieldByName('id_controle').AsInteger        :=
                      self.enValorChave('FIN_TB_M_CTA');
                      //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                FIN_CD_M_CTA_RCR.FieldByName('id_credito').AsInteger         := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_abertura').AsInteger        := BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_empresa').AsInteger         := BUS_CD_M_NFE.FieldByName('id_empresa').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                FIN_CD_M_CTA_RCR.FieldByName('dta_lancamento').AsDateTime    := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                FIN_CD_M_CTA_RCR.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                FIN_CD_M_CTA_RCR.FieldByName('num_doc').AsInteger            := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('historico').AsString           := 'Ref. a utilizao da nota de crdito: ' +
                                                                                 FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString;
                FIN_CD_M_CTA_RCR.FieldByName('vlr_lancamento').AsCurrency    := BUS_CD_M_NFE_TIT_INT.FieldByName('vlr_titulo').AsCurrency;
                FIN_CD_M_CTA_RCR.FieldByName('origem').AsInteger             := 6; // 6-Nota de Crdito;
                FIN_CD_M_CTA_RCR.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_DEB').AsInteger;

                CAD_CD_C_TIF := TClientDataSet.Create(nil);
                CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                CAD_CD_C_TIF.Data :=
                    CAD_CD_C_TIF.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_DEB').AsString]));
                FIN_CD_M_CTA_RCR.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('NATUREZA').AsInteger;

                FIN_CD_M_CTA_RCR.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_PLANO_SEF').AsString;
                FIN_CD_M_CTA_RCR.FieldByName('conciliado').Asboolean         := false;
                FIN_CD_M_CTA_RCR.Post;


                // Inserindo o movimento de crdito
                FIN_CD_M_CTA_RCR.Insert;
                // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                FIN_CD_M_CTA_RCR.FieldByName('id_controle').AsInteger        :=
                    self.enValorChave('FIN_TB_M_CTA');
                    //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                FIN_CD_M_CTA_RCR.FieldByName('id_credito').AsInteger         := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_abertura').AsInteger        := BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_empresa').AsInteger         := BUS_CD_M_NFE.FieldByName('id_empresa').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                FIN_CD_M_CTA_RCR.FieldByName('dta_lancamento').AsDateTime    := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                FIN_CD_M_CTA_RCR.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                FIN_CD_M_CTA_RCR.FieldByName('num_doc').AsInteger            := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('historico').AsString           := 'Ref. a utilizao da nota de crdito: ' +
                                                                                 FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString;
                FIN_CD_M_CTA_RCR.FieldByName('vlr_lancamento').AsCurrency    := BUS_CD_M_NFE_TIT_INT.FieldByName('vlr_titulo').AsCurrency;
                FIN_CD_M_CTA_RCR.FieldByName('origem').AsInteger             := 6; // 6-Nota de Crdito;
                FIN_CD_M_CTA_RCR.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                FIN_CD_M_CTA_RCR.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_CRE').AsInteger;

                CAD_CD_C_TIF := TClientDataSet.Create(nil);
                CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                CAD_CD_C_TIF.Data :=
                    CAD_CD_C_TIF.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_CRE').AsString]));
                FIN_CD_M_CTA_RCR.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('NATUREZA').AsInteger;

                FIN_CD_M_CTA_RCR.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_PLANO_SEF').AsString;
                FIN_CD_M_CTA_RCR.FieldByName('conciliado').Asboolean         := false;
                FIN_CD_M_CTA_RCR.Post;

                CAD_CD_C_TIF.Close;
                BUS_CD_C_PAR_CTR.Close;
              end;


              CAD_CD_C_FPG.Close;
              BUS_CD_M_NFE_TIT_INT.Next;

             // O Applyupdate do FIN_CD_M_CTA,  dado no mtodo principal ( O que chamdou este ).
           end;
         //////FIM///////////////////////////////


        if xListaVlrFormaPag <> '' then
         begin
           xListaVlrFormaPag := xListaVlrFormaPag +';'+ CurrToStr(valor);
         end
        else
         begin
           xListaVlrFormaPag := CurrToStr(valor);
         end;

        if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger > 0 then
          begin
            ListaCodFormaPag := TStringList.Create;
            LIstaCodFormaPag.Delimiter:=';';
            LIstaCodFormapag.StrictDelimiter:=True;
            ListaCodFormaPag.DelimitedText := xListaCodFormaPag;

            ListaVlrFormaPag := TStringList.Create;
            LIstaVlrFormaPag.Delimiter:=';';
            LIstaVlrFormapag.StrictDelimiter:=True;
            ListaVlrFormaPag.DelimitedText := xListaVlrFormaPag;

            HouveAlt := false;

            for i := 0 to ListaCodFormapag.Count-1 do
              begin
                 CAD_CD_C_FPG := TClientDataSet.Create(nil);
                 CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                 CAD_CD_C_FPG.Close;
                 CAD_CD_C_FPG.Data :=
                 CAD_CD_C_FPG.DataRequest(VarArrayOf([0,ListaCodFormaPag[I]]));


                 IF ((CAD_CD_C_FPG.FieldByname('ativa_red_parc_car_rec').AsBoolean = true) and
                     (CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger >0))  then
                   begin
                      try
                       FIN_CD_M_REC.Filtered := true;
                       FIN_CD_M_REC.Filter := 'ID_FORMA_PAG = '+ListaCodFormaPag[I];
                       FIN_CD_M_REC.IndexFieldNames := 'DTA_VENCIMENTO';

                       FIN_CD_M_REC.First;
                       if (FIN_CD_M_REC.RecordCount > CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger) then
                         begin
                           valor_parcela := RoundTo(StrToCurr(ListaVlrFormapag[i])/(CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger*1.0),-2);
                           valor_restante := StrToCurr(ListaVlrFormapag[i]) - (CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger-1)*valor_parcela;

                           FIN_CD_M_REC.First;

                           for j := 0 to (CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger-1) do
                            begin
                              FIN_CD_M_REC.Edit;
                              if j = (CAD_CD_C_FPG.FieldByname('qtde_red_parc_car_rec').AsInteger-1) then
                                begin
                                  FIN_CD_M_REC.FieldByname('VLR_PARCELA').AsCurrency  := valor_restante;
                                  FIN_CD_M_REC.FieldByname('VLR_ORIGINAL').AsCurrency := valor_restante;
                                  FIN_CD_M_REC.FieldByname('VLR_SALDO').AsCurrency    := valor_restante;
                                end
                              else
                                begin
                                  FIN_CD_M_REC.FieldByname('VLR_PARCELA').AsCurrency  := valor_parcela;
                                  FIN_CD_M_REC.FieldByname('VLR_ORIGINAL').AsCurrency := valor_parcela;
                                  FIN_CD_M_REC.FieldByname('VLR_SALDO').AsCurrency    := valor_parcela;
                                end;
                             FIN_CD_M_REC.FieldByname('INT_TIT_VLR_ALT').AsBoolean := true;
                             FIN_CD_M_REC.Next;
                            end;

                           FIN_CD_M_REC.Filter := 'ID_FORMA_PAG = '+ListaCodFormaPag[I]+' and int_tit_vlr_alt=false ';
                           FIN_CD_M_REC.First;

                           HouveAlt := true;

                           while not FIN_CD_M_REC.IsEmpty do
                             begin
                               FIN_CD_M_REC.Delete;
                             end;
                         end;

                      finally
                       FIN_CD_M_REC.Filtered := false;
                      end;
                   end;
              end;

           if HouveAlt then
              begin
                FIN_CD_M_REC.Filtered := false;

                i:= 0;
                FIN_CD_M_REC.IndexFieldNames := 'DTA_VENCIMENTO';
                FIN_CD_M_REC.First;

                QtdeReg := IntToStr(FIN_CD_M_REC.RecordCount);
                while not FIN_CD_M_REC.eof do
                   begin
                     inc(i);
                     FIN_CD_M_REC.edit;
                     FIN_CD_M_REC.FieldByName('NUM_PARCELA').AsString :=
                            BUS_CD_M_NFE.FieldByName('NUMERO').AsString + '-' +
                            inttostr(i) + '/' + QtdeReg;
                     FIN_CD_M_REC.Post;
                     FIN_CD_M_REC.Next;
                   end;
                FIN_CD_M_REC.First;
              end;
          end;



        if BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger > 0 then
          begin
            FAT_CD_M_PED := TClientDataSet.Create(nil);
            FAT_CD_M_PED.SetProvider(FAT_DP_M_PED);
            FAT_CD_M_PED.Close;
            FAT_CD_M_PED.Data :=
                 FAT_CD_M_PED.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,
                                                        BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger ]));
            if not (FAT_CD_M_PED.IsEmpty) then
               begin
                 FAT_CD_M_PED.Edit;
                 FAT_CD_M_PED.FieldByName('SITUACAO').AsInteger := 3; // Faturado;
                 FAT_CD_M_PED.Post;
               end;
          end;

        if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger > 0 then
          begin
            OFI_CD_M_ORV := TClientDataSet.Create(nil);
            OFI_CD_M_ORV.SetProvider(OFI_DP_M_ORV);
            OFI_CD_M_ORV.Close;
            OFI_CD_M_ORV.Data :=
                 OFI_CD_M_ORV.DataRequest(VarArrayOf([0,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger,
                                                                BUS_CD_M_NFE.FieldByName('ID_EMPRESA').AsInteger,'1','']));
            if not (OFI_CD_M_ORV.IsEmpty) then
               begin
                 OFI_CD_M_ORV.Edit;
                 OFI_CD_M_ORV.FieldByName('STATUS').AsInteger := 3; // Faturado;
                 OFI_CD_M_ORV.Post;
               end;
          end;

      end
   else
      begin
        // Caso o cupom seja cancelado
        enCancelCupom(id_fiscal,BUS_CD_M_NFE,CAD_CD_C_CLI,CAD_CD_C_CLI_CRD,BUS_CD_C_PAR_CTR,BUS_CD_M_NFE);

        // Quando o cancelamento  uma nota de cupom, ento pra desfazer o financeiro
        //  preciso chamar o mtodo aqui.

        EST_CD_M_FES := TClientDataSet.Create(nil);

        enDesfazerFat(id_fiscal,BUS_CD_M_NFE,FIN_CD_M_CTA,FIN_CD_M_REC,
                      FIN_CD_M_REC_PAG,FIN_CD_M_RCR,FIN_CD_M_CTA_RCR,FAT_CD_M_PED,OFI_CD_M_ORV,EST_CD_M_FES,ReabrePed);



        BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger := 0;
        if ReabrePed='S' then
           begin
             if BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger >0 then
                 begin
                   BUS_CD_M_NFE_INT := TClientDataSet.Create(self);
                   BUS_CD_M_NFE_INT.SetProvider(BUS_DP_M_NFE_INT);
                   BUS_CD_M_NFE_INT.Close;
                   BUS_CD_M_NFE_INT.Data :=
                   BUS_CD_M_NFE_INT.DataRequest(VarArrayOf([90,BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger]));
                   BUS_CD_M_NFE_INT.First;
                   while not BUS_CD_M_NFE_INT.EOF do
                     begin
                       if  BUS_CD_M_NFE_INT.FieldByName('ID_FISCAL').AsInteger <> id_fiscal then
                          begin
                             if (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '02') or
                                (BUS_CD_M_NFE_INT.FieldByName('NFE_COD_SIT').AsString = '05') then
                                begin
                                   BUS_CD_M_NFE_INT.Edit;
                                   BUS_CD_M_NFE_INT.FieldByName('ID_ORDEM').AsInteger := 0;
                                   BUS_CD_M_NFE_INT.Post;
                                end;

                             if (BUS_CD_M_NFE_INT.FieldByName('NUMERO').AsInteger = 0) and
                                (BUS_CD_M_NFE_INT.FieldByName('STATUS').AsInteger = 0) then
                                begin
                                   BUS_CD_M_NFE_INT.Delete;
                                end;

                          end;

                       BUS_CD_M_NFE_INT.Next;
                     end;

                   BUS_CD_M_NFE.FieldByName('ID_ORDEM').AsInteger := 0;
                 end;
           end;

      end;



   cdsCupomDetalhe := TClientDataSet.Create(self);
   cdsCupomDetalhe.SetProvider(BUS_DP_BR_CUPOM_DETALHE);
   cdsCupomDetalhe.Close;
   cdsCupomDetalhe.Data :=
      cdsCupomDetalhe.DataRequest(VarArrayOf([cdsPreVenda.FieldByName('N_CUPOM').AsString]));

   cdsCupomDetalhe.First;
   while not cdsCupomDetalhe.eof do
     begin
        BUS_CD_C_ITE := nil;
        BUS_CD_C_ITE := TClientDataSet.Create(self);
        BUS_CD_C_ITE.SetProvider(CAD_DP_C_ITE);
        BUS_CD_C_ITE.Close;
        BUS_CD_C_ITE.Data :=
                  BUS_CD_C_ITE.DataRequest(VarArrayOf([0,trim(cdsCupomDetalhe.FieldByName('cod_produto').text)]));

        cdsCupomDetalhe.Edit;

        if cdsPreVendaDetalhe.Locate('cod_produto',IntToStr(StrToInt(trim(cdsCupomDetalhe.FieldByName('cod_produto').text))),[]) then
          begin
            cdsCupomDetalhe.FieldByName('ORIGEM_ICMS').AsString := trim(BUS_CD_C_ITE.FieldByName('INT_ORIGEM').AsString);

            cdsCupomDetalhe.FieldByName('CST_ICMS').AsString := '00';
            if (trim(cdsPreVendaDetalhe.FieldByName('aliquota').AsString) <> '') then
              begin
                 if (trim(cdsPreVendaDetalhe.FieldByName('aliquota').AsString) = 'FF') then
                    begin
                       cdsCupomDetalhe.FieldByName('CST_ICMS').AsString := '60';
                    end;

                 if (trim(cdsPreVendaDetalhe.FieldByName('aliquota').AsString) = 'II') then
                    begin
                       cdsCupomDetalhe.FieldByName('CST_ICMS').AsString := '40';
                    end;

                 if (trim(cdsPreVendaDetalhe.FieldByName('aliquota').AsString) = 'NN') then
                    begin
                        cdsCupomDetalhe.FieldByName('CST_ICMS').AsString := '41';
                    end;
              end;
          end;
        cdsCupomDetalhe.Post;
        cdsCupomDetalhe.Next;
     end;



  // Gravando os dados da transao do cupom fiscal
  try
     Conn  := BuscarConnBanco;
     Vtran := Conn.BeginTransaction;


     if id_pedido > 0 then
        begin
          BUS_CD_M_PED_TIT_INT.ApplyUpdates(0);
        end;

     if BUS_CD_M_NFE_INT <> nil then
         if (BUS_CD_M_NFE_INT.ChangeCount > 0) then
            if not (BUS_CD_M_NFE_INT.ApplyUpdates(0) = 0) then
               begin
                 result := 'Erro ao tentar atualizar dados de outras notas fiscais.'+#13+
                            BUS_CD_M_NFE_INT.enErro;
               end;


     if not (BUS_CD_M_NFE.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao finalizar o cupom fiscal.'+#13+
                    BUS_CD_M_NFE.enErro;
        end;

     if BUS_CD_M_NFE_TIT_INT <> nil then
        if BUS_CD_M_NFE_TIT_INT.ChangeCount > 0 then
           if not (BUS_CD_M_NFE_TIT_INT.ApplyUpdates(0) = 0) then
              begin
                result := 'Erro ao tentar atualizar os itens do cupom fiscal.'+#13+
                           BUS_CD_M_NFE_TIT_INT.enErro;
              end;

      if CAD_CD_C_CLI <> nil then
        if CAD_CD_C_CLI.ChangeCount > 0 then
           if not (CAD_CD_C_CLI.ApplyUpdates(0) = 0) then
              begin
                result := 'Erro ao tentar atualizar o saldo limite do cliente.'+#13+
                           CAD_CD_C_CLI.enErro;
              end;



      if CupomCancelado then
         begin
            if FIN_CD_M_CTA <> nil then
               if FIN_CD_M_CTA.ChangeCount > 0 then
                  if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir a movimentao de caixa/banco.'+#13+
                                  FIN_CD_M_CTA.enErro;
                     end;

            if FIN_CD_M_REC_PAG <> nil then
               if FIN_CD_M_REC_PAG.ChangeCount > 0 then
                  if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir os pagamentos dos ttulos a vista da nota fiscal.'+#13+
                                  FIN_CD_M_REC_PAG.enErro;
                     end;

            if FIN_CD_M_REC <> nil then
               if FIN_CD_M_REC.ChangeCount > 0 then
                  if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir os ttulos da nota fiscal.'+#13+
                                  FIN_CD_M_REC.enErro;
                     end;

            if FIN_CD_M_CTA_RCR <> nil then
               if FIN_CD_M_CTA_RCR.ChangeCount > 0 then
                  if not (FIN_CD_M_CTA_RCR.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir a movimentao de caixa/banco da nota de crdito da nota fiscal.'+#13+
                                  FIN_CD_M_CTA_RCR.enErro;
                     end;

            if FIN_CD_M_RCR <> nil then
               if FIN_CD_M_RCR.ChangeCount > 0 then
                  if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar excluir as notas de crdito da nota fiscal.'+#13+
                                  FIN_CD_M_RCR.enErro;
                     end;

           { if FAT_CD_M_PED <> nil then
               if FAT_CD_M_PED.ChangeCount > 0 then
                  if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar o pedido de venda da nota fiscal.'+#13+
                                  FAT_CD_M_PED.enErro;
                     end; }


            if EST_CD_M_FES <> nil then
               if EST_CD_M_FES.ChangeCount > 0 then
                  if not (EST_CD_M_FES.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar o custo mdio do item.'+#13+
                                  OFI_CD_M_ORV.enErro;
                     end;
         end
       else
         begin
           if FIN_CD_M_REC <> nil then
             if FIN_CD_M_REC.ChangeCount > 0 then
                if not (FIN_CD_M_REC.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar os ttulos da nota fiscal.'+#13+
                                FIN_CD_M_REC.enErro;
                   end;

           if FIN_CD_M_REC_PAG <> nil then
             if FIN_CD_M_REC_PAG.ChangeCount > 0 then
                if not (FIN_CD_M_REC_PAG.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar os pagamentos dos ttulos a vista da nota fiscal.'+#13+
                                FIN_CD_M_REC_PAG.enErro;
                   end;

            if FIN_CD_M_CTA <> nil then
             if FIN_CD_M_CTA.ChangeCount > 0 then
                if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar a movimentao de caixa/banco.'+#13+
                                FIN_CD_M_CTA.enErro;
                   end;

            if FIN_CD_M_RCR <> nil then
             if FIN_CD_M_RCR.ChangeCount > 0 then
                if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar as notas de crdito da nota fiscal.'+#13+
                                FIN_CD_M_RCR.enErro;
                   end;

            if FIN_CD_M_CTA_RCR <> nil then
             if FIN_CD_M_CTA_RCR.ChangeCount > 0 then
                if not (FIN_CD_M_CTA_RCR.ApplyUpdates(0) = 0) then
                   begin
                     result := 'Erro ao tentar atualizar a movimentao de caixa/banco da nota de crdito da nota fiscal.'+#13+
                                FIN_CD_M_CTA_RCR.enErro;
                   end;
         end;



     if FAT_CD_M_PED <> nil then
         if FAT_CD_M_PED.ChangeCount > 0 then
            if not (FAT_CD_M_PED.ApplyUpdates(0) = 0) then
               begin
                 result := 'Erro ao tentar atualizar o pedido de venda da nota fiscal.'+#13+
                            FAT_CD_M_PED.enErro;
               end;

     if OFI_CD_M_ORV <> nil then
               if OFI_CD_M_ORV.ChangeCount > 0 then
                  if not (OFI_CD_M_ORV.ApplyUpdates(0) = 0) then
                     begin
                       result := 'Erro ao tentar atualizar a ordem de servio da nota fiscal.'+#13+
                                  OFI_CD_M_ORV.enErro;
                     end;


     if cdsCupomDetalhe <> nil then
       if  cdsCupomDetalhe.ChangeCount > 0 then
          if not (cdsCupomDetalhe.ApplyUpdates(0) = 0) then
             begin
               result := 'Erro ao tentar atualizar CST e origem de ICMS.'+#13+
                          cdsCupomDetalhe.enErro;
             end;


     Conn.CommitFreeAndNil(Vtran);
  finally
     Conn.RollbackIncompleteFreeAndNil(Vtran);

     BUS_CD_C_PAR_CTR.Free;
     cdsCupom.Free;
     cdsCupomDetalhe.Free;
     cdsPreVendaDetalhe.Free;
     cdsPreVenda.Free;
     BUS_CD_C_ECF_FPG.Free;
     CdsNfeTitGrp.Free;
     CAD_CD_C_CLI.Free;
     CAD_CD_C_CLI_CRD.Free;
     BUS_CD_M_NFE.Free;
     BUS_CD_M_NFE_TIT_INT.Free;
     FAT_CD_M_PED.Free;
     OFI_CD_M_ORV.Free;

     FIN_CD_M_CXA.Free;
     CAD_CD_C_FPG.Free;
     CAD_CD_C_TIF.Free;
     FIN_CD_M_CTA.Free;
     FIN_CD_M_CTA_RCR.Free;
     FIN_CD_M_RCR.Free;
     FIN_CD_M_REC_PAG.Free;
     FIN_CD_M_REC.Free;
     BUS_CD_M_NFE_INT.Free;
  end;

end;

function TSM.enFormarObsFiscoNfe(DataSet: TCustomClientDataSet; NfeObsAnt,NfeObsAtu:String): String;
var
  cdsIte:TDataSet;
  CodInfFis:String;
  Sql:string;
begin

  { TODO -oMaxsuel -cCriao :
    Mtodo criado em 06/06/2015
    Tem a funo de atualizaro campo NFE_OBS da nota fiscal de venda. }

    {



        CodInfFis := '';
        cdsIte := TDataSetField(Dataset.FieldByName('FAT_SQ_M_NFE_ITE')).NestedDataSet;
        if DataSet.FieldByName('TIPO_NF').Text = 'S' then
           begin
             cdsIte.First;
             while not cdsIte.Eof do
                begin
                   if cdsIte.UpdateStatus in [usInserted] then
                      begin
                         if CodInfFis <> '' then
                             begin
                               CodInfFis :=
                                    CodInfFis + ',' +''''+ cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                             end;
                          if CodInfFis = '' then
                             begin
                               CodInfFis :=
                                    CodInfFis +''''+cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                             end;
                      end;
                   if cdsIte.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                      begin
                        cdsIte.Next;
                        if cdsIte.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                           begin
                             if trim(cdsIte.FieldByName('ID_INF_FISCO').AsString) <> '' then
                                begin
                                  if CodInfFis <> '' then
                                     begin
                                       CodInfFis :=
                                            CodInfFis + ',' +''''+ cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                                     end;
                                  if CodInfFis = '' then
                                     begin
                                       CodInfFis :=
                                            CodInfFis +''''+cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                                     end;
                                end
                             else
                                begin
                                  cdsIte.Prior;
                                  if CodInfFis <> '' then
                                     begin
                                       CodInfFis :=
                                            CodInfFis + ',' +''''+ cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                                     end;
                                  if CodInfFis = '' then
                                     begin
                                       CodInfFis :=
                                            CodInfFis +''''+cdsIte.FieldByName('ID_INF_FISCO').AsString+'''';
                                     end;
                                  cdsIte.Next;
                                end;
                           end;
                      end;
                end;

             if trim(CodInfFis) <> '' then
                begin
                   Sql:=
                      ' select * from cad_tb_c_inf inf ' +
                      ' where inf.id_inf in (' + VarToStr(CodInfFis) +') ' +
                   qryBusca.Close;
                   qryBusca.SQL.Clear;
                   qryBusca.SQL.Add(Sql);
                   qryBusca.Open;
                   if not qryBusca.IsEmpty then
                      begin
                        while not qrybusca.Eof do
                           begin
                             { = 0 quer dizer que no achou a string desejada }
                       {      if pos(qrybusca.FieldByName('DESCRICAO').AsString,NfeObsAtu) = 0 then
                                begin
                                  NfeObsAtu := qrybusca.FieldByName('DESCRICAO').AsString + #13 +
                                                 NfeObsAtu;
                                end;
                           end;
                      end;
                end;
           end;   }

end;


function TSM.enGerarNfe(id_fiscal: integer;id_emitente:integer): String;
var
   Vtran: TDBXTransaction;
   BUS_CD_C_CLI,BUS_CD_M_NFE_ECF, BUS_CD_M_NFE_ITE_ECF, BUS_CD_M_NFE,
   BUS_CD_M_NFE_ITE, BUS_CD_C_PAR, BUS_CD_C_PAR_CTR, BUS_CD_C_TME: TClientDataSet;
   i,IdFiscalNovo: Integer;
   CFOP: String;
   Conn: TSQLConnection;
begin

   // Buscar dados do CUPOM FISCAL
   BUS_CD_M_NFE_ECF := TClientDataSet.Create(nil);
   BUS_CD_M_NFE_ECF.SetProvider(BUS_DP_M_NFE_INT);
   BUS_CD_M_NFE_ECF.Close;
   BUS_CD_M_NFE_ECF.Data :=
          BUS_CD_M_NFE_ECF.DataRequest(VarArrayOf([0,id_fiscal]));

   // Buscar itens do CUPOM FISCAL
   BUS_CD_M_NFE_ITE_ECF := TClientDataSet.Create(nil);
   BUS_CD_M_NFE_ITE_ECF.SetProvider(BUS_DP_M_NFE_ITE_INT);
   BUS_CD_M_NFE_ITE_ECF.Close;
   BUS_CD_M_NFE_ITE_ECF.Data :=
          BUS_CD_M_NFE_ITE_ECF.DataRequest(VarArrayOf([id_fiscal]));


   // Gerar a nota Nfe
   BUS_CD_M_NFE := TClientDataSet.Create(nil);
   BUS_CD_M_NFE.SetProvider(BUS_DP_M_NFE_INT);
   BUS_CD_M_NFE.Close;
   BUS_CD_M_NFE.Data :=
          BUS_CD_M_NFE.DataRequest(VarArrayOf([0,'']));


   // Gerar os itens da Nfe
   BUS_CD_M_NFE_ITE := TClientDataSet.Create(nil);
   BUS_CD_M_NFE_ITE.SetProvider(BUS_DP_M_NFE_ITE_INT);
   BUS_CD_M_NFE_ITE.Close;
   BUS_CD_M_NFE_ITE.Data :=
          BUS_CD_M_NFE_ITE.DataRequest(VarArrayOf([1,0]));

   BUS_CD_C_PAR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR.SetProvider(CAD_DP_C_PAR);
   BUS_CD_C_PAR.Close;
   BUS_CD_C_PAR.Data :=
          BUS_CD_C_PAR.DataRequest(VarArrayOf([0,BUS_CD_M_NFE_ECF.FieldByName('ID_EMPRESA').AsString]));

   // Buscar dados do parmetros de controle
   BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
   BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
   BUS_CD_C_PAR_CTR.Close;
   BUS_CD_C_PAR_CTR.Data :=
          BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([BUS_CD_M_NFE_ECF.FieldByName('ID_EMPRESA').AsString]));



   // Buscar dados tipo de estoque
   BUS_CD_C_TME := TClientDataSet.Create(nil);
   BUS_CD_C_TME.SetProvider(CAD_DP_C_TME);
   BUS_CD_C_TME.Close;
   BUS_CD_C_TME.Data :=
          BUS_CD_C_TME.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('nfe_ecf_tipo_estoque').AsInteger]));


   // Buscar dados do cliente
   BUS_CD_C_CLI := TClientDataSet.Create(nil);
   BUS_CD_C_CLI.SetProvider(CAD_DP_C_CLI);
   BUS_CD_C_CLI.Close;
   BUS_CD_C_CLI.Data :=
          BUS_CD_C_CLI.DataRequest(VarArrayOf([0,BUS_CD_M_NFE_ECF.FieldByName('ID_EMITENTE').AsInteger]));


   TRY
     BUS_CD_M_NFE_ITE_ECF.Filtered := true;
     BUS_CD_M_NFE_ITE_ECF.Filter := 'INT_TIPO_ITEM<>''09''';
     if BUS_CD_M_NFE_ITE_ECF.RecordCount >0 then
       begin
         IdFiscalNovo := 0;

         // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
         IdFiscalNovo :=  self.enValorChave('FAT_TB_M_NFE');
                //  DmApoio.enBusValorChave('FAT_TB_M_NFE');

         BUS_CD_M_NFE.Insert;
         for i := 0 to BUS_CD_M_NFE_ECF.FieldCount - 1   do
             begin
               BUS_CD_M_NFE.Fields[i].AsVariant := BUS_CD_M_NFE_ECF.Fields[i].AsVariant;
             end;

         if BUS_CD_C_CLI.FieldByName('PESSOA').AsInteger = 0 then // Fsica
           begin
              if BUS_CD_M_NFE_ECF.FieldByName('UF_EMITENTE').AsString =
                 BUS_CD_M_NFE_ECF.FieldByName('UF_EMPRESA').AsString then
                 begin
                    CFOP := BUS_CD_C_TME.FieldByName('CFO_INTERNO_PF').AsString
                 end
              else
                 CFOP := BUS_CD_C_TME.FieldByName('CFO_EXTERNO_PF').AsString
           end;

         if BUS_CD_C_CLI.FieldByName('PESSOA').AsInteger = 1 then // Fsica
           begin
              if BUS_CD_M_NFE_ECF.FieldByName('UF_EMITENTE').AsString =
                 BUS_CD_M_NFE_ECF.FieldByName('UF_EMPRESA').AsString then
                 begin
                    CFOP := BUS_CD_C_TME.FieldByName('CFO_INTERNO_PJ').AsString
                 end
              else
                 CFOP := BUS_CD_C_TME.FieldByName('CFO_EXTERNO_PJ').AsString
           end;

         BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger              := IdFiscalNovo;
         BUS_CD_M_NFE.FieldByName('ID_EMITENTE').AsInteger            := id_emitente;
         BUS_CD_M_NFE.FieldByName('IND_NF').AsInteger                 := 1;
         BUS_CD_M_NFE.FieldByName('ID_CFO').AsString                  := CFOP;
         BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger                 := 0;
         BUS_CD_M_NFE.FieldByName('NFE_TIPO_EMISSAO').AsString        := '1';
         BUS_CD_M_NFE.FieldByName('NFE_TIPO_AMBIENTE').AsString       := '';
         BUS_CD_M_NFE.FieldByName('FATURADA').AsBoolean               := false;
         BUS_CD_M_NFE.FieldByName('STATUS').AsInteger                 := 0;
         BUS_CD_M_NFE.FieldByName('PREVENDA').AsBoolean               := false;
         BUS_CD_M_NFE.FieldByName('NFE_ECF').AsInteger                := 0;
         BUS_CD_M_NFE.FieldByName('SERIE').AsString                   := BUS_CD_M_NFE_ECF.FieldByName('SERIE').AsString;
         BUS_CD_M_NFE.FieldByName('SUB_SERIE').AsString               := '';
         BUS_CD_M_NFE.FieldByName('MODELO').AsString                  := '55';
         BUS_CD_M_NFE.FieldByName('NFE_CHAVE').AsString               := '';
         BUS_CD_M_NFE.FieldByName('ID_CONDICAO_PAG').AsInteger        := BUS_CD_C_PAR_CTR.FieldByName('nfe_ecf_id_condicao_pag').AsInteger;
         BUS_CD_M_NFE.FieldByName('ID_TIPO_MOV_ESTOQUE').AsInteger    := BUS_CD_C_PAR_CTR.FieldByName('nfe_ecf_tipo_estoque').AsInteger;
         BUS_CD_M_NFE.FieldByName('ID_FISCAL_REFERENCIADO').AsInteger := BUS_CD_M_NFE_ITE_ECF.FieldByName('id_fiscal').AsInteger;
         BUS_CD_M_NFE.FieldByName('ORIGEM_NF').AsString               := 'G';
         BUS_CD_M_NFE.FieldByName('NFE_OBS').AsString                 :=
                  'Nota Fiscal emitida em substituio do cupom fiscal n ' + BUS_CD_M_NFE_ECF.FieldByName('NUMERO').AsString +' emitido em ' +
                   BUS_CD_M_NFE_ECF.FieldByName('DTA_EMISSAO').AsString+', pela ECF '+BUS_CD_M_NFE_ECF.FieldByName('ECF_SERIAL_IMPRESSORA').AsString;

         BUS_CD_M_NFE.FieldByName('vlr_outras').AsCurrency        := 0;
         BUS_CD_M_NFE.FieldByName('vlr_mercadoria').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('vlr_desconto').AsCurrency      := 0;
         BUS_CD_M_NFE.FieldByName('vlr_liquido').AsCurrency       := 0;
         BUS_CD_M_NFE.FieldByName('iss_base').AsCurrency     := 0;
         BUS_CD_M_NFE.FieldByName('iss_valor').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('icm_n_base').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('icm_n_valor').AsCurrency  := 0;
         BUS_CD_M_NFE.FieldByName('icm_s_base').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('icm_s_valor').AsCurrency  := 0;
         BUS_CD_M_NFE.FieldByName('vlr_icm_desc').AsCurrency  := 0;

         BUS_CD_M_NFE.FieldByName('ipi_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('ipi_valor').AsCurrency   := 0;

         BUS_CD_M_NFE.FieldByName('pis_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('pis_valor').AsCurrency   := 0;

         BUS_CD_M_NFE.FieldByName('cof_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('cof_valor').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency      := 0;

         BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger     := 0;
         BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime    := Date;
         BUS_CD_M_NFE.FieldByName('DTA_DOCUMENTO').AsDateTime  := Date;
         BUS_CD_M_NFE.FieldByName('DTA_MOVIMENTO').AsDateTime  := Date;
         BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger := 0;


         BUS_CD_M_NFE_ITE_ECF.First;
         while not BUS_CD_M_NFE_ITE_ECF.eof do
            begin
               BUS_CD_M_NFE_ITE.Insert;
               for i := 0 to BUS_CD_M_NFE_ITE_ECF.FieldCount - 1   do
                   begin
                     BUS_CD_M_NFE_ITE.Fields[i].AsVariant := BUS_CD_M_NFE_ITE_ECF.Fields[i].AsVariant;
                   end;
               BUS_CD_M_NFE_ITE.FieldByName('ID_FISCAL').AsInteger    := IdFiscalNovo;
               BUS_CD_M_NFE_ITE.FieldByName('id_fiscal_dev').AsInteger        := 0;
               BUS_CD_M_NFE_ITE.FieldByName('vlr_outras').AsCurrency       := BUS_CD_M_NFE_ITE_ECF.FieldByName('vlr_mercadoria').AsCurrency;
               BUS_CD_M_NFE_ITE.FieldByName('fre_valor').AsCurrency        := 0;
               BUS_CD_M_NFE_ITE.FieldByName('vlr_seguro').AsCurrency       := 0;
               BUS_CD_M_NFE_ITE.FieldByName('vlr_outras_desp').AsCurrency  := 0;
               BUS_CD_M_NFE_ITE.FieldByName('vlr_icm_desc').AsCurrency     := 0;

               BUS_CD_M_NFE_ITE.FieldByName('id_cfo').AsString             := CFOP;

               BUS_CD_M_NFE_ITE.FieldByName('icm_n_aliquota').AsCurrency   := 0;
               BUS_CD_M_NFE_ITE.FieldByName('icm_per_reducao').AsCurrency  :=  0;

               BUS_CD_M_NFE_ITE.FieldByName('icm_n_base').AsCurrency           := 0;
               BUS_CD_M_NFE_ITE.FieldByName('icm_n_valor').AsCurrency          := 0;

               BUS_CD_M_NFE_ITE.FieldByName('icm_s_base').AsCurrency     := 0;
               BUS_CD_M_NFE_ITE.FieldByName('icm_s_valor').AsCurrency := 0;

               BUS_CD_M_NFE_ITE.FieldByName('ipi_base').AsCurrency     := 0;
               BUS_CD_M_NFE_ITE.FieldByName('ipi_valor').AsCurrency := 0;
               BUS_CD_M_NFE_ITE.FieldByName('ipi_aliquota').AsCurrency := 0;

               BUS_CD_M_NFE_ITE.FieldByName('pis_base').AsCurrency     := 0;
               BUS_CD_M_NFE_ITE.FieldByName('pis_valor').AsCurrency := 0;
               BUS_CD_M_NFE_ITE.FieldByName('pis_aliquota').AsCurrency := 0;

               BUS_CD_M_NFE_ITE.FieldByName('cof_base').AsCurrency     := 0;
               BUS_CD_M_NFE_ITE.FieldByName('cof_valor').AsCurrency := 0;
               BUS_CD_M_NFE_ITE.FieldByName('cof_aliquota').AsCurrency := 0;

               BUS_CD_M_NFE_ITE.FieldByName('iss_base').AsCurrency     := 0;
               BUS_CD_M_NFE_ITE.FieldByName('iss_valor').AsCurrency := 0;
               BUS_CD_M_NFE_ITE.FieldByName('iss_aliquota').AsCurrency := 0;

               BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR_ST').AsCurrency   := 0;
               BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR_ST').AsCurrency   := 0;
               BUS_CD_M_NFE_ITE.FieldByName('TRI_VALOR').AsCurrency      := 0;



               if ((not BUS_CD_C_PAR.FieldByName('INT_REG_TRIBUTARIO').IsNull) and
                     (BUS_CD_C_PAR.FieldByName('INT_REG_TRIBUTARIO').AsInteger = 0)) then
                  begin
                      BUS_CD_M_NFE_ITE.FieldByName('id_st_icm').AsString := '400';
                  end
               else
                  begin
                      BUS_CD_M_NFE_ITE.FieldByName('id_st_icm').AsString := '41';
                  end;

               BUS_CD_M_NFE_ITE.FieldByName('id_st_ipi').AsString := '99';
               BUS_CD_M_NFE_ITE.FieldByName('id_st_pis').AsString := '49';
               BUS_CD_M_NFE_ITE.FieldByName('id_st_cof').AsString := '49';

               BUS_CD_M_NFE_ITE.FieldByName('VLR_LIQUIDO').AsCurrency   :=
                   BUS_CD_M_NFE_ITE_ECF.FieldByName('VLR_MERCADORIA').AsCurrency
                       - BUS_CD_M_NFE_ITE_ECF.FieldByName('VLR_DESCONTO').AsCurrency;

               BUS_CD_M_NFE_ITE.Post;

               BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_OUTRAS').AsCurrency;


               BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_MERCADORIA').AsCurrency;

               BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_DESCONTO').AsCurrency;


               BUS_CD_M_NFE.FieldByName('IPI_BASE').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('IPI_BASE').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('IPI_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency      :=
                  BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency  +
                  BUS_CD_M_NFE_ITE.FieldByName('IPI_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('PIS_BASE').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('PIS_BASE').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('PIS_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('PIS_VALOR').AsCurrency      :=
                  BUS_CD_M_NFE.FieldByName('PIS_VALOR').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency   :=
                  BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR_ST').AsCurrency;

               BUS_CD_M_NFE.FieldByName('COF_BASE').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('COF_BASE').AsCurrency   +
                  BUS_CD_M_NFE_ITE.FieldByName('COF_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('COF_VALOR').AsCurrency      :=
                  BUS_CD_M_NFE.FieldByName('COF_VALOR').AsCurrency  +
                  BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency   :=
                  BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR_ST').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ICM_N_BASE').AsCurrency     :=
                  BUS_CD_M_NFE.FieldByName('ICM_N_BASE').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ICM_N_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ICM_N_VALOR').AsCurrency    :=
                  BUS_CD_M_NFE.FieldByName('ICM_N_VALOR').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ICM_N_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ICM_S_BASE').AsCurrency     :=
                  BUS_CD_M_NFE.FieldByName('ICM_S_BASE').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ICM_S_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency    :=
                  BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ICM_S_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency    :=
                  BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_ICM_DESC').AsCurrency;

               BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency     :=
                  BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_OUTRAS').AsCurrency;

               BUS_CD_M_NFE.FieldByName('VLR_ISENTA').AsCurrency    :=
                  BUS_CD_M_NFE.FieldByName('VLR_ISENTA').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_ISENTA').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ISS_BASE').AsCurrency       :=
                  BUS_CD_M_NFE.FieldByName('ISS_BASE').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ISS_BASE').AsCurrency;

               BUS_CD_M_NFE.FieldByName('ISS_VALOR').AsCurrency      :=
                  BUS_CD_M_NFE.FieldByName('ISS_VALOR').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('ISS_VALOR').AsCurrency;

               BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency      :=
                  BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('TRI_VALOR').AsCurrency;


               BUS_CD_M_NFE.FieldByName('PESO_LIQUIDO').AsCurrency   :=
                      BUS_CD_M_NFE.FieldByName('PESO_LIQUIDO').AsCurrency +
                              BUS_CD_M_NFE_ITE.FieldByName('PESO_LIQUIDO').AsCurrency;

               BUS_CD_M_NFE.FieldByName('PESO_BRUTO').AsCurrency     :=
                      BUS_CD_M_NFE.FieldByName('PESO_BRUTO').AsCurrency +
                              BUS_CD_M_NFE_ITE.FieldByName('PESO_BRUTO').AsCurrency;


               BUS_CD_M_NFE_ITE_ECF.Next;
            end;

            BUS_CD_M_NFE.FieldByName('VLR_LIQUIDO').AsCurrency   :=
                   BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency
                -  BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency
                -  BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency    +
              BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency    +
              BUS_CD_M_NFE.FieldByName('FRE_VALOR').AsCurrency       +
              BUS_CD_M_NFE.FieldByName('VLR_SEGURO').AsCurrency      +
                 //cdsNfe.FieldByName('VLR_OUTRAS').AsCurrency +
              BUS_CD_M_NFE.FieldByName('VLR_OUTRAS_DESP').AsCurrency +
              BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency;

           BUS_CD_M_NFE.Post;
         end;
   FINALLY
     BUS_CD_M_NFE_ITE_ECF.Filtered := false;
   END;


    TRY
     BUS_CD_M_NFE_ITE_ECF.Filtered := true;
     BUS_CD_M_NFE_ITE_ECF.Filter := 'INT_TIPO_ITEM=''09''';
     if BUS_CD_M_NFE_ITE_ECF.RecordCount >0 then
       begin
         IdFiscalNovo := 0;
         // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
         IdFiscalNovo :=  self.enValorChave('FAT_TB_M_NFE');
            // DmApoio.enBusValorChave('FAT_TB_M_NFE');
         BUS_CD_M_NFE.Insert;
         for i := 0 to BUS_CD_M_NFE_ECF.FieldCount - 1   do
          begin
           BUS_CD_M_NFE.Fields[i].AsVariant := BUS_CD_M_NFE_ECF.Fields[i].AsVariant;
          end;


         BUS_CD_M_NFE.FieldByName('ID_FISCAL').AsInteger              := IdFiscalNovo;
         BUS_CD_M_NFE.FieldByName('ID_EMITENTE').AsInteger            := id_emitente;
         BUS_CD_M_NFE.FieldByName('IND_NF').AsInteger            := 2;
         if BUS_CD_M_NFE_ECF.FieldByName('UF_EMITENTE').AsString =
            BUS_CD_M_NFE_ECF.FieldByName('UF_EMPRESA').AsString  then
             begin
                CFOP  :=
                    BUS_CD_C_TME.FieldByName('CFO_SERVICO_DENTRO').AsString;
             end
         else
             begin
                CFOP  :=
                    BUS_CD_C_TME.FieldByName('CFO_SERVICO_FORA').AsString;
             end;


         BUS_CD_M_NFE.FieldByName('ID_CFO').AsString                  := CFOP;
         BUS_CD_M_NFE.FieldByName('NUMERO').AsInteger                 := 0;
         BUS_CD_M_NFE.FieldByName('NFE_TIPO_EMISSAO').AsString        := '1';
         BUS_CD_M_NFE.FieldByName('NFE_TIPO_AMBIENTE').AsString       := '';
         BUS_CD_M_NFE.FieldByName('FATURADA').AsBoolean               := false;
         BUS_CD_M_NFE.FieldByName('STATUS').AsInteger                 := 0;
         BUS_CD_M_NFE.FieldByName('PREVENDA').AsBoolean               := false;
         BUS_CD_M_NFE.FieldByName('NFE_ECF').AsInteger                := 0;
         BUS_CD_M_NFE.FieldByName('SERIE').AsString                   := BUS_CD_M_NFE_ECF.FieldByName('SERIE').AsString;
         BUS_CD_M_NFE.FieldByName('SUB_SERIE').AsString               := '';
         BUS_CD_M_NFE.FieldByName('MODELO').AsString                  := '55';
         BUS_CD_M_NFE.FieldByName('NFE_CHAVE').AsString               := '';
         BUS_CD_M_NFE.FieldByName('ID_CONDICAO_PAG').AsInteger        := BUS_CD_C_PAR_CTR.FieldByName('nfe_ecf_id_condicao_pag').AsInteger;
         BUS_CD_M_NFE.FieldByName('ID_TIPO_MOV_ESTOQUE').AsInteger    := BUS_CD_C_PAR_CTR.FieldByName('nfe_ecf_tipo_estoque').AsInteger;
         BUS_CD_M_NFE.FieldByName('ID_FISCAL_REFERENCIADO').AsInteger := BUS_CD_M_NFE_ITE_ECF.FieldByName('id_fiscal').AsInteger;
         BUS_CD_M_NFE.FieldByName('ORIGEM_NF').AsString               := 'G';
         BUS_CD_M_NFE.FieldByName('NFE_OBS').AsString                 :=
                  'Nota Fiscal emitida em substituio do cupom fiscal n ' + BUS_CD_M_NFE_ECF.FieldByName('NUMERO').AsString +' emitido em ' +
                   BUS_CD_M_NFE_ECF.FieldByName('DTA_EMISSAO').AsString+', pela ECF '+BUS_CD_M_NFE_ECF.FieldByName('ECF_SERIAL_IMPRESSORA').AsString;

         BUS_CD_M_NFE.FieldByName('vlr_outras').AsCurrency        := 0;
         BUS_CD_M_NFE.FieldByName('vlr_mercadoria').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('vlr_desconto').AsCurrency      := 0;
         BUS_CD_M_NFE.FieldByName('vlr_liquido').AsCurrency       := 0;
         BUS_CD_M_NFE.FieldByName('iss_base').AsCurrency     := 0;
         BUS_CD_M_NFE.FieldByName('iss_valor').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('icm_n_base').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('icm_n_valor').AsCurrency  := 0;
         BUS_CD_M_NFE.FieldByName('icm_s_base').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('icm_s_valor').AsCurrency  := 0;
         BUS_CD_M_NFE.FieldByName('vlr_icm_desc').AsCurrency  := 0;


         BUS_CD_M_NFE.FieldByName('ipi_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('ipi_valor').AsCurrency   := 0;

         BUS_CD_M_NFE.FieldByName('pis_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('pis_valor').AsCurrency   := 0;

         BUS_CD_M_NFE.FieldByName('cof_base').AsCurrency    := 0;
         BUS_CD_M_NFE.FieldByName('cof_valor').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency   := 0;
         BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency      := 0;

         BUS_CD_M_NFE.FieldByName('ID_ABERTURA').AsInteger     := 0;
         BUS_CD_M_NFE.FieldByName('DTA_EMISSAO').AsDateTime    := Date;
         BUS_CD_M_NFE.FieldByName('DTA_DOCUMENTO').AsDateTime  := Date;
         BUS_CD_M_NFE.FieldByName('DTA_MOVIMENTO').AsDateTime  := Date;
         BUS_CD_M_NFE.FieldByName('ID_PEDIDO_VENDA').AsInteger := 0;



         BUS_CD_M_NFE_ITE_ECF.First;
         while not BUS_CD_M_NFE_ITE_ECF.eof do
           begin
              BUS_CD_M_NFE_ITE.Insert;

              for i := 0 to BUS_CD_M_NFE_ITE_ECF.FieldCount - 1   do
                 begin
                   BUS_CD_M_NFE_ITE.Fields[i].AsVariant := BUS_CD_M_NFE_ITE_ECF.Fields[i].AsVariant;
                 end;
              BUS_CD_M_NFE_ITE.FieldByName('ID_FISCAL').AsInteger    := IdFiscalNovo;
              BUS_CD_M_NFE_ITE.FieldByName('id_fiscal_dev').AsInteger        := 0;
              BUS_CD_M_NFE_ITE.FieldByName('vlr_outras').AsCurrency       := BUS_CD_M_NFE_ITE_ECF.FieldByName('vlr_mercadoria').AsCurrency;
              BUS_CD_M_NFE_ITE.FieldByName('fre_valor').AsCurrency        := 0;
              BUS_CD_M_NFE_ITE.FieldByName('vlr_seguro').AsCurrency       := 0;
              BUS_CD_M_NFE_ITE.FieldByName('vlr_outras_desp').AsCurrency  := 0;
              BUS_CD_M_NFE_ITE.FieldByName('vlr_icm_desc').AsCurrency     := 0;

              BUS_CD_M_NFE_ITE.FieldByName('id_cfo').AsString             := CFOP;

              BUS_CD_M_NFE_ITE.FieldByName('icm_n_aliquota').AsCurrency   := 0;
              BUS_CD_M_NFE_ITE.FieldByName('icm_per_reducao').AsCurrency  :=  0;

              BUS_CD_M_NFE_ITE.FieldByName('icm_n_base').AsCurrency           := 0;
              BUS_CD_M_NFE_ITE.FieldByName('icm_n_valor').AsCurrency          := 0;

              BUS_CD_M_NFE_ITE.FieldByName('icm_s_base').AsCurrency     := 0;
              BUS_CD_M_NFE_ITE.FieldByName('icm_s_valor').AsCurrency := 0;

              BUS_CD_M_NFE_ITE.FieldByName('ipi_base').AsCurrency     := 0;
              BUS_CD_M_NFE_ITE.FieldByName('ipi_valor').AsCurrency := 0;
              BUS_CD_M_NFE_ITE.FieldByName('ipi_aliquota').AsCurrency := 0;

              BUS_CD_M_NFE_ITE.FieldByName('pis_base').AsCurrency     := 0;
              BUS_CD_M_NFE_ITE.FieldByName('pis_valor').AsCurrency := 0;
              BUS_CD_M_NFE_ITE.FieldByName('pis_aliquota').AsCurrency := 0;

              BUS_CD_M_NFE_ITE.FieldByName('cof_base').AsCurrency     := 0;
              BUS_CD_M_NFE_ITE.FieldByName('cof_valor').AsCurrency := 0;
              BUS_CD_M_NFE_ITE.FieldByName('cof_aliquota').AsCurrency := 0;

              BUS_CD_M_NFE_ITE.FieldByName('iss_base').AsCurrency     := 0;
              BUS_CD_M_NFE_ITE.FieldByName('iss_valor').AsCurrency := 0;
              BUS_CD_M_NFE_ITE.FieldByName('iss_aliquota').AsCurrency := 0;

              BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR_ST').AsCurrency   := 0;
              BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR_ST').AsCurrency   := 0;
              BUS_CD_M_NFE_ITE.FieldByName('TRI_VALOR').AsCurrency      := 0;


              if ((not BUS_CD_C_PAR.FieldByName('INT_REG_TRIBUTARIO').IsNull) and
                   (BUS_CD_C_PAR.FieldByName('INT_REG_TRIBUTARIO').AsInteger = 0)) then
                begin
                    BUS_CD_M_NFE_ITE.FieldByName('id_st_icm').AsString := '400';
                end
              else
                begin
                    BUS_CD_M_NFE_ITE.FieldByName('id_st_icm').AsString := '41';
                end;

              BUS_CD_M_NFE_ITE.FieldByName('id_st_ipi').AsString := '99';
              BUS_CD_M_NFE_ITE.FieldByName('id_st_pis').AsString := '49';
              BUS_CD_M_NFE_ITE.FieldByName('id_st_cof').AsString := '49';

              BUS_CD_M_NFE_ITE.FieldByName('VLR_LIQUIDO').AsCurrency   :=
                 BUS_CD_M_NFE_ITE_ECF.FieldByName('VLR_MERCADORIA').AsCurrency
                     - BUS_CD_M_NFE_ITE_ECF.FieldByName('VLR_DESCONTO').AsCurrency;

              BUS_CD_M_NFE_ITE.Post;

              BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency    :=
                  BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency +
                  BUS_CD_M_NFE_ITE.FieldByName('VLR_ICM_DESC').AsCurrency;

              BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('VLR_OUTRAS').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('VLR_OUTRAS').AsCurrency;


              BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('VLR_MERCADORIA').AsCurrency;

              BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('VLR_DESCONTO').AsCurrency;


              BUS_CD_M_NFE.FieldByName('IPI_BASE').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('IPI_BASE').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('IPI_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency      :=
                BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency  +
                BUS_CD_M_NFE_ITE.FieldByName('IPI_VALOR').AsCurrency;

              BUS_CD_M_NFE.FieldByName('PIS_BASE').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('PIS_BASE').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('PIS_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('PIS_VALOR').AsCurrency      :=
                BUS_CD_M_NFE.FieldByName('PIS_VALOR').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR').AsCurrency;

              BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency   :=
                BUS_CD_M_NFE.FieldByName('PIS_VALOR_ST').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('PIS_VALOR_ST').AsCurrency;

              BUS_CD_M_NFE.FieldByName('COF_BASE').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('COF_BASE').AsCurrency   +
                BUS_CD_M_NFE_ITE.FieldByName('COF_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('COF_VALOR').AsCurrency      :=
                BUS_CD_M_NFE.FieldByName('COF_VALOR').AsCurrency  +
                BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR').AsCurrency;

              BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency   :=
                BUS_CD_M_NFE.FieldByName('COF_VALOR_ST').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('COF_VALOR_ST').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ICM_N_BASE').AsCurrency     :=
                BUS_CD_M_NFE.FieldByName('ICM_N_BASE').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ICM_N_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ICM_N_VALOR').AsCurrency    :=
                BUS_CD_M_NFE.FieldByName('ICM_N_VALOR').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ICM_N_VALOR').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ICM_S_BASE').AsCurrency     :=
                BUS_CD_M_NFE.FieldByName('ICM_S_BASE').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ICM_S_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency    :=
                BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ICM_S_VALOR').AsCurrency;


              BUS_CD_M_NFE.FieldByName('VLR_ISENTA').AsCurrency    :=
                BUS_CD_M_NFE.FieldByName('VLR_ISENTA').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('VLR_ISENTA').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ISS_BASE').AsCurrency       :=
                BUS_CD_M_NFE.FieldByName('ISS_BASE').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ISS_BASE').AsCurrency;

              BUS_CD_M_NFE.FieldByName('ISS_VALOR').AsCurrency      :=
                BUS_CD_M_NFE.FieldByName('ISS_VALOR').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('ISS_VALOR').AsCurrency;

              BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency      :=
                BUS_CD_M_NFE.FieldByName('TRI_VALOR').AsCurrency +
                BUS_CD_M_NFE_ITE.FieldByName('TRI_VALOR').AsCurrency;



              BUS_CD_M_NFE.FieldByName('PESO_LIQUIDO').AsCurrency   :=
                    BUS_CD_M_NFE.FieldByName('PESO_LIQUIDO').AsCurrency +
                            BUS_CD_M_NFE_ITE.FieldByName('PESO_LIQUIDO').AsCurrency;

              BUS_CD_M_NFE.FieldByName('PESO_BRUTO').AsCurrency     :=
                    BUS_CD_M_NFE.FieldByName('PESO_BRUTO').AsCurrency +
                            BUS_CD_M_NFE_ITE.FieldByName('PESO_BRUTO').AsCurrency;


              BUS_CD_M_NFE_ITE_ECF.Next;
           end;

           BUS_CD_M_NFE.FieldByName('VLR_LIQUIDO').AsCurrency   :=
                   BUS_CD_M_NFE.FieldByName('VLR_MERCADORIA').AsCurrency
                -  BUS_CD_M_NFE.FieldByName('VLR_ICM_DESC').AsCurrency
                -  BUS_CD_M_NFE.FieldByName('VLR_DESCONTO').AsCurrency    +
              BUS_CD_M_NFE.FieldByName('ICM_S_VALOR').AsCurrency    +
              BUS_CD_M_NFE.FieldByName('FRE_VALOR').AsCurrency       +
              BUS_CD_M_NFE.FieldByName('VLR_SEGURO').AsCurrency      +
                 //cdsNfe.FieldByName('VLR_OUTRAS').AsCurrency +
              BUS_CD_M_NFE.FieldByName('VLR_OUTRAS_DESP').AsCurrency +
              BUS_CD_M_NFE.FieldByName('IPI_VALOR').AsCurrency;


           BUS_CD_M_NFE.Post;
       end;

    FINALLY
       BUS_CD_M_NFE_ITE_ECF.Filtered := false;
    END;

   BUS_CD_C_CLI.Close;
   BUS_CD_C_TME.Close;

   result := '';
   try
     Conn  := BuscarConnBanco;
     Vtran := Conn.BeginTransaction;

     if not (BUS_CD_M_NFE.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao tentar gerar a nota fiscal.';
        end;
     if not (BUS_CD_M_NFE_ITE.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao tentar gerar os itens da nota fiscal.';
        end;

     Conn.CommitFreeAndNil(Vtran);

     if trim(result) = '' then
        begin
          result := 'OK';
        end;

   finally
     Conn.RollbackIncompleteFreeAndNil(Vtran);

     BUS_CD_C_CLI.Free;
     BUS_CD_M_NFE_ECF.Free;
     BUS_CD_M_NFE_ITE_ECF.Free;
     BUS_CD_M_NFE.Free;
     BUS_CD_M_NFE_ITE.Free;
     BUS_CD_C_PAR_CTR.Free;
     BUS_CD_C_PAR.Free;
     BUS_CD_C_TME.Free;
   end;
end;


function TSM.enGerarPreVenda(id_fiscal,id_abertura,serial_pv, ecf_serial, ecf_marca,ecf_modelo, ecf_caixa: String): String;
var
  CD_BR_SEQ_ID:   TClientDataSet;
  CD_BR_PREVENDA: TClientDataSet;
  CD_BR_PREVENDA_DETALHE,FAT_CD_M_NFE_ITE: TDataSet;
  FAT_CD_M_NFE:   TClientDataSet;
  CAD_CD_C_ITE:   TClientDataSet;
  BUS_CD_C_TRI_REG: TClientDataSet;


  Vtran: TDBXTransaction;
  xSeq, ecf_prevenda: Integer;
  NCM,xServico,xEmitente: String;
  Conn: TSQLConnection;
begin
  RESULT := 'OK';

  ecf_prevenda := 0;
  // Busca o novo nro de pr-venda
  CD_BR_SEQ_ID  := TClientDataSet.Create(self);
  CD_BR_SEQ_ID.SetProvider(DP_BR_SEQ_ID);
  CD_BR_SEQ_ID.Close;
  CD_BR_SEQ_ID.Data :=
      CD_BR_SEQ_ID.DataRequest(VarArrayOf([0,'BR_PREVENDA']));
  CD_BR_SEQ_ID.Edit;
  CD_BR_SEQ_ID.FieldByName('SEQ_ID').AsInteger :=
                     CD_BR_SEQ_ID.FieldByName('SEQ_ID').AsInteger + 1;
  ecf_prevenda := CD_BR_SEQ_ID.FieldByName('SEQ_ID').AsInteger;
  CD_BR_SEQ_ID.Post;

  if CD_BR_SEQ_ID.ApplyUpdates(0) <> 0 then
     begin
       Result := 'Erro ao tentar atualizar o nro da pr-venda na tabela "BR_PREVENDA": ' + #13 +
                  CD_BR_SEQ_ID.enErro;
     end;
  CD_BR_SEQ_ID.Close;
  // -------------------------------------------------------------------


  // Buscar a nota fiscal
  FAT_CD_M_NFE      := TClientDataSet.Create(self);
  FAT_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
  FAT_CD_M_NFE.Close;
  FAT_CD_M_NFE.Data :=
      FAT_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));
  FAT_CD_M_NFE_ITE := TDataSetField(FAT_CD_M_NFE.FieldByName('FAT_SQ_M_NFE_ITE')).NestedDataSet;
  // --------------------------------------------------------------------

  CD_BR_PREVENDA  := TClientDataSet.Create(self);
  CD_BR_PREVENDA.SetProvider(DP_BR_PREVENDA);
  CD_BR_PREVENDA.Close;
  CD_BR_PREVENDA.Data :=
       CD_BR_PREVENDA.DataRequest(VarArrayOf([0]));

  // Aponta o filho da pr-venda para poder inserir os dados do item da nota fiscal
  CD_BR_PREVENDA_DETALHE := TDataSetField(CD_BR_PREVENDA.FieldByName('SQ_BR_PREVENDA_DETALHE')).NestedDataSet;


  // Cria pr-venda
  CD_BR_PREVENDA.Insert;
  CD_BR_PREVENDA.FieldByName('numprevenda').AsInteger := ecf_prevenda;
  CD_BR_PREVENDA.FieldByName('data_cad').AsDateTime   := date;
  CD_BR_PREVENDA.FieldByName('vendedor').AsString     := '';
  CD_BR_PREVENDA.FieldByName('plano').AsString        := '';
  CD_BR_PREVENDA.FieldByName('id_cliente').AsString   := FAT_CD_M_NFE.fieldByName('ID_EMITENTE').asString;
  CD_BR_PREVENDA.FieldByName('numloja').AsString      := FAT_CD_M_NFE.fieldByName('ID_EMPRESA').asString; //'001';
  CD_BR_PREVENDA.FieldByName('cancelado').AsString    := 'N';
  CD_BR_PREVENDA.FieldByName('cpf_cnpj').AsString     := FAT_CD_M_NFE.FieldByName('INT_CNPJCPF').asString;;
  CD_BR_PREVENDA.FieldByName('endereco').AsString     := FAT_CD_M_NFE.FieldByName('INT_ENDERECO').AsString;

  xEmitente := trim(FAT_CD_M_NFE.FieldByName('INT_NOMEEMI').AsString);
  if (Length(xEmitente)>40) then
     xEmitente := copy(xEmitente,1,40);

  CD_BR_PREVENDA.FieldByName('nome').AsString         := xEmitente;
  CD_BR_PREVENDA.FieldByName('bairro').AsString       := FAT_CD_M_NFE.FieldByName('INT_BAIRRO').AsString;
  CD_BR_PREVENDA.FieldByName('cidade').AsString       := FAT_CD_M_NFE.FieldByName('INT_NOM_CIDADE').AsString;
  CD_BR_PREVENDA.FieldByName('cep').AsString          := FAT_CD_M_NFE.FieldByName('INT_CEP').AsString;
  CD_BR_PREVENDA.FieldByName('uf').AsString           := FAT_CD_M_NFE.FieldByName('UF_EMITENTE').AsString;
  CD_BR_PREVENDA.FieldByName('fone1').AsString        := FAT_CD_M_NFE.FieldByName('INT_TELEFONE').AsString;
  CD_BR_PREVENDA.FieldByName('fone2').AsString        := '';
  CD_BR_PREVENDA.FieldByName('email').AsString        := FAT_CD_M_NFE.FieldByName('INT_EMAIL').AsString;
  CD_BR_PREVENDA.FieldByName('desconto').AsCurrency   := 0;
  CD_BR_PREVENDA.FieldByName('acrescimo').AsCurrency  := 0;
  CD_BR_PREVENDA.FieldByName('flag_liberado').AsString:= 'S';
  CD_BR_PREVENDA.FieldByName('tipo').AsString         := 'P';
  CD_BR_PREVENDA.FieldByName('serialpv').AsString     := serial_pv;
  CD_BR_PREVENDA.FieldByName('flag_aceito').AsString  := 'BR*';
  CD_BR_PREVENDA.FieldByName('flag_sis').AsString     := 'S';

  xSeq:=0;

  // Inserir os itens da pr-venda
  FAT_CD_M_NFE_ITE.first;
  While not FAT_CD_M_NFE_ITE.eof do
     begin
       inc(xSeq);

       CD_BR_PREVENDA_DETALHE.Insert;
       CD_BR_PREVENDA_DETALHE.FieldByName('NCM').AsString              := FAT_CD_M_NFE_ITE.FieldByName('INT_ID_NCM').AsString;
       CD_BR_PREVENDA_DETALHE.FieldByName('numprevenda').AsInteger     := ecf_prevenda;

       CD_BR_PREVENDA_DETALHE.FieldByName('loja').AsString             := FAT_CD_M_NFE.fieldByName('ID_EMPRESA').asString; //'001';
       CD_BR_PREVENDA_DETALHE.FieldByName('cod_produto').AsString      := FAT_CD_M_NFE_ITE.fieldByName('ID_ITEM').asString;
       CD_BR_PREVENDA_DETALHE.FieldByName('qtd').AsFloat               := FAT_CD_M_NFE_ITE.fieldByName('QTDE').asFloat;
       CD_BR_PREVENDA_DETALHE.FieldByName('un').AsString               := FAT_CD_M_NFE_ITE.fieldByName('INT_UND_VENDA').AsString;
       CD_BR_PREVENDA_DETALHE.FieldByName('valor').AsCurrency          := FAT_CD_M_NFE_ITE.fieldByName('VLR_UNITARIO').asCurrency;
       CD_BR_PREVENDA_DETALHE.FieldByName('desconto').AsCurrency       := FAT_CD_M_NFE_ITE.fieldByName('VLR_DESCONTO').asCurrency;
       CD_BR_PREVENDA_DETALHE.FieldByName('acrescimo').AsCurrency      := 0;
       CD_BR_PREVENDA_DETALHE.FieldByName('total').AsCurrency          := FAT_CD_M_NFE_ITE.fieldByName('VLR_LIQUIDO').asCurrency;
       CD_BR_PREVENDA_DETALHE.FieldByName('cancelado').AsString        := 'N';
       CD_BR_PREVENDA_DETALHE.FieldByName('cod_grade').AsString        := '';
       CD_BR_PREVENDA_DETALHE.FieldByName('item').AsInteger            := xSeq;
       CD_BR_PREVENDA_DETALHE.FieldByName('cod_kit').AsString          := '';
       CD_BR_PREVENDA_DETALHE.FieldByName('cod_vendedor').AsString     := '';
       CD_BR_PREVENDA_DETALHE.FieldByName('desc_produto').AsString     := FAT_CD_M_NFE_ITE.FieldByName('INT_DESC_ITEM').AsString;
       //CD_BR_PREVENDA_DETALHE.FieldByName('aliquota').AsString         := FAT_CD_M_NFE_ITE.fieldByName('ICM_N_ALIQUOTA').AsString;
       CD_BR_PREVENDA_DETALHE.FieldByName('cfop').AsString             := trim(FAT_CD_M_NFE_ITE.fieldByName('ID_CFO').AsString);

       CAD_CD_C_ITE := TClientDataSet.Create(self);
       CAD_CD_C_ITE.SetProvider(CAD_DP_C_ITE);
       CAD_CD_C_ITE.Close;
       CAD_CD_C_ITE.Data :=
           CAD_CD_C_ITE.DataRequest(VarArrayOf([0,FAT_CD_M_NFE_ITE.FieldByName('ID_ITEM').AsString]));

       BUS_CD_C_TRI_REG := TClientDataSet.Create(self);
       BUS_CD_C_TRI_REG.SetProvider(BUS_DP_C_TRI_REG);
       BUS_CD_C_TRI_REG.Close;
       BUS_CD_C_TRI_REG.Data :=
            BUS_CD_C_TRI_REG.DataRequest(VarArrayOf([trim(CAD_CD_C_ITE.FieldByName('INT_TRIBUTO').AsString),
                                                   trim(FAT_CD_M_NFE.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString),
                                                   trim(FAT_CD_M_NFE.FieldByName('INT_ESTADO').AsString),
                                                   trim(FAT_CD_M_NFE.FieldByName('ID_EMPRESA').AsString)]));

       if BUS_CD_C_TRI_REG.IsEmpty then
         begin
             BUS_CD_C_TRI_REG := TClientDataSet.Create(self);
             BUS_CD_C_TRI_REG.SetProvider(BUS_DP_C_TRI_REG);
             BUS_CD_C_TRI_REG.Close;
             BUS_CD_C_TRI_REG.Data :=
             BUS_CD_C_TRI_REG.DataRequest(VarArrayOf([trim(CAD_CD_C_ITE.FieldByName('INT_TRIBUTO').AsString),
                                                   trim(FAT_CD_M_NFE.FieldByName('ID_TIPO_MOV_ESTOQUE').AsString),
                                                    'XX',
                                                    trim(FAT_CD_M_NFE.FieldByName('ID_EMPRESA').AsString)]));
         end;


       if CAD_CD_C_ITE.FieldByName('INT_TIPO_ITEM').AsInteger=9 Then
          xServico:='S'
       else
          xServico:='N';

       if not BUS_CD_C_TRI_REG.IsEmpty then
         begin
           CD_BR_PREVENDA_DETALHE.FieldByName('aliquota').AsString := BUS_CD_C_TRI_REG.FieldByName('NCT_ALIQUOTA_ECF').AsString;
         end;

       CD_BR_PREVENDA_DETALHE.FieldByName('servico').AsString          := xServico;
       CD_BR_PREVENDA_DETALHE.FieldByName('serialproduto').AsString    := '';
       CD_BR_PREVENDA_DETALHE.FieldByName('tipo').AsString             := 'P';
       CD_BR_PREVENDA_DETALHE.FieldByName('cod_prod_tcsmart').AsString := '0';
       CD_BR_PREVENDA_DETALHE.FieldByName('tipo_bloqueado').AsString   := '';
       CD_BR_PREVENDA_DETALHE.FieldByName('flag_sis').AsString         := 'S';
       CD_BR_PREVENDA_DETALHE.FieldByName('flag_aceito').AsString      := 'BR*';
       CD_BR_PREVENDA_DETALHE.Post;

       FAT_CD_M_NFE_ITE.next;
     end;

  FAT_CD_M_NFE.Edit;
  FAT_CD_M_NFE.FieldByName('ID_ABERTURA').AsString   := id_abertura;
  FAT_CD_M_NFE.FieldByName('PREVENDA').AsBoolean     := true;
  FAT_CD_M_NFE.FieldByName('ECF_PREVENDA').AsInteger := ecf_prevenda;
  FAT_CD_M_NFE.FieldByName('MODELO').AsString                 := '2D';
  FAT_CD_M_NFE.FieldByName('ECF_SERIAL_IMPRESSORA').AsString  := ecf_serial;
  FAT_CD_M_NFE.FieldByName('ECF_MARCA_IMPRESSORA').AsString   := ecf_marca;
  FAT_CD_M_NFE.FieldByName('ECF_MODELO_IMPRESSORA').AsString  := ecf_modelo;
  FAT_CD_M_NFE.FieldByName('ECF_CAIXA').AsString              := ecf_caixa;


  FAT_CD_M_NFE.Post;

  try
     Conn  := BuscarConnBanco;
     Vtran := Conn.BeginTransaction;


     if not (CD_BR_PREVENDA.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao gerar a pr-venda .'+#13+
                    CD_BR_PREVENDA.enErro;
        end;

     if not (FAT_CD_M_NFE.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao tentar atualizar a nota fiscal com os dados da pr-venda.'+#13+
                     FAT_CD_M_NFE.enErro;
        end;
     Conn.CommitFreeAndNil(Vtran);
  finally
     Conn.RollbackIncompleteFreeAndNil(Vtran);
  end;

end;



function TSM.enDesfazerPreVenda(id_fiscal: String): String;
var
  CD_BR_SEQ_ID:   TClientDataSet;
  CD_BR_PREVENDA: TClientDataSet;
  CD_BR_PREVENDA_DETALHE,FAT_CD_M_NFE_ITE: TDataSet;
  FAT_CD_M_NFE:   TClientDataSet;
  CAD_CD_C_ITE:   TClientDataSet;
  BUS_CD_C_TRI_REG: TClientDataSet;


  Vtran: TDBXTransaction;
  xSeq, ecf_prevenda: Integer;
  NCM,xServico,xEmitente: String;
  Conn: TSQLConnection;
begin
  RESULT := 'OK';


  // -------------------------------------------------------------------

  // Buscar a nota fiscal
  FAT_CD_M_NFE      := TClientDataSet.Create(self);
  FAT_CD_M_NFE.SetProvider(FAT_DP_M_NFE);
  FAT_CD_M_NFE.Close;
  FAT_CD_M_NFE.Data :=
      FAT_CD_M_NFE.DataRequest(VarArrayOf([12,id_fiscal]));

  // --------------------------------------------------------------------

  CD_BR_PREVENDA  := TClientDataSet.Create(self);
  CD_BR_PREVENDA.SetProvider(DP_BR_PREVENDA);
  CD_BR_PREVENDA.Close;
  CD_BR_PREVENDA.Data :=
       CD_BR_PREVENDA.DataRequest(VarArrayOf([1,FAT_CD_M_NFE.FieldByName('ECF_PREVENDA').AsString]));

  CD_BR_PREVENDA_DETALHE := TDataSetField(CD_BR_PREVENDA.FieldByName('SQ_BR_PREVENDA_DETALHE')).NestedDataSet;


  while CD_BR_PREVENDA_DETALHE.RecordCount>0  do
      CD_BR_PREVENDA_DETALHE.Delete;

  if not CD_BR_PREVENDA.isEmpty then
     CD_BR_PREVENDA.Delete;


  FAT_CD_M_NFE.Edit;
  FAT_CD_M_NFE.FieldByName('ID_ABERTURA').AsString   := '0';
  FAT_CD_M_NFE.FieldByName('PREVENDA').AsBoolean     := false;
  FAT_CD_M_NFE.FieldByName('ECF_PREVENDA').AsString := '';
  FAT_CD_M_NFE.FieldByName('MODELO').AsString                 := '';
  FAT_CD_M_NFE.FieldByName('ECF_SERIAL_IMPRESSORA').AsString  := '';
  FAT_CD_M_NFE.FieldByName('ECF_MARCA_IMPRESSORA').AsString   := '';
  FAT_CD_M_NFE.FieldByName('ECF_MODELO_IMPRESSORA').AsString  := '';
  FAT_CD_M_NFE.FieldByName('ECF_CAIXA').AsString              := '';


  FAT_CD_M_NFE.Post;

  try
     Conn  := BuscarConnBanco;
     Vtran := Conn.BeginTransaction;


     if not (CD_BR_PREVENDA.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao tentar deletar pr-venda.'+#13+
                    CD_BR_PREVENDA.enErro;
        end;

     if not (FAT_CD_M_NFE.ApplyUpdates(0) = 0) then
        begin
          result := 'Erro ao tentar atualizar nota fiscal.'+#13+
                     FAT_CD_M_NFE.enErro;
        end;
     Conn.CommitFreeAndNil(Vtran);
  finally
     Conn.RollbackIncompleteFreeAndNil(Vtran);
  end;

end;




procedure TSM.enGerCupomGerConWin(id_abertura: integer);
var
  FIN_CD_M_CXA: TClientDataSet;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 15/02/2016.
    Este mtodo tem a funo de criar os Cupons Fiscais do GerConWin
    na base de dados enSoft. }

  // Busca os dados do caixa do dia.
  FIN_CD_M_CXA     := TClientDataSet.Create(nil);
  FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
  FIN_CD_M_CXA.Close;
  FIN_CD_M_CXA.Data :=
       FIN_CD_M_CXA.DataRequest(VarArrayOf([0,id_abertura]));

  FAT_RN_M_EST.FatGerNfs(3,FIN_CD_M_CXA,CAD_DP_C_PAR, BUS_DP_C_PAR_CTR,CAD_DP_C_ITE,CAD_DP_C_TME,CAD_DP_C_FPG,
                           FAT_DP_M_NFE,BUS_DP_M_NFE_ITE_INT, BUS_DP_M_NFE_TIT_INT,
                           BUS_DP_M_ORV_ITE_INT,BUS_DP_M_ORV_TIT_INT,BUS_DP_M_ORV_TIT_SER_INT,BUS_DP_M_PED_ITE_INT,BUS_DP_M_PED_TIT_INT,
                           CAD_DP_C_CLI, CAD_DP_C_RAM, BUS_DP_C_TRI_REG,DP_BR_CUPOM_MESTRE,BuscarConnBanco,Self);


end;

procedure TSM.enGerFinCxaBco(Sender: TObject; origem: integer; DataSet: TCustomClientDataSet; cdsTit: TDataSet;
                              FIN_CD_M_CTA: TClientDataSet; IdAbertura: integer);
var
  BUS_CD_C_PAR_CTR,BUS_CD_C_TIF, BUS_CD_C_CTC, FIN_CD_M_CXA,CAD_CD_C_FPG,CAD_CD_C_CTC: TClientDataSet;

  xIdFormaPag,xIdPlano,xNumero,xSerieNF: String;
  xVlrTitulo: Currency;
  xIdNfeTit: integer;

begin
   // Origem
   {
      0 - Nota fiscal de sada
      1 - Abertura de caixa
      2 - Pequena Despesas
      3 - Baixa de cartao de Crdito
      4 - Movimento de Caixa/Movimento Bancrio
      5 - Controle de Nota de Crdito
      6 - Cancelamento de Nota Fiscal do dia Anterior
      7 - Lanamento de Movimento Funcionrio
      8 - Prestao de Contas
   }

   if Origem = 0 then
      begin
        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

        // A Instncia est sendo criada pelo mtodo que o invoca
        //FIN_CD_M_CTA := TClientDataSet.Create(nil);
        FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA.Close;
        FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([94,DataSet.FieldByName('ID_FISCAL').AsString]));
        if not (FIN_CD_M_CTA.IsEmpty) then
           begin
             FIN_CD_M_CTA.First;
             while not (FIN_CD_M_CTA.Eof) do
               begin
                 FIN_CD_M_CTA.Delete;
               end;
           end;
        CAD_CD_C_FPG     :=TClientDataSet.Create(nil);

        xNumero     := DataSet.FieldByName('NUMERO').AsString;
        xSerieNF    := trim(dataset.FieldByName('SERIE').AsString);
        DataSet.Next;
        if DataSet.FieldByName('NUMERO').AsString <> '' then
           xNumero     := DataSet.FieldByName('NUMERO').AsString;

         //Coloquei esse trecho para corrgir o problema do encerradmento do pedido no controle de caixa
         //pois estava pegando o valor serie antes da alterao para valor 'X', com isso no entrava
         //na estrutura if para serie ='X'. Responsavel:Luan.Data:03/05/2016
        if TRIM(DataSet.FieldByName('SERIE').AsString) <> '' then
           xSerieNF    := trim(dataset.FieldByName('SERIE').AsString);

        DataSet.Prior;

        cdsTit.First;
        while not (cdsTit.Eof)  do
           begin
             if not (cdsTit.UpdateStatus in [usDeleted]) then  // Se o registro no foi apagado modificaes
                begin
                  xIdFormaPag := cdsTit.FieldByName('ID_FORMA_PAG').AsString;
                  xIdPlano    := cdsTit.FieldByName('ID_PLANO').AsString;
                  xVlrTitulo  := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                  xIdNfeTit   := cdsTit.FieldByName('ID_NFE_TIT').AsInteger;

                  CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                  CAD_CD_C_FPG.Data :=
                     CAD_CD_C_FPG.DataRequest(VarArrayOf([0,xIdFormaPag]));


                  if (dataset.FieldByName('ID_ORDEM').AsInteger = 0) and
                     (dataset.FieldByName('ID_PEDIDO_VENDA').AsInteger = 0) and
                     (dataset.FieldByName('ID_ORS').AsInteger = 0)  then // se no for de nota de ordem de servio ,nem de pedido de venda e nem Ordem de Faturamento;
                     begin
                        if cdsTit.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                           begin
                             cdsTit.Next;
                             if cdsTit.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                                begin
                                   if cdsTit.FieldByName('ID_FORMA_PAG').AsString<>'' then
                                      xIdFormaPag   := cdsTit.FieldByName('ID_FORMA_PAG').AsString;
                                   if cdsTit.FieldByName('ID_PLANO').AsString<>'' then
                                      xIdPlano   := cdsTit.FieldByName('ID_PLANO').AsString;
                                   if cdsTit.FieldByName('VLR_TITULO').AsCurrency>0 then
                                      xVlrTitulo := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                                 end;

                             CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                             CAD_CD_C_FPG.Data :=
                                 CAD_CD_C_FPG.DataRequest(VarArrayOf([0,xIdFormaPag]));
                           end;
                     end;

                 if xSerieNF = 'X' then
                     begin
                        if cdsTit.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                           begin
                             cdsTit.Next;
                             if cdsTit.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                                begin
                                   if cdsTit.FieldByName('ID_FORMA_PAG').AsString<>'' then
                                      xIdFormaPag   := cdsTit.FieldByName('ID_FORMA_PAG').AsString;
                                   if cdsTit.FieldByName('ID_PLANO').AsString<>'' then
                                      xIdPlano   := cdsTit.FieldByName('ID_PLANO').AsString;
                                   if cdsTit.FieldByName('VLR_TITULO').AsCurrency>0 then
                                      xVlrTitulo := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                                 end;

                             CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                             CAD_CD_C_FPG.Data :=
                                 CAD_CD_C_FPG.DataRequest(VarArrayOf([0,xIdFormaPag]));
                           end;
                     end;

                  if (not (CAD_CD_C_FPG.FieldByName('doc_impresso').AsInteger in [0,7])) and
                          (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean) then
                     begin



                       FIN_CD_M_CTA.Insert;
                       // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                       FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        :=  self.enValorChave('FIN_TB_M_CTA');
                           //DmApoio.enBusValorChave('FIN_TB_M_CTA');
                       FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
                       FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                       FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                       FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_emissao').AsDateTime;
                       FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_emissao').AsDateTime;
                       FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := cdsTit.FieldByName('id_nfe_tit').AsInteger;
                       FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' + IntToStr(xIdNfeTit) + ', da NF de sada: ' +
                                                                                   xNumero;
                       FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := xVlrTitulo;
                       FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 5; // 5-Nota Fiscal de Sada
                       FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                       FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := CAD_CD_C_FPG.FieldByName('id_tipo_financeiro').AsInteger;
                       FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_FPG.FieldByName('INT_NATUREZATIF').AsInteger;
                       FIN_CD_M_CTA.FieldByName('id_plano').AsString            := xIdPlano;
                       FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                       FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := DataSet.FieldByName('ID_FISCAL').AsInteger;
                       // Corresponde ao mesmo id_titulo do (FIN_TB_M_REC) criado
                       FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := xIdNfeTit;
                       // -------------------------------------------------------
                       FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                       FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                       FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                       FIN_CD_M_CTA.Post;
                     end;
                  CAD_CD_C_FPG.Close;
                end;
             cdsTit.Next;

             // O Applyupdate do FIN_CD_M_CTA,  dado no mtodo principal ( O que chamdou este ).
           end;

        FIN_CD_M_CXA.Free;
        CAD_CD_C_FPG.Free;
      end;

   if Origem = 1 then
      begin
        if (dataset.UpdateStatus in [usInserted]) then  // Se o registro est sendo inserido
           begin
             if dataset.FieldByName('vlr_suprimento').AsCurrency > 0 then
                begin
                  BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
                  BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
                  BUS_CD_C_PAR_CTR.Close;
                  BUS_CD_C_PAR_CTR.Data :=
                      BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

                  BUS_CD_C_TIF := TClientDataSet.Create(nil);
                  BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                  BUS_CD_C_TIF.Close;
                  BUS_CD_C_TIF.Data :=
                      BUS_CD_C_TIF.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('cxa_id_tif_suprim').AsString]));

                  BUS_CD_C_CTC := TClientDataSet.Create(nil);
                  BUS_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
                  BUS_CD_C_CTC.Close;
                  BUS_CD_C_CTC.Data :=
                      BUS_CD_C_CTC.DataRequest(VarArrayOf([0,DataSet.FieldByName('id_conta').AsString]));

                  FIN_CD_M_CTA := TClientDataSet.Create(nil);
                  FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
                  FIN_CD_M_CTA.Close;
                  FIN_CD_M_CTA.Data :=
                       FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));

                  FIN_CD_M_CTA.Insert;
                  // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                  FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := DataSet.FieldByName('ID_ABERTURA').AsInteger;
                  FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                  FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := BUS_CD_C_CTC.FieldByName('tipo').AsInteger; //0-caixa 1-banco
                  FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
                  FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_abertura').AsDateTime;
                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_abertura').AsDateTime;
                  FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := DataSet.FieldByName('ID_ABERTURA').AsInteger;
                  FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Lanamento ref. suprimento da abertura do caixa: ' + DataSet.FieldByName('ID_ABERTURA').AsString;
                  FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_suprimento').AsCurrency;
                  FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 7; // 7-Abertura de caixa
                  FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
                  FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('cxa_id_tif_suprim').AsInteger;

                  FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('cxa_id_plano_suprim').AsString;
                  FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                  FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
                  FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                  FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                  FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                  FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
                  FIN_CD_M_CTA.Post;


                  if FIN_CD_M_CTA <> nil then
                     if not FIN_CD_M_CTA.IsEmpty then
                        if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
                           abort;


                  BUS_CD_C_PAR_CTR.Free;
                  BUS_CD_C_TIF.Free;
                  BUS_CD_C_CTC.Free;
                  FIN_CD_M_CTA.Free;
                end;
           end;
      end;

   if Origem = 2 then
      begin
        // A Instncia est sendo criada pelo mtodo que o invoca
        //FIN_CD_M_CTA := TClientDataSet.Create(nil);
        FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA.Close;
        FIN_CD_M_CTA.Data :=
             FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));


        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));


        CAD_CD_C_FPG     :=TClientDataSet.Create(nil);
        CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
        CAD_CD_C_FPG.Data :=
                CAD_CD_C_FPG.DataRequest(VarArrayOf([0,dataset.FieldByName('ID_FORMA_PAG').AsString]));



        if (CAD_CD_C_FPG.FieldByName('doc_impresso').AsInteger = 5) and
           (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean) then
           begin
             FIN_CD_M_CTA.Insert;
             // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
             FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
             FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
             FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
             FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
             FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_emissao').AsDateTime;
             FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_emissao').AsDateTime;
             FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_titulo').AsInteger;
             FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' + dataset.FieldByName('id_titulo').AsString + ', de pequena despesas do caixa(abertura):' +
                                                                         IntToStr(IdAbertura);
             FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_parcela').AsCurrency;
             FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 8; // Controle de Caixa
             FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
             FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := CAD_CD_C_FPG.FieldByName('id_tipo_financeiro').AsInteger;
             FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_FPG.FieldByName('INT_NATUREZATIF').AsInteger;
             FIN_CD_M_CTA.FieldByName('id_plano').AsString            := dataset.FieldByName('ID_PLANO').AsString;
             FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
             FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
             // Corresponde ao mesmo id_titulo do (FIN_TB_M_REC) criado
             FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
             // -------------------------------------------------------
             FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
             FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
             FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
             FIN_CD_M_CTA.Post;
           end;

        FIN_CD_M_CXA.Free;
        CAD_CD_C_FPG.Free;
      end;

    if Origem = 3 then
      begin
       // FIN_CD_M_CTA := TClientDataSet.Create(nil);
       // FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
       // FIN_CD_M_CTA.Close;
      //  FIN_CD_M_CTA.Data :=
           //  FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));

        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
         BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
         BUS_CD_C_PAR_CTR.Close;
         BUS_CD_C_PAR_CTR.Data :=
            BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

        BUS_CD_C_CTC := TClientDataSet.Create(nil);
        BUS_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
        BUS_CD_C_CTC.Data :=
               BUS_CD_C_CTC.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_CONTA').AsString]));

        CAD_CD_C_FPG := TClientDataSet.Create(nil);
        CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
        CAD_CD_C_FPG.Data :=
               CAD_CD_C_FPG.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_FORMA_PAG').AsString]));
        if DataSet.FieldByName('VLR_BRUTO').AsCurrency >0 then
           begin
               FIN_CD_M_CTA.Insert;
               // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
               FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
               FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
               FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
               FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := BUS_CD_C_CTC.FieldByName('TIPO').AsInteger;   //0-caixa 1-banco
               FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_baixa').AsDateTime;
               FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_baixa').AsDateTime;
               FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_cbx').AsInteger;
               FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. a Baixa de Carto de Crdito: ' + DataSet.FieldByName('id_cbx').AsString;
               FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_bruto').AsCurrency;
               FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 10; // 10-Baixa de Cartao de Crdito
               FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
               FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_PLANO').AsString;
               FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_TIPO_FINANCEIRO').AsInteger;
               FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := 1;
               FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;

           FIN_CD_M_CTA.FieldByName('id_cbx').AsInteger       := dataset.FieldByName('id_cbx').AsInteger;
           FIN_CD_M_CTA.Post;
           end;

        if DataSet.FieldByName('VLR_DESCONTO_OPE').AsCurrency >0 then
           begin
             FIN_CD_M_CTA.Insert;
             // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
             FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := sm.enValorChave('FIN_TB_M_CTA');
             FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
             FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
             FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := BUS_CD_C_CTC.FieldByName('TIPO').AsInteger;   //0-caixa 1-banco
             FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_baixa').AsDateTime;
             FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_baixa').AsDateTime;
             FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_cbx').AsInteger;
             FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. a Baixa de Carto de Crdito: ' + DataSet.FieldByName('id_cbx').AsString;
             FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_desconto_ope').AsCurrency;
             FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 10; // 10-Baixa de Cartao de Crdito
             FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
             FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_PLANO_DESC_OPE').AsString;
             FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_TIPO_FINANCEIRO_DESC').AsInteger;
             FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := 0;
             FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;

             FIN_CD_M_CTA.FieldByName('id_cbx').AsInteger       := dataset.FieldByName('id_cbx').AsInteger;
             FIN_CD_M_CTA.Post;
           end;

        if DataSet.FieldByName('VLR_DESCONTO_ANTEC').AsCurrency >0 then
           begin
            FIN_CD_M_CTA.Insert;
            // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
            FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
            FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := 0;
            FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
            FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := BUS_CD_C_CTC.FieldByName('TIPO').AsInteger;   //0-caixa 1-banco
            FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_baixa').AsDateTime;
            FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_baixa').AsDateTime;
            FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_cbx').AsInteger;
            FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. a Baixa de Carto de Crdito: ' + DataSet.FieldByName('id_cbx').AsString;
            FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_desconto_antec').AsCurrency;
            FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 10; // 10-Baixa de Cartao de Crdito
            FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
            FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_PLANO_DESC_ANTEC').AsString;
            FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_TIPO_FINANCEIRO_DESC').AsInteger;
            FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := 0;
            FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;

            FIN_CD_M_CTA.FieldByName('id_cbx').AsInteger       := dataset.FieldByName('id_cbx').AsInteger;
            FIN_CD_M_CTA.Post;
           end;
      end;

    if Origem = 4 then
        begin
          CAD_CD_C_CTC:= TClientDataSet.Create(nil);
          CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
          CAD_CD_C_CTC.Close;
          CAD_CD_C_CTC.Data :=
          CAD_CD_C_CTC.DataRequest(VarArrayOf([0,dataset.FieldByName('exp_id_conta').AsString]));

          BUS_CD_C_TIF := TClientDataSet.Create(nil);
          BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
          BUS_CD_C_TIF.Close;
          BUS_CD_C_TIF.Data :=
          BUS_CD_C_TIF.DataRequest(VarArrayOf([0,dataset.FieldByName('exp_id_tipo_financeiro').AsString]));

          FIN_CD_M_CTA.Insert;
          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
          FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
          FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('num_doc').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
          FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := dataset.FieldBYName('tipo_lancamento').AsInteger;
          FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
          FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_lancamento').AsDateTime;
          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_movimento').AsDateTime;

          FIN_CD_M_CTA.FieldByName('historico').AsString           := dataset.FieldByName('historico').AsString;
          FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_lancamento').AsCurrency;
          FIN_CD_M_CTA.FieldByName('origem').AsInteger             := dataset.FieldByName('origem').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('exp_id_conta').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := dataset.FieldByName('exp_id_tipo_financeiro').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_plano').AsString            := dataset.FieldByName('exp_id_plano').AsString;
          FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
          FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := dataset.FieldByName('id_controle').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
          FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
          FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;

          if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
              begin
                  FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                  FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                  FIN_CD_M_CXA.Close;
                  FIN_CD_M_CXA.Data :=
                  FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('exp_id_conta').AsString]));
                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                  FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 0;
              end;

          FIN_CD_M_CTA.Post;
          CAD_CD_C_CTC.Free;
          BUS_CD_C_TIF.Free;
        end;


     if Origem = 5 then  //Controle de Credito do Cliente (FIN_FM_M_RCR)
        begin
          BUS_CD_C_CTC := tClientDataSet.Create(nil);
          BUS_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
          BUS_CD_C_CTC.Close;
          BUS_CD_C_CTC.Data :=
          BUS_CD_C_CTC.DataRequest(VarArrayOf([0,dataset.FieldByName('id_conta').AsString]));

          BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
          BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
          BUS_CD_C_PAR_CTR.Close;
          BUS_CD_C_PAR_CTR.Data :=
          BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataset.FieldByName('id_empresa').AsString]));

          FIN_CD_M_CTA.Insert;
          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
          FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
          FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_credito').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;

          if (BUS_CD_C_CTC.FieldByName('TIPO').AsInteger = 0) then
            begin
              FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 0;//Caixa
            end;
          if (BUS_CD_C_CTC.FieldByName('TIPO').AsInteger = 1) then
            begin
              FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := 1;//Banco
            end;

          FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := dataset.FieldByName('deb_cre').AsInteger;
          FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_credito').AsDateTime;
          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_credito').AsDateTime;

          FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. Controle de Crdito: '+dataset.FieldByName('id_credito').AsString+', do Cliente: '+
                                                                       dataset.FieldByName('int_nomecli').AsString;
          FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_credito').AsCurrency;
          FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 12;//Controle de Credito do Cliente
          FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIPO_FINANCEIRO').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_PLANO').AsString;
          FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
          FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
          FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
          FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := dataset.FieldByName('id_credito').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := dataset.FieldByName('id_abertura').AsInteger;
          FIN_CD_M_CTA.Post;

        end;

   if Origem = 6 then // 6 - Cancelamento de Nota Fiscal do dia Anterior
      begin
        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

        CAD_CD_C_FPG     :=TClientDataSet.Create(nil);

        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
        BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
        BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([dataset.FieldByName('id_empresa').AsString]));

        BUS_CD_C_TIF := TClientDataSet.Create(nil);
        BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
        BUS_CD_C_TIF.Close;
        BUS_CD_C_TIF.Data :=
        BUS_CD_C_TIF.DataRequest(VarArrayOf([0,BUS_CD_C_PAR_CTR.FieldByName('cxa_id_tipo_fin_canc_ant').AsInteger]));

        cdsTit.First;
        while not (cdsTit.Eof)  do
           begin
              CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                 CAD_CD_C_FPG.Data :=
                    CAD_CD_C_FPG.DataRequest(VarArrayOf([0,cdsTit.FieldByName('id_forma_pag').AsString]));

              if (not (CAD_CD_C_FPG.FieldByName('doc_impresso').AsInteger in [0,7])) and
                      (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean) then
                 begin
                    FIN_CD_M_CTA.Insert;
                    // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                    FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
                    FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
                    FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                    FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                    FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                    FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                    FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := cdsTit.FieldByName('id_nfe_tit').AsInteger;
                    FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao cancelamento da nota fiscal: ' + dataset.FieldByName('numero').AsString + ', do dia anterior.';
                    FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := cdsTit.FieldByName('vlr_titulo').AsCurrency;
                    FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 12; // Cancelamento NF dia Anterior
                    FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                    FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := BUS_CD_C_PAR_CTR.FieldByName('cxa_id_tipo_fin_canc_ant').AsInteger;
                    FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
                    FIN_CD_M_CTA.FieldByName('id_plano').AsString            := BUS_CD_C_PAR_CTR.FieldByName('cxa_id_plano_canc_ant').AsString;
                    FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
                    FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := dataset.FieldByName('id_fiscal').AsInteger;

                    FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
                    // -------------------------------------------------------
                    FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
                    FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
                    FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;

                    FIN_CD_M_CTA.Post;
                 end;
              cdsTit.Next;
           end;

        FreeAndNil(FIN_CD_M_CXA);
        FreeAndNil(BUS_CD_C_TIF);
        FreeAndNil(BUS_CD_C_PAR_CTR);
        FreeAndNil(CAD_CD_C_FPG);
      end;

   if Origem = 7 then // 7 - Lancamento de Movimento do Funcionario
      begin
          CAD_CD_C_CTC:= TClientDataSet.Create(nil);
          CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
          CAD_CD_C_CTC.Close;
          CAD_CD_C_CTC.Data :=
          CAD_CD_C_CTC.DataRequest(VarArrayOf([0,dataset.FieldByName('id_conta').AsString]));

          BUS_CD_C_TIF := TClientDataSet.Create(nil);
          BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
          BUS_CD_C_TIF.Close;
          BUS_CD_C_TIF.Data :=
          BUS_CD_C_TIF.DataRequest(VarArrayOf([0,dataset.FieldByName('id_tipo_financeiro').AsString]));

          FIN_CD_M_CTA.Insert;
          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
          FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
          FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_lmf').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
          FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
          FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
          FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_movimento').AsDateTime;
          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_movimento').AsDateTime;

          FIN_CD_M_CTA.FieldByName('historico').AsString           := dataset.FieldByName('historico').AsString;
          FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := dataset.FieldByName('vlr_movimento').AsCurrency;
          FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 14;
          FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := dataset.FieldByName('id_conta').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := dataset.FieldByName('id_tipo_financeiro').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_plano').AsString            := dataset.FieldByName('id_plano').AsString;
          FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
          FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
          FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
          FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
          FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_lmf').AsInteger             := dataset.FieldByName('id_lmf').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
          FIN_CD_M_CTA.FieldByName('id_obra').AsInteger            := dataset.FieldByName('id_obra').AsInteger;
          if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
              begin
                  FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                  FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                  FIN_CD_M_CXA.Close;
                  FIN_CD_M_CXA.Data :=
                  FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,dataset.FieldByName('id_conta').AsString]));
                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
              end;

          FIN_CD_M_CTA.Post;
          CAD_CD_C_CTC.Free;
          BUS_CD_C_TIF.Free;
      end;

    if Origem = 8 then // 7 - Prestacao de Contas
      begin
          CAD_CD_C_CTC:= TClientDataSet.Create(nil);
          CAD_CD_C_CTC.SetProvider(CAD_DP_C_CTC);
          CAD_CD_C_CTC.Close;
          CAD_CD_C_CTC.Data :=
          CAD_CD_C_CTC.DataRequest(VarArrayOf([0,cdsTit.FieldByName('id_conta').AsString]));

          BUS_CD_C_TIF := TClientDataSet.Create(nil);
          BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
          BUS_CD_C_TIF.Close;
          BUS_CD_C_TIF.Data :=
          BUS_CD_C_TIF.DataRequest(VarArrayOf([0,cdsTit.FieldByName('id_tipo_financeiro').AsString]));

          FIN_CD_M_CTA.Insert;
          // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
          FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
          FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
          FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
          FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
          FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
          FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

          FIN_CD_M_CTA.FieldByName('historico').AsString           := cdsTit.FieldByName('historico').AsString;
          FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := cdsTit.FieldByName('vlr_prestacao').AsCurrency;
          FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
          FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := cdsTit.FieldByName('id_conta').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := cdsTit.FieldByName('id_tipo_financeiro').AsInteger;

          FIN_CD_M_CTA.FieldByName('id_plano').AsString            := cdsTit.FieldByName('id_plano').AsString;
          FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
          FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
          FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
          FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
          FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
          FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cdsTit.FieldByName('id_sequencia').AsInteger;
          FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;

          if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
              begin
                  FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                  FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                  FIN_CD_M_CXA.Close;
                  FIN_CD_M_CXA.Data :=
                  FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,cdsTit.FieldByName('id_conta').AsString]));
                  FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                  FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
              end;

          FIN_CD_M_CTA.Post;


          if cdsTit.FieldByName('id_tipo_financeiro_cp').AsString<>'0'  then
            begin
              BUS_CD_C_TIF := TClientDataSet.Create(nil);
              BUS_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
              BUS_CD_C_TIF.Close;
              BUS_CD_C_TIF.Data :=
              BUS_CD_C_TIF.DataRequest(VarArrayOf([0,cdsTit.FieldByName('id_tipo_financeiro_cp').AsString]));

              FIN_CD_M_CTA.Insert;
              // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
              FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
              FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := dataset.FieldByName('id_prc').AsInteger;

              FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
              FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := CAD_CD_C_CTC.FieldBYName('tipo').AsInteger;
              FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := BUS_CD_C_TIF.FieldByName('natureza').AsInteger;
              FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := dataset.FieldByName('dta_prestacao').AsDateTime;
              FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := dataset.FieldByName('dta_prestacao').AsDateTime;

              FIN_CD_M_CTA.FieldByName('historico').AsString           := cdsTit.FieldByName('historico').AsString;
              FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := cdsTit.FieldByName('vlr_prestacao').AsCurrency;
              FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 15;//Prestacao de Contas
              FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := cdsTit.FieldByName('id_conta').AsInteger;
              FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := cdsTit.FieldByName('id_tipo_financeiro_cp').AsInteger;

              FIN_CD_M_CTA.FieldByName('id_plano').AsString            := cdsTit.FieldByName('id_plano').AsString;
              FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
              FIN_CD_M_CTA.FieldByName('exp_id_controle').AsInteger    := 0;
              FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
              FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
              FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
              FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
              FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
              FIN_CD_M_CTA.FieldByName('id_prc').AsInteger             := dataset.FieldByName('id_prc').AsInteger;
              FIN_CD_M_CTA.FieldByName('id_prc_det').AsInteger         := cdsTit.FieldByName('id_sequencia').AsInteger;
              FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;

              if (CAD_CD_C_CTC.FieldByName('tipo').AsInteger = 0)   then
                  begin
                      FIN_CD_M_CXA:= TClientDataSet.Create(nil);
                      FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
                      FIN_CD_M_CXA.Close;
                      FIN_CD_M_CXA.Data :=
                      FIN_CD_M_CXA.DataRequest(VarArrayOf([95,dataset.FieldByName('ID_EMPRESA').AsString,cdsTit.FieldByName('id_conta').AsString]));
                      FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := FIN_CD_M_CXA.FieldByName('id_abertura').AsInteger;
                      FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                  end;

              FIN_CD_M_CTA.Post;
            end;


          CAD_CD_C_CTC.Free;
          BUS_CD_C_TIF.Free;

      end;

end;


procedure TSM.enGerFinPcr(Sender: TObject; origem: integer;
  DataSet: TCustomClientDataSet;
  var FIN_CD_M_PCR: TClientDataSet);
var
   vlrNota: Currency;
   numeroNf: String;
   DtaCredito: TDate;
begin
  {  Origem
     0 - Devoluo do Fornecedor
  }

  try
  if (origem = 0) then
    begin
     FIN_CD_M_PCR := TClientDataSet.Create(nil);
     FIN_CD_M_PCR.SetProvider(FIN_DP_M_PCR);
     FIN_CD_M_PCR.Close;
     FIN_CD_M_PCR.Data :=
             FIN_CD_M_PCR.DataRequest(VarArrayOf([92,dataset.FieldByName('id_fiscal').AsInteger]));


     while (FIN_CD_M_PCR.RecordCount>0) do
       begin
         FIN_CD_M_PCR.Delete;
       end;


     if not (DataSet.UpdateStatus in [usDeleted]) then  // Se o registro pai no foi deletado
        begin
          vlrNota    := dataset.FieldByName('VLR_LIQUIDO').AsCurrency;
          numeroNf   := dataset.FieldByName('NUMERO').AsString;
          DtaCredito := dataset.FieldByName('dta_documento').AsDateTime;

          if (DataSet.UpdateStatus in [usUnmodified]) then  // Se o registro pai foi modificado
             begin
               DataSet.Next;
               if (DataSet.UpdateStatus in [usmodified]) then  // Se o registro pai foi modificado
                   begin
                     if dataset.FieldByName('VLR_LIQUIDO').AsCurrency > 0 then
                        begin
                          vlrNota  := dataset.FieldByName('VLR_LIQUIDO').AsCurrency;
                        end;

                     if dataset.FieldByName('NUMERO').AsFloat > 0 then
                        begin
                          numeroNf  := dataset.FieldByName('NUMERO').AsString;
                        end;

                     if dataset.FieldByName('dta_documento').text <> '' then
                        begin
                          DtaCredito := dataset.FieldByName('dta_documento').AsDateTime;
                        end;
                     dataset.Prior;
                   end;
             end;

           FIN_CD_M_PCR.Insert;
           FIN_CD_M_PCR.FieldByName('ID_EMPRESA').AsInteger     := dataset.FieldByName('ID_EMPRESA').AsInteger;
           // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
           FIN_CD_M_PCR.FieldByName('ID_CREDITO').AsInteger     := self.enValorChave('FIN_TB_M_PCR');
           FIN_CD_M_PCR.FieldByName('ID_FORNECEDOR').AsInteger  := dataset.FieldByName('ID_EMITENTE').AsInteger;
           FIN_CD_M_PCR.FieldByName('ID_BAIXA').AsInteger       := 0;
           FIN_CD_M_PCR.FieldByName('ID_TITULO').AsInteger      := 0;
           FIN_CD_M_PCR.FieldByName('DTA_CREDITO').AsDateTime   :=  DtaCredito;
           FIN_CD_M_PCR.FieldByName('ORIGEM').AsInteger         := 2;//Devoluo do Fornecedor
           FIN_CD_M_PCR.FieldByName('NUM_DOCUMENTO').AsString   := numeroNf;
           FIN_CD_M_PCR.FieldByName('VLR_CREDITO').AsCurrency   := vlrNota;
           FIN_CD_M_PCR.FieldByName('VLR_SALDO').AsCurrency     := 0;
           FIN_CD_M_PCR.FieldByName('HISTORICO').AsString       :=
                           'Crdito gerado pela nota fiscal de dev. n ' + numeroNf;
           FIN_CD_M_PCR.FieldByName('DEB_CRE').AsInteger        := 1;
           FIN_CD_M_PCR.FieldByName('ID_FISCAL').AsInteger      := dataset.FieldByName('ID_FISCAL').AsInteger;
           FIN_CD_M_PCR.Post;
       end;
    end;


   if FIN_CD_M_PCR.ChangeCount > 0 then
      if not (FIN_CD_M_PCR.ApplyUpdates(0) = 0) then
        begin
         raise Exception.Create('Erro ao tentar atualizar crdito do fornecedor.');
         abort;
        end;
  finally

  end;
end;



procedure TSM.enGerFinRcr(Sender: TObject; origem: integer;
  DataSet: TCustomClientDataSet; var cdsTit: TDataSet;
  var FIN_CD_M_RCR,FIN_CD_M_CTA_RCR: TClientDataSet; IdAbertura: Integer);
var
   FIN_CD_M_CXA,CAD_CD_C_FPG,BUS_CD_C_PAR_CTR, CAD_CD_C_TIF: TClientDataSet;
   xIdTitulo,xIdFormaPag: integer;
   xIdPlano: String;
   xVlrTitulo: Currency;
   xIdCreditos: String;
   xRcrIdTifDeb, xRcrIdTifCre: Integer;
   xRcrIdPlanoSef: String;
   RcrIdCondPgtoNfDev,RcrIdFormapgtoNfDev :integer;
   vlrNota: Currency;
   numeroNf: String;
   DtaCredito: TDate;

begin
  { TODO -oMaxsuel -cCriao :
    Criado em 01/04/2015;
    Este mtodo tem a funo gerar um registro de Nota de Crdito seja Dbito ou crdito.
  }


  { origem:  0 - Nota Fiscal de Sada
             1 - Nota Fiscal de Devoluo de Venda

  }

  if origem = 0 then   // 0 - Nota Fiscal de Sada
     begin
        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
        BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Data :=
             BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

        xRcrIdTifDeb      := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_DEB').AsInteger;
        xRcrIdTifCre      := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_TIF_CRE').AsInteger;
        xRcrIdPlanoSef    := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_PLANO_SEF').AsString;

        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

        FIN_CD_M_RCR := TClientDataSet.Create(nil);
        FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
        FIN_CD_M_RCR.Close;
        FIN_CD_M_RCR.Data :=
            FIN_CD_M_RCR.DataRequest(VarArrayOf([90,dataset.FieldByName('id_fiscal').AsInteger]));

        xIdCreditos := '';

        FIN_CD_M_RCR.First;
        while not (FIN_CD_M_RCR.Eof)  do
            begin
              if xIdCreditos <> '' then
                 begin
                   xIdCreditos :=
                   xIdCreditos + ',' +''''+ FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
                 end;
              if xIdCreditos = '' then
                 begin
                   xIdCreditos :=
                   xIdCreditos +''''+FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString+'''';
                 end;
              FIN_CD_M_RCR.Next;
            end;

        if not (FIN_CD_M_RCR.IsEmpty) then
           begin
             FIN_CD_M_RCR.First;
             while not (FIN_CD_M_RCR.Eof) do
                begin
                  FIN_CD_M_RCR.Delete;
                end;
           end;


        FIN_CD_M_CTA_RCR := TClientDataSet.Create(nil);
        FIN_CD_M_CTA_RCR.SetProvider(FIN_DP_M_CTA);
        FIN_CD_M_CTA_RCR.Close;

        if trim(xIdCreditos) <> '' then
           begin
             FIN_CD_M_CTA_RCR.Data :=
                FIN_CD_M_CTA_RCR.DataRequest(VarArrayOf([95,xIdCreditos]));
             if not (FIN_CD_M_CTA_RCR.IsEmpty) then
                begin
                  FIN_CD_M_CTA_RCR.First;
                  while not (FIN_CD_M_CTA_RCR.Eof) do
                     begin
                       FIN_CD_M_CTA_RCR.Delete;
                     end;
                end;
           end
        else
           begin
             FIN_CD_M_CTA_RCR.Data :=
                FIN_CD_M_CTA_RCR.DataRequest(VarArrayOf([0,'']));
           end;


        CAD_CD_C_TIF := TClientDataSet.Create(nil);


        CAD_CD_C_FPG := TClientDataSet.Create(nil);

        cdsTit.First;
        while not (cdsTit.Eof)  do
           begin
             if not (cdsTit.UpdateStatus in [usDeleted]) then  // Se o registro teve modificaes
                begin
                   xIdTitulo   := cdsTit.FieldByName('ID_NFE_TIT').AsInteger;
                   xIdPlano    := cdsTit.FieldByName('ID_PLANO').AsString;
                   xVlrTitulo  := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                   xIdFormaPag := cdsTit.FieldByName('ID_FORMA_PAG').AsInteger;

                   if dataset.FieldByName('IND_EMITENTE').AsInteger = 1 then //  Nota de Terceiros
                      begin
                         if cdsTit.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                            begin
                              cdsTit.Next;
                              if cdsTit.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                                 begin
                                    if cdsTit.FieldByName('ID_FORMA_PAG').AsCurrency>0 then
                                       xIdFormaPag := cdsTit.FieldByName('ID_FORMA_PAG').AsInteger;
                                    if cdsTit.FieldByName('ID_PLANO').AsString<>'' then
                                       xIdPlano   := cdsTit.FieldByName('ID_PLANO').AsString;
                                    if cdsTit.FieldByName('VLR_TITULO').AsCurrency>0 then
                                       xVlrTitulo := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                                  end;
                            end;
                      end;

                   CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                   CAD_CD_C_FPG.Data :=
                       CAD_CD_C_FPG.DataRequest(VarArrayOf([0,xIdFormaPag]));

                   if (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 7)   then // Crdito
                      begin
                        FIN_CD_M_RCR.Insert;
                        FIN_CD_M_RCR.FieldByName('ID_EMPRESA').AsInteger     := dataset.FieldByName('ID_EMPRESA').AsInteger;
                        // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                        FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger     := self.enValorChave('FIN_TB_M_RCR');
                        FIN_CD_M_RCR.FieldByName('ID_CLIENTE').AsInteger     := dataset.FieldByName('ID_EMITENTE').AsInteger;
                        FIN_CD_M_RCR.FieldByName('ID_TITULO').AsInteger      := xIdTitulo;
                        FIN_CD_M_RCR.FieldByName('DTA_CREDITO').AsDateTime   := FIN_CD_M_CXA.FieldByName('DTA_ABERTURA').AsDateTime;
                        FIN_CD_M_RCR.FieldByName('ORIGEM').AsInteger         := 3;
                        FIN_CD_M_RCR.FieldByName('NUM_DOCUMENTO').AsString   := cdsTit.FieldByName('num_parcela').AsString;
                        FIN_CD_M_RCR.FieldByName('VLR_CREDITO').AsCurrency   := xVlrTitulo;
                        FIN_CD_M_RCR.FieldByName('HISTORICO').AsString       :=
                             'Crdito utilizado pela nota fiscal de n ' + dataset.FieldByName('NUMERO').AsString;
                        FIN_CD_M_RCR.FieldByName('DEB_CRE').AsInteger        := 0;
                        FIN_CD_M_RCR.FieldByName('ID_FISCAL').AsInteger     := dataset.FieldByName('ID_FISCAL').AsInteger;
                        FIN_CD_M_RCR.Post;

                        // Ao ser utilizado o crdito do cliente o sistema tem que criar dois registroa
                        // na tabela de movimento de caixa (FIN_TB_M_CTA), um dbito e um crdito.

                        // Inserindo o movimento de dbito
                        FIN_CD_M_CTA_RCR.Insert;
                        // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                        FIN_CD_M_CTA_RCR.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
                        FIN_CD_M_CTA_RCR.FieldByName('id_credito').AsInteger         := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('id_abertura').AsInteger        := IdAbertura;
                        FIN_CD_M_CTA_RCR.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                        FIN_CD_M_CTA_RCR.FieldByName('dta_lancamento').AsDateTime    := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                        FIN_CD_M_CTA_RCR.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                        FIN_CD_M_CTA_RCR.FieldByName('num_doc').AsInteger            := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('historico').AsString           := 'Ref. a utilizao da nota de crdito: ' +
                                                                                         FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString;
                        FIN_CD_M_CTA_RCR.FieldByName('vlr_lancamento').AsCurrency    := xVlrTitulo;
                        FIN_CD_M_CTA_RCR.FieldByName('origem').AsInteger             := 6; // 6-Nota de Crdito;
                        FIN_CD_M_CTA_RCR.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('id_tipo_financeiro').AsInteger := xRcrIdTifDeb;

                        CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                        CAD_CD_C_TIF.Data :=
                            CAD_CD_C_TIF.DataRequest(VarArrayOf([0,xRcrIdTifDeb]));
                        FIN_CD_M_CTA_RCR.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('NATUREZA').AsInteger;

                        FIN_CD_M_CTA_RCR.FieldByName('id_plano').AsString            := xRcrIdPlanoSef;
                        FIN_CD_M_CTA_RCR.FieldByName('conciliado').Asboolean         := false;
                        FIN_CD_M_CTA_RCR.Post;


                        // Inserindo o movimento de crdito
                        FIN_CD_M_CTA_RCR.Insert;
                        // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                        FIN_CD_M_CTA_RCR.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
                        FIN_CD_M_CTA_RCR.FieldByName('id_credito').AsInteger         := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('id_abertura').AsInteger        := IdAbertura;
                        FIN_CD_M_CTA_RCR.FieldByName('id_empresa').AsInteger         := dataset.FieldByName('id_empresa').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
                        FIN_CD_M_CTA_RCR.FieldByName('dta_lancamento').AsDateTime    := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                        FIN_CD_M_CTA_RCR.FieldByName('dta_movimento').AsDateTime     := FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                        FIN_CD_M_CTA_RCR.FieldByName('num_doc').AsInteger            := FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('historico').AsString           := 'Ref. a utilizao da nota de crdito: ' +
                                                                                         FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsString;
                        FIN_CD_M_CTA_RCR.FieldByName('vlr_lancamento').AsCurrency    := xVlrTitulo;
                        FIN_CD_M_CTA_RCR.FieldByName('origem').AsInteger             := 6; // 6-Nota de Crdito;
                        FIN_CD_M_CTA_RCR.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
                        FIN_CD_M_CTA_RCR.FieldByName('id_tipo_financeiro').AsInteger := xRcrIdTifCre;

                        CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
                        CAD_CD_C_TIF.Data :=
                            CAD_CD_C_TIF.DataRequest(VarArrayOf([0,xRcrIdTifCre]));
                        FIN_CD_M_CTA_RCR.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('NATUREZA').AsInteger;

                        FIN_CD_M_CTA_RCR.FieldByName('id_plano').AsString            := xRcrIdPlanoSef;
                        FIN_CD_M_CTA_RCR.FieldByName('conciliado').Asboolean         := false;
                        FIN_CD_M_CTA_RCR.Post;

                        CAD_CD_C_TIF.Close;
                      end;
                   CAD_CD_C_FPG.Close;
                end;
             cdsTit.Next;
             // O Applyupdate do FIN_CD_M_RCR  FIN_CD_M_CTA_RCR,  dado no mtodo principal ( O que chamdou este ).
           end;
        cdsTit.First;

        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Free;

        CAD_CD_C_FPG.Free;

        BUS_CD_C_PAR_CTR.Close;
        BUS_CD_C_PAR_CTR.Free;

        CAD_CD_C_TIF.Free;
     end;

  if origem = 1 then  // 1 - Nota Fiscal de Devoluo de Venda
     begin
       try
         BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
         BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
         BUS_CD_C_PAR_CTR.Close;
         BUS_CD_C_PAR_CTR.Data :=
               BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

         RcrIdCondPgtoNfDev  := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_CONDICAO_PAG').AsInteger;
         RcrIdFormapgtoNfDev := BUS_CD_C_PAR_CTR.FieldByName('RCR_ID_FORMA_PAG').AsInteger;

         FIN_CD_M_RCR := TClientDataSet.Create(nil);
         FIN_CD_M_RCR.SetProvider(FIN_DP_M_RCR);
         FIN_CD_M_RCR.Close;
         FIN_CD_M_RCR.Data :=
             FIN_CD_M_RCR.DataRequest(VarArrayOf([90,dataset.FieldByName('id_fiscal').AsInteger]));

         if not (FIN_CD_M_RCR.IsEmpty) then
            begin
              FIN_CD_M_RCR.First;
              while not (FIN_CD_M_RCR.Eof) do
                 begin
                   FIN_CD_M_RCR.Delete;
                 end;
            end;

         if not (DataSet.UpdateStatus in [usDeleted]) then  // Se o registro pai no foi deletado
            begin
              vlrNota    := dataset.FieldByName('VLR_LIQUIDO').AsCurrency;
              numeroNf   := dataset.FieldByName('NUMERO').AsString;
              DtaCredito := dataset.FieldByName('dta_documento').AsDateTime;

              if (DataSet.UpdateStatus in [usUnmodified]) then  // Se o registro pai foi modificado
                 begin
                   DataSet.Next;
                   if (DataSet.UpdateStatus in [usmodified]) then  // Se o registro pai foi modificado
                       begin
                         if dataset.FieldByName('VLR_LIQUIDO').AsCurrency > 0 then
                            begin
                              vlrNota  := dataset.FieldByName('VLR_LIQUIDO').AsCurrency;
                            end;

                         if dataset.FieldByName('NUMERO').AsFloat > 0 then
                            begin
                              numeroNf  := dataset.FieldByName('NUMERO').AsString;
                            end;

                         if dataset.FieldByName('dta_documento').text <> '' then
                            begin
                              DtaCredito := dataset.FieldByName('dta_documento').AsDateTime;
                            end;
                         dataset.Prior;
                       end;
                 end;

              FIN_CD_M_RCR.Insert;
              FIN_CD_M_RCR.FieldByName('ID_EMPRESA').AsInteger     := dataset.FieldByName('ID_EMPRESA').AsInteger;
              // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
              FIN_CD_M_RCR.FieldByName('ID_CREDITO').AsInteger     := self.enValorChave('FIN_TB_M_RCR');
              FIN_CD_M_RCR.FieldByName('ID_CLIENTE').AsInteger     := dataset.FieldByName('ID_EMITENTE').AsInteger;
              FIN_CD_M_RCR.FieldByName('ID_TITULO').AsInteger      := 0;  // Por ser devoluo de cliente, o NFE_TIT no existe
                                                                           // portanto no tem como passar valor para este campo.
              FIN_CD_M_RCR.FieldByName('DTA_CREDITO').AsDateTime   := DtaCredito;
              FIN_CD_M_RCR.FieldByName('ORIGEM').AsInteger         := 2;
              FIN_CD_M_RCR.FieldByName('NUM_DOCUMENTO').AsString   := numeroNf;
              FIN_CD_M_RCR.FieldByName('ID_FISCAL').AsInteger      := dataset.FieldByName('ID_FISCAL').AsInteger;
              FIN_CD_M_RCR.FieldByName('VLR_CREDITO').AsCurrency   := vlrNota;
              FIN_CD_M_RCR.FieldByName('VLR_SALDO').AsCurrency     := 0;
              FIN_CD_M_RCR.FieldByName('HISTORICO').AsString       :=
                     'Crdito gerado pela nota fiscal de dev. n ' + numeroNf;
              FIN_CD_M_RCR.FieldByName('DEB_CRE').AsInteger        := 1;
              FIN_CD_M_RCR.Post;
            end;

         if FIN_CD_M_RCR.ChangeCount > 0 then
            if not (FIN_CD_M_RCR.ApplyUpdates(0) = 0) then
               abort;

         finally
            BUS_CD_C_PAR_CTR.Close;
            BUS_CD_C_PAR_CTR.Free;
         end;
     end;
end;

procedure TSM.enGerFinRecPag(Sender: TObject; origem: integer;
  DataSet: TCustomClientDataSet; var cdsTit: TDataSet;
  var FIN_CD_M_REC_PAG: TClientDataSet; IdAbertura: integer; NumeroNfe: String);
var
  BUS_CD_M_REC_PAG,FIN_CD_M_CXA,CAD_CD_C_FPG,BUS_CD_C_PAR_CTR: TClientDataSet;
  xIdPlano: String;
  xVlrTitulo: Currency;
  xIdFormaPag: Integer;

begin
   { TODO -oMaxsuel -cCriao :
     Criado em 01/04/2015;
     Este mtodo tem a funo gerar o registro de pagamento da baixa de um ttulo.
   }

   // Origem
   {
      0 - Nota fiscal de sada
      2 - Baixa de Cartao de Credito
   }

   if Origem = 0 then
      begin
        FIN_CD_M_CXA     := TClientDataSet.Create(nil);
        FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Data :=
             FIN_CD_M_CXA.DataRequest(VarArrayOf([0,IdAbertura]));

        FIN_CD_M_REC_PAG := TClientDataSet.Create(nil);
        FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
        FIN_CD_M_REC_PAG.Close;
        FIN_CD_M_REC_PAG.Data :=
            FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([3,DataSet.FieldByName('ID_FISCAL').AsString]));
        if not (FIN_CD_M_REC_PAG.IsEmpty) then
           begin
             FIN_CD_M_REC_PAG.First;
             while not (FIN_CD_M_REC_PAG.Eof) do
                begin
                  FIN_CD_M_REC_PAG.Delete;
                end;
           end;
        CAD_CD_C_FPG := TClientDataSet.Create(nil);


        cdsTit.First;
        while not (cdsTit.Eof)  do
           begin
             if not (cdsTit.UpdateStatus in [usDeleted]) then  // Se o registro teve modificaes
                begin
                   xIdPlano    := cdsTit.FieldByName('ID_PLANO').AsString;
                   xVlrTitulo  := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                   xIdFormaPag := cdsTit.FieldByName('ID_FORMA_PAG').AsInteger;

                   if dataset.FieldByName('IND_EMITENTE').AsInteger = 1 then //  Nota de Terceiros
                      begin
                         if cdsTit.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                            begin
                              cdsTit.Next;
                              if cdsTit.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                                 begin
                                    if cdsTit.FieldByName('ID_FORMA_PAG').AsCurrency>0 then
                                       xIdFormaPag := cdsTit.FieldByName('ID_FORMA_PAG').AsInteger;
                                    if cdsTit.FieldByName('ID_PLANO').AsString<>'' then
                                       xIdPlano   := cdsTit.FieldByName('ID_PLANO').AsString;
                                    if cdsTit.FieldByName('VLR_TITULO').AsCurrency>0 then
                                       xVlrTitulo := cdsTit.FieldByName('VLR_TITULO').AsCurrency;
                                  end;
                            end;
                      end;

                   CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                   CAD_CD_C_FPG.Data :=
                       CAD_CD_C_FPG.DataRequest(VarArrayOf([0,xIdFormaPag]));

                   if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
                      (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
                      begin
                        FIN_CD_M_REC_PAG.Insert;
                        FIN_CD_M_REC_PAG.FieldByName('ID_TITULO').AsInteger      :=
                           cdsTit.FieldByName('ID_NFE_TIT').AsInteger;
                        // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                        FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger       :=
                           self.enValorChave('FIN_TB_M_RBX');
                        FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime :=
                           FIN_CD_M_CXA.FieldByName('dta_abertura').AsDateTime;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency :=
                           xVlrTitulo;
                        FIN_CD_M_REC_PAG.FieldByName('PER_JUROS').AsFloat        := 0;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency     := 0;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency  := 0;
                        FIN_CD_M_REC_PAG.FieldByName('HISTORICO').AsString       :=
                           'Ref. ao Tt: ' + cdsTit.FieldByName('ID_NFE_TIT').AsString +
                               ', da NF de sada: ' + NumeroNfe;

                        FIN_CD_M_REC_PAG.FieldByName('ID_FORMA_PAG').AsInteger   :=
                           xIdFormaPag;
                        FIN_CD_M_REC_PAG.FieldByName('ID_PLANO').AsString        :=
                           xIdPlano;

                        FIN_CD_M_REC_PAG.FieldByName('ID_RESPONSAVEL').AsInteger :=
                            FIN_CD_M_CXA.FieldByName('id_funcionario').AsInteger;

                        FIN_CD_M_REC_PAG.FieldByName('ID_CCUSTO').AsInteger      :=
                           CAD_CD_C_FPG.FieldByName('ID_CCUSTO').AsInteger;

                        FIN_CD_M_REC_PAG.FieldByName('ID_FISCAL').AsInteger      := DataSet.FieldByName('ID_FISCAL').AsInteger;
                        FIN_CD_M_REC_PAG.FieldByName('ID_ABERTURA').AsInteger    := IdAbertura;
                        FIN_CD_M_REC_PAG.FieldByName('ORIGEM').AsInteger         := 1;

                        FIN_CD_M_REC_PAG.Post;
                      end;
                   CAD_CD_C_FPG.Close;
                end;
             cdsTit.Next;
             // O Applyupdate do FIN_CD_M_REC_PAG,  dado no mtodo principal ( O que chamdou este ).
           end;
        FIN_CD_M_CXA.Close;
        FIN_CD_M_CXA.Free;

        CAD_CD_C_FPG.Free;
      end;
   {if Origem = 1 then
      begin
        // O BUS_CD_M_CTA tem que ser dado o ApplyUpdate tem que ser dado aqui

        BUS_CD_M_CTA.Free;
      end;}

    if Origem = 2 then
      begin
        FIN_CD_M_REC_PAG := TClientDataSet.Create(nil);
        FIN_CD_M_REC_PAG.SetProvider(FIN_DP_M_REC_PAG);
        FIN_CD_M_REC_PAG.Close;
        FIN_CD_M_REC_PAG.Data :=
            FIN_CD_M_REC_PAG.DataRequest(VarArrayOf([5,DataSet.FieldByName('ID_CBX').AsString]));
        if not (FIN_CD_M_REC_PAG.IsEmpty) then
           begin
             FIN_CD_M_REC_PAG.First;
             while not (FIN_CD_M_REC_PAG.Eof) do
                begin
                  FIN_CD_M_REC_PAG.Delete;
                end;
           end;

        BUS_CD_C_PAR_CTR := TClientDataSet.Create(nil);
         BUS_CD_C_PAR_CTR.SetProvider(BUS_DP_C_PAR_CTR);
         BUS_CD_C_PAR_CTR.Close;
         BUS_CD_C_PAR_CTR.Data :=
            BUS_CD_C_PAR_CTR.DataRequest(VarArrayOf([DataSet.FieldByName('ID_EMPRESA').AsString]));

        CAD_CD_C_FPG := TClientDataSet.Create(nil);
        CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
        CAD_CD_C_FPG.Data :=
               CAD_CD_C_FPG.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_FORMA_PAG').AsString]));

        if (CAD_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 0) and  // A vista
           (CAD_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger = 5)   then // dinheiro
            begin
                cdsTit.First;
                while not (cdsTit.Eof) do
                  begin
                        FIN_CD_M_REC_PAG.Insert;
                        FIN_CD_M_REC_PAG.FieldByName('ID_TITULO').AsInteger      :=
                           cdsTit.FieldByName('ID_TITULO').AsInteger;
                        FIN_CD_M_REC_PAG.FieldByName('ID_CBX').AsInteger :=
                           DataSet.FieldByName('ID_CBX').AsInteger;
                        // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
                        FIN_CD_M_REC_PAG.FieldByName('ID_BAIXA').AsInteger       :=
                           self.enValorChave('FIN_TB_M_RBX');
                        FIN_CD_M_REC_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime :=
                           DataSet.FieldByName('DTA_BAIXA').AsDateTime;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_PAGAMENTO').asCurrency :=
                           cdsTit.FieldByName('VLR_LIQUIDO').AsCurrency;
                        FIN_CD_M_REC_PAG.FieldByName('PER_JUROS').AsFloat        := 0;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_JUROS').AsCurrency     := 0;
                        FIN_CD_M_REC_PAG.FieldByName('VLR_DESCONTO').AsCurrency  :=
                             cdsTit.FieldByName('VLR_DESCONTO_OPE').AsCurrency+
                             cdsTit.FieldByName('VLR_DESCONTO_ANTEC').AsCurrency;
                        FIN_CD_M_REC_PAG.FieldByName('HISTORICO').AsString       :=
                           'Ref. ao Tt: ' + cdsTit.FieldByName('ID_TITULO').AsString +
                               ', da Baixa de Carto de Crdito: ' + DataSet.FieldByName('ID_CBX').AsString;

                        FIN_CD_M_REC_PAG.FieldByName('ID_FORMA_PAG').AsInteger   :=
                           DataSet.FieldByName('ID_FORMA_PAG').AsInteger;
                        FIN_CD_M_REC_PAG.FieldByName('ID_PLANO').AsString        :=
                           BUS_CD_C_PAR_CTR.FieldByName('CBX_ID_PLANO').AsString;

                        FIN_CD_M_REC_PAG.FieldByName('ID_RESPONSAVEL').AsInteger :=
                           DataSet.FieldByName('ID_RESPONSAVEL').AsInteger;
                        //FIN_CD_M_REC_PAG.FieldByName('ID_CCUSTO').AsInteger      :=?

                       // FIN_CD_M_REC_PAG.FieldByName('ID_FISCAL').AsInteger      := DataSet.FieldByName('ID_FISCAL').AsInteger;
                        FIN_CD_M_REC_PAG.FieldByName('ID_ABERTURA').AsInteger    := 0;
                        FIN_CD_M_REC_PAG.FieldByName('ORIGEM').AsInteger         := 4;

                        FIN_CD_M_REC_PAG.Post;
                        cdsTit.Next;
                 end;
             end;
             CAD_CD_C_FPG.Close;
             CAD_CD_C_FPG.Free;

      end;
end;



function TSM.enGerPeqDesp(IdFornecedor,IdAbertura, IdLocalTit,IdFormaPag,IdCcusto,IdTipoFinanceiro,IdEmpresa: Integer; IdPlano, Historico: String;
                          DtaEmissao,DtaVencto,DtaOrig: TDateTime; VlrLancto: Currency): String;

var
  FIN_CD_M_CXA, FIN_CD_M_PAG, FIN_CD_M_PAG_PAG,FIN_CD_M_CTA,CAD_CD_C_FPG,CAD_CD_C_TIF:TClientdataset;
  Vtran: TDBXTransaction;
  Conn: TSQLConnection;
begin

   // O mtodo foi inativado , pra funcionar nesta funo  enGerPeqDesp devido o mtodo enGerFinCxaBco;

  {result := FIN_RN_M_PBX.FinBxaPeqDespPbx(FIN_DP_M_CXA,FIN_DP_M_PAG,FIN_DP_M_PAG_PAG,FIN_DP_M_CTA,
            IdFornecedor,IdAbertura,IdLocalTit, IdFormaPag, IdCcusto, IdEmpresa,
            IdPlano,Historico,DtaEmissao,DtaVencto,DtaOrig,VlrLancto,BuscarConnBanco);}


   FIN_CD_M_CXA     := TClientDataSet.Create(nil);
   FIN_CD_M_CXA.SetProvider(FIN_DP_M_CXA);
   FIN_CD_M_CXA.Close;
   FIN_CD_M_CXA.Data :=
          FIN_CD_M_CXA.DataRequest(VarArrayOf([0, IdAbertura]));


   FIN_CD_M_PAG := TClientDataSet.Create(nil);
   FIN_CD_M_PAG.SetProvider(FIN_DP_M_PAG);
   FIN_CD_M_PAG.Data :=
              FIN_CD_M_PAG.DataRequest(VarArrayOf([0,'']));

   FIN_CD_M_PAG_PAG := TClientDataSet.Create(nil);
   FIN_CD_M_PAG_PAG.SetProvider(FIN_DP_M_PAG_PAG);
   FIN_CD_M_PAG_PAG.Data :=
             FIN_CD_M_PAG_PAG.DataRequest(VarArrayOf([2,'']));

   // Registrando o ttulo
   FIN_CD_M_PAG.Insert;
   // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
   FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger       := self.enValorChave('FAT_TB_M_NFE_TIT');
   FIN_CD_M_PAG.FieldByName('id_fornecedor').AsInteger   := IdFornecedor;
   FIN_CD_M_PAG.FieldByName('id_abertura').AsInteger     := IdAbertura;
   FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime    := DtaEmissao;
   FIN_CD_M_PAG.FieldByName('dta_vencimento').AsDateTime := DtaVencto;
   FIN_CD_M_PAG.FieldByName('dta_original').AsDateTime   := DtaOrig;
   FIN_CD_M_PAG.FieldByName('origem').AsInteger          := 2; //Pequenas despesas
   FIN_CD_M_PAG.FieldByName('id_local_titulo').AsInteger := IdLocalTit;
   FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger    := IdFormaPag;
   FIN_CD_M_PAG.FieldByName('id_ccusto').AsInteger       := IdCcusto;
   FIN_CD_M_PAG.FieldByName('id_empresa').AsInteger      := IdEmpresa;
   FIN_CD_M_PAG.FieldByName('vlr_original').AsCurrency   := VlrLancto;
   FIN_CD_M_PAG.FieldByName('vlr_parcela').AsCurrency    := VlrLancto;
   FIN_CD_M_PAG.FieldByName('vlr_saldo').AsCurrency      := 0;
   FIN_CD_M_PAG.FieldByName('NUM_PARCELA').AsString      := '1/1';
   FIN_CD_M_PAG.FieldByName('HISTORICO').AsString        := Historico;
   FIN_CD_M_PAG.FieldByName('VLR_ORIGINAL').AsCurrency   := VlrLancto;
   FIN_CD_M_PAG.FieldByName('ID_FISCAL').AsInteger       := 0;
   FIN_CD_M_PAG.FieldByName('ORIGEM').AsInteger          := 2;
   FIN_CD_M_PAG.FieldByName('PRE_CONTA').AsInteger       := 0;
   FIN_CD_M_PAG.FieldByName('PRE_CHEQUE').AsString       := '0';
   FIN_CD_M_PAG.FieldByName('PRE_BANCO').AsString        := '';
   FIN_CD_M_PAG.FieldByName('PRE_EMITENTE').AsString     := '';
   FIN_CD_M_PAG.FieldByName('PRE_AGENCIA').AsString      := '';
   FIN_CD_M_PAG.FieldByName('TIPO_LANCAMENTO').AsInteger := 1;
   FIN_CD_M_PAG.FieldByName('ID_PLANO').AsString         := IdPlano;
   FIN_CD_M_PAG.FieldByName('per_multa').AsFloat         := 0;
   FIN_CD_M_PAG.FieldByName('per_juros').AsFloat         := 0;
   FIN_CD_M_PAG.Post;


   // Registrando o pagamento
   FIN_CD_M_PAG_PAG.Append;
   FIN_CD_M_PAG_PAG.FieldByName('ID_TITULO').AsInteger         :=
       FIN_CD_M_PAG.FieldByName('ID_TITULO').asInteger;
   // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
   FIN_CD_M_PAG_PAG.FieldByName('ID_BAIXA').AsInteger          :=
       self.enValorChave('FIN_TB_M_PBX');
   FIN_CD_M_PAG_PAG.FieldByName('DTA_PAGAMENTO').AsDateTime    :=
       FIN_CD_M_PAG.FieldByName('DTA_EMISSAO').AsDateTime;
   FIN_CD_M_PAG_PAG.FieldByName('VLR_PAGAMENTO').asCurrency    :=
       FIN_CD_M_PAG.FieldByName('VLR_PARCELA').asCurrency;
   FIN_CD_M_PAG_PAG.FieldByName('PER_JUROS').AsFloat           := 0;
   FIN_CD_M_PAG_PAG.FieldByName('VLR_JUROS').AsCurrency        := 0;
   FIN_CD_M_PAG_PAG.FieldByName('VLR_MULTA').AsCurrency        := 0;
   FIN_CD_M_PAG_PAG.FieldByName('VLR_DESCONTO').AsCurrency     := 0;
   FIN_CD_M_PAG_PAG.FieldByName('HISTORICO').AsString          :=
       FIN_CD_M_PAG.FieldByName('HISTORICO').AsString;
   FIN_CD_M_PAG_PAG.FieldByName('ID_FORMA_PAG').AsInteger      :=
       FIN_CD_M_PAG.FieldByName('id_forma_pag').AsInteger;
   FIN_CD_M_PAG_PAG.FieldByName('ID_PLANO').AsString           :=
       FIN_CD_M_PAG.FieldByName('id_plano').AsString;
   FIN_CD_M_PAG_PAG.FieldByName('ID_ABERTURA').AsInteger    :=
       IdAbertura;
   FIN_CD_M_PAG_PAG.FieldByName('ID_RESPONSAVEL').AsInteger    :=
       FIN_CD_M_CXA.FieldByName('id_funcionario').AsInteger;
   FIN_CD_M_PAG_PAG.FieldByName('ID_CCUSTO').AsInteger         :=
       FIN_CD_M_PAG.FieldByName('id_ccusto').AsInteger;
   FIN_CD_M_PAG_PAG.FieldByName('chp_vlr_anterior').AsCurrency := 0;

   FIN_CD_M_PAG_PAG.Post;

  FIN_CD_M_CTA  := TClientDataSet.Create(self);
  FIN_CD_M_CTA.SetProvider(FIN_DP_M_CTA);
  FIN_CD_M_CTA.Close;
  FIN_CD_M_CTA.Data :=
       FIN_CD_M_CTA.DataRequest(VarArrayOf([0,'']));


  CAD_CD_C_FPG     :=TClientDataSet.Create(nil);
  CAD_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
  CAD_CD_C_FPG.Data :=
          CAD_CD_C_FPG.DataRequest(VarArrayOf([0,IntToStr(IdFormaPag)]));


  CAD_CD_C_TIF     :=TClientDataSet.Create(nil);
  CAD_CD_C_TIF.SetProvider(CAD_DP_C_TIF);
  CAD_CD_C_TIF.Data :=
          CAD_CD_C_TIF.DataRequest(VarArrayOf([0,IntToStr(IdTipoFinanceiro)]));

  if (CAD_CD_C_FPG.FieldByName('doc_impresso').AsInteger = 5) and
     (CAD_CD_C_FPG.FieldByName('gera_caixa_banco').AsBoolean) then
     begin
       FIN_CD_M_CTA.Insert;
       // Retirado o dmApoio para sm da maneira correta, por Maxsuel em 09/04/2018
       FIN_CD_M_CTA.FieldByName('id_controle').AsInteger        := self.enValorChave('FIN_TB_M_CTA');
       FIN_CD_M_CTA.FieldByName('id_abertura').AsInteger        := IdAbertura;
       FIN_CD_M_CTA.FieldByName('id_empresa').AsInteger         := IdEmpresa;
       FIN_CD_M_CTA.FieldByName('tipo_lancamento').AsInteger    := FIN_CD_M_CXA.FieldByName('INT_TIPOCTC').AsInteger;   //0-caixa 1-banco
       FIN_CD_M_CTA.FieldByName('dta_lancamento').AsDateTime    := DtaEmissao;
       FIN_CD_M_CTA.FieldByName('dta_movimento').AsDateTime     := DtaEmissao;
       FIN_CD_M_CTA.FieldByName('num_doc').AsInteger            := FIN_CD_M_PAG.FieldByName('id_titulo').AsInteger;
       {FIN_CD_M_CTA.FieldByName('historico').AsString           := 'Ref. ao Tt: ' +  FIN_CD_M_PAG.FieldByName('id_titulo').AsString + ', de pequena despesas do caixa(abertura):' +
                                                                   IntToStr(IdAbertura); }
       FIN_CD_M_CTA.FieldByName('historico').AsString           := Historico;
       FIN_CD_M_CTA.FieldByName('vlr_lancamento').AsCurrency    := VlrLancto;
       FIN_CD_M_CTA.FieldByName('origem').AsInteger             := 8; // Controle de Caixa
       FIN_CD_M_CTA.FieldByName('id_conta').AsInteger           := FIN_CD_M_CXA.FieldByName('id_conta').AsInteger;
       FIN_CD_M_CTA.FieldByName('id_tipo_financeiro').AsInteger := IdTipoFinanceiro;
       FIN_CD_M_CTA.FieldByName('deb_cre').AsInteger            := CAD_CD_C_TIF.FieldByName('NATUREZA').AsInteger;
       FIN_CD_M_CTA.FieldByName('id_plano').AsString            := IdPlano;
       FIN_CD_M_CTA.FieldByName('conciliado').Asboolean         := false;
       FIN_CD_M_CTA.FieldByName('id_fiscal').AsInteger          := 0;
       // Corresponde ao mesmo id_titulo do (FIN_TB_M_REC) criado
       FIN_CD_M_CTA.FieldByName('id_titulo_rec').AsInteger      := 0;
       // -------------------------------------------------------
       FIN_CD_M_CTA.FieldByName('id_credito').AsInteger         := 0;
       FIN_CD_M_CTA.FieldByName('id_baixa_pbx').AsInteger       := 0;
       FIN_CD_M_CTA.FieldByName('id_baixa_rbx').AsInteger       := 0;
       FIN_CD_M_CTA.Post;
     end;

     //Foi substituido pelo codigo acima pois estava buscando tipo_financeiro no cadastro de forma de pagamento
     //sendo que o correto  busca nos parametros
   //enGerFinCxaBco(nil, 2, FIN_CD_M_PAG, nil,FIN_CD_M_CTA,IdAbertura);

   try
       Conn  := BuscarConnBanco;
       Vtran := Conn.BeginTransaction;
       result := 'OK';
       try
         if not (FIN_CD_M_PAG.ApplyUpdates(0) = 0) then
            begin
              result := 'Erro ao tentar gerar o ttulo do contas a pagar!';
            end;

         if not (FIN_CD_M_PAG_PAG.ApplyUpdates(0) = 0) then
            begin
              result := 'Erro ao tentar gerar a baixa da pequena despesa!';
            end;

         if not (FIN_CD_M_CTA.ApplyUpdates(0) = 0) then
            begin
              result := 'Erro ao tentar gerar a movimentao do caixa!';
            end;

       except
         on e: exception do
            begin
              result := result + #13 + e.Message;
            end;
       end;
      Conn.CommitFreeAndNil(Vtran);
   finally
      Conn.RollbackIncompleteFreeAndNil(Vtran);
      FIN_CD_M_PAG.Free;
      FIN_CD_M_CXA.Free;
      FIN_CD_M_PAG_PAG.Free;
      FIN_CD_M_CTA.Free;
      CAD_CD_C_FPG.Free;
      CAD_CD_C_TIF.Free;
   end;

end;

procedure TSM.enAudGravar(Sender: TObject; DataSet: TCustomClientDataSet);
const
  DirLog = 'Logs\';
var
  arquivo: String;
  DataAud: TDate;
  TimeAud: TTime;
begin
  if not(DirectoryExists(ExtractFilePath(Application.ExeName)+DirLog)) then
     ForceDirectories(ExtractFilePath(Application.ExeName)+DirLog);
  with DataSet do
  begin
    DataAud := date;
    TimeAud := Time;



    SetOptionalParam('DATA',DataAud,True);
    SetOptionalParam('HORA',TimeAud,True);

    SaveToFile(Format(
      DirLog + '%s,%s,%s,%s,log.xml',[
      GetOptionalParam('ID_EMPRESA'),
      GetOptionalParam('ID_FUNCIONARIO'),
      FormatDateTime('ddmmyyyy',DataAud),
      FormatDateTime('hhnnss',TimeAud)]));


   arquivo :=
      Format(
      ExtractFilePath(Application.ExeName)+'Logs\' + '%s,%s,%s,%s,log.xml',[
      GetOptionalParam('ID_EMPRESA'),
      GetOptionalParam('ID_FUNCIONARIO'),
      FormatDateTime('ddmmyyyy',DataAud),
      FormatDateTime('hhnnss',TimeAud)]);

   AUD_CD_M_AUD.close;
   AUD_CD_M_AUD.Open;
   AUD_CD_M_AUD.Insert;

   AUD_CD_M_AUD.FieldByName('dta_servidor').AsDateTime := DataAud;
   AUD_CD_M_AUD.FieldByName('hor_servidor').AsDateTime := TimeAud;
   AUD_CD_M_AUDarq_auditoria.LoadFromFile(Arquivo);
   AUD_CD_M_AUD.FieldByName('id_usuario').AsString    := GetOptionalParam('ID_FUNCIONARIO');
   AUD_CD_M_AUD.FieldByName('id_empresa').AsString    := GetOptionalParam('ID_EMPRESA');
   AUD_CD_M_AUD.FieldByName('programa').AsString      := GetOptionalParam('PROGRAMA');

   if trim(AUD_CD_M_AUD.FieldByName('programa').AsString) = '' then
     begin
       //AUD_CD_M_AUD.FieldByName('programa').AsString := 'INTERNO';
       AUD_CD_M_AUD.Cancel;
     end
  else
     AUD_CD_M_AUD.ApplyUpdates(0);
 {  SetOptionalParam('DATA',Date,True);
   SetOptionalParam('HORA',Time,True);
   SaveToFile(Format(
     DirLog + '%s,%s,%s,%s,%s,log.xml',[
     GetOptionalParam('USUARIO'),
     GetOptionalParam('MICRO'),
     GetOptionalParam('TABELA'),
     FormatDateTime('ddmmyyyy',Date),
     FormatDateTime('hhnnss',Time)])); }
  end;
end;


procedure TSM.enAudRegistrarInfo(DataSet: TDataSet;id_empresa,id_funcionario,programa:String);
begin
  { TODO -oLuan  :
   Criado em 19/07/2016
   Este mtodo tem a funo de registrar informaes para o uso da Auditoria.Utilizado somente para enServer
   A crio desse metodo surgiu da necessidade de criar auditoria para abertura/fechamento de caixa, em que no
   fechamento do caixa a operao do post ocorre no enServer }

  with dataset as TCustomClientDataSet do
    begin
      SetOptionalParam('ID_EMPRESA',id_empresa,true);
      SetOptionalParam('ID_FUNCIONARIO',id_funcionario,true);
      SetOptionalParam('PROGRAMA',programa,true);
    end;

end;

function TSM.enHoraServer: TDateTime;
begin
  Result := Time;
end;

function TSM.UltimoDiaDoMes(Data:TDateTime): string;
var
  sMes: string;
  sAno: string;
begin
  sMes := FormatDateTime('mm',Data);
  sAno := FormatDateTime('yyyy',Data);
  if Pos( sMes, '01 03 05 07 08 10 12' )  > 0 then
   UltimoDiaDoMes := '31'
  else if sMes <> '02' then
   UltimoDiaDoMes := '30'
  else if ( StrToInt( sAno ) mod 4 ) = 0 then
   UltimoDiaDoMes := '29'
  else
   UltimoDiaDoMes := '28';
end;

function TSM.enExisteItePrcFilial: Boolean;
var
  qry:TSqlQuery;
begin
   Result := false;
  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:=self.conexao;

  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add('Select COUNT(*) as qtde from CAD_TB_C_ITE_PRC where ID_EMPRESA>0');
  qry.Open;

   if qry.FieldByName('qtde').AsInteger = 0 then
     Result := false
   else
     Result := true;
end;

procedure TSM.enAudInserirCampoPacote(Properties: OleVariant);
begin
  Properties := VarArrayCreate([0,5], varVariant);
  Properties[0] := VarArrayOf(['ID_EMPRESA','',True]);
  Properties[1] := VarArrayOf(['ID_FUNCIONARIO','',True]);
  Properties[2] := VarArrayOf(['HORA',Time,True]);
  Properties[3] := VarArrayOf(['DATA',Date,True]);
  Properties[4] := VarArrayOf(['PROGRAMA','',True]);
  Properties[5] := VarArrayOf(['ID_PEDIDO_GERADO','',True]);
end;

function TSM.enVerifCteIteDup(id_empresa, id_controle, id_item, id_cor,
  id_tamanho: string): string;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 26/01/2016.
    Este mtodo tem a funo de ver se o item j existe em outra contagem. }

  result := '';

  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
      ' select cte.id_controle from est_tb_m_cte_ite cit   ' +
      '    left outer join est_tb_m_cte cte on             ' +
      '         (cte.id_controle = cit.id_controle)        ' +
      ' where cte.id_empresa   =  ''' + id_empresa  +  ''' ' +
      '   and coalesce(cte.status,0) =   0' +
      '   and cit.id_controle  <>  ''' + id_controle +  ''' ' +
      '   and cit.id_item      =  ''' + id_item     +  ''' ' +
      '   and cit.id_cor       =  ''' + id_cor      +  ''' ' +
      '   and cit.id_tamanho   =  ''' + id_tamanho  +'''   ');
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       if qryBusca.FieldByName('id_controle').AsInteger > 0 then
          begin
            result := qryBusca.FieldByName('id_controle').AsString;
          end;
     end;
  qryBusca.Close;

end;

function TSM.enVerifNfeDupRom(id_empresa, id_romaneio,
  id_fiscal: String): Boolean;
begin
   { TODO -oMaxsuel -cCriao : Mtodo criado em 12/08/2015 }


  result := false;

  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
      ' SELECT * FROM FAT_TB_M_ROM_NFE RFE ' +
      '    left outer join FAT_TB_M_ROM ROM on ' +
      '       (rom.id_romaneio = rfe.id_romaneio) '+
      ' WHERE ROM.ID_EMPRESA = '''+id_empresa+  ''' ' +
      '   and ROM.ID_ROMANEIO <> '''+id_romaneio+  '''  ' +
      '   and ROM.CANCELADO = FALSE ' +
      '   and RFE.ID_FISCAL = '''+id_fiscal+'''  ' );
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       result := true;
     end;
  qryBusca.Close;
end;

function TSM.enVerifNfePendente(id_empresa, id_funcionario: string): String;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 28/01/2016
    Tem a funo de buscar as notas fiscais pendentes(em abertas) no faturamento. }
  result := '';

  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
      ' SELECT NFE.*, CXA.ID_FUNCIONARIO, ' +
      '   case nfe.modelo ' +
      '     when ''55'' then ''NFe''  ' +
      '     when ''65'' then ''NFCe'' ' +
      '     when ''2D'' then ''ECF''  ' +
      '   else ''???'' end as int_descmod ' +
      '      FROM FAT_TB_M_NFE NFE                    ' +
      '   left outer join FIN_TB_M_CXA CXA on (CXA.ID_ABERTURA = NFE.ID_ABERTURA) ' +
      ' WHERE                                     ' +
      '     NFE.ID_EMPRESA  = ''' + id_empresa + ''' ' + {Busca notas Pendentes }
      '     AND NFE.MODELO in (''55'',''65'',''2D'','''') ' +
      '     AND NFE.TIPO_NF in (''S'',''E'',''D'',''R'' ) ' +
      '     AND NFE.IND_EMITENTE = 0 '     +
      '     AND NFE.NUMERO > 0       '     +
      '     AND NFE.NFE_COD_SIT = ''00'' ' +
      '     AND NFE.DTA_EMISSAO > ''27/01/2016'' ' +
      '     AND CXA.ID_FUNCIONARIO = '''   + id_funcionario +''' ' +
      '     AND NFE.STATUS  = 0 ');
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       while not qryBusca.eof do
          begin
            if trim(result) = '' then
               begin
                 Result := qryBusca.FieldByName('NUMERO').AsString + ' ' + qryBusca.FieldByName('int_descmod').AsString;
               end
            else
               begin
                 Result := Result + ', ' + qryBusca.FieldByName('NUMERO').AsString + ' ' + qryBusca.FieldByName('int_descmod').AsString;
               end;
            qryBusca.Next;
          end;
        result := result + '.';
     end;
  qryBusca.Close;
end;

function TSM.enVerifPedDupOrs(id_empresa,id_ors, id_pedido: String): Boolean;
begin
  result := false;

  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
      ' SELECT * FROM PCP_TB_M_ORS ORS ' +
      ' WHERE ORS.ID_EMPRESA = '''+id_empresa+  ''' ' +
      '   and ORS.ID_ORS <> '''+id_ors+  '''  ' +
      '   and ORS.ID_PEDIDO = '''+id_pedido+'''  ' );
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       result := true;
     end;
  qryBusca.Close;
end;

function TSM.enVerifTeleMarkCli(IdMkt, IdCliente: String): String;
var
  qry:TSqlQuery;
begin
  { TODO -oMaxsuel -cCriao :
   Mtodo criado em 07/12/2016
   Tem a funo de verificar se j existe um outro TeleMarketing para o cliente
   no mesmo dia. }

  result := '';

  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:= BuscarConnBanco; //SM.conexao;


  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add(
     ' select mkc.* from fat_tb_m_mkt_cli mkc ' +
     '   left outer join fat_tb_m_mkt mkt on mkt.id_mkt = mkc.id_mkt ' +
     '  where mkc.id_mkt <> '''+(IdMkt)+''' and mkc.id_cliente='''+(IdCliente)+''' ' +
     '    and mkt.dta_criacao = ''' + FormatDateTime(CFormatoData, date) + '''  ');
  qry.Open;

  if not qry.IsEmpty then
         Result := qry.FieldByName('id_mkt').AsString;

  qry.Close;
  qry.Destroy();
  //  FreeAndNil(SM);
end;

function TSM.enVerifVersao: String;
begin
   { TODO -oMaxsuel -cCriao :
     Criado em 24-03-2016
     Tem a funo de confrontar as verses Servidor e Cliente }

   // O valor da varivel: CVersaoSis deve ser igual ao valor da varivel:
   //    CVersaoSistema do arquivo enConstantes

   result := StringReplace(CenVersaoSis,'-','',[rfReplaceAll]);
   result := StringReplace(result,' ','',[rfReplaceAll]);

end;

function TSM.enVerCreditoCli(Cliente: string;tipo_saldo:integer =0): Currency;
begin

  {
     Tem-se dois tipos de calculo de saldo:
      0 - saldo calculado com base nos registro fin_tb_m_rcr e do ofi_tb_m_orv(oficina)
      1 - saldo calculado com base somente nos registros da tabela fin_tb_m_rcr(utlizado pelo extrato de cliente-FIN_FM_R_EXC)
  }

  result := 0;

  qryBusca.Close;
  qryBusca.SQL.Clear;

 if (tipo_saldo = 0) then
     begin

        qryBusca.SQL.Add (
          'SELECT  ' + #13#10 +
          '        ( SELECT COALESCE(sum(COALESCE(rcr.vlr_credito,0)),0)  ' + #13#10 +
          '            FROM FIN_TB_M_RCR RCR   ' + #13#10 +
          '          where RCR.id_cliente = cli.id_cliente ' + #13#10 +
          '            and RCR.deb_cre = 1)' + #13#10 +
          '        -  ' + #13#10 +
          '        ( ' + #13#10 +
          '          (SELECT COALESCE(sum(COALESCE(rcr.vlr_credito,0)),0)  ' + #13#10 +
          '             FROM FIN_TB_M_RCR RCR ' + #13#10 +
          '           where RCR.id_cliente = cli.id_cliente ' + #13#10 +
          '             and RCR.deb_cre = 0) + ' + #13#10 +
          '          (SELECT COALESCE(sum(COALESCE(orv.vlr_credito,0)),0)  ' + #13#10 +
          '             FROM OFI_TB_M_ORV ORV' + #13#10 +
          '           where orv.id_cliente = cli.id_cliente' + #13#10 +
          '             and ORV.STATUS in (0,1,2)' + #13#10 +
          '             ) + ' + #13#10 +

          '          (SELECT COALESCE(sum(COALESCE(ped.vlr_credito,0)),0)  ' + #13#10 +
          '             FROM FAT_TB_M_PED PED' + #13#10 +
          '           where ped.id_cliente = cli.id_cliente' + #13#10 +
          '             and PED.SITUACAO in (0,2)' + #13#10 +
          '             )  ' + #13#10 +

          '        )' + #13#10 +
          '         as VLR_SALDO ' + #13#10 +
          '       FROM CAD_TB_C_CLI CLI ' + #13#10 +
          '       WHERE CLI.ID_CLIENTE = '''+Cliente+''' ');
     end;

  if (tipo_saldo = 1) then
    begin
         qryBusca.SQL.Add (
          ' SELECT  ' + #13#10 +
          '        ( SELECT COALESCE(sum(COALESCE(rcr.vlr_credito,0)),0)  ' + #13#10 +
          '            FROM FIN_TB_M_RCR RCR   ' + #13#10 +
          '          where RCR.id_cliente = cli.id_cliente ' + #13#10 +
          '            and RCR.deb_cre = 1) - ' + #13#10 +

          '          (SELECT COALESCE(sum(COALESCE(rcr.vlr_credito,0)),0)  ' + #13#10 +
          '             FROM FIN_TB_M_RCR RCR ' + #13#10 +
          '           where RCR.id_cliente = cli.id_cliente ' + #13#10 +
          '             and RCR.deb_cre = 0) ' + #13#10 +

          '         as VLR_SALDO ' + #13#10 +
          '       FROM CAD_TB_C_CLI CLI ' + #13#10 +
          '       WHERE CLI.ID_CLIENTE = '''+Cliente+''' ');
    end;

  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       result := qryBusca.FieldByName('vlr_saldo').asCurrency;
     end;
  qryBusca.Close;
end;

function TSM.enVerCreditoForn(Fornecedor:string):Currency;
begin
  result := 0;
  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add (
       'SELECT  ' + #13#10 +
'        ( SELECT COALESCE(sum(COALESCE(pcr.vlr_credito,0)),0)  ' + #13#10 +
'            FROM FIN_TB_M_PCR PCR   ' + #13#10 +
'          where PCR.id_fornecedor = fon.id_fornecedor ' + #13#10 +
'            and PCR.deb_cre = 1)' + #13#10 +
'        -  ' + #13#10 +
'          (SELECT COALESCE(sum(COALESCE(pcr.vlr_credito,0)),0)  ' + #13#10 +
'             FROM FIN_TB_M_PCR PCR ' + #13#10 +
'           where PCR.id_fornecedor = fon.id_fornecedor ' + #13#10 +
'             and PCR.deb_cre = 0) ' + #13#10 +
'         as VLR_SALDO ' + #13#10 +
'       FROM CAD_TB_C_FOR FON ' + #13#10 +
     ' where fon.id_fornecedor = '''+fornecedor+''' ');
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     begin
       result := qryBusca.FieldByName('vlr_saldo').asCurrency;
     end;
  qryBusca.Close;
end;



function TSM.enVerSaldoDiaCxa(IdEmpresa,IdConta,IdAbertura: integer): Currency;
var
  xSql:string;
begin
  result := 0;
  xSql:=

        ' with tb_saldo_dia_cxa     ' +
        ' as (                      ' +
        '    (select   sum(cta.vlr_lancamento) AS TOTAL_CREDITO, 0.00 as TOTAL_DEBITO  ' +
        '    from fin_tb_m_cta cta                                                     ' +
        '    left outer join cad_tb_c_tif tif on                                       ' +
        '        (tif.id_tipo_financeiro = cta.id_tipo_financeiro)                     ' +
        '    where id_conta    = ' + VarToStr(IdConta) +
        '      and id_empresa  = ' + VarToStr(IdEmpresa) +
        '      and id_abertura = ' + VarToStr(IdAbertura) +
        '      and tif.natureza = 1                                                    ' +
        '    group by cta.id_empresa)                                                  ' +
        '    UNION ALL                                                                 ' +
        '    (select 0.00 as TOTAL_CREDITO ,  sum(cta.vlr_lancamento) AS TOTAL_DEBITO  ' +
        '       from fin_tb_m_cta cta                                                  ' +
        '       left outer join cad_tb_c_tif tif on                                    ' +
        '            (tif.id_tipo_financeiro = cta.id_tipo_financeiro)                 ' +
        '    where id_conta    = ' + VarToStr(IdConta) +
        '      and id_empresa  = ' + VarToStr(IdEmpresa) +
        '      and id_abertura = ' + VarToStr(IdAbertura) +
        '      and tif.natureza = 0                                                    ' +
        '    group by cta.id_empresa)                                                  ' +
        '   )                                                                          ' +
        '                                                                              ' +
        ' select sum(total_credito) - sum(total_debito) as saldo_dia_cxa from  tb_saldo_dia_cxa ';

  qryBusca.Close;
  qryBusca.SQL.Clear;
  qryBusca.SQL.Add(xsql);
  qryBusca.Open;
  if not qryBusca.IsEmpty then
     result := qryBusca.FieldByName('saldo_dia_cxa').AsCurrency;
  qryBusca.Close;
end;

function TSM.enVerSldCxaEmAberto(id_empresa, id_funcionario: String): String;
var
  qryBus:TSqlQuery;
begin
  { TODO -oMaxsuel -cCriao :
    Criado em 28/07/16
    Esta funo verifica se o funcionrio tem algum caixa com saldo maior que 0. }
  try
   qryBus := TSqlQuery.Create(self);
   //SM     := TSM.Create(nil);
   qryBus.SQLConnection  := self.conexao;

   result := '';

   qryBus.Close;
   qryBus.SQL.Clear;
   qryBus.SQL.Add(
            ' select cta.id_empresa, cxa.id_funcionario, cta.id_conta, ctc.descricao,   ' + #13#10 +
            '  COALESCE( sum(' + #13#10 +
            '   case tif.natureza' + #13#10 +
            '     when 0 then cta.vlr_lancamento * -1' + #13#10 +
            '     when 1 then cta.vlr_lancamento     ' + #13#10 +
            '   end),0) as valor,                    ' + #13#10 +
            ' COALESCE( sum('                                    + #13#10 +
            '   case tif.natureza                    ' + #13#10 +
            '     when 1 then cta.vlr_lancamento     ' + #13#10 +
            '   end),0) as entrada,'                      + #13#10 +
            ' COALESCE( sum(' + #13#10 +
            '   case tif.natureza'                     + #13#10 +
            '     when 0 then cta.vlr_lancamento * -1  ' + #13#10 +
            '   end),0) as sada' + #13#10 +
            ' from fin_tb_m_cta cta' + #13#10 +
            '  left outer join cad_tb_c_ctc ctc on (ctc.id_conta = cta.id_conta)' + #13#10 +
            '  left outer join cad_tb_c_tif tif on (tif.id_tipo_financeiro = cta.id_tipo_financeiro)' + #13#10 +
            '  left outer join fin_tb_m_cxa cxa on (cxa.id_abertura = cta.id_abertura)' + #13#10 +
            ' where ctc.tipo = 0        ' + #13#10 +
            '  and cxa.id_funcionario = ' + VarToStr(id_funcionario) + #13#10 +
            '  and cxa.id_empresa     = ' + VarToStr(id_empresa)     + #13#10 +
            ' group by 1,2,3,4'   + #13#10 +
            ' having ' + #13#10   +
            ' ' + #13#10 +
            ' coalesce( sum('       + #13#10 +
            '   case tif.natureza'  + #13#10 +
            '     when 0 then cta.vlr_lancamento * -1 ' + #13#10 +
            '     when 1 then cta.vlr_lancamento      ' + #13#10 +
            ' end),0) <> 0');
   qryBus.Open;

   if not qryBus.IsEmpty then
      begin
        result := qryBus.FieldByName('id_conta').AsString;
      end;
   qryBus.Close;

  finally
    FreeAndNil(qryBus);
    //FreeAndNil(SM);
  end;
end;


function TSM.enValorMedioGrp(codVendedor,ano,codGrupoPrd: integer): Currency;
var
  qry:TSqlQuery;
begin
    { TODO -oLuan -cCriao :
      Criado em 06/12/2016 }
  Result := 0;
  qry:=TSqlQuery.Create(self);
  //SM := TSM.Create(nil);
  qry.SQLConnection:=self.conexao;


  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add(
     ' select '+

     ' (SUM(COALESCE(NFI.VLR_UNITARIO*(NFI.QTDE-NFI.QTDE_DEVOLVIDA),0))-             '+
     '          -SUM((COALESCE(NFI.VLR_DESCONTO,0)/NFI.QTDE)*(NFI.qtde-NFI.qtde_devolvida))  )/sum(nfi.qtde-nfi.qtde_devolvida) as valor_medio '+

     ' from fat_tb_m_nfe_ite nfi                                                                                                               '+
     ' left outer join fat_tb_m_nfe nfe on nfe.id_fiscal=nfi.id_fiscal                                                                         '+
     ' left outer join cad_tb_c_ite ite on ite.id_item=nfi.id_item                                                                             '+
     ' LEFT OUTER JOIN CAD_TB_C_CFO CFO ON CFO.ID_CFO=NFE.ID_CFO                                                                               '+

     ' WHERE CFO.ID_CLASSE IN (''SP10'',''SP70'') AND NFE.NFE_COD_SIT not in (''02'',''04'',''05'') AND NFE.STATUS = 1 AND                     '+
     '        NFE.FATURADA = true AND NFE.TIPO_NF=''S'' and                                                                                    '+

     ' extract(year from dta_emissao)='''+IntToStr(ano)+''' and ite.id_grupo_prod='''+IntToStr(codGrupoPrd)+''' and nfe.id_responsavel='''+IntToStr(codVendedor)+''' '  );
  qry.Open;

  if not qry.IsEmpty then
    Result:=qry.FieldByName('valor_medio').AsCurrency;

  qry.Close;
  qry.Destroy();
  //FreeAndNil(SM);                                     en
end;







function TSM.enVerSldLimAtu(origem: integer; DataSet: TCustomClientDataSet; cdsTitulos: TDataSet; id_forma_pag_rbx: integer): Currency;
var
  BUS_CD_C_FPG,BUS_CD_M_NFE_TIT_INT: TClientDataSet;
  VlrAnt, VlrNovo: Currency;
  IdFormaPag: String;
begin

  { TODO -oMaxsuel Victor -cCriao :
    Criado em 30/03/2015

    Este mtodo tem a funo de buscar o valor exato a Acrescentar ou Deduzir do
    saldo limite do cliente }

  {
    origem: 0 - A acrescentar no saldo por: Cancelamento de Nota Fiscal ou Alterao da nota
            1 - A acrescentar no saldo por: Baixa do contas a receber
            2 - A deduzir no saldo por: Nota Fiscal (Venda)
  }

  BUS_CD_C_FPG := TClientDataSet.Create(self);

  if origem = 0 then
     begin
       // A Acrescentar no saldo do limite
       result := 0;
       cdsTitulos.First;
       while not cdsTitulos.eof do
          begin
            BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
            //BUS_CD_C_FPG.Close;
            BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,cdsTitulos.FieldByName('id_forma_pag').AsString]));
            if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and         // A prazo
               (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                begin
                  result := result + cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                end;
            cdsTitulos.Next;
          end;
     end;

  if origem = 1 then
     begin
       // A acrescentar no saldo do limite
      { BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
       BUS_CD_C_FPG.Close;
       BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,id_forma_pag_rbx]));
       if BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger <> 6 then // 6 - Cheque
          begin
           cdsTitulos.First;
           while not cdsTitulos.eof do
              begin
                // Note que no utilizei o campo VLR_CRED_UTILIZADO, pois quando faz baixa
                // com o crdito do cliente, o campo VLR_PAGAMENTO deve ser igual ao valor do campo
                // VLR_CRED_UTILIZADO. Isso  devido a baixa permitir somente uma forma de pagamento no momento
                // de fazer a baixa.
                result := result +
                          (cdsTitulos.FieldByName('VLR_PAGAMENTO').AsCurrency +
                           cdsTitulos.FieldByName('VLR_DESCONTO').AsCurrency) -
                          cdsTitulos.FieldByName('VLR_JUROS').AsCurrency;
                cdsTitulos.Next;
              end;
          end; }

       result := 0;
       BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
       BUS_CD_C_FPG.Close;
       BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_FORMA_PAG').AsString]));
           // No for  Duplicata, Promissria , Carto de crdito , Boleto ou Cheque
       if NOT (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger IN [1,2,3,4,6]) then
          begin
           cdsTitulos.First;
           while not cdsTitulos.eof do
              begin
                // Note que no utilizei o campo VLR_CRED_UTILIZADO, pois quando faz baixa
                // com o crdito do cliente, o campo VLR_PAGAMENTO deve ser igual ao valor do campo
                // VLR_CRED_UTILIZADO. Isso  devido a baixa permitir somente uma forma de pagamento no momento
                // de fazer a baixa.
                result := result +
                          (cdsTitulos.FieldByName('VLR_PAGAMENTO').AsCurrency +
                           cdsTitulos.FieldByName('VLR_DESCONTO').AsCurrency) -
                          cdsTitulos.FieldByName('VLR_JUROS').AsCurrency;
                cdsTitulos.Next;
              end;
          end;
     end;

  if origem = 2 then
     begin
       result := 0;
       // A deduzir do saldo limite do cliente
       cdsTitulos.First;
       while not (cdsTitulos.Eof)  do
           begin
             if not (cdsTitulos.UpdateStatus in [usDeleted]) then  // Se o registro teve modificaes
                begin
                  VlrNovo    := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                  IdFormaPag := cdsTitulos.FieldByName('id_forma_pag').AsString;
                  if cdsTitulos.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                     begin
                       cdsTitulos.Next;
                       if cdsTitulos.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                           begin
                             if cdsTitulos.FieldByName('id_forma_pag').AsString <> '' then
                                IdFormaPag := cdsTitulos.FieldByName('id_forma_pag').AsString;
                             if cdsTitulos.FieldByName('VLR_TITULO').AsCurrency>0 then
                                VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                           end;
                     end;

                  BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                  BUS_CD_C_FPG.Data :=
                       BUS_CD_C_FPG.DataRequest(VarArrayOf([0,IdFormaPag]));
                  if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and       // A prazo
                     (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                     begin
                       result := result + VlrNovo;
                     end;
                  BUS_CD_C_FPG.Close;

                  {BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                  //BUS_CD_C_FPG.Close;
                  BUS_CD_C_FPG.Data :=
                       BUS_CD_C_FPG.DataRequest(VarArrayOf([cdsTitulos.FieldByName('id_forma_pag').AsString]));

                  if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and       // A prazo
                     (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                     begin
                       VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;

                       if cdsTitulos.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                          begin
                            cdsTitulos.Next;
                            if cdsTitulos.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                               begin
                                  if cdsTitulos.FieldByName('VLR_TITULO').AsCurrency>0 then
                                     VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                                end;
                          end;
                       result := result + VlrNovo;
                     end;
                  BUS_CD_C_FPG.Close; }
                end;
             cdsTitulos.Next;
          end;
       cdsTitulos.First;
     end;

  cdsTitulos.First;

//  BUS_CD_M_NFE_TIT_INT.Free;
end;



procedure TSM.enVerSldLimFpgAtu(origem: integer; DataSet: TCustomClientDataSet; cdsTitulos:TDataSet;cdsFormaPag: TClientDataSet; id_forma_pag_rbx: integer);
var
  BUS_CD_C_FPG,BUS_CD_M_NFE_TIT_INT: TClientDataSet;
  VlrAnt, VlrNovo: Currency;
  IdFormaPag: String;
begin

  { TODO -oMaxsuel Victor -cCriao :
    Criado em 30/03/2015

    Este mtodo tem a funo de buscar o valor exato a Acrescentar ou Deduzir do
    saldo limite do cliente }

  {
    origem: 0 - A acrescentar no saldo por: Cancelamento de Nota Fiscal ou Alterao da nota
            1 - A acrescentar no saldo por: Baixa do contas a receber
            2 - A deduzir no saldo por: Nota Fiscal (Venda)
  }

  BUS_CD_C_FPG := TClientDataSet.Create(self);

  if origem = 0 then
     begin
       // A Acrescentar no saldo do limite

       cdsTitulos.First;
       while not cdsTitulos.eof do
          begin
            BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
            //BUS_CD_C_FPG.Close;
            BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,cdsTitulos.FieldByName('id_forma_pag').AsString]));
            if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and         // A prazo
               (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                begin
                  if cdsFormaPag.Locate('id_forma_pag',cdsTitulos.FieldByName('id_forma_pag').AsString,[]) then
                    begin
                     cdsFormaPag.Edit;
                     cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                        cdsFormaPag.FieldByName('lim_saldo').AsCurrency +
                        cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;

                    end
                  else
                    begin
                      cdsFormaPag.Insert;
                      cdsFormapag.FieldByname('id_cliente').AsString := DataSet.FieldByName('ID_EMITENTE').AsString;
                      cdsFormapag.FieldByname('id_forma_pag').AsString :=
                                    cdsTitulos.FieldByName('id_forma_pag').AsString;

                      cdsFormapag.FieldByname('lim_valor').AsCurrency :=0;
                      cdsFormapag.FieldByname('lim_saldo').AsCurrency :=enBusNovoSldlimCli(DataSet.FieldByname('ID_EMPRESA').AsString,
                                                                         DataSet.FieldByName('ID_EMITENTE').AsString,
                                                                         cdsTitulos.FieldByName('id_forma_pag').AsString,0);
                      cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                        cdsFormaPag.FieldByName('lim_saldo').AsCurrency +
                        cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                    end;
                  cdsFormaPag.Post;
                end;
            cdsTitulos.Next;
          end;
     end;

  if origem = 1 then
     begin
       // A acrescentar no saldo do limite
      { BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
       BUS_CD_C_FPG.Close;
       BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,id_forma_pag_rbx]));
       if BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger <> 6 then // 6 - Cheque
          begin
           cdsTitulos.First;
           while not cdsTitulos.eof do
              begin
                // Note que no utilizei o campo VLR_CRED_UTILIZADO, pois quando faz baixa
                // com o crdito do cliente, o campo VLR_PAGAMENTO deve ser igual ao valor do campo
                // VLR_CRED_UTILIZADO. Isso  devido a baixa permitir somente uma forma de pagamento no momento
                // de fazer a baixa.
                result := result +
                          (cdsTitulos.FieldByName('VLR_PAGAMENTO').AsCurrency +
                           cdsTitulos.FieldByName('VLR_DESCONTO').AsCurrency) -
                          cdsTitulos.FieldByName('VLR_JUROS').AsCurrency;
                cdsTitulos.Next;
              end;
          end; }


       BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
       BUS_CD_C_FPG.Close;
       BUS_CD_C_FPG.Data := BUS_CD_C_FPG.DataRequest(VarArrayOf([0,DataSet.FieldByName('ID_FORMA_PAG').AsString]));
           // No for  Duplicata, Promissria , Carto de crdito , Boleto ou Cheque
       if NOT (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger IN [1,2,3,4,6]) then
          begin
           cdsTitulos.First;
           while not cdsTitulos.eof do
              begin
                // Note que no utilizei o campo VLR_CRED_UTILIZADO, pois quando faz baixa
                // com o crdito do cliente, o campo VLR_PAGAMENTO deve ser igual ao valor do campo
                // VLR_CRED_UTILIZADO. Isso  devido a baixa permitir somente uma forma de pagamento no momento
                // de fazer a baixa.


                if cdsFormaPag.Locate('id_forma_pag',DataSet.FieldByName('ID_FORMA_PAG').AsString,[]) then
                    begin
                     cdsFormaPag.Edit;
                     cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                        cdsFormaPag.FieldByName('lim_saldo').AsCurrency +
                         (cdsTitulos.FieldByName('VLR_PAGAMENTO').AsCurrency +
                           cdsTitulos.FieldByName('VLR_DESCONTO').AsCurrency) -
                          cdsTitulos.FieldByName('VLR_JUROS').AsCurrency;

                    end
                  else
                    begin
                      cdsFormaPag.Insert;
                      cdsFormapag.FieldByname('id_forma_pag').AsString :=
                                    DataSet.FieldByName('ID_FORMA_PAG').AsString;

                      cdsFormapag.FieldByname('lim_valor').AsCurrency :=0;
                      cdsFormapag.FieldByname('lim_saldo').AsCurrency :=0;
                      cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                        cdsFormaPag.FieldByName('lim_saldo').AsCurrency +
                         (cdsTitulos.FieldByName('VLR_PAGAMENTO').AsCurrency +
                           cdsTitulos.FieldByName('VLR_DESCONTO').AsCurrency) -
                          cdsTitulos.FieldByName('VLR_JUROS').AsCurrency;
                    end;
                  cdsFormaPag.Post;


                cdsTitulos.Next;
              end;
          end;
     end;

  if origem = 2 then
     begin

       // A deduzir do saldo limite do cliente
       cdsTitulos.First;
       while not (cdsTitulos.Eof)  do
           begin
             if not (cdsTitulos.UpdateStatus in [usDeleted]) then  // Se o registro teve modificaes
                begin
                  VlrNovo    := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                  IdFormaPag := cdsTitulos.FieldByName('id_forma_pag').AsString;
                  if cdsTitulos.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                     begin
                       cdsTitulos.Next;
                       if cdsTitulos.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                           begin
                             if cdsTitulos.FieldByName('id_forma_pag').AsString <> '' then
                                IdFormaPag := cdsTitulos.FieldByName('id_forma_pag').AsString;
                             if cdsTitulos.FieldByName('VLR_TITULO').AsCurrency>0 then
                                VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                           end;
                     end;

                  BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                  BUS_CD_C_FPG.Data :=
                       BUS_CD_C_FPG.DataRequest(VarArrayOf([0,IdFormaPag]));
                  if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and       // A prazo
                     (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                     begin
                       if cdsFormaPag.Locate('id_forma_pag',IdFormaPag,[]) then
                          begin
                           cdsFormaPag.Edit;
                           cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                              cdsFormaPag.FieldByName('lim_saldo').AsCurrency - VlrNovo;

                          end
                        else
                          begin
                            cdsFormaPag.Insert;
                            cdsFormapag.FieldByname('id_cliente').AsString := DataSet.FieldByName('ID_EMITENTE').AsString;
                            cdsFormapag.FieldByname('id_forma_pag').AsString := IdFormaPag;

                            cdsFormapag.FieldByname('lim_valor').AsCurrency :=0;
                            cdsFormapag.FieldByname('lim_saldo').AsCurrency :=enBusNovoSldlimCli(DataSet.FieldByname('ID_EMPRESA').AsString,
                                                                                                 DataSet.FieldByName('ID_EMITENTE').AsString,IdFormaPag,0);
                            cdsFormaPag.FieldByName('lim_saldo').AsCurrency :=
                              cdsFormaPag.FieldByName('lim_saldo').AsCurrency - VlrNovo;
                          end;
                        cdsFormaPag.Post;



                     end;
                  BUS_CD_C_FPG.Close;

                  {BUS_CD_C_FPG.SetProvider(CAD_DP_C_FPG);
                  //BUS_CD_C_FPG.Close;
                  BUS_CD_C_FPG.Data :=
                       BUS_CD_C_FPG.DataRequest(VarArrayOf([cdsTitulos.FieldByName('id_forma_pag').AsString]));

                  if (BUS_CD_C_FPG.FieldByName('TIPO_PAGAMENTO').AsInteger = 1) and       // A prazo
                     (BUS_CD_C_FPG.FieldByName('DOC_IMPRESSO').AsInteger in [1,2,4]) then // 1 - Dup   2 - Promissria   4 - Boleto
                     begin
                       VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;

                       if cdsTitulos.UpdateStatus in [usUnmodified] then    // Se o registro teve modificaes
                          begin
                            cdsTitulos.Next;
                            if cdsTitulos.UpdateStatus in [usmodified] then // Se  o registro modificado do usUnModified
                               begin
                                  if cdsTitulos.FieldByName('VLR_TITULO').AsCurrency>0 then
                                     VlrNovo := cdsTitulos.FieldByName('VLR_TITULO').AsCurrency;
                                end;
                          end;
                       result := result + VlrNovo;
                     end;
                  BUS_CD_C_FPG.Close; }
                end;
             cdsTitulos.Next;
          end;
       cdsTitulos.First;
     end;

  cdsTitulos.First;

//  BUS_CD_M_NFE_TIT_INT.Free;
end;




function TSM.EchoString(Value: string): string;
begin
  Result := Value;
end;

function TSM.ReverseString(Value: string): string;
begin
  Result := System.StrUtils.ReverseString(Value);
end;




function TSM.DP_BR_CUPOM_MESTREDataRequest(Sender: TObject;
  Input: OleVariant): OleVariant;
function enSqlBrCupomMestre: String;
  begin
    Result := ' SELECT * FROM BR_CUPOM_MESTRE ';
  end;
begin
   SQ_BR_CUPOM_MESTRE.Close;
   SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre;

   if Input[0] = 0 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE DTHORA_FECHAMENTO IS NOT NULL and  N_CUPOM = ''' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 1 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND N_CUPOM = ''' + VarToStr(Input[1]) +''' ' +
           '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ';
      end;
   if Input[0] = 2 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND N_CUPOM in (' + VarToStr(Input[1]) +''' ';
      end;
   if Input[0] = 3 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE N_CUPOM in (' + VarToStr(Input[1]) +') ' +
           '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[0] = 4 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
             ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND  DATA_MOVIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
             '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[0] = 5 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
            ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND DATA_MOVIMENTO = ''' + FormatDateTime(CFormatoData, StrToDate(VarToStr(Input[1])) ) +''' ' +
             '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ' +
             '   AND DTHORA_FECHAMENTO IS NOT NULL ';
      end;

   if Input[0] = 6 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
            ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND ' +
             '  SERIAL_IMPRESSORA = ''' + VarToStr(Input[1]) +''' and ' +
             '  DATA_MOVIMENTO  = ''' + VarToStr(Input[2]) +''' ' +
             '  AND NOT EXISTS (SELECT * FROM FAT_TB_M_NFE  ' +
             '                  WHERE FAT_TB_M_NFE.NUMERO = BR_CUPOM_MESTRE.CCF  ' +
             '                    AND FAT_TB_M_NFE.ECF_SERIAL_IMPRESSORA =  BR_CUPOM_MESTRE.SERIAL_IMPRESSORA) ';
      end;

   if Input[0] = 7 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND CCF = ''' + VarToStr(Input[1]) +''' ' +
           '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ';
      end;

   if Input[0] = 8 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' left outer join BR_PREVENDA BPV on (BPV.N_CUPOM =  BR_CUPOM_MESTRE.N_CUPOM) ' +
           ' WHERE BPV.NUMPREVENDA = ''' + VarToStr(Input[1]) +''' ' +
           '   AND BPV.TIPO = ''P'' ';
      end;

   if Input[0] = 9 then
      begin
        SQ_BR_CUPOM_MESTRE.CommandText := enSqlBrCupomMestre +
           ' WHERE DTHORA_FECHAMENTO IS NOT NULL AND N_CUPOM = ''' + VarToStr(Input[1]) +''' ' +
           '   AND SERIAL_IMPRESSORA = ''' + VarToStr(Input[2]) +''' ';
      end;

   SQ_BR_CUPOM_MESTRE.CommandText := SQ_BR_CUPOM_MESTRE.CommandText + ' order by BR_CUPOM_MESTRE.n_cupom ';

   Result := DP_BR_CUPOM_MESTRE.Data;

   SQ_BR_CUPOM_MESTRE.Close;

end;


function TSM.enBusFpgEcf(ecf_serial_impressora: String): TDataSet;
var
  qry:TSqlQuery;
  qryNova:TSqlQuery;
  xSeq:Integer;
begin
   { TODO -oMaxsuel  -cCriao :
    Criado em 16/02/2016
    Buscar as formas de pagamento do enSoft que tem relao com as formas de pagamento da ECF }

  qry := TSqlQuery.Create(self);
  //SM  := TSM.Create(nil);
  qry.SQLConnection := self.conexao;

  //qry.SQLConnection := BuscarConnBanco;

  xSeq:=0;
  qry.Close;
  qry.SQL.Clear;
  qry.SQL.Add(' SELECT ECP.*, FPG.DOC_IMPRESSO FROM CAD_TB_C_ECF_FPG ECP ' +
              '   LEFT OUTER JOIN CAD_TB_C_FPG FPG on FPG.ID_FORMA_PAG = ECP.ID_FORMA_PAG ' +
              ' WHERE ECP.ECF_SERIAL_IMPRESSORA = '''+VarToStr(ecf_serial_impressora)+''' ');
  qry.Open;

  result := qry;

  qry.Destroy();
  //FreeAndNil(SM);
end;

end.



